function HandleErrors(b){function d(g){return navigator.userAgent.match(g)}var c=this,e=b||"/alternate";Trailer="<ul id = 'trailer'><li class = 'first'><a href = '#'>Watch Trailer</a></li><li><a href = 'http://ro.me/album'>Rome Album</a></li><li class = 'last'><a href = 'http://ro.me/tech'>The Technology</a></li><li class = 'clear'></li></ul>";this.MagicVariable="case";this.Errors=["<p>We are very sorry, but &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears that your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards. Although you are unable to participate in the full experience today, we expect this website to be up for a while, so please check back if you&#39;re on a different computer. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site and learn more about WebGL technology.</p>"+
Trailer,"<p>Apologies for the tech trouble. &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards. Although you are unable to participate in the full experience today, we expect this website to be up for a while, so please check back if you&#39;re on a different computer. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site and learn more about WebGL technology.<p>"+
Trailer,"<p>We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again. If you are unable to install a new web browser, you can try downloading the <a href = 'http://www.google.com/chromeframe'>Google Chrome Frame plugin</a> instead.</p>","<p>We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again.</p>",
"<p>We are sorry, but it appears that your browser does not support WebGL. &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. Please try launching this site again on a computer with up-to-date graphics drivers. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site, and learn more about WebGL technology.</p>"+Trailer,"<p>We&#39;re sorry, but &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. As a result, it may not work perfectly in your current browser. For the best viewing experience, you can <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and launch this site again, or go ahead and <a id = 'escape-from-warning' href = '#'>try it anyway</a>.</p>"];
this.getUrlVars=function(){for(var g=null,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),j=0;j<f.length;j++){var h=f[j].split("=");if(h.length==2){var m=h[0];h=h[1];if(m&&h){g==null&&(g={});g[m]=h}}}return g};this.checkForErrors=function(){var g;try{g=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(f){g=!1}g={webgl:g,conditions:[d(/[cC]hrome/),d(/[Ff]ire[Ff]ox\/[4-9]/),d(/MSIE [789]/)&&d(/[Ww]indows [Nn][Tt] [6789]\./),
d(/[Ss]afari/)&&d(/[Mm]ac [Oo][Ss] [Xx] 10\_[6789]/),d(/i[Pp]hone/)||d(/i[Pp]ad/)||d(/[Aa]ndroid/)],message:""};if(g.webgl){if(g=g.conditions[1]){var j;try{j="localStorage"in window&&window.localStorage!==null}catch(h){j=!1}g=j&&!localStorage.RomeError}if(g){window.addEventListener("load",function(){var m=document.createElement("div"),n=document.createElement("div"),p=document.createElement("div");p.setAttribute("id","rome-error");var t=document.createElement("style");t.innerHTML="a { color: #fff; }";
document.getElementsByTagName("head")[0].appendChild(t);m.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");n.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");p.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; font: color: #fff; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");
p.innerHTML=c.Errors[5];var v=function(){n.style.left=(window.innerWidth-400)/2+"px";n.style.top=window.innerHeight/2+"px"},u=function(){document.body.removeChild(m);document.body.removeChild(n);window.removeEventListener("resize",v,!1)};m.addEventListener("click",function(){u()},!1);window.addEventListener("resize",v,!1);n.appendChild(p);document.body.appendChild(m);document.body.appendChild(n);document.getElementById("escape-from-warning").addEventListener("click",function(w){w.preventDefault();
u()},!1)},!1);localStorage.RomeError=!0}}else for(j=0;j<g.conditions.length;j++)if(g.conditions[j]){window.location=e+"?"+this.MagicVariable+"="+j;break}}}var romeErrors=new HandleErrors,variables=romeErrors.getUrlVars();if(variables)variables[romeErrors.MagicVariable]&&window.addEventListener("load",function(){var b=variables[romeErrors.MagicVariable];document.getElementById("error").innerHTML=romeErrors.Errors[b]},!1);else romeErrors.checkForErrors();
var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b(ha,X,$){var na,pa,ta;for(pa=0;pa<30;pa++)for(na=0;na<73;na++){ta=(na+pa*74)*4;ha[ta]=ha[ta+4];ha[ta+1]=ha[ta+5];ha[ta+2]=ha[ta+6]}for(pa=0;pa<30;pa++){ta=(73+pa*74)*4;if(pa<X){ha[ta]=Z[$].bg.r;ha[ta+1]=Z[$].bg.g;ha[ta+2]=Z[$].bg.b}else{ha[ta]=Z[$].fg.r;ha[ta+1]=Z[$].fg.g;ha[ta+2]=Z[$].fg.b}}}var d=0,c=2,e,g=0,f=(new Date).getTime(),j=f,h=f,m=0,n=1E3,p=0,t,v,u,w,x,D=0,z=1E3,I=0,B,L,A,C,E=0,M=1E3,N=0,K,ea,o,ia,Z={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,
g:48,b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};e=document.createElement("div");e.style.cursor="pointer";e.style.width="80px";e.style.opacity="0.9";e.style.zIndex="10001";e.addEventListener("click",function(){d++;d==c&&(d=0);t.style.display="none";B.style.display="none";K.style.display="none";switch(d){case 0:t.style.display="block";break;case 1:B.style.display="block";break;case 2:K.style.display="block"}},!1);t=document.createElement("div");t.style.backgroundColor=
"rgb("+Math.floor(Z.fps.bg.r/2)+","+Math.floor(Z.fps.bg.g/2)+","+Math.floor(Z.fps.bg.b/2)+")";t.style.padding="2px 0px 3px 0px";e.appendChild(t);v=document.createElement("div");v.style.fontFamily="Helvetica, Arial, sans-serif";v.style.textAlign="left";v.style.fontSize="9px";v.style.color="rgb("+Z.fps.fg.r+","+Z.fps.fg.g+","+Z.fps.fg.b+")";v.style.margin="0px 0px 1px 3px";v.innerHTML='<span style="font-weight:bold">FPS</span>';t.appendChild(v);u=document.createElement("canvas");u.width=74;u.height=
30;u.style.display="block";u.style.marginLeft="3px";t.appendChild(u);w=u.getContext("2d");w.fillStyle="rgb("+Z.fps.bg.r+","+Z.fps.bg.g+","+Z.fps.bg.b+")";w.fillRect(0,0,u.width,u.height);x=w.getImageData(0,0,u.width,u.height);B=document.createElement("div");B.style.backgroundColor="rgb("+Math.floor(Z.ms.bg.r/2)+","+Math.floor(Z.ms.bg.g/2)+","+Math.floor(Z.ms.bg.b/2)+")";B.style.padding="2px 0px 3px 0px";B.style.display="none";e.appendChild(B);L=document.createElement("div");L.style.fontFamily="Helvetica, Arial, sans-serif";
L.style.textAlign="left";L.style.fontSize="9px";L.style.color="rgb("+Z.ms.fg.r+","+Z.ms.fg.g+","+Z.ms.fg.b+")";L.style.margin="0px 0px 1px 3px";L.innerHTML='<span style="font-weight:bold">MS</span>';B.appendChild(L);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";B.appendChild(u);A=u.getContext("2d");A.fillStyle="rgb("+Z.ms.bg.r+","+Z.ms.bg.g+","+Z.ms.bg.b+")";A.fillRect(0,0,u.width,u.height);C=A.getImageData(0,0,u.width,u.height);try{webkitPerformance&&
webkitPerformance.memory.totalJSHeapSize&&(c=3)}catch(oa){}K=document.createElement("div");K.style.backgroundColor="rgb("+Math.floor(Z.mem.bg.r/2)+","+Math.floor(Z.mem.bg.g/2)+","+Math.floor(Z.mem.bg.b/2)+")";K.style.padding="2px 0px 3px 0px";K.style.display="none";e.appendChild(K);ea=document.createElement("div");ea.style.fontFamily="Helvetica, Arial, sans-serif";ea.style.textAlign="left";ea.style.fontSize="9px";ea.style.color="rgb("+Z.mem.fg.r+","+Z.mem.fg.g+","+Z.mem.fg.b+")";ea.style.margin="0px 0px 1px 3px";
ea.innerHTML='<span style="font-weight:bold">MEM</span>';K.appendChild(ea);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";K.appendChild(u);o=u.getContext("2d");o.fillStyle="#301010";o.fillRect(0,0,u.width,u.height);ia=o.getImageData(0,0,u.width,u.height);return{domElement:e,update:function(){g++;f=(new Date).getTime();D=f-j;z=Math.min(z,D);I=Math.max(I,D);b(C.data,Math.min(30,30-D/200*30),"ms");L.innerHTML='<span style="font-weight:bold">'+
D+" MS</span> ("+z+"-"+I+")";A.putImageData(C,0,0);j=f;if(f>h+1E3){m=Math.round(g*1E3/(f-h));n=Math.min(n,m);p=Math.max(p,m);b(x.data,Math.min(30,30-m/100*30),"fps");v.innerHTML='<span style="font-weight:bold">'+m+" FPS</span> ("+n+"-"+p+")";w.putImageData(x,0,0);if(c==3){E=webkitPerformance.memory.usedJSHeapSize*9.54E-7;M=Math.min(M,E);N=Math.max(N,E);b(ia.data,Math.min(30,30-E/2),"mem");ea.innerHTML='<span style="font-weight:bold">'+Math.round(E)+" MEM</span> ("+Math.round(M)+"-"+Math.round(N)+
")";o.putImageData(ia,0,0)}h=f;g=0}}}},GUI=function(){var b=this,d=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
d.appendChild(c);var e=[],g=[],f=!0,j,h,m=0;b=this;var n=!1,p=280,t=!1,v,u,w=0,x;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=p+"px";var D=document.createElement("div");D.setAttribute("class","guidat-controllers");D.addEventListener("DOMMouseScroll",function(X){var $=this.scrollTop;if(X.wheelDelta)$+=X.wheelDelta;else X.detail&&($+=X.detail);X.preventDefault&&X.preventDefault();X.returnValue=!1;D.scrollTop=$},!1);D.style.height=
"0px";var z=document.createElement("a");z.setAttribute("class","guidat-toggle");z.setAttribute("href","#");z.innerHTML="Show Controls";var I=!1,B=0,L=!1,A,C,E,M,N=function(X){C=A;M=E;A=X.pageY;E=X.pageX;X=A-C;if(!n)if(X>0){n=!0;m=v=1;z.innerHTML=u||"Hide Controls"}else return;var $=M-E;if(X>0&&m>h){var na=GUI.map(m,h,h+100,1,0);X*=na}I=!0;B+=X;dragDisplacementX+=$;v+=X;p+=$;m+=X;D.style.height=v+"px";p=GUI.constrain(p,240,500);b.domElement.style.width=p+"px";ia()};z.addEventListener("mousedown",function(X){C=
A=X.pageY;M=E=X.pageX;L=!0;X.preventDefault();dragDisplacementX=B=0;document.addEventListener("mousemove",N,!1);return!1},!1);z.addEventListener("click",function(X){X.preventDefault();return!1},!1);document.addEventListener("mouseup",function(X){if(L&&!I){b.toggle();b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(L&&I){if(dragDisplacementX==0){b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(v>h){clearTimeout(x);
v=w=h;oa()}else if(D.children.length>=1){var $=D.children[0].offsetHeight;clearTimeout(x);w=Math.round(m/$)*$-1;if(w<=0){b.hide();v=$*2}else{v=w;oa()}}}document.removeEventListener("mousemove",N,!1);X.preventDefault();I=!1;L=!1;return!1},!1);this.domElement.appendChild(D);this.domElement.appendChild(z);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var K=function(){j=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(X){if(f=X)g.length>0&&K();else clearInterval(j)});this.__defineGetter__("autoListen",function(){return f});this.listenTo=function(X){g.length==0&&K();g.push(X)};this.unlistenTo=function(X){for(var $=0;$<g.length;$++)g[$]==X&&g.splice($,1);g.length<=0&&clearInterval(j)};this.listen=function(X){X=X||g;for(var $ in X)X[$].updateDisplay()};this.listenAll=function(){this.listen(e)};
this.autoListen=!0;var ea=function(X,$){for(var na in e)if(e[na].object==X&&e[na].propertyName==$)return!0;return!1},o=function(X,$){function na(){return X.apply(this,$)}na.prototype=X.prototype;return new na};this.add=function(){var X=arguments[0],$=arguments[1];ea(X,$);var na=X[$];if(na==undefined)GUI.error(X+' either has no property "'+$+'", or the property is inaccessible.');else{X=typeof na;na=Z[X];if(na==undefined)GUI.error('Cannot create controller for data type "'+X+'"');else{for(var pa=[this],
ta=0;ta<arguments.length;ta++)pa.push(arguments[ta]);if(na=o(na,pa)){D.appendChild(na.domElement);e.push(na);GUI.allControllers.push(na);if(X!="function"&&GUI.saveIndex<GUI.savedValues.length){na.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}ia();t||(v=h);return na}else GUI.error('Error creating controller for "'+$+'".')}}};var ia=function(){h=0;for(var X in e)h+=e[X].domElement.offsetHeight;D.style.overflowY=h-1>v?"auto":"hidden"},Z={number:GUI.NumberController,string:GUI.StringController,
"boolean":GUI.BooleanController,"function":GUI.FunctionController};ea=function(X,$){for(var na in e)if(e[na].object==X&&e[na].propertyName==$)return!0;return!1};o=function(X,$){function na(){return X.apply(this,$)}na.prototype=X.prototype;return new na};this.reset=function(){};this.toggle=function(){n?this.hide():this.show()};this.show=function(){z.innerHTML=u||"Hide Controls";w=v;clearTimeout(x);oa();n=!0};this.hide=function(){z.innerHTML=u||"Show Controls";w=0;clearTimeout(x);oa();n=!1};this.name=
function(X){u=X;z.innerHTML=X};this.appearanceVars=function(){return[n,p,v,D.scrollTop]};var oa=function(){m+=(w-m)*0.6;if(Math.abs(m-w)<1)m=w;else x=setTimeout(oa,1E3/30);D.style.height=Math.round(m)+"px";ia()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){p=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=p+"px";v=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);t=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){m=v;var ha=GUI.savedAppearanceVars[GUI.guiIndex][3];
setTimeout(function(){D.scrollTop=ha},0);if(GUI.scrollTop>-1)document.body.scrollTop=GUI.scrollTop;w=v;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var d=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<d;c++){var e=b.splice(2,4);GUI.savedAppearanceVars.push(e)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var d in GUI.allGuis)for(var c=GUI.allGuis[d].appearanceVars(),e=0;e<c.length;e++)b.push(c[e]);for(d in GUI.allControllers)if(GUI.allControllers[d].type!="function"){c=GUI.allControllers[d].getValue();GUI.allControllers[d].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var d,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<c.length;e++){d=c[e].split("=");if(d!=undefined&&d[0]==b)return d[1]}return null};
GUI.replaceGetVar=function(b,d){for(var c,e=window.location.href,g=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),f=0;f<g.length;f++){c=g[f].split("=");if(c!=undefined&&c[0]==b)return e.replace(c[1],d)}if(window.location.href.indexOf("?")!=-1)return e+"&"+b+"="+d;return e+"?"+b+"="+d};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,d,c,e,g){return e+(g-e)*((b-d)/(c-d))};GUI.constrain=function(b,d,c){if(b<d)b=d;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,d){var c=Math.pow(10,d);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,d,c,e,g){var f=!1,j=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(m){this.fg.style.width=GUI.map(m,d,c,0,100)+"%"});var h=function(m){if(f){var n;n=j.domElement;var p=curtop=0;if(n.offsetParent){do{p+=n.offsetLeft;curtop+=n.offsetTop}while(n=n.offsetParent);
n=[p,curtop]}else n=void 0;m=GUI.map(m.pageX,n[0],n[0]+j.domElement.offsetWidth,d,c);m=Math.round(m/e)*e;b.setValue(m)}};this.domElement.addEventListener("mousedown",function(m){f=!0;j.domElement.setAttribute("class","guidat-slider-bg active");j.fg.setAttribute("class","guidat-slider-fg active");h(m)},!1);document.addEventListener("mouseup",function(){j.domElement.setAttribute("class","guidat-slider-bg");j.fg.setAttribute("class","guidat-slider-fg");f=!1},!1);document.addEventListener("mousemove",
h,!1);this.value=g};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var d=document.createElement("input"),c=this.getValue();d.setAttribute("value",c);d.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){d.focus();d.select()},!1);d.addEventListener("keyup",function(){b.setValue(d.value)},!1);this.updateDisplay=function(){d.value=b.getValue()};this.domElement.appendChild(d)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,d=!1,c=!1,e=py=0,g=arguments[3],f=arguments[4],j=arguments[5];j||(j=g!=undefined&&f!=undefined?(f-g)*0.01:1);var h=document.createElement("input");h.setAttribute("id",this.propertyName);h.setAttribute("type","text");h.setAttribute("value",this.getValue());j&&h.setAttribute("step",j);this.domElement.appendChild(h);var m;if(g!=undefined&&f!=undefined){m=new GUI.Slider(this,g,f,j,this.getValue());this.domElement.appendChild(m.domElement)}h.addEventListener("blur",
function(){var p=parseFloat(this.value);if(isNaN(p))this.value=b.getValue();else b.updateDisplay()},!1);h.addEventListener("mousewheel",function(p){p.preventDefault();b.setValue(b.getValue()+Math.abs(p.wheelDeltaY)/p.wheelDeltaY*j);return!1},!1);h.addEventListener("mousedown",function(p){py=e=p.pageY;c=!0;document.addEventListener("mousemove",n,!1)},!1);h.addEventListener("keydown",function(p){switch(p.keyCode){case 38:p=b.getValue()+j;b.setValue(p);break;case 40:p=b.getValue()-j;b.setValue(p)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",n,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(h);if(c&&!d){h.focus();h.select()}d=!1;c=!1},!1);var n=function(p){d=!0;p.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(h);py=e;e=p.pageY;p=py-e;p=b.getValue()+p*j;b.setValue(p);return!1};this.setValue=function(p){p=parseFloat(p);if(g!=undefined&&p<=g)p=g;else f!=undefined&&p>=f&&(p=f);return GUI.Controller.prototype.setValue.call(this,
p)};this.updateDisplay=function(){h.value=GUI.roundToDecimal(b.getValue(),4);if(m)m.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,d=document.createElement("input");d.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){d.checked=!d.checked;c.preventDefault();b.setValue(d.checked)},!1);d.addEventListener("mouseup",function(){d.checked=!d.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(d);this.updateDisplay=function(){d.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(e){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);
var signals=function(){function b(c,e,g,f,j){this._listener=e;this._isOnce=g;this.context=f;this._signal=c;this._priority=j||0}var d={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var e;if(this._isEnabled){e=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return e},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};d.Signal=function(){this._bindings=[]};d.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,e,g,f){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var j=this._indexOfListener(c);if(j!==-1){c=this._bindings[j];if(c.isOnce()!==e)throw Error("You cannot add"+(e?"":"Once")+"() then add"+(!e?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,e,g,f);this._addBinding(c)}return c},_addBinding:function(c){var e=this._bindings.length;do--e;while(this._bindings[e]&&c._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,c)},_indexOfListener:function(c){for(var e=this._bindings.length;e--;)if(this._bindings[e]._listener===
c)return e;return-1},add:function(c,e,g){return this._registerListener(c,!1,e,g)},addOnce:function(c,e,g){return this._registerListener(c,!0,e,g)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var e=this._indexOfListener(c);if(e!==-1){this._bindings[e]._destroy();this._bindings.splice(e,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),e=this._bindings.slice(),g=this._bindings.length;this._shouldPropagate=!0;do g--;while(e[g]&&this._shouldPropagate&&e[g].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return d}(),TWEEN=TWEEN||function(){var b,d,c,e=[];this.add=function(g){e.push(g)};this.remove=function(g){b=e.indexOf(g);b!==-1&&e.splice(b,1)};this.update=function(){b=0;d=e.length;for(c=(new Date).getTime();b<d;)if(e[b].update(c))b++;else{e.splice(b,1);d--}};return this}();
TWEEN.Tween=function(b){var d={},c={},e={},g=1E3,f=0,j=null,h=TWEEN.Easing.Linear.EaseNone,m=null,n=null,p=null;this.to=function(t,v){v!==null&&(g=v);for(var u in t)b[u]!==null&&(e[u]=t[u]);return this};this.start=function(){TWEEN.add(this);j=(new Date).getTime()+f;for(var t in e)if(b[t]!==null){d[t]=b[t];c[t]=e[t]-b[t]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(t){f=t;return this};this.easing=function(t){h=t;return this};this.chain=function(t){m=t};this.onUpdate=
function(t){n=t;return this};this.onComplete=function(t){p=t;return this};this.update=function(t){var v,u;if(t<j)return!0;t=(t-j)/g;t=t>1?1:t;u=h(t);for(v in c)b[v]=d[v]+c[v]*u;n!==null&&n.call(b,u);if(t==1){p!==null&&p.call(b);m!==null&&m.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var d,c=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);if(!c||c<1){c=1;d=e/4}else d=e/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-d)*2*Math.PI/e))};
TWEEN.Easing.Elastic.EaseOut=function(b){var d,c=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);if(!c||c<1){c=1;d=e/4}else d=e/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-d)*2*Math.PI/e)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var d,c=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);if(!c||c<1){c=1;d=e/4}else d=e/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-d)*2*Math.PI/e);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-d)*2*Math.PI/e)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,d,c){this.r=b;this.g=d;this.b=c;this.updateHex()},setHSV:function(b,d,c){var e,g,f,j,h,m;if(c==0)e=g=f=0;else{j=Math.floor(b*6);h=b*6-j;b=c*(1-d);m=c*(1-d*h);d=c*(1-d*(1-h));switch(j){case 1:e=m;g=c;f=b;break;case 2:e=b;g=c;f=d;break;case 3:e=b;g=m;f=c;break;case 4:e=d;g=b;f=c;break;case 5:e=c;g=b;f=m;break;case 6:case 0:e=c;g=d;f=b}}this.setRGB(e,
g,f)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,d){this.set(b||0,d||0)};
THREE.Vector2.prototype={set:function(b,d){this.x=b;this.y=d;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,d){this.set(b.x+d.x,b.y+d.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,d){this.set(b.x-d.x,b.y-d.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,d,c){this.set(b||0,d||0,c||0)};
THREE.Vector3.prototype={set:function(b,d,c){this.x=b;this.y=d;this.z=c;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,d){this.set(b.x+d.x,b.y+d.y,b.z+d.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,d){this.set(b.x-d.x,b.y-d.y,b.z-d.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
d){this.set(b.y*d.z-b.z*d.y,b.z*d.x-b.x*d.z,b.x*d.y-b.y*d.x);return this},crossSelf:function(b){var d=this.x,c=this.y,e=this.z;this.set(c*b.z-e*b.y,e*b.x-d*b.z,d*b.y-c*b.x);return this},multiply:function(b,d){this.set(b.x*d.x,b.y*d.y,b.z*d.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var d=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return d*d+c*c+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var d=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(d)>1.0E-5){this.x=Math.atan2(-b.n23/d,b.n33/d);this.z=Math.atan2(-b.n12/d,b.n11/d)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,d,c,e){this.set(b||0,d||0,c||0,e||1)};
THREE.Vector4.prototype={set:function(b,d,c,e){this.x=b;this.y=d;this.z=c;this.w=e;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,d){this.set(b.x+d.x,b.y+d.y,b.z+d.z,b.w+d.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,d){this.set(b.x-d.x,b.y-d.y,b.z-d.z,b.w-d.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,d){this.set(this.x+(b.x-this.x)*d,this.y+(b.y-this.y)*d,this.z+(b.z-this.z)*d,this.w+(b.w-this.w)*d)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,d){this.origin=b||new THREE.Vector3;this.direction=d||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){var d,c,e=b.objects,g=[];b=0;for(d=e.length;b<d;b++){c=e[b];c instanceof THREE.Mesh&&(g=g.concat(this.intersectObject(c)))}g.sort(function(f,j){return f.distance-j.distance});return g},intersectObject:function(b){function d(D,z,I,B){B=B.clone().subSelf(z);I=I.clone().subSelf(z);var L=D.clone().subSelf(z);D=B.dot(B);z=B.dot(I);B=B.dot(L);var A=I.dot(I);I=I.dot(L);L=1/(D*A-z*z);A=(A*B-z*I)*L;D=(D*I-z*B)*L;return A>0&&D>0&&A+D<1}var c,e,g,f,j,h,m,n,p,t,
v,u=b.geometry,w=u.vertices,x=[];c=0;for(e=u.faces.length;c<e;c++){g=u.faces[c];t=this.origin.clone();v=this.direction.clone();m=b.matrixWorld;f=m.multiplyVector3(w[g.a].position.clone());j=m.multiplyVector3(w[g.b].position.clone());h=m.multiplyVector3(w[g.c].position.clone());m=g instanceof THREE.Face4?m.multiplyVector3(w[g.d].position.clone()):null;n=b.matrixRotationWorld.multiplyVector3(g.normal.clone());p=v.dot(n);if(b.doubleSided||(b.flipSided?p>0:p<0)){n=n.dot((new THREE.Vector3).sub(f,t))/
p;t=t.addSelf(v.multiplyScalar(n));if(g instanceof THREE.Face3){if(d(t,f,j,h)){g={distance:this.origin.distanceTo(t),point:t,face:g,object:b};x.push(g)}}else if(g instanceof THREE.Face4&&(d(t,f,j,m)||d(t,j,h,m))){g={distance:this.origin.distanceTo(t),point:t,face:g,object:b};x.push(g)}}}return x}};
THREE.Rectangle=function(){function b(){f=e-d;j=g-c}var d,c,e,g,f,j,h=!0;this.getX=function(){return d};this.getY=function(){return c};this.getWidth=function(){return f};this.getHeight=function(){return j};this.getLeft=function(){return d};this.getTop=function(){return c};this.getRight=function(){return e};this.getBottom=function(){return g};this.set=function(m,n,p,t){h=!1;d=m;c=n;e=p;g=t;b()};this.addPoint=function(m,n){if(h){h=!1;d=m;c=n;e=m;g=n}else{d=d<m?d:m;c=c<n?c:n;e=e>m?e:m;g=g>n?g:n}b()};
this.add3Points=function(m,n,p,t,v,u){if(h){h=!1;d=m<p?m<v?m:v:p<v?p:v;c=n<t?n<u?n:u:t<u?t:u;e=m>p?m>v?m:v:p>v?p:v;g=n>t?n>u?n:u:t>u?t:u}else{d=m<p?m<v?m<d?m:d:v<d?v:d:p<v?p<d?p:d:v<d?v:d;c=n<t?n<u?n<c?n:c:u<c?u:c:t<u?t<c?t:c:u<c?u:c;e=m>p?m>v?m>e?m:e:v>e?v:e:p>v?p>e?p:e:v>e?v:e;g=n>t?n>u?n>g?n:g:u>g?u:g:t>u?t>g?t:g:u>g?u:g}b()};this.addRectangle=function(m){if(h){h=!1;d=m.getLeft();c=m.getTop();e=m.getRight();g=m.getBottom()}else{d=d<m.getLeft()?d:m.getLeft();c=c<m.getTop()?c:m.getTop();e=e>m.getRight()?
e:m.getRight();g=g>m.getBottom()?g:m.getBottom()}b()};this.inflate=function(m){d-=m;c-=m;e+=m;g+=m;b()};this.minSelf=function(m){d=d>m.getLeft()?d:m.getLeft();c=c>m.getTop()?c:m.getTop();e=e<m.getRight()?e:m.getRight();g=g<m.getBottom()?g:m.getBottom();b()};this.instersects=function(m){return Math.min(e,m.getRight())-Math.max(d,m.getLeft())>=0&&Math.min(g,m.getBottom())-Math.max(c,m.getTop())>=0};this.empty=function(){h=!0;g=e=c=d=0;b()};this.isEmpty=function(){return h}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,d=this.m;b=d[1];d[1]=d[3];d[3]=b;b=d[2];d[2]=d[6];d[6]=b;b=d[5];d[5]=d[7];d[7]=b;return this},transposeIntoArray:function(b){var d=this.m;b[0]=d[0];b[1]=d[3];b[2]=d[6];b[3]=d[1];b[4]=d[4];b[5]=d[7];b[6]=d[2];b[7]=d[5];b[8]=d[8];return this}};
THREE.Matrix4=function(b,d,c,e,g,f,j,h,m,n,p,t,v,u,w,x){this.set(b||1,d||0,c||0,e||0,g||0,f||1,j||0,h||0,m||0,n||0,p||1,t||0,v||0,u||0,w||0,x||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,d,c,e,g,f,j,h,m,n,p,t,v,u,w,x){this.n11=b;this.n12=d;this.n13=c;this.n14=e;this.n21=g;this.n22=f;this.n23=j;this.n24=h;this.n31=m;this.n32=n;this.n33=p;this.n34=t;this.n41=v;this.n42=u;this.n43=w;this.n44=x;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,d,c){var e=THREE.Matrix4.__v1,
g=THREE.Matrix4.__v2,f=THREE.Matrix4.__v3;f.sub(b,d).normalize();if(f.length()===0)f.z=1;e.cross(c,f).normalize();if(e.length()===0){f.x+=1.0E-4;e.cross(c,f).normalize()}g.cross(f,e).normalize();this.n11=e.x;this.n12=g.x;this.n13=f.x;this.n21=e.y;this.n22=g.y;this.n23=f.y;this.n31=e.z;this.n32=g.z;this.n33=f.z;return this},multiplyVector3:function(b){var d=b.x,c=b.y,e=b.z,g=1/(this.n41*d+this.n42*c+this.n43*e+this.n44);b.x=(this.n11*d+this.n12*c+this.n13*e+this.n14)*g;b.y=(this.n21*d+this.n22*c+this.n23*
e+this.n24)*g;b.z=(this.n31*d+this.n32*c+this.n33*e+this.n34)*g;return b},multiplyVector4:function(b){var d=b.x,c=b.y,e=b.z,g=b.w;b.x=this.n11*d+this.n12*c+this.n13*e+this.n14*g;b.y=this.n21*d+this.n22*c+this.n23*e+this.n24*g;b.z=this.n31*d+this.n32*c+this.n33*e+this.n34*g;b.w=this.n41*d+this.n42*c+this.n43*e+this.n44*g;return b},rotateAxis:function(b){var d=b.x,c=b.y,e=b.z;b.x=d*this.n11+c*this.n12+e*this.n13;b.y=d*this.n21+c*this.n22+e*this.n23;b.z=d*this.n31+c*this.n32+e*this.n33;b.normalize();
return b},crossVector:function(b){var d=new THREE.Vector4;d.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;d.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;d.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;d.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return d},multiply:function(b,d){var c=b.n11,e=b.n12,g=b.n13,f=b.n14,j=b.n21,h=b.n22,m=b.n23,n=b.n24,p=b.n31,t=b.n32,v=b.n33,u=b.n34,w=b.n41,x=b.n42,D=b.n43,z=b.n44,I=d.n11,B=d.n12,L=d.n13,A=d.n14,C=d.n21,E=d.n22,
M=d.n23,N=d.n24,K=d.n31,ea=d.n32,o=d.n33,ia=d.n34;this.n11=c*I+e*C+g*K;this.n12=c*B+e*E+g*ea;this.n13=c*L+e*M+g*o;this.n14=c*A+e*N+g*ia+f;this.n21=j*I+h*C+m*K;this.n22=j*B+h*E+m*ea;this.n23=j*L+h*M+m*o;this.n24=j*A+h*N+m*ia+n;this.n31=p*I+t*C+v*K;this.n32=p*B+t*E+v*ea;this.n33=p*L+t*M+v*o;this.n34=p*A+t*N+v*ia+u;this.n41=w*I+x*C+D*K;this.n42=w*B+x*E+D*ea;this.n43=w*L+x*M+D*o;this.n44=w*A+x*N+D*ia+z;return this},multiplyToArray:function(b,d,c){this.multiply(b,d);c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;
c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=
this.n11,d=this.n12,c=this.n13,e=this.n14,g=this.n21,f=this.n22,j=this.n23,h=this.n24,m=this.n31,n=this.n32,p=this.n33,t=this.n34,v=this.n41,u=this.n42,w=this.n43,x=this.n44;return e*j*n*v-c*h*n*v-e*f*p*v+d*h*p*v+c*f*t*v-d*j*t*v-e*j*m*u+c*h*m*u+e*g*p*u-b*h*p*u-c*g*t*u+b*j*t*u+e*f*m*w-d*h*m*w-e*g*n*w+b*h*n*w+d*g*t*w-b*f*t*w-c*f*m*x+d*j*m*x+c*g*n*x-b*j*n*x-d*g*p*x+b*f*p*x},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=
this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;
this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=
this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,d){b[d]=this.n11;b[d+1]=this.n21;b[d+2]=this.n31;b[d+3]=this.n41;b[d+4]=this.n12;b[d+5]=this.n22;b[d+6]=this.n32;b[d+7]=this.n42;b[d+8]=this.n13;b[d+9]=this.n23;b[d+10]=this.n33;b[d+11]=this.n43;b[d+12]=this.n14;b[d+13]=this.n24;b[d+14]=this.n34;b[d+15]=this.n44;return b},setTranslation:function(b,d,c){this.set(1,0,0,b,0,1,0,d,0,0,1,c,0,0,0,1);return this},setScale:function(b,
d,c){this.set(b,0,0,0,0,d,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var d=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,d,-b,0,0,b,d,0,0,0,0,1);return this},setRotationY:function(b){var d=Math.cos(b);b=Math.sin(b);this.set(d,0,b,0,0,1,0,0,-b,0,d,0,0,0,0,1);return this},setRotationZ:function(b){var d=Math.cos(b);b=Math.sin(b);this.set(d,-b,0,0,b,d,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,d){var c=Math.cos(d),e=Math.sin(d),g=1-c,f=b.x,j=b.y,h=b.z,m=g*f,n=g*j;this.set(m*
f+c,m*j-e*h,m*h+e*j,0,m*j+e*h,n*j+c,n*h-e*f,0,m*h-e*j,n*h+e*f,g*h*h+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;
this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var d=b.x,c=b.y,e=b.z;b=Math.cos(d);d=Math.sin(d);var g=Math.cos(c);c=Math.sin(c);var f=Math.cos(e);e=Math.sin(e);var j=b*c,h=d*c;this.n11=g*f;this.n12=-g*e;this.n13=c;this.n21=h*f+b*e;this.n22=-h*e+b*f;this.n23=-d*g;this.n31=-j*f+d*e;this.n32=j*e+d*f;this.n33=b*g;return this},
setRotationFromQuaternion:function(b){var d=b.x,c=b.y,e=b.z,g=b.w,f=d+d,j=c+c,h=e+e;b=d*f;var m=d*j;d*=h;var n=c*j;c*=h;e*=h;f*=g;j*=g;g*=h;this.n11=1-(n+e);this.n12=m-g;this.n13=d+j;this.n21=m+g;this.n22=1-(b+e);this.n23=c-f;this.n31=d-j;this.n32=c+f;this.n33=1-(b+n);return this},scale:function(b){var d=b.x,c=b.y;b=b.z;this.n11*=d;this.n12*=c;this.n13*=b;this.n21*=d;this.n22*=c;this.n23*=b;this.n31*=d;this.n32*=c;this.n33*=b;this.n41*=d;this.n42*=c;this.n43*=b;return this},extractPosition:function(b){this.n14=
b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,d){var c=1/d.x,e=1/d.y,g=1/d.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*e;this.n22=b.n22*e;this.n32=b.n32*e;this.n13=b.n13*g;this.n23=b.n23*g;this.n33=b.n33*g}};
THREE.Matrix4.makeInvert=function(b,d){var c=b.n11,e=b.n12,g=b.n13,f=b.n14,j=b.n21,h=b.n22,m=b.n23,n=b.n24,p=b.n31,t=b.n32,v=b.n33,u=b.n34,w=b.n41,x=b.n42,D=b.n43,z=b.n44;d===undefined&&(d=new THREE.Matrix4);d.n11=m*u*x-n*v*x+n*t*D-h*u*D-m*t*z+h*v*z;d.n12=f*v*x-g*u*x-f*t*D+e*u*D+g*t*z-e*v*z;d.n13=g*n*x-f*m*x+f*h*D-e*n*D-g*h*z+e*m*z;d.n14=f*m*t-g*n*t-f*h*v+e*n*v+g*h*u-e*m*u;d.n21=n*v*w-m*u*w-n*p*D+j*u*D+m*p*z-j*v*z;d.n22=g*u*w-f*v*w+f*p*D-c*u*D-g*p*z+c*v*z;d.n23=f*m*w-g*n*w-f*j*D+c*n*D+g*j*z-c*m*z;
d.n24=g*n*p-f*m*p+f*j*v-c*n*v-g*j*u+c*m*u;d.n31=h*u*w-n*t*w+n*p*x-j*u*x-h*p*z+j*t*z;d.n32=f*t*w-e*u*w-f*p*x+c*u*x+e*p*z-c*t*z;d.n33=g*n*w-f*h*w+f*j*x-c*n*x-e*j*z+c*h*z;d.n34=f*h*p-e*n*p-f*j*t+c*n*t+e*j*u-c*h*u;d.n41=m*t*w-h*v*w-m*p*x+j*v*x+h*p*D-j*t*D;d.n42=e*v*w-g*t*w+g*p*x-c*v*x-e*p*D+c*t*D;d.n43=g*h*w-e*m*w-g*j*x+c*m*x+e*j*D-c*h*D;d.n44=e*m*p-g*h*p+g*j*t-c*m*t-e*j*v+c*h*v;d.multiplyScalar(1/b.determinant());return d};
THREE.Matrix4.makeInvert3x3=function(b){var d=b.m33,c=d.m,e=b.n33*b.n22-b.n32*b.n23,g=-b.n33*b.n21+b.n31*b.n23,f=b.n32*b.n21-b.n31*b.n22,j=-b.n33*b.n12+b.n32*b.n13,h=b.n33*b.n11-b.n31*b.n13,m=-b.n32*b.n11+b.n31*b.n12,n=b.n23*b.n12-b.n22*b.n13,p=-b.n23*b.n11+b.n21*b.n13,t=b.n22*b.n11-b.n21*b.n12;b=b.n11*e+b.n21*j+b.n31*n;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*e;c[1]=b*g;c[2]=b*f;c[3]=b*j;c[4]=b*h;c[5]=b*m;c[6]=b*n;c[7]=b*p;c[8]=b*t;return d};
THREE.Matrix4.makeFrustum=function(b,d,c,e,g,f){var j;j=new THREE.Matrix4;j.n11=2*g/(d-b);j.n12=0;j.n13=(d+b)/(d-b);j.n14=0;j.n21=0;j.n22=2*g/(e-c);j.n23=(e+c)/(e-c);j.n24=0;j.n31=0;j.n32=0;j.n33=-(f+g)/(f-g);j.n34=-2*f*g/(f-g);j.n41=0;j.n42=0;j.n43=-1;j.n44=0;return j};THREE.Matrix4.makePerspective=function(b,d,c,e){var g;b=c*Math.tan(b*Math.PI/360);g=-b;return THREE.Matrix4.makeFrustum(g*d,b*d,g,b,c,e)};
THREE.Matrix4.makeOrtho=function(b,d,c,e,g,f){var j,h,m,n;j=new THREE.Matrix4;h=d-b;m=c-e;n=f-g;j.n11=2/h;j.n12=0;j.n13=0;j.n14=-((d+b)/h);j.n21=0;j.n22=2/m;j.n23=0;j.n24=-((c+e)/m);j.n31=0;j.n32=0;j.n33=-2/n;j.n34=-((f+g)/n);j.n41=0;j.n42=0;j.n43=0;j.n44=1;return j};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=
!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,d){this.matrix.rotateAxis(d);this.position.addSelf(d.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var d=this;d.parent!==undefined;)d=d.parent;d!==undefined&&d instanceof THREE.Scene&&d.addChildRecurse(b)}},removeChild:function(b){var d=this.children.indexOf(b);if(d!==-1){b.parent=undefined;this.children.splice(d,1)}},getChildByName:function(b,d){var c,e,g;c=0;for(e=this.children.length;c<e;c++){g=this.children[c];if(g.name===b)return g;if(d){g=g.getChildByName(b,d);if(g!==undefined)return g}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,d,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||d){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;d=!0}b=0;for(var e=this.children.length;b<e;b++)this.children[b].update(this.matrixWorld,d,c)}};THREE.Quaternion=function(b,d,c,e){this.set(b||0,d||0,c||0,e!==undefined?e:1)};
THREE.Quaternion.prototype={set:function(b,d,c,e){this.x=b;this.y=d;this.z=c;this.w=e;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var d=0.5*Math.PI/360,c=b.x*d,e=b.y*d,g=b.z*d;b=Math.cos(e);e=Math.sin(e);d=Math.cos(-g);g=Math.sin(-g);var f=Math.cos(c);c=Math.sin(c);var j=b*d,h=e*g;this.w=j*f-h*c;this.x=j*c+h*f;this.y=e*d*f+b*g*c;this.z=b*g*f-e*d*c;return this},setFromAxisAngle:function(b,d){var c=d/2,e=Math.sin(c);this.x=b.x*e;this.y=
b.y*e;this.z=b.z*e;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var d=this.x,c=this.y,e=this.z,g=this.w,f=b.x,j=b.y,h=b.z;b=b.w;this.x=d*b+g*f+c*h-e*j;this.y=c*b+g*j+e*f-d*h;this.z=e*b+g*h+d*j-c*f;this.w=g*b-d*f-c*j-e*h;return this},multiply:function(b,d){this.x=b.x*d.w+b.y*d.z-b.z*d.y+b.w*d.x;this.y=-b.x*d.z+b.y*d.w+b.z*d.x+b.w*d.y;this.z=b.x*d.y-b.y*d.x+b.z*d.w+b.w*d.z;this.w=-b.x*d.x-b.y*d.y-b.z*d.z+b.w*d.w;return this},multiplyVector3:function(b,d){d||(d=b);var c=b.x,e=b.y,g=b.z,f=this.x,j=this.y,h=this.z,m=this.w,n=m*c+j*g-h*e,p=
m*e+h*c-f*g,t=m*g+f*e-j*c;c=-f*c-j*e-h*g;d.x=n*m+c*-f+p*-h-t*-j;d.y=p*m+c*-j+t*-f-n*-h;d.z=t*m+c*-h+n*-j-p*-f;return d}};
THREE.Quaternion.slerp=function(b,d,c,e){var g=b.w*d.w+b.x*d.x+b.y*d.y+b.z*d.z;if(Math.abs(g)>=1){c.w=b.w;c.x=b.x;c.y=b.y;c.z=b.z;return c}var f=Math.acos(g),j=Math.sqrt(1-g*g);if(Math.abs(j)<0.001){c.w=0.5*(b.w+d.w);c.x=0.5*(b.x+d.x);c.y=0.5*(b.y+d.y);c.z=0.5*(b.z+d.z);return c}g=Math.sin((1-e)*f)/j;e=Math.sin(e*f)/j;c.w=b.w*g+d.w*e;c.x=b.x*g+d.x*e;c.y=b.y*g+d.y*e;c.z=b.z*g+d.z*e;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,d,c,e,g,f){this.a=b;this.b=d;this.c=c;this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3;this.vertexNormals=e instanceof Array?e:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=f instanceof Array?f:[f];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,d,c,e,g,f,j){this.a=b;this.b=d;this.c=c;this.d=e;this.normal=g instanceof THREE.Vector3?g:new THREE.Vector3;this.vertexNormals=g instanceof Array?g:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=j instanceof Array?j:[j];this.centroid=new THREE.Vector3};THREE.UV=function(b,d){this.set(b||0,d||0)};
THREE.UV.prototype={set:function(b,d){this.u=b;this.v=d;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,d,c;b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var d,c,e,g,f,j,h=new THREE.Vector3,m=new THREE.Vector3;e=0;for(g=this.faces.length;e<g;e++){f=this.faces[e];if(b&&f.vertexNormals.length){h.set(0,0,0);d=0;for(c=f.vertexNormals.length;d<c;d++)h.addSelf(f.vertexNormals[d]);h.divideScalar(3)}else{d=this.vertices[f.a];c=this.vertices[f.b];j=this.vertices[f.c];h.sub(j.position,c.position);m.sub(d.position,c.position);h.crossSelf(m)}h.isZero()||
h.normalize();f.normal.copy(h)}},computeVertexNormals:function(){var b,d,c,e;if(this.__tmpVertices==undefined){e=this.__tmpVertices=Array(this.vertices.length);b=0;for(d=this.vertices.length;b<d;b++)e[b]=new THREE.Vector3;b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{e=
this.__tmpVertices;b=0;for(d=this.vertices.length;b<d;b++)e[b].set(0,0,0)}b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];if(c instanceof THREE.Face3){e[c.a].addSelf(c.normal);e[c.b].addSelf(c.normal);e[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){e[c.a].addSelf(c.normal);e[c.b].addSelf(c.normal);e[c.c].addSelf(c.normal);e[c.d].addSelf(c.normal)}}b=0;for(d=this.vertices.length;b<d;b++)e[b].normalize();b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(e[c.a]);
c.vertexNormals[1].copy(e[c.b]);c.vertexNormals[2].copy(e[c.c])}else if(c instanceof THREE.Face4){c.vertexNormals[0].copy(e[c.a]);c.vertexNormals[1].copy(e[c.b]);c.vertexNormals[2].copy(e[c.c]);c.vertexNormals[3].copy(e[c.d])}}},computeTangents:function(){function b(X,$,na,pa,ta,xa,ua){h=X.vertices[$].position;m=X.vertices[na].position;n=X.vertices[pa].position;p=j[ta];t=j[xa];v=j[ua];u=m.x-h.x;w=n.x-h.x;x=m.y-h.y;D=n.y-h.y;z=m.z-h.z;I=n.z-h.z;B=t.u-p.u;L=v.u-p.u;A=t.v-p.v;C=v.v-p.v;E=1/(B*C-L*A);
ea.set((C*u-A*w)*E,(C*x-A*D)*E,(C*z-A*I)*E);o.set((B*w-L*u)*E,(B*D-L*x)*E,(B*I-L*z)*E);N[$].addSelf(ea);N[na].addSelf(ea);N[pa].addSelf(ea);K[$].addSelf(o);K[na].addSelf(o);K[pa].addSelf(o)}var d,c,e,g,f,j,h,m,n,p,t,v,u,w,x,D,z,I,B,L,A,C,E,M,N=[],K=[],ea=new THREE.Vector3,o=new THREE.Vector3,ia=new THREE.Vector3,Z=new THREE.Vector3,oa=new THREE.Vector3;d=0;for(c=this.vertices.length;d<c;d++){N[d]=new THREE.Vector3;K[d]=new THREE.Vector3}d=0;for(c=this.faces.length;d<c;d++){f=this.faces[d];j=this.faceVertexUvs[0][d];
if(f instanceof THREE.Face3)b(this,f.a,f.b,f.c,0,1,2);else if(f instanceof THREE.Face4){b(this,f.a,f.b,f.c,0,1,2);b(this,f.a,f.b,f.d,0,1,3)}}var ha=["a","b","c","d"];d=0;for(c=this.faces.length;d<c;d++){f=this.faces[d];for(e=0;e<f.vertexNormals.length;e++){oa.copy(f.vertexNormals[e]);g=f[ha[e]];M=N[g];ia.copy(M);ia.subSelf(oa.multiplyScalar(oa.dot(M))).normalize();Z.cross(f.vertexNormals[e],M);g=Z.dot(K[g]);g=g<0?-1:1;f.vertexTangents[e]=new THREE.Vector4(ia.x,ia.y,ia.z,g)}}this.hasTangents=!0},computeBoundingBox:function(){var b;
if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var d=1,c=this.vertices.length;d<c;d++){b=this.vertices[d];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;
else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,d=0,c=this.vertices.length;d<c;d++)b=Math.max(b,this.vertices[d].position.length());this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(m,n){return Math.min(m,
n)+"_"+Math.max(m,n)}function d(m,n,p){if(m[n]===undefined){m[n]={set:{},array:[]};m[n].set[p]=1;m[n].array.push(p)}else if(m[n].set[p]===undefined){m[n].set[p]=1;m[n].array.push(p)}}var c,e,g,f,j,h={};c=0;for(e=this.faces.length;c<e;c++){j=this.faces[c];if(j instanceof THREE.Face3){g=b(j.a,j.b);d(h,g,c);g=b(j.b,j.c);d(h,g,c);g=b(j.a,j.c);d(h,g,c)}else if(j instanceof THREE.Face4){g=b(j.b,j.d);d(h,g,c);g=b(j.a,j.b);d(h,g,c);g=b(j.a,j.d);d(h,g,c);g=b(j.b,j.c);d(h,g,c);g=b(j.c,j.d);d(h,g,c)}}c=0;for(e=
this.edges.length;c<e;c++){j=this.edges[c];g=j.vertexIndices[0];f=j.vertexIndices[1];j.faceIndices=h[b(g,f)].array;for(g=0;g<j.faceIndices.length;g++){f=j.faceIndices[g];j.faces.push(this.faces[f])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function d(u,w,x,D,z,I,B){u=(x-u)*0.5;D=(D-w)*0.5;return(2*(w-x)+u+D)*B+(-3*(w-x)-2*u-D)*I+u*z+w}this.points=b;var c=[],e={x:0,y:0,z:0},g,f,j,h,m,n,p,t,v;this.initFromArray=function(u){this.points=[];for(var w=0;w<u.length;w++)this.points[w]={x:u[w][0],y:u[w][1],z:u[w][2]}};this.getPoint=function(u){g=(this.points.length-1)*u;f=Math.floor(g);j=g-f;c[0]=f==0?f:f-1;c[1]=f;c[2]=f>this.points.length-2?f:f+1;c[3]=f>this.points.length-3?f:f+2;n=this.points[c[0]];p=this.points[c[1]];
t=this.points[c[2]];v=this.points[c[3]];h=j*j;m=j*h;e.x=d(n.x,p.x,t.x,v.x,j,h,m);e.y=d(n.y,p.y,t.y,v.y,j,h,m);e.z=d(n.z,p.z,t.z,v.z,j,h,m);return e};this.getControlPointsArray=function(){var u,w,x=this.points.length,D=[];for(u=0;u<x;u++){w=this.points[u];D[u]=[w.x,w.y,w.z]}return D};this.getLength=function(u){var w,x,D=0,z=new THREE.Vector3,I=new THREE.Vector3,B=[],L=0;B[0]=0;u||(u=100);x=this.points.length*u;z.copy(this.points[0]);for(u=1;u<x;u++){w=u/x;position=this.getPoint(w);I.copy(position);
L+=I.distanceTo(z);z.copy(position);w*=this.points.length-1;w=Math.floor(w);if(w!=D){B[w]=L;D=w}}B[B.length]=L;return{chunks:B,total:L}};this.reparametrizeByArcLength=function(u){var w,x,D,z,I,B,L=[],A=new THREE.Vector3,C=this.getLength();L.push(A.copy(this.points[0]).clone());for(w=1;w<this.points.length;w++){x=C.chunks[w]-C.chunks[w-1];B=Math.ceil(u*x/C.total);z=(w-1)/(this.points.length-1);I=w/(this.points.length-1);for(x=1;x<B-1;x++){D=z+x*(1/B)*(I-z);position=this.getPoint(D);L.push(A.copy(position).clone())}L.push(A.copy(this.points[w]).clone())}this.points=
L}};THREE.Edge=function(b,d,c,e){this.vertices=[b,d];this.vertexIndices=[c,e];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,d,c,e,g){THREE.Object3D.call(this);this.fov=b||50;this.aspect=d||1;this.near=c||0.1;this.far=e||2E3;this.target=g||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,d){this.matrix.rotateAxis(d);this.position.addSelf(d.multiplyScalar(b));this.target.position.addSelf(d.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,d,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);d=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;d=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,d,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,d,c,e){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=d||1;this.distance=c||0;this.castShadow=e!==undefined?e:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,d,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=d||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,d,c,e){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,d,c,e)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,d,c,e){d===undefined&&(d=-1);c===undefined&&(c=0);if(e===undefined)e=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:d,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:e})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,d=this.lensFlares.length,c,e=-this.positionScreen.x*2,g=-this.positionScreen.y*2;for(b=0;b<d;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+e*c.distance;c.y=this.positionScreen.y+g*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ParticleCanvasMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.program=b.program!==undefined?b.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(b){THREE.Material.call(this);this.domElement=b};
THREE.Texture=function(b,d,c,e,g,f){this.image=b;this.mapping=d!==undefined?d:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=e!==undefined?e:THREE.ClampToEdgeWrapping;this.magFilter=g!==undefined?g:THREE.LinearFilter;this.minFilter=f!==undefined?f:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.materials=b instanceof Array?b:[b]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(b,d){THREE.Object3D.call(this);this.geometry=b;this.materials=d instanceof Array?d:[d];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;
THREE.Line=function(b,d,c){THREE.Object3D.call(this);this.geometry=b;this.materials=d instanceof Array?d:[d];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,d){THREE.Object3D.call(this);this.geometry=b;this.materials=d&&d.length?d:[d];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[c].name]=c}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,d,c){this.matrixAutoUpdate&&(d|=this.updateMatrix());if(d||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}var e,g=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(e=0;e<g;e++){b=this.children[e];b instanceof THREE.Bone?b.update(this.skinMatrix,d,c):b.update(this.matrixWorld,!0,c)}}else for(e=0;e<g;e++)this.children[e].update(this.skinMatrix,
d,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,d){THREE.Mesh.call(this,b,d);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,e,g,f,j,h;if(this.geometry.bones!==undefined){for(c=0;c<this.geometry.bones.length;c++){g=this.geometry.bones[c];f=g.pos;j=g.rotq;h=g.scl;e=this.addBone();e.name=g.name;e.position.set(f[0],f[1],f[2]);e.quaternion.set(j[0],j[1],j[2],j[3]);e.useQuaternion=!0;h!==undefined?e.scale.set(h[0],h[1],h[2]):e.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){g=this.geometry.bones[c];
e=this.bones[c];g.parent===-1?this.addChild(e):this.bones[g.parent].addChild(e)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,d,c){if(this.visible){this.matrixAutoUpdate&&(d|=this.updateMatrix());if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}var e,g=this.children.length;for(e=0;e<g;e++){b=this.children[e];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,d,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(d=0;d<c;d++)ba[d].skinMatrix.flattenToArrayOffset(bm,
d*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,d=[],c=0;c<this.bones.length;c++){b=this.bones[c];d.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var e;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var g=this.geometry.skinIndices[b].x,f=this.geometry.skinIndices[b].y;
e=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(d[g].multiplyVector3(e));e=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(d[f].multiplyVector3(e));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=c;this.geometry.skinWeights[b].y+=c}}}};
THREE.Ribbon=function(b,d){THREE.Object3D.call(this);this.geometry=b;this.materials=d instanceof Array?d:[d];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,d,c,e){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=d!==undefined?Math.abs(d):100;this.volume=Math.min(1,Math.max(0,c!==undefined?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=e!==undefined?e:!0;this.sources=b instanceof Array?b:[b];var g;c=this.sources.length;for(b=0;b<c;b++){d=this.sources[b];d.toLowerCase();if(d.indexOf(".mp3")!==-1)g=
"audio/mpeg";else if(d.indexOf(".ogg")!==-1)g="audio/ogg";else d.indexOf(".wav")!==-1&&(g="audio/wav");if(this.domElement.canPlayType(g)){g=document.createElement("source");g.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(g);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,d,c){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);d=!0}if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}var e=this.children.length;for(b=0;b<e;b++)this.children[b].update(this.matrixWorld,d,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,d){d===undefined&&(d=0);d=Math.abs(d);for(var c=0;c<this.LODs.length;c++)if(d<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:d,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,d,c){this.matrixAutoUpdate&&(d|=this.updateMatrix());if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var e=1;e<this.LODs.length;e++)if(b>=this.LODs[e].visibleAtDistance){this.LODs[e-1].object3D.visible=
!1;this.LODs[e].object3D.visible=!0}else break;for(;e<this.LODs.length;e++)this.LODs[e].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,d,c)};THREE.ShadowVolume=function(b,d){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,d?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,d?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,d,c,e,g,f,j,h,m,n,p,t,v,u,w=new THREE.Geometry;w.vertices=this.geometry.vertices;e=w.faces=this.geometry.faces;var x=w.egdes=this.geometry.edges,D=w.edgeFaces=[];g=0;var z=[];b=0;for(d=e.length;b<d;b++){c=e[b];z.push(g);g+=c instanceof THREE.Face3?3:4;c.vertexNormals[0]=c.normal;c.vertexNormals[1]=c.normal;c.vertexNormals[2]=c.normal;if(c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal}b=0;for(d=x.length;b<d;b++){h=x[b];c=h.faces[0];e=h.faces[1];g=h.faceIndices[0];f=h.faceIndices[1];j=h.vertexIndices[0];h=h.vertexIndices[1];if(c.a===j){m="a";p=z[g]+0}else if(c.b===j){m="b";p=z[g]+1}else if(c.c===j){m="c";p=z[g]+2}else if(c.d===j){m="d";p=z[g]+3}if(c.a===h){m+="a";t=z[g]+0}else if(c.b===h){m+="b";t=z[g]+1}else if(c.c===h){m+="c";t=z[g]+2}else if(c.d===h){m+="d";t=z[g]+3}if(e.a===j){n="a";v=z[f]+0}else if(e.b===j){n="b";v=z[f]+1}else if(e.c===j){n="c";v=z[f]+2}else if(e.d===
j){n="d";v=z[f]+3}if(e.a===h){n+="a";u=z[f]+0}else if(e.b===h){n+="b";u=z[f]+1}else if(e.c===h){n+="c";u=z[f]+2}else if(e.d===h){n+="d";u=z[f]+3}if(m==="ac"||m==="ad"||m==="ca"||m==="da"){if(p>t){c=p;p=t;t=c}}else if(p<t){c=p;p=t;t=c}if(n==="ac"||n==="ad"||n==="ca"||n==="da"){if(v>u){c=v;v=u;u=c}}else if(v<u){c=v;v=u;u=c}c=new THREE.Face4(p,t,v,u);c.normal.set(1,0,0);D.push(c)}this.geometry=w}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var d=this.geometry.vertices,c=this.geometry.faces,e=this.geometry.edgeFaces,g=b.faces;b=b.vertices;var f=g.length,j,h,m,n,p,t=["a","b","c","d"];for(m=0;m<f;m++){h=d.length;j=g[m];if(j instanceof THREE.Face4){n=4;h=new THREE.Face4(h,h+1,h+2,h+3)}else{n=3;h=new THREE.Face3(h,h+1,h+2)}h.normal.copy(j.normal);c.push(h);
for(h=0;h<n;h++){p=b[j[t[h]]];d.push(new THREE.Vertex(p.position.clone()))}}for(f=0;f<g.length-1;f++){b=c[f];for(j=f+1;j<g.length;j++){h=c[j];h=this.facesShareEdge(d,b,h);if(h!==undefined){h=new THREE.Face4(h.indices[0],h.indices[3],h.indices[2],h.indices[1]);h.normal.set(1,0,0);e.push(h)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,d,c){var e,g,f,j,h,m,n,p,t,v,u,w,x,D=0,z=["a","b","c","d"];e=d instanceof THREE.Face4?4:3;g=c instanceof THREE.Face4?4:3;for(w=0;w<e;w++){f=d[z[w]];h=b[f];for(x=0;x<g;x++){j=c[z[x]];m=b[j];if(Math.abs(h.position.x-m.position.x)<1.0E-4&&Math.abs(h.position.y-m.position.y)<1.0E-4&&Math.abs(h.position.z-m.position.z)<1.0E-4){D++;if(D===1){n=h;p=m;t=f;v=j;u=z[w]}if(D===2){u+=z[w];return u==="ad"||u==="ac"?{faces:[d,c],vertices:[n,p,m,h],indices:[t,
v,j,f],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[d,c],vertices:[n,h,m,p],indices:[t,f,j,v],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var d=0;d<b.children.length;d++)this.addChildRecurse(b.children[d])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var d=this.lights.indexOf(b);d!==-1&&this.lights.splice(d,1)}else if(b instanceof THREE.Sound){d=this.sounds.indexOf(b);d!==-1&&this.sounds.splice(d,1)}else if(!(b instanceof THREE.Camera)){d=this.objects.indexOf(b);if(d!==-1){this.objects.splice(d,1);this.__objectsRemoved.push(b)}}for(d=0;d<b.children.length;d++)this.removeChildRecurse(b.children[d])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,d,c){this.color=new THREE.Color(b);this.near=d||1;this.far=c||1E3};THREE.FogExp2=function(b,d){this.color=new THREE.Color(b);this.density=d!==undefined?d:2.5E-4};
THREE.Projector=function(){function b(){var ea=m[h]=m[h]||new THREE.RenderableVertex;h++;return ea}function d(ea,o){return o.z-ea.z}function c(ea,o){var ia=0,Z=1,oa=ea.z+ea.w,ha=o.z+o.w,X=-ea.z+ea.w,$=-o.z+o.w;if(oa>=0&&ha>=0&&X>=0&&$>=0)return!0;else if(oa<0&&ha<0||X<0&&$<0)return!1;else{if(oa<0)ia=Math.max(ia,oa/(oa-ha));else ha<0&&(Z=Math.min(Z,oa/(oa-ha)));if(X<0)ia=Math.max(ia,X/(X-$));else $<0&&(Z=Math.min(Z,X/(X-$)));if(Z<ia)return!1;else{ea.lerpSelf(o,ia);o.lerpSelf(ea,1-Z);return!0}}}var e,
g,f=[],j,h,m=[],n,p,t=[],v,u=[],w,x,D=[],z,I,B=[],L=new THREE.Vector4,A=new THREE.Vector4,C=new THREE.Matrix4,E=new THREE.Matrix4,M=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],N=new THREE.Vector4,K=new THREE.Vector4;this.projectVector=function(ea,o){C.multiply(o.projectionMatrix,o.matrixWorldInverse);C.multiplyVector3(ea);return ea};this.unprojectVector=function(ea,o){C.multiply(o.matrixWorld,THREE.Matrix4.makeInvert(o.projectionMatrix));
C.multiplyVector3(ea);return ea};this.projectObjects=function(ea,o,ia){o=[];var Z,oa,ha;g=0;oa=ea.objects;ea=0;for(Z=oa.length;ea<Z;ea++){ha=oa[ea];var X;if(!(X=!ha.visible))if(X=ha instanceof THREE.Mesh){a:{for(var $=ha.matrixWorld,na=-ha.geometry.boundingSphere.radius*Math.max(ha.scale.x,Math.max(ha.scale.y,ha.scale.z)),pa=0;pa<6;pa++){X=M[pa].x*$.n14+M[pa].y*$.n24+M[pa].z*$.n34+M[pa].w;if(X<=na){X=!1;break a}}X=!0}X=!X}if(!X){X=f[g]=f[g]||new THREE.RenderableObject;g++;e=X;L.copy(ha.position);
C.multiplyVector3(L);e.object=ha;e.z=L.z;o.push(e)}}ia&&o.sort(d);return o};this.projectScene=function(ea,o,ia){var Z=[],oa=o.near,ha=o.far,X,$,na,pa,ta,xa,ua,Ga,Ca,qa,za,Ka,Ta,Xa,Y,ka,aa;I=x=v=p=0;o.matrixAutoUpdate&&o.update(undefined,!0);ea.update(undefined,!1,o);C.multiply(o.projectionMatrix,o.matrixWorldInverse);M[0].set(C.n41-C.n11,C.n42-C.n12,C.n43-C.n13,C.n44-C.n14);M[1].set(C.n41+C.n11,C.n42+C.n12,C.n43+C.n13,C.n44+C.n14);M[2].set(C.n41+C.n21,C.n42+C.n22,C.n43+C.n23,C.n44+C.n24);M[3].set(C.n41-
C.n21,C.n42-C.n22,C.n43-C.n23,C.n44-C.n24);M[4].set(C.n41-C.n31,C.n42-C.n32,C.n43-C.n33,C.n44-C.n34);M[5].set(C.n41+C.n31,C.n42+C.n32,C.n43+C.n33,C.n44+C.n34);for(X=0;X<6;X++){Ca=M[X];Ca.divideScalar(Math.sqrt(Ca.x*Ca.x+Ca.y*Ca.y+Ca.z*Ca.z))}Ca=this.projectObjects(ea,o,!0);ea=0;for(X=Ca.length;ea<X;ea++){qa=Ca[ea].object;if(qa.visible){za=qa.matrixWorld;Ka=qa.matrixRotationWorld;Ta=qa.materials;Xa=qa.overdraw;h=0;if(qa instanceof THREE.Mesh){Y=qa.geometry;pa=Y.vertices;ka=Y.faces;Y=Y.faceVertexUvs;
$=0;for(na=pa.length;$<na;$++){j=b();j.positionWorld.copy(pa[$].position);za.multiplyVector3(j.positionWorld);j.positionScreen.copy(j.positionWorld);C.multiplyVector4(j.positionScreen);j.positionScreen.x/=j.positionScreen.w;j.positionScreen.y/=j.positionScreen.w;j.visible=j.positionScreen.z>oa&&j.positionScreen.z<ha}pa=0;for($=ka.length;pa<$;pa++){na=ka[pa];if(na instanceof THREE.Face3){ta=m[na.a];xa=m[na.b];ua=m[na.c];if(ta.visible&&xa.visible&&ua.visible&&(qa.doubleSided||qa.flipSided!=(ua.positionScreen.x-
ta.positionScreen.x)*(xa.positionScreen.y-ta.positionScreen.y)-(ua.positionScreen.y-ta.positionScreen.y)*(xa.positionScreen.x-ta.positionScreen.x)<0)){Ga=t[p]=t[p]||new THREE.RenderableFace3;p++;n=Ga;n.v1.copy(ta);n.v2.copy(xa);n.v3.copy(ua)}else continue}else if(na instanceof THREE.Face4){ta=m[na.a];xa=m[na.b];ua=m[na.c];Ga=m[na.d];if(ta.visible&&xa.visible&&ua.visible&&Ga.visible&&(qa.doubleSided||qa.flipSided!=((Ga.positionScreen.x-ta.positionScreen.x)*(xa.positionScreen.y-ta.positionScreen.y)-
(Ga.positionScreen.y-ta.positionScreen.y)*(xa.positionScreen.x-ta.positionScreen.x)<0||(xa.positionScreen.x-ua.positionScreen.x)*(Ga.positionScreen.y-ua.positionScreen.y)-(xa.positionScreen.y-ua.positionScreen.y)*(Ga.positionScreen.x-ua.positionScreen.x)<0))){aa=u[v]=u[v]||new THREE.RenderableFace4;v++;n=aa;n.v1.copy(ta);n.v2.copy(xa);n.v3.copy(ua);n.v4.copy(Ga)}else continue}n.normalWorld.copy(na.normal);Ka.multiplyVector3(n.normalWorld);n.centroidWorld.copy(na.centroid);za.multiplyVector3(n.centroidWorld);
n.centroidScreen.copy(n.centroidWorld);C.multiplyVector3(n.centroidScreen);ua=na.vertexNormals;ta=0;for(xa=ua.length;ta<xa;ta++){Ga=n.vertexNormalsWorld[ta];Ga.copy(ua[ta]);Ka.multiplyVector3(Ga)}ta=0;for(xa=Y.length;ta<xa;ta++)if(aa=Y[ta][pa]){ua=0;for(Ga=aa.length;ua<Ga;ua++)n.uvs[ta][ua]=aa[ua]}n.meshMaterials=Ta;n.faceMaterials=na.materials;n.overdraw=Xa;n.z=n.centroidScreen.z;Z.push(n)}}else if(qa instanceof THREE.Line){E.multiply(C,za);pa=qa.geometry.vertices;ta=b();ta.positionScreen.copy(pa[0].position);
E.multiplyVector4(ta.positionScreen);$=1;for(na=pa.length;$<na;$++){ta=b();ta.positionScreen.copy(pa[$].position);E.multiplyVector4(ta.positionScreen);xa=m[h-2];N.copy(ta.positionScreen);K.copy(xa.positionScreen);if(c(N,K)){N.multiplyScalar(1/N.w);K.multiplyScalar(1/K.w);za=D[x]=D[x]||new THREE.RenderableLine;x++;w=za;w.v1.positionScreen.copy(N);w.v2.positionScreen.copy(K);w.z=Math.max(N.z,K.z);w.materials=qa.materials;Z.push(w)}}}else if(qa instanceof THREE.Particle){A.set(qa.matrixWorld.n14,qa.matrixWorld.n24,
qa.matrixWorld.n34,1);C.multiplyVector4(A);A.z/=A.w;if(A.z>0&&A.z<1){za=B[I]=B[I]||new THREE.RenderableParticle;I++;z=za;z.x=A.x/A.w;z.y=A.y/A.w;z.z=A.z;z.rotation=qa.rotation.z;z.scale.x=qa.scale.x*Math.abs(z.x-(A.x+o.projectionMatrix.n11)/(A.w+o.projectionMatrix.n14));z.scale.y=qa.scale.y*Math.abs(z.y-(A.y+o.projectionMatrix.n22)/(A.w+o.projectionMatrix.n24));z.materials=qa.materials;Z.push(z)}}}}ia&&Z.sort(d);return Z}};
THREE.DOMRenderer=function(){THREE.Renderer.call(this);var b=null,d=new THREE.Projector,c,e,g,f;this.domElement=document.createElement("div");this.setSize=function(j,h){c=j;e=h;g=c/2;f=e/2};this.render=function(j,h){var m,n,p,t,v,u,w,x;b=d.projectScene(j,h);m=0;for(n=b.length;m<n;m++){v=b[m];if(v instanceof THREE.RenderableParticle){w=v.x*g+g;x=v.y*f+f;p=0;for(t=v.material.length;p<t;p++){u=v.material[p];if(u instanceof THREE.ParticleDOMMaterial){u=u.domElement;u.style.left=w+"px";u.style.top=x+"px"}}}}}};
THREE.CanvasRenderer=function(){function b(wa){if(D!=wa)u.globalAlpha=D=wa}function d(wa){if(z!=wa){switch(wa){case THREE.NormalBlending:u.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:u.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:u.globalCompositeOperation="darker"}z=wa}}function c(wa){if(I!=wa.hex){I=wa.hex;u.strokeStyle="#"+g(I.toString(16))}}function e(wa){if(B!=wa.hex){B=wa.hex;u.fillStyle="#"+g(B.toString(16))}}function g(wa){for(;wa.length<
6;)wa="0"+wa;return wa}var f=this,j=null,h=new THREE.Projector,m=document.createElement("canvas"),n,p,t,v,u=m.getContext("2d"),w=new THREE.Color(0),x=0,D=1,z=0,I=null,B=null,L=null,A=null,C=null,E,M,N,K,ea=new THREE.RenderableVertex,o=new THREE.RenderableVertex,ia,Z,oa,ha,X,$,na,pa,ta,xa,ua,Ga,Ca=new THREE.Color(0),qa=new THREE.Color(0),za=new THREE.Color(0),Ka=new THREE.Color(0),Ta=new THREE.Color(0),Xa,Y,ka,aa,ca,Na,bb,y,O,G,H=new THREE.Rectangle,J=new THREE.Rectangle,S=new THREE.Rectangle,U=!1,
Q=new THREE.Color,W=new THREE.Color,R=new THREE.Color,V=new THREE.Color,T=new THREE.Vector3,la,ja,Da,Ia,Fa,Ma,Ya=16;la=document.createElement("canvas");la.width=la.height=2;ja=la.getContext("2d");ja.fillStyle="rgba(0,0,0,1)";ja.fillRect(0,0,2,2);Da=ja.getImageData(0,0,2,2);Ia=Da.data;Fa=document.createElement("canvas");Fa.width=Fa.height=Ya;Ma=Fa.getContext("2d");Ma.translate(-Ya/2,-Ya/2);Ma.scale(Ya,Ya);Ya--;this.domElement=m;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,
faces:0};this.setSize=function(wa,Ba){n=wa;p=Ba;t=n/2;v=p/2;m.width=n;m.height=p;H.set(-t,-v,t,v);D=1;z=0;C=A=L=B=I=null};this.setClearColor=function(wa,Ba){w=wa;x=Ba};this.setClearColorHex=function(wa,Ba){w.setHex(wa);x=Ba};this.clear=function(){u.setTransform(1,0,0,-1,t,v);if(!J.isEmpty()){J.inflate(1);J.minSelf(H);if(w.hex==0&&x==0)u.clearRect(J.getX(),J.getY(),J.getWidth(),J.getHeight());else{d(THREE.NormalBlending);b(1);u.fillStyle="rgba("+Math.floor(w.r*255)+","+Math.floor(w.g*255)+","+Math.floor(w.b*
255)+","+x+")";u.fillRect(J.getX(),J.getY(),J.getWidth(),J.getHeight())}J.empty()}};this.render=function(wa,Ba){function Ha(da){var va,ra,ma,Aa=da.lights;W.setRGB(0,0,0);R.setRGB(0,0,0);V.setRGB(0,0,0);da=0;for(va=Aa.length;da<va;da++){ra=Aa[da];ma=ra.color;if(ra instanceof THREE.AmbientLight){W.r+=ma.r;W.g+=ma.g;W.b+=ma.b}else if(ra instanceof THREE.DirectionalLight){R.r+=ma.r;R.g+=ma.g;R.b+=ma.b}else if(ra instanceof THREE.PointLight){V.r+=ma.r;V.g+=ma.g;V.b+=ma.b}}}function Qa(da,va,ra,ma){var Aa,
Oa,ya,fa,La=da.lights;da=0;for(Aa=La.length;da<Aa;da++){Oa=La[da];ya=Oa.color;if(Oa instanceof THREE.DirectionalLight){fa=ra.dot(Oa.position);if(!(fa<=0)){fa*=Oa.intensity;ma.r+=ya.r*fa;ma.g+=ya.g*fa;ma.b+=ya.b*fa}}else if(Oa instanceof THREE.PointLight){fa=ra.dot(T.sub(Oa.position,va).normalize());if(!(fa<=0)){fa*=Oa.distance==0?1:1-Math.min(va.distanceTo(Oa.position)/Oa.distance,1);if(fa!=0){fa*=Oa.intensity;ma.r+=ya.r*fa;ma.g+=ya.g*fa;ma.b+=ya.b*fa}}}}}function P(da,va,ra){b(ra.opacity);d(ra.blending);
var ma,Aa,Oa,ya,fa,La;if(ra instanceof THREE.ParticleBasicMaterial){if(ra.map){ya=ra.map.image;fa=ya.width>>1;La=ya.height>>1;ra=va.scale.x*t;Oa=va.scale.y*v;ma=ra*fa;Aa=Oa*La;S.set(da.x-ma,da.y-Aa,da.x+ma,da.y+Aa);if(H.instersects(S)){u.save();u.translate(da.x,da.y);u.rotate(-va.rotation);u.scale(ra,-Oa);u.translate(-fa,-La);u.drawImage(ya,0,0);u.restore()}}}else if(ra instanceof THREE.ParticleCanvasMaterial){ma=va.scale.x*t;Aa=va.scale.y*v;S.set(da.x-ma,da.y-Aa,da.x+ma,da.y+Aa);if(H.instersects(S)){c(ra.color);
e(ra.color);u.save();u.translate(da.x,da.y);u.rotate(-va.rotation);u.scale(ma,Aa);ra.program(u);u.restore()}}}function sa(da,va,ra,ma){b(ma.opacity);d(ma.blending);u.beginPath();u.moveTo(da.positionScreen.x,da.positionScreen.y);u.lineTo(va.positionScreen.x,va.positionScreen.y);u.closePath();if(ma instanceof THREE.LineBasicMaterial){da=ma.linewidth;if(L!=da)u.lineWidth=L=da;da=ma.linecap;if(A!=da)u.lineCap=A=da;da=ma.linejoin;if(C!=da)u.lineJoin=C=da;c(ma.color);u.stroke();S.inflate(ma.linewidth*2)}}
function F(da,va,ra,ma,Aa,Oa,ya,fa,La){f.data.vertices+=3;f.data.faces++;b(fa.opacity);d(fa.blending);ia=da.positionScreen.x;Z=da.positionScreen.y;oa=va.positionScreen.x;ha=va.positionScreen.y;X=ra.positionScreen.x;$=ra.positionScreen.y;hb(ia,Z,oa,ha,X,$);if(fa instanceof THREE.MeshBasicMaterial)if(fa.map){if(fa.map.mapping instanceof THREE.UVMapping){aa=ya.uvs[0];db(ia,Z,oa,ha,X,$,fa.map.image,aa[ma].u,aa[ma].v,aa[Aa].u,aa[Aa].v,aa[Oa].u,aa[Oa].v)}}else if(fa.envMap){if(fa.envMap.mapping instanceof
THREE.SphericalReflectionMapping){da=Ba.matrixWorldInverse;T.copy(ya.vertexNormalsWorld[0]);ca=(T.x*da.n11+T.y*da.n12+T.z*da.n13)*0.5+0.5;Na=-(T.x*da.n21+T.y*da.n22+T.z*da.n23)*0.5+0.5;T.copy(ya.vertexNormalsWorld[1]);bb=(T.x*da.n11+T.y*da.n12+T.z*da.n13)*0.5+0.5;y=-(T.x*da.n21+T.y*da.n22+T.z*da.n23)*0.5+0.5;T.copy(ya.vertexNormalsWorld[2]);O=(T.x*da.n11+T.y*da.n12+T.z*da.n13)*0.5+0.5;G=-(T.x*da.n21+T.y*da.n22+T.z*da.n23)*0.5+0.5;db(ia,Z,oa,ha,X,$,fa.envMap.image,ca,Na,bb,y,O,G)}}else fa.wireframe?
Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color);else if(fa instanceof THREE.MeshLambertMaterial){if(fa.map&&!fa.wireframe){if(fa.map.mapping instanceof THREE.UVMapping){aa=ya.uvs[0];db(ia,Z,oa,ha,X,$,fa.map.image,aa[ma].u,aa[ma].v,aa[Aa].u,aa[Aa].v,aa[Oa].u,aa[Oa].v)}d(THREE.SubtractiveBlending)}if(U)if(!fa.wireframe&&fa.shading==THREE.SmoothShading&&ya.vertexNormalsWorld.length==3){qa.r=za.r=Ka.r=W.r;qa.g=za.g=Ka.g=W.g;qa.b=za.b=Ka.b=W.b;Qa(La,ya.v1.positionWorld,
ya.vertexNormalsWorld[0],qa);Qa(La,ya.v2.positionWorld,ya.vertexNormalsWorld[1],za);Qa(La,ya.v3.positionWorld,ya.vertexNormalsWorld[2],Ka);Ta.r=(za.r+Ka.r)*0.5;Ta.g=(za.g+Ka.g)*0.5;Ta.b=(za.b+Ka.b)*0.5;ka=ab(qa,za,Ka,Ta);db(ia,Z,oa,ha,X,$,ka,0,0,1,0,0,1)}else{Q.r=W.r;Q.g=W.g;Q.b=W.b;Qa(La,ya.centroidWorld,ya.normalWorld,Q);Ca.r=Math.max(0,Math.min(fa.color.r*Q.r,1));Ca.g=Math.max(0,Math.min(fa.color.g*Q.g,1));Ca.b=Math.max(0,Math.min(fa.color.b*Q.b,1));Ca.updateHex();fa.wireframe?Ua(Ca,fa.wireframeLinewidth,
fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}else fa.wireframe?Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color)}else if(fa instanceof THREE.MeshDepthMaterial){Xa=Ba.near;Y=Ba.far;qa.r=qa.g=qa.b=1-$a(da.positionScreen.z,Xa,Y);za.r=za.g=za.b=1-$a(va.positionScreen.z,Xa,Y);Ka.r=Ka.g=Ka.b=1-$a(ra.positionScreen.z,Xa,Y);Ta.r=(za.r+Ka.r)*0.5;Ta.g=(za.g+Ka.g)*0.5;Ta.b=(za.b+Ka.b)*0.5;ka=ab(qa,za,Ka,Ta);db(ia,Z,oa,ha,X,$,ka,0,0,1,0,0,1)}else if(fa instanceof THREE.MeshNormalMaterial){Ca.r=
Pa(ya.normalWorld.x);Ca.g=Pa(ya.normalWorld.y);Ca.b=Pa(ya.normalWorld.z);Ca.updateHex();fa.wireframe?Ua(Ca,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}}function eb(da,va,ra,ma,Aa,Oa,ya,fa,La){f.data.vertices+=4;f.data.faces++;b(fa.opacity);d(fa.blending);if(fa.map||fa.envMap){F(da,va,ma,0,1,3,ya,fa,La);F(Aa,ra,Oa,1,2,3,ya,fa,La)}else{ia=da.positionScreen.x;Z=da.positionScreen.y;oa=va.positionScreen.x;ha=va.positionScreen.y;X=ra.positionScreen.x;$=ra.positionScreen.y;na=
ma.positionScreen.x;pa=ma.positionScreen.y;ta=Aa.positionScreen.x;xa=Aa.positionScreen.y;ua=Oa.positionScreen.x;Ga=Oa.positionScreen.y;if(fa instanceof THREE.MeshBasicMaterial){Va(ia,Z,oa,ha,X,$,na,pa);fa.wireframe?Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color)}else if(fa instanceof THREE.MeshLambertMaterial)if(U)if(!fa.wireframe&&fa.shading==THREE.SmoothShading&&ya.vertexNormalsWorld.length==4){qa.r=za.r=Ka.r=Ta.r=W.r;qa.g=za.g=Ka.g=Ta.g=W.g;qa.b=za.b=Ka.b=
Ta.b=W.b;Qa(La,ya.v1.positionWorld,ya.vertexNormalsWorld[0],qa);Qa(La,ya.v2.positionWorld,ya.vertexNormalsWorld[1],za);Qa(La,ya.v4.positionWorld,ya.vertexNormalsWorld[3],Ka);Qa(La,ya.v3.positionWorld,ya.vertexNormalsWorld[2],Ta);ka=ab(qa,za,Ka,Ta);hb(ia,Z,oa,ha,na,pa);db(ia,Z,oa,ha,na,pa,ka,0,0,1,0,0,1);hb(ta,xa,X,$,ua,Ga);db(ta,xa,X,$,ua,Ga,ka,1,0,1,1,0,1)}else{Q.r=W.r;Q.g=W.g;Q.b=W.b;Qa(La,ya.centroidWorld,ya.normalWorld,Q);Ca.r=Math.max(0,Math.min(fa.color.r*Q.r,1));Ca.g=Math.max(0,Math.min(fa.color.g*
Q.g,1));Ca.b=Math.max(0,Math.min(fa.color.b*Q.b,1));Ca.updateHex();Va(ia,Z,oa,ha,X,$,na,pa);fa.wireframe?Ua(Ca,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}else{Va(ia,Z,oa,ha,X,$,na,pa);fa.wireframe?Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color)}else if(fa instanceof THREE.MeshNormalMaterial){Ca.r=Pa(ya.normalWorld.x);Ca.g=Pa(ya.normalWorld.y);Ca.b=Pa(ya.normalWorld.z);Ca.updateHex();Va(ia,Z,oa,ha,X,$,na,pa);fa.wireframe?Ua(Ca,fa.wireframeLinewidth,
fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}else if(fa instanceof THREE.MeshDepthMaterial){Xa=Ba.near;Y=Ba.far;qa.r=qa.g=qa.b=1-$a(da.positionScreen.z,Xa,Y);za.r=za.g=za.b=1-$a(va.positionScreen.z,Xa,Y);Ka.r=Ka.g=Ka.b=1-$a(ma.positionScreen.z,Xa,Y);Ta.r=Ta.g=Ta.b=1-$a(ra.positionScreen.z,Xa,Y);ka=ab(qa,za,Ka,Ta);hb(ia,Z,oa,ha,na,pa);db(ia,Z,oa,ha,na,pa,ka,0,0,1,0,0,1);hb(ta,xa,X,$,ua,Ga);db(ta,xa,X,$,ua,Ga,ka,1,0,1,1,0,1)}}}function hb(da,va,ra,ma,Aa,Oa){u.beginPath();u.moveTo(da,va);u.lineTo(ra,
ma);u.lineTo(Aa,Oa);u.lineTo(da,va);u.closePath()}function Va(da,va,ra,ma,Aa,Oa,ya,fa){u.beginPath();u.moveTo(da,va);u.lineTo(ra,ma);u.lineTo(Aa,Oa);u.lineTo(ya,fa);u.lineTo(da,va);u.closePath()}function Ua(da,va,ra,ma){if(L!=va)u.lineWidth=L=va;if(A!=ra)u.lineCap=A=ra;if(C!=ma)u.lineJoin=C=ma;c(da);u.stroke();S.inflate(va*2)}function gb(da){e(da);u.fill()}function db(da,va,ra,ma,Aa,Oa,ya,fa,La,lb,Sa,jb,nb){var fb,kb;fb=ya.width-1;kb=ya.height-1;fa*=fb;La*=kb;lb*=fb;Sa*=kb;jb*=fb;nb*=kb;ra-=da;ma-=
va;Aa-=da;Oa-=va;lb-=fa;Sa-=La;jb-=fa;nb-=La;fb=lb*nb-jb*Sa;if(fb!=0){kb=1/fb;fb=(nb*ra-Sa*Aa)*kb;Sa=(nb*ma-Sa*Oa)*kb;ra=(lb*Aa-jb*ra)*kb;ma=(lb*Oa-jb*ma)*kb;da=da-fb*fa-ra*La;va=va-Sa*fa-ma*La;u.save();u.transform(fb,Sa,ra,ma,da,va);u.clip();u.drawImage(ya,0,0);u.restore()}}function ab(da,va,ra,ma){var Aa=~~(da.r*255),Oa=~~(da.g*255);da=~~(da.b*255);var ya=~~(va.r*255),fa=~~(va.g*255);va=~~(va.b*255);var La=~~(ra.r*255),lb=~~(ra.g*255);ra=~~(ra.b*255);var Sa=~~(ma.r*255),jb=~~(ma.g*255);ma=~~(ma.b*
255);Ia[0]=Aa<0?0:Aa>255?255:Aa;Ia[1]=Oa<0?0:Oa>255?255:Oa;Ia[2]=da<0?0:da>255?255:da;Ia[4]=ya<0?0:ya>255?255:ya;Ia[5]=fa<0?0:fa>255?255:fa;Ia[6]=va<0?0:va>255?255:va;Ia[8]=La<0?0:La>255?255:La;Ia[9]=lb<0?0:lb>255?255:lb;Ia[10]=ra<0?0:ra>255?255:ra;Ia[12]=Sa<0?0:Sa>255?255:Sa;Ia[13]=jb<0?0:jb>255?255:jb;Ia[14]=ma<0?0:ma>255?255:ma;ja.putImageData(Da,0,0);Ma.drawImage(la,0,0);return Fa}function $a(da,va,ra){da=(da-va)/(ra-va);return da*da*(3-2*da)}function Pa(da){da=(da+1)*0.5;return da<0?0:da>1?1:
da}function Za(da,va){var ra=va.x-da.x,ma=va.y-da.y,Aa=1/Math.sqrt(ra*ra+ma*ma);ra*=Aa;ma*=Aa;va.x+=ra;va.y+=ma;da.x-=ra;da.y-=ma}var Wa,ga,Ea,Ra,ib,mb,cb,Ja;this.autoClear?this.clear():u.setTransform(1,0,0,-1,t,v);f.data.vertices=0;f.data.faces=0;j=h.projectScene(wa,Ba,this.sortElements);(U=wa.lights.length>0)&&Ha(wa);Wa=0;for(ga=j.length;Wa<ga;Wa++){Ea=j[Wa];S.empty();if(Ea instanceof THREE.RenderableParticle){E=Ea;E.x*=t;E.y*=v;Ra=0;for(ib=Ea.materials.length;Ra<ib;){Ja=Ea.materials[Ra++];Ja.opacity!=
0&&P(E,Ea,Ja,wa)}}else if(Ea instanceof THREE.RenderableLine){E=Ea.v1;M=Ea.v2;E.positionScreen.x*=t;E.positionScreen.y*=v;M.positionScreen.x*=t;M.positionScreen.y*=v;S.addPoint(E.positionScreen.x,E.positionScreen.y);S.addPoint(M.positionScreen.x,M.positionScreen.y);if(H.instersects(S)){Ra=0;for(ib=Ea.materials.length;Ra<ib;){Ja=Ea.materials[Ra++];Ja.opacity!=0&&sa(E,M,Ea,Ja,wa)}}}else if(Ea instanceof THREE.RenderableFace3){E=Ea.v1;M=Ea.v2;N=Ea.v3;E.positionScreen.x*=t;E.positionScreen.y*=v;M.positionScreen.x*=
t;M.positionScreen.y*=v;N.positionScreen.x*=t;N.positionScreen.y*=v;if(Ea.overdraw){Za(E.positionScreen,M.positionScreen);Za(M.positionScreen,N.positionScreen);Za(N.positionScreen,E.positionScreen)}S.add3Points(E.positionScreen.x,E.positionScreen.y,M.positionScreen.x,M.positionScreen.y,N.positionScreen.x,N.positionScreen.y);if(H.instersects(S)){Ra=0;for(ib=Ea.meshMaterials.length;Ra<ib;){Ja=Ea.meshMaterials[Ra++];if(Ja instanceof THREE.MeshFaceMaterial){mb=0;for(cb=Ea.faceMaterials.length;mb<cb;)(Ja=
Ea.faceMaterials[mb++])&&Ja.opacity!=0&&F(E,M,N,0,1,2,Ea,Ja,wa)}else Ja.opacity!=0&&F(E,M,N,0,1,2,Ea,Ja,wa)}}}else if(Ea instanceof THREE.RenderableFace4){E=Ea.v1;M=Ea.v2;N=Ea.v3;K=Ea.v4;E.positionScreen.x*=t;E.positionScreen.y*=v;M.positionScreen.x*=t;M.positionScreen.y*=v;N.positionScreen.x*=t;N.positionScreen.y*=v;K.positionScreen.x*=t;K.positionScreen.y*=v;ea.positionScreen.copy(M.positionScreen);o.positionScreen.copy(K.positionScreen);if(Ea.overdraw){Za(E.positionScreen,M.positionScreen);Za(M.positionScreen,
K.positionScreen);Za(K.positionScreen,E.positionScreen);Za(N.positionScreen,ea.positionScreen);Za(N.positionScreen,o.positionScreen)}S.addPoint(E.positionScreen.x,E.positionScreen.y);S.addPoint(M.positionScreen.x,M.positionScreen.y);S.addPoint(N.positionScreen.x,N.positionScreen.y);S.addPoint(K.positionScreen.x,K.positionScreen.y);if(H.instersects(S)){Ra=0;for(ib=Ea.meshMaterials.length;Ra<ib;){Ja=Ea.meshMaterials[Ra++];if(Ja instanceof THREE.MeshFaceMaterial){mb=0;for(cb=Ea.faceMaterials.length;mb<
cb;)(Ja=Ea.faceMaterials[mb++])&&Ja.opacity!=0&&eb(E,M,N,K,ea,o,Ea,Ja,wa)}else Ja.opacity!=0&&eb(E,M,N,K,ea,o,Ea,Ja,wa)}}}J.addRectangle(S)}u.setTransform(1,0,0,1,0,0)}};
THREE.SVGRenderer=function(){function b($,na,pa){var ta,xa,ua,Ga;ta=0;for(xa=$.lights.length;ta<xa;ta++){ua=$.lights[ta];if(ua instanceof THREE.DirectionalLight){Ga=na.normalWorld.dot(ua.position)*ua.intensity;if(Ga>0){pa.r+=ua.color.r*Ga;pa.g+=ua.color.g*Ga;pa.b+=ua.color.b*Ga}}else if(ua instanceof THREE.PointLight){ea.sub(ua.position,na.centroidWorld);ea.normalize();Ga=na.normalWorld.dot(ea)*ua.intensity;if(Ga>0){pa.r+=ua.color.r*Ga;pa.g+=ua.color.g*Ga;pa.b+=ua.color.b*Ga}}}}function d($,na,pa,
ta,xa,ua){j.data.vertices+=3;j.data.faces++;Z=e(oa++);Z.setAttribute("d","M "+$.positionScreen.x+" "+$.positionScreen.y+" L "+na.positionScreen.x+" "+na.positionScreen.y+" L "+pa.positionScreen.x+","+pa.positionScreen.y+"z");if(xa instanceof THREE.MeshBasicMaterial)A.hex=xa.color.hex;else if(xa instanceof THREE.MeshLambertMaterial)if(L){C.r=E.r;C.g=E.g;C.b=E.b;b(ua,ta,C);A.r=Math.max(0,Math.min(xa.color.r*C.r,1));A.g=Math.max(0,Math.min(xa.color.g*C.g,1));A.b=Math.max(0,Math.min(xa.color.b*C.b,1));
A.updateHex()}else A.hex=xa.color.hex;else if(xa instanceof THREE.MeshDepthMaterial){K=1-xa.__2near/(xa.__farPlusNear-ta.z*xa.__farMinusNear);A.setRGB(K,K,K)}else xa instanceof THREE.MeshNormalMaterial&&A.setRGB(g(ta.normalWorld.x),g(ta.normalWorld.y),g(ta.normalWorld.z));xa.wireframe?Z.setAttribute("style","fill: none; stroke: #"+f(A.hex.toString(16))+"; stroke-width: "+xa.wireframeLinewidth+"; stroke-opacity: "+xa.opacity+"; stroke-linecap: "+xa.wireframeLinecap+"; stroke-linejoin: "+xa.wireframeLinejoin):
Z.setAttribute("style","fill: #"+f(A.hex.toString(16))+"; fill-opacity: "+xa.opacity);n.appendChild(Z)}function c($,na,pa,ta,xa,ua,Ga){j.data.vertices+=4;j.data.faces++;Z=e(oa++);Z.setAttribute("d","M "+$.positionScreen.x+" "+$.positionScreen.y+" L "+na.positionScreen.x+" "+na.positionScreen.y+" L "+pa.positionScreen.x+","+pa.positionScreen.y+" L "+ta.positionScreen.x+","+ta.positionScreen.y+"z");if(ua instanceof THREE.MeshBasicMaterial)A.hex=ua.color.hex;else if(ua instanceof THREE.MeshLambertMaterial)if(L){C.r=
E.r;C.g=E.g;C.b=E.b;b(Ga,xa,C);A.r=Math.max(0,Math.min(ua.color.r*C.r,1));A.g=Math.max(0,Math.min(ua.color.g*C.g,1));A.b=Math.max(0,Math.min(ua.color.b*C.b,1));A.updateHex()}else A.hex=ua.color.hex;else if(ua instanceof THREE.MeshDepthMaterial){K=1-ua.__2near/(ua.__farPlusNear-xa.z*ua.__farMinusNear);A.setRGB(K,K,K)}else ua instanceof THREE.MeshNormalMaterial&&A.setRGB(g(xa.normalWorld.x),g(xa.normalWorld.y),g(xa.normalWorld.z));ua.wireframe?Z.setAttribute("style","fill: none; stroke: #"+f(A.hex.toString(16))+
"; stroke-width: "+ua.wireframeLinewidth+"; stroke-opacity: "+ua.opacity+"; stroke-linecap: "+ua.wireframeLinecap+"; stroke-linejoin: "+ua.wireframeLinejoin):Z.setAttribute("style","fill: #"+f(A.hex.toString(16))+"; fill-opacity: "+ua.opacity);n.appendChild(Z)}function e($){if(o[$]==null){o[$]=document.createElementNS("http://www.w3.org/2000/svg","path");X==0&&o[$].setAttribute("shape-rendering","crispEdges")}return o[$]}function g($){$=($+1)*0.5;return $<0?0:$>1?1:$}function f($){for(;$.length<6;)$=
"0"+$;return $}var j=this,h=null,m=new THREE.Projector,n=document.createElementNS("http://www.w3.org/2000/svg","svg"),p,t,v,u,w,x,D,z,I=new THREE.Rectangle,B=new THREE.Rectangle,L=!1,A=new THREE.Color(16777215),C=new THREE.Color(16777215),E=new THREE.Color(0),M=new THREE.Color(0),N=new THREE.Color(0),K,ea=new THREE.Vector3,o=[],ia=[],Z,oa,ha,X=1;this.domElement=n;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,faces:0};this.setQuality=function($){switch($){case "high":X=
1;break;case "low":X=0}};this.setSize=function($,na){p=$;t=na;v=p/2;u=t/2;n.setAttribute("viewBox",-v+" "+-u+" "+p+" "+t);n.setAttribute("width",p);n.setAttribute("height",t);I.set(-v,-u,v,u)};this.clear=function(){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])};this.render=function($,na){var pa,ta,xa,ua,Ga,Ca,qa,za;this.autoClear&&this.clear();j.data.vertices=0;j.data.faces=0;h=m.projectScene($,na,this.sortElements);ha=oa=0;if(L=$.lights.length>0){qa=$.lights;E.setRGB(0,0,0);M.setRGB(0,
0,0);N.setRGB(0,0,0);pa=0;for(ta=qa.length;pa<ta;pa++){xa=qa[pa];ua=xa.color;if(xa instanceof THREE.AmbientLight){E.r+=ua.r;E.g+=ua.g;E.b+=ua.b}else if(xa instanceof THREE.DirectionalLight){M.r+=ua.r;M.g+=ua.g;M.b+=ua.b}else if(xa instanceof THREE.PointLight){N.r+=ua.r;N.g+=ua.g;N.b+=ua.b}}}pa=0;for(ta=h.length;pa<ta;pa++){qa=h[pa];B.empty();if(qa instanceof THREE.RenderableParticle){w=qa;w.x*=v;w.y*=-u;xa=0;for(ua=qa.materials.length;xa<ua;)xa++}else if(qa instanceof THREE.RenderableLine){w=qa.v1;
x=qa.v2;w.positionScreen.x*=v;w.positionScreen.y*=-u;x.positionScreen.x*=v;x.positionScreen.y*=-u;B.addPoint(w.positionScreen.x,w.positionScreen.y);B.addPoint(x.positionScreen.x,x.positionScreen.y);if(I.instersects(B)){xa=0;for(ua=qa.materials.length;xa<ua;)if((za=qa.materials[xa++])&&za.opacity!=0){Ga=w;Ca=x;var Ka=ha++;if(ia[Ka]==null){ia[Ka]=document.createElementNS("http://www.w3.org/2000/svg","line");X==0&&ia[Ka].setAttribute("shape-rendering","crispEdges")}Z=ia[Ka];Z.setAttribute("x1",Ga.positionScreen.x);
Z.setAttribute("y1",Ga.positionScreen.y);Z.setAttribute("x2",Ca.positionScreen.x);Z.setAttribute("y2",Ca.positionScreen.y);if(za instanceof THREE.LineBasicMaterial){Z.setAttribute("style","fill: none; stroke: ##"+f(za.color.hex.toString(16))+"; stroke-width: "+za.linewidth+"; stroke-opacity: "+za.opacity+"; stroke-linecap: "+za.linecap+"; stroke-linejoin: "+za.linejoin);n.appendChild(Z)}}}}else if(qa instanceof THREE.RenderableFace3){w=qa.v1;x=qa.v2;D=qa.v3;w.positionScreen.x*=v;w.positionScreen.y*=
-u;x.positionScreen.x*=v;x.positionScreen.y*=-u;D.positionScreen.x*=v;D.positionScreen.y*=-u;B.addPoint(w.positionScreen.x,w.positionScreen.y);B.addPoint(x.positionScreen.x,x.positionScreen.y);B.addPoint(D.positionScreen.x,D.positionScreen.y);if(I.instersects(B)){xa=0;for(ua=qa.meshMaterials.length;xa<ua;){za=qa.meshMaterials[xa++];if(za instanceof THREE.MeshFaceMaterial){Ga=0;for(Ca=qa.faceMaterials.length;Ga<Ca;)(za=qa.faceMaterials[Ga++])&&za.opacity!=0&&d(w,x,D,qa,za,$)}else za&&za.opacity!=0&&
d(w,x,D,qa,za,$)}}}else if(qa instanceof THREE.RenderableFace4){w=qa.v1;x=qa.v2;D=qa.v3;z=qa.v4;w.positionScreen.x*=v;w.positionScreen.y*=-u;x.positionScreen.x*=v;x.positionScreen.y*=-u;D.positionScreen.x*=v;D.positionScreen.y*=-u;z.positionScreen.x*=v;z.positionScreen.y*=-u;B.addPoint(w.positionScreen.x,w.positionScreen.y);B.addPoint(x.positionScreen.x,x.positionScreen.y);B.addPoint(D.positionScreen.x,D.positionScreen.y);B.addPoint(z.positionScreen.x,z.positionScreen.y);if(I.instersects(B)){xa=0;
for(ua=qa.meshMaterials.length;xa<ua;){za=qa.meshMaterials[xa++];if(za instanceof THREE.MeshFaceMaterial){Ga=0;for(Ca=qa.faceMaterials.length;Ga<Ca;)(za=qa.faceMaterials[Ga++])&&za.opacity!=0&&c(w,x,D,z,qa,za,$)}else za&&za.opacity!=0&&c(w,x,D,z,qa,za,$)}}}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",
envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",
map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var d,c,e,g={};for(d=0;d<b.length;d++){e=this.clone(b[d]);for(c in e)g[c]=e[c]}return g},clone:function(b){var d,c,e,g={};for(d in b){g[d]={};for(c in b[d]){e=b[d][c];g[d][c]=e instanceof THREE.Color||e instanceof THREE.Vector3||e instanceof THREE.Texture?e.clone():e}}return g}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function d(y,O,G){var H,J,S,U=y.vertices,Q=U.length,W=y.colors,R=W.length,V=y.__vertexArray,T=y.__colorArray,la=y.__sortArray,ja=y.__dirtyVertices,Da=y.__dirtyColors;if(G.sortParticles){za.multiplySelf(G.matrixWorld);for(H=0;H<Q;H++){J=U[H].position;Xa.copy(J);za.multiplyVector3(Xa);la[H]=[Xa.z,H]}la.sort(function(Ia,Fa){return Fa[0]-Ia[0]});for(H=0;H<Q;H++){J=U[la[H][1]].position;S=H*3;V[S]=J.x;V[S+1]=J.y;V[S+2]=J.z}for(H=0;H<R;H++){S=H*3;color=W[la[H][1]];T[S]=color.r;
T[S+1]=color.g;T[S+2]=color.b}}else{if(ja)for(H=0;H<Q;H++){J=U[H].position;S=H*3;V[S]=J.x;V[S+1]=J.y;V[S+2]=J.z}if(Da)for(H=0;H<R;H++){color=W[H];S=H*3;T[S]=color.r;T[S+1]=color.g;T[S+2]=color.b}}if(ja||G.sortParticles){o.bindBuffer(o.ARRAY_BUFFER,y.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,V,O)}if(Da||G.sortParticles){o.bindBuffer(o.ARRAY_BUFFER,y.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,T,O)}}function c(y,O,G,H,J){H.program||ea.initMaterial(H,O,G,J);var S=H.program,U=S.uniforms,Q=
H.uniforms;if(S!=oa){o.useProgram(S);oa=S}o.uniformMatrix4fv(U.projectionMatrix,!1,Ka);if(G&&(H instanceof THREE.MeshBasicMaterial||H instanceof THREE.MeshLambertMaterial||H instanceof THREE.MeshPhongMaterial||H instanceof THREE.LineBasicMaterial||H instanceof THREE.ParticleBasicMaterial||H.fog)){Q.fogColor.value=G.color;if(G instanceof THREE.Fog){Q.fogNear.value=G.near;Q.fogFar.value=G.far}else if(G instanceof THREE.FogExp2)Q.fogDensity.value=G.density}if(H instanceof THREE.MeshPhongMaterial||H instanceof
THREE.MeshLambertMaterial||H.lights){var W,R,V=0,T=0,la=0,ja,Da,Ia,Fa,Ma=Y,Ya=Ma.directional.colors,wa=Ma.directional.positions,Ba=Ma.point.colors,Ha=Ma.point.positions,Qa=Ma.point.distances,P=0,sa=0;G=0;for(W=O.length;G<W;G++){R=O[G];ja=R.color;Da=R.position;Ia=R.intensity;Fa=R.distance;if(R instanceof THREE.AmbientLight){V+=ja.r;T+=ja.g;la+=ja.b}else if(R instanceof THREE.DirectionalLight){Fa=P*3;Ya[Fa]=ja.r*Ia;Ya[Fa+1]=ja.g*Ia;Ya[Fa+2]=ja.b*Ia;wa[Fa]=Da.x;wa[Fa+1]=Da.y;wa[Fa+2]=Da.z;P+=1}else if(R instanceof
THREE.PointLight){R=sa*3;Ba[R]=ja.r*Ia;Ba[R+1]=ja.g*Ia;Ba[R+2]=ja.b*Ia;Ha[R]=Da.x;Ha[R+1]=Da.y;Ha[R+2]=Da.z;Qa[sa]=Fa;sa+=1}}for(G=P*3;G<Ya.length;G++)Ya[G]=0;for(G=sa*3;G<Ba.length;G++)Ba[G]=0;Ma.point.length=sa;Ma.directional.length=P;Ma.ambient[0]=V;Ma.ambient[1]=T;Ma.ambient[2]=la;G=Y;Q.enableLighting.value=G.directional.length+G.point.length;Q.ambientLightColor.value=G.ambient;Q.directionalLightColor.value=G.directional.colors;Q.directionalLightDirection.value=G.directional.positions;Q.pointLightColor.value=
G.point.colors;Q.pointLightPosition.value=G.point.positions;Q.pointLightDistance.value=G.point.distances}if(H instanceof THREE.MeshBasicMaterial||H instanceof THREE.MeshLambertMaterial||H instanceof THREE.MeshPhongMaterial){Q.diffuse.value=H.color;Q.opacity.value=H.opacity;Q.map.texture=H.map;Q.lightMap.texture=H.lightMap;Q.envMap.texture=H.envMap;Q.reflectivity.value=H.reflectivity;Q.refractionRatio.value=H.refractionRatio;Q.combine.value=H.combine;Q.useRefract.value=H.envMap&&H.envMap.mapping instanceof
THREE.CubeRefractionMapping}if(H instanceof THREE.LineBasicMaterial){Q.diffuse.value=H.color;Q.opacity.value=H.opacity}else if(H instanceof THREE.ParticleBasicMaterial){Q.psColor.value=H.color;Q.opacity.value=H.opacity;Q.size.value=H.size;Q.scale.value=ia.height/2;Q.map.texture=H.map}else if(H instanceof THREE.MeshPhongMaterial){Q.ambient.value=H.ambient;Q.specular.value=H.specular;Q.shininess.value=H.shininess}else if(H instanceof THREE.MeshDepthMaterial){Q.mNear.value=y.near;Q.mFar.value=y.far;
Q.opacity.value=H.opacity}else if(H instanceof THREE.MeshNormalMaterial)Q.opacity.value=H.opacity;for(var F in Q)if(T=S.uniforms[F]){W=Q[F];V=W.type;G=W.value;if(V=="i")o.uniform1i(T,G);else if(V=="f")o.uniform1f(T,G);else if(V=="fv1")o.uniform1fv(T,G);else if(V=="fv")o.uniform3fv(T,G);else if(V=="v2")o.uniform2f(T,G.x,G.y);else if(V=="v3")o.uniform3f(T,G.x,G.y,G.z);else if(V=="v4")o.uniform4f(T,G.x,G.y,G.z,G.w);else if(V=="c")o.uniform3f(T,G.r,G.g,G.b);else if(V=="t"){o.uniform1i(T,G);if(W=W.texture)if(W.image instanceof
Array&&W.image.length==6){if(W.image.length==6){if(W.needsUpdate){if(W.__webglInit){o.bindTexture(o.TEXTURE_CUBE_MAP,W.image.__webglTextureCube);for(V=0;V<6;++V)o.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+V,0,0,0,o.RGBA,o.UNSIGNED_BYTE,W.image[V])}else{W.image.__webglTextureCube=o.createTexture();o.bindTexture(o.TEXTURE_CUBE_MAP,W.image.__webglTextureCube);for(V=0;V<6;++V)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+V,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,W.image[V]);W.__webglInit=!0}A(o.TEXTURE_CUBE_MAP,
W,W.image[0]);o.bindTexture(o.TEXTURE_CUBE_MAP,null);W.needsUpdate=!1}o.activeTexture(o.TEXTURE0+G);o.bindTexture(o.TEXTURE_CUBE_MAP,W.image.__webglTextureCube)}}else C(W,G)}}o.uniformMatrix4fv(U.modelViewMatrix,!1,J._modelViewMatrixArray);o.uniformMatrix3fv(U.normalMatrix,!1,J._normalMatrixArray);(H instanceof THREE.MeshShaderMaterial||H instanceof THREE.MeshPhongMaterial||H.envMap)&&U.cameraPosition!==null&&o.uniform3f(U.cameraPosition,y.position.x,y.position.y,y.position.z);(H instanceof THREE.MeshShaderMaterial||
H.envMap||H.skinning)&&U.objectMatrix!==null&&o.uniformMatrix4fv(U.objectMatrix,!1,J._objectMatrixArray);(H instanceof THREE.MeshPhongMaterial||H instanceof THREE.MeshLambertMaterial||H instanceof THREE.MeshShaderMaterial||H.skinning)&&U.viewMatrix!==null&&o.uniformMatrix4fv(U.viewMatrix,!1,Ta);if(H instanceof THREE.ShadowVolumeDynamicMaterial){y=Q.directionalLightDirection.value;y[0]=-O[1].position.x;y[1]=-O[1].position.y;y[2]=-O[1].position.z;o.uniform3fv(U.directionalLightDirection,y);o.uniformMatrix4fv(U.objectMatrix,
!1,J._objectMatrixArray);o.uniformMatrix4fv(U.viewMatrix,!1,Ta)}if(H.skinning){o.uniformMatrix4fv(U.cameraInverseMatrix,!1,Ta);o.uniformMatrix4fv(U.boneGlobalMatrices,!1,J.boneMatrices)}return S}function e(y,O,G,H,J,S){if(H.opacity!=0){var U;y=c(y,O,G,H,S).attributes;if(!H.morphTargets&&y.position>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglVertexBuffer);o.vertexAttribPointer(y.position,3,o.FLOAT,!1,0,0)}else{O=H.program.attributes;if(S.morphTargetBase!==-1){o.bindBuffer(o.ARRAY_BUFFER,J.__webglMorphTargetsBuffers[S.morphTargetBase]);
o.vertexAttribPointer(O.position,3,o.FLOAT,!1,0,0)}else if(O.position>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglVertexBuffer);o.vertexAttribPointer(O.position,3,o.FLOAT,!1,0,0)}if(S.morphTargetForcedOrder.length){G=0;for(var Q=S.morphTargetForcedOrder,W=S.morphTargetInfluences;G<H.numSupportedMorphTargets&&G<Q.length;){o.bindBuffer(o.ARRAY_BUFFER,J.__webglMorphTargetsBuffers[Q[G]]);o.vertexAttribPointer(O["morphTarget"+G],3,o.FLOAT,!1,0,0);S.__webglMorphTargetInfluences[G]=W[Q[G]];G++}}else{Q=[];var R=
-1,V=0;W=S.morphTargetInfluences;var T,la=W.length;G=0;for(S.morphTargetBase!==-1&&(Q[S.morphTargetBase]=!0);G<H.numSupportedMorphTargets;){for(T=0;T<la;T++)if(!Q[T]&&W[T]>R){V=T;R=W[V]}o.bindBuffer(o.ARRAY_BUFFER,J.__webglMorphTargetsBuffers[V]);o.vertexAttribPointer(O["morphTarget"+G],3,o.FLOAT,!1,0,0);S.__webglMorphTargetInfluences[G]=R;Q[V]=1;R=-1;G++}}H.program.uniforms.morphTargetInfluences!==null&&o.uniform1fv(H.program.uniforms.morphTargetInfluences,S.__webglMorphTargetInfluences)}if(H.attributes)for(U in H.attributes)if(y[U]>=
0){O=H.attributes[U];o.bindBuffer(o.ARRAY_BUFFER,O.buffer);o.vertexAttribPointer(y[U],O.size,o.FLOAT,!1,0,0)}if(y.color>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglColorBuffer);o.vertexAttribPointer(y.color,3,o.FLOAT,!1,0,0)}if(y.normal>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglNormalBuffer);o.vertexAttribPointer(y.normal,3,o.FLOAT,!1,0,0)}if(y.tangent>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglTangentBuffer);o.vertexAttribPointer(y.tangent,4,o.FLOAT,!1,0,0)}if(y.uv>=0)if(J.__webglUVBuffer){o.bindBuffer(o.ARRAY_BUFFER,
J.__webglUVBuffer);o.vertexAttribPointer(y.uv,2,o.FLOAT,!1,0,0);o.enableVertexAttribArray(y.uv)}else o.disableVertexAttribArray(y.uv);if(y.uv2>=0)if(J.__webglUV2Buffer){o.bindBuffer(o.ARRAY_BUFFER,J.__webglUV2Buffer);o.vertexAttribPointer(y.uv2,2,o.FLOAT,!1,0,0);o.enableVertexAttribArray(y.uv2)}else o.disableVertexAttribArray(y.uv2);if(H.skinning&&y.skinVertexA>=0&&y.skinVertexB>=0&&y.skinIndex>=0&&y.skinWeight>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinVertexABuffer);o.vertexAttribPointer(y.skinVertexA,
4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinVertexBBuffer);o.vertexAttribPointer(y.skinVertexB,4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinIndicesBuffer);o.vertexAttribPointer(y.skinIndex,4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinWeightsBuffer);o.vertexAttribPointer(y.skinWeight,4,o.FLOAT,!1,0,0)}if(S instanceof THREE.Mesh){if(H.wireframe){o.lineWidth(H.wireframeLinewidth);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,J.__webglLineBuffer);o.drawElements(o.LINES,
J.__webglLineCount,o.UNSIGNED_SHORT,0)}else{o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,J.__webglFaceBuffer);o.drawElements(o.TRIANGLES,J.__webglFaceCount,o.UNSIGNED_SHORT,0)}ea.data.vertices+=J.__webglFaceCount;ea.data.faces+=J.__webglFaceCount/3;ea.data.drawCalls++}else if(S instanceof THREE.Line){S=S.type==THREE.LineStrip?o.LINE_STRIP:o.LINES;o.lineWidth(H.linewidth);o.drawArrays(S,0,J.__webglLineCount);ea.data.drawCalls++}else if(S instanceof THREE.ParticleSystem){o.drawArrays(o.POINTS,0,J.__webglParticleCount);
ea.data.drawCalls++}else if(S instanceof THREE.Ribbon){o.drawArrays(o.TRIANGLE_STRIP,0,J.__webglVertexCount);ea.data.drawCalls++}}}function g(y,O,G){if(!y.__webglVertexBuffer)y.__webglVertexBuffer=o.createBuffer();if(!y.__webglNormalBuffer)y.__webglNormalBuffer=o.createBuffer();if(y.hasPos){o.bindBuffer(o.ARRAY_BUFFER,y.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,y.positionArray,o.DYNAMIC_DRAW);o.enableVertexAttribArray(O.attributes.position);o.vertexAttribPointer(O.attributes.position,3,o.FLOAT,
!1,0,0)}if(y.hasNormal){o.bindBuffer(o.ARRAY_BUFFER,y.__webglNormalBuffer);if(G==THREE.FlatShading){var H,J,S,U,Q,W,R,V,T,la,ja=y.count*3;for(la=0;la<ja;la+=9){G=y.normalArray;H=G[la];J=G[la+1];S=G[la+2];U=G[la+3];W=G[la+4];V=G[la+5];Q=G[la+6];R=G[la+7];T=G[la+8];H=(H+U+Q)/3;J=(J+W+R)/3;S=(S+V+T)/3;G[la]=H;G[la+1]=J;G[la+2]=S;G[la+3]=H;G[la+4]=J;G[la+5]=S;G[la+6]=H;G[la+7]=J;G[la+8]=S}}o.bufferData(o.ARRAY_BUFFER,y.normalArray,o.DYNAMIC_DRAW);o.enableVertexAttribArray(O.attributes.normal);o.vertexAttribPointer(O.attributes.normal,
3,o.FLOAT,!1,0,0)}o.drawArrays(o.TRIANGLES,0,y.count);y.count=0}function f(y){if($!=y.doubleSided){y.doubleSided?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE);$=y.doubleSided}if(na!=y.flipSided){y.flipSided?o.frontFace(o.CW):o.frontFace(o.CCW);na=y.flipSided}}function j(y){if(ta!=y){y?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST);ta=y}}function h(y){qa[0].set(y.n41-y.n11,y.n42-y.n12,y.n43-y.n13,y.n44-y.n14);qa[1].set(y.n41+y.n11,y.n42+y.n12,y.n43+y.n13,y.n44+y.n14);qa[2].set(y.n41+y.n21,y.n42+y.n22,
y.n43+y.n23,y.n44+y.n24);qa[3].set(y.n41-y.n21,y.n42-y.n22,y.n43-y.n23,y.n44-y.n24);qa[4].set(y.n41-y.n31,y.n42-y.n32,y.n43-y.n33,y.n44-y.n34);qa[5].set(y.n41+y.n31,y.n42+y.n32,y.n43+y.n33,y.n44+y.n34);var O;for(y=0;y<6;y++){O=qa[y];O.divideScalar(Math.sqrt(O.x*O.x+O.y*O.y+O.z*O.z))}}function m(y){for(var O=y.matrixWorld,G=-y.geometry.boundingSphere.radius*Math.max(y.scale.x,Math.max(y.scale.y,y.scale.z)),H=0;H<6;H++){y=qa[H].x*O.n14+qa[H].y*O.n24+qa[H].z*O.n34+qa[H].w;if(y<=G)return!1}return!0}function n(y,
O){y.list[y.count]=O;y.count+=1}function p(y){var O,G,H=y.object,J=y.opaque,S=y.transparent;S.count=0;y=J.count=0;for(O=H.materials.length;y<O;y++){G=H.materials[y];G.transparent?n(S,G):n(J,G)}}function t(y){var O,G,H,J,S=y.object,U=y.buffer,Q=y.opaque,W=y.transparent;W.count=0;y=Q.count=0;for(H=S.materials.length;y<H;y++){O=S.materials[y];if(O instanceof THREE.MeshFaceMaterial){O=0;for(G=U.materials.length;O<G;O++)(J=U.materials[O])&&(J.transparent?n(W,J):n(Q,J))}else(J=O)&&(J.transparent?n(W,J):
n(Q,J))}}function v(y,O){return O.z-y.z}function u(y){o.enable(o.POLYGON_OFFSET_FILL);o.polygonOffset(0.1,1);o.enable(o.STENCIL_TEST);o.enable(o.DEPTH_TEST);o.depthMask(!1);o.colorMask(!1,!1,!1,!1);o.stencilFunc(o.ALWAYS,1,255);o.stencilOpSeparate(o.BACK,o.KEEP,o.INCR,o.KEEP);o.stencilOpSeparate(o.FRONT,o.KEEP,o.DECR,o.KEEP);var O,G=y.lights.length,H,J=y.lights,S=[],U,Q,W,R,V,T=y.__webglShadowVolumes.length;for(O=0;O<G;O++){H=y.lights[O];if(H instanceof THREE.DirectionalLight&&H.castShadow){S[0]=
-H.position.x;S[1]=-H.position.y;S[2]=-H.position.z;for(V=0;V<T;V++){H=y.__webglShadowVolumes[V].object;U=y.__webglShadowVolumes[V].buffer;Q=H.materials[0];Q.program||ea.initMaterial(Q,J,undefined,H);Q=Q.program;W=Q.uniforms;R=Q.attributes;if(oa!==Q){o.useProgram(Q);oa=Q;o.uniformMatrix4fv(W.projectionMatrix,!1,Ka);o.uniformMatrix4fv(W.viewMatrix,!1,Ta);o.uniform3fv(W.directionalLightDirection,S)}H.matrixWorld.flattenToArray(H._objectMatrixArray);o.uniformMatrix4fv(W.objectMatrix,!1,H._objectMatrixArray);
o.bindBuffer(o.ARRAY_BUFFER,U.__webglVertexBuffer);o.vertexAttribPointer(R.position,3,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,U.__webglNormalBuffer);o.vertexAttribPointer(R.normal,3,o.FLOAT,!1,0,0);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,U.__webglFaceBuffer);o.cullFace(o.FRONT);o.drawElements(o.TRIANGLES,U.__webglFaceCount,o.UNSIGNED_SHORT,0);o.cullFace(o.BACK);o.drawElements(o.TRIANGLES,U.__webglFaceCount,o.UNSIGNED_SHORT,0)}}}o.disable(o.POLYGON_OFFSET_FILL);o.colorMask(!0,!0,!0,!0);o.stencilFunc(o.NOTEQUAL,
0,255);o.stencilOp(o.KEEP,o.KEEP,o.KEEP);o.disable(o.DEPTH_TEST);pa="";oa=aa.program;o.useProgram(aa.program);o.uniformMatrix4fv(aa.projectionLocation,!1,Ka);o.uniform1f(aa.darknessLocation,aa.darkness);o.bindBuffer(o.ARRAY_BUFFER,aa.vertexBuffer);o.vertexAttribPointer(aa.vertexLocation,3,o.FLOAT,!1,0,0);o.enableVertexAttribArray(aa.vertexLocation);o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA);o.blendEquation(o.FUNC_ADD);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,aa.elementBuffer);o.drawElements(o.TRIANGLES,
6,o.UNSIGNED_SHORT,0);o.disable(o.STENCIL_TEST);o.enable(o.DEPTH_TEST);o.depthMask(X)}function w(y,O){var G,H,J;G=_sprite.attributes;var S=_sprite.uniforms,U=Ca/Ga,Q,W=[],R=Ga*0.5,V=Ca*0.5,T=!0;o.useProgram(_sprite.program);oa=_sprite.program;pa="";if(!bb){o.enableVertexAttribArray(_sprite.attributes.position);o.enableVertexAttribArray(_sprite.attributes.uv);bb=!0}o.disable(o.CULL_FACE);o.enable(o.BLEND);o.depthMask(!0);o.bindBuffer(o.ARRAY_BUFFER,_sprite.vertexBuffer);o.vertexAttribPointer(G.position,
2,o.FLOAT,!1,16,0);o.vertexAttribPointer(G.uv,2,o.FLOAT,!1,16,8);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);o.uniformMatrix4fv(S.projectionMatrix,!1,Ka);o.activeTexture(o.TEXTURE0);o.uniform1i(S.map,0);G=0;for(H=y.__webglSprites.length;G<H;G++){J=y.__webglSprites[G];if(J.useScreenCoordinates)J.z=-J.position.z;else{J._modelViewMatrix.multiplyToArray(O.matrixWorldInverse,J.matrixWorld,J._modelViewMatrixArray);J.z=-J._modelViewMatrix.n34}}y.__webglSprites.sort(v);G=0;for(H=y.__webglSprites.length;G<
H;G++){J=y.__webglSprites[G];if(J.material===undefined&&J.map&&J.map.image&&J.map.image.width){if(J.useScreenCoordinates){o.uniform1i(S.useScreenCoordinates,1);o.uniform3f(S.screenPosition,(J.position.x-R)/R,(V-J.position.y)/V,Math.max(0,Math.min(1,J.position.z)))}else{o.uniform1i(S.useScreenCoordinates,0);o.uniform1i(S.affectedByDistance,J.affectedByDistance?1:0);o.uniformMatrix4fv(S.modelViewMatrix,!1,J._modelViewMatrixArray)}Q=J.map.image.width/(J.affectedByDistance?1:Ca);W[0]=Q*U*J.scale.x;W[1]=
Q*J.scale.y;o.uniform2f(S.uvScale,J.uvScale.x,J.uvScale.y);o.uniform2f(S.uvOffset,J.uvOffset.x,J.uvOffset.y);o.uniform2f(S.alignment,J.alignment.x,J.alignment.y);o.uniform1f(S.opacity,J.opacity);o.uniform1f(S.rotation,J.rotation);o.uniform2fv(S.scale,W);if(J.mergeWith3D&&!T){o.enable(o.DEPTH_TEST);T=!0}else if(!J.mergeWith3D&&T){o.disable(o.DEPTH_TEST);T=!1}L(J.blending);C(J.map,0);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}}o.enable(o.CULL_FACE);o.enable(o.DEPTH_TEST);o.depthMask(X)}function x(y,
O){var G,H,J=y.__webglLensFlares.length,S,U,Q,W=new THREE.Vector3,R=Ca/Ga,V=Ga*0.5,T=Ca*0.5,la=16/Ca,ja=[la*R,la],Da=[1,1,0],Ia=[1,1],Fa=ca.uniforms;G=ca.attributes;o.useProgram(ca.program);oa=ca.program;pa="";if(!Na){o.enableVertexAttribArray(ca.attributes.vertex);o.enableVertexAttribArray(ca.attributes.uv);Na=!0}o.uniform1i(Fa.occlusionMap,0);o.uniform1i(Fa.map,1);o.bindBuffer(o.ARRAY_BUFFER,ca.vertexBuffer);o.vertexAttribPointer(G.vertex,2,o.FLOAT,!1,16,0);o.vertexAttribPointer(G.uv,2,o.FLOAT,
!1,16,8);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);o.disable(o.CULL_FACE);o.depthMask(!1);o.activeTexture(o.TEXTURE0);o.bindTexture(o.TEXTURE_2D,ca.occlusionTexture);o.activeTexture(o.TEXTURE1);for(H=0;H<J;H++){G=y.__webglLensFlares[H].object;W.set(G.matrixWorld.n14,G.matrixWorld.n24,G.matrixWorld.n34);O.matrixWorldInverse.multiplyVector3(W);O.projectionMatrix.multiplyVector3(W);Da[0]=W.x;Da[1]=W.y;Da[2]=W.z;Ia[0]=Da[0]*V+V;Ia[1]=Da[1]*T+T;if(ca.hasVertexTexture||Ia[0]>0&&Ia[0]<Ga&&Ia[1]>
0&&Ia[1]<Ca){o.bindTexture(o.TEXTURE_2D,ca.tempTexture);o.copyTexImage2D(o.TEXTURE_2D,0,o.RGB,Ia[0]-8,Ia[1]-8,16,16,0);o.uniform1i(Fa.renderType,0);o.uniform2fv(Fa.scale,ja);o.uniform3fv(Fa.screenPosition,Da);o.disable(o.BLEND);o.enable(o.DEPTH_TEST);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0);o.bindTexture(o.TEXTURE_2D,ca.occlusionTexture);o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,Ia[0]-8,Ia[1]-8,16,16,0);o.uniform1i(Fa.renderType,1);o.disable(o.DEPTH_TEST);o.bindTexture(o.TEXTURE_2D,ca.tempTexture);
o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0);G.positionScreen.x=Da[0];G.positionScreen.y=Da[1];G.positionScreen.z=Da[2];G.customUpdateCallback?G.customUpdateCallback(G):G.updateLensFlares();o.uniform1i(Fa.renderType,2);o.enable(o.BLEND);S=0;for(U=G.lensFlares.length;S<U;S++){Q=G.lensFlares[S];if(Q.opacity>0.001&&Q.scale>0.001){Da[0]=Q.x;Da[1]=Q.y;Da[2]=Q.z;la=Q.size*Q.scale/Ca;ja[0]=la*R;ja[1]=la;o.uniform3fv(Fa.screenPosition,Da);o.uniform2fv(Fa.scale,ja);o.uniform1f(Fa.rotation,Q.rotation);
o.uniform1f(Fa.opacity,Q.opacity);L(Q.blending);C(Q.texture,1);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}}}}o.enable(o.CULL_FACE);o.enable(o.DEPTH_TEST);o.depthMask(X)}function D(y,O){y._modelViewMatrix.multiplyToArray(O.matrixWorldInverse,y.matrixWorld,y._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(y._modelViewMatrix).transposeIntoArray(y._normalMatrixArray)}function z(y){var O,G,H,J,S;if(y instanceof THREE.Mesh){G=y.geometry;for(O in G.geometryGroups){H=G.geometryGroups[O];S=!1;for(J in H.__webglCustomAttributes)if(H.__webglCustomAttributes[J].needsUpdate){S=
!0;break}if(G.__dirtyVertices||G.__dirtyMorphTargets||G.__dirtyElements||G.__dirtyUvs||G.__dirtyNormals||G.__dirtyColors||G.__dirtyTangents||S){S=o.DYNAMIC_DRAW;var U=void 0,Q=void 0,W=void 0,R=void 0,V=void 0,T=void 0,la=void 0,ja=void 0,Da=void 0,Ia=void 0,Fa=void 0,Ma=void 0,Ya=void 0,wa=void 0,Ba=void 0,Ha=void 0,Qa=void 0,P=void 0,sa=void 0,F=void 0,eb=void 0,hb=void 0,Va=0,Ua=0,gb=0,db=0,ab=0,$a=0,Pa=0,Za=0,Wa=0,ga=0,Ea=0,Ra=H.__vertexArray,ib=H.__uvArray,mb=H.__uv2Array,cb=H.__normalArray,
Ja=H.__tangentArray,da=H.__colorArray,va=H.__skinVertexAArray,ra=H.__skinVertexBArray,ma=H.__skinIndexArray,Aa=H.__skinWeightArray,Oa=H.__morphTargetsArrays,ya=H.__webglCustomAttributes,fa=H.__faceArray,La=H.__lineArray,lb=H.__needsSmoothNormals;Ia=H.__vertexColorType;Da=H.__uvType;Fa=H.__normalType;var Sa=y.geometry,jb=Sa.__dirtyVertices,nb=Sa.__dirtyElements,fb=Sa.__dirtyUvs,kb=Sa.__dirtyNormals,ub=Sa.__dirtyTangents,vb=Sa.__dirtyColors,wb=Sa.__dirtyMorphTargets,qb=Sa.vertices,xb=H.faces,Ab=Sa.faces,
yb=Sa.faceVertexUvs[0],zb=Sa.faceVertexUvs[1],rb=Sa.skinVerticesA,sb=Sa.skinVerticesB,tb=Sa.skinIndices,ob=Sa.skinWeights,pb=y instanceof THREE.ShadowVolume?Sa.edgeFaces:undefined;morphTargets=Sa.morphTargets;if(ya)for(hb in ya){ya[hb].offset=0;ya[hb].offsetSrc=0}U=0;for(Q=xb.length;U<Q;U++){W=xb[U];R=Ab[W];yb&&(Ma=yb[W]);zb&&(Ya=zb[W]);W=R.vertexNormals;V=R.normal;T=R.vertexColors;la=R.color;ja=R.vertexTangents;if(R instanceof THREE.Face3){if(jb){wa=qb[R.a].position;Ba=qb[R.b].position;Ha=qb[R.c].position;
Ra[Ua]=wa.x;Ra[Ua+1]=wa.y;Ra[Ua+2]=wa.z;Ra[Ua+3]=Ba.x;Ra[Ua+4]=Ba.y;Ra[Ua+5]=Ba.z;Ra[Ua+6]=Ha.x;Ra[Ua+7]=Ha.y;Ra[Ua+8]=Ha.z;Ua+=9}if(ya)for(hb in ya){F=ya[hb];if(F.needsUpdate){P=F.offset;sa=F.offsetSrc;if(F.size===1){if(F.boundTo===undefined||F.boundTo==="vertices"){F.array[P+0]=F.value[R.a];F.array[P+1]=F.value[R.b];F.array[P+2]=F.value[R.c]}else if(F.boundTo==="faces"){F.array[P+0]=F.value[sa];F.array[P+1]=F.value[sa];F.array[P+2]=F.value[sa];F.offsetSrc++}else if(F.boundTo==="faceVertices"){F.array[P+
0]=F.value[sa+0];F.array[P+1]=F.value[sa+1];F.array[P+2]=F.value[sa+2];F.offsetSrc+=3}F.offset+=3}else{if(F.boundTo===undefined||F.boundTo==="vertices"){wa=F.value[R.a];Ba=F.value[R.b];Ha=F.value[R.c]}else if(F.boundTo==="faces"){wa=F.value[sa];Ba=F.value[sa];Ha=F.value[sa];F.offsetSrc++}else if(F.boundTo==="faceVertices"){wa=F.value[sa+0];Ba=F.value[sa+1];Ha=F.value[sa+2];F.offsetSrc+=3}if(F.size===2){F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=Ba.x;F.array[P+3]=Ba.y;F.array[P+4]=Ha.x;F.array[P+
5]=Ha.y;F.offset+=6}else if(F.size===3){if(F.type==="c"){F.array[P+0]=wa.r;F.array[P+1]=wa.g;F.array[P+2]=wa.b;F.array[P+3]=Ba.r;F.array[P+4]=Ba.g;F.array[P+5]=Ba.b;F.array[P+6]=Ha.r;F.array[P+7]=Ha.g;F.array[P+8]=Ha.b}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;F.array[P+3]=Ba.x;F.array[P+4]=Ba.y;F.array[P+5]=Ba.z;F.array[P+6]=Ha.x;F.array[P+7]=Ha.y;F.array[P+8]=Ha.z}F.offset+=9}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;F.array[P+3]=wa.w;F.array[P+4]=Ba.x;F.array[P+
5]=Ba.y;F.array[P+6]=Ba.z;F.array[P+7]=Ba.w;F.array[P+8]=Ha.x;F.array[P+9]=Ha.y;F.array[P+10]=Ha.z;F.array[P+11]=Ha.w;F.offset+=12}}}}if(wb){P=0;for(sa=morphTargets.length;P<sa;P++){wa=morphTargets[P].vertices[R.a].position;Ba=morphTargets[P].vertices[R.b].position;Ha=morphTargets[P].vertices[R.c].position;F=Oa[P];F[Ea+0]=wa.x;F[Ea+1]=wa.y;F[Ea+2]=wa.z;F[Ea+3]=Ba.x;F[Ea+4]=Ba.y;F[Ea+5]=Ba.z;F[Ea+6]=Ha.x;F[Ea+7]=Ha.y;F[Ea+8]=Ha.z}Ea+=9}if(ob.length){P=ob[R.a];sa=ob[R.b];F=ob[R.c];Aa[ga]=P.x;Aa[ga+
1]=P.y;Aa[ga+2]=P.z;Aa[ga+3]=P.w;Aa[ga+4]=sa.x;Aa[ga+5]=sa.y;Aa[ga+6]=sa.z;Aa[ga+7]=sa.w;Aa[ga+8]=F.x;Aa[ga+9]=F.y;Aa[ga+10]=F.z;Aa[ga+11]=F.w;P=tb[R.a];sa=tb[R.b];F=tb[R.c];ma[ga]=P.x;ma[ga+1]=P.y;ma[ga+2]=P.z;ma[ga+3]=P.w;ma[ga+4]=sa.x;ma[ga+5]=sa.y;ma[ga+6]=sa.z;ma[ga+7]=sa.w;ma[ga+8]=F.x;ma[ga+9]=F.y;ma[ga+10]=F.z;ma[ga+11]=F.w;P=rb[R.a];sa=rb[R.b];F=rb[R.c];va[ga]=P.x;va[ga+1]=P.y;va[ga+2]=P.z;va[ga+3]=1;va[ga+4]=sa.x;va[ga+5]=sa.y;va[ga+6]=sa.z;va[ga+7]=1;va[ga+8]=F.x;va[ga+9]=F.y;va[ga+10]=
F.z;va[ga+11]=1;P=sb[R.a];sa=sb[R.b];F=sb[R.c];ra[ga]=P.x;ra[ga+1]=P.y;ra[ga+2]=P.z;ra[ga+3]=1;ra[ga+4]=sa.x;ra[ga+5]=sa.y;ra[ga+6]=sa.z;ra[ga+7]=1;ra[ga+8]=F.x;ra[ga+9]=F.y;ra[ga+10]=F.z;ra[ga+11]=1;ga+=12}if(vb&&Ia){if(T.length==3&&Ia==THREE.VertexColors){R=T[0];P=T[1];sa=T[2]}else sa=P=R=la;da[Wa]=R.r;da[Wa+1]=R.g;da[Wa+2]=R.b;da[Wa+3]=P.r;da[Wa+4]=P.g;da[Wa+5]=P.b;da[Wa+6]=sa.r;da[Wa+7]=sa.g;da[Wa+8]=sa.b;Wa+=9}if(ub&&Sa.hasTangents){T=ja[0];la=ja[1];R=ja[2];Ja[Pa]=T.x;Ja[Pa+1]=T.y;Ja[Pa+2]=T.z;
Ja[Pa+3]=T.w;Ja[Pa+4]=la.x;Ja[Pa+5]=la.y;Ja[Pa+6]=la.z;Ja[Pa+7]=la.w;Ja[Pa+8]=R.x;Ja[Pa+9]=R.y;Ja[Pa+10]=R.z;Ja[Pa+11]=R.w;Pa+=12}if(kb&&Fa)if(W.length==3&&lb)for(ja=0;ja<3;ja++){V=W[ja];cb[$a]=V.x;cb[$a+1]=V.y;cb[$a+2]=V.z;$a+=3}else for(ja=0;ja<3;ja++){cb[$a]=V.x;cb[$a+1]=V.y;cb[$a+2]=V.z;$a+=3}if(fb&&Ma!==undefined&&Da)for(ja=0;ja<3;ja++){W=Ma[ja];ib[gb]=W.u;ib[gb+1]=W.v;gb+=2}if(fb&&Ya!==undefined&&Da)for(ja=0;ja<3;ja++){W=Ya[ja];mb[db]=W.u;mb[db+1]=W.v;db+=2}if(nb){fa[ab]=Va;fa[ab+1]=Va+1;fa[ab+
2]=Va+2;ab+=3;La[Za]=Va;La[Za+1]=Va+1;La[Za+2]=Va;La[Za+3]=Va+2;La[Za+4]=Va+1;La[Za+5]=Va+2;Za+=6;Va+=3}}else if(R instanceof THREE.Face4){if(jb){wa=qb[R.a].position;Ba=qb[R.b].position;Ha=qb[R.c].position;Qa=qb[R.d].position;Ra[Ua]=wa.x;Ra[Ua+1]=wa.y;Ra[Ua+2]=wa.z;Ra[Ua+3]=Ba.x;Ra[Ua+4]=Ba.y;Ra[Ua+5]=Ba.z;Ra[Ua+6]=Ha.x;Ra[Ua+7]=Ha.y;Ra[Ua+8]=Ha.z;Ra[Ua+9]=Qa.x;Ra[Ua+10]=Qa.y;Ra[Ua+11]=Qa.z;Ua+=12}if(ya)for(hb in ya){F=ya[hb];if(F.needsUpdate){P=F.offset;sa=F.offsetSrc;if(F.size===1){if(F.boundTo===
undefined||F.boundTo==="vertices"){F.array[P+0]=F.value[R.a];F.array[P+1]=F.value[R.b];F.array[P+2]=F.value[R.c];F.array[P+3]=F.value[R.d]}else if(F.boundTo==="faces"){F.array[P+0]=F.value[sa];F.array[P+1]=F.value[sa];F.array[P+2]=F.value[sa];F.array[P+3]=F.value[sa];F.offsetSrc++}else if(F.boundTo==="faceVertices"){F.array[P+0]=F.value[sa+0];F.array[P+1]=F.value[sa+1];F.array[P+2]=F.value[sa+2];F.array[P+3]=F.value[sa+3];F.offsetSrc+=4}F.offset+=4}else{if(F.boundTo===undefined||F.boundTo==="vertices"){wa=
F.value[R.a];Ba=F.value[R.b];Ha=F.value[R.c];Qa=F.value[R.d]}else if(F.boundTo==="faces"){wa=F.value[sa];Ba=F.value[sa];Ha=F.value[sa];Qa=F.value[sa];F.offsetSrc++}else if(F.boundTo==="faceVertices"){wa=F.value[sa+0];Ba=F.value[sa+1];Ha=F.value[sa+2];Qa=F.value[sa+3];F.offsetSrc+=4}if(F.size===2){F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=Ba.x;F.array[P+3]=Ba.y;F.array[P+4]=Ha.x;F.array[P+5]=Ha.y;F.array[P+6]=Qa.x;F.array[P+7]=Qa.y;F.offset+=8}else if(F.size===3){if(F.type==="c"){F.array[P+
0]=wa.r;F.array[P+1]=wa.g;F.array[P+2]=wa.b;F.array[P+3]=Ba.r;F.array[P+4]=Ba.g;F.array[P+5]=Ba.b;F.array[P+6]=Ha.r;F.array[P+7]=Ha.g;F.array[P+8]=Ha.b;F.array[P+9]=Qa.r;F.array[P+10]=Qa.g;F.array[P+11]=Qa.b}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;F.array[P+3]=Ba.x;F.array[P+4]=Ba.y;F.array[P+5]=Ba.z;F.array[P+6]=Ha.x;F.array[P+7]=Ha.y;F.array[P+8]=Ha.z;F.array[P+9]=Qa.x;F.array[P+10]=Qa.y;F.array[P+11]=Qa.z}F.offset+=12}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;
F.array[P+3]=wa.w;F.array[P+4]=Ba.x;F.array[P+5]=Ba.y;F.array[P+6]=Ba.z;F.array[P+7]=Ba.w;F.array[P+8]=Ha.x;F.array[P+9]=Ha.y;F.array[P+10]=Ha.z;F.array[P+11]=Ha.w;F.array[P+12]=Qa.x;F.array[P+13]=Qa.y;F.array[P+14]=Qa.z;F.array[P+15]=Qa.w;F.offset+=16}}}}if(wb){P=0;for(sa=morphTargets.length;P<sa;P++){wa=morphTargets[P].vertices[R.a].position;Ba=morphTargets[P].vertices[R.b].position;Ha=morphTargets[P].vertices[R.c].position;Qa=morphTargets[P].vertices[R.d].position;F=Oa[P];F[Ea+0]=wa.x;F[Ea+1]=
wa.y;F[Ea+2]=wa.z;F[Ea+3]=Ba.x;F[Ea+4]=Ba.y;F[Ea+5]=Ba.z;F[Ea+6]=Ha.x;F[Ea+7]=Ha.y;F[Ea+8]=Ha.z;F[Ea+9]=Qa.x;F[Ea+10]=Qa.y;F[Ea+11]=Qa.z}Ea+=12}if(ob.length){P=ob[R.a];sa=ob[R.b];F=ob[R.c];eb=ob[R.d];Aa[ga]=P.x;Aa[ga+1]=P.y;Aa[ga+2]=P.z;Aa[ga+3]=P.w;Aa[ga+4]=sa.x;Aa[ga+5]=sa.y;Aa[ga+6]=sa.z;Aa[ga+7]=sa.w;Aa[ga+8]=F.x;Aa[ga+9]=F.y;Aa[ga+10]=F.z;Aa[ga+11]=F.w;Aa[ga+12]=eb.x;Aa[ga+13]=eb.y;Aa[ga+14]=eb.z;Aa[ga+15]=eb.w;P=tb[R.a];sa=tb[R.b];F=tb[R.c];eb=tb[R.d];ma[ga]=P.x;ma[ga+1]=P.y;ma[ga+2]=P.z;ma[ga+
3]=P.w;ma[ga+4]=sa.x;ma[ga+5]=sa.y;ma[ga+6]=sa.z;ma[ga+7]=sa.w;ma[ga+8]=F.x;ma[ga+9]=F.y;ma[ga+10]=F.z;ma[ga+11]=F.w;ma[ga+12]=eb.x;ma[ga+13]=eb.y;ma[ga+14]=eb.z;ma[ga+15]=eb.w;P=rb[R.a];sa=rb[R.b];F=rb[R.c];eb=rb[R.d];va[ga]=P.x;va[ga+1]=P.y;va[ga+2]=P.z;va[ga+3]=1;va[ga+4]=sa.x;va[ga+5]=sa.y;va[ga+6]=sa.z;va[ga+7]=1;va[ga+8]=F.x;va[ga+9]=F.y;va[ga+10]=F.z;va[ga+11]=1;va[ga+12]=eb.x;va[ga+13]=eb.y;va[ga+14]=eb.z;va[ga+15]=1;P=sb[R.a];sa=sb[R.b];F=sb[R.c];R=sb[R.d];ra[ga]=P.x;ra[ga+1]=P.y;ra[ga+2]=
P.z;ra[ga+3]=1;ra[ga+4]=sa.x;ra[ga+5]=sa.y;ra[ga+6]=sa.z;ra[ga+7]=1;ra[ga+8]=F.x;ra[ga+9]=F.y;ra[ga+10]=F.z;ra[ga+11]=1;ra[ga+12]=R.x;ra[ga+13]=R.y;ra[ga+14]=R.z;ra[ga+15]=1;ga+=16}if(vb&&Ia){if(T.length==4&&Ia==THREE.VertexColors){R=T[0];P=T[1];sa=T[2];T=T[3]}else T=sa=P=R=la;da[Wa]=R.r;da[Wa+1]=R.g;da[Wa+2]=R.b;da[Wa+3]=P.r;da[Wa+4]=P.g;da[Wa+5]=P.b;da[Wa+6]=sa.r;da[Wa+7]=sa.g;da[Wa+8]=sa.b;da[Wa+9]=T.r;da[Wa+10]=T.g;da[Wa+11]=T.b;Wa+=12}if(ub&&Sa.hasTangents){T=ja[0];la=ja[1];R=ja[2];ja=ja[3];
Ja[Pa]=T.x;Ja[Pa+1]=T.y;Ja[Pa+2]=T.z;Ja[Pa+3]=T.w;Ja[Pa+4]=la.x;Ja[Pa+5]=la.y;Ja[Pa+6]=la.z;Ja[Pa+7]=la.w;Ja[Pa+8]=R.x;Ja[Pa+9]=R.y;Ja[Pa+10]=R.z;Ja[Pa+11]=R.w;Ja[Pa+12]=ja.x;Ja[Pa+13]=ja.y;Ja[Pa+14]=ja.z;Ja[Pa+15]=ja.w;Pa+=16}if(kb&&Fa)if(W.length==4&&lb)for(ja=0;ja<4;ja++){V=W[ja];cb[$a]=V.x;cb[$a+1]=V.y;cb[$a+2]=V.z;$a+=3}else for(ja=0;ja<4;ja++){cb[$a]=V.x;cb[$a+1]=V.y;cb[$a+2]=V.z;$a+=3}if(fb&&Ma!==undefined&&Da)for(ja=0;ja<4;ja++){W=Ma[ja];ib[gb]=W.u;ib[gb+1]=W.v;gb+=2}if(fb&&Ya!==undefined&&
Da)for(ja=0;ja<4;ja++){W=Ya[ja];mb[db]=W.u;mb[db+1]=W.v;db+=2}if(nb){fa[ab]=Va;fa[ab+1]=Va+1;fa[ab+2]=Va+3;fa[ab+3]=Va+1;fa[ab+4]=Va+2;fa[ab+5]=Va+3;ab+=6;La[Za]=Va;La[Za+1]=Va+1;La[Za+2]=Va;La[Za+3]=Va+3;La[Za+4]=Va+1;La[Za+5]=Va+2;La[Za+6]=Va+2;La[Za+7]=Va+3;Za+=8;Va+=4}}}if(pb){U=0;for(Q=pb.length;U<Q;U++){fa[ab]=pb[U].a;fa[ab+1]=pb[U].b;fa[ab+2]=pb[U].c;fa[ab+3]=pb[U].a;fa[ab+4]=pb[U].c;fa[ab+5]=pb[U].d;ab+=6}}if(jb){o.bindBuffer(o.ARRAY_BUFFER,H.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,
Ra,S)}if(ya)for(hb in ya){F=ya[hb];if(F.needsUpdate){o.bindBuffer(o.ARRAY_BUFFER,F.buffer);o.bufferData(o.ARRAY_BUFFER,F.array,S);F.needsUpdate=!1}}if(wb){P=0;for(sa=morphTargets.length;P<sa;P++){o.bindBuffer(o.ARRAY_BUFFER,H.__webglMorphTargetsBuffers[P]);o.bufferData(o.ARRAY_BUFFER,Oa[P],S)}}if(vb&&Wa>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,da,S)}if(kb){o.bindBuffer(o.ARRAY_BUFFER,H.__webglNormalBuffer);o.bufferData(o.ARRAY_BUFFER,cb,S)}if(ub&&Sa.hasTangents){o.bindBuffer(o.ARRAY_BUFFER,
H.__webglTangentBuffer);o.bufferData(o.ARRAY_BUFFER,Ja,S)}if(fb&&gb>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglUVBuffer);o.bufferData(o.ARRAY_BUFFER,ib,S)}if(fb&&db>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglUV2Buffer);o.bufferData(o.ARRAY_BUFFER,mb,S)}if(nb){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,H.__webglFaceBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,fa,S);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,H.__webglLineBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,La,S)}if(ga>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinVertexABuffer);
o.bufferData(o.ARRAY_BUFFER,va,S);o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinVertexBBuffer);o.bufferData(o.ARRAY_BUFFER,ra,S);o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinIndicesBuffer);o.bufferData(o.ARRAY_BUFFER,ma,S);o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinWeightsBuffer);o.bufferData(o.ARRAY_BUFFER,Aa,S)}}}G.__dirtyVertices=!1;G.__dirtyMorphTargets=!1;G.__dirtyElements=!1;G.__dirtyUvs=!1;G.__dirtyNormals=!1;G.__dirtyTangents=!1;G.__dirtyColors=!1}else if(y instanceof THREE.Ribbon){G=y.geometry;if(G.__dirtyVertices||
G.__dirtyColors){y=G;O=o.DYNAMIC_DRAW;Ia=y.vertices;H=y.colors;Fa=Ia.length;S=H.length;Ma=y.__vertexArray;U=y.__colorArray;Ya=y.__dirtyColors;if(y.__dirtyVertices){for(Q=0;Q<Fa;Q++){Da=Ia[Q].position;J=Q*3;Ma[J]=Da.x;Ma[J+1]=Da.y;Ma[J+2]=Da.z}o.bindBuffer(o.ARRAY_BUFFER,y.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,Ma,O)}if(Ya){for(Q=0;Q<S;Q++){color=H[Q];J=Q*3;U[J]=color.r;U[J+1]=color.g;U[J+2]=color.b}o.bindBuffer(o.ARRAY_BUFFER,y.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,U,O)}}G.__dirtyVertices=
!1;G.__dirtyColors=!1}else if(y instanceof THREE.Line){G=y.geometry;if(G.__dirtyVertices||G.__dirtyColors){y=G;O=o.DYNAMIC_DRAW;Ia=y.vertices;H=y.colors;Fa=Ia.length;S=H.length;Ma=y.__vertexArray;U=y.__colorArray;Ya=y.__dirtyColors;if(y.__dirtyVertices){for(Q=0;Q<Fa;Q++){Da=Ia[Q].position;J=Q*3;Ma[J]=Da.x;Ma[J+1]=Da.y;Ma[J+2]=Da.z}o.bindBuffer(o.ARRAY_BUFFER,y.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,Ma,O)}if(Ya){for(Q=0;Q<S;Q++){color=H[Q];J=Q*3;U[J]=color.r;U[J+1]=color.g;U[J+2]=color.b}o.bindBuffer(o.ARRAY_BUFFER,
y.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,U,O)}}G.__dirtyVertices=!1;G.__dirtyColors=!1}else if(y instanceof THREE.ParticleSystem){G=y.geometry;(G.__dirtyVertices||G.__dirtyColors||y.sortParticles)&&d(G,o.DYNAMIC_DRAW,y);G.__dirtyVertices=!1;G.__dirtyColors=!1}}function I(y){function O(la){var ja=[];G=0;for(H=la.length;G<H;G++)la[G]==undefined?ja.push("undefined"):ja.push(la[G].id);return ja.join("_")}var G,H,J,S,U,Q,W,R,V={},T=y.morphTargets!==undefined?y.morphTargets.length:0;y.geometryGroups=
{};J=0;for(S=y.faces.length;J<S;J++){U=y.faces[J];Q=U.materials;W=O(Q);V[W]==undefined&&(V[W]={hash:W,counter:0});R=V[W].hash+"_"+V[W].counter;y.geometryGroups[R]==undefined&&(y.geometryGroups[R]={faces:[],materials:Q,vertices:0,numMorphTargets:T});U=U instanceof THREE.Face3?3:4;if(y.geometryGroups[R].vertices+U>65535){V[W].counter+=1;R=V[W].hash+"_"+V[W].counter;y.geometryGroups[R]==undefined&&(y.geometryGroups[R]={faces:[],materials:Q,vertices:0,numMorphTargets:T})}y.geometryGroups[R].faces.push(J);
y.geometryGroups[R].vertices+=U}}function B(y,O,G){y.push({buffer:O,object:G,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function L(y){if(y!=pa){switch(y){case THREE.AdditiveBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.SRC_ALPHA,o.ONE);break;case THREE.SubtractiveBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.ZERO,o.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.ZERO,o.SRC_COLOR);break;default:o.blendEquationSeparate(o.FUNC_ADD,
o.FUNC_ADD);o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)}pa=y}}function A(y,O,G){if((G.width&G.width-1)==0&&(G.height&G.height-1)==0){o.texParameteri(y,o.TEXTURE_WRAP_S,K(O.wrapS));o.texParameteri(y,o.TEXTURE_WRAP_T,K(O.wrapT));o.texParameteri(y,o.TEXTURE_MAG_FILTER,K(O.magFilter));o.texParameteri(y,o.TEXTURE_MIN_FILTER,K(O.minFilter));o.generateMipmap(y)}else{o.texParameteri(y,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(y,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);
o.texParameteri(y,o.TEXTURE_MAG_FILTER,N(O.magFilter));o.texParameteri(y,o.TEXTURE_MIN_FILTER,N(O.minFilter))}}function C(y,O){if(y.needsUpdate){if(y.__webglInit){o.bindTexture(o.TEXTURE_2D,y.__webglTexture);o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,y.image)}else{y.__webglTexture=o.createTexture();o.bindTexture(o.TEXTURE_2D,y.__webglTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,y.image);y.__webglInit=!0}A(o.TEXTURE_2D,y,y.image);o.bindTexture(o.TEXTURE_2D,null);
y.needsUpdate=!1}o.activeTexture(o.TEXTURE0+O);o.bindTexture(o.TEXTURE_2D,y.__webglTexture)}function E(y){if(y&&!y.__webglFramebuffer){if(y.depthBuffer===undefined)y.depthBuffer=!0;if(y.stencilBuffer===undefined)y.stencilBuffer=!0;y.__webglFramebuffer=o.createFramebuffer();y.__webglRenderbuffer=o.createRenderbuffer();y.__webglTexture=o.createTexture();o.bindTexture(o.TEXTURE_2D,y.__webglTexture);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,K(y.wrapS));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,
K(y.wrapT));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,K(y.magFilter));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,K(y.minFilter));o.texImage2D(o.TEXTURE_2D,0,K(y.format),y.width,y.height,0,K(y.format),K(y.type),null);o.bindRenderbuffer(o.RENDERBUFFER,y.__webglRenderbuffer);o.bindFramebuffer(o.FRAMEBUFFER,y.__webglFramebuffer);o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,y.__webglTexture,0);if(y.depthBuffer&&!y.stencilBuffer){o.renderbufferStorage(o.RENDERBUFFER,
o.DEPTH_COMPONENT16,y.width,y.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,y.__webglRenderbuffer)}else if(y.depthBuffer&&y.stencilBuffer){o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,y.width,y.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,y.__webglRenderbuffer)}else o.renderbufferStorage(o.RENDERBUFFER,o.RGBA4,y.width,y.height);o.bindTexture(o.TEXTURE_2D,null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,
null)}var O,G;if(y){O=y.__webglFramebuffer;G=y.width;y=y.height}else{O=null;G=Ga;y=Ca}if(O!=ha){o.bindFramebuffer(o.FRAMEBUFFER,O);o.viewport(xa,ua,G,y);ha=O}}function M(y,O){var G;if(y=="fragment")G=o.createShader(o.FRAGMENT_SHADER);else y=="vertex"&&(G=o.createShader(o.VERTEX_SHADER));o.shaderSource(G,O);o.compileShader(G);if(!o.getShaderParameter(G,o.COMPILE_STATUS)){console.error(o.getShaderInfoLog(G));console.error(O);return null}return G}function N(y){switch(y){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return o.NEAREST;
default:return o.LINEAR}}function K(y){switch(y){case THREE.RepeatWrapping:return o.REPEAT;case THREE.ClampToEdgeWrapping:return o.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return o.MIRRORED_REPEAT;case THREE.NearestFilter:return o.NEAREST;case THREE.NearestMipMapNearestFilter:return o.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return o.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return o.LINEAR;case THREE.LinearMipMapNearestFilter:return o.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return o.LINEAR_MIPMAP_LINEAR;
case THREE.ByteType:return o.BYTE;case THREE.UnsignedByteType:return o.UNSIGNED_BYTE;case THREE.ShortType:return o.SHORT;case THREE.UnsignedShortType:return o.UNSIGNED_SHORT;case THREE.IntType:return o.INT;case THREE.UnsignedShortType:return o.UNSIGNED_INT;case THREE.FloatType:return o.FLOAT;case THREE.AlphaFormat:return o.ALPHA;case THREE.RGBFormat:return o.RGB;case THREE.RGBAFormat:return o.RGBA;case THREE.LuminanceFormat:return o.LUMINANCE;case THREE.LuminanceAlphaFormat:return o.LUMINANCE_ALPHA}return 0}
var ea=this,o,ia=document.createElement("canvas"),Z=[],oa=null,ha=null,X=!0,$=null,na=null,pa=null,ta=null,xa=0,ua=0,Ga=0,Ca=0,qa=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],za=new THREE.Matrix4,Ka=new Float32Array(16),Ta=new Float32Array(16),Xa=new THREE.Vector4,Y={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};stencil=b.stencil!==undefined?b.stencil:!0;antialias=
b.antialias!==undefined?b.antialias:!1;clearColor=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0);clearAlpha=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=ia;this.autoClear=!0;this.sortObjects=!0;(function(y,O,G,H){try{if(!(o=ia.getContext("experimental-webgl",{antialias:y,stencil:H})))throw"Error creating WebGL context.";}catch(J){console.error(J)}console.log(navigator.userAgent+" | "+o.getParameter(o.VERSION)+
" | "+o.getParameter(o.VENDOR)+" | "+o.getParameter(o.RENDERER)+" | "+o.getParameter(o.SHADING_LANGUAGE_VERSION));o.clearColor(0,0,0,1);o.clearDepth(1);o.enable(o.DEPTH_TEST);o.depthFunc(o.LEQUAL);o.frontFace(o.CCW);o.cullFace(o.BACK);o.enable(o.CULL_FACE);o.enable(o.BLEND);o.blendEquation(o.FUNC_ADD);o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA);o.clearColor(O.r,O.g,O.b,G)})(antialias,clearColor,clearAlpha,stencil);this.context=o;var ka=o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(stencil){var aa=
{};aa.vertices=new Float32Array(12);aa.faces=new Uint16Array(6);aa.darkness=0.5;aa.vertices[0]=-20;aa.vertices[1]=-20;aa.vertices[2]=-1;aa.vertices[3]=20;aa.vertices[4]=-20;aa.vertices[5]=-1;aa.vertices[6]=20;aa.vertices[7]=20;aa.vertices[8]=-1;aa.vertices[9]=-20;aa.vertices[10]=20;aa.vertices[11]=-1;aa.faces[0]=0;aa.faces[1]=1;aa.faces[2]=2;aa.faces[3]=0;aa.faces[4]=2;aa.faces[5]=3;aa.vertexBuffer=o.createBuffer();aa.elementBuffer=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,aa.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,
aa.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,aa.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,aa.faces,o.STATIC_DRAW);aa.program=o.createProgram();o.attachShader(aa.program,M("fragment",THREE.ShaderLib.shadowPost.fragmentShader));o.attachShader(aa.program,M("vertex",THREE.ShaderLib.shadowPost.vertexShader));o.linkProgram(aa.program);aa.vertexLocation=o.getAttribLocation(aa.program,"position");aa.projectionLocation=o.getUniformLocation(aa.program,"projectionMatrix");aa.darknessLocation=
o.getUniformLocation(aa.program,"darkness")}var ca={};ca.vertices=new Float32Array(16);ca.faces=new Uint16Array(6);b=0;ca.vertices[b++]=-1;ca.vertices[b++]=-1;ca.vertices[b++]=0;ca.vertices[b++]=0;ca.vertices[b++]=1;ca.vertices[b++]=-1;ca.vertices[b++]=1;ca.vertices[b++]=0;ca.vertices[b++]=1;ca.vertices[b++]=1;ca.vertices[b++]=1;ca.vertices[b++]=1;ca.vertices[b++]=-1;ca.vertices[b++]=1;ca.vertices[b++]=0;ca.vertices[b++]=1;b=0;ca.faces[b++]=0;ca.faces[b++]=1;ca.faces[b++]=2;ca.faces[b++]=0;ca.faces[b++]=
2;ca.faces[b++]=3;ca.vertexBuffer=o.createBuffer();ca.elementBuffer=o.createBuffer();ca.tempTexture=o.createTexture();ca.occlusionTexture=o.createTexture();o.bindBuffer(o.ARRAY_BUFFER,ca.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,ca.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,ca.faces,o.STATIC_DRAW);o.bindTexture(o.TEXTURE_2D,ca.tempTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGB,16,16,0,o.RGB,o.UNSIGNED_BYTE,null);o.texParameteri(o.TEXTURE_2D,
o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);o.bindTexture(o.TEXTURE_2D,ca.occlusionTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,16,16,0,o.RGBA,o.UNSIGNED_BYTE,null);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,
o.NEAREST);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);if(o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){ca.hasVertexTexture=!1;ca.program=o.createProgram();o.attachShader(ca.program,M("fragment",THREE.ShaderLib.lensFlare.fragmentShader));o.attachShader(ca.program,M("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{ca.hasVertexTexture=!0;ca.program=o.createProgram();o.attachShader(ca.program,M("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));o.attachShader(ca.program,
M("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}o.linkProgram(ca.program);ca.attributes={};ca.uniforms={};ca.attributes.vertex=o.getAttribLocation(ca.program,"position");ca.attributes.uv=o.getAttribLocation(ca.program,"UV");ca.uniforms.renderType=o.getUniformLocation(ca.program,"renderType");ca.uniforms.map=o.getUniformLocation(ca.program,"map");ca.uniforms.occlusionMap=o.getUniformLocation(ca.program,"occlusionMap");ca.uniforms.opacity=o.getUniformLocation(ca.program,"opacity");
ca.uniforms.scale=o.getUniformLocation(ca.program,"scale");ca.uniforms.rotation=o.getUniformLocation(ca.program,"rotation");ca.uniforms.screenPosition=o.getUniformLocation(ca.program,"screenPosition");var Na=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=
1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=o.createBuffer();_sprite.elementBuffer=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,_sprite.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,_sprite.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,
_sprite.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,_sprite.faces,o.STATIC_DRAW);_sprite.program=o.createProgram();o.attachShader(_sprite.program,M("fragment",THREE.ShaderLib.sprite.fragmentShader));o.attachShader(_sprite.program,M("vertex",THREE.ShaderLib.sprite.vertexShader));o.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=o.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=o.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=
o.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=o.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=o.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=o.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=o.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=o.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=o.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=
o.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=o.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=o.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=o.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=o.getUniformLocation(_sprite.program,"projectionMatrix");var bb=!1;this.setSize=function(y,O){ia.width=y;ia.height=O;this.setViewport(0,
0,ia.width,ia.height)};this.setViewport=function(y,O,G,H){xa=y;ua=O;Ga=G;Ca=H;o.viewport(xa,ua,Ga,Ca)};this.setScissor=function(y,O,G,H){o.scissor(y,O,G,H)};this.enableScissorTest=function(y){y?o.enable(o.SCISSOR_TEST):o.disable(o.SCISSOR_TEST)};this.enableDepthBufferWrite=function(y){X=y;o.depthMask(y)};this.setClearColorHex=function(y,O){var G=new THREE.Color(y);o.clearColor(G.r,G.g,G.b,O)};this.setClearColor=function(y,O){o.clearColor(y.r,y.g,y.b,O)};this.clear=function(){o.clear(o.COLOR_BUFFER_BIT|
o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(y){aa.darkness=y};this.getContext=function(){return o};this.initMaterial=function(y,O,G,H){var J,S,U;if(y instanceof THREE.MeshDepthMaterial)U="depth";else if(y instanceof THREE.ShadowVolumeDynamicMaterial)U="shadowVolumeDynamic";else if(y instanceof THREE.MeshNormalMaterial)U="normal";else if(y instanceof THREE.MeshBasicMaterial)U="basic";else if(y instanceof THREE.MeshLambertMaterial)U="lambert";else if(y instanceof
THREE.MeshPhongMaterial)U="phong";else if(y instanceof THREE.LineBasicMaterial)U="basic";else y instanceof THREE.ParticleBasicMaterial&&(U="particle_basic");if(U){var Q=THREE.ShaderLib[U];y.uniforms=THREE.UniformsUtils.clone(Q.uniforms);y.vertexShader=Q.vertexShader;y.fragmentShader=Q.fragmentShader}var W,R,V;W=V=Q=0;for(R=O.length;W<R;W++){S=O[W];S instanceof THREE.DirectionalLight&&V++;S instanceof THREE.PointLight&&Q++}if(Q+V<=4)O=V;else{O=Math.ceil(4*V/(Q+V));Q=4-O}S={directional:O,point:Q};V=
50;if(H!==undefined&&H instanceof THREE.SkinnedMesh)V=H.bones.length;var T;a:{W=y.fragmentShader;R=y.vertexShader;Q=y.uniforms;O=y.attributes;G={map:!!y.map,envMap:!!y.envMap,lightMap:!!y.lightMap,vertexColors:y.vertexColors,fog:G,sizeAttenuation:y.sizeAttenuation,skinning:y.skinning,morphTargets:y.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:S.directional,maxPointLights:S.point,maxBones:V};var la;S=[];if(U)S.push(U);else{S.push(W);S.push(R)}for(la in G){S.push(la);S.push(G[la])}U=
S.join();la=0;for(S=Z.length;la<S;la++)if(Z[la].code==U){T=Z[la].program;break a}la=o.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,G.fog?"#define USE_FOG":"",G.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",G.map?"#define USE_MAP":"",G.envMap?"#define USE_ENVMAP":"",G.lightMap?"#define USE_LIGHTMAP":"",G.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
prefix_vertex=[ka?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,"#define MAX_BONES "+G.maxBones,G.map?"#define USE_MAP":"",G.envMap?"#define USE_ENVMAP":"",G.lightMap?"#define USE_LIGHTMAP":"",G.vertexColors?"#define USE_COLOR":"",G.skinning?"#define USE_SKINNING":"",G.morphTargets?"#define USE_MORPHTARGETS":"",G.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
o.attachShader(la,M("fragment",prefix_fragment+W));o.attachShader(la,M("vertex",prefix_vertex+R));o.linkProgram(la);o.getProgramParameter(la,o.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+o.getProgramParameter(la,o.VALIDATE_STATUS)+", gl error ["+o.getError()+"]");la.uniforms={};la.attributes={};var ja;W=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(ja in Q)W.push(ja);ja=W;Q=0;for(W=ja.length;Q<W;Q++){R=ja[Q];la.uniforms[R]=o.getUniformLocation(la,R)}W=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(ja=0;ja<G.maxMorphTargets;ja++)W.push("morphTarget"+ja);for(T in O)W.push(T);T=W;ja=0;for(O=T.length;ja<O;ja++){G=T[ja];la.attributes[G]=o.getAttribLocation(la,G)}Z.push({program:la,code:U});T=la}y.program=T;T=y.program.attributes;o.enableVertexAttribArray(T.position);T.color>=0&&o.enableVertexAttribArray(T.color);
T.normal>=0&&o.enableVertexAttribArray(T.normal);T.tangent>=0&&o.enableVertexAttribArray(T.tangent);if(y.skinning&&T.skinVertexA>=0&&T.skinVertexB>=0&&T.skinIndex>=0&&T.skinWeight>=0){o.enableVertexAttribArray(T.skinVertexA);o.enableVertexAttribArray(T.skinVertexB);o.enableVertexAttribArray(T.skinIndex);o.enableVertexAttribArray(T.skinWeight)}for(J in y.attributes)T[J]>=0&&o.enableVertexAttribArray(T[J]);if(y.morphTargets){y.numSupportedMorphTargets=0;if(T.morphTarget0>=0){o.enableVertexAttribArray(T.morphTarget0);
y.numSupportedMorphTargets++}if(T.morphTarget1>=0){o.enableVertexAttribArray(T.morphTarget1);y.numSupportedMorphTargets++}if(T.morphTarget2>=0){o.enableVertexAttribArray(T.morphTarget2);y.numSupportedMorphTargets++}if(T.morphTarget3>=0){o.enableVertexAttribArray(T.morphTarget3);y.numSupportedMorphTargets++}if(T.morphTarget4>=0){o.enableVertexAttribArray(T.morphTarget4);y.numSupportedMorphTargets++}if(T.morphTarget5>=0){o.enableVertexAttribArray(T.morphTarget5);y.numSupportedMorphTargets++}if(T.morphTarget6>=
0){o.enableVertexAttribArray(T.morphTarget6);y.numSupportedMorphTargets++}if(T.morphTarget7>=0){o.enableVertexAttribArray(T.morphTarget7);y.numSupportedMorphTargets++}H.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);y=0;for(J=this.maxMorphTargets;y<J;y++)H.__webglMorphTargetInfluences[y]=0}};this.render=function(y,O,G,H){var J,S,U,Q,W,R,V,T,la=y.lights,ja=y.fog;ea.data.vertices=0;ea.data.faces=0;ea.data.drawCalls=0;O.matrixAutoUpdate&&O.update(undefined,!0);y.update(undefined,
!1,O);O.matrixWorldInverse.flattenToArray(Ta);O.projectionMatrix.flattenToArray(Ka);za.multiply(O.projectionMatrix,O.matrixWorldInverse);h(za);this.initWebGLObjects(y);E(G);(this.autoClear||H)&&this.clear();W=y.__webglObjects.length;for(H=0;H<W;H++){J=y.__webglObjects[H];V=J.object;if(V.visible)if(!(V instanceof THREE.Mesh)||m(V)){V.matrixWorld.flattenToArray(V._objectMatrixArray);D(V,O);t(J);J.render=!0;if(this.sortObjects){Xa.copy(V.position);za.multiplyVector3(Xa);J.z=Xa.z}}else J.render=!1;else J.render=
!1}this.sortObjects&&y.__webglObjects.sort(v);R=y.__webglObjectsImmediate.length;for(H=0;H<R;H++){J=y.__webglObjectsImmediate[H];V=J.object;if(V.visible){V.matrixAutoUpdate&&V.matrixWorld.flattenToArray(V._objectMatrixArray);D(V,O);p(J)}}L(THREE.NormalBlending);for(H=0;H<W;H++){J=y.__webglObjects[H];if(J.render){V=J.object;T=J.buffer;U=J.opaque;f(V);for(J=0;J<U.count;J++){Q=U.list[J];j(Q.depthTest);e(O,la,ja,Q,T,V)}}}for(H=0;H<R;H++){J=y.__webglObjectsImmediate[H];V=J.object;if(V.visible){U=J.opaque;
f(V);for(J=0;J<U.count;J++){Q=U.list[J];j(Q.depthTest);S=c(O,la,ja,Q,V);V.render(function(Da){g(Da,S,Q.shading)})}}}for(H=0;H<W;H++){J=y.__webglObjects[H];if(J.render){V=J.object;T=J.buffer;U=J.transparent;f(V);for(J=0;J<U.count;J++){Q=U.list[J];L(Q.blending);j(Q.depthTest);e(O,la,ja,Q,T,V)}}}for(H=0;H<R;H++){J=y.__webglObjectsImmediate[H];V=J.object;if(V.visible){U=J.transparent;f(V);for(J=0;J<U.count;J++){Q=U.list[J];L(Q.blending);j(Q.depthTest);S=c(O,la,ja,Q,V);V.render(function(Da){g(Da,S,Q.shading)})}}}y.__webglSprites.length&&
w(y,O);stencil&&y.__webglShadowVolumes.length&&y.lights.length&&u(y);y.__webglLensFlares.length&&x(y,O);if(G&&G.minFilter!==THREE.NearestFilter&&G.minFilter!==THREE.LinearFilter){o.bindTexture(o.TEXTURE_2D,G.__webglTexture);o.generateMipmap(o.TEXTURE_2D);o.bindTexture(o.TEXTURE_2D,null)}};this.initWebGLObjects=function(y){if(!y.__webglObjects){y.__webglObjects=[];y.__webglObjectsImmediate=[];y.__webglShadowVolumes=[];y.__webglLensFlares=[];y.__webglSprites=[]}for(;y.__objectsAdded.length;){var O=
y.__objectsAdded[0],G=y,H=void 0,J=void 0,S=void 0;if(O._modelViewMatrix==undefined){O._modelViewMatrix=new THREE.Matrix4;O._normalMatrixArray=new Float32Array(9);O._modelViewMatrixArray=new Float32Array(16);O._objectMatrixArray=new Float32Array(16);O.matrixWorld.flattenToArray(O._objectMatrixArray)}if(O instanceof THREE.Mesh){J=O.geometry;J.geometryGroups==undefined&&I(J);for(H in J.geometryGroups){S=J.geometryGroups[H];if(!S.__webglVertexBuffer){var U=S;U.__webglVertexBuffer=o.createBuffer();U.__webglNormalBuffer=
o.createBuffer();U.__webglTangentBuffer=o.createBuffer();U.__webglColorBuffer=o.createBuffer();U.__webglUVBuffer=o.createBuffer();U.__webglUV2Buffer=o.createBuffer();U.__webglSkinVertexABuffer=o.createBuffer();U.__webglSkinVertexBBuffer=o.createBuffer();U.__webglSkinIndicesBuffer=o.createBuffer();U.__webglSkinWeightsBuffer=o.createBuffer();U.__webglFaceBuffer=o.createBuffer();U.__webglLineBuffer=o.createBuffer();if(U.numMorphTargets){var Q=void 0,W=void 0;U.__webglMorphTargetsBuffers=[];Q=0;for(W=
U.numMorphTargets;Q<W;Q++)U.__webglMorphTargetsBuffers.push(o.createBuffer())}U=S;Q=O;var R=void 0,V=void 0,T=void 0,la=void 0,ja=void 0,Da=void 0,Ia=Da=W=0,Fa=void 0;la=Q.geometry;Fa=la.faces;ja=U.faces;R=0;for(V=ja.length;R<V;R++){T=ja[R];T=Fa[T];if(T instanceof THREE.Face3){W+=3;Da+=1;Ia+=3}else if(T instanceof THREE.Face4){W+=4;Da+=2;Ia+=4}}R=U;V=Q;var Ma=void 0,Ya=void 0;T=[];Fa=0;for(ja=V.materials.length;Fa<ja;Fa++){Ma=V.materials[Fa];if(Ma instanceof THREE.MeshFaceMaterial){Ma=0;for(l=R.materials.length;Ma<
l;Ma++)(Ya=R.materials[Ma])&&T.push(Ya)}else(Ya=Ma)&&T.push(Ya)}R=T;a:{ja=R.length;for(V=0;V<ja;V++){Fa=R[V];if(Fa.map||Fa.lightMap||Fa instanceof THREE.MeshShaderMaterial){V=!0;break a}}V=!1}a:{Fa=R;Ma=Fa.length;for(ja=0;ja<Ma;ja++){T=Fa[ja];if(!(T instanceof THREE.MeshBasicMaterial&&!T.envMap||T instanceof THREE.MeshDepthMaterial)){Fa=T&&T.shading!=undefined&&T.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}Fa=!1}a:{Ma=R.length;for(ja=0;ja<Ma;ja++){T=R[ja];if(T.vertexColors){T=
T.vertexColors;break a}}T=!1}U.__vertexArray=new Float32Array(W*3);if(Fa)U.__normalArray=new Float32Array(W*3);if(la.hasTangents)U.__tangentArray=new Float32Array(W*4);if(T)U.__colorArray=new Float32Array(W*3);if(V){if(la.faceUvs.length>0||la.faceVertexUvs.length>0)U.__uvArray=new Float32Array(W*2);if(la.faceUvs.length>1||la.faceVertexUvs.length>1)U.__uv2Array=new Float32Array(W*2)}if(Q.geometry.skinWeights.length&&Q.geometry.skinIndices.length){U.__skinVertexAArray=new Float32Array(W*4);U.__skinVertexBArray=
new Float32Array(W*4);U.__skinIndexArray=new Float32Array(W*4);U.__skinWeightArray=new Float32Array(W*4)}U.__faceArray=new Uint16Array(Da*3+(Q.geometry.edgeFaces?Q.geometry.edgeFaces.length*6:0));U.__lineArray=new Uint16Array(Ia*2);if(U.numMorphTargets){U.__morphTargetsArrays=[];la=0;for(ja=U.numMorphTargets;la<ja;la++)U.__morphTargetsArrays.push(new Float32Array(W*3))}U.__needsSmoothNormals=Fa==THREE.SmoothShading;U.__uvType=V;U.__vertexColorType=T;U.__normalType=Fa;U.__webglFaceCount=Da*3+(Q.geometry.edgeFaces?
Q.geometry.edgeFaces.length*6:0);U.__webglLineCount=Ia*2;la=0;for(ja=R.length;la<ja;la++)if(R[la].attributes){U.__webglCustomAttributes={};for(a in R[la].attributes){V=R[la].attributes[a];if(!V.__webglInitialized||V.createUniqueBuffers){V.__webglInitialized=!0;Da=1;if(V.type==="v2")Da=2;else if(V.type==="v3")Da=3;else if(V.type==="v4")Da=4;else V.type==="c"&&(Da=3);V.size=Da;V.needsUpdate=!0;V.array=new Float32Array(W*Da);V.buffer=o.createBuffer();V.buffer.belongsToAttribute=a}U.__webglCustomAttributes[a]=
V}}J.__dirtyVertices=!0;J.__dirtyMorphTargets=!0;J.__dirtyElements=!0;J.__dirtyUvs=!0;J.__dirtyNormals=!0;J.__dirtyTangents=!0;J.__dirtyColors=!0}O instanceof THREE.ShadowVolume?B(G.__webglShadowVolumes,S,O):B(G.__webglObjects,S,O)}}else if(O instanceof THREE.LensFlare)B(G.__webglLensFlares,undefined,O);else if(O instanceof THREE.Ribbon){J=O.geometry;if(!J.__webglVertexBuffer){H=J;H.__webglVertexBuffer=o.createBuffer();H.__webglColorBuffer=o.createBuffer();H=J;S=H.vertices.length;H.__vertexArray=
new Float32Array(S*3);H.__colorArray=new Float32Array(S*3);H.__webglVertexCount=S;J.__dirtyVertices=!0;J.__dirtyColors=!0}B(G.__webglObjects,J,O)}else if(O instanceof THREE.Line){J=O.geometry;if(!J.__webglVertexBuffer){H=J;H.__webglVertexBuffer=o.createBuffer();H.__webglColorBuffer=o.createBuffer();H=J;S=H.vertices.length;H.__vertexArray=new Float32Array(S*3);H.__colorArray=new Float32Array(S*3);H.__webglLineCount=S;J.__dirtyVertices=!0;J.__dirtyColors=!0}B(G.__webglObjects,J,O)}else if(O instanceof
THREE.ParticleSystem){J=O.geometry;if(!J.__webglVertexBuffer){H=J;H.__webglVertexBuffer=o.createBuffer();H.__webglColorBuffer=o.createBuffer();H=J;S=H.vertices.length;H.__vertexArray=new Float32Array(S*3);H.__colorArray=new Float32Array(S*3);H.__sortArray=[];H.__webglParticleCount=S;J.__dirtyVertices=!0;J.__dirtyColors=!0}B(G.__webglObjects,J,O)}else if(THREE.MarchingCubes!==undefined&&O instanceof THREE.MarchingCubes)G.__webglObjectsImmediate.push({object:O,opaque:{list:[],count:0},transparent:{list:[],
count:0}});else O instanceof THREE.Sprite&&G.__webglSprites.push(O);y.__objectsAdded.splice(0,1)}for(;y.__objectsRemoved.length;){O=y.__objectsRemoved[0];G=y;if(O instanceof THREE.Mesh)for(J=G.__webglObjects.length-1;J>=0;J--){H=G.__webglObjects[J].object;if(O==H){G.__webglObjects.splice(J,1);break}}else if(O instanceof THREE.Sprite)for(J=G.__webglSprites.length-1;J>=0;J--){H=G.__webglSprites[J];if(O==H){G.__webglSprites.splice(J,1);break}}y.__objectsRemoved.splice(0,1)}O=0;for(G=y.__webglObjects.length;O<
G;O++)z(y.__webglObjects[O].object,y);O=0;for(G=y.__webglShadowVolumes.length;O<G;O++)z(y.__webglShadowVolumes[O].object,y);O=0;for(G=y.__webglLensFlares.length;O<G;O++)z(y.__webglLensFlares[O].object,y)};this.setFaceCulling=function(y,O){if(y){!O||O=="ccw"?o.frontFace(o.CCW):o.frontFace(o.CW);if(y=="back")o.cullFace(o.BACK);else y=="front"?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK);o.enable(o.CULL_FACE)}else o.disable(o.CULL_FACE)};this.supportsVertexTextures=function(){return ka}};
THREE.WebGLRenderTarget=function(b,d,c){this.width=b;this.height=d;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==
undefined?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:!0};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,d,c){c&&b.update(undefined,!1,d);c=b.sounds;var e,g=c.length;for(e=0;e<g;e++){b=c[e];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(d.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};
THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.materials=null};
THREE.AnimationHandler=function(){var b=[],d={},c={};c.update=function(g){for(var f=0;f<b.length;f++)b[f].update(g)};c.addToUpdate=function(g){b.indexOf(g)===-1&&b.push(g)};c.removeFromUpdate=function(g){g=b.indexOf(g);g!==-1&&b.splice(g,1)};c.add=function(g){d[g.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+g.name+" already exists in library. Overwriting.");d[g.name]=g;if(g.initialized!==!0){for(var f=0;f<g.hierarchy.length;f++){for(var j=0;j<g.hierarchy[f].keys.length;j++){if(g.hierarchy[f].keys[j].time<
0)g.hierarchy[f].keys[j].time=0;if(g.hierarchy[f].keys[j].rot!==undefined&&!(g.hierarchy[f].keys[j].rot instanceof THREE.Quaternion)){var h=g.hierarchy[f].keys[j].rot;g.hierarchy[f].keys[j].rot=new THREE.Quaternion(h[0],h[1],h[2],h[3])}}if(g.hierarchy[f].keys[0].morphTargets!==undefined){h={};for(j=0;j<g.hierarchy[f].keys.length;j++)for(var m=0;m<g.hierarchy[f].keys[j].morphTargets.length;m++){var n=g.hierarchy[f].keys[j].morphTargets[m];h[n]=-1}g.hierarchy[f].usedMorphTargets=h;for(j=0;j<g.hierarchy[f].keys.length;j++){var p=
{};for(n in h){for(m=0;m<g.hierarchy[f].keys[j].morphTargets.length;m++)if(g.hierarchy[f].keys[j].morphTargets[m]===n){p[n]=g.hierarchy[f].keys[j].morphTargetsInfluences[m];break}m===g.hierarchy[f].keys[j].morphTargets.length&&(p[n]=0)}g.hierarchy[f].keys[j].morphTargetsInfluences=p}}for(j=1;j<g.hierarchy[f].keys.length;j++)if(g.hierarchy[f].keys[j].time===g.hierarchy[f].keys[j-1].time){g.hierarchy[f].keys.splice(j,1);j--}for(j=1;j<g.hierarchy[f].keys.length;j++)g.hierarchy[f].keys[j].index=j}j=parseInt(g.length*
g.fps,10);g.JIT={};g.JIT.hierarchy=[];for(f=0;f<g.hierarchy.length;f++)g.JIT.hierarchy.push(Array(j));g.initialized=!0}};c.get=function(g){if(typeof g==="string")if(d[g])return d[g];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+g);return null}};c.parse=function(g){var f=[];if(g instanceof THREE.SkinnedMesh)for(var j=0;j<g.bones.length;j++)f.push(g.bones[j]);else e(g,f);return f};var e=function(g,f){f.push(g);for(var j=0;j<g.children.length;j++)e(g.children[j],f)};c.LINEAR=
0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,d,c,e){this.root=b;this.data=THREE.AnimationHandler.get(d);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.JITCompile=e!==undefined?e:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,d){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==undefined?b:!0;this.currentTime=d!==undefined?d:0;var c,e=this.hierarchy.length,g;for(c=0;c<e;c++){g=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)g.useQuaternion=!0;g.matrixAutoUpdate=!0;if(g.animationCache===undefined){g.animationCache={};g.animationCache.prevKey={pos:0,rot:0,scl:0};g.animationCache.nextKey={pos:0,rot:0,scl:0};g.animationCache.originalMatrix=
g instanceof THREE.Bone?g.skinMatrix:g.matrix}var f=g.animationCache.prevKey;g=g.animationCache.nextKey;f.pos=this.data.hierarchy[c].keys[0];f.rot=this.data.hierarchy[c].keys[0];f.scl=this.data.hierarchy[c].keys[0];g.pos=this.getNextKeyWith("pos",c,1);g.rot=this.getNextKeyWith("rot",c,1);g.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==undefined){if(this.hierarchy[b]instanceof THREE.Bone)this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix;else this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var d=["pos","rot","scl"],c,e,g,f,j,h,m,n,p=this.data.JIT.hierarchy,t,v;this.currentTime+=b*this.timeScale;v=this.currentTime;t=this.currentTime%=this.data.length;n=parseInt(Math.min(t*this.data.fps,this.data.length*this.data.fps),10);for(var u=0,w=this.hierarchy.length;u<w;u++){b=this.hierarchy[u];m=b.animationCache;if(this.JITCompile&&p[u][n]!==undefined)if(b instanceof THREE.Bone){b.skinMatrix=p[u][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=
!1}else{b.matrix=p[u][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(b instanceof THREE.Bone)b.skinMatrix=b.animationCache.originalMatrix;else b.matrix=b.animationCache.originalMatrix;for(var x=0;x<3;x++){c=d[x];j=m.prevKey[c];h=m.nextKey[c];if(h.time<=v){if(t<v)if(this.loop){j=this.data.hierarchy[u].keys[0];for(h=this.getNextKeyWith(c,u,1);h.time<t;){j=h;h=this.getNextKeyWith(c,u,h.index+1)}}else{this.stop();return}else{do{j=h;h=this.getNextKeyWith(c,u,h.index+1)}while(h.time<
t)}m.prevKey[c]=j;m.nextKey[c]=h}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;e=(t-j.time)/(h.time-j.time);g=j[c];f=h[c];if(e<0||e>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+u);e=e<0?0:1}if(c==="pos"){c=b.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=g[0]+(f[0]-g[0])*e;c.y=g[1]+(f[1]-g[1])*e;c.z=g[2]+(f[2]-g[2])*e}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",u,j.index-1).pos;this.points[1]=g;this.points[2]=f;this.points[3]=this.getNextKeyWith("pos",u,h.index+1).pos;e=e*0.33+0.33;g=this.interpolateCatmullRom(this.points,e);c.x=g[0];c.y=g[1];c.z=g[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){e=this.interpolateCatmullRom(this.points,e*1.01);this.target.set(e[0],e[1],e[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();e=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,e,0)}}}else if(c===
"rot")THREE.Quaternion.slerp(g,f,b.quaternion,e);else if(c==="scl"){c=b.scale;c.x=g[0]+(f[0]-g[0])*e;c.y=g[1]+(f[1]-g[1])*e;c.z=g[2]+(f[2]-g[2])*e}}}}if(this.JITCompile&&p[0][n]===undefined){this.hierarchy[0].update(undefined,!0);for(u=0;u<this.hierarchy.length;u++)p[u][n]=this.hierarchy[u]instanceof THREE.Bone?this.hierarchy[u].skinMatrix.clone():this.hierarchy[u].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,d){var c=[],e=[],g,f,j,h,m,n;g=(b.length-1)*d;f=Math.floor(g);g-=f;c[0]=f==0?f:f-1;c[1]=f;c[2]=f>b.length-2?f:f+1;c[3]=f>b.length-3?f:f+2;f=b[c[0]];h=b[c[1]];m=b[c[2]];n=b[c[3]];c=g*g;j=g*c;e[0]=this.interpolate(f[0],h[0],m[0],n[0],g,c,j);e[1]=this.interpolate(f[1],h[1],m[1],n[1],g,c,j);e[2]=this.interpolate(f[2],h[2],m[2],n[2],g,c,j);return e};
THREE.Animation.prototype.interpolate=function(b,d,c,e,g,f,j){b=(c-b)*0.5;e=(e-d)*0.5;return(2*(d-c)+b+e)*j+(-3*(d-c)-2*b-e)*f+b*g+d};THREE.Animation.prototype.getNextKeyWith=function(b,d,c){var e=this.data.hierarchy[d].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<e.length-1?c:e.length-1;else c%=e.length;for(;c<e.length;c++)if(e[c][b]!==undefined)return e[c];return this.data.hierarchy[d].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,d,c){var e=this.data.hierarchy[d].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+e.length;c>=0;c--)if(e[c][b]!==undefined)return e[c];return this.data.hierarchy[d].keys[e.length-1]};
THREE.ColorUtils={adjustHSV:function(b,d,c,e){var g=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,g);g.h=THREE.ColorUtils.clamp(g.h+d,0,1);g.s=THREE.ColorUtils.clamp(g.s+c,0,1);g.v=THREE.ColorUtils.clamp(g.v+e,0,1);b.setHSV(g.h,g.s,g.v)},rgbToHsv:function(b,d){var c=b.r,e=b.g,g=b.b,f=Math.max(Math.max(c,e),g),j=Math.min(Math.min(c,e),g);if(j==f)j=c=0;else{var h=f-j;j=h/f;c=c==f?(e-g)/h:e==f?2+(g-c)/h:4+(c-e)/h;c/=6;c<0&&(c+=1);c>1&&(c-=1)}d===undefined&&(d={h:0,s:0,v:0});d.h=c;d.s=j;d.v=f;return d},
clamp:function(b,d,c){return b<d?d:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,d){var c=d instanceof THREE.Mesh,e=b.vertices.length,g=c?d.geometry:d,f=b.vertices,j=g.vertices,h=b.faces,m=g.faces,n=b.faceVertexUvs[0];g=g.faceVertexUvs[0];c&&d.matrixAutoUpdate&&d.updateMatrix();for(var p=0,t=j.length;p<t;p++){var v=new THREE.Vertex(j[p].position.clone());c&&d.matrix.multiplyVector3(v.position);f.push(v)}p=0;for(t=m.length;p<t;p++){j=m[p];var u,w,x=j.vertexNormals;v=j.vertexColors;if(j instanceof THREE.Face3)u=new THREE.Face3(j.a+e,j.b+e,j.c+
e);else j instanceof THREE.Face4&&(u=new THREE.Face4(j.a+e,j.b+e,j.c+e,j.d+e));u.normal.copy(j.normal);c=0;for(f=x.length;c<f;c++){w=x[c];u.vertexNormals.push(w.clone())}u.color.copy(j.color);c=0;for(f=v.length;c<f;c++){w=v[c];u.vertexColors.push(w.clone())}u.materials=j.materials.slice();u.centroid.copy(j.centroid);h.push(u)}p=0;for(t=g.length;p<t;p++){e=g[p];h=[];c=0;for(f=e.length;c<f;c++)h.push(new THREE.UV(e[c].u,e[c].v));n.push(h)}}};
THREE.ImageUtils={loadTexture:function(b,d,c){var e=new Image,g=new THREE.Texture(e,d);e.onload=function(){g.needsUpdate=!0;c&&c(this)};e.src=b;return g},loadTextureCube:function(b,d,c){var e,g=[],f=new THREE.Texture(g,d);d=g.loadCount=0;for(e=b.length;d<e;++d){g[d]=new Image;g[d].onload=function(){g.loadCount+=1;if(g.loadCount==6)f.needsUpdate=!0;c&&c(this)};g[d].src=b[d]}return f}};
THREE.SceneUtils={addMesh:function(b,d,c,e,g,f,j,h,m,n){d=new THREE.Mesh(d,n);d.scale.x=d.scale.y=d.scale.z=c;d.position.x=e;d.position.y=g;d.position.z=f;d.rotation.x=j;d.rotation.y=h;d.rotation.z=m;b.addObject(d);return d},addPanoramaCubeWebGL:function(b,d,c){var e=THREE.ShaderUtils.lib.cube;e.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms});d=new THREE.Mesh(new THREE.Cube(d,d,d,1,1,1,null,!0),c);b.addObject(d);
return d},addPanoramaCube:function(b,d,c){var e=[];e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));d=new THREE.Mesh(new THREE.Cube(d,d,d,1,1,e,!0),
new THREE.MeshFaceMaterial);b.addObject(d);return d},addPanoramaCubePlanes:function(b,d,c){var e=d/2;d=new THREE.Plane(d,d);var g=Math.PI,f=Math.PI/2;THREE.SceneUtils.addMesh(b,d,1,0,0,-e,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,d,1,-e,0,0,0,f,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,d,1,e,0,0,0,-f,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,d,1,0,e,0,f,
0,g,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,d,1,0,-e,0,-f,0,g,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,d){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=d})},traverseHierarchy:function(b,d){var c,e,g=b.children.length;for(e=0;e<g;e++){c=b.children[e];d(c);THREE.SceneUtils.traverseHierarchy(c,d)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var d,c,e,g,f=2*Math.ceil(b*3)+1;f>25&&(f=25);g=(f-1)*0.5;c=Array(f);for(d=e=0;d<f;++d){c[d]=Math.exp(-((d-g)*(d-g))/(2*b*b));e+=c[d]}for(d=0;d<f;++d)c[d]/=e;return c}};
THREE.QuakeCamera=function(b){function d(c,e){return function(){e.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.noFly!==undefined)this.noFly=b.noFly;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.autoForward!==undefined)this.autoForward=b.autoForward;if(b.activeLook!==undefined)this.activeLook=b.activeLook;if(b.heightSpeed!==undefined)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==undefined)this.heightCoef=b.heightCoef;if(b.heightMin!==undefined)this.heightMin=b.heightMin;if(b.heightMax!==undefined)this.heightMax=
b.heightMax;if(b.constrainVertical!==undefined)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==undefined)this.verticalMin=b.verticalMin;if(b.verticalMax!==undefined)this.verticalMax=b.verticalMax;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.moveForward=!1;this.moveBackward=!1;this.moveLeft=!1;this.moveRight=!1;this.freeze=!1;this.mouseDragOn=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=
window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=
function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/
1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var e=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(e+this.autoSpeedFactor));this.moveBackward&&this.translateZ(e);this.moveLeft&&this.translateX(-e);this.moveRight&&this.translateX(e);e=this.tdiff*this.lookSpeed;
this.activeLook||(e=0);this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var g=this.position;c.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=g.y+100*Math.cos(this.phi);c.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=
(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;g=this.position;c.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=g.y+100*Math.cos(this.phi);c.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",d(this,
this.onMouseMove),!1);this.domElement.addEventListener("mousedown",d(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",d(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",d(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",d(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,d){this.matrix.rotateAxis(d);if(this.noFly)d.y=0;this.position.addSelf(d.multiplyScalar(b));this.target.position.addSelf(d.multiplyScalar(b))};
THREE.PathCamera=function(b){function d(n,p,t,v){var u={name:t,fps:0.6,length:v,hierarchy:[]},w,x=p.getControlPointsArray(),D=p.getLength(),z=x.length,I=0;w=z-1;p={parent:-1,keys:[]};p.keys[0]={time:0,pos:x[0],rot:[0,0,0,1],scl:[1,1,1]};p.keys[w]={time:v,pos:x[w],rot:[0,0,0,1],scl:[1,1,1]};for(w=1;w<z-1;w++){I=v*D.chunks[w]/D.total;p.keys[w]={time:I,pos:x[w]}}u.hierarchy[0]=p;THREE.AnimationHandler.add(u);return new THREE.Animation(n,t,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(n,p){var t,
v,u=new THREE.Geometry;for(t=0;t<n.points.length*p;t++){v=t/(n.points.length*p);v=n.getPoint(v);u.vertices[t]=new THREE.Vertex(new THREE.Vector3(v.x,v.y,v.z))}return u}function e(n,p){var t=c(p,10),v=c(p,10),u=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(t,u);particleObj=new THREE.ParticleSystem(v,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);n.addChild(lineObj);particleObj.scale.set(1,1,1);n.addChild(particleObj);v=new THREE.Sphere(1,
16,8);u=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<p.points.length;i++){t=new THREE.Mesh(v,u);t.position.copy(p.points[i]);t.updateMatrix();n.addChild(t)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.005;this.lookVertical=
!0;this.lookHorizontal=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==undefined)this.duration=b.duration*1E3;if(b.waypoints!==undefined)this.waypoints=b.waypoints;if(b.useConstantSpeed!==undefined)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==undefined)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==undefined)this.createDebugPath=b.createDebugPath;
if(b.createDebugDummy!==undefined)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==undefined)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==undefined)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==undefined)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var g=Math.PI*2,f=Math.PI/180;this.update=function(n,p,t){var v,u;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*f;this.theta=this.lon*f;v=this.phi%g;this.phi=v>=0?v:v+g;v=this.verticalAngleMap.srcRange;u=this.verticalAngleMap.dstRange;
this.phi=(this.phi-v[0])*(u[1]-u[0])/(v[1]-v[0])+u[0];v=this.horizontalAngleMap.srcRange;u=this.horizontalAngleMap.dstRange;this.theta=(this.theta-v[0])*(u[1]-u[0])/(v[1]-v[0])+u[0];v=this.target.position;v.x=100*Math.sin(this.phi)*Math.cos(this.theta);v.y=100*Math.cos(this.phi);v.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,n,p,t)};this.onMouseMove=function(n){this.mouseX=n.clientX-this.windowHalfX;this.mouseY=n.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);
this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var j=new THREE.MeshLambertMaterial({color:65280}),h=new THREE.Cube(10,10,20),m=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(h,b);b=new THREE.Mesh(m,j);b.position.set(0,10,0);this.animation=d(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=
d(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&e(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(n,p){return function(){p.apply(n,arguments)}}(this,this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function d(c,e){return function(){e.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.005;this.dragToLook=!1;this.autoForward=!1;this.domElement=document;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==undefined)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==undefined)this.dragToLook=b.dragToLook;if(b.autoForward!==undefined)this.autoForward=
b.autoForward;if(b.domElement!==undefined)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var e=this.getContainerDimensions(),g=e.size[0]/2,f=e.size[1]/2;this.moveState.yawLeft=-(c.clientX-e.offset[0]-g)/g;this.moveState.pitchDown=(c.clientY-
e.offset[1]-f)/f;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var e=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",d(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",d(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",d(this,this.mouseup),!1);window.addEventListener("keydown",d(this,this.keydown),!1);window.addEventListener("keyup",d(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,d,c,e){THREE.Camera.call(this,b,d,c,e);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.useTarget=!1;this.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var g=new THREE.Vector3,f=new THREE.Vector3,j=new THREE.Vector3,h=new THREE.Matrix4,m=!1,n=1,p=0,t=0,v=0,u=0,w=0,x=window.innerWidth/2,D=window.innerHeight/2;this.update=
function(){var z=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=z;this.delta=(z-this.lastUpdate)/1E3;this.lastUpdate=z;if(this.mouseLook){z=this.delta*this.lookSpeed;this.rotateHorizontally(z*u);this.rotateVertically(z*w)}z=this.delta*this.movementSpeed;this.translateZ(z*(p>0||this.autoForward&&!(p<0)?1:p));this.translateX(z*t);this.translateY(z*v);m&&(this.roll+=this.rollSpeed*this.delta*n);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}j.copy(this.forward);f.set(0,1,0);g.cross(f,j).normalize();f.cross(j,g).normalize();this.matrix.n11=g.x;this.matrix.n12=f.x;this.matrix.n13=j.x;this.matrix.n21=g.y;this.matrix.n22=f.y;this.matrix.n23=j.y;this.matrix.n31=g.z;this.matrix.n32=f.z;this.matrix.n33=j.z;h.identity();h.n11=Math.cos(this.roll);h.n12=-Math.sin(this.roll);h.n21=Math.sin(this.roll);h.n22=Math.cos(this.roll);this.matrix.multiplySelf(h);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(z){this.position.x+=this.matrix.n11*z;this.position.y+=this.matrix.n21*z;this.position.z+=this.matrix.n31*z};this.translateY=function(z){this.position.x+=this.matrix.n12*z;this.position.y+=this.matrix.n22*z;this.position.z+=this.matrix.n32*z};this.translateZ=function(z){this.position.x-=this.matrix.n13*z;this.position.y-=
this.matrix.n23*z;this.position.z-=this.matrix.n33*z};this.rotateHorizontally=function(z){g.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);g.multiplyScalar(z);this.forward.subSelf(g);this.forward.normalize()};this.rotateVertically=function(z){f.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);f.multiplyScalar(z);this.forward.addSelf(f);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(z){z.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(z){u=(z.clientX-x)/window.innerWidth;w=(z.clientY-D)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(z){z.preventDefault();z.stopPropagation();switch(z.button){case 0:p=1;break;case 2:p=-1}},!1);this.domElement.addEventListener("mouseup",function(z){z.preventDefault();z.stopPropagation();switch(z.button){case 0:p=0;break;case 2:p=0}},!1);this.domElement.addEventListener("keydown",function(z){switch(z.keyCode){case 38:case 87:p=1;break;case 37:case 65:t=-1;break;
case 40:case 83:p=-1;break;case 39:case 68:t=1;break;case 81:m=!0;n=1;break;case 69:m=!0;n=-1;break;case 82:v=1;break;case 70:v=-1}},!1);this.domElement.addEventListener("keyup",function(z){switch(z.keyCode){case 38:case 87:p=0;break;case 37:case 65:t=0;break;case 40:case 83:p=0;break;case 39:case 68:t=0;break;case 81:m=!1;break;case 69:m=!1;break;case 82:v=0;break;case 70:v=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.Cube=function(b,d,c,e,g,f,j,h,m){function n(D,z,I,B,L,A,C,E){var M,N,K=e||1,ea=g||1,o=L/2,ia=A/2,Z=p.vertices.length;if(D=="x"&&z=="y"||D=="y"&&z=="x")M="z";else if(D=="x"&&z=="z"||D=="z"&&z=="x"){M="y";ea=f||1}else if(D=="z"&&z=="y"||D=="y"&&z=="z"){M="x";K=f||1}var oa=K+1,ha=ea+1;L/=K;var X=A/ea;for(N=0;N<ha;N++)for(A=0;A<oa;A++){var $=new THREE.Vector3;$[D]=(A*L-o)*I;$[z]=(N*X-ia)*B;$[M]=C;p.vertices.push(new THREE.Vertex($))}for(N=0;N<ea;N++)for(A=0;A<K;A++){p.faces.push(new THREE.Face4(A+
oa*N+Z,A+oa*(N+1)+Z,A+1+oa*(N+1)+Z,A+1+oa*N+Z,null,null,E));p.faceVertexUvs[0].push([new THREE.UV(A/K,N/ea),new THREE.UV(A/K,(N+1)/ea),new THREE.UV((A+1)/K,(N+1)/ea),new THREE.UV((A+1)/K,N/ea)])}}THREE.Geometry.call(this);var p=this,t=b/2,v=d/2,u=c/2;h=h?-1:1;if(j!==undefined)if(j instanceof Array)this.materials=j;else{this.materials=[];for(var w=0;w<6;w++)this.materials.push([j])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(m!=undefined)for(var x in m)this.sides[x]!=
undefined&&(this.sides[x]=m[x]);this.sides.px&&n("z","y",1*h,-1,c,d,-t,this.materials[0]);this.sides.nx&&n("z","y",-1*h,-1,c,d,t,this.materials[1]);this.sides.py&&n("x","z",1*h,1,b,c,v,this.materials[2]);this.sides.ny&&n("x","z",1*h,-1,b,c,-v,this.materials[3]);this.sides.pz&&n("x","y",1*h,-1,b,d,u,this.materials[4]);this.sides.nz&&n("x","y",-1*h,-1,b,d,-u,this.materials[5]);(function(){for(var D=[],z=[],I=0,B=p.vertices.length;I<B;I++){for(var L=p.vertices[I],A=!1,C=0,E=D.length;C<E;C++){var M=D[C];
if(L.position.x==M.position.x&&L.position.y==M.position.y&&L.position.z==M.position.z){z[I]=C;A=!0;break}}if(!A){z[I]=D.length;D.push(new THREE.Vertex(L.position.clone()))}}I=0;for(B=p.faces.length;I<B;I++){L=p.faces[I];L.a=z[L.a];L.b=z[L.b];L.c=z[L.c];L.d=z[L.d]}p.vertices=D})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,d,c,e,g,f){function j(v,u,w){h.vertices.push(new THREE.Vertex(new THREE.Vector3(v,u,w)))}THREE.Geometry.call(this);var h=this,m,n=Math.PI*2,p=e/2;for(m=0;m<b;m++)j(Math.sin(n*m/b)*d,Math.cos(n*m/b)*d,-p);for(m=0;m<b;m++)j(Math.sin(n*m/b)*c,Math.cos(n*m/b)*c,p);for(m=0;m<b;m++)h.faces.push(new THREE.Face4(m,m+b,b+(m+1)%b,(m+1)%b));if(c>0){j(0,0,-p-(f||0));for(m=b;m<b+b/2;m++)h.faces.push(new THREE.Face4(2*b,(2*m-2*b)%b,(2*m-2*b+1)%b,(2*m-2*b+2)%b))}if(d>0){j(0,0,p+(g||0));
for(m=b+b/2;m<2*b;m++)h.faces.push(new THREE.Face4(2*b+1,(2*m-2*b+2)%b+b,(2*m-2*b+1)%b+b,(2*m-2*b)%b+b))}m=0;for(b=this.faces.length;m<b;m++){d=[];c=this.faces[m];g=this.vertices[c.a];f=this.vertices[c.b];p=this.vertices[c.c];var t=this.vertices[c.d];d.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/n,0.5+g.position.z/e));d.push(new THREE.UV(0.5+Math.atan2(f.position.x,f.position.y)/n,0.5+f.position.z/e));d.push(new THREE.UV(0.5+Math.atan2(p.position.x,p.position.y)/n,0.5+p.position.z/
e));c instanceof THREE.Face4&&d.push(new THREE.UV(0.5+Math.atan2(t.position.x,t.position.y)/n,0.5+t.position.z/e));this.faceVertexUvs[0].push(d)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function d(t,v,u){var w=Math.sqrt(t*t+v*v+u*u);return g.vertices.push(new THREE.Vertex(new THREE.Vector3(t/w,v/w,u/w)))-1}function c(t,v,u,w){w.faces.push(new THREE.Face3(t,v,u))}function e(t,v){var u=g.vertices[t].position,w=g.vertices[v].position;return d((u.x+w.x)/2,(u.y+w.y)/2,(u.z+w.z)/2)}var g=this,f=new THREE.Geometry,j;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;d(-1,b,0);d(1,b,0);d(-1,-b,0);d(1,-b,0);d(0,-1,b);d(0,1,b);d(0,-1,-b);d(0,
1,-b);d(b,0,-1);d(b,0,1);d(-b,0,-1);d(-b,0,1);c(0,11,5,f);c(0,5,1,f);c(0,1,7,f);c(0,7,10,f);c(0,10,11,f);c(1,5,9,f);c(5,11,4,f);c(11,10,2,f);c(10,7,6,f);c(7,1,8,f);c(3,9,4,f);c(3,4,2,f);c(3,2,6,f);c(3,6,8,f);c(3,8,9,f);c(4,9,5,f);c(2,4,11,f);c(6,2,10,f);c(8,6,7,f);c(9,8,1,f);for(b=0;b<this.subdivisions;b++){j=new THREE.Geometry;for(var h in f.faces){var m=e(f.faces[h].a,f.faces[h].b),n=e(f.faces[h].b,f.faces[h].c),p=e(f.faces[h].c,f.faces[h].a);c(f.faces[h].a,m,p,j);c(f.faces[h].b,n,m,j);c(f.faces[h].c,
p,n,j);c(m,n,p,j)}f.faces=j.faces}g.faces=f.faces;delete f;delete j;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,d,c){THREE.Geometry.call(this);this.steps=d||12;this.angle=c||2*Math.PI;d=this.angle/this.steps;c=[];for(var e=[],g=[],f=[],j=(new THREE.Matrix4).setRotationZ(d),h=0;h<b.length;h++){this.vertices.push(new THREE.Vertex(b[h]));c[h]=b[h].clone();e[h]=this.vertices.length-1}for(var m=0;m<=this.angle+0.001;m+=d){for(h=0;h<c.length;h++)if(m<this.angle){c[h]=j.multiplyVector3(c[h].clone());this.vertices.push(new THREE.Vertex(c[h]));g[h]=this.vertices.length-1}else g=f;m==0&&(f=e);
for(h=0;h<e.length-1;h++){this.faces.push(new THREE.Face4(g[h],g[h+1],e[h+1],e[h]));this.faceVertexUvs[0].push([new THREE.UV(1-m/this.angle,h/b.length),new THREE.UV(1-m/this.angle,(h+1)/b.length),new THREE.UV(1-(m-d)/this.angle,(h+1)/b.length),new THREE.UV(1-(m-d)/this.angle,h/b.length)])}e=g;g=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,d,c,e){THREE.Geometry.call(this);var g,f=b/2,j=d/2;c=c||1;e=e||1;var h=c+1,m=e+1;b/=c;var n=d/e;for(g=0;g<m;g++)for(d=0;d<h;d++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(d*b-f,-(g*n-j),0)));for(g=0;g<e;g++)for(d=0;d<c;d++){this.faces.push(new THREE.Face4(d+h*g,d+h*(g+1),d+1+h*(g+1),d+1+h*g));this.faceVertexUvs[0].push([new THREE.UV(d/c,g/e),new THREE.UV(d/c,(g+1)/e),new THREE.UV((d+1)/c,(g+1)/e),new THREE.UV((d+1)/c,g/e)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,d,c){THREE.Geometry.call(this);var e,g=Math.PI,f=Math.max(3,d||8),j=Math.max(2,c||6);d=[];for(c=0;c<j+1;c++){e=c/j;var h=b*Math.cos(e*g),m=b*Math.sin(e*g),n=[],p=0;for(e=0;e<f;e++){var t=2*e/f,v=m*Math.sin(t*g);t=m*Math.cos(t*g);(c==0||c==j)&&e>0||(p=this.vertices.push(new THREE.Vertex(new THREE.Vector3(t,h,v)))-1);n.push(p)}d.push(n)}var u,w,x;g=d.length;for(c=0;c<g;c++){f=d[c].length;if(c>0)for(e=0;e<f;e++){n=e==f-1;j=d[c][n?0:e+1];h=d[c][n?f-1:e];m=d[c-1][n?f-1:e];n=d[c-
1][n?0:e+1];v=c/(g-1);u=(c-1)/(g-1);w=(e+1)/f;t=e/f;p=new THREE.UV(1-w,v);v=new THREE.UV(1-t,v);t=new THREE.UV(1-t,u);var D=new THREE.UV(1-w,u);if(c<d.length-1){u=this.vertices[j].position.clone();w=this.vertices[h].position.clone();x=this.vertices[m].position.clone();u.normalize();w.normalize();x.normalize();this.faces.push(new THREE.Face3(j,h,m,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(x.x,x.y,x.z)]));this.faceVertexUvs[0].push([p,v,t])}if(c>1){u=this.vertices[j].position.clone();
w=this.vertices[m].position.clone();x=this.vertices[n].position.clone();u.normalize();w.normalize();x.normalize();this.faces.push(new THREE.Face3(j,m,n,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(x.x,x.y,x.z)]));this.faceVertexUvs[0].push([p,t,D])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,d,c,e){THREE.Geometry.call(this);this.radius=b||100;this.tube=d||40;this.segmentsR=c||8;this.segmentsT=e||6;b=[];for(d=0;d<=this.segmentsR;++d)for(c=0;c<=this.segmentsT;++c){e=c/this.segmentsT*2*Math.PI;var g=d/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(g))*Math.cos(e),(this.radius+this.tube*Math.cos(g))*Math.sin(e),this.tube*Math.sin(g))));b.push([c/this.segmentsT,1-d/this.segmentsR])}for(d=1;d<=this.segmentsR;++d)for(c=
1;c<=this.segmentsT;++c){e=(this.segmentsT+1)*d+c;g=(this.segmentsT+1)*d+c-1;var f=(this.segmentsT+1)*(d-1)+c-1,j=(this.segmentsT+1)*(d-1)+c;this.faces.push(new THREE.Face4(e,g,f,j));this.faceVertexUvs[0].push([new THREE.UV(b[e][0],b[e][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[f][0],b[f][1]),new THREE.UV(b[j][0],b[j][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,d,c,e,g,f,j){function h(t,v,u,w,x,D){v=u/w*t;u=Math.cos(v);return new THREE.Vector3(x*(2+u)*0.5*Math.cos(t),x*(2+u)*Math.sin(t)*0.5,D*x*Math.sin(v)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=d||40;this.segmentsR=c||64;this.segmentsT=e||8;this.p=g||2;this.q=f||3;this.heightScale=j||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;e=new THREE.Vector3;f=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(d=0;d<this.segmentsT;++d){var m=
b/this.segmentsR*2*this.p*Math.PI;j=d/this.segmentsT*2*Math.PI;g=h(m,j,this.q,this.p,this.radius,this.heightScale);m=h(m+0.01,j,this.q,this.p,this.radius,this.heightScale);c.x=m.x-g.x;c.y=m.y-g.y;c.z=m.z-g.z;e.x=m.x+g.x;e.y=m.y+g.y;e.z=m.z+g.z;f.cross(c,e);e.cross(f,c);f.normalize();e.normalize();m=-this.tube*Math.cos(j);j=this.tube*Math.sin(j);g.x+=m*e.x+j*f.x;g.y+=m*e.y+j*f.y;g.z+=m*e.z+j*f.z;this.grid[b][d]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(g.x,g.y,g.z)))-1}}for(b=0;b<this.segmentsR;++b)for(d=
0;d<this.segmentsT;++d){e=(b+1)%this.segmentsR;f=(d+1)%this.segmentsT;g=this.grid[b][d];c=this.grid[e][d];e=this.grid[e][f];f=this.grid[b][f];j=new THREE.UV(b/this.segmentsR,d/this.segmentsT);m=new THREE.UV((b+1)/this.segmentsR,d/this.segmentsT);var n=new THREE.UV((b+1)/this.segmentsR,(d+1)/this.segmentsT),p=new THREE.UV(b/this.segmentsR,(d+1)/this.segmentsT);this.faces.push(new THREE.Face4(g,c,e,f));this.faceVertexUvs[0].push([j,m,n,p])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var d="Loaded ";d+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=d},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,d,c){b.materials=[];for(var e=0;e<d.length;++e)b.materials[e]=[THREE.Loader.prototype.createMaterial(d[e],c)]},createMaterial:function(b,d){function c(h){h=Math.log(h)/Math.LN2;return Math.floor(h)==h}function e(h,m){var n=new Image;n.onload=function(){if(!c(this.width)||!c(this.height)){var p=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),t=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));h.image.width=p;h.image.height=t;h.image.getContext("2d").drawImage(this,0,0,p,t)}else h.image=this;h.needsUpdate=!0};n.src=m}var g,f,j;g="MeshLambertMaterial";f={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};if(b.shading)if(b.shading=="Phong")g="MeshPhongMaterial";else b.shading=="Basic"&&(g="MeshBasicMaterial");if(b.blending)if(b.blending=="Additive")f.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")f.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")f.blending=THREE.MultiplyBlending;if(b.transparent!==undefined||b.opacity<1)f.transparent=b.transparent;if(b.depthTest!==undefined)f.depthTest=b.depthTest;if(b.vertexColors!==undefined)if(b.vertexColors=="face")f.vertexColors=THREE.FaceColors;else if(b.vertexColors)f.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&d){j=document.createElement("canvas");f.map=new THREE.Texture(j);f.map.sourceFile=b.mapDiffuse;e(f.map,d+"/"+b.mapDiffuse)}else if(b.colorDiffuse){j=(b.colorDiffuse[0]*255<<
16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255;f.color=j;f.opacity=b.transparency}else if(b.DbgColor)f.color=b.DbgColor;if(b.mapLightmap&&d){j=document.createElement("canvas");f.lightMap=new THREE.Texture(j);f.lightMap.sourceFile=b.mapLightmap;e(f.lightMap,d+"/"+b.mapLightmap)}return new THREE[g](f)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var d=this,c=b.model,e=b.callback,g=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(f){d.createModel(f.data,e,g);d.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,d,c){var e=new THREE.Geometry,g=b.scale!==undefined?1/b.scale:1;this.init_materials(e,b.materials,c);(function(f){if(b.version===undefined||b.version!=2)console.error("Deprecated file format.");else{var j,h,m,n,p,t,v,u,w,x,D,z,I,B,L=b.faces;t=b.vertices;var A=b.normals,C=b.colors,E=0;for(j=0;j<b.uvs.length;j++)b.uvs[j].length&&E++;for(j=0;j<E;j++){e.faceUvs[j]=[];e.faceVertexUvs[j]=[]}n=0;for(p=t.length;n<p;){v=new THREE.Vertex;v.position.x=t[n++]*
f;v.position.y=t[n++]*f;v.position.z=t[n++]*f;e.vertices.push(v)}n=0;for(p=L.length;n<p;){f=L[n++];t=f&1;m=f&2;j=f&4;h=f&8;u=f&16;v=f&32;x=f&64;f&=128;if(t){D=new THREE.Face4;D.a=L[n++];D.b=L[n++];D.c=L[n++];D.d=L[n++];t=4}else{D=new THREE.Face3;D.a=L[n++];D.b=L[n++];D.c=L[n++];t=3}if(m){m=L[n++];D.materials=e.materials[m]}m=e.faces.length;if(j)for(j=0;j<E;j++){z=b.uvs[j];w=L[n++];B=z[w*2];w=z[w*2+1];e.faceUvs[j][m]=new THREE.UV(B,w)}if(h)for(j=0;j<E;j++){z=b.uvs[j];I=[];for(h=0;h<t;h++){w=L[n++];
B=z[w*2];w=z[w*2+1];I[h]=new THREE.UV(B,w)}e.faceVertexUvs[j][m]=I}if(u){u=L[n++]*3;h=new THREE.Vector3;h.x=A[u++];h.y=A[u++];h.z=A[u];D.normal=h}if(v)for(j=0;j<t;j++){u=L[n++]*3;h=new THREE.Vector3;h.x=A[u++];h.y=A[u++];h.z=A[u];D.vertexNormals.push(h)}if(x){v=L[n++];v=new THREE.Color(C[v]);D.color=v}if(f)for(j=0;j<t;j++){v=L[n++];v=new THREE.Color(C[v]);D.vertexColors.push(v)}e.faces.push(D)}}})(g);(function(){var f,j,h,m;if(b.skinWeights){f=0;for(j=b.skinWeights.length;f<j;f+=2){h=b.skinWeights[f];
m=b.skinWeights[f+1];e.skinWeights.push(new THREE.Vector4(h,m,0,0))}}if(b.skinIndices){f=0;for(j=b.skinIndices.length;f<j;f+=2){h=b.skinIndices[f];m=b.skinIndices[f+1];e.skinIndices.push(new THREE.Vector4(h,m,0,0))}}e.bones=b.bones;e.animation=b.animation})();(function(f){if(b.morphTargets!==undefined){var j,h,m,n,p,t,v,u,w;j=0;for(h=b.morphTargets.length;j<h;j++){e.morphTargets[j]={};e.morphTargets[j].name=b.morphTargets[j].name;e.morphTargets[j].vertices=[];u=e.morphTargets[j].vertices;w=b.morphTargets[j].vertices;
m=0;for(n=w.length;m<n;m+=3){p=w[m]*f;t=w[m+1]*f;v=w[m+2]*f;u.push(new THREE.Vertex(new THREE.Vector3(p,t,v)))}}}if(b.morphColors!==undefined){j=0;for(h=b.morphColors.length;j<h;j++){e.morphColors[j]={};e.morphColors[j].name=b.morphColors[j].name;e.morphColors[j].colors=[];n=e.morphColors[j].colors;p=b.morphColors[j].colors;f=0;for(m=p.length;f<m;f+=3){t=new THREE.Color(16755200);t.setRGB(p[f],p[f+1],p[f+2]);n.push(t)}}}})(g);(function(){if(b.edges!==undefined){var f,j,h;for(f=0;f<b.edges.length;f+=
2){j=b.edges[f];h=b.edges[f+1];e.edges.push(new THREE.Edge(e.vertices[j],e.vertices[h],j,h))}}})();e.computeFaceNormals();d(e)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var d=b.model,c=b.callback,e=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(d),g=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(d);b=(new Date).getTime();d=new Worker(d);var f=this.showProgress?THREE.Loader.prototype.updateProgress:null;d.onmessage=function(j){THREE.BinaryLoader.prototype.loadAjaxBuffers(j.data.buffers,j.data.materials,c,g,e,f)};d.onerror=function(j){alert("worker.onerror: "+j.message+"\n"+j.data);j.preventDefault()};
d.postMessage(b)},loadAjaxBuffers:function(b,d,c,e,g,f){var j=new XMLHttpRequest,h=e+"/"+b,m=0;j.onreadystatechange=function(){if(j.readyState==4)j.status==200||j.status==0?THREE.BinaryLoader.prototype.createBinModel(j.responseText,c,g,d):alert("Couldn't load ["+h+"] ["+j.status+"]");else if(j.readyState==3){if(f){m==0&&(m=j.getResponseHeader("Content-Length"));f({total:m,loaded:j.responseText.length})}}else j.readyState==2&&(m=j.getResponseHeader("Content-Length"))};j.open("GET",h,!0);j.overrideMimeType("text/plain; charset=x-user-defined");
j.setRequestHeader("Content-Type","text/plain");j.send(null)},createBinModel:function(b,d,c,e){var g=function(f){function j(Y,ka){var aa=p(Y,ka),ca=p(Y,ka+1),Na=p(Y,ka+2),bb=p(Y,ka+3),y=(bb<<1&255|Na>>7)-127;aa|=(Na&127)<<16|ca<<8;if(aa==0&&y==-127)return 0;return(1-2*(bb>>7))*(1+aa*Math.pow(2,-23))*Math.pow(2,y)}function h(Y,ka){var aa=p(Y,ka),ca=p(Y,ka+1),Na=p(Y,ka+2);return(p(Y,ka+3)<<24)+(Na<<16)+(ca<<8)+aa}function m(Y,ka){var aa=p(Y,ka);return(p(Y,ka+1)<<8)+aa}function n(Y,ka){var aa=p(Y,ka);
return aa>127?aa-256:aa}function p(Y,ka){return Y.charCodeAt(ka)&255}function t(Y){var ka,aa,ca;ka=h(b,Y);aa=h(b,Y+C);ca=h(b,Y+E);Y=m(b,Y+M);THREE.BinaryLoader.prototype.f3(z,ka,aa,ca,Y)}function v(Y){var ka,aa,ca,Na,bb,y;ka=h(b,Y);aa=h(b,Y+C);ca=h(b,Y+E);Na=m(b,Y+M);bb=h(b,Y+N);y=h(b,Y+K);Y=h(b,Y+ea);THREE.BinaryLoader.prototype.f3n(z,L,ka,aa,ca,Na,bb,y,Y)}function u(Y){var ka,aa,ca,Na;ka=h(b,Y);aa=h(b,Y+o);ca=h(b,Y+ia);Na=h(b,Y+Z);Y=m(b,Y+oa);THREE.BinaryLoader.prototype.f4(z,ka,aa,ca,Na,Y)}function w(Y){var ka,
aa,ca,Na,bb,y,O,G;ka=h(b,Y);aa=h(b,Y+o);ca=h(b,Y+ia);Na=h(b,Y+Z);bb=m(b,Y+oa);y=h(b,Y+ha);O=h(b,Y+X);G=h(b,Y+$);Y=h(b,Y+na);THREE.BinaryLoader.prototype.f4n(z,L,ka,aa,ca,Na,bb,y,O,G,Y)}function x(Y){var ka,aa;ka=h(b,Y);aa=h(b,Y+pa);Y=h(b,Y+ta);THREE.BinaryLoader.prototype.uv3(z.faceVertexUvs[0],A[ka*2],A[ka*2+1],A[aa*2],A[aa*2+1],A[Y*2],A[Y*2+1])}function D(Y){var ka,aa,ca;ka=h(b,Y);aa=h(b,Y+xa);ca=h(b,Y+ua);Y=h(b,Y+Ga);THREE.BinaryLoader.prototype.uv4(z.faceVertexUvs[0],A[ka*2],A[ka*2+1],A[aa*2],
A[aa*2+1],A[ca*2],A[ca*2+1],A[Y*2],A[Y*2+1])}var z=this,I=0,B,L=[],A=[],C,E,M,N,K,ea,o,ia,Z,oa,ha,X,$,na,pa,ta,xa,ua,Ga,Ca,qa,za,Ka,Ta,Xa;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(z,e,f);B={signature:b.substr(I,8),header_bytes:p(b,I+8),vertex_coordinate_bytes:p(b,I+9),normal_coordinate_bytes:p(b,I+10),uv_coordinate_bytes:p(b,I+11),vertex_index_bytes:p(b,I+12),normal_index_bytes:p(b,I+13),uv_index_bytes:p(b,I+14),material_index_bytes:p(b,I+15),nvertices:h(b,I+16),nnormals:h(b,
I+16+4),nuvs:h(b,I+16+8),ntri_flat:h(b,I+16+12),ntri_smooth:h(b,I+16+16),ntri_flat_uv:h(b,I+16+20),ntri_smooth_uv:h(b,I+16+24),nquad_flat:h(b,I+16+28),nquad_smooth:h(b,I+16+32),nquad_flat_uv:h(b,I+16+36),nquad_smooth_uv:h(b,I+16+40)};I+=B.header_bytes;C=B.vertex_index_bytes;E=B.vertex_index_bytes*2;M=B.vertex_index_bytes*3;N=B.vertex_index_bytes*3+B.material_index_bytes;K=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes;ea=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*
2;o=B.vertex_index_bytes;ia=B.vertex_index_bytes*2;Z=B.vertex_index_bytes*3;oa=B.vertex_index_bytes*4;ha=B.vertex_index_bytes*4+B.material_index_bytes;X=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes;$=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*2;na=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*3;pa=B.uv_index_bytes;ta=B.uv_index_bytes*2;xa=B.uv_index_bytes;ua=B.uv_index_bytes*2;Ga=B.uv_index_bytes*3;f=B.vertex_index_bytes*3+B.material_index_bytes;
Xa=B.vertex_index_bytes*4+B.material_index_bytes;Ca=B.ntri_flat*f;qa=B.ntri_smooth*(f+B.normal_index_bytes*3);za=B.ntri_flat_uv*(f+B.uv_index_bytes*3);Ka=B.ntri_smooth_uv*(f+B.normal_index_bytes*3+B.uv_index_bytes*3);Ta=B.nquad_flat*Xa;f=B.nquad_smooth*(Xa+B.normal_index_bytes*4);Xa=B.nquad_flat_uv*(Xa+B.uv_index_bytes*4);I+=function(Y){for(var ka,aa,ca,Na=B.vertex_coordinate_bytes*3,bb=Y+B.nvertices*Na;Y<bb;Y+=Na){ka=j(b,Y);aa=j(b,Y+B.vertex_coordinate_bytes);ca=j(b,Y+B.vertex_coordinate_bytes*2);
THREE.BinaryLoader.prototype.v(z,ka,aa,ca)}return B.nvertices*Na}(I);I+=function(Y){for(var ka,aa,ca,Na=B.normal_coordinate_bytes*3,bb=Y+B.nnormals*Na;Y<bb;Y+=Na){ka=n(b,Y);aa=n(b,Y+B.normal_coordinate_bytes);ca=n(b,Y+B.normal_coordinate_bytes*2);L.push(ka/127,aa/127,ca/127)}return B.nnormals*Na}(I);I+=function(Y){for(var ka,aa,ca=B.uv_coordinate_bytes*2,Na=Y+B.nuvs*ca;Y<Na;Y+=ca){ka=j(b,Y);aa=j(b,Y+B.uv_coordinate_bytes);A.push(ka,aa)}return B.nuvs*ca}(I);Ca=I+Ca;qa=Ca+qa;za=qa+za;Ka=za+Ka;Ta=Ka+
Ta;f=Ta+f;Xa=f+Xa;(function(Y){var ka,aa=B.vertex_index_bytes*3+B.material_index_bytes,ca=aa+B.uv_index_bytes*3,Na=Y+B.ntri_flat_uv*ca;for(ka=Y;ka<Na;ka+=ca){t(ka);x(ka+aa)}return Na-Y})(qa);(function(Y){var ka,aa=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*3,ca=aa+B.uv_index_bytes*3,Na=Y+B.ntri_smooth_uv*ca;for(ka=Y;ka<Na;ka+=ca){v(ka);x(ka+aa)}return Na-Y})(za);(function(Y){var ka,aa=B.vertex_index_bytes*4+B.material_index_bytes,ca=aa+B.uv_index_bytes*4,Na=Y+B.nquad_flat_uv*
ca;for(ka=Y;ka<Na;ka+=ca){u(ka);D(ka+aa)}return Na-Y})(f);(function(Y){var ka,aa=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*4,ca=aa+B.uv_index_bytes*4,Na=Y+B.nquad_smooth_uv*ca;for(ka=Y;ka<Na;ka+=ca){w(ka);D(ka+aa)}return Na-Y})(Xa);(function(Y){var ka,aa=B.vertex_index_bytes*3+B.material_index_bytes,ca=Y+B.ntri_flat*aa;for(ka=Y;ka<ca;ka+=aa)t(ka);return ca-Y})(I);(function(Y){var ka,aa=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*3,ca=Y+B.ntri_smooth*
aa;for(ka=Y;ka<ca;ka+=aa)v(ka);return ca-Y})(Ca);(function(Y){var ka,aa=B.vertex_index_bytes*4+B.material_index_bytes,ca=Y+B.nquad_flat*aa;for(ka=Y;ka<ca;ka+=aa)u(ka);return ca-Y})(Ka);(function(Y){var ka,aa=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*4,ca=Y+B.nquad_smooth*aa;for(ka=Y;ka<ca;ka+=aa)w(ka);return ca-Y})(Ta);this.computeCentroids();this.computeFaceNormals()};g.prototype=new THREE.Geometry;g.prototype.constructor=g;d(new g(c))},v:function(b,d,c,e){b.vertices.push(new THREE.Vertex(new THREE.Vector3(d,
c,e)))},f3:function(b,d,c,e,g){b.faces.push(new THREE.Face3(d,c,e,null,null,b.materials[g]))},f4:function(b,d,c,e,g,f){b.faces.push(new THREE.Face4(d,c,e,g,null,null,b.materials[f]))},f3n:function(b,d,c,e,g,f,j,h,m){f=b.materials[f];var n=d[h*3],p=d[h*3+1];h=d[h*3+2];var t=d[m*3],v=d[m*3+1];m=d[m*3+2];b.faces.push(new THREE.Face3(c,e,g,[new THREE.Vector3(d[j*3],d[j*3+1],d[j*3+2]),new THREE.Vector3(n,p,h),new THREE.Vector3(t,v,m)],null,f))},f4n:function(b,d,c,e,g,f,j,h,m,n,p){j=b.materials[j];var t=
d[m*3],v=d[m*3+1];m=d[m*3+2];var u=d[n*3],w=d[n*3+1];n=d[n*3+2];var x=d[p*3],D=d[p*3+1];p=d[p*3+2];b.faces.push(new THREE.Face4(c,e,g,f,[new THREE.Vector3(d[h*3],d[h*3+1],d[h*3+2]),new THREE.Vector3(t,v,m),new THREE.Vector3(u,w,n),new THREE.Vector3(x,D,p)],null,j))},uv3:function(b,d,c,e,g,f,j){var h=[];h.push(new THREE.UV(d,c));h.push(new THREE.UV(e,g));h.push(new THREE.UV(f,j));b.push(h)},uv4:function(b,d,c,e,g,f,j,h,m){var n=[];n.push(new THREE.UV(d,c));n.push(new THREE.UV(e,g));n.push(new THREE.UV(f,
j));n.push(new THREE.UV(h,m));b.push(n)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,d){var c=this,e=new Worker(b);e.postMessage(0);var g=THREE.Loader.prototype.extractUrlbase(b);e.onmessage=function(f){function j(pa,ta){return ta=="relativeToHTML"?pa:g+"/"+pa}function h(){for(u in K.objects)if(!ha.objects[u]){I=K.objects[u];if(I.geometry!==undefined){if(C=ha.geometries[I.geometry]){N=[];for(na=0;na<I.materials.length;na++)N[na]=ha.materials[I.materials[na]];B=I.position;r=I.rotation;q=I.quaternion;s=I.scale;q=0;N.length==0&&(N[0]=new THREE.MeshFaceMaterial);
N.length>1&&(N=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(C,N);object.name=u;object.position.set(B[0],B[1],B[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=I.visible;ha.scene.addObject(object);ha.objects[u]=object;if(I.meshCollider){var pa=THREE.CollisionUtils.MeshColliderWBox(object);ha.scene.collisions.colliders.push(pa)}if(I.castsShadow){pa=new THREE.ShadowVolume(C);ha.scene.addChild(pa);
pa.position=object.position;pa.rotation=object.rotation;pa.scale=object.scale}if(I.trigger&&I.trigger.toLowerCase()!="none"){pa={type:I.trigger,object:I};ha.triggers[object.name]=pa}}}else{B=I.position;r=I.rotation;q=I.quaternion;s=I.scale;q=0;object=new THREE.Object3D;object.name=u;object.position.set(B[0],B[1],B[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=I.visible!==undefined?
I.visible:!1;ha.scene.addObject(object);ha.objects[u]=object;ha.empties[u]=object;if(I.trigger&&I.trigger.toLowerCase()!="none"){pa={type:I.trigger,object:I};ha.triggers[object.name]=pa}}}}function m(pa){return function(ta){ha.geometries[pa]=ta;h();o-=1;c.onLoadComplete();p()}}function n(pa){return function(ta){ha.geometries[pa]=ta}}function p(){c.callbackProgress({totalModels:Z,totalTextures:oa,loadedModels:Z-o,loadedTextures:oa-ia},ha);c.onLoadProgress();o==0&&ia==0&&d(ha)}var t,v,u,w,x,D,z,I,B,
L,A,C,E,M,N,K,ea,o,ia,Z,oa,ha;K=f.data;f=new THREE.BinaryLoader;ea=new THREE.JSONLoader;ia=o=0;ha={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var X=!1;for(u in K.objects){I=K.objects[u];if(I.meshCollider){X=!0;break}}if(X)ha.scene.collisions=new THREE.CollisionSystem;if(K.transform){X=K.transform.position;L=K.transform.rotation;var $=K.transform.scale;X&&ha.scene.position.set(X[0],X[1],X[2]);L&&ha.scene.rotation.set(L[0],
L[1],L[2]);$&&ha.scene.scale.set($[0],$[1],$[2]);(X||L||$)&&ha.scene.updateMatrix()}X=function(){ia-=1;p();c.onLoadComplete()};for(x in K.cameras){L=K.cameras[x];if(L.type=="perspective")E=new THREE.Camera(L.fov,L.aspect,L.near,L.far);else if(L.type=="ortho"){E=new THREE.Camera;E.projectionMatrix=THREE.Matrix4.makeOrtho(L.left,L.right,L.top,L.bottom,L.near,L.far)}B=L.position;L=L.target;E.position.set(B[0],B[1],B[2]);E.target.position.set(L[0],L[1],L[2]);ha.cameras[x]=E}for(w in K.lights){x=K.lights[w];
E=x.color!==undefined?x.color:16777215;L=x.intensity!==undefined?x.intensity:1;if(x.type=="directional"){B=x.direction;light=new THREE.DirectionalLight(E,L);light.position.set(B[0],B[1],B[2]);light.position.normalize()}else if(x.type=="point"){B=x.position;light=new THREE.PointLight(E,L);light.position.set(B[0],B[1],B[2])}ha.scene.addLight(light);ha.lights[w]=light}for(D in K.fogs){w=K.fogs[D];if(w.type=="linear")M=new THREE.Fog(0,w.near,w.far);else w.type=="exp2"&&(M=new THREE.FogExp2(0,w.density));
L=w.color;M.color.setRGB(L[0],L[1],L[2]);ha.fogs[D]=M}if(ha.cameras&&K.defaults.camera)ha.currentCamera=ha.cameras[K.defaults.camera];if(ha.fogs&&K.defaults.fog)ha.scene.fog=ha.fogs[K.defaults.fog];L=K.defaults.bgcolor;ha.bgColor=new THREE.Color;ha.bgColor.setRGB(L[0],L[1],L[2]);ha.bgColorAlpha=K.defaults.bgalpha;for(t in K.geometries){D=K.geometries[t];if(D.type=="bin_mesh"||D.type=="ascii_mesh"){o+=1;c.onLoadStart()}}Z=o;for(t in K.geometries){D=K.geometries[t];if(D.type=="cube"){C=new THREE.Cube(D.width,
D.height,D.depth,D.segmentsWidth,D.segmentsHeight,D.segmentsDepth,null,D.flipped,D.sides);ha.geometries[t]=C}else if(D.type=="plane"){C=new THREE.Plane(D.width,D.height,D.segmentsWidth,D.segmentsHeight);ha.geometries[t]=C}else if(D.type=="sphere"){C=new THREE.Sphere(D.radius,D.segmentsWidth,D.segmentsHeight);ha.geometries[t]=C}else if(D.type=="cylinder"){C=new THREE.Cylinder(D.numSegs,D.topRad,D.botRad,D.height,D.topOffset,D.botOffset);ha.geometries[t]=C}else if(D.type=="torus"){C=new THREE.Torus(D.radius,
D.tube,D.segmentsR,D.segmentsT);ha.geometries[t]=C}else if(D.type=="icosahedron"){C=new THREE.Icosahedron(D.subdivisions);ha.geometries[t]=C}else if(D.type=="bin_mesh")f.load({model:j(D.url,K.urlBaseType),callback:m(t)});else if(D.type=="ascii_mesh")ea.load({model:j(D.url,K.urlBaseType),callback:m(t)});else D.type=="embedded_mesh"&&(D=K.embeds[D.id])&&ea.createModel(D,n(t),"")}for(z in K.textures){t=K.textures[z];if(t.url instanceof Array){ia+=t.url.length;for(f=0;f<t.url.length;f++)c.onLoadStart()}else{ia+=
1;c.onLoadStart()}}oa=ia;for(z in K.textures){t=K.textures[z];if(t.mapping!=undefined&&THREE[t.mapping]!=undefined)t.mapping=new THREE[t.mapping];if(t.url instanceof Array){f=[];for(var na=0;na<t.url.length;na++)f[na]=j(t.url[na],K.urlBaseType);f=THREE.ImageUtils.loadTextureCube(f,t.mapping,X)}else{f=THREE.ImageUtils.loadTexture(j(t.url,K.urlBaseType),t.mapping,X);if(THREE[t.minFilter]!=undefined)f.minFilter=THREE[t.minFilter];if(THREE[t.magFilter]!=undefined)f.magFilter=THREE[t.magFilter]}ha.textures[z]=
f}for(v in K.materials){z=K.materials[v];for(A in z.parameters)if(A=="envMap"||A=="map"||A=="lightMap")z.parameters[A]=ha.textures[z.parameters[A]];else if(A=="shading")z.parameters[A]=z.parameters[A]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(A=="blending")z.parameters[A]=THREE[z.parameters[A]]?THREE[z.parameters[A]]:THREE.NormalBlending;else if(A=="combine")z.parameters[A]=z.parameters[A]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(A=="vertexColors")if(z.parameters[A]==
"face")z.parameters[A]=THREE.FaceColors;else if(z.parameters[A])z.parameters[A]=THREE.VertexColors;if(z.parameters.opacity!==undefined&&z.parameters.opacity<1)z.parameters.transparent=!0;z=new THREE[z.type](z.parameters);ha.materials[v]=z}h();c.callbackSync(ha)}}};
THREE.MarchingCubes=function(b,d){THREE.Object3D.call(this);this.materials=d instanceof Array?d:[d];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasPos=!1;this.hasNormal=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,e,g){return c+(e-c)*g};this.VIntX=function(c,e,g,f,j,h,m,n,p,t){j=(j-p)/(t-p);p=this.normal_cache;e[f]=h+j*this.delta;e[f+1]=m;e[f+2]=n;g[f]=this.lerp(p[c],p[c+3],j);g[f+1]=this.lerp(p[c+1],p[c+4],j);g[f+2]=this.lerp(p[c+2],p[c+5],j)};this.VIntY=function(c,e,g,f,j,h,m,n,p,t){j=(j-p)/(t-p);p=this.normal_cache;e[f]=h;e[f+1]=m+j*this.delta;e[f+
2]=n;e=c+this.yd*3;g[f]=this.lerp(p[c],p[e],j);g[f+1]=this.lerp(p[c+1],p[e+1],j);g[f+2]=this.lerp(p[c+2],p[e+2],j)};this.VIntZ=function(c,e,g,f,j,h,m,n,p,t){j=(j-p)/(t-p);p=this.normal_cache;e[f]=h;e[f+1]=m;e[f+2]=n+j*this.delta;e=c+this.zd*3;g[f]=this.lerp(p[c],p[e],j);g[f+1]=this.lerp(p[c+1],p[e+1],j);g[f+2]=this.lerp(p[c+2],p[e+2],j)};this.compNorm=function(c){var e=c*3;if(this.normal_cache[e]==0){this.normal_cache[e]=this.field[c-1]-this.field[c+1];this.normal_cache[e+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[e+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,e,g,f,j,h){var m=f+1,n=f+this.yd,p=f+this.zd,t=m+this.yd,v=m+this.zd,u=f+this.yd+this.zd,w=m+this.yd+this.zd,x=0,D=this.field[f],z=this.field[m],I=this.field[n],B=this.field[t],L=this.field[p],A=this.field[v],C=this.field[u],E=this.field[w];D<j&&(x|=1);z<j&&(x|=2);I<j&&(x|=8);B<j&&(x|=4);L<j&&(x|=16);A<j&&(x|=32);C<j&&(x|=128);E<j&&(x|=64);var M=THREE.edgeTable[x];if(M==0)return 0;
var N=this.delta,K=c+N,ea=e+N;N=g+N;if(M&1){this.compNorm(f);this.compNorm(m);this.VIntX(f*3,this.vlist,this.nlist,0,j,c,e,g,D,z)}if(M&2){this.compNorm(m);this.compNorm(t);this.VIntY(m*3,this.vlist,this.nlist,3,j,K,e,g,z,B)}if(M&4){this.compNorm(n);this.compNorm(t);this.VIntX(n*3,this.vlist,this.nlist,6,j,c,ea,g,I,B)}if(M&8){this.compNorm(f);this.compNorm(n);this.VIntY(f*3,this.vlist,this.nlist,9,j,c,e,g,D,I)}if(M&16){this.compNorm(p);this.compNorm(v);this.VIntX(p*3,this.vlist,this.nlist,12,j,c,e,
N,L,A)}if(M&32){this.compNorm(v);this.compNorm(w);this.VIntY(v*3,this.vlist,this.nlist,15,j,K,e,N,A,E)}if(M&64){this.compNorm(u);this.compNorm(w);this.VIntX(u*3,this.vlist,this.nlist,18,j,c,ea,N,C,E)}if(M&128){this.compNorm(p);this.compNorm(u);this.VIntY(p*3,this.vlist,this.nlist,21,j,c,e,N,L,C)}if(M&256){this.compNorm(f);this.compNorm(p);this.VIntZ(f*3,this.vlist,this.nlist,24,j,c,e,g,D,L)}if(M&512){this.compNorm(m);this.compNorm(v);this.VIntZ(m*3,this.vlist,this.nlist,27,j,K,e,g,z,A)}if(M&1024){this.compNorm(t);
this.compNorm(w);this.VIntZ(t*3,this.vlist,this.nlist,30,j,K,ea,g,B,E)}if(M&2048){this.compNorm(n);this.compNorm(u);this.VIntZ(n*3,this.vlist,this.nlist,33,j,c,ea,g,I,C)}x<<=4;for(j=f=0;THREE.triTable[x+j]!=-1;){c=x+j;e=c+1;g=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[e],3*THREE.triTable[g],h);j+=3;f++}return f};this.posnormtriv=function(c,e,g,f,j,h){var m=this.count*3;this.positionArray[m]=c[g];this.positionArray[m+1]=c[g+1];this.positionArray[m+2]=c[g+2];this.positionArray[m+
3]=c[f];this.positionArray[m+4]=c[f+1];this.positionArray[m+5]=c[f+2];this.positionArray[m+6]=c[j];this.positionArray[m+7]=c[j+1];this.positionArray[m+8]=c[j+2];this.normalArray[m]=e[g];this.normalArray[m+1]=e[g+1];this.normalArray[m+2]=e[g+2];this.normalArray[m+3]=e[f];this.normalArray[m+4]=e[f+1];this.normalArray[m+5]=e[f+2];this.normalArray[m+6]=e[j];this.normalArray[m+7]=e[j+1];this.normalArray[m+8]=e[j+2];this.hasPos=!0;this.hasNormal=!0;this.count+=3;this.count>=this.maxCount-3&&h(this)};this.begin=
function(){this.count=0;this.hasPos=!1;this.hasNormal=!1};this.end=function(c){if(this.count!=0){for(var e=this.count*3;e<this.positionArray.length;e++)this.positionArray[e]=0;c(this)}};this.addBall=function(c,e,g,f,j){var h=this.size*Math.sqrt(f/j),m=g*this.size,n=e*this.size,p=c*this.size,t=Math.floor(m-h);t<1&&(t=1);m=Math.floor(m+h);m>this.size-1&&(m=this.size-1);var v=Math.floor(n-h);v<1&&(v=1);n=Math.floor(n+h);n>this.size-1&&(n=this.size-1);var u=Math.floor(p-h);u<1&&(u=1);h=Math.floor(p+h);
h>this.size-1&&(h=this.size-1);for(var w,x,D,z,I,B;t<m;t++){p=this.size2*t;x=t/this.size-g;I=x*x;for(x=v;x<n;x++){D=p+this.size*x;w=x/this.size-e;B=w*w;for(w=u;w<h;w++){z=w/this.size-c;z=f/(1.0E-6+z*z+B+I)-j;z>0&&(this.field[D+w]+=z)}}}};this.addPlaneX=function(c,e){var g,f,j,h,m,n=this.size,p=this.yd,t=this.zd,v=this.field,u=n*Math.sqrt(c/e);u>n&&(u=n);for(g=0;g<u;g++){f=g/n;f*=f;h=c/(1.0E-4+f)-e;if(h>0)for(f=0;f<n;f++){m=g+f*p;for(j=0;j<n;j++)v[t*j+m]+=h}}};this.addPlaneY=function(c,e){var g,f,
j,h,m,n,p=this.size,t=this.yd,v=this.zd,u=this.field,w=p*Math.sqrt(c/e);w>p&&(w=p);for(f=0;f<w;f++){g=f/p;g*=g;h=c/(1.0E-4+g)-e;if(h>0){m=f*t;for(g=0;g<p;g++){n=m+g;for(j=0;j<p;j++)u[v*j+n]+=h}}}};this.addPlaneZ=function(c,e){var g,f,j,h,m,n;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/e);dist>size&&(dist=size);for(j=0;j<dist;j++){g=j/size;g*=g;h=c/(1.0E-4+g)-e;if(h>0){m=zd*j;for(f=0;f<size;f++){n=m+f*yd;for(g=0;g<size;g++)field[n+g]+=h}}}};this.reset=function(){var c;
for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var e,g,f,j,h,m,n,p,t,v=this.size-2;for(j=1;j<v;j++){t=this.size2*j;n=(j-this.halfsize)/this.halfsize;for(f=1;f<v;f++){p=t+this.size*f;m=(f-this.halfsize)/this.halfsize;for(g=1;g<v;g++){h=(g-this.halfsize)/this.halfsize;e=p+g;this.polygonize(h,m,n,e,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,e=new THREE.Geometry,g=[];this.render(function(f){var j,h,m,n,p,t,v,u;for(j=
0;j<f.count;j++){v=j*3;p=v+1;u=v+2;h=f.positionArray[v];m=f.positionArray[p];n=f.positionArray[u];t=new THREE.Vector3(h,m,n);h=f.normalArray[v];m=f.normalArray[p];n=f.normalArray[u];v=new THREE.Vector3(h,m,n);v.normalize();p=new THREE.Vertex(t);e.vertices.push(p);g.push(v)}nfaces=f.count/3;for(j=0;j<nfaces;j++){v=(c+j)*3;p=v+1;u=v+2;t=g[v];h=g[p];m=g[u];v=new THREE.Face3(v,p,u,[t,h,m]);e.faces.push(v)}c+=nfaces;f.count=0});return e};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;
THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function d(f){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:f}))}function c(f,j){var h=new THREE.Geometry;h.vertices=[new THREE.Vertex,new THREE.Vertex(f)];return new THREE.Line(h,new THREE.LineBasicMaterial({color:j}))}THREE.Object3D.call(this);var e=Math.PI/2,g;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(g in THREE.Trident.defaultParams)b.hasOwnProperty(g)||(b[g]=THREE.Trident.defaultParams[g]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){g=d(b.xAxisColor);g.rotation.y=-e;g.position.x=b.length;this.addChild(g);g=d(b.yAxisColor);g.rotation.x=e;g.position.y=b.length;this.addChild(g);g=d(b.zAxisColor);g.rotation.y=Math.PI;g.position.z=b.length;this.addChild(g)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,d){this.point=b;this.normal=d};THREE.SphereCollider=function(b,d){this.center=b;this.radius=d;this.radiusSq=d*d};THREE.BoxCollider=function(b,d){this.min=b;this.max=d;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,d,c,e){this.vertices=b;this.faces=d;this.normals=c;this.box=e;this.numFaces=this.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var d,c,e,g,f=0;d=0;for(c=this.colliders.length;d<c;d++){g=this.colliders[d];e=this.rayCast(b,g);if(e<Number.MAX_VALUE){g.distance=e;e>f?this.hits.push(g):this.hits.unshift(g);f=e}}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var d=this.rayCastAll(b);if(d.length==0)return null;for(var c=0;d[c]instanceof THREE.MeshCollider;){var e=this.rayMesh(b,d[c]);if(e<Number.MAX_VALUE){d[c].distance=e;break}c++}if(c>d.length)return null;return d[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,d){if(d instanceof THREE.PlaneCollider)return this.rayPlane(b,d);else if(d instanceof THREE.SphereCollider)return this.raySphere(b,d);else if(d instanceof THREE.BoxCollider)return this.rayBox(b,d);else if(d instanceof THREE.MeshCollider&&d.box)return this.rayBox(b,d.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,d){for(var c=this.makeRayLocal(b,d.mesh),e=Number.MAX_VALUE,g=0;g<d.numFaces/3;g++){var f=g*3;f=this.rayTriangle(c,d.vertices[d.faces[f+0]],d.vertices[d.faces[f+1]],d.vertices[d.faces[f+2]],e,this.collisionNormal);if(f<e){e=f;d.normal.copy(this.collisionNormal);d.normal.normalize()}}return e};
THREE.CollisionSystem.prototype.rayTriangle=function(b,d,c,e,g,f){var j=THREE.CollisionSystem.__v1,h=THREE.CollisionSystem.__v2;f.set(0,0,0);j.sub(c,d);h.sub(e,c);f.cross(j,h);h=f.dot(b.direction);if(!(h<0))return Number.MAX_VALUE;j=f.dot(d)-f.dot(b.origin);if(!(j<=0))return Number.MAX_VALUE;if(!(j>=h*g))return Number.MAX_VALUE;j/=h;h=THREE.CollisionSystem.__v3;h.copy(b.direction);h.multiplyScalar(j);h.addSelf(b.origin);if(Math.abs(f.x)>Math.abs(f.y))if(Math.abs(f.x)>Math.abs(f.z)){b=h.y-d.y;f=c.y-
d.y;g=e.y-d.y;h=h.z-d.z;c=c.z-d.z;e=e.z-d.z}else{b=h.x-d.x;f=c.x-d.x;g=e.x-d.x;h=h.y-d.y;c=c.y-d.y;e=e.y-d.y}else if(Math.abs(f.y)>Math.abs(f.z)){b=h.x-d.x;f=c.x-d.x;g=e.x-d.x;h=h.z-d.z;c=c.z-d.z;e=e.z-d.z}else{b=h.x-d.x;f=c.x-d.x;g=e.x-d.x;h=h.y-d.y;c=c.y-d.y;e=e.y-d.y}d=f*e-c*g;if(d==0)return Number.MAX_VALUE;d=1/d;e=(b*e-h*g)*d;if(!(e>=0))return Number.MAX_VALUE;d*=f*h-c*b;if(!(d>=0))return Number.MAX_VALUE;if(!(1-e-d>=0))return Number.MAX_VALUE;return j};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,d){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(d.matrixWorld,c);var e=THREE.CollisionSystem.__r;e.origin.copy(b.origin);e.direction.copy(b.direction);c.multiplyVector3(e.origin);c.rotateAxis(e.direction);e.direction.normalize();return e};
THREE.CollisionSystem.prototype.rayBox=function(b,d){var c;if(d.dynamic&&d.mesh&&d.mesh.matrixWorld)c=this.makeRayLocal(b,d.mesh);else{c=THREE.CollisionSystem.__r;c.origin.copy(b.origin);c.direction.copy(b.direction)}var e=0,g=0,f=0,j=0,h=0,m=0,n=!0;if(c.origin.x<d.min.x){e=d.min.x-c.origin.x;e/=c.direction.x;n=!1;j=-1}else if(c.origin.x>d.max.x){e=d.max.x-c.origin.x;e/=c.direction.x;n=!1;j=1}if(c.origin.y<d.min.y){g=d.min.y-c.origin.y;g/=c.direction.y;n=!1;h=-1}else if(c.origin.y>d.max.y){g=d.max.y-
c.origin.y;g/=c.direction.y;n=!1;h=1}if(c.origin.z<d.min.z){f=d.min.z-c.origin.z;f/=c.direction.z;n=!1;m=-1}else if(c.origin.z>d.max.z){f=d.max.z-c.origin.z;f/=c.direction.z;n=!1;m=1}if(n)return-1;n=0;if(g>e){n=1;e=g}if(f>e){n=2;e=f}switch(n){case 0:h=c.origin.y+c.direction.y*e;if(h<d.min.y||h>d.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*e;if(c<d.min.z||c>d.max.z)return Number.MAX_VALUE;d.normal.set(j,0,0);break;case 1:j=c.origin.x+c.direction.x*e;if(j<d.min.x||j>d.max.x)return Number.MAX_VALUE;
c=c.origin.z+c.direction.z*e;if(c<d.min.z||c>d.max.z)return Number.MAX_VALUE;d.normal.set(0,h,0);break;case 2:j=c.origin.x+c.direction.x*e;if(j<d.min.x||j>d.max.x)return Number.MAX_VALUE;h=c.origin.y+c.direction.y*e;if(h<d.min.y||h>d.max.y)return Number.MAX_VALUE;d.normal.set(0,0,m)}return e};THREE.CollisionSystem.prototype.rayPlane=function(b,d){var c=b.direction.dot(d.normal),e=d.point.dot(d.normal);if(c<0)c=(e-b.origin.dot(d.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,d){var c=d.center.clone().subSelf(b.origin);if(c.lengthSq<d.radiusSq)return-1;var e=c.dot(b.direction.clone());if(e<=0)return Number.MAX_VALUE;c=d.radiusSq-(c.lengthSq()-e*e);if(c>=0)return Math.abs(e)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var d=b.geometry.boundingBox,c=new THREE.Vector3(d.x[0],d.y[0],d.z[0]);d=new THREE.Vector3(d.x[1],d.y[1],d.z[1]);c=new THREE.BoxCollider(c,d);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var d=THREE.CollisionUtils.MeshOBB(b);d.min.addSelf(b.position);d.max.addSelf(b.position);d.dynamic=!1;return d};
THREE.CollisionUtils.MeshColliderWBox=function(b){for(var d=b.geometry.vertices,c=d.length,e=b.geometry.faces,g=e.length,f=[],j=[],h=[],m=0;m<c;m++)f.push(new THREE.Vector3(d[m].position.x,d[m].position.y,d[m].position.z));for(m=0;m<g;m++){j.push(e[m].a,e[m].b,e[m].c);h.push(new THREE.Vector3(e[m].normal.x,e[m].normal.y,e[m].normal.z))}d=new THREE.MeshCollider(f,j,h,THREE.CollisionUtils.MeshOBB(b));d.mesh=b;return d};
var LoadingBar=function(b){function d(){var m=j/f;if(m>h){h=m;g.style.width=m*300+"px"}}var c,e,g,f=0,j=0,h=0;c=document.createElement("div");e=document.createElement("div");e.style.position="absolute";e.style.display="block";e.style.width="300px";e.style.height="8px";e.style.borderStyle="solid";e.style.borderColor="rgba(255,255,255,0.5)";e.style.borderWidth="1px";e.style.borderRadius="5px";c.appendChild(e);g=document.createElement("div");g.style.position="absolute";g.style.height="10px";g.style.width=
"0px";g.style.background="#fff";g.style.borderRadius="5px";c.appendChild(g);c.style.margin="30px 0 0 0";this.addItem=function(){f++;d()};this.completeItem=function(){j++;d();f!=0&&f==j&&b()};this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,d=[],c=[],e=[],g=0,f=0,j=0,h=!1;this.add=function(m,n,p,t){m.__active=!1;m.__start=n;m.__duration=p-n;m.__end=p;m.__layer=t;m.init();d.push(m);d.sort(function(v,u){return v.__start-u.__start});e.push(m);e.sort(function(v,u){return v.__end-u.__end})};this.update=function(m){if(m<j){this.clear();j=m}for(;d[g];){b=d[g];if(b.__start>m)break;if(!b.__active&&b.__end>m){b.show((m-b.__start)/b.__duration);b.__active=!0;c.push(b);h=!0}g++}for(;e[f];){b=e[f];if(b.__end>m)break;
if(b.__active){b.hide();b.__active=!1;var n=c.indexOf(b);n!==-1&&c.splice(n,1)}f++}if(h){c.sort(function(t,v){return t.__layer-v.__layer});h=!1}n=0;for(var p=c.length;n<p;n++){b=c[n];b.update((m-b.__start)/b.__duration,m-j,m)}j=m};this.clear=function(){for(f=g=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var d,c,e;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(g){d=g;e=1/d*6E4};this.getBPM=function(){return d};this.setMS=function(g){e=g;d=1/e*6E4};this.getMS=function(){return e};this.setRows=function(g){c=g};this.getRows=function(){return c};this.getBeatMS=function(g){return e*g};this.getPatternMS=function(g){return e*c*g}};function preInitModel(b,d,c){d.initWebGLObjects(c);for(d=0;d<b.materials.length;d++);}
function preInitScene(b,d){d.initWebGLObjects(b.scene);var c,e;for(c in b.materials){e=b.materials[c];e instanceof THREE.MeshFaceMaterial||e.program||setTimeout(function(){d.initMaterial(e,b.scene.lights,b.scene.fog)},250)}}function preinitAnimal(b,d,c){d.initWebGLObjects(c)}
function initLensFlares(b,d,c,e){var g=THREE.ImageUtils.loadTexture("files/textures/lensflare0.png"),f=THREE.ImageUtils.loadTexture("files/textures/lensflare2.png"),j=THREE.ImageUtils.loadTexture("files/textures/lensflare3.png");b.lensFlare=new THREE.LensFlare(g,700,0,THREE.AdditiveBlending);b.lensFlare.add(f,512,0,THREE.AdditiveBlending);b.lensFlare.add(f,512,0,THREE.AdditiveBlending);b.lensFlare.add(f,512,0,THREE.AdditiveBlending);b.lensFlare.add(j,60,0.6,THREE.AdditiveBlending);b.lensFlare.add(j,
70,0.7,THREE.AdditiveBlending);b.lensFlare.add(j,120,0.9,THREE.AdditiveBlending);b.lensFlare.add(j,70,1,THREE.AdditiveBlending);b.lensFlare.customUpdateCallback=lensFlareUpdateCallback;b.lensFlare.position.copy(d);b.lensFlareRotate=new THREE.Object3D;b.lensFlareRotate.addChild(b.lensFlare);b.lensFlareRotate.rotation.x=c*Math.PI/180;b.lensFlareRotate.rotation.y=e*Math.PI/180;b.scene.addChild(b.lensFlareRotate);return b.lensFlareRotate}
function lensFlareUpdateCallback(b){var d,c,e=b.lensFlares.length,g=-b.positionScreen.x*2,f=-b.positionScreen.y*2;for(c=0;c<e;c++){d=b.lensFlares[c];d.x=b.positionScreen.x+g*d.distance;d.y=b.positionScreen.y+f*d.distance;d.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var d,c,e;d=0;for(c=b.objects.length;d<c;d++){e=b.objects[d];e.matrixAutoUpdate=!1;e.updateMatrix()}}
function hideColliders(b){var d,c,e;d=0;for(c=b.collisions.colliders.length;d<c;d++){e=b.collisions.colliders[d].mesh;e.visible=!1}}function applyMaterial(b,d,c){var e,g,f,j=d.length;for(e=0;e<j;e++){g=d[e][0];f=d[e][1];b.objects[g]&&(b.objects[g].geometry.materials[f][0]=c)}}
var UgcObject=function(b){var d={},c=0;this.addVoxel=function(f,j,h,m){d[f+"."+j+"."+h]={x:f,y:j,z:h,color:m};c++};this.checkVoxel=function(f,j,h){return d[f+"."+j+"."+h]};this.removeVoxel=function(f,j,h){delete d[f+"."+j+"."+h];c--};this.isEmpty=function(){return c==0};this.getJSON=function(){var f,j,h=[3];for(f in d){j=d[f];h.push(j.x,j.y,j.z,j.color)}f=JSON.stringify(h);console.log(f);return f};this.getMesh=function(){var f=new THREE.Cube(50,50,50),j=new THREE.Object3D,h;for(h in d){var m=d[h],
n=new THREE.Mesh(f,new THREE.MeshLambertMaterial({color:m.color}));n.position.x=m.x*50;n.position.y=m.y*50;n.position.z=m.z*50;n.matrixAutoUpdate=!1;n.updateMatrix();n.update();j.addChild(n)}return j};if(b&&b[0]==3)for(var e=1,g=b.length;e<g;)this.addVoxel(b[e++],b[e++],b[e++],b[e++])};UgcObject.TYPE_SAND="UgcObject.TYPE_SAND";UgcObject.TYPE_CLOUD="UgcObject.TYPE_CLOUD";
var UgcHandler=function(){this.getLatestUGOs=function(b){var d=new XMLHttpRequest;d.open("GET","/ugc/objects/latest",!0);d.onreadystatechange=function(){d.readyState==4&&(d.status==200?b(JSON.parse(d.responseText)):console.log("Unable to load latest User Generated Content"))};d.send(null)};this.submitUGO=function(b,d,c,e,g,f){b="title="+b+"&email="+d+"&type="+c+"&data="+e+"&image="+g;var j=new XMLHttpRequest;j.open("POST","/ugc/objects",!0);j.setRequestHeader("Content-type","application/x-www-form-urlencoded");
j.onreadystatechange=function(){j.readyState==4&&(j.status==200?f(j.responseText):console.log("Submission of model failed"))};j.send(b)}};
window.GEE=function(b){b||(b={});if(document.createElement("canvas").getContext){var d=this,c={},e={ctx:undefined,domElement:undefined,width:undefined,height:undefined,desiredFrameTime:1E3/60,frameCount:0,key:undefined,keyCode:undefined,mouseX:0,mouseY:0,pmouseX:undefined,pmouseY:undefined,mousePressed:!1},g=undefined,f,j=function(){for(var p=f,t=0,v=0;p;){v+=p.offsetTop;t+=p.offsetLeft;p=p.offsetParent}offset={x:t,y:v}};b.context||(b.context="2d");b.width||(b.width=500);b.height||(b.height=500);
f=e.domElement=document.createElement("canvas");e.ctx=f.getContext(b.context);if(e.ctx==null)b.fallback&&b.fallback();else{if(b.fullscreen){var h=function(){j();e.width=f.width=window.innerWidth;e.height=f.height=window.innerHeight-4};window.addEventListener("resize",h,!1);h();b.container||(b.container=document.body);document.body.style.margin="0px";document.body.style.padding="0px"}else{j();d.__defineSetter__("width",function(p){e.width=f.width=p});d.__defineSetter__("height",function(p){e.height=
f.height=p});d.width=b.width;d.height=b.height}if(b.container){b.container.appendChild(f);j()}b=function(p){d.__defineGetter__(p,function(){return e[p]})};b("ctx");b("width");b("height");b("frameCount");b("key");b("keyCode");b("mouseX");b("mouseY");b("pmouseX");b("pmouseY");b("mousePressed");b=function(){};d.loop=!0;d.keyup=b;d.keydown=b;d.draw=b;d.mousedown=b;d.mouseup=b;d.mousemove=b;d.mousedrag=b;d.__defineGetter__("frameRate",function(){return 1E3/g});d.__defineGetter__("frameTime",function(){return g});
d.__defineGetter__("keyPressed",function(){for(var p in c)if(c[p])return!0;return!1});d.__defineSetter__("frameTime",function(p){e.desiredFrameTime=p});d.__defineSetter__("frameRate",function(p){e.desiredFrameTime=k/p});f.addEventListener("mouseenter",function(){j()},!1);var m=function(){d.mousemove()};window.addEventListener("mousemove",function(p){var t=p.pageX-offset.x;p=p.pageY-offset.y;if(e.pmouseX==undefined){e.pmouseX=t;e.pmouseY=p}else{e.pmouseX=e.mouseX;e.pmouseY=e.mouseY}e.mouseX=t;e.mouseY=
p},!1);window.addEventListener("mousemove",m,!1);f.addEventListener("mousedown",function(){e.mousePressed=!0;d.mousedown();f.addEventListener("mousemove",d.mousedrag,!1);f.removeEventListener("mousemove",m,!1)},!1);f.addEventListener("mouseup",function(){e.mousePressed=!1;d.mouseup();f.removeEventListener("mousemove",d.mousedrag,!1);f.addEventListener("mousemove",m,!1)},!1);window.addEventListener("keydown",function(p){p=p.keyCode;e.key=String.fromCharCode(p);e.keyCode=p;c[p]=!0;d.keydown()},!1);
window.addEventListener("keyup",function(p){p=p.keyCode;e.key=String.fromCharCode(p);e.keyCode=p;c[p]=!1;d.keyup()},!1);var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(p){window.setTimeout(p,g)}}();_idraw=function(){d.loop&&n(_idraw);e.frameCount++;var p=(new Date).getTime();d.draw();p=(new Date).getTime()-p;g=p>e.desiredFrameTime?p:e.desiredFrameTime};
_idraw()}}else b.fallback&&b.fallback()};function loadSVG(b,d,c){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState==4)if(e.status==200)if(e.responseXML==null)c!=undefined&&c.call(this,b);else{var g=e.responseXML.getElementsByTagName("svg").item(0);g=new SVG(g);g.filename=b;d.call(this,g,b)}else c!=undefined&&c.call(this,b)};e.open("GET",b,!0);e.send(null)}
var SVG=function(b){this.filename="";this.children=[];var d=b.getAttribute("width"),c=b.getAttribute("height");this.width=d==null?0:parseFloat(d.replace("px",""));this.height=c==null?0:parseFloat(c.replace("px",""));for(var e in b.childNodes)b.childNodes.item(e).getAttribute&&this.children.push(b.childNodes.item(e).nodeName=="g"?new SVG(b.childNodes.item(e)):new Path(b.childNodes.item(e)));this.draw=function(g){for(var f in this.children)this.children[f].draw(g)};this.__defineGetter__("path",function(){})},
Path=function(b){this.element=b;this.commands=commands(b);this.lineWidth=parseLineWidth(b);this.strokeStyle=parseStrokeStyle(b);this.fillStyle=parseFillStyle(b);this.totalLength=0;this.lengths=[];this.tlengths=[];var d=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0};this.reset()};this.draw=function(c){this.style(c);c.beginPath();this.shape(c);this.end(c)};this.getAnchorPoints=function(){var c=[],e;for(e in this.commands)c.push(this.commands[e].getAnchorPoints(d));
return c};this.shape=function(c){for(var e in this.commands)this.commands[e].shape(d,c)};this.lerp=function(c,e,g,f,j){var h=1-j;return c*h*h*h+3*e*j*h*h+3*g*j*j*h+f*j*j*j};this.at=function(c,e){var g,f;this.lengths.length==0&&this.calcLengths(e);f=this.tlengths[0];for(g=0;c>f;){g++;f+=this.tlengths[g]}pt=f-this.tlengths[g];f=this.map(c,pt,f,0,1);for(var j=0;j<=g;j++)this.commands[j].shape(d,e);var h=d.x;j=d.y;this.commands[g+1].shape(d,e);g=this.lerp(h,d.x1,d.x2,d.x,f);f=this.lerp(j,d.y1,d.y2,d.y,
f);return{x:g,y:f}};this.map=function(c,e,g,f,j){return f+(j-f)*((c-e)/(g-e))};this.calcLengths=function(c){var e,g,f,j,h=0;this.commands[0].shape(d,c);for(var m=f=d.x,n=j=d.y,p=1;p<this.commands.length;p++){h=0;m=d.x;n=d.y;this.commands[p].shape(d,c);for(var t=0;t<=1;t+=0.001){e=this.lerp(m,d.x1,d.x2,d.x,t);g=this.lerp(n,d.y1,d.y2,d.y,t);h+=this.dist(e,g,f,j);f=e;j=g}this.lengths.push(h);this.totalLength+=h}for(c=0;c<this.lengths.length;c++)this.tlengths.push(this.lengths[c]/this.totalLength)};this.dist=
function(c,e,g,f){return Math.sqrt((c-g)*(c-g)+(e-f)*(e-f))};this.style=function(c){if(this.lineWidth!=null)c.lineWidth=this.lineWidth;if(this.strokeStyle!=null){c.strokeStyle=this.strokeStyle;if(this.lineWidth==undefined)c.lineWidth=1}if(this.fillStyle!=null)c.fillStyle=this.fillStyle};this.end=function(c){this.fillStyle!=null&&c.fill();this.strokeStyle!=null&&c.stroke()}},parseLineWidth=function(b){b=b.attributes.getNamedItem("stroke-width");return b==null?null:parseFloat(b.nodeValue)},parseStrokeStyle=
function(b){b=b.attributes.getNamedItem("stroke");return b==null?null:b.nodeValue},parseFillStyle=function(b){var d=b.attributes.getNamedItem("fill");if(d==null)return b.attributes.getNamedItem("stroke")!=null?null:"#000000";else{if(d.nodeValue=="none")return null;return d.nodeValue}},Command=function(b,d){this.type=b;this.data=d;this.debug=!1;this.shape=function(c,e){if(this.type=="M"){c.x=this.data[0];c.y=this.data[1];e&&e.moveTo(c.x,c.y)}else if(this.type=="C"){c.x=this.data[4];c.y=this.data[5];
if(e)e.bezierCurveTo(c.x1=this.data[0],c.y1=this.data[1],c.x2=this.data[2],c.y2=this.data[3],c.x,c.y)}else if(this.type=="c"){if(e)e.bezierCurveTo(c.x1=c.x+this.data[0],c.y1=c.y+this.data[1],c.x2=c.x+this.data[2],c.y2=c.y+this.data[3],c.x+=this.data[4],c.y+=this.data[5])}else if(this.type=="S"){c.x=this.data[2];c.y=this.data[3];var g=c.x-c.x2,f=c.y-c.y2;if(e)e.bezierCurveTo(c.x1=c.x+g,c.y1=c.y+f,c.x2=this.data[0],c.y2=this.data[1],c.x,c.y)}else if(this.type=="s"){g=c.x-c.x2;f=c.y-c.y2;if(e)e.bezierCurveTo(c.x1=
c.x+g,c.y1=c.y+f,c.x2=c.x+this.data[0],c.y2=c.y+this.data[1],c.x+=this.data[2],c.y+=this.data[3])}else if(this.type=="L"){c.x1=c.x;c.y1=c.y;if(e)e.lineTo(c.x=this.data[0],c.y=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="l"){c.x1=c.x;c.y1=c.y;e&&e.lineTo(c.x+=this.data[0],c.y+=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="H"){c.x1=c.x;c.y1=c.y;if(e)e.lineTo(c.x=this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="h"){c.x1=c.x;c.y1=c.y;e&&e.lineTo(c.x+=this.data[0],c.y);c.x2=c.x;c.y2=
c.y}else if(this.type=="V"){c.x1=c.x;c.y1=c.y;if(e)e.lineTo(c.x,c.y=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="v"){c.x1=c.x;c.y1=c.y;e&&e.lineTo(c.x,c.y+=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="z")e.closePath();else console&&console.log("unrecognized command "+this.type);if(e){e.strokeStyle="#000000";e.lineWidth=1;if(this.debug){e.strokeRect(c.x-1.5,c.y-1.5,3,3);e.beginPath();e.moveTo(c.px,c.py);e.lineTo(c.x1,c.y1);e.closePath();e.stroke()}}}},commands=function(b){if(b.nodeName.toLowerCase()==
"path")return commandsFromD(b.getAttribute("d"));if(b.nodeName.toLowerCase()=="polygon")return commandsFromPoints(b.getAttribute("points"));if(b.nodeName.toLowerCase()=="line")return commandsFromLine(b);if(b.nodeName.toLowerCase()=="rect")return commandsFromRect(b);return[]},commandsFromD=function(b){var d=[];b=b.match(/[a-zA-Z][0-9\.\-\,]+/g);for(var c=0;c<b.length;c++){var e=b[c].charAt(0),g=b[c].substr(1);g=g.replace(/\-/g,",-");g.charAt(0)==","&&(g=g.substr(1));g=g.split(",");for(var f=0;f<g.length;f++)g[f]=
parseFloat(g[f]);d.push(new Command(e,g))}return d},commandsFromLine=function(b){var d=[],c=parseFloat(b.getAttribute("x1")),e=parseFloat(b.getAttribute("x2")),g=parseFloat(b.getAttribute("y1"));b=parseFloat(b.getAttribute("y2"));d.push(new Command("M",[c,g]));d.push(new Command("L",[e,b]));return d},commandsFromPoints=function(b){var d=!0;if(b.indexOf(",")==-1)for(var c=0;c<b.length;c++)if(b.charAt(c)==" "){d&&(b=b.setCharAt(c,","));d=!d}b=("M"+b).replace(/ /g,"L")+"z";return commandsFromD(b)};
String.prototype.setCharAt=function(b,d){if(b>this.length-1)return str;return this.substr(0,b)+d+this.substr(b+1)};var commandsFromRect=function(b){var d=[],c=parseFloat(b.getAttribute("x")),e=parseFloat(b.getAttribute("y")),g=parseFloat(b.getAttribute("width"));b=parseFloat(b.getAttribute("height"));d.push(new Command("M",[c,e]));d.push(new Command("h",[g]));d.push(new Command("v",[b]));d.push(new Command("h",[-g]));d.push(new Command("v",[-b]));return d},WonderWall=WonderWall||{};
WonderWall.Point=function(b,d,c){var e=d,g=c,f=0;this.x=d;this.y=c;this.r=0.15;this.threshold=0.1;this.easing=0.125;this.updating=!1;this.angle=0;this.update=function(){if(this.updating){var j=b.mouseY-g;d=e+(b.mouseX-e)*this.r;c=g+j*this.r;this.easing=0.0625}else{d=e;c=g;f=0;this.easing=0.125}this.x=this.ease(this.x,d,this.easing);this.y=this.ease(this.y,c,this.easing);this.angle=this.ease(this.angle,f,this.easing)};this.setPosition=function(j,h){e=j;g=h};this.getOriginPosition=function(){return{x:e,
y:g}};this.getPoint=function(){return{x:this.x,y:this.y}}};WonderWall.Point.prototype.ease=function(b,d,c){var e=d-b;if(Math.abs(e)<c/100)b=d;else b+=e*c;return b};
WonderWall.Pentagon=function(b,d,c,e){var g=b.ctx;this.separate=!1;this.showFill=!0;this.showStroke=!0;this.insides=!1;this.x=d;this.y=c;if(this.x==undefined||this.x==null||this.x==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y==NaN)this.y=b.height/2;d=this.generatePoints(this.x,this.y,e,5);var f=[];for(c=0;c<d.length;c++){var j=d[c];f.push(new WonderWall.Point(b,j.x,j.y))}this.update=function(){this.x=b.width/2;this.y=b.height/2;var h=this.generatePoints(this.x,this.y,e,5);if(!this.separate)this.separate=
!0;for(var m=0;m<f.length;m++){var n=f[m],p=h[m];n.update();var t=n.getOriginPosition();(p.x!=t.x||p.y!=t.y)&&n.setPosition(p.x,p.y)}return this};this.render=function(){if(this.insides&&this.showStroke)for(var h=0;h<f.length;h++){var m=f[h];this.separate||m.update();g.beginPath();g.moveTo(this.x,this.y);g.lineTo(m.x,m.y);g.stroke()}g.beginPath();for(h=0;h<f.length;h++){m=f[h];this.separate||m.update();h<1?g.moveTo(m.x,m.y):g.lineTo(m.x,m.y)}g.closePath();this.showFill&&g.fill();this.showStroke&&g.stroke()};
this.setUpdate=function(h){for(var m=0;m<f.length;m++)f[m].updating=h};this.setUpdatePoint=function(h,m){f[m].updating=h};this.setRadius=function(h){for(var m=0;m<f.length;m++)f[m].r=h};this.getPoints=function(){return f}};WonderWall.Pentagon.prototype.generatePoints=function(b,d,c,e){for(var g=[],f=0;f<e;f++)g.push({x:c*Math.sin(f/e*2*Math.PI)+b,y:-c*Math.cos(f/e*2*Math.PI)+d});return g};
function Heart(b,d,c,e){var g=this,f=b.ctx;this.x=c;this.y=e;if(this.x==undefined||this.x==null||this.x||this==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y||this==NaN)this.y=b.height/2;var j,h=!1;this.update=function(){return this};this.render=function(){if(h){f.save();f.translate(this.x,this.y);f.save();f.translate(-this.width/2,-this.height/2);j.draw(f);f.restore();f.restore()}};loadSVG(d,function(m,n){j=m;g.source=n;g.width=j.width;g.height=j.height;h=!0},function(){})}
var ClearEffect=function(b){SequencerItem.call(this);var d,c=b.renderer,e=b.renderTarget;this.init=function(){d=new THREE.Camera(60,1,1,1E4);d.position.z=2;new THREE.Scene};this.update=function(){c.clear();var g=c.getContext();g.bindFramebuffer(g.FRAMEBUFFER,e.__webglFramebuffer);g.viewport(0,0,e.width,e.height);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,d){SequencerItem.call(this);var c,e,g,f,j=d.renderer,h=d.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;e=new THREE.Scene;g=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});f=new THREE.Mesh(new THREE.Plane(3,3),g);e.addObject(f)};this.update=function(m){g.opacity=1-m;j.render(e,c,h)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,d){SequencerItem.call(this);var c,e,g,f,j=d.renderer,h=d.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;e=new THREE.Scene;g=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});f=new THREE.Mesh(new THREE.Plane(3,3),g);e.addObject(f)};this.update=function(m){g.opacity=m;j.render(e,c,h)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var d,c,e,g=b.renderer,f=b.renderTarget;this.init=function(){d=new THREE.Camera;d.position.z=200;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var j=new THREE.MeshBasicMaterial({map:f,depthTest:!1});e=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),j);e.scale.y=-1;e.doubleSided=!0;c.addObject(e)};this.update=function(){g.render(c,d)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,d,c,e){SequencerItem.call(this);var g,f,j,h,m,n=b.renderer,p=b.renderTarget;this.init=function(){g=new THREE.Camera;g.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);g.position.z=100;f=new THREE.Scene;h=THREE.ShaderUtils.lib.film;m=THREE.UniformsUtils.clone(h.uniforms);m.tDiffuse.texture=p;j=new THREE.MeshShaderMaterial({uniforms:m,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader});m.grayscale.value=
0;if(d!==undefined)m.nIntensity.value=d;if(c!==undefined)m.sIntensity.value=c;if(e!==undefined)m.sCount.value=e;var t=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),j);t.position.z=-500;f.addObject(t)};this.update=function(t,v,u){m.time.value=u*0.01%1E4;n.render(f,g,p,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,d){SequencerItem.call(this);var c,e,g,f,j,h,m,n,p,t,v,u=b.renderer,w=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;e=new THREE.Scene;var x={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};m=new THREE.WebGLRenderTarget(256,512,x);n=new THREE.WebGLRenderTarget(512,256,x);x=THREE.ShaderUtils.lib.screen;
f=THREE.UniformsUtils.clone(x.uniforms);f.tDiffuse.texture=w;f.opacity.value=d!==undefined?d:1;g=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});x=THREE.ShaderUtils.lib.convolution;j=THREE.UniformsUtils.clone(x.uniforms);t=new THREE.Vector2(0.001953125,0);v=new THREE.Vector2(0,0.001953125);j.tDiffuse.texture=w;j.uImageIncrement.value=t;j.cKernel.value=THREE.ShaderUtils.buildKernel(4);h=new THREE.MeshShaderMaterial({uniforms:j,
vertexShader:"#define KERNEL_SIZE 25.0\n"+x.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+x.fragmentShader});p=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),h);p.position.z=-500;e.addObject(p)};this.update=function(){p.materials[0]=h;j.tDiffuse.texture=w;j.uImageIncrement.value=t;u.render(e,c,m,!0);j.tDiffuse.texture=m;j.uImageIncrement.value=v;u.render(e,c,n,!0);p.materials[0]=g;g.blending=THREE.AdditiveBlending;f.tDiffuse.texture=n;u.render(e,c,w,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var d,c,e,g,f=b.renderer,j=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;g={time:{type:"f",value:0},map:{type:"t",value:0,texture:j},sampleDistance:{type:"f",value:1/b.baseWidth}};e=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);h.position.z=-500;c.addObject(h)};this.update=function(h,m,n){g.time.value=n*0.01;f.render(c,d,j,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var d,c,e,g=b.renderer,f=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:f},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.54},waveFactor:{type:"f",value:0.00127},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};e=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);j.position.z=-500;c.addObject(j)};this.update=function(){g.render(c,d)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var d,c,e,g=b.renderer,f=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:f},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.49},waveFactor:{type:"f",value:0.00161},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};e=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.55 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);j.position.z=-500;c.addObject(j)};this.update=function(){g.render(c,d)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var d,c,e,g=b.renderer,f=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:f},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.64},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.00756},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};e=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (1.86 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);j.position.z=-500;c.addObject(j)};this.update=function(){g.render(c,d)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintEffectVideo=function(b){SequencerItem.call(this);var d,c,e,g=b.renderer,f=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:f},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.5},
colorOffset:{type:"f",value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0},waveFactor:{type:"f",value:0},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};e=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);j.position.z=-500;c.addObject(j)};this.update=function(){g.render(c,d)}};PaintEffectVideo.prototype=new SequencerItem;PaintEffectVideo.prototype.constructor=PaintEffectVideo;
var PaintDarkEffect=function(b){SequencerItem.call(this);var d,c,e,g,f=b.renderer,j=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;g={map:{type:"t",value:0,texture:j}};e=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,d,j,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,d){SequencerItem.call(this);var c,e,g,f=b.renderer,j=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;e=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:d,transparent:!0});g=new THREE.Mesh(new THREE.Plane(3,3),this.material);e.addObject(g)};this.update=function(){this.material.opacity=0.25;f.render(e,c,j)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,d){SequencerItem.call(this);this.show=function(){document.body.style.cursor=d?'url("files/pointer.png"), auto':"none"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var CityWorld=function(b){function d(n){var p=n.scene;hideColliders(p);makeSceneStatic(p);preInitScene(n,b.renderer);p.scale.set(0.1,0.1,0.1);p.updateMatrix();c.scene.addChild(p);p.collisions&&c.scene.collisions.merge(p.collisions);TriggerUtils.setupCityTriggers(n);n.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;n.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;applyCityShader(n,["Backdrop_City"]);c.scene.update(undefined,!0)}var c=this;this.scene=new THREE.Scene;
this.scene.collisions=new THREE.CollisionSystem;var e=new THREE.Vector3(1094.09,-99.358,246.713);this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var g=new THREE.DirectionalLight(16777215);g.castShadow=!1;this.scene.addLight(g);var f=new THREE.DirectionalLight(16777215);f.castShadow=!1;this.scene.addLight(f);var j={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,s:0.494,v:0},directionalLight1:{h:0.565,s:0.329,v:0.841,x:0.5176767580772196,
y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,flarey:358,flyCamera:{position:{x:16.574202591686277,y:462.26953453589,z:-10184.707948888321},
target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(j.fogColor.h,j.fogColor.s,j.fogColor.v);this.scene.fog.density=j.fogDensity;g.color.setHSV(j.directionalLight1.h,j.directionalLight1.s,j.directionalLight1.v);f.color.setHSV(j.directionalLight2.h,j.directionalLight2.s,j.directionalLight2.v);g.position.set(j.directionalLight1.x,j.directionalLight1.y,j.directionalLight1.z);f.position.set(j.directionalLight2.x,j.directionalLight2.y,j.directionalLight2.z);
this.lensFlareRotate=this.lensFlare=null;g=new THREE.Vector3(0,0,-5E3);initLensFlares(c,g,20,358);g=new THREE.SceneLoader;g.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};g.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};b.debug||g.load("files/models/city/City.js",d);var h,m;this.update=function(n,p,t){h=p.matrixWorld.getPosition();TriggerUtils.effectorRadius=3E5;TriggerUtils.update();updateCityShader(n);if(t){m=e.distanceTo(h);m<100&&b.signals.startexploration.dispatch("dunes")}}},
PrairieWorld=function(b){var d=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;var c=new THREE.Vector3(1094.09,-99.358,246.713);this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.19587102348124588,0.9325398992514422,
-0.30332141115410777);this.directionalLight1.color.setHSV(0,0,0.8764705882352941);this.scene.addLight(this.directionalLight1);this.directionalLight2=new THREE.DirectionalLight(16772829);this.directionalLight2.position.set(0.19122302057716462,-0.30810803127799236,-0.9319351895187481);this.directionalLight2.color.setHSV(0.34705882352941175,0.5058823529411764,0.13529411764705881);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.058823529411765E-5,fogColor:{h:0.5235294117647059,
s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,y:0.8775825618903728,z:-0.1553545034191468,phi:-1.588470588235294,theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,
flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,this.settings.directionalLight1.s,this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,
this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,this.settings.directionalLight2.y,this.settings.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;var e=new THREE.Vector3(0,0,-3E3);initLensFlares(d,e,14,311);var g=THREE.ImageUtils.loadTexture("files/textures/trailMarkTexture.jpg");e=new THREE.SceneLoader;e.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};e.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};
e.load("files/models/prairie/Prairie.js",function(f){var j=f.scene;hideColliders(j);makeSceneStatic(j);ROME.TrailShaderUtils.setMaterials([f.objects.Ground],2048,g,b.renderer);TriggerUtils.setupPrairieTriggers(f);d.scene.addChild(j);f.objects.Backdrop.materials[0].map.wrapS=THREE.RepeatWrapping;f.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;preInitScene(f,b.renderer);j.collisions&&d.scene.collisions.merge(j.collisions);f=new THREE.JSONLoader;f.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};
f.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};d.scene.update(undefined,!0)});this.update=function(f,j,h){ROME.TrailShaderUtils.updateLava(f*1.0E-4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=50;TriggerUtils.update();if(h){f=j.matrixWorld.getPosition();c.distanceTo(f)<100&&b.signals.startexploration.dispatch("dunes")}}},DunesWorld=function(b){function d(A){var C=A.scene;applyDunesShader(A);j(C);
f(C,!0);x[I]=C.collisions.colliders[0].mesh;x[I].rotation.x=-90*Math.PI/180;x[I].scale.set(n,n,n);m.scene.addChild(x[I]);m.scene.collisions.merge(C.collisions);for(A=0;A<D[I];A++)w[I].push(c(C));I++}function c(A){for(var C=0;C<A.children.length;C++)if(!A.children[C].__isCollider){A=A.children[C];A=new THREE.Mesh(A.geometry,A.materials);A.rotation.x=-90*Math.PI/180;A.scale.set(n,n,n);m.scene.addChild(A);return A}}function e(A){var C=A.scene;C.scale.set(n,n,n);C.matrixAutoUpdate=!0;j(C);f(C,!0);preInitScene(A,
b.renderer);m.scene.addChild(C);C.collisions&&m.scene.collisions.merge(C.collisions);return C}function g(A,C){return Math.round(Math.sin(A*0.001)*Math.cos(C*0.005)*4)*(Math.PI/2)}function f(A,C){THREE.SceneUtils.traverseHierarchy(A,function(E){if(!E.__isCollider)E.visible=C})}function j(A){THREE.SceneUtils.traverseHierarchy(A,function(C){for(var E=A.collisions.colliders,M=0;M<E.length;M++)if(E[M].mesh==C)C.__isCollider=!0})}function h(A){A.state=0;b.influenceSpheres.push(A)}var m=this,n=0.2,p=29990*
n;b.influenceSpheres=[];b.cameraSlowDown=!1;m.scene=new THREE.Scene;m.scene.collisions=new THREE.CollisionSystem;m.scene.fog=new THREE.FogExp2(16777215,2.75E-6);m.scene.fog.color.setHSV(0.576,0.382,0.9);var t=new THREE.AmbientLight(2232576),v=new THREE.DirectionalLight(16772829),u=new THREE.DirectionalLight(16772829);t.color.setHSV(0,0,0.1);v.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);v.color.setHSV(0.08823529411764706,0,1);u.position.set(0.09386404300915006,0.9829903100365339,
0.15785940518149455);u.color.setHSV(0,0,0.8647058823529412);m.scene.addLight(t);m.scene.addLight(v);m.scene.addLight(u);m.lensFlare=null;m.lensFlareRotate=null;initLensFlares(m,new THREE.Vector3(0,0,-1E4),70,292);var w=[[],[],[],[],[],[],[]],x=[],D=[0,0,0,0,1,1,1],z=[],I=0,B;for(t=0;t<5;t++){u=[];z.push(u);for(v=0;v<5;v++)if(v===0&&t===0)u.push(4);else if(v===0&&t===4)u.push(5);else if(v===1&&t===3)u.push(6);else{B=Math.floor(Math.random()*3.99999);u.push(B);D[B]++}}var L=new THREE.Mesh(new THREE.Cube(5E4,
5E4,5E4),undefined);L.flipSided=!0;applyDunesShader({objects:{skydome:L}});m.scene.addChild(L);t=new THREE.SceneLoader;t.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};t.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};t.load("files/models/dunes/D_tile_walk.js",function(A){applyDunesShader(A);w[4][0]=e(A)});t.load("files/models/dunes/D_tile_prairie.js",function(A){applyDunesShader(A,{D_tile_Prairie_Collis:!0,D_tile_Prairie_Island:!0},{"D_tile_Prairie_Is.000":-1},{D_tile_Prairie_Water:0.65});
w[5][0]=e(A);h({name:"prairiePortal",object:A.empties.Prairie_Portal,radius:2E3,type:0,destination:"prairie"});h({name:"prairieSlowDown",object:A.empties.Prairie_Center,radius:8E3,type:1})});t.load("files/models/dunes/D_tile_city.js",function(A){applyDunesShader(A,{D_tile_City_Collision:!0,D_tile_City_Island_Co:!0},{D_tile_City_Island:-1},{D_tile_City_Water:0.65});w[6][0]=e(A);h({name:"cityPortal",object:A.empties.City_Portal,radius:2E3,type:0,destination:"city"});h({name:"citySlowDown",object:A.empties.City_Center,
radius:1E4,type:1})});t.load("files/models/dunes/D_tile_1.js",d);t.load("files/models/dunes/D_tile_2.js",d);t.load("files/models/dunes/D_tile_3.js",d);t.load("files/models/dunes/D_tile_1.js",d);(new UgcHandler).getLatestUGOs(function(A){for(var C=0,E=A.length;C<E;C++){var M=new UgcObject(A[C]);if(!M.isEmpty()){M=M.getMesh();M.position.x=Math.random()*1E4-5E3;M.position.z=Math.random()*1E4-5E3;m.scene.addObject(M)}}});m.update=function(A,C,E){m.checkInfluenceSpheres(C,E);m.updateTiles(C);updateDunesShader(A);
L.position.copy(C.matrixWorld.getPosition());L.updateMatrix()};m.checkInfluenceSpheres=function(A,C){var E,M,N,K,ea=A.matrixWorld.getPosition();E=0;for(M=b.influenceSpheres.length;E<M;E++){K=b.influenceSpheres[E];N=K.object.matrixWorld.getPosition().distanceTo(ea);if(N<K.radius*n)if(K.type===0&&K.state===0){console.log("entered portal ["+K.name+"]");K.state=1;C&&b.signals.startexploration.dispatch(K.destination)}else{if(K.type==1)b.cameraSlowDown=!0}else{K.state=0;b.cameraSlowDown=!1}}};m.updateTiles=
function(A){var C=Math.floor(2.5),E=A.matrixWorld.getPosition(),M=E.x,N=E.z;E.addSelf(A.matrixWorld.getColumnZ().multiplyScalar(-p*1.5));A=Math.floor(E.x/p)%5;for(var K=Math.floor(E.z/p)%5;A<0;)A+=5;for(;K<0;)K+=5;var ea,o,ia,Z,oa,ha,X,$=[0,0,0,0,0,0,0],na=[-1,-1,-1,-1];for(o=-C;o<C+1;o++)for(ea=-C;ea<C+1;ea++){oa=(Math.floor(E.x/p)+ea)*p;ha=(Math.floor(E.z/p)+o)*p;ia=(A+ea)%5;for(Z=(K+o)%5;ia<0;)ia+=5;for(;Z<0;)Z+=5;X=z[Z][ia];if(ia=w[X][$[X]++]){ia.position.x=oa;ia.position.z=ha;ia.rotation.z=g(oa,
ha)}if(X<4){ia=oa-M;Z=ha-N;ia=ia*ia+Z*Z;if(na[X]===-1||ia<na[X]){na[X]=ia;if(ia=x[X]){ia.position.x=oa;ia.position.z=ha;ia.rotation.z=g(oa,ha)}}}}}},CityShaderEffectors=[new THREE.Vector4(0,0,-1E3,50),new THREE.Vector4(-100,0,-1500,150),new THREE.Vector4(100,0,-2E3,150),new THREE.Vector4(0,0,-2500,100)],CityShader={uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},
time:{type:"f",value:0},targets:{type:"fv",value:[]},radiuses:{type:"fv1",value:[]}},vertexShader:"varying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;",
"const \t int  \tNUMTARGETS = "+CityShaderEffectors.length+";","uniform vec3 \ttargets[ NUMTARGETS ];\nuniform float \tradiuses[ NUMTARGETS ];\nuniform float time;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvoid main() {\nfloat distance = -9999999.0;\nfor( int i = 0; i < NUMTARGETS; i++ ) {\ndistance = max( distance, length( vWorldPosition - targets[ i ].xyz ) * -1.0 / radiuses[ i ] );\n}\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec4 grass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += ( 0.5 + grass.g ) * texture2D( surfaceImage, worldPosition.zx * vec2( 3.0 )).g;\nvec3 surface = vec3( 0.15 * 2.0, 0.18 * 2.0, 0.2 * 2.0 );\nif( distance > 0.0 )\nsurface = grass.rgb;\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 0.0001;\ngl_FragColor = vec4( surface * vColor * 2.0, 1.0 );\ngl_FragColor = vec4( mix( gl_FragColor.rgb, vec3( 0.64, 0.88, 1 ), depth ), 1.0 );\n}"].join("\n")};
function applyCityShader(b,d){var c,e,g,f,j,h={};for(c=0;c<d.length;c++)h[d[c]]=!0;updateCityShader(0);c={uniforms:CityShader.uniforms,vertexShader:CityShader.vertexShader,fragmentShader:CityShader.fragmentShader,shading:THREE.FlatShading,vertexColors:THREE.VertexColors};c.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;c.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;c.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;c.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;
j=new THREE.MeshShaderMaterial(c);for(e in b.objects){f=b.objects[e];if(!h[e]&&f.geometry&&f.geometry.morphTargets.length===0){g=f.geometry;for(c=0;c<g.materials.length;c++)f.materials[0]=j}}return j}function updateCityShader(b){var d,c,e=CityShaderEffectors.length,g,f=CityShader.uniforms.targets.value,j,h=CityShader.uniforms.radiuses.value;for(c=j=g=0;c<e;c++){d=CityShaderEffectors[c];f[g++]=d.x;f[g++]=d.y;f[g++]=d.z;h[j++]=d.w}CityShader.uniforms.time.value+=b/1E4}
var DunesShaderEffectors={position:[new THREE.Vector3(0,0,-1E3),new THREE.Vector3(-100,0,-4500),new THREE.Vector3(100,0,-8E3),new THREE.Vector3(2E3,0,-2500)],radius:[500,500,500,500],darkness:[1,0.5,0,0],positionFlat:[],materials:[]},DunesShader={uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},time:{type:"f",value:0},target:{type:"fv",
value:[]},radius:{type:"fv1",value:[]},darkness:{type:"fv1",value:[]},dunesOpacity:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );","const \t int  \tNUMTARGETS = "+DunesShaderEffectors.position.length+";","uniform vec3 \ttarget[ NUMTARGETS ];\nuniform float \tradius[ NUMTARGETS ];\nuniform float \tdarkness[ NUMTARGETS ];\nuniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform float time;\nuniform float dunesOpacity;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vNormalsquare;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nfloat distance = -9999999.0;\nfloat fragmentDarkness = 1.0;\nfor( int i = 0; i < NUMTARGETS; i++ ) {\ndistance = max( distance, length( vWorldPosition - target[ i ].xyz ) * -1.0 / radius[ i ] );\nfragmentDarkness = min( fragmentDarkness, 1.0 - darkness[ i ] );\n}\nvec3 worldPosition = vWorldPosition * 0.0005;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.x + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.y + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.z;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4( vColor, 1.0 );\nif(distance > 0.0)\nsurface = vec4( grass.rgb * fragmentDarkness, grass.w );\ngl_FragColor = mix( surface * texture2D( surfaceImage, worldPosition.zx * vec2( 0.4 ) + vec2(time)), surface, vec4( cloudMix, 0.1 ));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float LOG2 = 1.442695;\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 50.0;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.255 );\nsky_color = mix( vec3( 1.0 ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\ngl_FragColor.a = dunesOpacity;\n}"].join("\n")};
function applyDunesShader(b,d,c,e){function g(t,v){h=new THREE.MeshShaderMaterial(m);h.uniforms=THREE.UniformsUtils.clone(m.uniforms);h.uniforms.target.value=DunesShaderEffectors.positionFlat;h.uniforms.radius.value=DunesShaderEffectors.radius;h.uniforms.darkness.value=DunesShaderEffectors.darkness;h.uniforms.grassImage.texture=m.uniforms.grassImage.texture;h.uniforms.surfaceImage.texture=m.uniforms.surfaceImage.texture;h.uniforms.invertLightY.value=t;h.uniforms.dunesOpacity.value=v;j.materials[0]=
h;DunesShaderEffectors.materials.push(h)}var f,j,h;c=c!==undefined?c:{};d=d!==undefined?d:{};e=e!==undefined?e:{};var m={uniforms:DunesShader.uniforms,vertexShader:DunesShader.vertexShader,fragmentShader:DunesShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};m.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;m.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;m.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;m.uniforms.surfaceImage.texture.wrapT=
THREE.RepeatWrapping;var n=1,p=1;for(f in b.objects)if(!d[f]){j=b.objects[f];n=c[f]?c[f]:1;p=e[f]?e[f]:1;j.geometry&&j.geometry.morphTargets.length===0&&g(n,p)}}
function updateDunesShader(b){var d,c,e=DunesShaderEffectors.position.length,g,f=DunesShaderEffectors.positionFlat;for(c=g=0;c<e;c++){d=DunesShaderEffectors.position[c];f[g++]=d.x;f[g++]=d.y;f[g++]=d.z}b=DunesShader.uniforms.time.value+=b*1.0E-5;c=0;for(e=DunesShaderEffectors.materials.length;c<e;c++)DunesShaderEffectors.materials[c].uniforms.time.value=b}
var CloudsShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",value:0},targetStart:{type:"v3",
value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},
colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 worldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nworldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 worldVector;\nvoid main() {\nfloat distance, f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nf = normalize(worldVector).y;\nf = max(f, 0.0);\nsky_color = mix(vectorA, vectorB, f);\nvec3 worldPosition = vWorldPosition * 0.0005;\nsurface = vec4( vec3( 0.5 ), 1.0 );\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0001;\ngl_FragColor = vec4( vColor, 1.0 ) + vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(vectorC.rgb, 0.1));\ngl_FragColor = gl_FragColor + vec4( vLightWeighting, 1.0 );\ndepth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 50.0;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor/*min(length(worldVector) * 0.02, 1.0) */);\ngl_FragColor = vec4(vec3(vLightWeighting) * vec3(0.9, 0.5, 0.3) + vec3(0.7, 0.6, 0.6), vLightWeighting * 0.9 + 0.1);\n}"};
function applyCloudsShader(b,d,c,e,g){var f={uniforms:d.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},j=new THREE.MeshShaderMaterial(f);j.uniforms=THREE.UniformsUtils.clone(f.uniforms);j.uniforms.targetStart.value=c;j.uniforms.targetEnd.value=e;j.uniforms.grassImage.texture=f.uniforms.grassImage.texture;j.uniforms.surfaceImage.texture=f.uniforms.surfaceImage.texture;j.uniforms.colorA.value=d.colors.colorA;
j.uniforms.colorB.value=d.colors.colorB;j.uniforms.colorC.value=d.colors.colorC;b.materials[0]=j;g.push(j);f.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;f.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;f.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;f.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping}
DunesCamera=function(b){var d=new THREE.Ray,c,e,g=new THREE.Vector3,f={forward:1,left:1,right:1,up:1,down:1},j=0,h,m;h=b.worlds.dunes;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);c=new THREE.Object3D;e=new THREE.Object3D;e.position.set(0,0,-100);h.scene.addChild(m);h.scene.addChild(m.target);h.scene.addChild(c);h.scene.addChild(e);var n={};n.camera=m;n.resetCamera=function(){c.position.set(0,50,800);e.position.set(0,50,300);e.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
m.position.copy(c.position);m.target.position.copy(e.position)};n.updateCamera=function(p,t){t=t*(1E3/30)/1E3;var v,u,w;switch(j){case 0:w="forward";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnZ().negate());v=200;u=50;break;case 1:w="left";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnX().negate());v=40;u=50;break;case 2:w="right";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnX());v=40;
u=50;break;case 3:w="down";d.origin.copy(c.matrixWorld.getPosition()).y+=100;d.direction.copy(m.matrixWorld.getColumnY().negate());u=v=50;break;case 4:w="up";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnY());v=40;u=50}j++;j>4&&(j=0);f[w]=1;var x=h.scene.collisions.rayCastNearest(d),D=-1;if(x&&x.distance!==-1){D=x.distance*0.1;w!=="down"&&D<v+u&&(f[w]=D<v?0:1-(D-v)/u)}v=b.mouse.x/b.screenWidth-0.5;u=b.mouse.y/b.screenHeight-0.5;if(w!=="forward"&&f[w]<1){x=new THREE.Vector3;
x.copy(d.direction).negate().multiplyScalar((1-f[w])*15);if(w==="left"||w==="right")x.y=0;else{x.x=0;x.z=0}e.position.addSelf(x);f[w]=Math.max(f[w],0.3);v*=0.1;u*=0.1}if(w==="down"&&D<50){w=c.position.y;c.position.y=d.origin.addSelf(d.direction.multiplyScalar(D)).y+10;e.position.y+=c.position.y-w}else d.origin.addSelf(d.direction.multiplyScalar(D)).y<200&&(f[w]=1);D=f.forward*f.up*f.down*f.right*f.left;Math.abs(e.position.y-c.position.y)<50&&(e.position.y-=u*15);e.position.y=Math.max(e.position.y,
10);e.position.y=Math.min(e.position.y,4500);g.sub(e.position,c.position).normalize();e.position.x=c.position.x+g.x*200-g.z*12*v*t;e.position.z=c.position.z+g.z*200+g.x*12*v*t;if(p<0.29){cameraSpeed=3;b.cameraSlowDown=!0;g.y=0;g.normalize();e.position.y=c.position.y}else cameraSpeed=10;b.cameraSlowDown||(cameraSpeed+=5*((Math.min(Math.max(c.position.y,10),3E3)-10)/2990));c.position.addSelf(g.multiplyScalar(cameraSpeed*D*t));if(p>0.29&&p<0.375){c.position.y+=4.5*t;e.position.y+=t*4.05}c.position.y=
Math.max(c.position.y,10);c.position.y=Math.min(c.position.y,4500);m.position.x+=(c.position.x-m.position.x)*0.02*t;m.position.y+=(c.position.y-m.position.y)*0.02*t;m.position.z+=(c.position.z-m.position.z)*0.02*t;m.target.position.x+=(e.position.x-m.target.position.x)*0.02*t;m.target.position.y+=(e.position.y-m.target.position.y)*0.02*t;m.target.position.z+=(e.position.z-m.target.position.z)*0.02*t;D=m.matrixWorld.getColumnZ();g.normalize();g.y=D.y;g.subSelf(D).normalize();g.multiplyScalar(0.3*t);
c.up.set(0,1,0);c.up.subSelf(g).normalize();m.up.x+=(c.up.x-m.up.x)*0.02;m.up.y+=(c.up.y-m.up.y)*0.02;m.up.z+=(c.up.z-m.up.z)*0.02};return n};
DunesCameraFreeExplore=function(b){var d=new THREE.Ray,c,e,g=new THREE.Vector3,f={forward:1,left:1,right:1,up:1,down:1},j=0,h,m;h=b.worlds.dunes;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);c=new THREE.Object3D;e=new THREE.Object3D;e.position.set(0,0,-100);h.scene.addChild(m);h.scene.addChild(m.target);h.scene.addChild(c);h.scene.addChild(e);var n={};n.camera=m;n.resetCamera=function(){c.position.set(0,300,0);e.position.set(0,300,-500);e.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
m.position.copy(c.position);m.target.position.copy(e.position)};n.updateCamera=function(p,t){t=1;var v,u,w;switch(j){case 0:w="forward";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnZ().negate());v=200;u=60;break;case 1:w="left";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnX().negate());v=40;u=60;break;case 2:w="right";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnX());v=40;u=60;break;case 3:w=
"down";d.origin.copy(c.matrixWorld.getPosition()).y+=100;d.direction.copy(m.matrixWorld.getColumnY().negate());v=50;u=60;break;case 4:w="up";d.origin.copy(c.matrixWorld.getPosition());d.direction.copy(m.matrixWorld.getColumnY());v=40;u=60}j++;j>4&&(j=0);f[w]=1;var x=h.scene.collisions.rayCastNearest(d),D=-1;if(x&&x.distance!==-1){D=x.distance*0.1;w!=="down"&&D<v+u&&(f[w]=D<v?0:1-(D-v)/u)}v=b.mouse.x/b.screenWidth-0.5;u=b.mouse.y/b.screenHeight-0.5;if(w!=="forward"&&f[w]<1){x=new THREE.Vector3;x.copy(d.direction).negate().multiplyScalar((1-
f[w])*15);if(w==="left"||w==="right")x.y=0;else{x.x=0;x.z=0}e.position.addSelf(x);f[w]=Math.max(f[w],0.3);v*=0.1;u*=0.1}if(w==="down"&&D<50){w=c.position.y;c.position.y=d.origin.addSelf(d.direction.multiplyScalar(D)).y+150;e.position.y+=c.position.y-w}else d.origin.addSelf(d.direction.multiplyScalar(D)).y<200&&(f[w]=1);D=f.forward*f.up*f.down*f.right*f.left;Math.abs(e.position.y-c.position.y)<50&&(e.position.y-=u*20);e.position.y=Math.max(e.position.y,150);e.position.y=Math.min(e.position.y,4500);
g.sub(e.position,c.position).normalize();e.position.x=c.position.x+g.x*200-g.z*15*v*t;e.position.z=c.position.z+g.z*200+g.x*15*v*t;cameraSpeed=12;b.cameraSlowDown||(cameraSpeed+=13*((Math.min(Math.max(c.position.y,150),3E3)-150)/2850));c.position.addSelf(g.multiplyScalar(cameraSpeed*D*t));c.position.y=Math.max(c.position.y,150);c.position.y=Math.min(c.position.y,4500);m.position.x+=(c.position.x-m.position.x)*0.02*t;m.position.y+=(c.position.y-m.position.y)*0.02*t;m.position.z+=(c.position.z-m.position.z)*
0.02*t;m.target.position.x+=(e.position.x-m.target.position.x)*0.02*t;m.target.position.y+=(e.position.y-m.target.position.y)*0.02*t;m.target.position.z+=(e.position.z-m.target.position.z)*0.02*t;D=m.matrixWorld.getColumnZ();g.normalize();g.y=D.y;g.subSelf(D).normalize();g.multiplyScalar(0.4*t);c.up.set(0,1,0);c.up.subSelf(g).normalize();m.up.x+=(c.up.x-m.up.x)*0.02;m.up.y+=(c.up.y-m.up.y)*0.02;m.up.z+=(c.up.z-m.up.z)*0.02};return n};
PrairieCameraFreeExplore=function(b){var d,c,e=new THREE.Vector3,g,f,j;g=b.worlds.dunes;j=new THREE.Vector3(300,0,-300);f=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);f.target.position.set(0,0,-100);d=new THREE.Object3D;c=new THREE.Object3D;c.position.set(0,0,-100);g.scene.addChild(f);g.scene.addChild(f.target);g.scene.addChild(d);g.scene.addChild(c);g={};g.camera=f;g.resetCamera=function(){d.position.set(j.x-200,35,j.z);c.position.set(j.x+300,35,j.z);f.position.copy(d.position);f.target.position.copy(c.position)};
g.updateCamera=function(h,m){m=1;var n=b.mouse.x/b.screenWidth-0.5,p=b.mouse.y/b.screenHeight-0.5;if(Math.abs(c.position.y-d.position.y)<100)c.position.y-=p*20;else{c.position.y>d.position.y&&(c.position.y-=20);c.position.y<d.position.y&&(c.position.y+=20)}e.sub(c.position,d.position).normalize();c.position.x=d.position.x+e.x*350-e.z*15*n*m;c.position.z=d.position.z+e.z*350+e.x*15*n*m;n=e.multiplyScalar(5*m);n.y=0;d.position.addSelf(n);p=d.position.x-j.x;var t=d.position.z-j.z;Math.sqrt(p*p+t*t)>
775&&d.position.subSelf(n);f.position.x+=(d.position.x-f.position.x)*0.02*m;f.position.y+=(d.position.y-f.position.y)*0.02*m;f.position.z+=(d.position.z-f.position.z)*0.02*m;f.target.position.x+=(c.position.x-f.target.position.x)*0.02*m;f.target.position.y+=(c.position.y-f.target.position.y)*0.02*m;f.target.position.z+=(c.position.z-f.target.position.z)*0.02*m;n=f.matrixWorld.getColumnZ();e.normalize();e.y=n.y;e.subSelf(n).normalize();e.multiplyScalar(0.5*m);d.up.set(0,1,0);d.up.subSelf(e).normalize();
f.up.x+=(d.up.x-f.up.x)*0.02;f.up.y+=(d.up.y-f.up.y)*0.02;f.up.z+=(d.up.z-f.up.z)*0.02};return g};
CityCameraFreeExplore=function(b){var d={start:new THREE.Vector3(0,10,-300),end:new THREE.Vector3(0,250,-3E3)},c,e,g=new THREE.Vector3,f,j;f=b.worlds.city;j=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);j.target.position.set(0,0,-100);c=new THREE.Object3D;e=new THREE.Object3D;e.position.set(0,0,-100);f.scene.addChild(j);f.scene.addChild(j.target);f.scene.addChild(c);f.scene.addChild(e);f={};f.camera=j;f.resetCamera=function(){c.position.copy(d.start);e.position.set(d.start.x,d.start.y,
d.end.z);j.position.copy(c.position);j.target.position.copy(e.position)};f.updateCamera=function(h,m){m=1;var n=b.mouse.x/b.screenWidth-0.5,p=b.mouse.y/b.screenHeight-0.5;Math.abs(e.position.y-c.position.y)<50&&(e.position.y-=p*20);e.position.y=Math.max(e.position.y,d.start.y);e.position.y=Math.min(e.position.y,d.end.y);g.sub(e.position,c.position).normalize();e.position.x=c.position.x+g.x*500-g.z*25*n*m;e.position.z=c.position.z+g.z*500+g.x*25*n*m;cameraSpeed=10;cameraSpeed+=2*((Math.min(Math.max(c.position.y,
d.start.y),d.end.y)-d.start.y)/(d.end.y-d.start.y));c.position.addSelf(g.multiplyScalar(cameraSpeed*m));c.position.x=d.start.x;c.position.y=Math.max(Math.min(c.position.y,d.end.y),d.start.y);c.position.z=Math.min(Math.max(c.position.z,d.end.z),d.start.z);j.position.x+=(c.position.x-j.position.x)*0.05*m;j.position.y+=(c.position.y-j.position.y)*0.05*m;j.position.z+=(c.position.z-j.position.z)*0.05*m;j.target.position.x+=(e.position.x-j.target.position.x)*0.2*m;j.target.position.y+=(e.position.y-j.target.position.y)*
0.2*m;j.target.position.z+=(e.position.z-j.target.position.z)*0.2*m;n=j.matrixWorld.getColumnZ();g.normalize();g.y=n.y;g.subSelf(n).normalize();g.multiplyScalar(0.4*m);c.up.set(0,1,0);c.up.subSelf(g).normalize();j.up.x+=(c.up.x-j.up.x)*0.05;j.up.y+=(c.up.y-j.up.y)*0.05;j.up.z+=(c.up.z-j.up.z)*0.05};return f};
Trigger=function(b,d){var c={},e=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,e);var g=1,f=0;d=d!==undefined?d:0;var j=c.mesh.morphTargetForcedOrder,h=(b.morphTargets.length-1)*1E3;j[0]=0;j[1]=1;c.play=function(m){g=m||1;f=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);
c.update(0)};c.update=function(m){f+=m*g;if(f>=h){j[0]=0;j[1]=c.mesh.geometry.morphTargets.length-1;e.uniforms.morph.value=1;e.uniforms.darkness.value=d;THREE.AnimationHandler.removeFromUpdate(c)}else{m=f/h;var n,p=0.1,t=0.7;if(m==0)m=0;else if(m==1)m=1;else{t||(t=0.3);if(!p||p<1){p=1;n=t/4}else n=t/(2*Math.PI)*Math.asin(1/p);m=p*Math.pow(2,-10*m)*Math.sin((m-n)*2*Math.PI/t)+1}m*=h;if(m<h){j[0]=Math.floor(m/1E3);j[1]=Math.ceil(m/1E3)}else{j[0]=c.mesh.geometry.morphTargets.length-2;j[1]=c.mesh.geometry.morphTargets.length-
1}e.uniforms.morph.value=m/h;e.uniforms.darkness.value=d*f/h}};return c};
var TriggerBig=function(b){var d={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});d.mesh=new THREE.Mesh(b,c);d.mesh.doubleSided=!0;var e=0.1,g=0,f=(b.morphTargets.length-1)*1E3,j=d.mesh.morphTargetForcedOrder;j[0]=0;j[1]=1;d.play=function(h){e=h||1;g=0;THREE.AnimationHandler.addToUpdate(d);d.update(0)};d.update=
function(h){g+=h*e;if(g>=f){j[0]=0;j[1]=d.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(d)}else{h=g/f*f;if(h<f){j[0]=Math.floor(h/1E3);j[1]=Math.ceil(h/1E3)}else{j[0]=d.mesh.geometry.morphTargets.length-2;j[1]=d.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=h/f}};return d},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var d=[],c=[],e=[];b.setupCityTriggers=function(g){if(g.triggers){var f,j,h,m,n=g.triggers,
p=[];for(h in n)if(h.indexOf("TriggerMesh")!==-1){m=n[h];m.name=h.slice(h.indexOf("_")+1);m.geometry=g.geometries[m.object.geometry];p.push(m);g.objects[h].parent.removeChild(g.objects[h]);g.objects[h].visible=!1;delete n[h]}d=[];c=[];for(h in n){f=0;for(j=p.length;f<j;f++)if(h.indexOf(p[f].name)!==-1&&p[f].geometry.morphTargets.length){if(n[h].type==="Small"){m=new Trigger(p[f].geometry);g.objects[h].addChild(m.mesh);m.mesh.visible=!1;d.push(m)}else{m=new TriggerBig(p[f].geometry);g.objects[h].addChild(m.mesh);
c.push(m)}m.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(g){var f,j,h=g.geometries,m,n,p,t,v,u,w;for(f in h){j=h[f];if(j.morphTargets.length){m=0;for(n=j.morphTargets.length;m<n;m++){v=j.morphTargets[m].vertices;p=0;for(t=v.length;p<t;p++){u=v[p].position;w=u.y;u.y=-u.z;u.z=w}}}}j=g.objects;e=[];for(f in j)if(j[f].geometry&&j[f].geometry.morphTargets.length){g=new Trigger(j[f].geometry,Math.random()*0.25+0.5);j[f].addChild(g.mesh);j[f].visible=!1;e.push(g)}};b.update=function(){var g,
f,j,h,m,n=b.effectors,p,t,v,u=b.effectorRadius*1.5;g=0;for(f=d.length;g<f;g++){j=d[g].mesh.matrixWorld.getPosition();h=0;for(m=n.length;h<m;h+=3){p=Math.abs(n[h+0]-j.x);t=Math.abs(n[h+1]-j.y);v=Math.abs(n[h+2]-j.z);if(p+t+v<u){d[g].play(0.1+Math.random()*0.05);d.splice(g,1);g--;f--;break}}}g=0;for(f=c.length;g<f;g++){j=c[g].mesh.matrixWorld.getPosition();h=0;for(m=n.length;h<m;h+=3){p=Math.abs(n[h+0]-j.x);t=Math.abs(n[h+1]-j.y);v=Math.abs(n[h+2]-j.z);if(p+t+v<u){c[g].play(0.2+Math.random()*0.1);c.splice(g,
1);g--;f--;break}}}g=0;for(f=e.length;g<f;g++){j=e[g].mesh.matrixWorld.getPosition();h=0;for(m=n.length;h<m;h+=3){p=Math.abs(n[h+0]-j.x);t=Math.abs(n[h+1]-j.y);v=Math.abs(n[h+2]-j.z);if(p+t+v<u){e[g].play(0.1+Math.random()*0.05);e.splice(g,1);g--;f--;break}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,d,c){var e=this;e.camera=b;renderer=c.renderer;var g=0;c.camPos=new THREE.Vector3(0,0,-300);var f=new THREE.JSONLoader;f.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};c.trigger=new THREE.Vector3(0,0,0);var j=0,h=new CollisionScene(e.camera,d,0.1,c,500,!0);h.settings.maxSpeedDivider=2;h.settings.capBottom=3;h.settings.capTop=1E3;h.settings.shootRayDown=!1;h.settings.allowFlying=!1;h.settings.emitterDivider=
5;h.settings.normalOffsetAmount=8;h.settings.minDistance=100;h.settings.keepEmitterFollowDown=!0;h.emitter.position.z=-100;h.emitterFollow.position.z=-100;h.cameraTarget.position.z=-100;f.load({model:"files/models/city/collision/City.Collision_Big.js",callback:function(C){var E=new THREE.Vector3(-1.570796,0,3.141591),M=new THREE.Vector3;h.addLoaded(C,0.1,E,M,d)}});f.load({model:"files/models/city/collision/City.Collision_Big.001.js",callback:function(C){var E=new THREE.Vector3(-1.570796,0,0),M=new THREE.Vector3;
h.addLoaded(C,0.1,E,M,d)}});f.load({model:"files/models/city/collision/City.Collision_Big.002.js",callback:function(C){var E=new THREE.Vector3(-1.570796,0,0),M=new THREE.Vector3;h.addLoaded(C,0.1,E,M,d)}});f.load({model:"files/models/city/collision/City.Collision_Big.003.js",callback:function(C){var E=new THREE.Vector3(-1.570796,0,1.570797),M=new THREE.Vector3;h.addLoaded(C,0.1,E,M,d)}});b.target=h.cameraTarget;var m=new THREE.Vector3(0,0,100),n=new Vectors(50,2,2,m),p=THREE.ImageUtils.loadTexture("files/textures/particle_0.png"),
t=THREE.ImageUtils.loadTexture("files/textures/particle_1.png"),v=THREE.ImageUtils.loadTexture("files/textures/particle_2.png"),u=THREE.ImageUtils.loadTexture("files/textures/particle_3.png"),w=THREE.ImageUtils.loadTexture("files/textures/particle_4.png"),x=new Particles(22,d,5,[p,t,v,u,w],15,50,THREE.AdditiveBlending);x.settings.gravitateTowardsCamera=!0;var D=new Stragglers(4,d,n.array);D.settings.capy=0;var z=new AnimalSwarm(30,d,n.array);z.settings.addaptiveSpeed=!0;z.settings.capy=0;z.settings.startPosition=
m;z.settings.constantSpeed=0.75;z.array[0]="moose";z.array[10]="elk";z.array[20]="elk";z.array[1]="elk";z.array[4]="moose";z.array[14]="moose";z.array[8]="fish";z.array[16]="fish";z.array[24]="fish";f.load({model:"files/models/soup/animals_A_life.js",callback:function(C){var E=[0,0,4,3,2,1,0,5,2,7,8,9,10,0,0,3,3,9,2,3],M=[6.5,13.12,9.76,7.47,4.74,4.94,0.777,6.252,3.412,5.52,5.576];z.addAnimal(C,null,1.5,E,M);E=[5,6,9,2];C=D.addAnimal(C,null,1.8,E,M);preinitAnimal(C,renderer,d)}});f.load({model:"files/models/soup/elk_life.js",
callback:function(C){C=z.addAnimal(C,"elk",2.2,null,[6]);preinitAnimal(C,renderer,d)}});f.load({model:"files/models/soup/moose_life.js",callback:function(C){C=z.addAnimal(C,"moose",1.1,null,[13.964]);preinitAnimal(C,renderer,d)}});f.load({model:"files/models/soup/fish_life.js",callback:function(C){C=z.addAnimal(C,"fish",1.6,[0,1,2,3],[2]);preinitAnimal(C,renderer,d)}});var I=new AnimalSwarm(10,d,n.array);I.settings.flying=!0;I.settings.flyingDistance=45;for(m=0;m<10;++m)m%2==0&&(I.array[m]="b");f.load({model:"files/models/soup/birds_A_life.js",
callback:function(C){C=I.addAnimal(C,null,1.3,[0,1,2,3,0,1,2,3,0,1],[4.848,7,7.5,3.5]);preinitAnimal(C,renderer,d)}});f.load({model:"files/models/soup/birds_B_life.js",callback:function(C){C=I.addAnimal(C,"b",1.3,[1,1,0,0,1,0,0,1,0,0],[8.5,8.623]);preinitAnimal(C,renderer,d)}});var B=new AnimalInFrontOfCamera(15,d);f.load({model:"files/models/soup/butterfly_hiD.js",callback:B.addAnimal});var L=new AnimalInFrontOfCamera(15,d);f.load({model:"files/models/soup/butterfly_hiC.js",callback:L.addAnimal});
var A=new Trail(80,d);A.settings.freeRotation=!1;for(m=0;m<80;++m){p=m%4;A.array[m]="0"+(p+1)}for(m=0;m<80;m+=8){p=m/8%4;A.array[m]="tree"+(p+1)}A.array[4]="light";f.load({model:"files/models/soup/grass01.js",callback:function(C){A.addInstance(C,"01",!1)}});f.load({model:"files/models/soup/grass02.js",callback:function(C){var E=A.addInstance(C,"02",!1);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/grass03.js",callback:function(C){var E=A.addInstance(C,"03",!1);preInitModel(C,renderer,
d,E)}});f.load({model:"files/models/soup/grass04.js",callback:function(C){var E=A.addInstance(C,"04",!1);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/grass05.js",callback:function(C){var E=A.addInstance(C,"05",!1);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/evergreen_low.js",callback:function(C){var E=A.addInstance(C,"tree1",!0);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/evergreen_high.js",callback:function(C){var E=A.addInstance(C,"tree2",
!0);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/treeGeneric.js",callback:function(C){var E=A.addInstance(C,"tree3",!0);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/treeGenericLower.js",callback:function(C){var E=A.addInstance(C,"tree4",!0);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/treeOrange.js",callback:function(C){var E=A.addInstance(C,"tree5",!0);preInitModel(C,renderer,d,E)}});f.load({model:"files/models/soup/lighthouse.js",callback:function(C){var E=
A.addInstance(C,"light",!1,!0);preInitModel(C,renderer,d,E);A.array[4].maxHeight=12}});this.update=function(C){if(!isNaN(C)&&!(C>1E3||C==0)){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;if(c.camPos.z<=-3290||c.camPos.x>1640||c.camPos.x<-1640){camPos=new THREE.Vector3(0,20,50);h.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);z.reset(c.camPos.x,c.camPos.y,c.camPos.z);I.reset(c.camPos.x,c.camPos.y,c.camPos.z);x.reset(c.camPos.x,
c.camPos.y,c.camPos.z);D.reset(c.camPos.x,c.camPos.y,c.camPos.z)}j%50==49&&D.create(h.emitterFollow.position,h.currentNormal,h.emitter.position);var E=Math.atan2(b.position.z-h.cameraTarget.position.z,b.position.x-h.cameraTarget.position.x);b.up.x=(E-Math.PI/2)/4*-1;++j;var M=0;if(j%4==0){M=(Math.random()-0.5)*0.6;b.up.x+=(Math.random()-0.5)*0.01}if(j%2==0)b.position.y=18+(Math.random()-0.5)*0.6;g+=Math.random();b.position.x=0+Math.sin(g/15)*30+M+(E-Math.PI/2)*-30;b.fov=60-h.cameraTarget.position.y/
25;b.updateProjectionMatrix();if(j%3==2){z.create(n.array[1].position,h.currentNormal);I.create(n.array[1].position,h.currentNormal)}h.update(c.camPos,C);n.update(h.emitterFollow.position,h.currentNormal);x.update(C,n.array[0].position,c.camPos);z.update(C,c.camPos);D.update(C,c.camPos);I.update(C,c.camPos);L.update(c.camPos,E,C);B.update(c.camPos,E,C,!0);A.update(h.emitter.position,h.emitterNormal,c.camPos,C);TWEEN.update();c.trigger.copy(n.array[10].position)}};this.changeCamera=function(C){e.camera=
C;h.settings.camera=C};this.destruct=function(){}},PrairieSoup=function(b,d,c){c.camPos=new THREE.Vector3(302.182,-9.045,-105.662);var e=new THREE.JSONLoader;e.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};e.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var g=0,f=0,j,h,m,n,p,t=new CollisionScene(b,d,1,c,1100);t.settings.maxSpeedDivider=1;t.settings.allowFlying=!1;t.settings.emitterDivider=2;t.settings.shootRayDown=!1;t.settings.keepEmitterFollowDown=!0;t.settings.normalOffsetAmount=
7;t.settings.minDistance=0;t.emitter.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);t.emitterFollow.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);var v=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30);j=new Vectors(30,1,1,v);j.absoluteTrail=!0;var u=THREE.ImageUtils.loadTexture("files/textures/dark_0.png"),w=THREE.ImageUtils.loadTexture("files/textures/dark_1.png"),x=THREE.ImageUtils.loadTexture("files/textures/dark_2.png"),D=THREE.ImageUtils.loadTexture("files/textures/dark_3.png"),
z=THREE.ImageUtils.loadTexture("files/textures/dark_4.png");p=new Particles(20,d,1.5,[u,w,x,D,z],25,40);p.settings.zeroAlphaStart=!1;p.settings.aliveDivider=2;m=new AnimalSwarm(40,d,j.array);m.settings.xPositionMultiplier=22;m.settings.zPositionMultiplier=18;m.settings.shootRayDown=!0;m.settings.adaptiveSpeed=!0;m.settings.divider=1;m.settings.startPosition=v;m.array[0]="gator";m.array[10]="gator";m.array[5]="goat";m.array[18]="goat";m.array[25]="goat";m.array[2]="octo";m.array[7]="octo";m.array[32]=
"octo";m.array[38]="octo";m.array[3]="animal";m.array[4]="animal";m.array[6]="animal";m.array[8]="animal";m.array[10]="animal";m.array[12]="animal";m.array[15]="animal";m.array[16]="animal";m.array[19]="animal";m.array[20]="animal";m.array[21]="animal";m.array[23]="animal";m.array[24]="animal";m.array[25]="animal";m.array[28]="animal";m.array[29]="animal";m.array[31]="animal";m.array[33]="animal";m.array[22]="shadow";m.array[1]="shadow";m.array[17]="arm";m.array[30]="arm";e.load({model:"files/models/soup/taruffalo_black.js",
callback:function(B){B=m.addAnimal(B,null,0.3,[0,1,0,1],[9.2,14.2]);preinitAnimal(B,c.renderer,d)}});e.load({model:"files/models/soup/animals_A_black.js",callback:function(B){B=m.addAnimal(B,"animal",0.35,[0,0,1,2,1,2,0,2,3],[13.12,9.73,6.7,3.06]);preinitAnimal(B,c.renderer,d)}});e.load({model:"files/models/soup/gator_black.js",callback:function(B){B=m.addAnimal(B,"gator",0.35,null,[4.5]);preinitAnimal(B,c.renderer,d)}});e.load({model:"files/models/soup/goat_black.js",callback:function(B){B=m.addAnimal(B,
"goat",0.45,null,[5.2]);preinitAnimal(B,c.renderer,d)}});e.load({model:"files/models/soup/shdw2.js",callback:function(B){B=m.addAnimal(B,"shadow",0.7,null,[3.5]);preinitAnimal(B,c.renderer,d)}});e.load({model:"files/models/soup/arm_black.js",callback:function(B){B=m.addAnimal(B,"arm",1.5,null,[2.5]);preinitAnimal(B,c.renderer,d)}});e.load({model:"files/models/soup/octo_black.js",callback:function(B){B=m.addAnimal(B,"octo",0.55,[0,0,0,2],[1.629,3,1.7]);preinitAnimal(B,c.renderer,d)}});n=new AnimalSwarm(10,
d,j.array);n.settings.flying=!0;n.settings.xPositionMultiplier=24;n.settings.zPositionMultiplier=12;n.settings.constantSpeed=2;n.settings.divider=4;n.settings.flyingDistance=0;e.load({model:"files/models/soup/birds_A_black.js",callback:function(B){B=n.addAnimal(B,null,0.4,[1,1,0,0,1,0,0,1,0,0],[12,14]);preinitAnimal(B,c.renderer,d)}});var I=[new THREE.MeshLambertMaterial({color:0}),new THREE.MeshLambertMaterial({color:1507842}),new THREE.MeshLambertMaterial({color:197379}),new THREE.MeshLambertMaterial({color:526344}),
new THREE.MeshLambertMaterial({color:1512194}),new THREE.MeshLambertMaterial({color:197379}),new THREE.MeshLambertMaterial({color:526344}),new THREE.MeshLambertMaterial({color:197379}),new THREE.MeshLambertMaterial({color:526344})];h=new Trail(80,d);for(i=0;i<80;++i){h.array[i]="0"+(i%2+1);h.array[i]="04"}h.settings.spread=10;h.settings.aliveDivider=40;h.settings.tweenTime=400;h.settings.scale=5;h.settings.offsetAmount=10;e.load({model:"files/models/soup/darkBlob4.js",callback:function(B){var L=h.addInstance(B,
"04",!1,!1,I);preInitModel(B,renderer,d,L)}});this.update=function(B){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;if(c.camPos.x>1090){c.camPos.set(302.182,-9.045,-105.662);t.reset(c.camPos.x,c.camPos.y,c.camPos.z);j.reset(c.camPos.x,c.camPos.y,c.camPos.z);m.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);p.reset(c.camPos.x,c.camPos.y,c.camPos.z)}g+=B;f+=B;t.update(c.camPos,B);j.update(t.emitterFollow.position,t.currentNormal);
p.update(B,j.array[0].position);m.update(B,c.camPos);n.update(B,c.camPos);h.update(t.emitter.position,t.emitterNormal,c.camPos,B);if(g>=100){B=Math.random()*20-10;var L=Math.random()*20-10,A=new THREE.Vector3,C=new THREE.Vector3;A.copy(t.emitterFollow.position);C.copy(t.emitter.position);A.x+=B;C.x+=B;A.z+=L;C.z+=L;m.create(A,t.currentNormal,C);g=0}if(f>=500){n.create(t.emitterFollow.position,t.currentNormal,t.emitter.position);f=0}TWEEN.update();TriggerUtils.effectors[0]=j.array[5].position.x;TriggerUtils.effectors[1]=
j.array[5].position.y;TriggerUtils.effectors[2]=j.array[5].position.z;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(0,0,0);c.lavatrailx=j.array[5].position.x;c.lavatrailz=j.array[5].position.z};this.destruct=function(){}},DunesSoup=function(b,d,c){c.camPos=new THREE.Vector3(0,150,0);var e=new THREE.JSONLoader;e.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};e.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var g=new CollisionScene(b,d,0.15,c,3E3);g.settings.emitterDivider=
4;g.settings.maxSpeedDivider=0.5;g.settings.allowFlying=!0;var f=new Vectors;f.settings.divider=3;var j=[new THREE.MeshBasicMaterial({color:14283771,opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,opacity:0.25})],h=new Ribbons(6,f.array,d,j);h.settings.ribbonPulseMultiplier_1=
20;h.settings.ribbonPulseMultiplier_2=0.01;h.settings.ribbonMin=0.05;h.settings.ribbonMax=0.1;var m=new AnimalSwarm(20,d,f.array);m.settings.flying=!0;m.settings.flyingDistance=10;m.settings.divider=10;m.settings.constantSpeed=0.8;m.settings.respawn=!1;for(j=0;j<20;++j)j%2==0&&(m.array[j]="b");e.load({model:"files/models/soup/birds_A_life.js",callback:function(n){n=m.addAnimal(n,null,2.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,d)}});e.load({model:"files/models/soup/birds_B_life.js",
callback:function(n){n=m.addAnimal(n,"b",2.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,d)}});this.update=function(n){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;m.create(f.array[1].position,g.currentNormal);g.update(c.camPos,n);f.update(g.emitterFollow.position,g.currentNormal);h.update(g.emitterFollow.position);m.update(n,c.camPos)};this.destruct=function(){}},Ribbon=function(b,d,c){b=b||100;d=d||10;c=c||10;THREE.Geometry.call(this);d/=2;b/=
c;for(var e=[],g=0;g<c+2;++g){var f=g*b,j=-d;e.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(f,d,0)))-1);e.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(f,j,0)))-1)}for(g=0;g<c*2;g+=2){this.faces.push(new THREE.Face3(e[g],e[g+2],e[g+1]));this.faces.push(new THREE.Face3(e[g+2],e[g+3],e[g+1]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,d){var c=ROME.AnimalAnimationData.init(b,d),e={};e.morph=0;e.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};e.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};e.availableAnimals=c.availableAnimals;e.mesh=new THREE.Mesh(b,c.material);var g=!1,f=e.mesh.morphTargetForcedOrder,j=c.material;e.play=function(m,n,p,t,v){if(!g){g=!0;e.morph=0;THREE.AnimationHandler.addToUpdate(e)}n=
n!==undefined?n:m;h(m,e.animalA);h(n,e.animalB);e.animalA.currentTime=t?t:0;e.animalB.currentTime=v?v:0;e.update(0)};e.update=function(m){if(e.mesh._modelViewMatrix){var n,p=["animalA","animalB"],t,v,u,w,x,D;t=0;v=p.length;for(D=0;t<v;t++){n=e[p[t]];x=n.currentTime;n.currentTime=(n.currentTime+m*n.timeScale)%n.lengthInMS;if(x>n.currentTime)n.currentFrame=0;x=0;u=n.currentFrame;for(w=n.lengthInFrames-1;u<w;u++)if(n.currentTime>=n.frames[u].time&&n.currentTime<n.frames[u+1].time){x=u;break}n.currentFrame=
x;u=x+1<w?x+1:0;f[D++]=n.frames[x].index;f[D++]=n.frames[u].index;x=n.frames[x].time;u=n.frames[u].time>x?n.frames[u].time:n.frames[u].time+n.lengthInMS;n=(n.currentTime-x)/(u-x);j.uniforms[p[t]+"Interpolation"].value=n}j.uniforms.animalMorphValue.value=e.morph;if(j.attributes[e.animalA.name]!==undefined)j.attributes.colorAnimalA.buffer=j.attributes[e.animalA.name].buffer;if(j.attributes[e.animalB.name]!==undefined)j.attributes.colorAnimalB.buffer=j.attributes[e.animalB.name].buffer}};e.setNewTargetAnimal=
function(m,n){if(e.morph===1){for(var p in e.animalA)e.animalA[p]=e.animalB[p];e.animalB.currentTime=n?n:0;h(m,e.animalB);e.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var h=function(m,n){if(ROME.AnimalAnimationData[m]!==undefined){n.frames=ROME.AnimalAnimationData[m];n.lengthInFrames=n.frames.length;n.lengthInMS=n.frames[n.lengthInFrames-1].time;n.name=m.toLowerCase();n.normalsOffset=Math.floor(n.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
m)};return e};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 1.0 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 ) * vec4( 0.9, 0.85, 0.8, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["tarbuffalo","horse","bearbrown","mountainlion","deer","goldenRetreiver","fox","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","shdw2","blackWidow","crab","scorp","goat","gator","tarbuffalo_runB","tarbuffalo","bearblack","panther","wolf","toad","eagle","owl","parrot","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD",
"raven","vulture","bison","sickle","armHand"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.15,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},blackWidow:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,
vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.45},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:-0.1},cow:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0.05,vOffset:-0.25},
cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,sRange:0,vRange:0.15,hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,
hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},frog:{hRange:0.05,sRange:0.1,vRange:0.25,hOffset:0.01,sOffset:0.05,vOffset:-0.1},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.26},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,sRange:0.1,vRange:0.25,hOffset:-0.005,
sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},moose:{hRange:0.07,sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.005,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.16},parrot:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.025,sOffset:0.1,
vOffset:-0.1},raccoon:{hRange:0,sRange:0.1,vRange:0.25,hOffset:0.6,sOffset:-0.1,vOffset:-0.2},raven:{hRange:0.02,sRange:0.1,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.15},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:-0.1},shdw2:{hRange:0,sRange:0.1,vRange:0.06,hOffset:0,sOffset:-0.05,vOffset:-0.15},sickle:{hRange:0.04,sRange:0,vRange:0.1,hOffset:0,sOffset:-0.2,vOffset:-0.3},stork:{hRange:0,sRange:0.1,vRange:0.2,
hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.175},toad:{hRange:0.07,sRange:0,vRange:0.1,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.08,hOffset:0,sOffset:-0.1,vOffset:-0.16},wolf:{hRange:0,sRange:0.2,vRange:0.06,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",bearbrown:"bearBrown",bearblack:"bearBlack",
blackwidow:"blackWidow",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",mountainlion:"mountainlion",mountainlionblack:"panther",
owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,d){if(b.initialized){p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,morphTargets:!0});for(j in b.customAttributes){var c=b.customAttributes[j];
p.attributes[j]=j==="colorAnimalA"||j==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var e,g,f;p=b.morphTargets;var j,h,m,n;if(d){h=0;for(m=p.length;h<m;h++){j=0;for(f=this.animalNames.length;j<f;j++){g=this.animalNames[j];if(p[h].name.indexOf(g)!==-1)break}if(j===f){g=p[h].name;for(j=0;j<g.length;j++){f=g.charCodeAt(j);if(!(f>=65&&f<=90||f>=97&&f<=122))break}this.animalNames.push(g.slice(0,
j))}}}j=0;for(f=this.animalNames.length;j<f;j++){g=this.animalNames[j];e=this[g];n=0;if(e===undefined||e.length===0){e=this[g]=[];h=0;for(m=p.length;h<m;h++)if(p[h].name.indexOf(g)!==-1){e.push({index:h,time:n});n+=parseInt(1E3/24,10);c.indexOf(g)===-1&&c.push(g)}}else{h=0;for(m=p.length;h<m;h++)c.indexOf(g)===-1&&p[h].name.indexOf(g)!==-1&&c.push(g)}}var p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:ROME.AnimalShader.attributes(),vertexShader:ROME.AnimalShader.vertexShader,
fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors}),t;e=b.morphColors;n=p.attributes;if(b.morphColors&&b.morphColors.length){h=0;for(m=e.length;h<m;h++){t=e[h];g=t.name;for(j=0;j<g.length;j++){f=g.charCodeAt(j);if(!(f>=65&&f<=90||f>=97&&f<=122))break}g=g.slice(0,j).toLowerCase();n[g]={type:"c",boundTo:"faces",value:t.colors};j=this.colorVariations.zero;this.animalVariationMap[g]!==undefined&&(j=this.colorVariations[this.animalVariationMap[g]]);
p.uniforms.lightScale.value=j.lScale?j.lScale:0.5;j.lOffset?p.uniforms.lightOffset.value.set(j.lOffset[0],j.lOffset[1],j.lOffset[2]):p.uniforms.lightOffset.value.set(0.6,0.6,0.6);randomizeColors(n[g].value,j)}n.colorAnimalA.value=e[0].colors;n.colorAnimalB.value=e[0].colors;j=0;for(f=c.length;j<f;j++){g=c[j].toLowerCase();h=0;for(m=e.length;h<m;h++){t=e[h].name.toLowerCase();if(t.indexOf(g)!==-1)break}if(h===m){console.error("Animal.constructor: Morph Color missing for animal "+g+". Deploying backup plan.");
n[g]={type:"c",boundTo:"faces",value:[]};h=0;for(m=b.faces.length;h<m;h++)n[g].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");h=0;for(m=b.faces.length;h<m;h++)n.colorAnimalA.value.push(new THREE.Color(16711935));n.colorAnimalB.value=n.colorAnimalA.value;j=0;for(f=c;j<f;j++)n[c[j]]={type:"c",boundTo:"faces",value:n.colorAnimalA.value}}b.availableAnimals=c;b.customAttributes=p.attributes}return{availableAnimals:b.availableAnimals,
material:p}}};function randomizeColors(b,d){var c,e,g,f,j,h;c=0;for(e=b.length;c<e;c++){g=b[c];f=d.hRange*Math.random()+d.hOffset;j=d.sRange*Math.random()+d.sOffset;h=d.vRange*Math.random()+d.vOffset;THREE.ColorUtils.adjustHSV(g,f,j,h)}}
var Ribbons=function(b,d,c,e){var g=this,f=[],j=[];g.initSettings={numOfRibbons:b||6};g.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var h=0,m;for(m=0;m<g.initSettings.numOfRibbons;++m){var n=new Ribbon(15,6,d.length-35),p=new THREE.Mesh(n,e[m%e.length]);p.doubleSided=!0;c.addObject(p);f.push({r:n,rm:p,offset:3+Math.floor(Math.random()*10)});j.push(p)}this.update=function(t){h+=0.1;for(m=0;m<d.length;++m)for(var v=d[m].position.x,u=d[m].position.y,
w=d[m].position.z,x=0;x<b;++x){var D=f[x].r,z=f[x].offset;if(!(m<z)){var I=Math.cos((m-h*10)/10)*g.settings.ribbonPulseMultiplier_1,B=Math.cos((m-h*10)/8)*g.settings.ribbonPulseMultiplier_2,L=x*(Math.PI*2/f.length),A=Math.cos(L+(m-h*10)/8)*I;I*=Math.sin(L+(m-h*10)/8);for(L=0;L<2;++L){var C=(m-z)*2+L;if(D.vertices[C]!=undefined){var E=m-h*2,M=Math.max(g.settings.ribbonMin,m/(10+B));M=Math.min(M,g.settings.ribbonMax);var N=Math.cos(E/3)*M;E=Math.sin(E/3)*M;D.vertices[C].position.x=v-t.x+N+A;if(L==0){D.vertices[C].position.y=
u+E+I-t.y;D.vertices[C].position.z=w+N+A-t.z}else{D.vertices[C].position.y=u-E+I-t.y;D.vertices[C].position.z=w-N+A-t.z}}}}}for(m=0;m<f.length;++m){v=f[m].rm;v.position=t;D=f[m].r;D.__dirtyVertices=!0;v.visible=g.settings.visible}}},Vectors=function(b,d,c,e){var g=this;g.array=[];var f;g.initSettings={length:b||50};g.settings={divider:d||4,normaldivider:c||10,absoluteTrail:!1,startPosition:e||new THREE.Vector3(0,0,0)};for(f=0;f<g.initSettings.length;++f){b=new THREE.Vector3(0,0,0);b.copy(g.settings.startPosition);
b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};g.array.push(b)}this.update=function(j,h){for(f=0;f<g.initSettings.length;++f){var m=g.array[f];if(f==0)var n=j.x,p=j.y,t=j.z,v=h.x,u=h.y,w=h.z;else{n=g.array[f-1].lastposition.x;p=g.array[f-1].lastposition.y;t=g.array[f-1].lastposition.z;v=g.array[f-1].normal.x;u=g.array[f-1].normal.y;w=g.array[f-1].normal.z}g.array[f].lastposition.x=m.position.x;g.array[f].lastposition.y=m.position.y;g.array[f].lastposition.z=
m.position.z;if(g.settings.absoluteTrail){m.position.x=n;m.position.y=p;m.position.z=t;m.normal.x=v;m.normal.y=u;m.normal.z=w}else{p=(p-m.position.y)/g.settings.divider;t=(t-m.position.z)/g.settings.divider;m.position.x+=(n-m.position.x)/g.settings.divider;m.position.y+=p;m.position.z+=t;n=(u-m.normal.y)/g.settings.normaldivider;w=(w-m.normal.z)/g.settings.normaldivider;m.normal.x+=(v-m.normal.x)/g.settings.normaldivider;m.normal.y+=n;m.normal.z+=w}}};this.reset=function(j,h,m){for(var n=0;n<g.array.length;++n){var p=
g.array[n];p.position.x=j;p.position.y=h;p.position.z=m}}},Particles=function(b,d,c,e,g,f,j){var h=this,m=[];j=j||THREE.NormalBlending;h.initSettings={numOfParticleSystems:b||25,numInSystem:g||60,spread:f||50,particleSize:c||8};h.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var n;c=new THREE.Geometry;for(n=0;n<h.initSettings.numInSystem;n++){g=new THREE.Vector3(Math.random()*h.initSettings.spread-h.initSettings.spread/2,Math.random()*h.initSettings.spread-h.initSettings.spread/
2,Math.random()*h.initSettings.spread-h.initSettings.spread/2);c.vertices.push(new THREE.Vertex(g))}for(n=0;n<h.initSettings.numOfParticleSystems;n++){g=new THREE.ParticleBasicMaterial({size:h.initSettings.particleSize,map:e[n%e.length],transparent:!0,depthTest:!0,blending:j});g=new THREE.ParticleSystem(c,g);g.rotation.x=Math.random()*Math.PI;g.rotation.y=Math.random()*Math.PI;g.rotation.z=Math.random()*Math.PI;m.push({c:g,alivetime:n});d.addObject(g)}this.update=function(p,t,v){if(isNaN(p)||p>1E3)p=
1E3/60;p/=60;for(n=0;n<b;++n){var u=m[n].c;m[n].alivetime+=p/h.settings.aliveDivider;if(m[n].alivetime>=b){m[n].alivetime=0;u.scale.x=u.scale.y=u.scale.z=0.1;u.position.x=t.x;u.position.y=t.y;u.position.z=t.z;if(h.settings.gravitateTowardsCamera){var w=-100;t.x>v.x&&(w=100);m[n].c.tox=t.x-w;m[n].c.toy=0;m[n].c.toz=t.z-100;w=u.position.x-m[n].c.tox;var x=u.position.y-m[n].c.toy,D=u.position.z-m[n].c.toz;w=1E3+Math.abs(w*w+x*x+D*D)/25;u.position.y=t.y+50;u.rotation.x=Math.random()*Math.PI+Math.PI/2;
u.rotation.y=Math.random()*Math.PI;u.rotation.z=Math.random()*Math.PI+Math.PI/2;u.scale.x=u.scale.y=u.scale.z=1.25;(new TWEEN.Tween(u.position)).to({x:m[n].c.tox,y:m[n].c.toy,z:m[n].c.toz},w).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(u.rotation)).to({x:0,z:0},w).easing(TWEEN.Easing.Quadratic.EaseIn).start();(new TWEEN.Tween(u.scale)).to({x:5,y:0.05,z:5},w).easing(TWEEN.Easing.Linear.EaseNone).start()}u.materials[0].opacity=h.settings.zeroAlphaStart?0:1}else{w=m[n].alivetime;if(!h.settings.gravitateTowardsCamera){u.position.y+=
0.1;u.rotation.y+=0.015;u.rotation.z+=0.01;u.scale.x=u.scale.y=u.scale.z=0.5+Math.max(w/15,1)}w=h.settings.zeroAlphaStart?w/4:1-w/(m.length*2);w=Math.min(w,1);u.materials[0].opacity=w}}};this.reset=function(p,t,v){for(var u=0;u<m.length;++u){var w=m[u].c;w.position.x=p;w.position.y=t;w.position.z=v}}},AnimalSwarm=function(b,d,c){var e=this;e.array=[];new THREE.Vector3;var g=0;e.initSettings={numOfAnimals:b||30};e.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,
constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1,respawn:!0,gravity:!1};var f;this.addAnimal=function(j,h,m,n,p){h=h||null;var t=m||1.2;n=n||null;for(f=0;f<e.initSettings.numOfAnimals;++f)if(!(h==null&&e.array[f]!=undefined||h!=e.array[f])){p==null&&(p=[1]);var v=ROME.Animal(j,!1),u=v.mesh;u.position.copy(e.settings.startPosition);m=0.02+Math.random()/8;f<2&&(m=0.15);m=Math.max(m,0.1);u.matrixAutoUpdate=!1;u.visible=
!1;d.addChild(u);var w=0,x=0;if(n!=null){w=n[f%n.length]%v.availableAnimals.length;x=w+1;if(Math.round(Math.random())==1&&w>0||x>v.availableAnimals.length-1)x=w-1}var D=p[w],z=p[x];v.play(v.availableAnimals[w],v.availableAnimals[x],0,Math.random(),Math.random());var I=Math.random();f<2&&(I=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);m={c:u,a:v,f:f,keepRunning:!1,time:0,lifetime:0,dead:!1,startMorph:w,endMorph:x,speeda:D,speedb:z,toPosition:new THREE.Vector3(0,0,0),active:!1,normal:new THREE.Vector3(0,
1,0),count:I,scale:m*t,origscale:m*t,ray:ray,rayIndex:f%4,lastToy:0};e.array[f]=m}return v};this.removeAnimal=function(j,h){for(f=0;f<e.initSettings.numOfAnimals;++f){var m=e.array[f].a;if(m!=undefined){var n=e.array[f].startMorph,p=e.array[f].endMorph;if(m.mesh.geometry==j&&(h==n||h==p)){d.removeChild(e.array[f].c);delete e.array[f].a;e.array[f].active=!1;break}}}};this.switchAnimal=function(j,h,m,n,p){var t=h||1.2;for(f=0;f<e.initSettings.numOfAnimals;++f){p!=undefined&&(f=p);h=e.array[f].a;var v=
e.array[f].startMorph,u=e.array[f].endMorph;if(!(h!=undefined&&h.mesh.geometry==j&&p==undefined&&(v==n||u==n))){console.log("adding on "+f);p=e.array[f].c.position;j=ROME.Animal(j,!1);v=j.mesh;h=0.02+Math.random()/8;f<2&&(h=0.15);h=Math.max(h,0.1);v.position=p;v.visible=!1;v.scale.set(1.0E-5,1.0E-5,1.0E-5);v.updateMatrix();v.matrixAutoUpdate=!1;d.removeChild(e.array[f].c);d.addChild(v);j.play(j.availableAnimals[n],j.availableAnimals[n],0,Math.random(),Math.random());e.array[f].c=v;e.array[f].a=j;
e.array[f].scale=h*t;e.array[f].origscale=h*t;e.array[f].speeda=m;e.array[f].speedb=m;e.array[f].active=!1;e.array[f].startMorph=n;e.array[f].endMorph=n;break}}};this.create=function(j,h,m){for(f=0;f<e.initSettings.numOfAnimals;++f)if(!(e.array[f].active||e.array[f].a==undefined)){e.array[f].active=!0;e.array[f].c.position.copy(j);e.array[f].normal.copy(h);e.array[f].c.visible=!0;e.array[f].f=0;e.array[f].time=0;e.array[f].lifetime=0;e.array[f].dead=!1;e.array[f].scale=e.array[f].origscale;e.array[f].keepRunning=
!1;e.array[f].gravity=0;if(e.settings.gravity){e.array[f].c.matrixAutoUpdate=!0;e.array[f].c.scale.set(e.array[f].scale,e.array[f].scale,e.array[f].scale);e.array[f].c.rotation.x=0;e.array[f].c.rotation.y=Math.random()*Math.PI}if(!e.settings.respawn)e.array[f].f=f;if(m!=undefined){var n=new THREE.Vector3,p=new THREE.Vector3;n.copy(j);p.copy(m);e.array[f].keepRunning=!0;e.array[f].toPosition=p.subSelf(n).normalize();e.array[f].toPosition.x<0&&(e.array[f].toPosition.x*=-1);e.array[f].toPosition.x<0.5&&
(e.array[f].toPosition.x+=0.5);e.array[f].toPosition.z<0&&(e.array[f].toPosition.z+=0.5)}if(m==undefined){e.array[f].scale*=0.25;(new TWEEN.Tween(e.array[f])).to({scale:e.array[f].origscale},2E3).easing(TWEEN.Easing.Elastic.EaseOut).delay(200).start()}j=e.array[f].scale;e.array[f].c.position.x-=h.x*j*400;e.array[f].c.position.y-=h.y*j*400;e.array[f].c.position.z-=h.z*j*400;e.array[f].lastToy=e.array[f].c.position.y;break}};this.update=function(j){if(isNaN(j)||j>1E3||j==0)j=1E3/60;++g;for(f=0;f<e.initSettings.numOfAnimals;++f){var h=
e.array[f];if(h.active){var m=h.c,n=h.scale,p=h.normal,t=h.f,v=e.array[f].dead;e.array[f].time+=j;e.array[f].lifetime+=j;if(e.array[f].lifetime>2500&&e.settings.respawn)e.array[f].dead=!0;e.array[f].count+=0.04;var u=Math.max(Math.cos(e.array[f].count),0);u=Math.min(u,1);e.array[f].a.morph=u;var w=h.speeda;if(Math.round(u)==1)w=h.speedb;if(e.array[f].keepRunning){u=m.position.x+e.array[f].toPosition.x*100;x=m.position.y+e.array[f].toPosition.y*100;D=m.position.z+e.array[f].toPosition.z*100}else{if(e.array[f].time>
Math.max(w*25,80)&&e.settings.respawn){++e.array[f].f;if(e.array[f].f>=40){e.array[f].f=40;e.array[f].dead=!0}t=e.array[f].f;e.array[f].time=0}p=f*(Math.PI*2/6);u=Math.cos(p+(f-0)/8)*e.settings.xPositionMultiplier;x=D=Math.sin(p+(f-0)/8)*e.settings.zPositionMultiplier;p=c[t].normal;u=c[t].position.x+u*(1-Math.abs(p.x));var x=c[t].position.y+x*(1-Math.abs(p.y)),D=c[t].position.z+D*(1-Math.abs(p.z))}e.array[f].keepRunning||p.y>0.5&&(x=c[t].position.y-10);if(e.settings.capy!=null&&x<e.settings.capy)x=
e.settings.capy;if(e.settings.flying)if(e.array[f].keepRunning)x=e.array[f].toPosition.y+e.settings.flyingDistance;else{var z=e.settings.flyingDistance;p.x<-0.8&&(u-=z);p.x>0.8&&(u+=z);if(p.y<-0.8||p.y>0.8)x+=z;p.z<-0.8&&(D-=z);p.z>0.8&&(D+=z)}if(e.settings.constantSpeed!=null){e.array[f].a.animalA.timeScale=e.settings.constantSpeed;e.array[f].a.animalB.timeScale=e.settings.constantSpeed}if(e.settings.shootRayDown)if(e.array[f].rayIndex==g%4){h=h.ray;h.origin.copy(m.position);h.origin.y+=500;if(z=
d.collisions.rayCastNearest(h)){x=h.origin.y-(z.distance*1+3);p=z.mesh.matrixRotationWorld.multiplyVector3(z.normal).normalize();e.array[f].lastToy=x;e.array[f].normal.copy(p)}}else x=e.array[f].lastToy;if(e.settings.gravity){e.array[f].gravity+=0.3;x=m.position.y-=e.array[f].gravity;D=m.position.z;u=m.position.x;m.rotation.x+=0.04;m.rotation.y+=0.02}z=h=7;if(e.array[f].keepRunning){h=4;z=Math.abs(x-m.position.y)>10?h/2:h*2}e.settings.flying&&(z=8);u=(u-m.position.x)/h;x=(x-m.position.y)/z;D=(D-m.position.z)/
h;e.array[f].dead&&!v&&(new TWEEN.Tween(e.array[f])).to({scale:e.array[f].scale*0.1},400).easing(TWEEN.Easing.Quartic.EaseIn).start();v=0.1;e.array[f].keepRunning&&(v=0.01);if(e.array[f].dead&&n<=v){e.array[f].active=!1;e.array[f].c.visible=!1}else{t=e.array[f].keepRunning?w/15:w/(2+t/10);if(!e.array[f].keepRunning){x>t&&(x=t);x<-t&&(x=-t)}u>t&&(u=t);u<-t&&(u=-t);D>t&&(D=t);D<-t&&(D=-t);if(!e.settings.gravity){t=new THREE.Vector3(m.position.x+u,m.position.y+x,m.position.z+D);t.subSelf(m.position).normalize();
w=new THREE.Vector3;p=new THREE.Vector3(p.x*-1,p.y*-1,p.z*-1);if(e.settings.flying||e.settings.gravity)p=new THREE.Vector3(0,-1,0);w.cross(t,p);p.cross(t,w);m.matrixWorld.n11=w.x*n;m.matrixWorld.n12=p.x*n;m.matrixWorld.n13=t.x*n;m.matrixWorld.n14=m.position.x;m.matrixWorld.n21=w.y*n;m.matrixWorld.n22=p.y*n;m.matrixWorld.n23=t.y*n;m.matrixWorld.n24=m.position.y;m.matrixWorld.n31=w.z*n;m.matrixWorld.n32=p.z*n;m.matrixWorld.n33=t.z*n;m.matrixWorld.n34=m.position.z}m.position.x+=u;m.position.y+=x;m.position.z+=
D}}}};this.reset=function(j,h,m){for(var n=0;n<e.initSettings.numOfAnimals;++n){var p=e.array[n].c;p.position.x=j;p.position.y=h;p.position.z=m;e.array[n].active=!1}}},AnimalInFrontOfCamera=function(b,d){var c=this,e=[];c.initSettings={numOfAnimals:b||30};c.settings={};var g=0,f,j=new THREE.Cube(10,10,10),h=new THREE.Mesh(j);d.addChild(h);this.addAnimal=function(m){for(var n=0;n<c.initSettings.numOfAnimals;++n){var p=ROME.Animal(m,!1),t=p.mesh,v=0.02+Math.random()/8,u=Math.random()*120-60,w=n*10-
10,x=Math.random()*120-60;t.position.x=u;t.position.y=w;t.position.z=x;h.addChild(t);p.animalA.timeScale=0.8;p.animalB.timeScale=0.8;p.play(p.availableAnimals[0],p.availableAnimals[0],0,Math.random());e.push({c:t,x:u,y:w,z:x,a:p,scale:v*1.5})}};this.update=function(m,n,p,t){g+=0.1;h.position=m;if(!t){h.position.x-=Math.cos(n)*110;h.position.z-=Math.sin(n)*110}if(isNaN(p)||p>1E3)p=1E3/60;for(f=0;f<c.initSettings.numOfAnimals;++f){var v=e[f];m=v.c;n=v.x;t=v.y;v=v.z;var u=Math.sin(f-g);n+=Math.cos(f-
g);t+=0.5*(p/20);v+=u;t>140&&(t=-10);m.lookAt(new THREE.Vector3(n,t,v));m.position.x=n;m.position.y=t;m.position.z=v;e[f].x=n;e[f].y=t;e[f].z=v}}},Trail=function(b,d){var c=this;c.array=[];c.initSettings={numOfInstances:b||100};c.settings={spread:70,visible:!0,aliveDivider:c.initSettings.numOfInstances,tweenTime:2500,scale:1,offsetAmount:6,freeRotation:!0};var e;this.addInstance=function(g,f,j,h,m){f=f||null;j=j||!1;h=h||!1;for(e=0;e<c.initSettings.numOfInstances;++e)if(!(f==null&&c.array[e]!=undefined||
f!=c.array[e])){var n=m==undefined?new THREE.Mesh(g,new THREE.MeshFaceMaterial):new THREE.Mesh(g,m[e%m.length]);n.scale.x=n.scale.y=n.scale.z=1.0E-8;var p={c:n,alivetime:e,normal:new THREE.Vector3,tree:j,lightHouse:h};d.addObject(n);c.array[e]=p}return n};this.update=function(g,f,j,h){if(isNaN(h)||h>1E3)h=1E3/60;h/=c.settings.aliveDivider;for(e=0;e<c.array.length;++e){var m=c.array[e],n=m.c,p=m.alivetime,t=m.tree;m=m.lightHouse;p+=h;if(p>c.initSettings.numOfInstances){n.position.x=g.x;n.position.y=
g.y;n.position.z=g.z;n.rotation.x=0;n.rotation.z=0;n.rotation.y=0;p=c.settings.offsetAmount;t&&(p=c.settings.offsetAmount+2);var v=0,u=0,w=0;if(c.settings.freeRotation){n.position.x=g.x-f.x*p;n.position.y=g.y-f.y*p;n.position.z=g.z-f.z*p;n.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(f.x));n.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(f.z));n.rotation.x=0;n.rotation.z=0;n.rotation.y=Math.random()*Math.PI;n.up.copy(f);n.lookAt(n.position)}else{if(f.x<
-0.5){n.position.x=g.x+p/2;n.rotation.z=1.57;n.rotation.x=Math.random()*Math.PI;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=0;v=n.rotation.x;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(f.x>0.5){n.position.x=g.x-p/2;n.rotation.z=-1.57;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=0;v=n.rotation.x;u=n.rotation.y}n.rotation.x=Math.random()*Math.PI;n.position.y+=Math.random()*c.settings.spread-
c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(f.y<-0.9){n.position.y=g.y+p;n.rotation.y=Math.random()*Math.PI;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=1.57;v=n.rotation.x;u=n.rotation.y}n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(f.y>0.9){n.position.y=g.y-p;n.rotation.y=Math.random()*Math.PI;if(t){w+=n.rotation.z+(Math.random()-0.5);n.rotation.z=1.57;v=
n.rotation.x;u=n.rotation.y}n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(f.z<-0.5){n.position.z=g.z+p/2;n.rotation.x=-1.57;n.rotation.y=Math.random()*Math.PI;if(t){v=n.rotation.x+(Math.random()-0.5);n.rotation.x=0;w=n.rotation.z;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}if(f.z>0.5){n.position.z=g.z-p/2;n.rotation.x=
1.57;n.rotation.y=Math.random()*Math.PI;if(t){v=n.rotation.x+(Math.random()-0.5);n.rotation.x=0;w=n.rotation.z;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}}t&&(new TWEEN.Tween(n.rotation)).to({x:v,y:u,z:w},c.settings.tweenTime).easing(TWEEN.Easing.Elastic.EaseOut).start();if(t&&n.position.x<j.x+60&&n.position.x>j.x-60){n.position.x=j.x+60;if(n.position.x<j.x)n.position.x=j.x-60}n.scale.x=n.scale.y=
n.scale.z=0.001*c.settings.scale;p=zscale=yscale=0.1*c.settings.scale;if(m){p=zscale=yscale=0.4*c.settings.scale;if(Math.abs(f.y)<0.9)continue}if(!t&&!m){yscale=0.3*c.settings.scale;p=zscale=0.4*c.settings.scale}v=TWEEN.Easing.Quintic.EaseOut;if(t||m)v=TWEEN.Easing.Elastic.EaseOut;(new TWEEN.Tween(n.scale)).to({x:p,y:yscale,z:zscale},c.settings.tweenTime).easing(v).start();p=0}c.array[e].alivetime=p;n.visible=c.settings.visible}}},CollisionScene=function(b,d,c,e,g,f){function j(A,C,E,M,N,K,ea,o,ia){A=
new THREE.Mesh(A,ia);A.scale.set(C,C,C);A.position.set(E,M,N);A.rotation.set(K,ea,o);A.updateMatrix();h.settings.useOldRay?w.addObject(A):d.addObject(A);return A}var h=this;h.currentNormal=new THREE.Vector3(0,1,0);h.emitterNormal=new THREE.Vector3(0,1,0);h.distance=0;h.initSettings={};h.settings={useOldRay:f||!1,maxSpeedDivider:2,emitterDivider:5,cameraTargetDivider:10,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:g||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,
minDistance:10,camera:b};var m=new THREE.Vector3(0,0,1),n=new THREE.Ray,p=new THREE.Matrix4,t=new THREE.Matrix4,v=new THREE.Vector3,u=new THREE.Projector,w=new THREE.Scene;c=new THREE.Cube(5,5,5);h.emitter=j(c,1,e.camPos.x,e.camPos.y,e.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));h.emitterFollow=j(c,1,e.camPos.x,e.camPos.y,e.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,opacity:0.4}));if(h.settings.useOldRay)h.cameraTarget=j(c,1,e.camPos.x,e.camPos.y,e.camPos.z,
0,0,0,new THREE.MeshBasicMaterial({color:3407667,opacity:0.4}));h.emitter.visible=!1;h.emitterFollow.visible=!1;c=new THREE.Cube(5E4,5E4,10,1,1,1);g=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var x=new THREE.Mesh(c,g),D=new THREE.Mesh(c,g);c=new THREE.Cube(10,5E4,5E4,1,1,1);var z=new THREE.Mesh(c,g),I=new THREE.Mesh(c,g);c=new THREE.Cube(5E4,10,5E4,1,1,1);var B=new THREE.Mesh(c,g),L=new THREE.Mesh(c,g);if(h.settings.useOldRay){w.addObject(x);w.addObject(D);w.addObject(z);w.addObject(I);
w.addObject(B);w.addObject(L)}else{d.addObject(x);d.addObject(D);d.addObject(z);d.addObject(I);d.addObject(B);d.addObject(L);x.visible=!1;D.visible=!1;z.visible=!1;I.visible=!1;B.visible=!1;L.visible=!1}this.addLoaded=function(A,C,E,M){var N=new THREE.MeshLambertMaterial({color:16711680,opacity:0.5});A=new THREE.Mesh(A,N);A.scale.x=A.scale.y=A.scale.z=C;A.rotation=E||new THREE.Vector3;A.position=M||new THREE.Vector3;w.addObject(A)};this.update=function(A,C){I.position.x=A.x+h.settings.collisionDistance;
z.position.x=A.x-h.settings.collisionDistance;I.position.z=A.z;I.position.y=A.y;z.position.z=A.z;z.position.y=A.y;x.position.z=A.z-h.settings.collisionDistance;D.position.z=A.z+h.settings.collisionDistance;x.position.x=A.x;x.position.y=A.y;D.position.x=A.x;D.position.y=A.y;L.position.y=A.y-h.settings.collisionDistance;B.position.y=A.y+h.settings.collisionDistance;L.position.x=A.x;L.position.z=A.z;B.position.x=A.x;B.position.z=A.z;if(h.settings.capBottom!=null&&L.position.y<h.settings.capBottom)L.position.y=
h.settings.capBottom;if(h.settings.capTop!=null&&B.position.y<h.settings.capTop)B.position.y=h.settings.capTop;if(h.settings.useOldRay){var E=new THREE.Vector3(e.mouse.x/e.screenWidth*2-1,-(e.mouse.y/e.screenHeight)*2+1,0.5);u.unprojectVector(E,b);var M=new THREE.Ray(A,E.subSelf(A).normalize()),N=M.intersectScene(w);if(N.length>0)for(var K=0;K<N.length;++K)if((E.z<0?N[K].point.z<A.z:N[K].point.z>A.z)&&N[K].object!=h.emitter&&N[K].object!=h.emitterFollow){h.emitter.position=N[K].point;M=Math.atan2(A.z-
h.emitter.position.z,A.x-h.emitter.position.x);h.emitter.position.x-=Math.cos(M)*h.settings.minDistance/10;h.emitter.position.z-=Math.sin(M)*h.settings.minDistance;if(h.emitter.position.z>A.z-20)h.emitter.position.z=A.z-20;M=N[K].object.matrixRotationWorld.multiplyVector3(N[K].face.normal.clone());h.emitterNormal=M;if(N[K].object==I||N[K].object==x||N[K].object==D||N[K].object==z||N[K].object==B){h.emitterNormal.x=0;h.emitterNormal.y=1;h.emitterNormal.z=0;if(!h.settings.allowFlying)h.emitter.position.y=
L.position.y+5}break}}else{m.x=e.mouse.x/e.screenWidth*2-1;m.y=-(e.mouse.y/e.screenHeight)*2+1;m.z=1;n.origin.copy(m);p.copy(h.settings.camera.matrixWorld);p.multiplySelf(THREE.Matrix4.makeInvert(h.settings.camera.projectionMatrix,t));p.multiplyVector3(n.origin);n.direction.copy(n.origin);n.direction.subSelf(A);if((N=d.collisions.rayCastNearest(n))&&N.distance>h.settings.minDistance){K=N.distance*h.settings.scale;if(K>h.settings.collisionDistance)K=h.settings.collisionDistance}else{N={mesh:I};K=h.settings.collisionDistance}h.distance=
K;v.copy(n.origin);v.addSelf(n.direction.multiplyScalar(K));h.emitter.position=v;if(N.normal!=undefined){M=N.mesh.matrixRotationWorld.multiplyVector3(N.normal).normalize();h.currentNormal=M;h.emitterNormal=M}if(N.mesh==I||N.mesh==x||N.mesh==D||N.mesh==z||N.mesh==B||N.mesh==L){h.currentNormal.set(0,1,0);if(!h.settings.allowFlying&&!h.settings.shootRayDown)h.emitter.position.y=L.position.y;if(h.settings.shootRayDown){n.origin.copy(h.emitter.position);n.direction.set(0,-1,0);if((N=d.collisions.rayCastNearest(n))&&
N.distance!==-1){h.emitter.position.y-=N.distance*h.settings.scale;M=N.mesh.matrixRotationWorld.multiplyVector3(N.normal).normalize();h.currentNormal=M}else{h.emitter.position.y=-h.settings.collisionDistance;h.currentNormal.set(0,1,0)}}}h.emitter.position.x+=h.currentNormal.x*h.settings.normalOffsetAmount;h.emitter.position.y+=h.currentNormal.y*h.settings.normalOffsetAmount;h.emitter.position.z+=h.currentNormal.z*h.settings.normalOffsetAmount}if(isNaN(C)||C>1E3||C==0)C=1E3/60;N=C/h.settings.maxSpeedDivider;
K=h.emitter.position.x;K=(K-h.emitterFollow.position.x)/h.settings.emitterDivider;M=h.emitter.position.y;M=(M-h.emitterFollow.position.y)/h.settings.emitterDivider;E=h.emitter.position.z;E=(E-h.emitterFollow.position.z)/h.settings.emitterDivider;M>N&&(M=N);M<-N&&(M=-N);K>N&&(K=N);K<-N&&(K=-N);E>N&&(E=N);E<-N&&(E=-N);h.emitterFollow.position.x+=K;h.emitterFollow.position.y+=M;h.emitterFollow.position.z+=E;if(h.settings.keepEmitterFollowDown&&!h.settings.useOldRay){h.emitterFollow.position.y=h.emitter.position.y+
h.settings.collisionDistance;n.origin.copy(h.emitterFollow.position);n.direction.set(0,-1,0);if(N=d.collisions.rayCastNearest(n)){h.emitterFollow.position.y-=N.distance*h.settings.scale-h.settings.normalOffsetAmount;M=N.mesh.matrixRotationWorld.multiplyVector3(N.normal).normalize();h.currentNormal=M}}if(h.settings.useOldRay){E=new THREE.Vector3;M=new THREE.Ray(h.emitterFollow.position,E);var ea=1E4,o=h.emitterFollow.position,ia,Z;E.set(-1,0,0);M.direction=E;N=M.intersectScene(w);if(N.length>0)for(K=
0;K<N.length;++K)if(N[K].object!=h.emitter&&N[K].object!=z&&N[K].object!=I){if(N[K].distance<ea){ea=N[K].distance;o=N[K].point;Z=N[K].face;ia=N[K].object}break}E.set(1,0,0);M.direction=E;N=M.intersectScene(w);if(N.length>0)for(K=0;K<N.length;++K)if(N[K].object!=h.emitter&&N[K].object!=z&&N[K].object!=I){if(N[K].distance<ea){ea=N[K].distance;o=N[K].point;Z=N[K].face;ia=N[K].object}break}E.set(0,-1,0);M.direction=E;N=M.intersectScene(w);if(N.length>0)for(K=0;K<N.length;++K)if(N[K].object!=h.emitter&&
N[K].object!=B){if(N[K].distance<ea){o=N[K].point;Z=N[K].face;ia=N[K].object}break}h.emitterFollow.position=o;if(ia!=undefined){M=ia.matrixRotationWorld.multiplyVector3(Z.normal.clone());h.currentNormal=M}M=h.emitterFollow.position.y;M=(M-h.cameraTarget.position.y)/h.settings.cameraTargetDivider;K=h.emitterFollow.position.x;K=(K-h.cameraTarget.position.x)/h.settings.cameraTargetDivider;E=h.emitterFollow.position.z;E=(E-h.cameraTarget.position.z)/h.settings.cameraTargetDivider;N=8;M>4&&(M=4);M<-4&&
(M=-4);K>N&&(K=N);K<-N&&(K=-N);E>N&&(E=N);E<-N&&(E=-N);h.cameraTarget.position.x+=K;h.cameraTarget.position.y+=M;h.cameraTarget.position.z+=E;if(h.cameraTarget.position.z>A.z-80)h.cameraTarget.position.z=A.z-80;e.renderer.render(w,b);e.renderer.clear()}};this.reset=function(A,C,E){h.emitter.position.set(A,C,E);h.emitterFollow.position.set(A,C,E);h.settings.useOldRay&&h.cameraTarget.position.set(A,C,E)}};
ROME.TrailShaderUtils=function(){var b={},d,c,e,g,f,j=-9999999,h=-9999999,m=9999999,n=9999999,p,t;b.setMaterials=function(v,u,w,x){e=u;c=w;f=x;g=f.getContext();d=g.createTexture();g.bindTexture(g.TEXTURE_2D,d);g.texImage2D(g.TEXTURE_2D,0,g.RGB,e,e,0,g.RGB,g.UNSIGNED_BYTE,null);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,
g.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=d;var D,z,I,B,L,A;u=0;for(w=v.length;u<w;u++){D=v[u];x=D.position.x;z=D.position.y;A=D.geometry.vertices;B=0;for(L=A.length;B<L;B++){I=A[B].position;D=I.x+x;I=I.y+z;j=Math.max(j,D);h=Math.max(h,I);m=Math.min(m,D);n=Math.min(n,I)}}p=j-m;t=h-n;var C,E;for(u=0;u<w;u++){D=v[u];x=D.position.x;z=D.position.y;A=D.geometry.vertices;C=ROME.TrailShader.attributes();
E=C.trailUV.value;B=0;for(L=A.length;B<L;B++){I=A[B].position;E.push(new THREE.Vector2((I.x+x-m)/p,(I.y+z-n)/t))}x=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:C,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});x.fog=!0;x.lights=!0;x.vertexColors=2;x.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;x.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;x.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
x.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;x.uniforms.lavaMap.texture.wrapS=x.uniforms.lavaMap.texture.wrapT=THREE.Repeat;x.uniforms.lavaNoiseMap.texture.wrapS=x.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;D.materials[0]=x}};b.updateLava=function(v,u,w){v=v!==undefined?v:1;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(u!==undefined?u:0,0,w!=undefined?w:0);ROME.TrailShader.uniforms.lavaTime.value+=v;if(ROME.TrailShader.uniforms.lavaTime.value>1)ROME.TrailShader.uniforms.lavaTime.value=
0;if(ROME.TrailShader.uniforms.lavaTime.value<0)ROME.TrailShader.uniforms.lavaTime.value=0};b.setMarkAtWorldPosition=function(v,u){if(e){var w=(v-m)/p*e,x=(u-n)/t*e;if(w>=0&&w<e-c.image.width&&x>=0&&x<e-c.image.height){g.bindTexture(g.TEXTURE_2D,d);g.texSubImage2D(g.TEXTURE_2D,0,w,x,g.RGB,g.UNSIGNED_BYTE,c.image)}}};return b}();
ROME.TrailShader={textures:{trailMap:undefined,faceMap:THREE.ImageUtils.loadTexture("files/textures/PaintDubs.jpg"),lavaMap:THREE.ImageUtils.loadTexture("files/textures/lava.jpg"),lavaNoiseMap:THREE.ImageUtils.loadTexture("files/textures/Color_noise.jpg")},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,
0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",
value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue, f;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0)).rg;\nf = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nmixValue = f + max(1.0 - length(vec2(0.015) * vec2(vPos.xy - lavaHeadPosition.xz) + lookup * vec2(0.4)), 0.0);\nif(mixValue > 0.5)\n{\ngl_FragColor = gl_FragColor.gggg * vec4(0.27, 0.25, 0.3, 1.0) - vec4(0.1, 0.1, 0.1, 1.0);\nmixValue = abs((texture2D(lavaNoiseMap, vTrailUV.yx * vec2(40.0, -40.0)).r - 0.5));\nmixValue = max(max(1.0 - mixValue * 32.0, 0.0) * (lookup.r - 0.5) * 8.0, 0.0);\ngl_FragColor += vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0) - vec2( lavaTime * 2.5)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) - vec2( lavaTime * 2.5)).rrrr * vec4(2.0);\n}\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,d){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var e;this.addAnimal=function(g,f,j,h,m){f=f||null;var n=j||1.2;h=h||null;for(e=0;e<c.initSettings.numOfAnimals;++e)if(!(f==null&&c.array[e]!=undefined||f!=c.array[e])){m==null&&(m=[1]);var p=ROME.Animal(g,!1),t=p.mesh;j=0.02+Math.random()/8;j=Math.max(j,0.1);t.matrixAutoUpdate=!1;t.visible=!1;d.addChild(t);var v=0,u=0;if(h!=null){v=h[e%h.length]%
p.availableAnimals.length;u=v+1;if(Math.round(Math.random())==1&&v>0||u>p.availableAnimals.length-1)u=v-1}var w=m[v],x=m[u];p.play(p.availableAnimals[v],p.availableAnimals[u],0,Math.random(),Math.random());u=Math.random();e<2&&(u=0);j={c:t,a:p,active:!1,startMorph:v,speeda:w,speedb:x,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:u,scale:j*n,origscale:j*n};c.array[e]=j}};this.create=function(g,f,j){for(e=0;e<c.initSettings.numOfAnimals;++e)if(!c.array[e].active){c.array[e].active=
!0;c.array[e].position.copy(g);c.array[e].normal.copy(f);c.array[e].c.position.copy(g);c.array[e].c.visible=!0;c.array[e].toVector=j.subSelf(g).normalize();c.array[e].toVector.x*=1-Math.abs(f.x);c.array[e].toVector.y*=1-Math.abs(f.y);c.array[e].toVector.z*=1-Math.abs(f.z);c.array[e].scale=0.01;(new TWEEN.Tween(c.array[e])).to({scale:c.array[e].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();g=c.array[e].scale;c.array[e].c.position.x-=f.x*g*150;c.array[e].c.position.y-=f.y*g*150;c.array[e].c.position.z-=
f.z*g*150;break}};this.update=function(g,f){isNaN(g);for(e=0;e<c.initSettings.numOfAnimals;++e){var j=c.array[e];if(j.active){var h=j.c,m=j.scale,n=j.normal,p=j.position,t=j.toVector,v=p.x+t.x*10,u=p.y+t.y*10,w=p.z+t.z*10;n.y>0.5&&(u-=10);if(c.settings.capy!=null&&u<c.settings.capy){u=c.settings.capy;n.set(0,1,0)}c.array[e].count+=0.05;p=Math.max(Math.cos(c.array[e].count),0);p=Math.min(p,1);c.array[e].a.morph=p;if(c.settings.constantSpeed!=null){c.array[e].a.animalA.timeScale=c.settings.constantSpeed;
c.array[e].a.animalB.timeScale=c.settings.constantSpeed}var x=j.speeda;if(Math.round(p)==1)x=j.speedb;j=(v-h.position.x)/5;p=(u-h.position.y)/5;t=(w-h.position.z)/5;p>x&&(p=x);p<-x&&(p=-x);j>x&&(j=x);j<-x&&(j=-x);t>x&&(t=x);t<-x&&(t=-x);v=new THREE.Vector3(v,u,w);v.subSelf(h.position).normalize();u=new THREE.Vector3;n=new THREE.Vector3(n.x*-1,n.y*-1,n.z*-1);u.cross(v,n);n.cross(v,u);h.matrixWorld.n11=u.x*m;h.matrixWorld.n12=n.x*m;h.matrixWorld.n13=v.x*m;h.matrixWorld.n14=h.position.x;h.matrixWorld.n21=
u.y*m;h.matrixWorld.n22=n.y*m;h.matrixWorld.n23=v.y*m;h.matrixWorld.n24=h.position.y;h.matrixWorld.n31=u.z*m;h.matrixWorld.n32=n.z*m;h.matrixWorld.n33=v.z*m;h.matrixWorld.n34=h.position.z;h.position.x+=j;h.position.y+=p;h.position.z+=t;c.array[e].position.copy(h.position);if(h.position.z>f.z+100){c.array[e].active=!1;c.array[e].c.visible=!1}}}};this.reset=function(g,f,j){for(var h=0;h<c.array.length;++h){var m=c.array[h].c;m.position.x=g;m.position.y=f;m.position.z=j;c.array[h].active=!1;c.array[h].c.visible=
!1}}},VideoPlane=function(b,d,c){var e,g,f,j,h,m=!1,n=!1,p=d.path.match("png$")||d.path.match("jpg$"),t=new PolyTrail(b.mouse.x,b.mouse.y);this.locked=d.locked;this.path=d.path;this.removed=!1;this.removeAt=d.removeAt||1;if(p)g=THREE.ImageUtils.loadTexture(d.path);else{VideoLoadRegister[d.path]=1;e=document.createElement("video");e.src=d.path;e.preload=!0;e.load();b.signals.loadItemAdded.dispatch();e.addEventListener("canplaythrough",function(){if(VideoLoadRegister[d.path]==1){b.signals.loadItemCompleted.dispatch();
VideoLoadRegister[d.path]=2}},!1);setTimeout(function(){if(VideoLoadRegister[d.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[d.path]=2}},1E4);g=new THREE.Texture(e);g.minFilter=THREE.LinearFilter;g.magFilter=THREE.LinearFilter}switch(d.shaderId){case VIDEO_OPAQUE:j=VideoShaderSource.opaque;break;case VIDEO_OPAQUE_DISTORT:j=VideoShaderSource.distortOpaque;m=!0;break;case VIDEO_KEYED_DISTORT:j=VideoShaderSource.distortKeyed;m=!0;n=!0;break;case VIDEO_HALFALPHA:j=VideoShaderSource.halfAlpha;
break;case VIDEO_SMARTALPHA:j=VideoShaderSource.smartAlpha;break;case VIDEO_SMARTALPHA_DISTORT:j=VideoShaderSource.distortSmartalpha;m=!0;break;case VIDEO_KEYED_INVERSE:j=VideoShaderSource.keyedInverse;n=!0;break;default:j=VideoShaderSource.keyed;n=!0}var v=THREE.UniformsUtils.clone(j.uniforms);v.map.texture=g;if(m){v.mouseXY.value=new THREE.Vector2(0,0);v.aspect.value=c.aspect;v.mouseSpeed.value=0;v.mouseRad.value=0}if(n){v.colorScale.value=d.colorScale;v.threshold.value=d.threshold;v.alphaFadeout.value=
d.alphaFadeout}h=new THREE.MeshShaderMaterial({uniforms:v,vertexShader:j.vertexShader,fragmentShader:j.fragmentShader,depthTest:!1});if(!d.width)d.width=m?1.104:1;if(!d.height)d.height=m?1.24:1;j=m?c.grid:new THREE.Plane(1,1,40,1);if(d.paralax)for(var u=0;u<j.vertices.length;++u)j.vertices[u].position.z=(1-Math.sin((j.vertices[u].position.x+0.5)*Math.PI))*500;this.mesh=new THREE.Mesh(j,h);this.mesh.scale.x=d.width;this.mesh.scale.y=d.height;this.mesh.position.z=d.z;this.mesh.position.y=d.y||0;this.mesh.scale.x*=
Math.abs(d.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(d.z)*c.adj;this.start=function(w){if(!p){e.currentTime=e.duration*w;e.play();g.needsUpdate=!0;f=setInterval(function(){if(e.readyState===e.HAVE_ENOUGH_DATA)g.needsUpdate=!0},1E3/24)}};this.stop=function(){if(!p){e.pause();clearInterval(f)}};this.updateUniform=function(w,x,D,z){if(m){t.target.x=-w*c.aspect;t.target.y=-x;t.update();for(u=0;u<=4;u++)h.uniforms["trail"+u].value=t.s[u];h.uniforms.mouseXY.value.x=-w*c.aspect;h.uniforms.mouseXY.value.y=
-x;h.uniforms.mouseSpeed.value=D;h.uniforms.mouseRad.value=z}}};function PolyTrail(){this.target=new THREE.Vector2(0,0);this.s=[];for(var b=0;b<=4;b++)this.s[b]=new THREE.Vector2(0,0)}PolyTrail.prototype.update=function(){for(var b=4;b>=1;b-=1){this.s[b].x+=(this.s[b-1].x-this.s[b].x)/10;this.s[b].y+=(this.s[b-1].y-this.s[b].y)/10}this.s[0].x+=(this.target.x-this.s[0].x)/10;this.s[0].y+=(this.target.y-this.s[0].y)/10};
var VideoLoadRegister={},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VIDEO_KEYED_INVERSE=6,VIDEO_SMARTALPHA=7,VIDEO_SMARTALPHA_DISTORT=8,VideoPlayer=function(b,d,c){var e=this,g=(new Date).getTime();SequencerItem.call(this);var f={},j=[],h=!1,m,n,p=b.renderer,t=b.renderTarget,v=0,u=0,w=0,x=0,D=0,z=0,I=0,B=new THREE.Vector2(0,0),L;this.duration=d[0].duration;this.init=function(){f.prx=c.paralaxHorizontal||0;f.pry=c.paralaxVertical||0;f.tgd=c.targetDistance||
1500;onGrid=function(A){f.grid=A;e.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){h=!0;b.signals.mousemoved.add(function(){v=b.mouse.x/b.screenWidth*-2+1;u=b.mouse.y/b.screenHeight*2-1});L=new THREE.Vector2(0,0);f.fov=54;f.aspect=2.35;f.adj=Math.tan(f.fov*Math.PI/360)*2;n=new THREE.Camera(f.fov,f.aspect,1,1E5);n.target.position=new THREE.Vector3(0,0,f.tgd*-1);n.updateMatrix();m=new THREE.Scene;m.addLight(new THREE.AmbientLight(0));
m.addObject(n);for(var A=0;A<d.length;A++){var C=new VideoPlane(b,d[A],f);j.push(C)}};this.show=function(A){for(var C=0;C<j.length;C++){var E=j[C];E.locked?n.addChild(E.mesh):m.addChild(E.mesh);E.start(A)}};this.hide=function(){for(var A=0;A<j.length;A++)j[A].stop()};this.update=function(A,C,E){E=(new Date).getTime();C=E-g;g=E;if(h){D=v;z=u;B.x+=(1E3*Math.max(Math.min(D-w,0.05),-0.05)/C-B.x)/12;B.y+=(1E3*Math.max(Math.min(z-x,0.05),-0.05)/C-B.y)/12;I+=(Math.max(Math.min(Math.abs(B.x)+Math.abs(B.y),
3),0.4)-I)/2;w=v;x=u;L.x=v*-2*f.prx;L.y=u*2*f.pry;L.x=Math.min(L.x,f.prx);L.x=Math.max(L.x,-f.prx);L.y=Math.min(L.y,f.pry);L.y=Math.max(L.y,-f.pry);n.target.position.x+=(L.x-n.target.position.x)/2;n.target.position.y+=(L.y-n.target.position.y)/2;for(A=0;A<j.length;A++)j[A].updateUniform(v,u,B,I);p.render(m,n,t)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var DistortUniforms={aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5},mouseXY:{type:"v2",value:new THREE.Vector2},trail0:{type:"v2",value:new THREE.Vector2},trail1:{type:"v2",value:new THREE.Vector2},trail2:{type:"v2",value:new THREE.Vector2},trail3:{type:"v2",value:new THREE.Vector2},trail4:{type:"v2",value:new THREE.Vector2},mouseSpeed:{type:"v2",value:new THREE.Vector2},mouseRad:{type:"f",
value:1}},DistortShaderFragmentPars="uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distancePoly;\nvarying float distance;",DistortVertexShader="uniform vec2 mouseXY;\nuniform vec2 trail0;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform vec2 trail4;\nuniform float aspect;\nuniform vec2 mouseSpeed;\nuniform float mouseRad;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distance;\nvarying float distancePoly;\nfloat getDistance(vec2 p, vec2 l1, vec2 l2){\nfloat A = p.x - l1.x;\nfloat B = p.y - l1.y;\nfloat C = l2.x - l1.x;\nfloat D = l2.y - l1.y;\nfloat dot = A * C + B * D;\nfloat len_sq = C * C + D * D;\nfloat param = dot / len_sq;\nfloat xx,yy;\nif(param < 0.)\n{\n   xx = l1.x;\n   yy = l1.y;\n}\nelse if(param > 1.)\n{\n    xx = l2.x;\n    yy = l2.y;\n}\nelse\n{\n    xx = l1.x + param * C;\n    yy = l1.y + param * D;\n}\nreturn 1. - sqrt( ((p.x - xx) * (p.x - xx)) + ((p.y - yy) * (p.y - yy)) );\n}\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUvPoly = uv+vec2(normal.x,normal.y);\nvec4 glPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nvec2 projPos = vec2(aspect,1.)*vec2(gl_Position.x/gl_Position.z,gl_Position.y/gl_Position.z);\nvec2 projPosPoly = vec2(aspect,1.)*vec2(glPosPoly.x/glPosPoly.z,glPosPoly.y/glPosPoly.z);\ndistance = max(0.,1.-length(vec2(projPos)-vec2(mouseXY.x, mouseXY.y)));\ndistance *= mouseRad;\nfloat distFade = normal.z*0.9+0.4;\nfloat distanceTrail0 = distFade*getDistance(projPosPoly,mouseXY,trail0);\nfloat distanceTrail1 = -0.3+1.3*distFade*getDistance(projPosPoly,trail0,trail1);\nfloat distanceTrail2 = -0.5+1.5*distFade*getDistance(projPosPoly,trail1,trail2);\nfloat distanceTrail3 = -0.7+1.7*distFade*getDistance(projPosPoly,trail2,trail3);\nfloat distanceTrail4 = -0.9+1.9*distFade*getDistance(projPosPoly,trail3,trail4);\ndistancePoly = max(distanceTrail0,max(distanceTrail1,max(distanceTrail2,max(distanceTrail3,distanceTrail4))));\ngl_Position.xy = gl_Position.xy + normalize(projPos.xy-vec2(mouseXY.x, mouseXY.y))*vec2(distance*100.);\ngl_Position.xy = gl_Position.xy -mouseSpeed.xy*pow(distance,2.)*100.;\ngl_Position.z -= distance;\n}",
VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( map, vUv );\n}"},keyedInverse:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t > threshold )\nalpha = (1.0 - (t - threshold)) / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},distortSmartalpha:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\nc.a = a.r;\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x * 0.6666, vUvPoly.y ) );\nvec4 aPoly = texture2D( map, vec2( 0.6666 + vUvPoly.x * 0.3333, vUvPoly.y ) );\ncPoly.a = aPoly.r;\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.2) discard;\nelse gl_FragColor = c;\n}"].join("\n")},
smartAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},keyed:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",
value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},
distortOpaque:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.1) discard;\nelse gl_FragColor = c;\n}"].join("\n")},distortKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.6) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"].join("\n")},
distortWire:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.3 && cPoly.a>0.05) cPoly = vec4(cPoly.rgb*2.,distancePoly/4.); \nelse cPoly = vec4(1.,1.,1.,0.); \ngl_FragColor = cPoly;\n}"].join("\n")},distortWireKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.8 && cPoly.a>0.) cPoly = vec4(1.,1.,1.,distancePoly/16.); \nelse cPoly = vec4(1.,1.,1.,0.); \ngl_FragColor = cPoly;\n}"].join("\n")}},
VideoShots={confParalax:{paralaxHorizontal:600,paralaxVertical:100},confStill:{paralaxHorizontal:0,paralaxVertical:0},introLayers:[{path:"files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,fps:48,duration:22E3}],s01_01:[{path:"files/videos/city/s01_layer01.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:3120}],s01_03:[{path:"files/videos/city/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1200,width:1.56,height:1.59,paralax:!0,duration:8120,fps:12},{path:"files/videos/city/s03_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,
z:-700,width:1.3,height:1.16,paralax:!0},{path:"files/videos/city/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0,removeAt:0.3,fps:12}],s01_06:[{path:"files/videos/city/s06_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:2030},{path:"files/videos/city/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900}],s01_09:[{path:"files/videos/city/s09_layer04.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,duration:8230,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,paralax:!0,width:1.5625,
height:1.1627,fps:10},{path:"files/videos/city/s09_layer03.webm",shaderId:VIDEO_SMARTALPHA,z:-900,paralax:!0,removeAt:0.8,width:1.5625,height:1.1627},{path:"files/videos/city/s09_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-800,paralax:!0,removeAt:0.8,width:1.5625,height:1.1627},{path:"files/videos/city/s09_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-500,locked:!0,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,removeAt:0.3,fps:10}],s02_01:[{path:"files/videos/prairie/s01_layer04.webm",shaderId:VIDEO_OPAQUE,
z:-1400,width:1,height:1.83,paralax:!0,duration:9230},{path:"files/videos/prairie/s01_layer03.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1100,width:1.56,height:1.22,paralax:!0},{path:"files/videos/prairie/s01_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-700,paralax:!0,width:1.56,height:1.83},{path:"files/videos/prairie/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-30,locked:!0}],s02_02:[{path:"files/videos/prairie/s02_layer03.jpg",shaderId:VIDEO_OPAQUE,z:-1010,duration:2020},{path:"files/videos/prairie/s02_layer02.webm",
shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3},{path:"files/videos/prairie/s02_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-990}],s02_03:[{path:"files/videos/prairie/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1500,duration:2030},{path:"files/videos/prairie/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_04:[{path:"files/videos/prairie/s04_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:5E3},{path:"files/videos/prairie/s04_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_06:[{path:"files/videos/prairie/s06_layer02.webm",
shaderId:VIDEO_KEYED_INVERSE,colorScale:0.92,threshold:2.4,alphaFadeout:1,z:-1010,duration:6060},{path:"files/videos/prairie/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,removeAt:0.9,z:-1E3}],s03_01:[{path:"files/videos/dunes/s01_layer04.webm",shaderId:VIDEO_OPAQUE,z:-1200,width:1.56,height:1.22,paralax:!0,duration:8E3},{path:"files/videos/dunes/s01_layer03.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3,width:1.56,height:1.22,paralax:!0},{path:"files/videos/dunes/s01_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,
z:-800,width:1.56,height:1.22,paralax:!0},{path:"files/videos/dunes/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0}],s03_02:[{path:"files/videos/dunes/s02_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:3500},{path:"files/videos/dunes/s02_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s03_03:[{path:"files/videos/dunes/s03_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-1400,paralax:!0,width:1.526,height:1.11,duration:11E3},{path:"files/videos/dunes/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,
z:-1E3,locked:!0}]},City=function(b){var d=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("city initScene");d.update(0.001,34.99,45199)});var c,e,g,f=b.renderer,j=b.renderTarget;b.debug=!1;if(function(h){return(h=RegExp("[?&]"+h+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(h[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){c=new THREE.Camera(60,b.viewportWidth/b.viewportHeight,1,1E5);c.position.set(0,20,-300);e=new CityWorld(b);
g=new CitySoup(c,e.scene,b);b.worlds.city=e;b.sequences.city=this;console.log("city init")};this.resetCamera=function(){c.position.set(0,20,-300);f.setClearColor(e.scene.fog.color);f.setStencilShadowDarkness(0.7)};this.show=function(){this.resetCamera();b.started.city=!0;console.log("show city")};this.hide=function(){};this.update=function(h,m){THREE.AnimationHandler.update(m);g.update(m);c.position.z-=0.9*m/8;if(c.position.z<-3300)c.position.z=-300;f.render(e.scene,c,j);e.update(m,c,!1);b.logger.log("vertices: "+
f.data.vertices);b.logger.log("faces: "+f.data.faces);b.logger.log("draw calls: "+f.data.drawCalls)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){var d=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("prairie initScene");d.update(9.0E-4,49.99,90375)});var c,e,g,f=b.renderer,j=b.renderTarget,h,m=[];this.init=function(){m=[[302.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,
-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var n,p;for(n=0;n<m.length;n++){p=m[n][1];m[n][1]=m[n][2]+6;m[n][2]=-p}h=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E6,waypoints:m,duration:25,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,
lookSpeed:0.004,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0.3,Math.PI-0.3]}});h.position.set(0,0,0);h.lon=360;c=h;e=new PrairieWorld(b,c);g=new PrairieSoup(c,e.scene,b);b.worlds.prairie=e;b.sequences.prairie=this;e.scene.addObject(h.animationParent);console.log("prairie init")};this.show=function(){this.resetCamera();b.started.prairie=!0;console.log("show prairie")};this.hide=function(){};this.resetCamera=
function(){c.position.set(0,0,0);c.lon=360;c.animation.play(!0,0)};this.update=function(n,p){if(isNaN(p)||p>1E3||p==0)p=1E3/60;THREE.AnimationHandler.update(p);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/300;c.animationParent.position.y+=(Math.random()-0.5)*0.3;e.update(p,c,!1);g.update(p);f.render(e.scene,c,j);b.logger.log("vertices: "+f.data.vertices);b.logger.log("faces: "+f.data.faces);b.logger.log("draw calls: "+f.data.drawCalls)}};Prairie.prototype=new SequencerItem;
Prairie.prototype.constructor=Prairie;
var Dunes=function(b){SequencerItem.call(this);var d=this,c,e,g,f=b.renderer,j=b.renderTarget;b.signals.initscenes.add(function(){console.log("dunes initScene");d.update(9.0E-4,49.99,90375)});this.init=function(){e=new DunesWorld(b);b.worlds.dunes=e;b.sequences.dunes=this;c=DunesCamera(b);g=new DunesSoup(c.camera,e.scene,b);console.log("dunes init")};this.show=function(){c.resetCamera();b.started.dunes=!0;console.log("show dunes")};this.hide=function(){};this.resetCamera=function(){c.resetCamera();
f.setClearColor(e.scene.fog.color)};this.update=function(h,m,n){c.updateCamera(h,m,n);THREE.AnimationHandler.update(m);e.update(m,c.camera,!1);g.update(m);f.render(e.scene,c.camera,j)}};Dunes.prototype=new SequencerItem;Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var d,c,e,g,f,j,h,m,n,p;d=document.createElement("div");d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.backgroundColor="#4584b4";d.style.textAlign="center";var t=!1;this.load=function(){function v(u,w,x){var D=document.createElement("div");D.style.position="absolute";D.style.cursor="pointer";D.style.margin=u;var z=document.createElement("img");z.src=w;D.appendChild(z);D.addEventListener("mouseout",function(){z.src=
w},!1);D.addEventListener("mouseover",function(){z.src=x},!1);return D}c=document.createElement("canvas");c.width=32;c.height=window.innerHeight;e=c.getContext("2d");g=e.createLinearGradient(0,0,0,c.height);g.addColorStop(0,"#0e223a");g.addColorStop(0.5,"#4584b4");e.fillStyle=g;e.fillRect(0,0,c.width,c.height);d.style.backgroundImage="url("+c.toDataURL("image/png")+")";d.style.backgroundRepeat="repeat-x";f=new Clouds(b);f.getDomElement().style.position="absolute";f.getDomElement().style.left="0px";
f.getDomElement().style.top="0px";f.getDomElement().style.width=window.innerWidth+"px";f.getDomElement().style.height=window.innerHeight+"px";d.appendChild(f.getDomElement());j=document.createElement("div");j.style.position="absolute";j.innerHTML='<img src="files/logo_heart.png">';d.appendChild(j);h=v("10px 0 0 85px","files/enter_idle.png","files/enter_rollover.png");h.addEventListener("click",function(){n.getDomElement().style.display="block";h.style.display="none";t=!0;b.signals.load.dispatch()},
!1);d.appendChild(h);m=v("10px 0 0 85px","files/start_idle.png","files/start_rollover.png");m.style.display="none";m.addEventListener("click",function(){b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1)},1E3)},!1);d.appendChild(m);n=new LoadingBar(function(){n.getDomElement().style.display="none";m.style.display="block";t=!1;b.signals.initscenes.dispatch()});n.getDomElement().style.position="absolute";n.getDomElement().style.display="none";d.appendChild(n.getDomElement());
b.signals.loadItemAdded.add(n.addItem);b.signals.loadItemCompleted.add(n.completeItem);p=document.createElement("div");p.style.position="absolute";p.style.left="0";p.style.bottom="0";p.style.width="100%";new Footer(p);d.appendChild(p)};this.show=function(){f.show();d.style.display="block"};this.resize=function(v,u){f.resize(v,u);j.style.top="60px";j.style.left=(window.innerWidth-358)/2+"px";h.style.top=m.style.top="210px";h.style.left=m.style.left=(window.innerWidth-358)/2+"px";n.getDomElement().style.top=
"215px";n.getDomElement().style.left=(window.innerWidth-300)/2+"px";d.style.width=v+"px";d.style.height=u+"px"};this.hide=function(){f.hide();d.style.display="none"};this.update=function(){t||f.update()};this.getDomElement=function(){return d}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function d(){j=!1;g.pause()}function c(M){switch(M.keyCode){case 32:g.paused?g.play():g.pause();break;case 37:g.currentTime--;h.clear();break;case 39:g.currentTime++;h.clear();break;case 38:g.playbackRate+=0.1;break;case 40:g.playbackRate-=0.1;break;case 77:g.volume=g.volume?0:1}}Section.call(this);var e,g,f,j=!1,h,m,n;e=document.createElement("div");e.style.display="none";g=document.createElement("audio");g.preload=!0;e.appendChild(g);source=document.createElement("source");
source.src="files/Black.ogg";g.appendChild(source);f=new Tune(g);f.setBPM(85);f.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);m=new THREE.WebGLRenderer;m.domElement.style.position="absolute";m.setSize(b.viewportWidth,b.baseHeight);m.sortObjects=!1;m.autoClear=!1;n=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);n.minFilter=THREE.LinearFilter;n.magFilter=THREE.LinearFilter;
b.renderer=m;b.renderTarget=n;b.signals.startfilm.add(function(M,N){e.appendChild(m.domElement);j=!0;g.currentTime=f.getPatternMS(M)/1E3;g.play();g.volume=N});b.signals.stopfilm.add(d);THREE.ImageUtils.loadTexture("files/textures/fingerprints.png");var p=new VideoPlayer(b,VideoShots.introLayers,VideoShots.confStill),t=new VideoPlayer(b,VideoShots.s01_01,VideoShots.confStill),v=new VideoPlayer(b,VideoShots.s01_03,VideoShots.confParalax),u=new VideoPlayer(b,VideoShots.s01_06,VideoShots.confStill),w=
new VideoPlayer(b,VideoShots.s01_09,VideoShots.confParalax),x=new VideoPlayer(b,VideoShots.s02_01,VideoShots.confParalax),D=new VideoPlayer(b,VideoShots.s02_02,VideoShots.confStill),z=new VideoPlayer(b,VideoShots.s02_03,VideoShots.confStill),I=new VideoPlayer(b,VideoShots.s02_04,VideoShots.confStill),B=new VideoPlayer(b,VideoShots.s02_06,VideoShots.confStill),L=new VideoPlayer(b,VideoShots.s03_01,VideoShots.confParalax),A=new VideoPlayer(b,VideoShots.s03_02,VideoShots.confStill),C=new VideoPlayer(b,
VideoShots.s03_03,VideoShots.confParalax);h=new Sequencer;h.add(new ClearEffect(b),f.getPatternMS(0),f.getPatternMS(73.25),0);h.add(p,f.getPatternMS(0),f.getPatternMS(8),1);p=f.getPatternMS(8);var E=f.getPatternMS(16);h.add(t,p,p+t.duration,1);p+=t.duration;h.add(v,p,p+v.duration,1);p+=v.duration;h.add(u,p,p+u.duration,1);p+=u.duration;h.add(w,p,E,4);t=f.getPatternMS(16)-3E3;h.add(new City(b),t,f.getPatternMS(24),1);h.add(new PaintEffect(b),t,f.getPatternMS(24),5);t=f.getPatternMS(24);f.getPatternMS(32);
h.add(x,t,t+x.duration,1);t+=x.duration;h.add(D,t,t+D.duration,1);t+=D.duration;h.add(z,t,t+z.duration,1);t+=z.duration;h.add(I,t,t+I.duration,1);t+=I.duration;h.add(B,t,t+B.duration,4);x=f.getPatternMS(32)-3E3;h.add(new Prairie(b),x,f.getPatternMS(40),1);h.add(new PaintEffectPrairie(b),x,f.getPatternMS(40),5);x=f.getPatternMS(40);f.getPatternMS(48);h.add(L,x,x+L.duration,1);x+=L.duration;h.add(A,x,x+A.duration,1);x+=A.duration;h.add(C,x,x+C.duration,4);x+=C.duration;L=f.getPatternMS(48)-11E3;h.add(new Dunes(b),
L,f.getPatternMS(73.25),1);h.add(new PaintEffectDunes(b),L,f.getPatternMS(73.25),5);h.add(new FadeOutEffect(0,b),f.getPatternMS(23.5),f.getPatternMS(24),3);h.add(new FadeOutEffect(0,b),f.getPatternMS(39.5),f.getPatternMS(40),3);h.add(new FadeOutEffect(0,b),f.getPatternMS(72),f.getPatternMS(73.25),5);h.add(new PointerEffect(b,!1),f.getPatternMS(0),f.getPatternMS(8),1);h.add(new PointerEffect(b,!0),f.getPatternMS(8),f.getPatternMS(73.25),1);h.add(new RenderEffect(b),f.getPatternMS(0),f.getPatternMS(8),
6);h.add(new PaintEffectVideo(b),f.getPatternMS(8),f.getPatternMS(16)-3E3,6);h.add(new PaintEffectVideo(b),f.getPatternMS(24),f.getPatternMS(32)-3E3,6);h.add(new PaintEffectVideo(b),f.getPatternMS(40),f.getPatternMS(48)-11E3,6);this.getDomElement=function(){return e};this.show=function(){e.style.display="block";b.signals.keydown.add(c)};this.hide=function(){e.style.display="none";b.signals.keydown.remove(c);d()};this.resize=function(M,N){b.viewportWidth=b.baseWidth*(M/b.baseWidth);b.viewportHeight=
b.baseHeight*(M/b.baseWidth);m.setSize(b.viewportWidth,b.viewportHeight);n.width=b.viewportWidth;n.height=b.viewportHeight;delete n.__webglFramebuffer;m.domElement.style.left="0px";m.domElement.style.top=(N-b.viewportHeight)/2+"px"};this.update=function(){if(j)if(g.currentTime==g.duration){b.signals.showrelauncher.dispatch();d()}else h.update(g.currentTime*1E3)}};FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function d(){for(var z=u.getPoints(),I=0;I<z.length;I++){var B=z[I].getOriginPosition(),L=g.list[I],A=B.x;B=B.y;if(I==0){A-=113;B-=162}else if(I==1){A+=137;B-=46}else if(I==2){A+=106;B+=78}else if(I==3){A-=312;B+=75}else{A-=344;B-=46}L.style.left=A+"px";L.style.top=B+"px"}}function c(z,I,B,L,A){I=document.createElement(I);I.setAttribute("id",B);I.setAttribute("class",L);I.innerHTML=A;z.appendChild(I);return I}Section.call(this);var e=document.createElement("div");
e.style.width=window.innerWidth+"px";e.style.height=window.innerHeight+"px";e.style.display="none";e.style.backgroundColor="#ffffff";e.setAttribute("id","relauncher-section");var g={},f,j=document.createTextNode("#relauncher-section div.after-experience { position: absolute; height: 57px; overflow: hidden; cursor: pointer; } #relauncher-section div.after-experience img { display: block; } #relauncher-section div.after-experience:hover img { margin-top: -57px; }"),h=document.getElementsByTagName("head")[0],
m=document.createElement("style");m.type="text/css";if(m.styleSheet)m.styleSheet.cssText=j.nodeValue;else m.appendChild(j);h.appendChild(m);var n=new Clouds(b,!0);n.getDomElement().style.position="absolute";n.getDomElement().style.left="0px";n.getDomElement().style.top="0px";n.getDomElement().style.width=window.innerWidth+"px";n.getDomElement().style.height=window.innerHeight+"px";e.appendChild(n.getDomElement());j=document.createElement("div");j.setAttribute("id","container");j.setAttribute("style",
"position: absolute;");e.appendChild(j);var p=new GEE({fullscreen:!0,container:j,loop:!1}),t=p.ctx;f=document.createElement("div");f.style.position="absolute";f.style.width="100%";f.style.top=window.innerHeight-78+"px";f.style.left="0";new Footer(f);e.appendChild(f);var v=new WonderWall.Pentagon(p,p.width*0.5,p.height*0.5,80),u=new WonderWall.Pentagon(p,p.width*0.5,p.height*0.5,95),w=new WonderWall.Pentagon(p,p.width*0.5,p.height*0.5,130,0.25);w.showFill=!1;w.insides=!0;u.showFill=!1;w.setRadius(0.19);
v.setRadius(0.12);var x={svg:new Heart(p,"files/eminating-heart.svg",0,0),point:new WonderWall.Point(p,p.width*0.5,p.height*0.5+6)};x.point.r=0.0625;var D=D||{};D.color={red:"#f15d22",black:"#30302e",white:"#f4f4ea"};g=function(z){var I={},B=c(z,"div","start-over","after-experience","<img src = 'files/relaunch_section/start_over.png' alt = 'Start Over' />"),L=c(z,"div","technology","after-experience","<img src = 'files/relaunch_section/technology.png' alt = 'Technology' />"),A=c(z,"div","add-to-the-dream",
"after-experience","<img src = 'files/relaunch_section/add_dreams.png' alt = 'Add to the Dream' />"),C=c(z,"div","explore-other-dreams","after-experience","<img src = 'files/relaunch_section/explore_dreams.png' alt = 'Explore Other Dreams' />");z=c(z,"div","continue-to-explore","after-experience","<img src = 'files/relaunch_section/continue.png' alt = 'Continue To Explore' />");B.addEventListener("click",function(E){E.preventDefault();b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(0,1)},
!1);L.addEventListener("click",function(E){E.preventDefault();window.location="/tech"},!1);A.addEventListener("click",function(E){E.preventDefault();b.signals.showugc.dispatch()},!1);C.addEventListener("click",function(E){E.preventDefault();window.location="/gallery"},!1);z.addEventListener("click",function(E){E.preventDefault();b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes")},!1);I.start=B;I.technology=L;I.add=A;I.otherDreams=C;I.explore=z;I.list=[z,B,C,A,L];init=
!0;return I}(e);for(j=0;j<g.list.length;j++){h=g.list[j];h.addEventListener("mouseover",function(){var z=g.list.indexOf(this);v.setUpdatePoint(!0,z);u.setUpdatePoint(!0,z);w.setUpdatePoint(!0,z);x.point.updating=!0},!1);h.addEventListener("mouseout",function(){var z=g.list.indexOf(this);v.setUpdatePoint(!1,z);u.setUpdatePoint(!1,z);w.setUpdatePoint(!1,z);x.point.updating=!1},!1)}d();p.draw=function(){u.update();u.getPoints();t.clearRect(0,0,p.width,p.height);t.globalCompositeOperation="source-over";
t.strokeStyle=D.color.black;t.lineWidth=0.5;w.update().render();t.globalCompositeOperation="destination-out";v.update().render();t.globalCompositeOperation="xor";t.lineWidth=24;u.showStroke=!0;u.showFill=!1;u.render();t.globalCompositeOperation="source-over";t.save();t.translate(p.width/2,p.height/2);x.svg.render();t.restore()};this.show=function(){n.show();d();e.style.display="block"};this.resize=function(z,I){e.style.width=z+"px";e.style.height=I+"px";n.resize(z,I);f.style.top=window.innerHeight-
78+"px";d()};this.hide=function(){n.hide();e.style.display="none"};this.getDomElement=function(){return e};this.update=function(){n.update();p.draw()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){function d(){var x=window.innerWidth/b.baseWidth;b.viewportWidth=b.baseWidth*x;b.viewportHeight=b.baseHeight*x;f.setSize(b.viewportWidth,b.viewportHeight);j.width=b.viewportWidth;j.height=b.viewportHeight;delete j.__webglFramebuffer;f.domElement.style.left="0px";f.domElement.style.top=(window.innerHeight-b.viewportHeight)/2+"px"}Section.call(this);var c=document.createElement("div");c.style.display="none";var e=0,g=0,f=b.renderer,j=b.renderTarget,h,m,n,p,t,v;n=new ClearEffect(b);
n.init();p=new PaintEffect(b);p.init();t=new PaintEffectPrairie(b);t.init();v=new PaintEffectDunes(b);v.init();var u,w={};w.dunes=new DunesCameraFreeExplore(b);w.prairie=new PrairieCameraFreeExplore(b);w.city=new CityCameraFreeExplore(b);b.signals.startexploration.add(function(x){c.appendChild(f.domElement);h=b.worlds[x];u=w[x];u.resetCamera();m=x=="city"?p:x=="prairie"?t:v;d();e=g=(new Date).getTime()});b.signals.windowresized.add(d);this.getDomElement=function(){return c};this.show=function(){c.style.display=
"block"};this.hide=function(){c.style.display="none"};this.resize=function(){console.log("Exploration Resize")};this.update=function(){if(h){time=(new Date).getTime()-e;delta=time-g;g=time;delta=33;THREE.AnimationHandler.update(delta);u.updateCamera(0,delta,time);h.update(delta,u.camera,!0);n.update(0,delta,time);f.setClearColor(h.scene.fog.color);f.render(h.scene,u.camera,j);m.update(0,delta,time)}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){var d,c,e=document.createElement("div");e.style.display="none";this.getDomElement=function(){return e};this.load=function(){var g=signals.Signal;b.ugcSignals={};b.ugcSignals.object_createmode=new g;b.ugcSignals.object_erasemode=new g;b.ugcSignals.object_changecolor=new g;b.ugcSignals.submit=new g;d=new UgcObjectCreator(b);e.appendChild(d.getDomElement());c=new UgcUI(b);c.getDomElement().style.position="absolute";c.getDomElement().style.left="20px";c.getDomElement().style.top=
"50%";e.appendChild(c.getDomElement());c.addListeners();c.HANDLERS.updateCapacity(0)};this.show=function(){e.style.display="block";d.show()};this.hide=function(){e.style.display="none";d.hide()};this.resize=function(g,f){c.scale(g/1342);c.getDomElement().style.marginTop=-255*g/1342+"px";d.resize(g,f)};this.update=function(){d.update()}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b,d){function c(){if(!d){n.x=b.mouse.x/b.screenWidth*100-50;n.y=b.mouse.y/b.screenHeight*100-50;p=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}}function e(Z){for(var oa=0;oa<2;oa++){g=h[oa]=new Boid;g.position.x=320;g.position.y=20+Math.random()*10;g.position.z=200+Math.random();g.velocity.x=Math.random()*2-1;g.velocity.y=Math.random()*2-1;g.velocity.z=Math.random()*2-1;g.setAvoidWalls(!0);g.setWorldSize(1E3,200,400);m[oa]=new ROME.Animal(Z,!0);m[oa].timeOffset=
Math.random()*100;f=j[oa]=m[oa].mesh;f.phase=Math.floor(Math.random()*62.8);f.rotation.set(0,-0.5,0);f.updateMatrix();f.update();window.morphObject=m[oa];m[oa].play(m[oa].availableAnimals[0],m[oa].availableAnimals[0]);f.position=h[oa].position;f.doubleSided=!1;f.scale.x=f.scale.y=f.scale.z=0.03+0.05*Math.random();L.addChild(f)}A.position.z=-4E3;D.addObject(A);C.position.z=0;D.addObject(C);I.addObject(L)}var g,f,j=[],h=[],m=[],n={x:0,y:0},p={x:0,y:0,z:0},t,v,u=start_time=(new Date).getTime(),w,x,D,
z,I,B,L,A,C,E,M,N,K,ea,o;M=new THREE.Fog(4555956,-100,3E3);w=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);w.position.z=6E3;D=new THREE.Scene;I=new THREE.Scene;L=new THREE.Object3D;E=new THREE.Geometry;var ia=THREE.ImageUtils.loadTexture("files/cloud256.png",null,function(){N=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:ia},fogColor:{type:"c",value:M.color},fogNear:{type:"f",value:M.near},fogFar:{type:"f",value:M.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var Z=new THREE.Mesh(new THREE.Plane(64,64)),oa=0;oa<4E3;oa++){Z.position.x=
Math.random()*1E3-500;Z.position.y=d?-Math.random()*Math.random()*200+25:-Math.random()*Math.random()*200-15;Z.position.z=oa;Z.rotation.z=Math.random()*Math.PI;Z.scale.x=Z.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(E,Z)}A=new THREE.Mesh(E,N);C=new THREE.Mesh(E,N);(new THREE.JSONLoader).load({model:"./files/models/soup/birds_B_life.js",callback:e})});ia.magFilter=THREE.LinearMipMapLinearFilter;ia.minFilter=THREE.LinearMipMapLinearFilter;B=new THREE.WebGLRenderer({antialias:!1,
clearColor:0,clearAlpha:0});B.domElement.style.position="absolute";B.domElement.style.left="0px";B.domElement.style.top="0px";B.sortObjects=!1;B.autoClear=!1;ea=new THREE.WebGLRenderTarget(window.innerWidth/2,window.innerHeight/2,{minFilter:THREE.NearestFilter,magFilter:THREE.LinearFilter});o=new THREE.WebGLRenderTarget(window.innerWidth*2,window.innerHeight*2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});window.renderTargetClouds=ea;x=new THREE.Camera;x.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);z=new THREE.Scene;K=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:ea},tFlamingos:{type:"t",value:1,texture:o},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:M.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos *= 1./4.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.15*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
z.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),K));this.getDomElement=function(){return B.domElement};this.show=function(){b.signals.mousemoved.add(c)};this.hide=function(){b.signals.mousemoved.remove(c)};this.resize=function(Z,oa){w.aspect=Z/oa;w.updateProjectionMatrix();B.setSize(Z,oa);B.domElement.style.width=Z+"px";B.domElement.style.height=oa+"px"};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;v=(new Date).getTime();t=v-u;u=v;w.position.x+=
(n.x-w.target.position.x)*0.01;w.position.y+=(-n.y-w.target.position.y)*0.01;w.position.z=-position+4E3;L.position.z=w.position.z-500;L.position.y=-50;w.target.position.x=w.position.x;w.target.position.y=w.position.y;w.target.position.z=w.position.z-1E3;B.clear();B.render(D,w,ea,!0);B.render(I,w,o,!0);B.render(z,x);for(var Z=0,oa=j.length;Z<oa;Z++){g=h[Z];p.z=g.position.z;g.run(h);f=j[Z];f.rotation.y=Math.atan2(-g.velocity.z,g.velocity.x)+Math.PI/2;f.rotation.z=Math.asin(g.velocity.y/g.velocity.length());
f.phase=(f.phase+(Math.max(0,f.rotation.z)+0.1))%62.83;m[Z].update(t*f.phase/100)}}},Boid=function(){var b=new THREE.Vector3,d,c=500,e=500,g=200,f,j=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;d=new THREE.Vector3;this.setGoal=function(h){f=h};this.setAvoidWalls=function(h){j=h};this.setWorldSize=function(h,m,n){c=h;e=m;g=n};this.run=function(h){if(j){b.set(-c*15,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(c,this.position.y,this.position.z);
b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,0,this.position.z);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,e,this.position.z);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,this.position.y,-g);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,this.position.y,g);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b)}Math.random()>0.5&&this.flock(h);this.move()};this.flock=function(h){f&&d.addSelf(this.reach(f,
0.005));d.addSelf(this.alignment(h));d.addSelf(this.cohesion(h));d.addSelf(this.separation(h))};this.move=function(){this.velocity.addSelf(d);var h=this.velocity.length();h>1&&this.velocity.divideScalar(h/1);this.position.addSelf(this.velocity);d.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>e)this.position.y=-e;if(this.position.y<-e)this.position.y=e;if(this.position.z>g)this.position.z=-g;if(this.position.z<
-g)this.position.z=g};this.avoid=function(h){var m=new THREE.Vector3;m.copy(this.position);m.subSelf(h);m.multiplyScalar(1/this.position.distanceToSquared(h));return m};this.repulse=function(h){var m=this.position.distanceTo(h);if(m<150){var n=new THREE.Vector3;n.sub(this.position,h);n.multiplyScalar(0.5/m);d.addSelf(n)}};this.reach=function(h,m){var n=new THREE.Vector3;n.sub(h,this.position);n.multiplyScalar(m);return n};this.alignment=function(h){for(var m,n=new THREE.Vector3,p=0,t=0,v=h.length;t<
v;t++)if(!(Math.random()>0.6)){m=h[t];distance=m.position.distanceTo(this.position);if(distance>0&&distance<=3E3){n.addSelf(m.velocity);p++}}if(p>0){n.divideScalar(p);h=n.length();h>0.03&&n.divideScalar(h/0.03)}return n};this.cohesion=function(h){for(var m,n,p=new THREE.Vector3,t=new THREE.Vector3,v=0,u=0,w=h.length;u<w;u++)if(!(Math.random()>0.6)){m=h[u];n=m.position.distanceTo(this.position);if(n>0&&n<=3E3){p.addSelf(m.position);v++}}v>0&&p.divideScalar(v);t.sub(p,this.position);h=t.length();h>
0.03&&t.divideScalar(h/0.03);return t};this.separation=function(h){for(var m,n,p=new THREE.Vector3,t=new THREE.Vector3,v=0,u=h.length;v<u;v++)if(!(Math.random()>0.6)){m=h[v];n=m.position.distanceTo(this.position);if(n>0&&n<=3E3){t.sub(this.position,m.position);t.normalize();t.divideScalar(n);p.addSelf(t)}}return p}},UgcUI=function(b){var d=document.createElement("style");d.setAttribute("type","text/css");d.innerHTML="#ugcui g {\n  cursor: pointer;\n}\n#ugcui g.menu polygon.hitbox {\n  display: none;\n}\n#ugcui g.menu:hover polygon.hitbox {\n  display: inherit;\n}\n#ugcui g.folder polygon.folder-hitbox {\n  display: none;\n}\n#ugcui g.folder:hover polygon.folder-hitbox {\n  display: inherit;\n}\n#ugcui g.menu g.menu-buttons {\n  display: none;\n}\n#ugcui g.menu:hover g.menu-buttons {\n  display: block;\n}\n#ugcui g.active polygon.hex {\n  fill: #f65824;\n}\n#ugcui g#color g.options polygon.selected {\n  stroke: #fff;\n  stroke-width: 3.5;\n}\n#ugcui g#color g.options polygon#white.selected {\n  stroke: #000;\n}\n#ugcui g#color g.options polygon:not(.selected):hover {\n  stroke: #fff;\n  stroke-width: 3.5;\n}\n#ugcui g#color g.options polygon#white:not(.selected):hover {\n  stroke: #000;\n}\n#ugcui g.menu-buttons g:hover:not(.active) .hex {\n  fill: #fff;\n}\n#ugcui g.folder g.options {\n  display: none;\n}\n#ugcui g.folder:hover g.options {\n  display: block;\n}\n#ugcui g#size g g:hover polygon.bg {\n  fill: #fff;\n}\n#ugcui g#size:hover g g polygon.bg.active {\n  fill: #f65824;\n}\n#ugcui g#smoother g.options g:hover polygon.bg {\n  fill: #fff;\n}";
document.getElementsByTagName("head")[0].appendChild(d);var c=document.createElement("div");c.innerHTML='<svg id="ugcui" \n\t\tversion="1.1"\n     xmlns="http://www.w3.org/2000/svg"\n     xmlns:xlink="http://www.w3.org/1999/xlink"\n     xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n  \t width="1200px" \n  \t height="1200px"><g>\n<g class="menu">\n\n<polygon class="hex main" fill="#282828"\n         points="13.128,45.47 0.002,22.735 13.128,0 39.379,0 52.505,22.735 39.379,45.47 "></polygon>\n\n<polygon fill="#ED957A"\n         points="26.747,35.233 15.912,28.403 15.912,15.66 26.747,22.488 \t"></polygon>\n<polygon fill="#EA7B59"\n         points="37.583,15.66 26.747,22.49 26.747,35.233 37.583,28.405 \t"></polygon>\n<polygon fill="#F15C22"\n         points="15.912,15.66 26.75,22.49 37.583,15.66 26.75,9.119 \t"></polygon>\n\n<polygon opacity="0" class="hitbox" points="140.184,\n    72.916 126.007,48.362 98.374,48.362 84.558,24.432 56.924,24.432\n\t43.107,0.5 14.756,0.5 0.58,25.054 14.397,48.985 0.58,72.917 14.397,96.847 0.58,120.779 14.756,145.332 42.389,145.332\n\t56.206,169.263 84.556,169.263 98.373,145.332 126.007,145.332 140.184,120.778 126.366,96.847 "></polygon>\n\n<g class="menu-buttons">\n\n<g id="reflect" class="toggle">\n\n  <polygon class="hex" fill="rgba(255, 255, 255,\n      0.4)" points="13.128,\n      93.332 0.002,70.598 13.128,47.862 39.379,47.862 52.505,70.598\n39.379,93.332 "></polygon>\n\n\n  <rect x="16.502" y="58.113" fill="none" width="20.022" height="25.86"></rect>\n  <path fill="#30302E" d="M33.981,70.986c0,3.275-2.654,5.931-5.929,5.931v2.542c4.679,0,8.472-3.791,8.472-8.473\n\t\tc0-4.679-3.793-8.47-8.472-8.47v2.539C31.327,65.055,33.981,67.711,33.981,70.986"></path>\n  <path fill="#30302E" d="M19.047,71.023c0,3.277,2.653,5.934,5.928,5.934v2.539c-4.679,0-8.473-3.792-8.473-8.473\n\t\tc0-4.679,3.794-8.47,8.473-8.47v2.539C21.7,65.092,19.047,67.749,19.047,71.023"></path>\n  <rect x="26.256" y="58.113" fill="#30302E" width="0.409" height="25.86"></rect>\n</g>\n\n<g id="create" class="active">\n  <polygon class="hex" fill="rgba(255, 255, 255,\n      0.4)" points="54.578,\n      69.401 41.452,46.666 54.578,23.932 80.83,23.932 93.956,46.666\n\t80.829,69.401 "></polygon>\n\n  <polygon fill="#575759"\n           points="68.083,46.957 57.056,40.275 57.056,53.489 68.083,60.169 \t"></polygon>\n  <polyline fill="#3A3A3A"\n            points="68.083,46.957 79.109,40.275 79.109,53.489 68.083,60.169 \t"></polyline>\n  <polygon fill="#282828"\n           points="57.055,40.276 68.083,47.078 79.111,40.276 68.083,33.906 \t"></polygon>\n</g>\n\n<g id="erase">\n\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="96.028,\n  93.332 82.902,\n  70.598 96.028,47.862 122.279,47.862 135.406,70.597\n\t122.279,93.332 "></polygon>\n\n  <path d="M108.854,78.1l9.885-9.884c0.91-0.911,0.911-2.392,0-3.303l-5.394-5.393c-0.91-0.911-2.393-0.912-3.303-0.001l-9.885,9.884\n\t\tc-0.911,0.91-0.909,2.393,0.001,3.303l5.393,5.393C106.463,79.01,107.944,79.01,108.854,78.1z M101.053,70.298l4.929-4.929\n\t\tl6.906,6.905l-4.929,4.93c-0.417,0.417-1.096,0.418-1.513,0.001l-5.394-5.393C100.636,71.396,100.636,70.716,101.053,70.298z"></path>\n  <path d="M118.765,69.096l-0.894,0.894c0.417,0.417,0.416,1.095-0.001,1.513l-9.885,9.884c-0.417,0.417-1.095,0.418-1.512,0.001\n\t\tl-5.396-5.396c-0.416-0.416-0.415-1.094,0.003-1.512l-0.896-0.896c-0.91,0.911-0.91,2.392-0.001,3.301l5.396,5.396\n\t\tc0.91,0.91,2.392,0.911,3.302,0l9.884-9.884C119.676,71.487,119.675,70.006,118.765,69.096z"></path>\n</g>\n\n<g id="undo">\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n  117.263 41.452,\n  94.528 54.578,71.794 80.829,71.794 93.955,94.528\n\t80.829,117.263 "></polygon>\n\n  <path d="M66.275,85.886l-7.204,4.949l6.685,6.087l0.173-3.677c0,0,4.647-0.105,6.306,3.98c1.648,4.086,0.378,7.234,0.378,7.234\n\t\ts4.24-1.563,2.989-8.994c0,0-1.088-5.905-9.485-6.221L66.275,85.886z"></path>\n</g>\n\n<g class="folder" id="size">\n\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="126.366,\n144.709 140.184,120.778 126.007,96.225 97.656,96.225 83.48,120.779\n\t97.297,144.71 83.48,168.642 97.297,192.572 83.479,216.504 97.655,241.057 126.006,241.057 140.182,216.504 126.366,192.573\n\t140.183,168.642 "></polygon>\n\n  <g class="size" id="icon-size-small">\n    <g>\n      <polygon class="active bg" fill="rgba(255, 255, 255, 0.4)" points="96.028,\n  141.194 82.902,\n  118.46 96.028,95.725 122.279,95.725 135.406,118.459\n\t122.279,141.194 "></polygon>\n\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="98.111" y1="118.646" x2="114.651"\n            y2="128.775"></line>\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="103.624" y1="115.244" x2="120.165"\n            y2="125.374"></line>\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="114.651" y1="115.172" x2="98.11"\n            y2="125.375"></line>\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="120.165" y1="118.646" x2="103.624"\n            y2="128.776"></line>\n      <polygon fill="none" stroke="#3D3D3D" stroke-width="0.5"\n               stroke-miterlimit="10" points="92.598,121.974 109.138,132.25\n\t\t125.679,121.974 109.138,112.161 \t"></polygon>\n      <polygon fill="#575759"\n               points="109.138,118.646 103.624,115.171 103.624,108.687 109.138,112.161 \t"></polygon>\n      <polygon fill="#3A3A3A"\n               points="114.651,108.687 109.138,112.161 109.138,118.646 114.651,115.171 \t"></polygon>\n      <polygon fill="#282828"\n               points="103.624,108.687 109.139,112.161 114.651,108.687 109.139,105.358 \t"></polygon>\n    </g>\n  </g>\n\n  <g class="options">\n\n    <g class="size" id="icon-size-med">\n      <\!-- Hex --\>\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="96.028,189.057 82.902,166.323 96.028,143.588 122.28,143.588 135.405,166.323 122.279,189.057 "></polygon>\n\n      <\!-- Med icon --\>\n      <polygon fill="#E0E0E0"\n               points="98.111,169.571 103.625,173.047 109.138,169.571 103.625,166.243 \t"></polygon>\n      <polygon fill="#E0E0E0"\n               points="109.138,169.572 114.652,173.048 120.165,169.572 114.652,166.244 \t"></polygon>\n      <polygon fill="#E0E0E0"\n               points="103.624,172.974 109.139,176.448 114.651,172.974 109.139,169.646 \t"></polygon>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="98.111" y1="169.646" x2="114.651" y2="179.775"></line>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="103.624" y1="166.244" x2="120.165" y2="176.374"></line>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="114.651" y1="166.172" x2="98.11" y2="176.375"></line>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="120.165" y1="169.646" x2="103.624" y2="179.776"></line>\n      <polygon fill="none" stroke="#3D3D3D" stroke-width="0.5"\n               stroke-miterlimit="10" points="92.598,172.974 109.138,183.25\n\t\t125.679,172.974 109.138,163.161 \t"></polygon>\n      <polygon fill="#575759"\n               points="109.084,162.956 98.057,156.275 98.057,169.489 109.084,176.169 \t"></polygon>\n      <polyline fill="#3A3A3A"\n                points="109.084,162.956 120.109,156.275 120.109,169.489 109.084,176.169 \t"></polyline>\n      <polygon fill="#282828"\n               points="98.055,156.276 109.082,163.077 120.111,156.276 109.082,149.905 \t"></polygon>\n    </g>\n\n    <g class="size" id="icon-size-large">\n      <\!-- Hex --\>\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="96.027,236.919 82.901,214.186 96.027,191.451 122.279,191.451 135.404,214.186 122.278,236.919 "></polygon>\n      <\!-- Big icon --\>\n      <polygon fill="#575759"\n               points="108.709,215.198 91.668,204.448 91.668,224.007 108.709,234.359 \t"></polygon>\n      <polygon fill="#3A3A3A"\n               points="125.75,224.024 108.709,234.358 108.709,215.217 125.75,204.864 \t"></polygon>\n      <polygon fill="#282828"\n               points="125.75,204.864 108.584,215.198 91.668,204.448 108.709,195.198 \t"></polygon>\n    </g>\n\n  </g>\n\n</g>\n\n<g class="folder" id="smoother">\n\n  <\!--hex --\>\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n  165.125 41.452,\n  142.391 54.578,119.657 80.829,119.657 93.955,142.391\n\t80.829,165.125 "></polygon>\n\n  <\!--icon--\>\n  <polygon fill="#575759"\n           points="68.279,159.028 62.1,155.134 62.1,147.868 68.279,151.761 \t"></polygon>\n  <polygon fill="#3A3A3A"\n           points="74.458,147.868 68.279,151.762 68.279,159.028 74.458,155.135 \t"></polygon>\n  <polygon fill="#282828"\n           points="62.1,147.868 68.28,151.762 74.458,147.868 68.28,144.138 \t"></polygon>\n  <circle fill="#575759" cx="68.167" cy="134.167" r="5"></circle>\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="84.916,\n168.64 98.732,\n144.71 84.556,120.157 56.206,120.157 42.029,144.71\n\t55.847,168.641 42.029,192.573 55.846,216.503 42.029,240.435 56.206,264.988 84.556,264.988 98.732,240.435 84.916,216.503\n\t98.732,192.573 "></polygon>\n\n  <g class="options">\n\n    <g id="smoother-up">\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="54.578,212.988 41.452,190.254 54.578,167.519 80.829,167.519 93.955,190.254 80.829,212.988 "></polygon>\n    </g>\n\n    <g id="smoother-down">\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="54.578,260.85 41.452,238.116 54.578,215.381 80.829,215.381 93.955,238.116 80.829,260.85 "></polygon>\n    </g>\n  </g>\n\n</g>\n\n<g class="folder" id="color">\n\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="13.128,\n  141.194 0.002,\n  118.46 13.128,95.725 39.379,95.725 52.505,118.46\n\t39.379,141.194 "></polygon>\n\n  <\!-- Paint Bucket --\>\n  <path d="M36.365,110.268c0-1.864-4.349-3.374-9.715-3.374c-5.369,0-9.718,1.511-9.718,3.371c0,0.145,0.035,0.287,0.087,0.427\n\t\tv16.067l0.327,0.196c0.153,0.092,3.805,2.25,9.184,2.25c5.368,0,9.243-2.148,9.405-2.24l0.343-0.193v-16.079\n\t\tC36.331,110.555,36.365,110.413,36.365,110.268z M26.65,108.149c4.15,0,7.517,1.067,7.517,2.382c0,1.315-3.366,2.387-7.517,2.387\n\t\tc-4.155,0-7.518-1.072-7.518-2.387C19.132,109.216,22.495,108.149,26.65,108.149z M26.53,127.859c-4.109,0-7.188-1.383-8.164-1.881\n\t\tV112.01c0.157,0.088,0.321,0.175,0.499,0.257v0.206c0,0,1.344,0.289,1.405,1.64c0.054,1.345-0.235,3.629,0.762,3.629\n\t\tc0.991,0,0.521-3.629,0.521-3.629s0.614-0.529,2.051,0c1.116,0.412,2.811,0.999,3.046,2.28c-0.059,1.53,0,2.813,0,2.813\n\t\ts0.032,1.114,0.495,1.114c0.464,0,0.554,0.062,0.732-0.406c0.175-0.468,0.35-4.159,0.35-4.159s-0.021-0.681,0.354-1.053\n\t\tc0.375-0.379,1.149-0.443,1.112,0.643c-0.059,1.582,0,5.558,0,5.558s-0.233,1.055,0.645,1.118c0.878,0.054,0.762-1.29,0.762-1.29\n\t\tl0.004-5.208c0,0-0.29-1.503,3.827-3.015v13.458C33.901,126.466,30.655,127.859,26.53,127.859z"></path>\n\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="140.182,\n        216.504 126.007,\n191.951 98.373,191.951 84.557,168.019 56.923,168.019\n\t43.466,144.709 57.283,120.779 43.107,96.225 14.756,96.225 0.58,120.779 14.396,144.709 0.579,168.642 14.396,192.572\n\t0.579,216.505 14.396,240.435 0.578,264.368 14.395,288.298 0.578,312.232 14.754,336.784 43.104,336.784 56.924,312.85\n\t84.557,312.85 98.373,288.919 126.006,288.919 140.182,264.367 126.365,240.434 "></polygon>\n  <g class="options">\n    <polygon fill="#80C5D8"\n             points="54.578,212.988 41.452,190.254 54.578,167.519 80.829,167.519 93.955,190.254 80.829,212.988 \t"></polygon>\n\n    <polygon fill="#2EA8CE" points="96.027,236.919 82.901,214.186 96.027,191.451 122.279,191.451 135.404,214.186 122.278,236.919\n\t\t"></polygon>\n\n    <polygon fill="#3F2249" points="96.027,284.782 82.901,262.048 96.027,239.313 122.279,239.313 135.404,262.048 122.278,284.782\n\t\t"></polygon>\n\n    <polygon fill="#EF7B1B"\n             points="54.578,260.85 41.452,238.116 54.578,215.381 80.829,215.381 93.955,238.116 80.829,260.85 \t"></polygon>\n\n    <polygon fill="#FF066C"\n             points="54.578,308.713 41.452,285.979 54.578,263.244 80.829,263.244 93.954,285.979 80.829,308.713 \t"></polygon>\n\n    <polygon fill="#FFF200"\n             points="13.126,332.646 0,309.913 13.126,287.176 39.377,287.176 52.503,309.913 39.377,332.646 \t"></polygon>\n\n    <polygon id="white" class="selected" fill="#FFFFFF"\n             points="13.127,189.057 0.001,166.323 13.127,143.588 39.379,143.588 52.504,166.323 39.378,189.057 \t"></polygon>\n\n    <polygon fill="#DBCE9A"\n             points="13.127,236.92 0.001,214.186 13.127,191.451 39.378,191.451 52.504,214.186 39.378,236.92 \t"></polygon>\n\n    <polygon fill="#458C65"\n             points="13.126,284.783 0,262.049 13.126,239.313 39.378,239.313 52.503,262.049 39.377,284.783 \t"></polygon>\n  </g>\n</g>\n\n</g>\n\n</g>\n\n\n<g class="menu">\n  <polygon fill="#282828" points="13.128,508.477 0.002,485.742 13.128,\n  463.007 39.379,463.007 52.505,485.742\n  39.379,508.477 "></polygon>\n  <polygon opacity="0" class="hitbox" fill="#FFFFFF" stroke="#000000"\n           points="98.732,\n    464.13 84.556,\n  439.577 56.924,439.577 43.106,415.645 14.756,415.645\n  0.58,440.199 14.396,464.129 0.58,488.061 14.756,512.614 42.388,512.614 56.206,536.545 84.556,536.545 98.732,511.993\n  84.916,488.061 "></polygon>\n\n  <g class="menu-buttons">\n\n    <g class="active" id="life">\n\n      <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n    484.546 41.452,461.812 54.578,439.076 80.829,439.076 93.955,461.812\n  80.829,484.546 "></polygon>\n\n    </g>\n\n    <g id="dark">\n\n      <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n    532.408 41.452,509.674 54.578,486.938 80.829,486.938 93.955,509.674\n  80.829,532.408 "></polygon>\n\n    </g>\n\n    <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="13.128,\n    460.614 0.002,\n    437.88 13.128,415.145 39.379,415.145 52.505,437.88\n  39.379,460.614 "></polygon>\n\n\n    <text id="capacity" x="27" y="438" text-anchor="middle"\n          font-family="Gotham Bold"\n          font-size="11" dominant-baseline="middle"\n          fill="#000">\n    </text>\n  </g>\n</g>\n</g>\n\n</svg>';
var e={updateCapacity:function(j){document.getElementById("capacity").textContent=Math.round(j*100)+"%"},oncreatemode:function(){},onerasemode:function(){},onreflectmode:function(){},onundo:function(){alert("saved");b.ugcSignals.submit.dispatch()},oncolorchange:function(j){b.ugcSignals.object_changecolor.dispatch(j)},onsmoothup:function(){},onsmoothdown:function(){},onsize:function(){},onlife:function(){},ondark:function(){}};this.__defineGetter__("HANDLERS",function(){return e});var g=function(j,
h){(typeof j=="string"?document.getElementById(j):j).addEventListener("mouseup",h,!1)},f=function(j){return document.getElementById(j).getElementsByClassName("bg")[0]};this.addListeners=function(){g("create",function(){this.setAttribute("class","active");document.getElementById("erase").setAttribute("class","");e.oncreatemode()});g("erase",function(){this.setAttribute("class","active");document.getElementById("create").setAttribute("class","");e.onerasemode()});g("life",function(){this.setAttribute("class",
"active");document.getElementById("dark").setAttribute("class","");e.onlife()});g("dark",function(){this.setAttribute("class","active");document.getElementById("life").setAttribute("class","");e.ondark()});g("reflect",function(){if(this.getAttribute("class")=="toggle"){this.setAttribute("class","toggle active");console.log(this);e.onreflectmode(!0)}else{this.setAttribute("class","toggle");e.onreflectmode(!1)}});g("undo",e.onundo);for(var j=document.getElementById("color").getElementsByClassName("options")[0].getElementsByTagName("polygon"),
h=0;h<j.length;h++)g(j[h],function(){for(var n=parseInt(this.getAttribute("fill").substr(1),16),p=0;p<j.length;p++)j[p].setAttribute("class","");this.setAttribute("class","selected");e.oncolorchange(n)});g("smoother-up",e.onsmoothup);g("smoother-down",e.onsmoothdown);var m=function(){f("icon-size-small").setAttribute("class","bg");f("icon-size-med").setAttribute("class","bg");f("icon-size-large").setAttribute("class","bg")};g("icon-size-small",function(){m();f("icon-size-small").setAttribute("class",
"active bg");e.onsize(0)});g("icon-size-med",function(){m();f("icon-size-med").setAttribute("class","active bg");e.onsize(1)});g("icon-size-large",function(){m();f("icon-size-large").setAttribute("class","active bg");e.onsize(2)})};this.scale=function(j){c.firstChild.firstChild.setAttribute("transform","scale("+j+")")};this.getDomElement=function(){return c}},UgcObjectCreator=function(b){function d(){M.setMode(!u?VoxelPainter.MODE_CREATE:VoxelPainter.MODE_ERASE);h()}function c(){M.setMode(VoxelPainter.MODE_IDLE);
h()}function e(){p?M.moveMouse(b.mouse.x/b.viewportWidth,(b.mouse.y-C)/b.viewportHeight):M.moveMouse(b.mouse.x/b.screenWidth,b.mouse.y/b.screenHeight);h()}function g(K){x-=K.wheelDeltaY;h()}function f(K){switch(K.keyCode){case 16:w=!0;break;case 17:u=!0}}function j(K){switch(K.keyCode){case 16:w=!1;break;case 17:u=!1}}function h(){if(w){D+=b.mouse.x/b.screenWidth*2-1;z-=b.mouse.y/b.screenHeight*2-1;z=z>90?90:z<0?0:z}v.position.x=x*Math.sin(D*t)*Math.cos(z*t);v.position.y=x*Math.sin(z*t);v.position.z=
x*Math.cos(D*t)*Math.cos(z*t);M.update();b.renderer.clear();if(p){b.renderer.render(m.scene,v,b.renderTarget,!0);b.renderer.render(M.getScene(),v,b.renderTarget);E.update(0,0,0)}else{b.renderer.render(m.scene,v);b.renderer.render(M.getScene(),v)}}var m=this,n=document.createElement("div"),p=!0,t=Math.PI/180,v,u=!1,w=!1,x=1500,D=45,z=15;v=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,2E4);v.target.position.y=200;m.scene=new THREE.Scene;m.scene.fog=new THREE.FogExp2(16777215,1.75E-4);m.scene.fog.color.setHSV(0.576,
0.382,0.9);var I=new THREE.AmbientLight(2232576),B=new THREE.DirectionalLight(16772829),L=new THREE.DirectionalLight(16772829);I.color.setHSV(0,0,0.1);B.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);B.color.setHSV(0.08823529411764706,0,1);L.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);L.color.setHSV(0,0,0.8647058823529412);m.scene.addLight(I);m.scene.addLight(B);m.scene.addLight(L);m.lensFlare=null;m.lensFlareRotate=null;I=new THREE.Vector3(0,
0,-7500);initLensFlares(m,I,60,292);(new THREE.SceneLoader).load("files/models/dunes/D_tile_1.js",function(K){for(var ea=0,o=K.scene.objects.length;ea<o;ea++){var ia=K.scene.objects[ea];if(ia.visible){ia.rotation.x=-90*Math.PI/180;ia.position.y=-100;ia.position.x=1750;ia.scale.x=ia.scale.y=ia.scale.z=0.5;m.scene.addObject(ia)}}h()});if(!b.renderer){var A=new THREE.WebGLRenderer;A.domElement.style.position="absolute";A.setSize(window.innerWidth,window.innerHeight);A.setClearColor(m.scene.fog.color);
A.sortObjects=!1;A.autoClear=!1;b.renderer=A}if(p){var C=0;b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.baseHeight);if(!b.renderTarget){I=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);I.minFilter=THREE.LinearFilter;I.magFilter=THREE.LinearFilter;b.renderTarget=I}var E=new PaintEffectDunes(b);E.init()}var M=new VoxelPainter(v),N=new UgcHandler;
b.ugcSignals.object_changecolor.add(function(K){M.setColor(K)});b.ugcSignals.submit.add(function(){var K=A.domElement.toDataURL("image/png");N.submitUGO("this is a test","test@tes.com",1,M.getObject().getJSON(),K,function(ea){console.log(ea)})});this.getDomElement=function(){return n};this.show=function(){b.signals.mousedown.add(d);b.signals.mouseup.add(c);b.signals.mousemoved.add(e);b.signals.mousewheel.add(g);b.signals.keydown.add(f);b.signals.keyup.add(j);n.appendChild(b.renderer.domElement);b.renderer.setClearColor(m.scene.fog.color)};
this.hide=function(){b.signals.mousedown.remove(d);b.signals.mouseup.remove(c);b.signals.mousemoved.remove(e);b.signals.mousewheel.remove(g);b.signals.keydown.remove(f);b.signals.keyup.remove(j)};this.resize=function(K,ea){if(p){v.aspect=b.viewportWidth/b.viewportHeight;v.updateProjectionMatrix();b.viewportWidth=b.baseWidth*(K/b.baseWidth);b.viewportHeight=b.baseHeight*(K/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.viewportHeight);b.renderTarget.width=b.viewportWidth;b.renderTarget.height=b.viewportHeight;
delete b.renderTarget.__webglFramebuffer;C=(ea-b.viewportHeight)/2;b.renderer.domElement.style.left="0px";b.renderer.domElement.style.top=C+"px"}else{v.aspect=K/ea;v.updateProjectionMatrix();b.renderer.setSize(K,ea)}};this.update=function(){}},UgcSoupCreator=function(){var b;domElement=document.createElement("div");b=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);b.position.z=6E3;this.getDomElement=function(){return(void 0).domElement};this.show=function(){};this.hide=function(){};
this.resize=function(d,c){b.aspect=d/c;b.updateProjectionMatrix();(void 0).setSize(d,c)};this.update=function(){(void 0).clear();(void 0).render(void 0,b)}},VoxelPainter=function(b){function d(E){return Math.round(E/e)}function c(E){var M=d(E.x),N=d(E.y);E=d(E.z);if(!j.checkVoxel(M,N,E)){j.addVoxel(M,N,E,g);var K=new THREE.Mesh(x,new THREE.MeshLambertMaterial({color:g}));K.position.x=M*e;K.position.y=N*e;K.position.z=E*e;K.matrixAutoUpdate=!1;K.updateMatrix();K.update();L.addObject(K)}}var e=50,g=
16777215,f=VoxelPainter.MODE_IDLE,j=new UgcObject,h,m,n=new THREE.Scene,p=new THREE.AmbientLight(2232576),t=new THREE.DirectionalLight(16772829),v=new THREE.DirectionalLight(16772829);p.color.setHSV(0,0,0.1);t.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);t.color.setHSV(0.08823529411764706,0,1);v.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);v.color.setHSV(0,0,0.8647058823529412);n.addLight(p);n.addLight(t);n.addLight(v);var u=new THREE.Scene;n.addObject(u);
var w=new THREE.Object3D;w.visible=!1;var x=new THREE.Plane(2E3,2E3,16,16);p=new THREE.MeshBasicMaterial({color:0,opacity:0.2,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(x,p);_plane.doubleSided=!0;_plane.visible=w.visible;w.addChild(_plane);_plane=new THREE.Mesh(x,p);_plane.rotation.y=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=w.visible;w.addChild(_plane);w.matrixAutoUpdate=!1;u.addObject(w);var D,z,I,B;D=new THREE.Projector;z=new THREE.Vector3(0,0,0.5);B=new THREE.Ray(b.position,
null);var L=new THREE.Scene;n.addObject(L);var A=new THREE.Mesh(new THREE.Plane(2E3,2E3,40,40),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparency:!0,wireframe:!0}));A.position.x=-25;A.position.y=-25;A.position.z=-25;A.rotation.x=-90*Math.PI/180;L.addObject(A);x=new THREE.Cube(e,e,e);var C=new THREE.Mesh(x,new THREE.MeshLambertMaterial({color:g,opacity:0,transparent:!0}));C.matrixAutoUpdate=!1;n.addObject(C);c(new THREE.Vector3);this.setColor=function(E){g=E;C.materials[0].color.setHex(g)};
this.setMode=function(E){f=E};this.moveMouse=function(E,M){z.x=E*2-1;z.y=-M*2+1;I=D.unprojectVector(z.clone(),b);B.direction=I.subSelf(b.position).normalize()};this.update=function(){var E;switch(f){case VoxelPainter.MODE_IDLE:E=B.intersectScene(L);if(E.length>0){m=E[0].object;h=E[0].face;C.materials[0].opacity=0.5;w.position.copy(m.matrixRotationWorld.multiplyVector3(h.centroid.clone()).addSelf(m.position));w.position.addSelf(m.matrixRotationWorld.multiplyVector3(h.normal.clone()));w.updateMatrix();
w.update();C.position.copy(w.position);C.position.x=d(C.position.x)*e;C.position.y=d(C.position.y)*e;C.position.z=d(C.position.z)*e;C.updateMatrix();C.update()}else{C.materials[0].opacity=0;h=m=null}break;case VoxelPainter.MODE_CREATE:C.materials[0].opacity=0;E=B.intersectScene(u);if(h&&E.length>0){var M=E[0].point;E=m.matrixRotationWorld.multiplyVector3(h.centroid.clone()).addSelf(m.position);M=E.distanceTo(M);E=E.addSelf(m.matrixRotationWorld.multiplyVector3(h.normal.clone()).multiplyScalar(M));
c(E)}break;case VoxelPainter.MODE_ERASE:E=B.intersectScene(L);if(E.length>0&&E[0].object!=A){E=E[0].object;M=d(E.position.x);var N=d(E.position.y),K=d(E.position.z);j.removeVoxel(M,N,K);L.removeObject(E);n.removeObject(E)}}};this.getScene=function(){return n};this.getObject=function(){return j}};VoxelPainter.MODE_IDLE="VoxelPainter.MODE_IDLE";VoxelPainter.MODE_CREATE="VoxelPainter.MODE_CREATE";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var emiBuyButtonUrl="http://widgets.platform.emi.com/widget/1.0/",emiBuyButtonUuids=["c9e456919b824bdeb2e3a326b122db43"],gaJsHost="https:"==document.location.protocol?"https://ssl.":"http://www.";document.write(unescape("%3Cscript src='"+gaJsHost+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));document.writeln(unescape("%3Cscript src='"+emiBuyButtonUrl+"js/emi_buy_button.js' type='text/javascript'%3E%3C/script%3E"));
function Footer(b,d){var c=d||"files/footer";this.id=Footer.multipleInstances;var e="rome_footer_buy_album-"+this.id;this.getDomElement=function(){return b};window.addEventListener("load",function(){EMIBuyButton&&(new EMIBuyButton({buttonID:"c9e456919b824bdeb2e3a326b122db43",buttonImageUrl:c+"/buy_button-trans.png",useVendorImages:!0})).replaceDiv(e);return this},!1);var g="";g+='<div class = "rome-footer">';g+='<div class = "shout-out">';g+="  <ul>";g+='    <li><a href = "http://chromeexperiments.com/"><img src = "'+
c+'/chrome-trans.png" alt = "This is a Chrome Experiment" border = "0" /></a></li>';g+='    <li class = "divider">&nbsp;</li>';g+='    <li><a href = "http://google.com/"><img src = "'+c+'/google-trans.png" alt = "Made With Friends From Google" border = "0" /></a></li>';g+='    <li class = "clear">&nbsp;</li>';g+="  </ul>";g+="</div>";g+="";g+='<div class = "navigation">';g+='  <ul class = "primary">';g+='    <li class = "first"><a href = "http://ro.me/tech">Technology</a></li>';g+='    <li><a href = "http://ro.me/credits">Credits</a></li>';
g+='    <li><a href = "http://ro.me/album">Rome Album</a></li>';g+='    <li id = "'+e+'" class = "rome_footer_buy_album">';g+="    </li>";g+='    <li class = "last">Share</li>';g+='    <li class = "last icons"><a href="http://www.facebook.com/sharer.php?u=http://ro.me" target="_blank"><img src = "'+c+'/fb-trans.png" alt = "facebook" border = "0"  /></a></li>';g+='    <li class = "last icons"><a href="http://twitter.com/share?text=\u201cROME\u201d&amp;url=http://ro.me" target="_blank"><img src = "'+
c+'/twitter-trans.png" alt = "twitter" border = "0" /></a></li>';g+='    <li class = "clear last">&nbsp;</li>';g+="  </ul>";g+='  <ul class = "secondary">';g+='    <li class = "first"><a href = "http://ro.me/terms">Terms</a></li>';g+='    <li class = "last"><a href = "http://ro.me/privacy">Privacy</a></li>';g+='    <li class = "clear last">&nbsp;</li>';g+="  </ul>";g+="</div>";g+='<div class = "clear">&nbsp;</div>';g+="</div>";g+="</div>";var f="";f+=".rome-footer * {";f+="  margin: 0;";f+="  padding: 0;";
f+="}";f+=".rome-footer {";f+='  font: 500 10px/18px "Futura", Arial, sans-serif;';f+="  color: #434343;";f+="  text-transform: uppercase;";f+="  letter-spacing: 1px;";f+="}";f+=".rome-footer .shout-out {";f+="  float: left;";f+="  margin: 0 0 0 18px;";f+="}";f+=".rome-footer .navigation {";f+="  float: right;";f+="  margin: 20px 26px 0 0;";f+="  vertical-align: middle;";f+="}";f+=".rome-footer ul li {";f+="  height: 16px;";f+="  border-right: 1px solid #a0a0a0;";f+="  padding: 0 10px 0 10px;";f+=
"  width: auto;";f+="  float: left;";f+="  list-style: none;";f+="}";f+=".rome-footer ul li.last,";f+=".rome-footer ul li.last li {";f+="  border: none;";f+="  padding: 0 0 0 10px;";f+="}";f+=".rome-footer .shout-out ul li {";f+="  margin: 0;";f+="  border: 0;";f+="}";f+=".rome-footer .shout-out li.divider {";f+="  margin: 15px 0 15px 15px;";f+="  height: 24px;";f+="  border-left: 1px solid #a0a0a0;";f+="}";f+=".rome-footer a img {";f+="  border: 0;";f+="}";f+=".rome-footer .secondary a:link, .rome-footer .secondary a:visited {";
f+="  color: #777;";f+="}";f+=".rome-footer a:link, .rome-footer a:visited,";f+=".rome-footer .secondary a:hover, .rome-footer .secondary a:active {";f+="  color: #434343;";f+="  text-decoration: none;";f+="}";f+=".rome-footer a:hover, .rome-footer a:active {";f+="  color: #000;";f+="}";f+=".emi_buy_button_link {";f+="  margin-top: 2px;";f+="  height: 8px;";f+="  line-height: 8px;";f+="  overflow: hidden;";f+="}";f+=".rome-footer .rome_footer_buy_album img {";f+="  display: block;";f+="  margin-top: 0;";
f+="}";f+=".rome-footer .rome_footer_buy_album a:hover img {";f+="  margin-top: -8px;";f+="}";f+=".emi_vendor_menu.using_image a:hover img {";f+="  margin-top: 0;";f+="}";f+=".emi_vendor_menu.using_image {";f+="  margin-top: -145px;";f+="  margin-left: -11px;";f+="  padding: 10px;";f+="}";f+=".emi_vendor_menu.using_image * {";f+="  text-transform: none;";f+="}";f+=".emi_vendor_menu.using_image .emi_vendor_link {";f+="  margin-top: 5px;";f+="}";f+=".rome-footer .secondary {";f+="  margin: 10px 0 0 0;";
f+="  float: right;";f+="}";f+=".clear {";f+="  clear: both;";f+="  display: block;";f+="  overflow: hidden;";f+="  visibility: hidden;";f+="  width: 0;";f+="  height: 0;";f+="}";b.innerHTML=g;if(Footer.multipleInstances<1){g=document.createTextNode(f);f=document.getElementsByTagName("head")[0];var j=document.createElement("style");if(j.stylesheet)j.styleSheet.cssText=g.nodeValue;else j.appendChild(g);f.appendChild(j)}Footer.multipleInstances++}Footer.multipleInstances=0;
var Shortcuts=function(b){function d(){var j=document.createElement("span");j.innerHTML=" ";f.appendChild(j)}function c(j,h){var m=document.createElement("span");m.style.cursor="pointer";m.style.padding="0.5em";m.style.marginRight="4px";m.style.background="rgba(255,255,255,0.15)";m.innerHTML=j;m.addEventListener("click",h,!1);f.appendChild(m)}function e(j,h){c(j,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(h,1)})}function g(j,h){c(j,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(h)})}var f=document.createElement("div");f.style.position="absolute";f.style.left="0px";f.style.top="0px";f.style.padding="0.5em";f.style.fontSize="10px";(function(j){c(j,function(){b.signals.showlauncher.dispatch()})})("Launcher");d();e("Intro",0);d();e("Transition to City",8);e("City",16);d();e("Transition to Prairie",24);e("Prairie",32);d();e("Transition to Dunes",40);e("Dunes",48);d();(function(j){c(j,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
d();g("Explore City","city");g("Explore Prairie","prairie");g("Explore Dunes","dunes");d();(function(j){c(j,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return f}};
(function(){function b(x){h&&h.hide();if(!x.__loaded){x.load();x.__loaded=!0}x.resize(window.innerWidth,window.innerHeight);x.show();h=x}function d(x){if(!x.gamma&&!x.beta){x.gamma=-(x.x*(180/Math.PI));x.beta=-(x.y*(180/Math.PI))}else if(x.alpha==null&&x.beta==null&&x.gamma==null){window.removeEventListener("deviceorientation",d,!1);window.removeEventListener("MozOrientation",d,!1)}var D=Math.abs(x.gamma)>4||Math.abs(x.beta)>4,z=D?x.gamma:0;D=D?x.beta:0;if(w!=z||u!=D){var I=Math.round(1.5*z)+f.mouse.x,
B=-Math.round(1.5*D)+f.mouse.y;Math.abs(I)>window.innerWidth&&(I=I<0?-window.innerWidth:window.innerWidth);Math.abs(B)>window.innerHeight&&(B=B<0?-window.innerHeight:window.innerHeight);f.mouse.x=I;f.mouse.y=B;w=z;u=D;f.signals.mousemoved.dispatch(x)}}function c(){requestAnimationFrame(c);e.clear();h.update();g.update()}var e,g,f,j=signals.Signal,h,m,n,p,t,v,u=0,w=0;e=new Logger;e.domElement.style.position="fixed";e.domElement.style.right="100px";e.domElement.style.top="0px";document.body.appendChild(e.domElement);
g=new Stats;g.domElement.style.position="fixed";g.domElement.style.right="0px";g.domElement.style.top="0px";document.body.appendChild(g.domElement);f={logger:e,mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,signals:{mousedown:new j,mouseup:new j,mousemoved:new j,mousewheel:new j,keydown:new j,keyup:new j,windowresized:new j,load:new j,showlauncher:new j,showfilm:new j,showrelauncher:new j,showexploration:new j,showugc:new j,loadBegin:new j,loadItemAdded:new j,loadItemCompleted:new j,
startfilm:new j,stopfilm:new j,startexploration:new j,initscenes:new j},worlds:{},sequences:{},started:{city:!1,prairie:!1,dunes:!1}};m=new LauncherSection(f);document.body.appendChild(m.getDomElement());p=new RelauncherSection(f);document.body.appendChild(p.getDomElement());v=new UgcSection(f);document.body.appendChild(v.getDomElement());j=new Shortcuts(f);document.body.appendChild(j.getDomElement());f.signals.load.add(function(){f.signals.loadBegin.dispatch();n=new FilmSection(f);document.body.appendChild(n.getDomElement());
t=new ExplorationSection(f);document.body.appendChild(t.getDomElement());f.signals.showfilm.add(function(){b(n)});f.signals.showexploration.add(function(){b(t)})});f.signals.showlauncher.add(function(){b(m)});f.signals.showrelauncher.add(function(){b(p)});f.signals.showugc.add(function(){b(v)});document.addEventListener("mousedown",function(x){f.signals.mousedown.dispatch(x);x.preventDefault();x.stopPropagation()},!1);document.addEventListener("mouseup",function(x){f.signals.mouseup.dispatch(x);x.preventDefault();
x.stopPropagation()},!1);document.addEventListener("mousemove",function(x){f.mouse.x=x.clientX;f.mouse.y=x.clientY;f.signals.mousemoved.dispatch(x)},!1);document.addEventListener("mousewheel",function(x){f.signals.mousewheel.dispatch(x)},!1);document.addEventListener("keydown",function(x){f.signals.keydown.dispatch(x)},!1);document.addEventListener("keyup",function(x){f.signals.keyup.dispatch(x)},!1);window.addEventListener("deviceorientation",d,!1);window.addEventListener("MozOrientation",d,!1);
window.addEventListener("resize",function(){h.resize(window.innerWidth,window.innerHeight);f.screenWidth=window.innerWidth;f.screenHeight=window.innerHeight;f.signals.windowresized.dispatch()},!1);b(m);c()})();
