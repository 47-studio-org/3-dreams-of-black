function HandleErrors(b){function e(f){return navigator.userAgent.match(f)}var c=this,d=b||"/alternate";Trailer="<ul id = 'trailer'><li class = 'first'><a href = '#'>Watch Trailer</a></li><li><a href = 'http://ro.me/album'>Rome Album</a></li><li class = 'last'><a href = 'http://ro.me/tech'>The Technology</a></li><li class = 'clear'></li></ul>";this.MagicVariable="case";this.Errors=["<p>We are very sorry, but &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears that your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards. Although you are unable to participate in the full experience today, we expect this website to be up for a while, so please check back if you&#39;re on a different computer. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site and learn more about WebGL technology.</p>"+
Trailer,"<p>Apologies for the tech trouble. &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards. Although you are unable to participate in the full experience today, we expect this website to be up for a while, so please check back if you&#39;re on a different computer. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site and learn more about WebGL technology.<p>"+
Trailer,"<p>We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again. If you are unable to install a new web browser, you can try downloading the <a href = 'http://www.google.com/chromeframe'>Google Chrome Frame plugin</a> instead.</p>","<p>We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again.</p>",
"<p>We are sorry, but it appears that your browser does not support WebGL. &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. Please try launching this site again on a computer with up-to-date graphics drivers. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site, and learn more about WebGL technology.</p>"+Trailer,"<p>We&#39;re sorry, but &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. As a result, it may not work perfectly in your current browser. For the best viewing experience, you can <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and launch this site again, or go ahead and <a id = 'escape-from-warning' href = '#'>try it anyway</a>.</p>"];
this.getUrlVars=function(){for(var f=null,h=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<h.length;g++){var n=h[g].split("=");if(n.length==2){var m=n[0];n=n[1];if(m&&n){f==null&&(f={});f[m]=n}}}return f};this.checkForErrors=function(){var f;try{f=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(h){f=!1}f={webgl:f,conditions:[e(/[cC]hrome/),e(/[Ff]ire[Ff]ox\/[4-9]/),e(/MSIE [789]/)&&e(/[Ww]indows [Nn][Tt] [6789]\./),
e(/[Ss]afari/)&&e(/[Mm]ac [Oo][Ss] [Xx] 10\_[6789]/),e(/i[Pp]hone/)||e(/i[Pp]ad/)||e(/[Aa]ndroid/)],message:""};if(f.webgl){if(f=f.conditions[1]){var g;try{g="localStorage"in window&&window.localStorage!==null}catch(n){g=!1}f=g&&!localStorage.RomeError}if(f){window.addEventListener("load",function(){var m=document.getElementById("ui-container");if(m)m.style.display="none";var o=document.createElement("div"),t=document.createElement("div");m=document.createElement("div");m.setAttribute("id","rome-error");
var u=document.createElement("style");u.innerHTML="a { color: #fff; }";document.getElementsByTagName("head")[0].appendChild(u);o.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");t.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");m.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; font: color: #fff; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");
m.innerHTML=c.Errors[5];var w=function(){t.style.left=(window.innerWidth-400)/2+"px";t.style.top=window.innerHeight/2+"px"},v=function(){document.body.removeChild(o);document.body.removeChild(t);window.removeEventListener("resize",w,!1);LauncherSection.showUI()};o.addEventListener("click",function(){v()},!1);window.addEventListener("resize",w,!1);t.appendChild(m);document.body.appendChild(o);document.body.appendChild(t);document.getElementById("escape-from-warning").addEventListener("click",function(x){x.preventDefault();
v()},!1)},!1);HandleErrors.isWebGLAndFireFox=!0;localStorage.RomeError=!0}}else for(g=0;g<f.conditions.length;g++)if(f.conditions[g]){window.location=d+"?"+this.MagicVariable+"="+g;break}}}HandleErrors.isWebGLAndFireFox=!1;var romeErrors=new HandleErrors,variables=romeErrors.getUrlVars();if(variables)variables[romeErrors.MagicVariable]&&window.addEventListener("load",function(){var b=variables[romeErrors.MagicVariable];document.getElementById("error").innerHTML=romeErrors.Errors[b]},!1);else romeErrors.checkForErrors();
var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b(V,Z,aa){var pa,na,sa;for(na=0;na<30;na++)for(pa=0;pa<73;pa++){sa=(pa+na*74)*4;V[sa]=V[sa+4];V[sa+1]=V[sa+5];V[sa+2]=V[sa+6]}for(na=0;na<30;na++){sa=(73+na*74)*4;if(na<Z){V[sa]=fa[aa].bg.r;V[sa+1]=fa[aa].bg.g;V[sa+2]=fa[aa].bg.b}else{V[sa]=fa[aa].fg.r;V[sa+1]=fa[aa].fg.g;V[sa+2]=fa[aa].fg.b}}}var e=0,c=2,d,f=0,h=(new Date).getTime(),g=h,n=h,m=0,o=1E3,t=0,u,w,v,x,y,A=0,B=1E3,D=0,C,G,F,E,O=0,L=1E3,H=0,N,ea,p,ha,fa={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,
g:48,b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};d=document.createElement("div");d.style.cursor="pointer";d.style.width="80px";d.style.opacity="0.9";d.style.zIndex="10001";d.addEventListener("click",function(){e++;e==c&&(e=0);u.style.display="none";C.style.display="none";N.style.display="none";switch(e){case 0:u.style.display="block";break;case 1:C.style.display="block";break;case 2:N.style.display="block"}},!1);u=document.createElement("div");u.style.backgroundColor=
"rgb("+Math.floor(fa.fps.bg.r/2)+","+Math.floor(fa.fps.bg.g/2)+","+Math.floor(fa.fps.bg.b/2)+")";u.style.padding="2px 0px 3px 0px";d.appendChild(u);w=document.createElement("div");w.style.fontFamily="Helvetica, Arial, sans-serif";w.style.textAlign="left";w.style.fontSize="9px";w.style.color="rgb("+fa.fps.fg.r+","+fa.fps.fg.g+","+fa.fps.fg.b+")";w.style.margin="0px 0px 1px 3px";w.innerHTML='<span style="font-weight:bold">FPS</span>';u.appendChild(w);v=document.createElement("canvas");v.width=74;v.height=
30;v.style.display="block";v.style.marginLeft="3px";u.appendChild(v);x=v.getContext("2d");x.fillStyle="rgb("+fa.fps.bg.r+","+fa.fps.bg.g+","+fa.fps.bg.b+")";x.fillRect(0,0,v.width,v.height);y=x.getImageData(0,0,v.width,v.height);C=document.createElement("div");C.style.backgroundColor="rgb("+Math.floor(fa.ms.bg.r/2)+","+Math.floor(fa.ms.bg.g/2)+","+Math.floor(fa.ms.bg.b/2)+")";C.style.padding="2px 0px 3px 0px";C.style.display="none";d.appendChild(C);G=document.createElement("div");G.style.fontFamily=
"Helvetica, Arial, sans-serif";G.style.textAlign="left";G.style.fontSize="9px";G.style.color="rgb("+fa.ms.fg.r+","+fa.ms.fg.g+","+fa.ms.fg.b+")";G.style.margin="0px 0px 1px 3px";G.innerHTML='<span style="font-weight:bold">MS</span>';C.appendChild(G);v=document.createElement("canvas");v.width=74;v.height=30;v.style.display="block";v.style.marginLeft="3px";C.appendChild(v);F=v.getContext("2d");F.fillStyle="rgb("+fa.ms.bg.r+","+fa.ms.bg.g+","+fa.ms.bg.b+")";F.fillRect(0,0,v.width,v.height);E=F.getImageData(0,
0,v.width,v.height);try{webkitPerformance&&webkitPerformance.memory.totalJSHeapSize&&(c=3)}catch(oa){}N=document.createElement("div");N.style.backgroundColor="rgb("+Math.floor(fa.mem.bg.r/2)+","+Math.floor(fa.mem.bg.g/2)+","+Math.floor(fa.mem.bg.b/2)+")";N.style.padding="2px 0px 3px 0px";N.style.display="none";d.appendChild(N);ea=document.createElement("div");ea.style.fontFamily="Helvetica, Arial, sans-serif";ea.style.textAlign="left";ea.style.fontSize="9px";ea.style.color="rgb("+fa.mem.fg.r+","+
fa.mem.fg.g+","+fa.mem.fg.b+")";ea.style.margin="0px 0px 1px 3px";ea.innerHTML='<span style="font-weight:bold">MEM</span>';N.appendChild(ea);v=document.createElement("canvas");v.width=74;v.height=30;v.style.display="block";v.style.marginLeft="3px";N.appendChild(v);p=v.getContext("2d");p.fillStyle="#301010";p.fillRect(0,0,v.width,v.height);ha=p.getImageData(0,0,v.width,v.height);return{domElement:d,update:function(){f++;h=(new Date).getTime();A=h-g;B=Math.min(B,A);D=Math.max(D,A);b(E.data,Math.min(30,
30-A/200*30),"ms");G.innerHTML='<span style="font-weight:bold">'+A+" MS</span> ("+B+"-"+D+")";F.putImageData(E,0,0);g=h;if(h>n+1E3){m=Math.round(f*1E3/(h-n));o=Math.min(o,m);t=Math.max(t,m);b(y.data,Math.min(30,30-m/100*30),"fps");w.innerHTML='<span style="font-weight:bold">'+m+" FPS</span> ("+o+"-"+t+")";x.putImageData(y,0,0);if(c==3){O=webkitPerformance.memory.usedJSHeapSize*9.54E-7;L=Math.min(L,O);H=Math.max(H,O);b(ha.data,Math.min(30,30-O/2),"mem");ea.innerHTML='<span style="font-weight:bold">'+
Math.round(O)+" MEM</span> ("+Math.round(L)+"-"+Math.round(H)+")";p.putImageData(ha,0,0)}n=h;f=0}}}},GUI=function(){var b=this,e=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
e.appendChild(c);var d=[],f=[],h=!0,g,n,m=0;b=this;var o=!1,t=280,u=!1,w,v,x=0,y;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=t+"px";var A=document.createElement("div");A.setAttribute("class","guidat-controllers");A.addEventListener("DOMMouseScroll",function(Z){var aa=this.scrollTop;if(Z.wheelDelta)aa+=Z.wheelDelta;else Z.detail&&(aa+=Z.detail);Z.preventDefault&&Z.preventDefault();Z.returnValue=!1;A.scrollTop=aa},!1);A.style.height=
"0px";var B=document.createElement("a");B.setAttribute("class","guidat-toggle");B.setAttribute("href","#");B.innerHTML="Show Controls";var D=!1,C=0,G=!1,F,E,O,L,H=function(Z){E=F;L=O;F=Z.pageY;O=Z.pageX;Z=F-E;if(!o)if(Z>0){o=!0;m=w=1;B.innerHTML=v||"Hide Controls"}else return;var aa=L-O;if(Z>0&&m>n){var pa=GUI.map(m,n,n+100,1,0);Z*=pa}D=!0;C+=Z;dragDisplacementX+=aa;w+=Z;t+=aa;m+=Z;A.style.height=w+"px";t=GUI.constrain(t,240,500);b.domElement.style.width=t+"px";ha()};B.addEventListener("mousedown",
function(Z){E=F=Z.pageY;L=O=Z.pageX;G=!0;Z.preventDefault();dragDisplacementX=C=0;document.addEventListener("mousemove",H,!1);return!1},!1);B.addEventListener("click",function(Z){Z.preventDefault();return!1},!1);document.addEventListener("mouseup",function(Z){if(G&&!D){b.toggle();b.domElement.style.width=t+1+"px";setTimeout(function(){b.domElement.style.width=t+"px"},1)}if(G&&D){if(dragDisplacementX==0){b.domElement.style.width=t+1+"px";setTimeout(function(){b.domElement.style.width=t+"px"},1)}if(w>
n){clearTimeout(y);w=x=n;oa()}else if(A.children.length>=1){var aa=A.children[0].offsetHeight;clearTimeout(y);x=Math.round(m/aa)*aa-1;if(x<=0){b.hide();w=aa*2}else{w=x;oa()}}}document.removeEventListener("mousemove",H,!1);Z.preventDefault();D=!1;G=!1;return!1},!1);this.domElement.appendChild(A);this.domElement.appendChild(B);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var N=function(){g=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(Z){if(h=Z)f.length>0&&N();else clearInterval(g)});this.__defineGetter__("autoListen",function(){return h});this.listenTo=function(Z){f.length==0&&N();f.push(Z)};this.unlistenTo=function(Z){for(var aa=0;aa<f.length;aa++)f[aa]==Z&&f.splice(aa,1);f.length<=0&&clearInterval(g)};this.listen=function(Z){Z=Z||f;for(var aa in Z)Z[aa].updateDisplay()};this.listenAll=function(){this.listen(d)};
this.autoListen=!0;var ea=function(Z,aa){for(var pa in d)if(d[pa].object==Z&&d[pa].propertyName==aa)return!0;return!1},p=function(Z,aa){function pa(){return Z.apply(this,aa)}pa.prototype=Z.prototype;return new pa};this.add=function(){var Z=arguments[0],aa=arguments[1];ea(Z,aa);var pa=Z[aa];if(pa==undefined)GUI.error(Z+' either has no property "'+aa+'", or the property is inaccessible.');else{Z=typeof pa;pa=fa[Z];if(pa==undefined)GUI.error('Cannot create controller for data type "'+Z+'"');else{for(var na=
[this],sa=0;sa<arguments.length;sa++)na.push(arguments[sa]);if(pa=p(pa,na)){A.appendChild(pa.domElement);d.push(pa);GUI.allControllers.push(pa);if(Z!="function"&&GUI.saveIndex<GUI.savedValues.length){pa.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}ha();u||(w=n);return pa}else GUI.error('Error creating controller for "'+aa+'".')}}};var ha=function(){n=0;for(var Z in d)n+=d[Z].domElement.offsetHeight;A.style.overflowY=n-1>w?"auto":"hidden"},fa={number:GUI.NumberController,string:GUI.StringController,
"boolean":GUI.BooleanController,"function":GUI.FunctionController};ea=function(Z,aa){for(var pa in d)if(d[pa].object==Z&&d[pa].propertyName==aa)return!0;return!1};p=function(Z,aa){function pa(){return Z.apply(this,aa)}pa.prototype=Z.prototype;return new pa};this.reset=function(){};this.toggle=function(){o?this.hide():this.show()};this.show=function(){B.innerHTML=v||"Hide Controls";x=w;clearTimeout(y);oa();o=!0};this.hide=function(){B.innerHTML=v||"Show Controls";x=0;clearTimeout(y);oa();o=!1};this.name=
function(Z){v=Z;B.innerHTML=Z};this.appearanceVars=function(){return[o,t,w,A.scrollTop]};var oa=function(){m+=(x-m)*0.6;if(Math.abs(m-x)<1)m=x;else y=setTimeout(oa,1E3/30);A.style.height=Math.round(m)+"px";ha()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){t=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=t+"px";w=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);u=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){m=w;var V=GUI.savedAppearanceVars[GUI.guiIndex][3];
setTimeout(function(){A.scrollTop=V},0);if(GUI.scrollTop>-1)document.body.scrollTop=GUI.scrollTop;x=w;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var e=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<e;c++){var d=b.splice(2,4);GUI.savedAppearanceVars.push(d)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var e in GUI.allGuis)for(var c=GUI.allGuis[e].appearanceVars(),d=0;d<c.length;d++)b.push(c[d]);for(e in GUI.allControllers)if(GUI.allControllers[e].type!="function"){c=GUI.allControllers[e].getValue();GUI.allControllers[e].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var e,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){e=c[d].split("=");if(e!=undefined&&e[0]==b)return e[1]}return null};
GUI.replaceGetVar=function(b,e){for(var c,d=window.location.href,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),h=0;h<f.length;h++){c=f[h].split("=");if(c!=undefined&&c[0]==b)return d.replace(c[1],e)}if(window.location.href.indexOf("?")!=-1)return d+"&"+b+"="+e;return d+"?"+b+"="+e};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,e,c,d,f){return d+(f-d)*((b-e)/(c-e))};GUI.constrain=function(b,e,c){if(b<e)b=e;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,e){var c=Math.pow(10,e);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,e,c,d,f){var h=!1,g=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(m){this.fg.style.width=GUI.map(m,e,c,0,100)+"%"});var n=function(m){if(h){var o;o=g.domElement;var t=curtop=0;if(o.offsetParent){do{t+=o.offsetLeft;curtop+=o.offsetTop}while(o=o.offsetParent);
o=[t,curtop]}else o=void 0;m=GUI.map(m.pageX,o[0],o[0]+g.domElement.offsetWidth,e,c);m=Math.round(m/d)*d;b.setValue(m)}};this.domElement.addEventListener("mousedown",function(m){h=!0;g.domElement.setAttribute("class","guidat-slider-bg active");g.fg.setAttribute("class","guidat-slider-fg active");n(m)},!1);document.addEventListener("mouseup",function(){g.domElement.setAttribute("class","guidat-slider-bg");g.fg.setAttribute("class","guidat-slider-fg");h=!1},!1);document.addEventListener("mousemove",
n,!1);this.value=f};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var e=document.createElement("input"),c=this.getValue();e.setAttribute("value",c);e.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){e.focus();e.select()},!1);e.addEventListener("keyup",function(){b.setValue(e.value)},!1);this.updateDisplay=function(){e.value=b.getValue()};this.domElement.appendChild(e)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,e=!1,c=!1,d=py=0,f=arguments[3],h=arguments[4],g=arguments[5];g||(g=f!=undefined&&h!=undefined?(h-f)*0.01:1);var n=document.createElement("input");n.setAttribute("id",this.propertyName);n.setAttribute("type","text");n.setAttribute("value",this.getValue());g&&n.setAttribute("step",g);this.domElement.appendChild(n);var m;if(f!=undefined&&h!=undefined){m=new GUI.Slider(this,f,h,g,this.getValue());this.domElement.appendChild(m.domElement)}n.addEventListener("blur",
function(){var t=parseFloat(this.value);if(isNaN(t))this.value=b.getValue();else b.updateDisplay()},!1);n.addEventListener("mousewheel",function(t){t.preventDefault();b.setValue(b.getValue()+Math.abs(t.wheelDeltaY)/t.wheelDeltaY*g);return!1},!1);n.addEventListener("mousedown",function(t){py=d=t.pageY;c=!0;document.addEventListener("mousemove",o,!1)},!1);n.addEventListener("keydown",function(t){switch(t.keyCode){case 38:t=b.getValue()+g;b.setValue(t);break;case 40:t=b.getValue()-g;b.setValue(t)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",o,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(n);if(c&&!e){n.focus();n.select()}e=!1;c=!1},!1);var o=function(t){e=!0;t.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(n);py=d;d=t.pageY;t=py-d;t=b.getValue()+t*g;b.setValue(t);return!1};this.setValue=function(t){t=parseFloat(t);if(f!=undefined&&t<=f)t=f;else h!=undefined&&t>=h&&(t=h);return GUI.Controller.prototype.setValue.call(this,
t)};this.updateDisplay=function(){n.value=GUI.roundToDecimal(b.getValue(),4);if(m)m.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,e=document.createElement("input");e.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){e.checked=!e.checked;c.preventDefault();b.setValue(e.checked)},!1);e.addEventListener("mouseup",function(){e.checked=!e.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(e);this.updateDisplay=function(){e.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(d){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);
var signals=function(){function b(c,d,f,h,g){this._listener=d;this._isOnce=f;this.context=h;this._signal=c;this._priority=g||0}var e={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var d;if(this._isEnabled){d=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return d},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};e.Signal=function(){this._bindings=[]};e.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,d,f,h){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var g=this._indexOfListener(c);if(g!==-1){c=this._bindings[g];if(c.isOnce()!==d)throw Error("You cannot add"+(d?"":"Once")+"() then add"+(!d?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,d,f,h);this._addBinding(c)}return c},_addBinding:function(c){var d=this._bindings.length;do--d;while(this._bindings[d]&&c._priority<=this._bindings[d]._priority);this._bindings.splice(d+1,0,c)},_indexOfListener:function(c){for(var d=this._bindings.length;d--;)if(this._bindings[d]._listener===
c)return d;return-1},add:function(c,d,f){return this._registerListener(c,!1,d,f)},addOnce:function(c,d,f){return this._registerListener(c,!0,d,f)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var d=this._indexOfListener(c);if(d!==-1){this._bindings[d]._destroy();this._bindings.splice(d,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),d=this._bindings.slice(),f=this._bindings.length;this._shouldPropagate=!0;do f--;while(d[f]&&this._shouldPropagate&&d[f].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return e}(),TWEEN=TWEEN||function(){var b,e,c,d=[];this.add=function(f){d.push(f)};this.remove=function(f){b=d.indexOf(f);b!==-1&&d.splice(b,1)};this.update=function(){b=0;e=d.length;for(c=(new Date).getTime();b<e;)if(d[b].update(c))b++;else{d.splice(b,1);e--}};return this}();
TWEEN.Tween=function(b){var e={},c={},d={},f=1E3,h=0,g=null,n=TWEEN.Easing.Linear.EaseNone,m=null,o=null,t=null;this.to=function(u,w){w!==null&&(f=w);for(var v in u)b[v]!==null&&(d[v]=u[v]);return this};this.start=function(){TWEEN.add(this);g=(new Date).getTime()+h;for(var u in d)if(b[u]!==null){e[u]=b[u];c[u]=d[u]-b[u]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(u){h=u;return this};this.easing=function(u){n=u;return this};this.chain=function(u){m=u};this.onUpdate=
function(u){o=u;return this};this.onComplete=function(u){t=u;return this};this.update=function(u){var w,v;if(u<g)return!0;u=(u-g)/f;u=u>1?1:u;v=n(u);for(w in c)b[w]=e[w]+c[w]*v;o!==null&&o.call(b,v);if(u==1){t!==null&&t.call(b);m!==null&&m.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d))};
TWEEN.Easing.Elastic.EaseOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-e)*2*Math.PI/d)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-e)*2*Math.PI/d)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,e,c){this.r=b;this.g=e;this.b=c;this.updateHex()},setHSV:function(b,e,c){var d,f,h,g,n,m;if(c==0)d=f=h=0;else{g=Math.floor(b*6);n=b*6-g;b=c*(1-e);m=c*(1-e*n);e=c*(1-e*(1-n));switch(g){case 1:d=m;f=c;h=b;break;case 2:d=b;f=c;h=e;break;case 3:d=b;f=m;h=c;break;case 4:d=e;f=b;h=c;break;case 5:d=c;f=b;h=m;break;case 6:case 0:d=c;f=e;h=b}}this.setRGB(d,
f,h)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,e){this.set(b||0,e||0)};
THREE.Vector2.prototype={set:function(b,e){this.x=b;this.y=e;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,e,c){this.set(b||0,e||0,c||0)};
THREE.Vector3.prototype={set:function(b,e,c){this.x=b;this.y=e;this.z=c;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
e){this.set(b.y*e.z-b.z*e.y,b.z*e.x-b.x*e.z,b.x*e.y-b.y*e.x);return this},crossSelf:function(b){var e=this.x,c=this.y,d=this.z;this.set(c*b.z-d*b.y,d*b.x-e*b.z,e*b.y-c*b.x);return this},multiply:function(b,e){this.set(b.x*e.x,b.y*e.y,b.z*e.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var e=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return e*e+c*c+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var e=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(e)>1.0E-5){this.x=Math.atan2(-b.n23/e,b.n33/e);this.z=Math.atan2(-b.n12/e,b.n11/e)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,e,c,d){this.set(b||0,e||0,c||0,d||1)};
THREE.Vector4.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z,b.w+e.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z,b.w-e.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,e){this.set(this.x+(b.x-this.x)*e,this.y+(b.y-this.y)*e,this.z+(b.z-this.z)*e,this.w+(b.w-this.w)*e)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,e){this.origin=b||new THREE.Vector3;this.direction=e||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){var e,c,d=b.objects,f=[];b=0;for(e=d.length;b<e;b++){c=d[b];c instanceof THREE.Mesh&&(f=f.concat(this.intersectObject(c)))}f.sort(function(h,g){return h.distance-g.distance});return f},intersectObject:function(b){function e(A,B,D,C){C=C.clone().subSelf(B);D=D.clone().subSelf(B);var G=A.clone().subSelf(B);A=C.dot(C);B=C.dot(D);C=C.dot(G);var F=D.dot(D);D=D.dot(G);G=1/(A*F-B*B);F=(F*C-B*D)*G;A=(A*D-B*C)*G;return F>0&&A>0&&F+A<1}var c,d,f,h,g,n,m,o,t,u,
w,v=b.geometry,x=v.vertices,y=[];c=0;for(d=v.faces.length;c<d;c++){f=v.faces[c];u=this.origin.clone();w=this.direction.clone();m=b.matrixWorld;h=m.multiplyVector3(x[f.a].position.clone());g=m.multiplyVector3(x[f.b].position.clone());n=m.multiplyVector3(x[f.c].position.clone());m=f instanceof THREE.Face4?m.multiplyVector3(x[f.d].position.clone()):null;o=b.matrixRotationWorld.multiplyVector3(f.normal.clone());t=w.dot(o);if(b.doubleSided||(b.flipSided?t>0:t<0)){o=o.dot((new THREE.Vector3).sub(h,u))/
t;u=u.addSelf(w.multiplyScalar(o));if(f instanceof THREE.Face3){if(e(u,h,g,n)){f={distance:this.origin.distanceTo(u),point:u,face:f,object:b};y.push(f)}}else if(f instanceof THREE.Face4&&(e(u,h,g,m)||e(u,g,n,m))){f={distance:this.origin.distanceTo(u),point:u,face:f,object:b};y.push(f)}}}return y}};
THREE.Rectangle=function(){function b(){h=d-e;g=f-c}var e,c,d,f,h,g,n=!0;this.getX=function(){return e};this.getY=function(){return c};this.getWidth=function(){return h};this.getHeight=function(){return g};this.getLeft=function(){return e};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return f};this.set=function(m,o,t,u){n=!1;e=m;c=o;d=t;f=u;b()};this.addPoint=function(m,o){if(n){n=!1;e=m;c=o;d=m;f=o}else{e=e<m?e:m;c=c<o?c:o;d=d>m?d:m;f=f>o?f:o}b()};
this.add3Points=function(m,o,t,u,w,v){if(n){n=!1;e=m<t?m<w?m:w:t<w?t:w;c=o<u?o<v?o:v:u<v?u:v;d=m>t?m>w?m:w:t>w?t:w;f=o>u?o>v?o:v:u>v?u:v}else{e=m<t?m<w?m<e?m:e:w<e?w:e:t<w?t<e?t:e:w<e?w:e;c=o<u?o<v?o<c?o:c:v<c?v:c:u<v?u<c?u:c:v<c?v:c;d=m>t?m>w?m>d?m:d:w>d?w:d:t>w?t>d?t:d:w>d?w:d;f=o>u?o>v?o>f?o:f:v>f?v:f:u>v?u>f?u:f:v>f?v:f}b()};this.addRectangle=function(m){if(n){n=!1;e=m.getLeft();c=m.getTop();d=m.getRight();f=m.getBottom()}else{e=e<m.getLeft()?e:m.getLeft();c=c<m.getTop()?c:m.getTop();d=d>m.getRight()?
d:m.getRight();f=f>m.getBottom()?f:m.getBottom()}b()};this.inflate=function(m){e-=m;c-=m;d+=m;f+=m;b()};this.minSelf=function(m){e=e>m.getLeft()?e:m.getLeft();c=c>m.getTop()?c:m.getTop();d=d<m.getRight()?d:m.getRight();f=f<m.getBottom()?f:m.getBottom();b()};this.instersects=function(m){return Math.min(d,m.getRight())-Math.max(e,m.getLeft())>=0&&Math.min(f,m.getBottom())-Math.max(c,m.getTop())>=0};this.empty=function(){n=!0;f=d=c=e=0;b()};this.isEmpty=function(){return n}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,e=this.m;b=e[1];e[1]=e[3];e[3]=b;b=e[2];e[2]=e[6];e[6]=b;b=e[5];e[5]=e[7];e[7]=b;return this},transposeIntoArray:function(b){var e=this.m;b[0]=e[0];b[1]=e[3];b[2]=e[6];b[3]=e[1];b[4]=e[4];b[5]=e[7];b[6]=e[2];b[7]=e[5];b[8]=e[8];return this}};
THREE.Matrix4=function(b,e,c,d,f,h,g,n,m,o,t,u,w,v,x,y){this.set(b||1,e||0,c||0,d||0,f||0,h||1,g||0,n||0,m||0,o||0,t||1,u||0,w||0,v||0,x||0,y||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,e,c,d,f,h,g,n,m,o,t,u,w,v,x,y){this.n11=b;this.n12=e;this.n13=c;this.n14=d;this.n21=f;this.n22=h;this.n23=g;this.n24=n;this.n31=m;this.n32=o;this.n33=t;this.n34=u;this.n41=w;this.n42=v;this.n43=x;this.n44=y;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,e,c){var d=THREE.Matrix4.__v1,
f=THREE.Matrix4.__v2,h=THREE.Matrix4.__v3;h.sub(b,e).normalize();if(h.length()===0)h.z=1;d.cross(c,h).normalize();if(d.length()===0){h.x+=1.0E-4;d.cross(c,h).normalize()}f.cross(h,d).normalize();this.n11=d.x;this.n12=f.x;this.n13=h.x;this.n21=d.y;this.n22=f.y;this.n23=h.y;this.n31=d.z;this.n32=f.z;this.n33=h.z;return this},multiplyVector3:function(b){var e=b.x,c=b.y,d=b.z,f=1/(this.n41*e+this.n42*c+this.n43*d+this.n44);b.x=(this.n11*e+this.n12*c+this.n13*d+this.n14)*f;b.y=(this.n21*e+this.n22*c+this.n23*
d+this.n24)*f;b.z=(this.n31*e+this.n32*c+this.n33*d+this.n34)*f;return b},multiplyVector4:function(b){var e=b.x,c=b.y,d=b.z,f=b.w;b.x=this.n11*e+this.n12*c+this.n13*d+this.n14*f;b.y=this.n21*e+this.n22*c+this.n23*d+this.n24*f;b.z=this.n31*e+this.n32*c+this.n33*d+this.n34*f;b.w=this.n41*e+this.n42*c+this.n43*d+this.n44*f;return b},rotateAxis:function(b){var e=b.x,c=b.y,d=b.z;b.x=e*this.n11+c*this.n12+d*this.n13;b.y=e*this.n21+c*this.n22+d*this.n23;b.z=e*this.n31+c*this.n32+d*this.n33;b.normalize();
return b},crossVector:function(b){var e=new THREE.Vector4;e.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;e.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;e.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;e.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return e},multiply:function(b,e){var c=b.n11,d=b.n12,f=b.n13,h=b.n14,g=b.n21,n=b.n22,m=b.n23,o=b.n24,t=b.n31,u=b.n32,w=b.n33,v=b.n34,x=b.n41,y=b.n42,A=b.n43,B=b.n44,D=e.n11,C=e.n12,G=e.n13,F=e.n14,E=e.n21,O=e.n22,
L=e.n23,H=e.n24,N=e.n31,ea=e.n32,p=e.n33,ha=e.n34;this.n11=c*D+d*E+f*N;this.n12=c*C+d*O+f*ea;this.n13=c*G+d*L+f*p;this.n14=c*F+d*H+f*ha+h;this.n21=g*D+n*E+m*N;this.n22=g*C+n*O+m*ea;this.n23=g*G+n*L+m*p;this.n24=g*F+n*H+m*ha+o;this.n31=t*D+u*E+w*N;this.n32=t*C+u*O+w*ea;this.n33=t*G+u*L+w*p;this.n34=t*F+u*H+w*ha+v;this.n41=x*D+y*E+A*N;this.n42=x*C+y*O+A*ea;this.n43=x*G+y*L+A*p;this.n44=x*F+y*H+A*ha+B;return this},multiplyToArray:function(b,e,c){this.multiply(b,e);c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;
c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=
this.n11,e=this.n12,c=this.n13,d=this.n14,f=this.n21,h=this.n22,g=this.n23,n=this.n24,m=this.n31,o=this.n32,t=this.n33,u=this.n34,w=this.n41,v=this.n42,x=this.n43,y=this.n44;return d*g*o*w-c*n*o*w-d*h*t*w+e*n*t*w+c*h*u*w-e*g*u*w-d*g*m*v+c*n*m*v+d*f*t*v-b*n*t*v-c*f*u*v+b*g*u*v+d*h*m*x-e*n*m*x-d*f*o*x+b*n*o*x+e*f*u*x-b*h*u*x-c*h*m*y+e*g*m*y+c*f*o*y-b*g*o*y-e*f*t*y+b*h*t*y},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=
this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;
this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=
this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,e){b[e]=this.n11;b[e+1]=this.n21;b[e+2]=this.n31;b[e+3]=this.n41;b[e+4]=this.n12;b[e+5]=this.n22;b[e+6]=this.n32;b[e+7]=this.n42;b[e+8]=this.n13;b[e+9]=this.n23;b[e+10]=this.n33;b[e+11]=this.n43;b[e+12]=this.n14;b[e+13]=this.n24;b[e+14]=this.n34;b[e+15]=this.n44;return b},setTranslation:function(b,e,c){this.set(1,0,0,b,0,1,0,e,0,0,1,c,0,0,0,1);return this},setScale:function(b,
e,c){this.set(b,0,0,0,0,e,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,e,-b,0,0,b,e,0,0,0,0,1);return this},setRotationY:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,0,b,0,0,1,0,0,-b,0,e,0,0,0,0,1);return this},setRotationZ:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,-b,0,0,b,e,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,e){var c=Math.cos(e),d=Math.sin(e),f=1-c,h=b.x,g=b.y,n=b.z,m=f*h,o=f*g;this.set(m*
h+c,m*g-d*n,m*n+d*g,0,m*g+d*n,o*g+c,o*n-d*h,0,m*n-d*g,o*n+d*h,f*n*n+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;
this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var e=b.x,c=b.y,d=b.z;b=Math.cos(e);e=Math.sin(e);var f=Math.cos(c);c=Math.sin(c);var h=Math.cos(d);d=Math.sin(d);var g=b*c,n=e*c;this.n11=f*h;this.n12=-f*d;this.n13=c;this.n21=n*h+b*d;this.n22=-n*d+b*h;this.n23=-e*f;this.n31=-g*h+e*d;this.n32=g*d+e*h;this.n33=b*f;return this},
setRotationFromQuaternion:function(b){var e=b.x,c=b.y,d=b.z,f=b.w,h=e+e,g=c+c,n=d+d;b=e*h;var m=e*g;e*=n;var o=c*g;c*=n;d*=n;h*=f;g*=f;f*=n;this.n11=1-(o+d);this.n12=m-f;this.n13=e+g;this.n21=m+f;this.n22=1-(b+d);this.n23=c-h;this.n31=e-g;this.n32=c+h;this.n33=1-(b+o);return this},scale:function(b){var e=b.x,c=b.y;b=b.z;this.n11*=e;this.n12*=c;this.n13*=b;this.n21*=e;this.n22*=c;this.n23*=b;this.n31*=e;this.n32*=c;this.n33*=b;this.n41*=e;this.n42*=c;this.n43*=b;return this},extractPosition:function(b){this.n14=
b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,e){var c=1/e.x,d=1/e.y,f=1/e.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*d;this.n22=b.n22*d;this.n32=b.n32*d;this.n13=b.n13*f;this.n23=b.n23*f;this.n33=b.n33*f}};
THREE.Matrix4.makeInvert=function(b,e){var c=b.n11,d=b.n12,f=b.n13,h=b.n14,g=b.n21,n=b.n22,m=b.n23,o=b.n24,t=b.n31,u=b.n32,w=b.n33,v=b.n34,x=b.n41,y=b.n42,A=b.n43,B=b.n44;e===undefined&&(e=new THREE.Matrix4);e.n11=m*v*y-o*w*y+o*u*A-n*v*A-m*u*B+n*w*B;e.n12=h*w*y-f*v*y-h*u*A+d*v*A+f*u*B-d*w*B;e.n13=f*o*y-h*m*y+h*n*A-d*o*A-f*n*B+d*m*B;e.n14=h*m*u-f*o*u-h*n*w+d*o*w+f*n*v-d*m*v;e.n21=o*w*x-m*v*x-o*t*A+g*v*A+m*t*B-g*w*B;e.n22=f*v*x-h*w*x+h*t*A-c*v*A-f*t*B+c*w*B;e.n23=h*m*x-f*o*x-h*g*A+c*o*A+f*g*B-c*m*B;
e.n24=f*o*t-h*m*t+h*g*w-c*o*w-f*g*v+c*m*v;e.n31=n*v*x-o*u*x+o*t*y-g*v*y-n*t*B+g*u*B;e.n32=h*u*x-d*v*x-h*t*y+c*v*y+d*t*B-c*u*B;e.n33=f*o*x-h*n*x+h*g*y-c*o*y-d*g*B+c*n*B;e.n34=h*n*t-d*o*t-h*g*u+c*o*u+d*g*v-c*n*v;e.n41=m*u*x-n*w*x-m*t*y+g*w*y+n*t*A-g*u*A;e.n42=d*w*x-f*u*x+f*t*y-c*w*y-d*t*A+c*u*A;e.n43=f*n*x-d*m*x-f*g*y+c*m*y+d*g*A-c*n*A;e.n44=d*m*t-f*n*t+f*g*u-c*m*u-d*g*w+c*n*w;e.multiplyScalar(1/b.determinant());return e};
THREE.Matrix4.makeInvert3x3=function(b){var e=b.m33,c=e.m,d=b.n33*b.n22-b.n32*b.n23,f=-b.n33*b.n21+b.n31*b.n23,h=b.n32*b.n21-b.n31*b.n22,g=-b.n33*b.n12+b.n32*b.n13,n=b.n33*b.n11-b.n31*b.n13,m=-b.n32*b.n11+b.n31*b.n12,o=b.n23*b.n12-b.n22*b.n13,t=-b.n23*b.n11+b.n21*b.n13,u=b.n22*b.n11-b.n21*b.n12;b=b.n11*d+b.n21*g+b.n31*o;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*d;c[1]=b*f;c[2]=b*h;c[3]=b*g;c[4]=b*n;c[5]=b*m;c[6]=b*o;c[7]=b*t;c[8]=b*u;return e};
THREE.Matrix4.makeFrustum=function(b,e,c,d,f,h){var g;g=new THREE.Matrix4;g.n11=2*f/(e-b);g.n12=0;g.n13=(e+b)/(e-b);g.n14=0;g.n21=0;g.n22=2*f/(d-c);g.n23=(d+c)/(d-c);g.n24=0;g.n31=0;g.n32=0;g.n33=-(h+f)/(h-f);g.n34=-2*h*f/(h-f);g.n41=0;g.n42=0;g.n43=-1;g.n44=0;return g};THREE.Matrix4.makePerspective=function(b,e,c,d){var f;b=c*Math.tan(b*Math.PI/360);f=-b;return THREE.Matrix4.makeFrustum(f*e,b*e,f,b,c,d)};
THREE.Matrix4.makeOrtho=function(b,e,c,d,f,h){var g,n,m,o;g=new THREE.Matrix4;n=e-b;m=c-d;o=h-f;g.n11=2/n;g.n12=0;g.n13=0;g.n14=-((e+b)/n);g.n21=0;g.n22=2/m;g.n23=0;g.n24=-((c+d)/m);g.n31=0;g.n32=0;g.n33=-2/o;g.n34=-((h+f)/o);g.n41=0;g.n42=0;g.n43=0;g.n44=1;return g};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=
!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var e=this;e.parent!==undefined;)e=e.parent;e!==undefined&&e instanceof THREE.Scene&&e.addChildRecurse(b)}},removeChild:function(b){var e=this.children.indexOf(b);if(e!==-1){b.parent=undefined;this.children.splice(e,1)}},getChildByName:function(b,e){var c,d,f;c=0;for(d=this.children.length;c<d;c++){f=this.children[c];if(f.name===b)return f;if(e){f=f.getChildByName(b,e);if(f!==undefined)return f}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,e,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;e=!0}b=0;for(var d=this.children.length;b<d;b++)this.children[b].update(this.matrixWorld,e,c)}};THREE.Quaternion=function(b,e,c,d){this.set(b||0,e||0,c||0,d!==undefined?d:1)};
THREE.Quaternion.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var e=0.5*Math.PI/360,c=b.x*e,d=b.y*e,f=b.z*e;b=Math.cos(d);d=Math.sin(d);e=Math.cos(-f);f=Math.sin(-f);var h=Math.cos(c);c=Math.sin(c);var g=b*e,n=d*f;this.w=g*h-n*c;this.x=g*c+n*h;this.y=d*e*h+b*f*c;this.z=b*f*h-d*e*c;return this},setFromAxisAngle:function(b,e){var c=e/2,d=Math.sin(c);this.x=b.x*d;this.y=
b.y*d;this.z=b.z*d;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var e=this.x,c=this.y,d=this.z,f=this.w,h=b.x,g=b.y,n=b.z;b=b.w;this.x=e*b+f*h+c*n-d*g;this.y=c*b+f*g+d*h-e*n;this.z=d*b+f*n+e*g-c*h;this.w=f*b-e*h-c*g-d*n;return this},multiply:function(b,e){this.x=b.x*e.w+b.y*e.z-b.z*e.y+b.w*e.x;this.y=-b.x*e.z+b.y*e.w+b.z*e.x+b.w*e.y;this.z=b.x*e.y-b.y*e.x+b.z*e.w+b.w*e.z;this.w=-b.x*e.x-b.y*e.y-b.z*e.z+b.w*e.w;return this},multiplyVector3:function(b,e){e||(e=b);var c=b.x,d=b.y,f=b.z,h=this.x,g=this.y,n=this.z,m=this.w,o=m*c+g*f-n*d,t=
m*d+n*c-h*f,u=m*f+h*d-g*c;c=-h*c-g*d-n*f;e.x=o*m+c*-h+t*-n-u*-g;e.y=t*m+c*-g+u*-h-o*-n;e.z=u*m+c*-n+o*-g-t*-h;return e}};
THREE.Quaternion.slerp=function(b,e,c,d){var f=b.w*e.w+b.x*e.x+b.y*e.y+b.z*e.z;if(Math.abs(f)>=1){c.w=b.w;c.x=b.x;c.y=b.y;c.z=b.z;return c}var h=Math.acos(f),g=Math.sqrt(1-f*f);if(Math.abs(g)<0.0010){c.w=0.5*(b.w+e.w);c.x=0.5*(b.x+e.x);c.y=0.5*(b.y+e.y);c.z=0.5*(b.z+e.z);return c}f=Math.sin((1-d)*h)/g;d=Math.sin(d*h)/g;c.w=b.w*f+e.w*d;c.x=b.x*f+e.x*d;c.y=b.y*f+e.y*d;c.z=b.z*f+e.z*d;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,e,c,d,f,h){this.a=b;this.b=e;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=h instanceof Array?h:[h];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,e,c,d,f,h,g){this.a=b;this.b=e;this.c=c;this.d=d;this.normal=f instanceof THREE.Vector3?f:new THREE.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=h instanceof THREE.Color?h:new THREE.Color;this.vertexColors=h instanceof Array?h:[];this.vertexTangents=[];this.materials=g instanceof Array?g:[g];this.centroid=new THREE.Vector3};THREE.UV=function(b,e){this.set(b||0,e||0)};
THREE.UV.prototype={set:function(b,e){this.u=b;this.v=e;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,e,c;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var e,c,d,f,h,g,n=new THREE.Vector3,m=new THREE.Vector3;d=0;for(f=this.faces.length;d<f;d++){h=this.faces[d];if(b&&h.vertexNormals.length){n.set(0,0,0);e=0;for(c=h.vertexNormals.length;e<c;e++)n.addSelf(h.vertexNormals[e]);n.divideScalar(3)}else{e=this.vertices[h.a];c=this.vertices[h.b];g=this.vertices[h.c];n.sub(g.position,c.position);m.sub(e.position,c.position);n.crossSelf(m)}n.isZero()||
n.normalize();h.normal.copy(n)}},computeVertexNormals:function(){var b,e,c,d;if(this.__tmpVertices==undefined){d=this.__tmpVertices=Array(this.vertices.length);b=0;for(e=this.vertices.length;b<e;b++)d[b]=new THREE.Vector3;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{d=
this.__tmpVertices;b=0;for(e=this.vertices.length;b<e;b++)d[b].set(0,0,0)}b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal);d[c.d].addSelf(c.normal)}}b=0;for(e=this.vertices.length;b<e;b++)d[b].normalize();b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(d[c.a]);
c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c])}else if(c instanceof THREE.Face4){c.vertexNormals[0].copy(d[c.a]);c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c]);c.vertexNormals[3].copy(d[c.d])}}},computeTangents:function(){function b(Z,aa,pa,na,sa,ya,va){n=Z.vertices[aa].position;m=Z.vertices[pa].position;o=Z.vertices[na].position;t=g[sa];u=g[ya];w=g[va];v=m.x-n.x;x=o.x-n.x;y=m.y-n.y;A=o.y-n.y;B=m.z-n.z;D=o.z-n.z;C=u.u-t.u;G=w.u-t.u;F=u.v-t.v;E=w.v-t.v;O=1/(C*E-G*
F);ea.set((E*v-F*x)*O,(E*y-F*A)*O,(E*B-F*D)*O);p.set((C*x-G*v)*O,(C*A-G*y)*O,(C*D-G*B)*O);H[aa].addSelf(ea);H[pa].addSelf(ea);H[na].addSelf(ea);N[aa].addSelf(p);N[pa].addSelf(p);N[na].addSelf(p)}var e,c,d,f,h,g,n,m,o,t,u,w,v,x,y,A,B,D,C,G,F,E,O,L,H=[],N=[],ea=new THREE.Vector3,p=new THREE.Vector3,ha=new THREE.Vector3,fa=new THREE.Vector3,oa=new THREE.Vector3;e=0;for(c=this.vertices.length;e<c;e++){H[e]=new THREE.Vector3;N[e]=new THREE.Vector3}e=0;for(c=this.faces.length;e<c;e++){h=this.faces[e];g=
this.faceVertexUvs[0][e];if(h instanceof THREE.Face3)b(this,h.a,h.b,h.c,0,1,2);else if(h instanceof THREE.Face4){b(this,h.a,h.b,h.c,0,1,2);b(this,h.a,h.b,h.d,0,1,3)}}var V=["a","b","c","d"];e=0;for(c=this.faces.length;e<c;e++){h=this.faces[e];for(d=0;d<h.vertexNormals.length;d++){oa.copy(h.vertexNormals[d]);f=h[V[d]];L=H[f];ha.copy(L);ha.subSelf(oa.multiplyScalar(oa.dot(L))).normalize();fa.cross(h.vertexNormals[d],L);f=fa.dot(N[f]);f=f<0?-1:1;h.vertexTangents[d]=new THREE.Vector4(ha.x,ha.y,ha.z,f)}}this.hasTangents=
!0},computeBoundingBox:function(){var b;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var e=1,c=this.vertices.length;e<c;e++){b=this.vertices[e];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=
b.position.y;else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,e=0,c=this.vertices.length;e<c;e++)b=Math.max(b,this.vertices[e].position.length());this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(m,
o){return Math.min(m,o)+"_"+Math.max(m,o)}function e(m,o,t){if(m[o]===undefined){m[o]={set:{},array:[]};m[o].set[t]=1;m[o].array.push(t)}else if(m[o].set[t]===undefined){m[o].set[t]=1;m[o].array.push(t)}}var c,d,f,h,g,n={};c=0;for(d=this.faces.length;c<d;c++){g=this.faces[c];if(g instanceof THREE.Face3){f=b(g.a,g.b);e(n,f,c);f=b(g.b,g.c);e(n,f,c);f=b(g.a,g.c);e(n,f,c)}else if(g instanceof THREE.Face4){f=b(g.b,g.d);e(n,f,c);f=b(g.a,g.b);e(n,f,c);f=b(g.a,g.d);e(n,f,c);f=b(g.b,g.c);e(n,f,c);f=b(g.c,
g.d);e(n,f,c)}}c=0;for(d=this.edges.length;c<d;c++){g=this.edges[c];f=g.vertexIndices[0];h=g.vertexIndices[1];g.faceIndices=n[b(f,h)].array;for(f=0;f<g.faceIndices.length;f++){h=g.faceIndices[f];g.faces.push(this.faces[h])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function e(v,x,y,A,B,D,C){v=(y-v)*0.5;A=(A-x)*0.5;return(2*(x-y)+v+A)*C+(-3*(x-y)-2*v-A)*D+v*B+x}this.points=b;var c=[],d={x:0,y:0,z:0},f,h,g,n,m,o,t,u,w;this.initFromArray=function(v){this.points=[];for(var x=0;x<v.length;x++)this.points[x]={x:v[x][0],y:v[x][1],z:v[x][2]}};this.getPoint=function(v){f=(this.points.length-1)*v;h=Math.floor(f);g=f-h;c[0]=h==0?h:h-1;c[1]=h;c[2]=h>this.points.length-2?h:h+1;c[3]=h>this.points.length-3?h:h+2;o=this.points[c[0]];t=this.points[c[1]];
u=this.points[c[2]];w=this.points[c[3]];n=g*g;m=g*n;d.x=e(o.x,t.x,u.x,w.x,g,n,m);d.y=e(o.y,t.y,u.y,w.y,g,n,m);d.z=e(o.z,t.z,u.z,w.z,g,n,m);return d};this.getControlPointsArray=function(){var v,x,y=this.points.length,A=[];for(v=0;v<y;v++){x=this.points[v];A[v]=[x.x,x.y,x.z]}return A};this.getLength=function(v){var x,y,A=0,B=new THREE.Vector3,D=new THREE.Vector3,C=[],G=0;C[0]=0;v||(v=100);y=this.points.length*v;B.copy(this.points[0]);for(v=1;v<y;v++){x=v/y;position=this.getPoint(x);D.copy(position);
G+=D.distanceTo(B);B.copy(position);x*=this.points.length-1;x=Math.floor(x);if(x!=A){C[x]=G;A=x}}C[C.length]=G;return{chunks:C,total:G}};this.reparametrizeByArcLength=function(v){var x,y,A,B,D,C,G=[],F=new THREE.Vector3,E=this.getLength();G.push(F.copy(this.points[0]).clone());for(x=1;x<this.points.length;x++){y=E.chunks[x]-E.chunks[x-1];C=Math.ceil(v*y/E.total);B=(x-1)/(this.points.length-1);D=x/(this.points.length-1);for(y=1;y<C-1;y++){A=B+y*(1/C)*(D-B);position=this.getPoint(A);G.push(F.copy(position).clone())}G.push(F.copy(this.points[x]).clone())}this.points=
G}};THREE.Edge=function(b,e,c,d){this.vertices=[b,e];this.vertexIndices=[c,d];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,e,c,d,f){THREE.Object3D.call(this);this.fov=b||50;this.aspect=e||1;this.near=c||0.1;this.far=d||2E3;this.target=f||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,e,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);e=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;e=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,e,c,d){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=e||1;this.distance=c||0;this.castShadow=d!==undefined?d:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,e,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=e||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,e,c,d){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,e,c,d)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,e,c,d){e===undefined&&(e=-1);c===undefined&&(c=0);if(d===undefined)d=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:e,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,e=this.lensFlares.length,c,d=-this.positionScreen.x*2,f=-this.positionScreen.y*2;for(b=0;b<e;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+f*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ParticleCanvasMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.program=b.program!==undefined?b.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(b){THREE.Material.call(this);this.domElement=b};
THREE.Texture=function(b,e,c,d,f,h){this.image=b;this.mapping=e!==undefined?e:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==undefined?d:THREE.ClampToEdgeWrapping;this.magFilter=f!==undefined?f:THREE.LinearFilter;this.minFilter=h!==undefined?h:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.materials=b instanceof Array?b:[b]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;
THREE.Line=function(b,e,c){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e&&e.length?e:[e];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[c].name]=c}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.skinMatrix,e,c):b.update(this.matrixWorld,!0,c)}}else for(d=0;d<f;d++)this.children[d].update(this.skinMatrix,
e,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,e){THREE.Mesh.call(this,b,e);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,d,f,h,g,n;if(this.geometry.bones!==undefined){for(c=0;c<this.geometry.bones.length;c++){f=this.geometry.bones[c];h=f.pos;g=f.rotq;n=f.scl;d=this.addBone();d.name=f.name;d.position.set(h[0],h[1],h[2]);d.quaternion.set(g[0],g[1],g[2],g[3]);d.useQuaternion=!0;n!==undefined?d.scale.set(n[0],n[1],n[2]):d.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){f=this.geometry.bones[c];
d=this.bones[c];f.parent===-1?this.addChild(d):this.bones[f.parent].addChild(d)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,e,c){if(this.visible){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,e,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(e=0;e<c;e++)ba[e].skinMatrix.flattenToArrayOffset(bm,
e*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,e=[],c=0;c<this.bones.length;c++){b=this.bones[c];e.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var d;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var f=this.geometry.skinIndices[b].x,h=this.geometry.skinIndices[b].y;
d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(e[f].multiplyVector3(d));d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(e[h].multiplyVector3(d));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=c;this.geometry.skinWeights[b].y+=c}}}};
THREE.Ribbon=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,e,c,d){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=e!==undefined?Math.abs(e):100;this.volume=Math.min(1,Math.max(0,c!==undefined?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=d!==undefined?d:!0;this.sources=b instanceof Array?b:[b];var f;c=this.sources.length;for(b=0;b<c;b++){e=this.sources[b];e.toLowerCase();if(e.indexOf(".mp3")!==-1)f=
"audio/mpeg";else if(e.indexOf(".ogg")!==-1)f="audio/ogg";else e.indexOf(".wav")!==-1&&(f="audio/wav");if(this.domElement.canPlayType(f)){f=document.createElement("source");f.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(f);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,e,c){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);e=!0}if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d=this.children.length;for(b=0;b<d;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,e){e===undefined&&(e=0);e=Math.abs(e);for(var c=0;c<this.LODs.length;c++)if(e<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:e,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length;d++)if(b>=this.LODs[d].visibleAtDistance){this.LODs[d-1].object3D.visible=
!1;this.LODs[d].object3D.visible=!0}else break;for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.ShadowVolume=function(b,e){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,e,c,d,f,h,g,n,m,o,t,u,w,v,x=new THREE.Geometry;x.vertices=this.geometry.vertices;d=x.faces=this.geometry.faces;var y=x.egdes=this.geometry.edges,A=x.edgeFaces=[];f=0;var B=[];b=0;for(e=d.length;b<e;b++){c=d[b];B.push(f);f+=c instanceof THREE.Face3?3:4;c.vertexNormals[0]=c.normal;c.vertexNormals[1]=c.normal;c.vertexNormals[2]=c.normal;if(c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal}b=0;for(e=y.length;b<e;b++){n=y[b];c=n.faces[0];d=n.faces[1];f=n.faceIndices[0];h=n.faceIndices[1];g=n.vertexIndices[0];n=n.vertexIndices[1];if(c.a===g){m="a";t=B[f]+0}else if(c.b===g){m="b";t=B[f]+1}else if(c.c===g){m="c";t=B[f]+2}else if(c.d===g){m="d";t=B[f]+3}if(c.a===n){m+="a";u=B[f]+0}else if(c.b===n){m+="b";u=B[f]+1}else if(c.c===n){m+="c";u=B[f]+2}else if(c.d===n){m+="d";u=B[f]+3}if(d.a===g){o="a";w=B[h]+0}else if(d.b===g){o="b";w=B[h]+1}else if(d.c===g){o="c";w=B[h]+2}else if(d.d===
g){o="d";w=B[h]+3}if(d.a===n){o+="a";v=B[h]+0}else if(d.b===n){o+="b";v=B[h]+1}else if(d.c===n){o+="c";v=B[h]+2}else if(d.d===n){o+="d";v=B[h]+3}if(m==="ac"||m==="ad"||m==="ca"||m==="da"){if(t>u){c=t;t=u;u=c}}else if(t<u){c=t;t=u;u=c}if(o==="ac"||o==="ad"||o==="ca"||o==="da"){if(w>v){c=w;w=v;v=c}}else if(w<v){c=w;w=v;v=c}c=new THREE.Face4(t,u,w,v);c.normal.set(1,0,0);A.push(c)}this.geometry=x}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var e=this.geometry.vertices,c=this.geometry.faces,d=this.geometry.edgeFaces,f=b.faces;b=b.vertices;var h=f.length,g,n,m,o,t,u=["a","b","c","d"];for(m=0;m<h;m++){n=e.length;g=f[m];if(g instanceof THREE.Face4){o=4;n=new THREE.Face4(n,n+1,n+2,n+3)}else{o=3;n=new THREE.Face3(n,n+1,n+2)}n.normal.copy(g.normal);c.push(n);
for(n=0;n<o;n++){t=b[g[u[n]]];e.push(new THREE.Vertex(t.position.clone()))}}for(h=0;h<f.length-1;h++){b=c[h];for(g=h+1;g<f.length;g++){n=c[g];n=this.facesShareEdge(e,b,n);if(n!==undefined){n=new THREE.Face4(n.indices[0],n.indices[3],n.indices[2],n.indices[1]);n.normal.set(1,0,0);d.push(n)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,e,c){var d,f,h,g,n,m,o,t,u,w,v,x,y,A=0,B=["a","b","c","d"];d=e instanceof THREE.Face4?4:3;f=c instanceof THREE.Face4?4:3;for(x=0;x<d;x++){h=e[B[x]];n=b[h];for(y=0;y<f;y++){g=c[B[y]];m=b[g];if(Math.abs(n.position.x-m.position.x)<1.0E-4&&Math.abs(n.position.y-m.position.y)<1.0E-4&&Math.abs(n.position.z-m.position.z)<1.0E-4){A++;if(A===1){o=n;t=m;u=h;w=g;v=B[x]}if(A===2){v+=B[x];return v==="ad"||v==="ac"?{faces:[e,c],vertices:[o,t,m,n],indices:[u,
w,g,h],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[e,c],vertices:[o,n,m,t],indices:[u,h,g,w],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var e=0;e<b.children.length;e++)this.addChildRecurse(b.children[e])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var e=this.lights.indexOf(b);e!==-1&&this.lights.splice(e,1)}else if(b instanceof THREE.Sound){e=this.sounds.indexOf(b);e!==-1&&this.sounds.splice(e,1)}else if(!(b instanceof THREE.Camera)){e=this.objects.indexOf(b);if(e!==-1){this.objects.splice(e,1);this.__objectsRemoved.push(b)}}for(e=0;e<b.children.length;e++)this.removeChildRecurse(b.children[e])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,e,c){this.color=new THREE.Color(b);this.near=e||1;this.far=c||1E3};THREE.FogExp2=function(b,e){this.color=new THREE.Color(b);this.density=e!==undefined?e:2.5E-4};
THREE.Projector=function(){function b(){var ea=m[n]=m[n]||new THREE.RenderableVertex;n++;return ea}function e(ea,p){return p.z-ea.z}function c(ea,p){var ha=0,fa=1,oa=ea.z+ea.w,V=p.z+p.w,Z=-ea.z+ea.w,aa=-p.z+p.w;if(oa>=0&&V>=0&&Z>=0&&aa>=0)return!0;else if(oa<0&&V<0||Z<0&&aa<0)return!1;else{if(oa<0)ha=Math.max(ha,oa/(oa-V));else V<0&&(fa=Math.min(fa,oa/(oa-V)));if(Z<0)ha=Math.max(ha,Z/(Z-aa));else aa<0&&(fa=Math.min(fa,Z/(Z-aa)));if(fa<ha)return!1;else{ea.lerpSelf(p,ha);p.lerpSelf(ea,1-fa);return!0}}}
var d,f,h=[],g,n,m=[],o,t,u=[],w,v=[],x,y,A=[],B,D,C=[],G=new THREE.Vector4,F=new THREE.Vector4,E=new THREE.Matrix4,O=new THREE.Matrix4,L=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],H=new THREE.Vector4,N=new THREE.Vector4;this.projectVector=function(ea,p){E.multiply(p.projectionMatrix,p.matrixWorldInverse);E.multiplyVector3(ea);return ea};this.unprojectVector=function(ea,p){E.multiply(p.matrixWorld,THREE.Matrix4.makeInvert(p.projectionMatrix));
E.multiplyVector3(ea);return ea};this.projectObjects=function(ea,p,ha){p=[];var fa,oa,V;f=0;oa=ea.objects;ea=0;for(fa=oa.length;ea<fa;ea++){V=oa[ea];var Z;if(!(Z=!V.visible))if(Z=V instanceof THREE.Mesh){a:{for(var aa=V.matrixWorld,pa=-V.geometry.boundingSphere.radius*Math.max(V.scale.x,Math.max(V.scale.y,V.scale.z)),na=0;na<6;na++){Z=L[na].x*aa.n14+L[na].y*aa.n24+L[na].z*aa.n34+L[na].w;if(Z<=pa){Z=!1;break a}}Z=!0}Z=!Z}if(!Z){Z=h[f]=h[f]||new THREE.RenderableObject;f++;d=Z;G.copy(V.position);E.multiplyVector3(G);
d.object=V;d.z=G.z;p.push(d)}}ha&&p.sort(e);return p};this.projectScene=function(ea,p,ha){var fa=[],oa=p.near,V=p.far,Z,aa,pa,na,sa,ya,va,Ha,Da,ra,Aa,La,Ua,Ya,$,la,ca;D=y=w=t=0;p.matrixAutoUpdate&&p.update(undefined,!0);ea.update(undefined,!1,p);E.multiply(p.projectionMatrix,p.matrixWorldInverse);L[0].set(E.n41-E.n11,E.n42-E.n12,E.n43-E.n13,E.n44-E.n14);L[1].set(E.n41+E.n11,E.n42+E.n12,E.n43+E.n13,E.n44+E.n14);L[2].set(E.n41+E.n21,E.n42+E.n22,E.n43+E.n23,E.n44+E.n24);L[3].set(E.n41-E.n21,E.n42-E.n22,
E.n43-E.n23,E.n44-E.n24);L[4].set(E.n41-E.n31,E.n42-E.n32,E.n43-E.n33,E.n44-E.n34);L[5].set(E.n41+E.n31,E.n42+E.n32,E.n43+E.n33,E.n44+E.n34);for(Z=0;Z<6;Z++){Da=L[Z];Da.divideScalar(Math.sqrt(Da.x*Da.x+Da.y*Da.y+Da.z*Da.z))}Da=this.projectObjects(ea,p,!0);ea=0;for(Z=Da.length;ea<Z;ea++){ra=Da[ea].object;if(ra.visible){Aa=ra.matrixWorld;La=ra.matrixRotationWorld;Ua=ra.materials;Ya=ra.overdraw;n=0;if(ra instanceof THREE.Mesh){$=ra.geometry;na=$.vertices;la=$.faces;$=$.faceVertexUvs;aa=0;for(pa=na.length;aa<
pa;aa++){g=b();g.positionWorld.copy(na[aa].position);Aa.multiplyVector3(g.positionWorld);g.positionScreen.copy(g.positionWorld);E.multiplyVector4(g.positionScreen);g.positionScreen.x/=g.positionScreen.w;g.positionScreen.y/=g.positionScreen.w;g.visible=g.positionScreen.z>oa&&g.positionScreen.z<V}na=0;for(aa=la.length;na<aa;na++){pa=la[na];if(pa instanceof THREE.Face3){sa=m[pa.a];ya=m[pa.b];va=m[pa.c];if(sa.visible&&ya.visible&&va.visible&&(ra.doubleSided||ra.flipSided!=(va.positionScreen.x-sa.positionScreen.x)*
(ya.positionScreen.y-sa.positionScreen.y)-(va.positionScreen.y-sa.positionScreen.y)*(ya.positionScreen.x-sa.positionScreen.x)<0)){Ha=u[t]=u[t]||new THREE.RenderableFace3;t++;o=Ha;o.v1.copy(sa);o.v2.copy(ya);o.v3.copy(va)}else continue}else if(pa instanceof THREE.Face4){sa=m[pa.a];ya=m[pa.b];va=m[pa.c];Ha=m[pa.d];if(sa.visible&&ya.visible&&va.visible&&Ha.visible&&(ra.doubleSided||ra.flipSided!=((Ha.positionScreen.x-sa.positionScreen.x)*(ya.positionScreen.y-sa.positionScreen.y)-(Ha.positionScreen.y-
sa.positionScreen.y)*(ya.positionScreen.x-sa.positionScreen.x)<0||(ya.positionScreen.x-va.positionScreen.x)*(Ha.positionScreen.y-va.positionScreen.y)-(ya.positionScreen.y-va.positionScreen.y)*(Ha.positionScreen.x-va.positionScreen.x)<0))){ca=v[w]=v[w]||new THREE.RenderableFace4;w++;o=ca;o.v1.copy(sa);o.v2.copy(ya);o.v3.copy(va);o.v4.copy(Ha)}else continue}o.normalWorld.copy(pa.normal);La.multiplyVector3(o.normalWorld);o.centroidWorld.copy(pa.centroid);Aa.multiplyVector3(o.centroidWorld);o.centroidScreen.copy(o.centroidWorld);
E.multiplyVector3(o.centroidScreen);va=pa.vertexNormals;sa=0;for(ya=va.length;sa<ya;sa++){Ha=o.vertexNormalsWorld[sa];Ha.copy(va[sa]);La.multiplyVector3(Ha)}sa=0;for(ya=$.length;sa<ya;sa++)if(ca=$[sa][na]){va=0;for(Ha=ca.length;va<Ha;va++)o.uvs[sa][va]=ca[va]}o.meshMaterials=Ua;o.faceMaterials=pa.materials;o.overdraw=Ya;o.z=o.centroidScreen.z;fa.push(o)}}else if(ra instanceof THREE.Line){O.multiply(E,Aa);na=ra.geometry.vertices;sa=b();sa.positionScreen.copy(na[0].position);O.multiplyVector4(sa.positionScreen);
aa=1;for(pa=na.length;aa<pa;aa++){sa=b();sa.positionScreen.copy(na[aa].position);O.multiplyVector4(sa.positionScreen);ya=m[n-2];H.copy(sa.positionScreen);N.copy(ya.positionScreen);if(c(H,N)){H.multiplyScalar(1/H.w);N.multiplyScalar(1/N.w);Aa=A[y]=A[y]||new THREE.RenderableLine;y++;x=Aa;x.v1.positionScreen.copy(H);x.v2.positionScreen.copy(N);x.z=Math.max(H.z,N.z);x.materials=ra.materials;fa.push(x)}}}else if(ra instanceof THREE.Particle){F.set(ra.matrixWorld.n14,ra.matrixWorld.n24,ra.matrixWorld.n34,
1);E.multiplyVector4(F);F.z/=F.w;if(F.z>0&&F.z<1){Aa=C[D]=C[D]||new THREE.RenderableParticle;D++;B=Aa;B.x=F.x/F.w;B.y=F.y/F.w;B.z=F.z;B.rotation=ra.rotation.z;B.scale.x=ra.scale.x*Math.abs(B.x-(F.x+p.projectionMatrix.n11)/(F.w+p.projectionMatrix.n14));B.scale.y=ra.scale.y*Math.abs(B.y-(F.y+p.projectionMatrix.n22)/(F.w+p.projectionMatrix.n24));B.materials=ra.materials;fa.push(B)}}}}ha&&fa.sort(e);return fa}};
THREE.DOMRenderer=function(){THREE.Renderer.call(this);var b=null,e=new THREE.Projector,c,d,f,h;this.domElement=document.createElement("div");this.setSize=function(g,n){c=g;d=n;f=c/2;h=d/2};this.render=function(g,n){var m,o,t,u,w,v,x,y;b=e.projectScene(g,n);m=0;for(o=b.length;m<o;m++){w=b[m];if(w instanceof THREE.RenderableParticle){x=w.x*f+f;y=w.y*h+h;t=0;for(u=w.material.length;t<u;t++){v=w.material[t];if(v instanceof THREE.ParticleDOMMaterial){v=v.domElement;v.style.left=x+"px";v.style.top=y+"px"}}}}}};
THREE.CanvasRenderer=function(){function b(xa){if(A!=xa)v.globalAlpha=A=xa}function e(xa){if(B!=xa){switch(xa){case THREE.NormalBlending:v.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:v.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:v.globalCompositeOperation="darker"}B=xa}}function c(xa){if(D!=xa.hex){D=xa.hex;v.strokeStyle="#"+f(D.toString(16))}}function d(xa){if(C!=xa.hex){C=xa.hex;v.fillStyle="#"+f(C.toString(16))}}function f(xa){for(;xa.length<
6;)xa="0"+xa;return xa}var h=this,g=null,n=new THREE.Projector,m=document.createElement("canvas"),o,t,u,w,v=m.getContext("2d"),x=new THREE.Color(0),y=0,A=1,B=0,D=null,C=null,G=null,F=null,E=null,O,L,H,N,ea=new THREE.RenderableVertex,p=new THREE.RenderableVertex,ha,fa,oa,V,Z,aa,pa,na,sa,ya,va,Ha,Da=new THREE.Color(0),ra=new THREE.Color(0),Aa=new THREE.Color(0),La=new THREE.Color(0),Ua=new THREE.Color(0),Ya,$,la,ca,da,Oa,cb,z,P,J,K=new THREE.Rectangle,M=new THREE.Rectangle,T=new THREE.Rectangle,W=!1,
R=new THREE.Color,Y=new THREE.Color,S=new THREE.Color,X=new THREE.Color,U=new THREE.Vector3,ma,ka,Ea,Ja,Ga,Na,Za=16;ma=document.createElement("canvas");ma.width=ma.height=2;ka=ma.getContext("2d");ka.fillStyle="rgba(0,0,0,1)";ka.fillRect(0,0,2,2);Ea=ka.getImageData(0,0,2,2);Ja=Ea.data;Ga=document.createElement("canvas");Ga.width=Ga.height=Za;Na=Ga.getContext("2d");Na.translate(-Za/2,-Za/2);Na.scale(Za,Za);Za--;this.domElement=m;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,
faces:0};this.setSize=function(xa,Ca){o=xa;t=Ca;u=o/2;w=t/2;m.width=o;m.height=t;K.set(-u,-w,u,w);A=1;B=0;E=F=G=C=D=null};this.setClearColor=function(xa,Ca){x=xa;y=Ca};this.setClearColorHex=function(xa,Ca){x.setHex(xa);y=Ca};this.clear=function(){v.setTransform(1,0,0,-1,u,w);if(!M.isEmpty()){M.inflate(1);M.minSelf(K);if(x.hex==0&&y==0)v.clearRect(M.getX(),M.getY(),M.getWidth(),M.getHeight());else{e(THREE.NormalBlending);b(1);v.fillStyle="rgba("+Math.floor(x.r*255)+","+Math.floor(x.g*255)+","+Math.floor(x.b*
255)+","+y+")";v.fillRect(M.getX(),M.getY(),M.getWidth(),M.getHeight())}M.empty()}};this.render=function(xa,Ca){function Ia(ga){var wa,ta,qa,Ba=ga.lights;Y.setRGB(0,0,0);S.setRGB(0,0,0);X.setRGB(0,0,0);ga=0;for(wa=Ba.length;ga<wa;ga++){ta=Ba[ga];qa=ta.color;if(ta instanceof THREE.AmbientLight){Y.r+=qa.r;Y.g+=qa.g;Y.b+=qa.b}else if(ta instanceof THREE.DirectionalLight){S.r+=qa.r;S.g+=qa.g;S.b+=qa.b}else if(ta instanceof THREE.PointLight){X.r+=qa.r;X.g+=qa.g;X.b+=qa.b}}}function Ra(ga,wa,ta,qa){var Ba,
Pa,za,ia,Ma=ga.lights;ga=0;for(Ba=Ma.length;ga<Ba;ga++){Pa=Ma[ga];za=Pa.color;if(Pa instanceof THREE.DirectionalLight){ia=ta.dot(Pa.position);if(!(ia<=0)){ia*=Pa.intensity;qa.r+=za.r*ia;qa.g+=za.g*ia;qa.b+=za.b*ia}}else if(Pa instanceof THREE.PointLight){ia=ta.dot(U.sub(Pa.position,wa).normalize());if(!(ia<=0)){ia*=Pa.distance==0?1:1-Math.min(wa.distanceTo(Pa.position)/Pa.distance,1);if(ia!=0){ia*=Pa.intensity;qa.r+=za.r*ia;qa.g+=za.g*ia;qa.b+=za.b*ia}}}}}function Q(ga,wa,ta){b(ta.opacity);e(ta.blending);
var qa,Ba,Pa,za,ia,Ma;if(ta instanceof THREE.ParticleBasicMaterial){if(ta.map){za=ta.map.image;ia=za.width>>1;Ma=za.height>>1;ta=wa.scale.x*u;Pa=wa.scale.y*w;qa=ta*ia;Ba=Pa*Ma;T.set(ga.x-qa,ga.y-Ba,ga.x+qa,ga.y+Ba);if(K.instersects(T)){v.save();v.translate(ga.x,ga.y);v.rotate(-wa.rotation);v.scale(ta,-Pa);v.translate(-ia,-Ma);v.drawImage(za,0,0);v.restore()}}}else if(ta instanceof THREE.ParticleCanvasMaterial){qa=wa.scale.x*u;Ba=wa.scale.y*w;T.set(ga.x-qa,ga.y-Ba,ga.x+qa,ga.y+Ba);if(K.instersects(T)){c(ta.color);
d(ta.color);v.save();v.translate(ga.x,ga.y);v.rotate(-wa.rotation);v.scale(qa,Ba);ta.program(v);v.restore()}}}function ua(ga,wa,ta,qa){b(qa.opacity);e(qa.blending);v.beginPath();v.moveTo(ga.positionScreen.x,ga.positionScreen.y);v.lineTo(wa.positionScreen.x,wa.positionScreen.y);v.closePath();if(qa instanceof THREE.LineBasicMaterial){ga=qa.linewidth;if(G!=ga)v.lineWidth=G=ga;ga=qa.linecap;if(F!=ga)v.lineCap=F=ga;ga=qa.linejoin;if(E!=ga)v.lineJoin=E=ga;c(qa.color);v.stroke();T.inflate(qa.linewidth*2)}}
function I(ga,wa,ta,qa,Ba,Pa,za,ia,Ma){h.data.vertices+=3;h.data.faces++;b(ia.opacity);e(ia.blending);ha=ga.positionScreen.x;fa=ga.positionScreen.y;oa=wa.positionScreen.x;V=wa.positionScreen.y;Z=ta.positionScreen.x;aa=ta.positionScreen.y;ib(ha,fa,oa,V,Z,aa);if(ia instanceof THREE.MeshBasicMaterial)if(ia.map){if(ia.map.mapping instanceof THREE.UVMapping){ca=za.uvs[0];eb(ha,fa,oa,V,Z,aa,ia.map.image,ca[qa].u,ca[qa].v,ca[Ba].u,ca[Ba].v,ca[Pa].u,ca[Pa].v)}}else if(ia.envMap){if(ia.envMap.mapping instanceof
THREE.SphericalReflectionMapping){ga=Ca.matrixWorldInverse;U.copy(za.vertexNormalsWorld[0]);da=(U.x*ga.n11+U.y*ga.n12+U.z*ga.n13)*0.5+0.5;Oa=-(U.x*ga.n21+U.y*ga.n22+U.z*ga.n23)*0.5+0.5;U.copy(za.vertexNormalsWorld[1]);cb=(U.x*ga.n11+U.y*ga.n12+U.z*ga.n13)*0.5+0.5;z=-(U.x*ga.n21+U.y*ga.n22+U.z*ga.n23)*0.5+0.5;U.copy(za.vertexNormalsWorld[2]);P=(U.x*ga.n11+U.y*ga.n12+U.z*ga.n13)*0.5+0.5;J=-(U.x*ga.n21+U.y*ga.n22+U.z*ga.n23)*0.5+0.5;eb(ha,fa,oa,V,Z,aa,ia.envMap.image,da,Oa,cb,z,P,J)}}else ia.wireframe?
Va(ia.color,ia.wireframeLinewidth,ia.wireframeLinecap,ia.wireframeLinejoin):hb(ia.color);else if(ia instanceof THREE.MeshLambertMaterial){if(ia.map&&!ia.wireframe){if(ia.map.mapping instanceof THREE.UVMapping){ca=za.uvs[0];eb(ha,fa,oa,V,Z,aa,ia.map.image,ca[qa].u,ca[qa].v,ca[Ba].u,ca[Ba].v,ca[Pa].u,ca[Pa].v)}e(THREE.SubtractiveBlending)}if(W)if(!ia.wireframe&&ia.shading==THREE.SmoothShading&&za.vertexNormalsWorld.length==3){ra.r=Aa.r=La.r=Y.r;ra.g=Aa.g=La.g=Y.g;ra.b=Aa.b=La.b=Y.b;Ra(Ma,za.v1.positionWorld,
za.vertexNormalsWorld[0],ra);Ra(Ma,za.v2.positionWorld,za.vertexNormalsWorld[1],Aa);Ra(Ma,za.v3.positionWorld,za.vertexNormalsWorld[2],La);Ua.r=(Aa.r+La.r)*0.5;Ua.g=(Aa.g+La.g)*0.5;Ua.b=(Aa.b+La.b)*0.5;la=bb(ra,Aa,La,Ua);eb(ha,fa,oa,V,Z,aa,la,0,0,1,0,0,1)}else{R.r=Y.r;R.g=Y.g;R.b=Y.b;Ra(Ma,za.centroidWorld,za.normalWorld,R);Da.r=Math.max(0,Math.min(ia.color.r*R.r,1));Da.g=Math.max(0,Math.min(ia.color.g*R.g,1));Da.b=Math.max(0,Math.min(ia.color.b*R.b,1));Da.updateHex();ia.wireframe?Va(Da,ia.wireframeLinewidth,
ia.wireframeLinecap,ia.wireframeLinejoin):hb(Da)}else ia.wireframe?Va(ia.color,ia.wireframeLinewidth,ia.wireframeLinecap,ia.wireframeLinejoin):hb(ia.color)}else if(ia instanceof THREE.MeshDepthMaterial){Ya=Ca.near;$=Ca.far;ra.r=ra.g=ra.b=1-ab(ga.positionScreen.z,Ya,$);Aa.r=Aa.g=Aa.b=1-ab(wa.positionScreen.z,Ya,$);La.r=La.g=La.b=1-ab(ta.positionScreen.z,Ya,$);Ua.r=(Aa.r+La.r)*0.5;Ua.g=(Aa.g+La.g)*0.5;Ua.b=(Aa.b+La.b)*0.5;la=bb(ra,Aa,La,Ua);eb(ha,fa,oa,V,Z,aa,la,0,0,1,0,0,1)}else if(ia instanceof THREE.MeshNormalMaterial){Da.r=
Qa(za.normalWorld.x);Da.g=Qa(za.normalWorld.y);Da.b=Qa(za.normalWorld.z);Da.updateHex();ia.wireframe?Va(Da,ia.wireframeLinewidth,ia.wireframeLinecap,ia.wireframeLinejoin):hb(Da)}}function fb(ga,wa,ta,qa,Ba,Pa,za,ia,Ma){h.data.vertices+=4;h.data.faces++;b(ia.opacity);e(ia.blending);if(ia.map||ia.envMap){I(ga,wa,qa,0,1,3,za,ia,Ma);I(Ba,ta,Pa,1,2,3,za,ia,Ma)}else{ha=ga.positionScreen.x;fa=ga.positionScreen.y;oa=wa.positionScreen.x;V=wa.positionScreen.y;Z=ta.positionScreen.x;aa=ta.positionScreen.y;pa=
qa.positionScreen.x;na=qa.positionScreen.y;sa=Ba.positionScreen.x;ya=Ba.positionScreen.y;va=Pa.positionScreen.x;Ha=Pa.positionScreen.y;if(ia instanceof THREE.MeshBasicMaterial){Wa(ha,fa,oa,V,Z,aa,pa,na);ia.wireframe?Va(ia.color,ia.wireframeLinewidth,ia.wireframeLinecap,ia.wireframeLinejoin):hb(ia.color)}else if(ia instanceof THREE.MeshLambertMaterial)if(W)if(!ia.wireframe&&ia.shading==THREE.SmoothShading&&za.vertexNormalsWorld.length==4){ra.r=Aa.r=La.r=Ua.r=Y.r;ra.g=Aa.g=La.g=Ua.g=Y.g;ra.b=Aa.b=La.b=
Ua.b=Y.b;Ra(Ma,za.v1.positionWorld,za.vertexNormalsWorld[0],ra);Ra(Ma,za.v2.positionWorld,za.vertexNormalsWorld[1],Aa);Ra(Ma,za.v4.positionWorld,za.vertexNormalsWorld[3],La);Ra(Ma,za.v3.positionWorld,za.vertexNormalsWorld[2],Ua);la=bb(ra,Aa,La,Ua);ib(ha,fa,oa,V,pa,na);eb(ha,fa,oa,V,pa,na,la,0,0,1,0,0,1);ib(sa,ya,Z,aa,va,Ha);eb(sa,ya,Z,aa,va,Ha,la,1,0,1,1,0,1)}else{R.r=Y.r;R.g=Y.g;R.b=Y.b;Ra(Ma,za.centroidWorld,za.normalWorld,R);Da.r=Math.max(0,Math.min(ia.color.r*R.r,1));Da.g=Math.max(0,Math.min(ia.color.g*
R.g,1));Da.b=Math.max(0,Math.min(ia.color.b*R.b,1));Da.updateHex();Wa(ha,fa,oa,V,Z,aa,pa,na);ia.wireframe?Va(Da,ia.wireframeLinewidth,ia.wireframeLinecap,ia.wireframeLinejoin):hb(Da)}else{Wa(ha,fa,oa,V,Z,aa,pa,na);ia.wireframe?Va(ia.color,ia.wireframeLinewidth,ia.wireframeLinecap,ia.wireframeLinejoin):hb(ia.color)}else if(ia instanceof THREE.MeshNormalMaterial){Da.r=Qa(za.normalWorld.x);Da.g=Qa(za.normalWorld.y);Da.b=Qa(za.normalWorld.z);Da.updateHex();Wa(ha,fa,oa,V,Z,aa,pa,na);ia.wireframe?Va(Da,
ia.wireframeLinewidth,ia.wireframeLinecap,ia.wireframeLinejoin):hb(Da)}else if(ia instanceof THREE.MeshDepthMaterial){Ya=Ca.near;$=Ca.far;ra.r=ra.g=ra.b=1-ab(ga.positionScreen.z,Ya,$);Aa.r=Aa.g=Aa.b=1-ab(wa.positionScreen.z,Ya,$);La.r=La.g=La.b=1-ab(qa.positionScreen.z,Ya,$);Ua.r=Ua.g=Ua.b=1-ab(ta.positionScreen.z,Ya,$);la=bb(ra,Aa,La,Ua);ib(ha,fa,oa,V,pa,na);eb(ha,fa,oa,V,pa,na,la,0,0,1,0,0,1);ib(sa,ya,Z,aa,va,Ha);eb(sa,ya,Z,aa,va,Ha,la,1,0,1,1,0,1)}}}function ib(ga,wa,ta,qa,Ba,Pa){v.beginPath();
v.moveTo(ga,wa);v.lineTo(ta,qa);v.lineTo(Ba,Pa);v.lineTo(ga,wa);v.closePath()}function Wa(ga,wa,ta,qa,Ba,Pa,za,ia){v.beginPath();v.moveTo(ga,wa);v.lineTo(ta,qa);v.lineTo(Ba,Pa);v.lineTo(za,ia);v.lineTo(ga,wa);v.closePath()}function Va(ga,wa,ta,qa){if(G!=wa)v.lineWidth=G=wa;if(F!=ta)v.lineCap=F=ta;if(E!=qa)v.lineJoin=E=qa;c(ga);v.stroke();T.inflate(wa*2)}function hb(ga){d(ga);v.fill()}function eb(ga,wa,ta,qa,Ba,Pa,za,ia,Ma,mb,Ta,kb,ob){var gb,lb;gb=za.width-1;lb=za.height-1;ia*=gb;Ma*=lb;mb*=gb;Ta*=
lb;kb*=gb;ob*=lb;ta-=ga;qa-=wa;Ba-=ga;Pa-=wa;mb-=ia;Ta-=Ma;kb-=ia;ob-=Ma;gb=mb*ob-kb*Ta;if(gb!=0){lb=1/gb;gb=(ob*ta-Ta*Ba)*lb;Ta=(ob*qa-Ta*Pa)*lb;ta=(mb*Ba-kb*ta)*lb;qa=(mb*Pa-kb*qa)*lb;ga=ga-gb*ia-ta*Ma;wa=wa-Ta*ia-qa*Ma;v.save();v.transform(gb,Ta,ta,qa,ga,wa);v.clip();v.drawImage(za,0,0);v.restore()}}function bb(ga,wa,ta,qa){var Ba=~~(ga.r*255),Pa=~~(ga.g*255);ga=~~(ga.b*255);var za=~~(wa.r*255),ia=~~(wa.g*255);wa=~~(wa.b*255);var Ma=~~(ta.r*255),mb=~~(ta.g*255);ta=~~(ta.b*255);var Ta=~~(qa.r*255),
kb=~~(qa.g*255);qa=~~(qa.b*255);Ja[0]=Ba<0?0:Ba>255?255:Ba;Ja[1]=Pa<0?0:Pa>255?255:Pa;Ja[2]=ga<0?0:ga>255?255:ga;Ja[4]=za<0?0:za>255?255:za;Ja[5]=ia<0?0:ia>255?255:ia;Ja[6]=wa<0?0:wa>255?255:wa;Ja[8]=Ma<0?0:Ma>255?255:Ma;Ja[9]=mb<0?0:mb>255?255:mb;Ja[10]=ta<0?0:ta>255?255:ta;Ja[12]=Ta<0?0:Ta>255?255:Ta;Ja[13]=kb<0?0:kb>255?255:kb;Ja[14]=qa<0?0:qa>255?255:qa;ka.putImageData(Ea,0,0);Na.drawImage(ma,0,0);return Ga}function ab(ga,wa,ta){ga=(ga-wa)/(ta-wa);return ga*ga*(3-2*ga)}function Qa(ga){ga=(ga+
1)*0.5;return ga<0?0:ga>1?1:ga}function $a(ga,wa){var ta=wa.x-ga.x,qa=wa.y-ga.y,Ba=1/Math.sqrt(ta*ta+qa*qa);ta*=Ba;qa*=Ba;wa.x+=ta;wa.y+=qa;ga.x-=ta;ga.y-=qa}var Xa,ja,Fa,Sa,jb,nb,db,Ka;this.autoClear?this.clear():v.setTransform(1,0,0,-1,u,w);h.data.vertices=0;h.data.faces=0;g=n.projectScene(xa,Ca,this.sortElements);(W=xa.lights.length>0)&&Ia(xa);Xa=0;for(ja=g.length;Xa<ja;Xa++){Fa=g[Xa];T.empty();if(Fa instanceof THREE.RenderableParticle){O=Fa;O.x*=u;O.y*=w;Sa=0;for(jb=Fa.materials.length;Sa<jb;){Ka=
Fa.materials[Sa++];Ka.opacity!=0&&Q(O,Fa,Ka,xa)}}else if(Fa instanceof THREE.RenderableLine){O=Fa.v1;L=Fa.v2;O.positionScreen.x*=u;O.positionScreen.y*=w;L.positionScreen.x*=u;L.positionScreen.y*=w;T.addPoint(O.positionScreen.x,O.positionScreen.y);T.addPoint(L.positionScreen.x,L.positionScreen.y);if(K.instersects(T)){Sa=0;for(jb=Fa.materials.length;Sa<jb;){Ka=Fa.materials[Sa++];Ka.opacity!=0&&ua(O,L,Fa,Ka,xa)}}}else if(Fa instanceof THREE.RenderableFace3){O=Fa.v1;L=Fa.v2;H=Fa.v3;O.positionScreen.x*=
u;O.positionScreen.y*=w;L.positionScreen.x*=u;L.positionScreen.y*=w;H.positionScreen.x*=u;H.positionScreen.y*=w;if(Fa.overdraw){$a(O.positionScreen,L.positionScreen);$a(L.positionScreen,H.positionScreen);$a(H.positionScreen,O.positionScreen)}T.add3Points(O.positionScreen.x,O.positionScreen.y,L.positionScreen.x,L.positionScreen.y,H.positionScreen.x,H.positionScreen.y);if(K.instersects(T)){Sa=0;for(jb=Fa.meshMaterials.length;Sa<jb;){Ka=Fa.meshMaterials[Sa++];if(Ka instanceof THREE.MeshFaceMaterial){nb=
0;for(db=Fa.faceMaterials.length;nb<db;)(Ka=Fa.faceMaterials[nb++])&&Ka.opacity!=0&&I(O,L,H,0,1,2,Fa,Ka,xa)}else Ka.opacity!=0&&I(O,L,H,0,1,2,Fa,Ka,xa)}}}else if(Fa instanceof THREE.RenderableFace4){O=Fa.v1;L=Fa.v2;H=Fa.v3;N=Fa.v4;O.positionScreen.x*=u;O.positionScreen.y*=w;L.positionScreen.x*=u;L.positionScreen.y*=w;H.positionScreen.x*=u;H.positionScreen.y*=w;N.positionScreen.x*=u;N.positionScreen.y*=w;ea.positionScreen.copy(L.positionScreen);p.positionScreen.copy(N.positionScreen);if(Fa.overdraw){$a(O.positionScreen,
L.positionScreen);$a(L.positionScreen,N.positionScreen);$a(N.positionScreen,O.positionScreen);$a(H.positionScreen,ea.positionScreen);$a(H.positionScreen,p.positionScreen)}T.addPoint(O.positionScreen.x,O.positionScreen.y);T.addPoint(L.positionScreen.x,L.positionScreen.y);T.addPoint(H.positionScreen.x,H.positionScreen.y);T.addPoint(N.positionScreen.x,N.positionScreen.y);if(K.instersects(T)){Sa=0;for(jb=Fa.meshMaterials.length;Sa<jb;){Ka=Fa.meshMaterials[Sa++];if(Ka instanceof THREE.MeshFaceMaterial){nb=
0;for(db=Fa.faceMaterials.length;nb<db;)(Ka=Fa.faceMaterials[nb++])&&Ka.opacity!=0&&fb(O,L,H,N,ea,p,Fa,Ka,xa)}else Ka.opacity!=0&&fb(O,L,H,N,ea,p,Fa,Ka,xa)}}}M.addRectangle(T)}v.setTransform(1,0,0,1,0,0)}};
THREE.SVGRenderer=function(){function b(aa,pa,na){var sa,ya,va,Ha;sa=0;for(ya=aa.lights.length;sa<ya;sa++){va=aa.lights[sa];if(va instanceof THREE.DirectionalLight){Ha=pa.normalWorld.dot(va.position)*va.intensity;if(Ha>0){na.r+=va.color.r*Ha;na.g+=va.color.g*Ha;na.b+=va.color.b*Ha}}else if(va instanceof THREE.PointLight){ea.sub(va.position,pa.centroidWorld);ea.normalize();Ha=pa.normalWorld.dot(ea)*va.intensity;if(Ha>0){na.r+=va.color.r*Ha;na.g+=va.color.g*Ha;na.b+=va.color.b*Ha}}}}function e(aa,pa,
na,sa,ya,va){g.data.vertices+=3;g.data.faces++;fa=d(oa++);fa.setAttribute("d","M "+aa.positionScreen.x+" "+aa.positionScreen.y+" L "+pa.positionScreen.x+" "+pa.positionScreen.y+" L "+na.positionScreen.x+","+na.positionScreen.y+"z");if(ya instanceof THREE.MeshBasicMaterial)F.hex=ya.color.hex;else if(ya instanceof THREE.MeshLambertMaterial)if(G){E.r=O.r;E.g=O.g;E.b=O.b;b(va,sa,E);F.r=Math.max(0,Math.min(ya.color.r*E.r,1));F.g=Math.max(0,Math.min(ya.color.g*E.g,1));F.b=Math.max(0,Math.min(ya.color.b*
E.b,1));F.updateHex()}else F.hex=ya.color.hex;else if(ya instanceof THREE.MeshDepthMaterial){N=1-ya.__2near/(ya.__farPlusNear-sa.z*ya.__farMinusNear);F.setRGB(N,N,N)}else ya instanceof THREE.MeshNormalMaterial&&F.setRGB(f(sa.normalWorld.x),f(sa.normalWorld.y),f(sa.normalWorld.z));ya.wireframe?fa.setAttribute("style","fill: none; stroke: #"+h(F.hex.toString(16))+"; stroke-width: "+ya.wireframeLinewidth+"; stroke-opacity: "+ya.opacity+"; stroke-linecap: "+ya.wireframeLinecap+"; stroke-linejoin: "+ya.wireframeLinejoin):
fa.setAttribute("style","fill: #"+h(F.hex.toString(16))+"; fill-opacity: "+ya.opacity);o.appendChild(fa)}function c(aa,pa,na,sa,ya,va,Ha){g.data.vertices+=4;g.data.faces++;fa=d(oa++);fa.setAttribute("d","M "+aa.positionScreen.x+" "+aa.positionScreen.y+" L "+pa.positionScreen.x+" "+pa.positionScreen.y+" L "+na.positionScreen.x+","+na.positionScreen.y+" L "+sa.positionScreen.x+","+sa.positionScreen.y+"z");if(va instanceof THREE.MeshBasicMaterial)F.hex=va.color.hex;else if(va instanceof THREE.MeshLambertMaterial)if(G){E.r=
O.r;E.g=O.g;E.b=O.b;b(Ha,ya,E);F.r=Math.max(0,Math.min(va.color.r*E.r,1));F.g=Math.max(0,Math.min(va.color.g*E.g,1));F.b=Math.max(0,Math.min(va.color.b*E.b,1));F.updateHex()}else F.hex=va.color.hex;else if(va instanceof THREE.MeshDepthMaterial){N=1-va.__2near/(va.__farPlusNear-ya.z*va.__farMinusNear);F.setRGB(N,N,N)}else va instanceof THREE.MeshNormalMaterial&&F.setRGB(f(ya.normalWorld.x),f(ya.normalWorld.y),f(ya.normalWorld.z));va.wireframe?fa.setAttribute("style","fill: none; stroke: #"+h(F.hex.toString(16))+
"; stroke-width: "+va.wireframeLinewidth+"; stroke-opacity: "+va.opacity+"; stroke-linecap: "+va.wireframeLinecap+"; stroke-linejoin: "+va.wireframeLinejoin):fa.setAttribute("style","fill: #"+h(F.hex.toString(16))+"; fill-opacity: "+va.opacity);o.appendChild(fa)}function d(aa){if(p[aa]==null){p[aa]=document.createElementNS("http://www.w3.org/2000/svg","path");Z==0&&p[aa].setAttribute("shape-rendering","crispEdges")}return p[aa]}function f(aa){aa=(aa+1)*0.5;return aa<0?0:aa>1?1:aa}function h(aa){for(;aa.length<
6;)aa="0"+aa;return aa}var g=this,n=null,m=new THREE.Projector,o=document.createElementNS("http://www.w3.org/2000/svg","svg"),t,u,w,v,x,y,A,B,D=new THREE.Rectangle,C=new THREE.Rectangle,G=!1,F=new THREE.Color(16777215),E=new THREE.Color(16777215),O=new THREE.Color(0),L=new THREE.Color(0),H=new THREE.Color(0),N,ea=new THREE.Vector3,p=[],ha=[],fa,oa,V,Z=1;this.domElement=o;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,faces:0};this.setQuality=function(aa){switch(aa){case "high":Z=
1;break;case "low":Z=0}};this.setSize=function(aa,pa){t=aa;u=pa;w=t/2;v=u/2;o.setAttribute("viewBox",-w+" "+-v+" "+t+" "+u);o.setAttribute("width",t);o.setAttribute("height",u);D.set(-w,-v,w,v)};this.clear=function(){for(;o.childNodes.length>0;)o.removeChild(o.childNodes[0])};this.render=function(aa,pa){var na,sa,ya,va,Ha,Da,ra,Aa;this.autoClear&&this.clear();g.data.vertices=0;g.data.faces=0;n=m.projectScene(aa,pa,this.sortElements);V=oa=0;if(G=aa.lights.length>0){ra=aa.lights;O.setRGB(0,0,0);L.setRGB(0,
0,0);H.setRGB(0,0,0);na=0;for(sa=ra.length;na<sa;na++){ya=ra[na];va=ya.color;if(ya instanceof THREE.AmbientLight){O.r+=va.r;O.g+=va.g;O.b+=va.b}else if(ya instanceof THREE.DirectionalLight){L.r+=va.r;L.g+=va.g;L.b+=va.b}else if(ya instanceof THREE.PointLight){H.r+=va.r;H.g+=va.g;H.b+=va.b}}}na=0;for(sa=n.length;na<sa;na++){ra=n[na];C.empty();if(ra instanceof THREE.RenderableParticle){x=ra;x.x*=w;x.y*=-v;ya=0;for(va=ra.materials.length;ya<va;)ya++}else if(ra instanceof THREE.RenderableLine){x=ra.v1;
y=ra.v2;x.positionScreen.x*=w;x.positionScreen.y*=-v;y.positionScreen.x*=w;y.positionScreen.y*=-v;C.addPoint(x.positionScreen.x,x.positionScreen.y);C.addPoint(y.positionScreen.x,y.positionScreen.y);if(D.instersects(C)){ya=0;for(va=ra.materials.length;ya<va;)if((Aa=ra.materials[ya++])&&Aa.opacity!=0){Ha=x;Da=y;var La=V++;if(ha[La]==null){ha[La]=document.createElementNS("http://www.w3.org/2000/svg","line");Z==0&&ha[La].setAttribute("shape-rendering","crispEdges")}fa=ha[La];fa.setAttribute("x1",Ha.positionScreen.x);
fa.setAttribute("y1",Ha.positionScreen.y);fa.setAttribute("x2",Da.positionScreen.x);fa.setAttribute("y2",Da.positionScreen.y);if(Aa instanceof THREE.LineBasicMaterial){fa.setAttribute("style","fill: none; stroke: ##"+h(Aa.color.hex.toString(16))+"; stroke-width: "+Aa.linewidth+"; stroke-opacity: "+Aa.opacity+"; stroke-linecap: "+Aa.linecap+"; stroke-linejoin: "+Aa.linejoin);o.appendChild(fa)}}}}else if(ra instanceof THREE.RenderableFace3){x=ra.v1;y=ra.v2;A=ra.v3;x.positionScreen.x*=w;x.positionScreen.y*=
-v;y.positionScreen.x*=w;y.positionScreen.y*=-v;A.positionScreen.x*=w;A.positionScreen.y*=-v;C.addPoint(x.positionScreen.x,x.positionScreen.y);C.addPoint(y.positionScreen.x,y.positionScreen.y);C.addPoint(A.positionScreen.x,A.positionScreen.y);if(D.instersects(C)){ya=0;for(va=ra.meshMaterials.length;ya<va;){Aa=ra.meshMaterials[ya++];if(Aa instanceof THREE.MeshFaceMaterial){Ha=0;for(Da=ra.faceMaterials.length;Ha<Da;)(Aa=ra.faceMaterials[Ha++])&&Aa.opacity!=0&&e(x,y,A,ra,Aa,aa)}else Aa&&Aa.opacity!=
0&&e(x,y,A,ra,Aa,aa)}}}else if(ra instanceof THREE.RenderableFace4){x=ra.v1;y=ra.v2;A=ra.v3;B=ra.v4;x.positionScreen.x*=w;x.positionScreen.y*=-v;y.positionScreen.x*=w;y.positionScreen.y*=-v;A.positionScreen.x*=w;A.positionScreen.y*=-v;B.positionScreen.x*=w;B.positionScreen.y*=-v;C.addPoint(x.positionScreen.x,x.positionScreen.y);C.addPoint(y.positionScreen.x,y.positionScreen.y);C.addPoint(A.positionScreen.x,A.positionScreen.y);C.addPoint(B.positionScreen.x,B.positionScreen.y);if(D.instersects(C)){ya=
0;for(va=ra.meshMaterials.length;ya<va;){Aa=ra.meshMaterials[ya++];if(Aa instanceof THREE.MeshFaceMaterial){Ha=0;for(Da=ra.faceMaterials.length;Ha<Da;)(Aa=ra.faceMaterials[Ha++])&&Aa.opacity!=0&&c(x,y,A,B,ra,Aa,aa)}else Aa&&Aa.opacity!=0&&c(x,y,A,B,ra,Aa,aa)}}}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",
envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",
map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var e,c,d,f={};for(e=0;e<b.length;e++){d=this.clone(b[e]);for(c in d)f[c]=d[c]}return f},clone:function(b){var e,c,d,f={};for(e in b){f[e]={};for(c in b[e]){d=b[e][c];f[e][c]=d instanceof THREE.Color||d instanceof THREE.Vector3||d instanceof THREE.Texture?d.clone():d}}return f}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function e(z,P,J){var K,M,T,W=z.vertices,R=W.length,Y=z.colors,S=Y.length,X=z.__vertexArray,U=z.__colorArray,ma=z.__sortArray,ka=z.__dirtyVertices,Ea=z.__dirtyColors;if(J.sortParticles){Aa.multiplySelf(J.matrixWorld);for(K=0;K<R;K++){M=W[K].position;Ya.copy(M);Aa.multiplyVector3(Ya);ma[K]=[Ya.z,K]}ma.sort(function(Ja,Ga){return Ga[0]-Ja[0]});for(K=0;K<R;K++){M=W[ma[K][1]].position;T=K*3;X[T]=M.x;X[T+1]=M.y;X[T+2]=M.z}for(K=0;K<S;K++){T=K*3;color=Y[ma[K][1]];U[T]=color.r;
U[T+1]=color.g;U[T+2]=color.b}}else{if(ka)for(K=0;K<R;K++){M=W[K].position;T=K*3;X[T]=M.x;X[T+1]=M.y;X[T+2]=M.z}if(Ea)for(K=0;K<S;K++){color=Y[K];T=K*3;U[T]=color.r;U[T+1]=color.g;U[T+2]=color.b}}if(ka||J.sortParticles){p.bindBuffer(p.ARRAY_BUFFER,z.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,X,P)}if(Ea||J.sortParticles){p.bindBuffer(p.ARRAY_BUFFER,z.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,U,P)}}function c(z,P,J,K,M){K.program||ea.initMaterial(K,P,J,M);var T=K.program,W=T.uniforms,R=
K.uniforms;if(T!=oa){p.useProgram(T);oa=T}p.uniformMatrix4fv(W.projectionMatrix,!1,La);if(J&&(K instanceof THREE.MeshBasicMaterial||K instanceof THREE.MeshLambertMaterial||K instanceof THREE.MeshPhongMaterial||K instanceof THREE.LineBasicMaterial||K instanceof THREE.ParticleBasicMaterial||K.fog)){R.fogColor.value=J.color;if(J instanceof THREE.Fog){R.fogNear.value=J.near;R.fogFar.value=J.far}else if(J instanceof THREE.FogExp2)R.fogDensity.value=J.density}if(K instanceof THREE.MeshPhongMaterial||K instanceof
THREE.MeshLambertMaterial||K.lights){var Y,S,X=0,U=0,ma=0,ka,Ea,Ja,Ga,Na=$,Za=Na.directional.colors,xa=Na.directional.positions,Ca=Na.point.colors,Ia=Na.point.positions,Ra=Na.point.distances,Q=0,ua=0;J=0;for(Y=P.length;J<Y;J++){S=P[J];ka=S.color;Ea=S.position;Ja=S.intensity;Ga=S.distance;if(S instanceof THREE.AmbientLight){X+=ka.r;U+=ka.g;ma+=ka.b}else if(S instanceof THREE.DirectionalLight){Ga=Q*3;Za[Ga]=ka.r*Ja;Za[Ga+1]=ka.g*Ja;Za[Ga+2]=ka.b*Ja;xa[Ga]=Ea.x;xa[Ga+1]=Ea.y;xa[Ga+2]=Ea.z;Q+=1}else if(S instanceof
THREE.PointLight){S=ua*3;Ca[S]=ka.r*Ja;Ca[S+1]=ka.g*Ja;Ca[S+2]=ka.b*Ja;Ia[S]=Ea.x;Ia[S+1]=Ea.y;Ia[S+2]=Ea.z;Ra[ua]=Ga;ua+=1}}for(J=Q*3;J<Za.length;J++)Za[J]=0;for(J=ua*3;J<Ca.length;J++)Ca[J]=0;Na.point.length=ua;Na.directional.length=Q;Na.ambient[0]=X;Na.ambient[1]=U;Na.ambient[2]=ma;J=$;R.enableLighting.value=J.directional.length+J.point.length;R.ambientLightColor.value=J.ambient;R.directionalLightColor.value=J.directional.colors;R.directionalLightDirection.value=J.directional.positions;R.pointLightColor.value=
J.point.colors;R.pointLightPosition.value=J.point.positions;R.pointLightDistance.value=J.point.distances}if(K instanceof THREE.MeshBasicMaterial||K instanceof THREE.MeshLambertMaterial||K instanceof THREE.MeshPhongMaterial){R.diffuse.value=K.color;R.opacity.value=K.opacity;R.map.texture=K.map;R.lightMap.texture=K.lightMap;R.envMap.texture=K.envMap;R.reflectivity.value=K.reflectivity;R.refractionRatio.value=K.refractionRatio;R.combine.value=K.combine;R.useRefract.value=K.envMap&&K.envMap.mapping instanceof
THREE.CubeRefractionMapping}if(K instanceof THREE.LineBasicMaterial){R.diffuse.value=K.color;R.opacity.value=K.opacity}else if(K instanceof THREE.ParticleBasicMaterial){R.psColor.value=K.color;R.opacity.value=K.opacity;R.size.value=K.size;R.scale.value=ha.height/2;R.map.texture=K.map}else if(K instanceof THREE.MeshPhongMaterial){R.ambient.value=K.ambient;R.specular.value=K.specular;R.shininess.value=K.shininess}else if(K instanceof THREE.MeshDepthMaterial){R.mNear.value=z.near;R.mFar.value=z.far;
R.opacity.value=K.opacity}else if(K instanceof THREE.MeshNormalMaterial)R.opacity.value=K.opacity;for(var I in R)if(U=T.uniforms[I]){Y=R[I];X=Y.type;J=Y.value;if(X=="i")p.uniform1i(U,J);else if(X=="f")p.uniform1f(U,J);else if(X=="fv1")p.uniform1fv(U,J);else if(X=="fv")p.uniform3fv(U,J);else if(X=="v2")p.uniform2f(U,J.x,J.y);else if(X=="v3")p.uniform3f(U,J.x,J.y,J.z);else if(X=="v4")p.uniform4f(U,J.x,J.y,J.z,J.w);else if(X=="c")p.uniform3f(U,J.r,J.g,J.b);else if(X=="t"){p.uniform1i(U,J);if(Y=Y.texture)if(Y.image instanceof
Array&&Y.image.length==6){if(Y.image.length==6){if(Y.needsUpdate){if(Y.__webglInit){p.bindTexture(p.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube);for(X=0;X<6;++X)p.texSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,0,0,p.RGBA,p.UNSIGNED_BYTE,Y.image[X])}else{Y.image.__webglTextureCube=p.createTexture();p.bindTexture(p.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube);for(X=0;X<6;++X)p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Y.image[X]);Y.__webglInit=!0}F(p.TEXTURE_CUBE_MAP,
Y,Y.image[0]);p.bindTexture(p.TEXTURE_CUBE_MAP,null);Y.needsUpdate=!1}p.activeTexture(p.TEXTURE0+J);p.bindTexture(p.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube)}}else E(Y,J)}}p.uniformMatrix4fv(W.modelViewMatrix,!1,M._modelViewMatrixArray);p.uniformMatrix3fv(W.normalMatrix,!1,M._normalMatrixArray);(K instanceof THREE.MeshShaderMaterial||K instanceof THREE.MeshPhongMaterial||K.envMap)&&W.cameraPosition!==null&&p.uniform3f(W.cameraPosition,z.position.x,z.position.y,z.position.z);(K instanceof THREE.MeshShaderMaterial||
K.envMap||K.skinning)&&W.objectMatrix!==null&&p.uniformMatrix4fv(W.objectMatrix,!1,M._objectMatrixArray);(K instanceof THREE.MeshPhongMaterial||K instanceof THREE.MeshLambertMaterial||K instanceof THREE.MeshShaderMaterial||K.skinning)&&W.viewMatrix!==null&&p.uniformMatrix4fv(W.viewMatrix,!1,Ua);if(K instanceof THREE.ShadowVolumeDynamicMaterial){z=R.directionalLightDirection.value;z[0]=-P[1].position.x;z[1]=-P[1].position.y;z[2]=-P[1].position.z;p.uniform3fv(W.directionalLightDirection,z);p.uniformMatrix4fv(W.objectMatrix,
!1,M._objectMatrixArray);p.uniformMatrix4fv(W.viewMatrix,!1,Ua)}if(K.skinning){p.uniformMatrix4fv(W.cameraInverseMatrix,!1,Ua);p.uniformMatrix4fv(W.boneGlobalMatrices,!1,M.boneMatrices)}return T}function d(z,P,J,K,M,T){if(K.opacity!=0){var W;z=c(z,P,J,K,T).attributes;if(!K.morphTargets&&z.position>=0){p.bindBuffer(p.ARRAY_BUFFER,M.__webglVertexBuffer);p.vertexAttribPointer(z.position,3,p.FLOAT,!1,0,0)}else{P=K.program.attributes;if(T.morphTargetBase!==-1){p.bindBuffer(p.ARRAY_BUFFER,M.__webglMorphTargetsBuffers[T.morphTargetBase]);
p.vertexAttribPointer(P.position,3,p.FLOAT,!1,0,0)}else if(P.position>=0){p.bindBuffer(p.ARRAY_BUFFER,M.__webglVertexBuffer);p.vertexAttribPointer(P.position,3,p.FLOAT,!1,0,0)}if(T.morphTargetForcedOrder.length){J=0;for(var R=T.morphTargetForcedOrder,Y=T.morphTargetInfluences;J<K.numSupportedMorphTargets&&J<R.length;){p.bindBuffer(p.ARRAY_BUFFER,M.__webglMorphTargetsBuffers[R[J]]);p.vertexAttribPointer(P["morphTarget"+J],3,p.FLOAT,!1,0,0);T.__webglMorphTargetInfluences[J]=Y[R[J]];J++}}else{R=[];var S=
-1,X=0;Y=T.morphTargetInfluences;var U,ma=Y.length;J=0;for(T.morphTargetBase!==-1&&(R[T.morphTargetBase]=!0);J<K.numSupportedMorphTargets;){for(U=0;U<ma;U++)if(!R[U]&&Y[U]>S){X=U;S=Y[X]}p.bindBuffer(p.ARRAY_BUFFER,M.__webglMorphTargetsBuffers[X]);p.vertexAttribPointer(P["morphTarget"+J],3,p.FLOAT,!1,0,0);T.__webglMorphTargetInfluences[J]=S;R[X]=1;S=-1;J++}}K.program.uniforms.morphTargetInfluences!==null&&p.uniform1fv(K.program.uniforms.morphTargetInfluences,T.__webglMorphTargetInfluences)}if(K.attributes)for(W in K.attributes)if(z[W]>=
0){P=K.attributes[W];p.bindBuffer(p.ARRAY_BUFFER,P.buffer);p.vertexAttribPointer(z[W],P.size,p.FLOAT,!1,0,0)}if(z.color>=0){p.bindBuffer(p.ARRAY_BUFFER,M.__webglColorBuffer);p.vertexAttribPointer(z.color,3,p.FLOAT,!1,0,0)}if(z.normal>=0){p.bindBuffer(p.ARRAY_BUFFER,M.__webglNormalBuffer);p.vertexAttribPointer(z.normal,3,p.FLOAT,!1,0,0)}if(z.tangent>=0){p.bindBuffer(p.ARRAY_BUFFER,M.__webglTangentBuffer);p.vertexAttribPointer(z.tangent,4,p.FLOAT,!1,0,0)}if(z.uv>=0)if(M.__webglUVBuffer){p.bindBuffer(p.ARRAY_BUFFER,
M.__webglUVBuffer);p.vertexAttribPointer(z.uv,2,p.FLOAT,!1,0,0);p.enableVertexAttribArray(z.uv)}else p.disableVertexAttribArray(z.uv);if(z.uv2>=0)if(M.__webglUV2Buffer){p.bindBuffer(p.ARRAY_BUFFER,M.__webglUV2Buffer);p.vertexAttribPointer(z.uv2,2,p.FLOAT,!1,0,0);p.enableVertexAttribArray(z.uv2)}else p.disableVertexAttribArray(z.uv2);if(K.skinning&&z.skinVertexA>=0&&z.skinVertexB>=0&&z.skinIndex>=0&&z.skinWeight>=0){p.bindBuffer(p.ARRAY_BUFFER,M.__webglSkinVertexABuffer);p.vertexAttribPointer(z.skinVertexA,
4,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,M.__webglSkinVertexBBuffer);p.vertexAttribPointer(z.skinVertexB,4,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,M.__webglSkinIndicesBuffer);p.vertexAttribPointer(z.skinIndex,4,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,M.__webglSkinWeightsBuffer);p.vertexAttribPointer(z.skinWeight,4,p.FLOAT,!1,0,0)}if(T instanceof THREE.Mesh){if(K.wireframe){p.lineWidth(K.wireframeLinewidth);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,M.__webglLineBuffer);p.drawElements(p.LINES,
M.__webglLineCount,p.UNSIGNED_SHORT,0)}else{p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,M.__webglFaceBuffer);p.drawElements(p.TRIANGLES,M.__webglFaceCount,p.UNSIGNED_SHORT,0)}ea.data.vertices+=M.__webglFaceCount;ea.data.faces+=M.__webglFaceCount/3;ea.data.drawCalls++}else if(T instanceof THREE.Line){T=T.type==THREE.LineStrip?p.LINE_STRIP:p.LINES;p.lineWidth(K.linewidth);p.drawArrays(T,0,M.__webglLineCount);ea.data.drawCalls++}else if(T instanceof THREE.ParticleSystem){p.drawArrays(p.POINTS,0,M.__webglParticleCount);
ea.data.drawCalls++}else if(T instanceof THREE.Ribbon){p.drawArrays(p.TRIANGLE_STRIP,0,M.__webglVertexCount);ea.data.drawCalls++}}}function f(z,P,J){if(!z.__webglVertexBuffer)z.__webglVertexBuffer=p.createBuffer();if(!z.__webglNormalBuffer)z.__webglNormalBuffer=p.createBuffer();if(z.hasPos){p.bindBuffer(p.ARRAY_BUFFER,z.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,z.positionArray,p.DYNAMIC_DRAW);p.enableVertexAttribArray(P.attributes.position);p.vertexAttribPointer(P.attributes.position,3,p.FLOAT,
!1,0,0)}if(z.hasNormal){p.bindBuffer(p.ARRAY_BUFFER,z.__webglNormalBuffer);if(J==THREE.FlatShading){var K,M,T,W,R,Y,S,X,U,ma,ka=z.count*3;for(ma=0;ma<ka;ma+=9){J=z.normalArray;K=J[ma];M=J[ma+1];T=J[ma+2];W=J[ma+3];Y=J[ma+4];X=J[ma+5];R=J[ma+6];S=J[ma+7];U=J[ma+8];K=(K+W+R)/3;M=(M+Y+S)/3;T=(T+X+U)/3;J[ma]=K;J[ma+1]=M;J[ma+2]=T;J[ma+3]=K;J[ma+4]=M;J[ma+5]=T;J[ma+6]=K;J[ma+7]=M;J[ma+8]=T}}p.bufferData(p.ARRAY_BUFFER,z.normalArray,p.DYNAMIC_DRAW);p.enableVertexAttribArray(P.attributes.normal);p.vertexAttribPointer(P.attributes.normal,
3,p.FLOAT,!1,0,0)}p.drawArrays(p.TRIANGLES,0,z.count);z.count=0}function h(z){if(aa!=z.doubleSided){z.doubleSided?p.disable(p.CULL_FACE):p.enable(p.CULL_FACE);aa=z.doubleSided}if(pa!=z.flipSided){z.flipSided?p.frontFace(p.CW):p.frontFace(p.CCW);pa=z.flipSided}}function g(z){if(sa!=z){z?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST);sa=z}}function n(z){ra[0].set(z.n41-z.n11,z.n42-z.n12,z.n43-z.n13,z.n44-z.n14);ra[1].set(z.n41+z.n11,z.n42+z.n12,z.n43+z.n13,z.n44+z.n14);ra[2].set(z.n41+z.n21,z.n42+z.n22,
z.n43+z.n23,z.n44+z.n24);ra[3].set(z.n41-z.n21,z.n42-z.n22,z.n43-z.n23,z.n44-z.n24);ra[4].set(z.n41-z.n31,z.n42-z.n32,z.n43-z.n33,z.n44-z.n34);ra[5].set(z.n41+z.n31,z.n42+z.n32,z.n43+z.n33,z.n44+z.n34);var P;for(z=0;z<6;z++){P=ra[z];P.divideScalar(Math.sqrt(P.x*P.x+P.y*P.y+P.z*P.z))}}function m(z){for(var P=z.matrixWorld,J=-z.geometry.boundingSphere.radius*Math.max(z.scale.x,Math.max(z.scale.y,z.scale.z)),K=0;K<6;K++){z=ra[K].x*P.n14+ra[K].y*P.n24+ra[K].z*P.n34+ra[K].w;if(z<=J)return!1}return!0}function o(z,
P){z.list[z.count]=P;z.count+=1}function t(z){var P,J,K=z.object,M=z.opaque,T=z.transparent;T.count=0;z=M.count=0;for(P=K.materials.length;z<P;z++){J=K.materials[z];J.transparent?o(T,J):o(M,J)}}function u(z){var P,J,K,M,T=z.object,W=z.buffer,R=z.opaque,Y=z.transparent;Y.count=0;z=R.count=0;for(K=T.materials.length;z<K;z++){P=T.materials[z];if(P instanceof THREE.MeshFaceMaterial){P=0;for(J=W.materials.length;P<J;P++)(M=W.materials[P])&&(M.transparent?o(Y,M):o(R,M))}else(M=P)&&(M.transparent?o(Y,M):
o(R,M))}}function w(z,P){return P.z-z.z}function v(z){p.enable(p.POLYGON_OFFSET_FILL);p.polygonOffset(0.1,1);p.enable(p.STENCIL_TEST);p.enable(p.DEPTH_TEST);p.depthMask(!1);p.colorMask(!1,!1,!1,!1);p.stencilFunc(p.ALWAYS,1,255);p.stencilOpSeparate(p.BACK,p.KEEP,p.INCR,p.KEEP);p.stencilOpSeparate(p.FRONT,p.KEEP,p.DECR,p.KEEP);var P,J=z.lights.length,K,M=z.lights,T=[],W,R,Y,S,X,U=z.__webglShadowVolumes.length;for(P=0;P<J;P++){K=z.lights[P];if(K instanceof THREE.DirectionalLight&&K.castShadow){T[0]=
-K.position.x;T[1]=-K.position.y;T[2]=-K.position.z;for(X=0;X<U;X++){K=z.__webglShadowVolumes[X].object;W=z.__webglShadowVolumes[X].buffer;R=K.materials[0];R.program||ea.initMaterial(R,M,undefined,K);R=R.program;Y=R.uniforms;S=R.attributes;if(oa!==R){p.useProgram(R);oa=R;p.uniformMatrix4fv(Y.projectionMatrix,!1,La);p.uniformMatrix4fv(Y.viewMatrix,!1,Ua);p.uniform3fv(Y.directionalLightDirection,T)}K.matrixWorld.flattenToArray(K._objectMatrixArray);p.uniformMatrix4fv(Y.objectMatrix,!1,K._objectMatrixArray);
p.bindBuffer(p.ARRAY_BUFFER,W.__webglVertexBuffer);p.vertexAttribPointer(S.position,3,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,W.__webglNormalBuffer);p.vertexAttribPointer(S.normal,3,p.FLOAT,!1,0,0);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,W.__webglFaceBuffer);p.cullFace(p.FRONT);p.drawElements(p.TRIANGLES,W.__webglFaceCount,p.UNSIGNED_SHORT,0);p.cullFace(p.BACK);p.drawElements(p.TRIANGLES,W.__webglFaceCount,p.UNSIGNED_SHORT,0)}}}p.disable(p.POLYGON_OFFSET_FILL);p.colorMask(!0,!0,!0,!0);p.stencilFunc(p.NOTEQUAL,
0,255);p.stencilOp(p.KEEP,p.KEEP,p.KEEP);p.disable(p.DEPTH_TEST);na="";oa=ca.program;p.useProgram(ca.program);p.uniformMatrix4fv(ca.projectionLocation,!1,La);p.uniform1f(ca.darknessLocation,ca.darkness);p.bindBuffer(p.ARRAY_BUFFER,ca.vertexBuffer);p.vertexAttribPointer(ca.vertexLocation,3,p.FLOAT,!1,0,0);p.enableVertexAttribArray(ca.vertexLocation);p.blendFunc(p.ONE,p.ONE_MINUS_SRC_ALPHA);p.blendEquation(p.FUNC_ADD);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);p.drawElements(p.TRIANGLES,
6,p.UNSIGNED_SHORT,0);p.disable(p.STENCIL_TEST);p.enable(p.DEPTH_TEST);p.depthMask(Z)}function x(z,P){var J,K,M;J=_sprite.attributes;var T=_sprite.uniforms,W=Da/Ha,R,Y=[],S=Ha*0.5,X=Da*0.5,U=!0;p.useProgram(_sprite.program);oa=_sprite.program;na="";if(!cb){p.enableVertexAttribArray(_sprite.attributes.position);p.enableVertexAttribArray(_sprite.attributes.uv);cb=!0}p.disable(p.CULL_FACE);p.enable(p.BLEND);p.depthMask(!0);p.bindBuffer(p.ARRAY_BUFFER,_sprite.vertexBuffer);p.vertexAttribPointer(J.position,
2,p.FLOAT,!1,16,0);p.vertexAttribPointer(J.uv,2,p.FLOAT,!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);p.uniformMatrix4fv(T.projectionMatrix,!1,La);p.activeTexture(p.TEXTURE0);p.uniform1i(T.map,0);J=0;for(K=z.__webglSprites.length;J<K;J++){M=z.__webglSprites[J];if(M.useScreenCoordinates)M.z=-M.position.z;else{M._modelViewMatrix.multiplyToArray(P.matrixWorldInverse,M.matrixWorld,M._modelViewMatrixArray);M.z=-M._modelViewMatrix.n34}}z.__webglSprites.sort(w);J=0;for(K=z.__webglSprites.length;J<
K;J++){M=z.__webglSprites[J];if(M.material===undefined&&M.map&&M.map.image&&M.map.image.width){if(M.useScreenCoordinates){p.uniform1i(T.useScreenCoordinates,1);p.uniform3f(T.screenPosition,(M.position.x-S)/S,(X-M.position.y)/X,Math.max(0,Math.min(1,M.position.z)))}else{p.uniform1i(T.useScreenCoordinates,0);p.uniform1i(T.affectedByDistance,M.affectedByDistance?1:0);p.uniformMatrix4fv(T.modelViewMatrix,!1,M._modelViewMatrixArray)}R=M.map.image.width/(M.affectedByDistance?1:Da);Y[0]=R*W*M.scale.x;Y[1]=
R*M.scale.y;p.uniform2f(T.uvScale,M.uvScale.x,M.uvScale.y);p.uniform2f(T.uvOffset,M.uvOffset.x,M.uvOffset.y);p.uniform2f(T.alignment,M.alignment.x,M.alignment.y);p.uniform1f(T.opacity,M.opacity);p.uniform1f(T.rotation,M.rotation);p.uniform2fv(T.scale,Y);if(M.mergeWith3D&&!U){p.enable(p.DEPTH_TEST);U=!0}else if(!M.mergeWith3D&&U){p.disable(p.DEPTH_TEST);U=!1}G(M.blending);E(M.map,0);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0)}}p.enable(p.CULL_FACE);p.enable(p.DEPTH_TEST);p.depthMask(Z)}function y(z,
P){var J,K,M=z.__webglLensFlares.length,T,W,R,Y=new THREE.Vector3,S=Da/Ha,X=Ha*0.5,U=Da*0.5,ma=16/Da,ka=[ma*S,ma],Ea=[1,1,0],Ja=[1,1],Ga=da.uniforms;J=da.attributes;p.useProgram(da.program);oa=da.program;na="";if(!Oa){p.enableVertexAttribArray(da.attributes.vertex);p.enableVertexAttribArray(da.attributes.uv);Oa=!0}p.uniform1i(Ga.occlusionMap,0);p.uniform1i(Ga.map,1);p.bindBuffer(p.ARRAY_BUFFER,da.vertexBuffer);p.vertexAttribPointer(J.vertex,2,p.FLOAT,!1,16,0);p.vertexAttribPointer(J.uv,2,p.FLOAT,
!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,da.elementBuffer);p.disable(p.CULL_FACE);p.depthMask(!1);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,da.occlusionTexture);p.activeTexture(p.TEXTURE1);for(K=0;K<M;K++){J=z.__webglLensFlares[K].object;Y.set(J.matrixWorld.n14,J.matrixWorld.n24,J.matrixWorld.n34);P.matrixWorldInverse.multiplyVector3(Y);P.projectionMatrix.multiplyVector3(Y);Ea[0]=Y.x;Ea[1]=Y.y;Ea[2]=Y.z;Ja[0]=Ea[0]*X+X;Ja[1]=Ea[1]*U+U;if(da.hasVertexTexture||Ja[0]>0&&Ja[0]<Ha&&Ja[1]>
0&&Ja[1]<Da){p.bindTexture(p.TEXTURE_2D,da.tempTexture);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,Ja[0]-8,Ja[1]-8,16,16,0);p.uniform1i(Ga.renderType,0);p.uniform2fv(Ga.scale,ka);p.uniform3fv(Ga.screenPosition,Ea);p.disable(p.BLEND);p.enable(p.DEPTH_TEST);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);p.bindTexture(p.TEXTURE_2D,da.occlusionTexture);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,Ja[0]-8,Ja[1]-8,16,16,0);p.uniform1i(Ga.renderType,1);p.disable(p.DEPTH_TEST);p.bindTexture(p.TEXTURE_2D,da.tempTexture);
p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);J.positionScreen.x=Ea[0];J.positionScreen.y=Ea[1];J.positionScreen.z=Ea[2];J.customUpdateCallback?J.customUpdateCallback(J):J.updateLensFlares();p.uniform1i(Ga.renderType,2);p.enable(p.BLEND);T=0;for(W=J.lensFlares.length;T<W;T++){R=J.lensFlares[T];if(R.opacity>0.0010&&R.scale>0.0010){Ea[0]=R.x;Ea[1]=R.y;Ea[2]=R.z;ma=R.size*R.scale/Da;ka[0]=ma*S;ka[1]=ma;p.uniform3fv(Ga.screenPosition,Ea);p.uniform2fv(Ga.scale,ka);p.uniform1f(Ga.rotation,R.rotation);
p.uniform1f(Ga.opacity,R.opacity);G(R.blending);E(R.texture,1);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0)}}}}p.enable(p.CULL_FACE);p.enable(p.DEPTH_TEST);p.depthMask(Z)}function A(z,P){z._modelViewMatrix.multiplyToArray(P.matrixWorldInverse,z.matrixWorld,z._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(z._modelViewMatrix).transposeIntoArray(z._normalMatrixArray)}function B(z){var P,J,K,M,T;if(z instanceof THREE.Mesh){J=z.geometry;for(P in J.geometryGroups){K=J.geometryGroups[P];T=!1;for(M in K.__webglCustomAttributes)if(K.__webglCustomAttributes[M].needsUpdate){T=
!0;break}if(J.__dirtyVertices||J.__dirtyMorphTargets||J.__dirtyElements||J.__dirtyUvs||J.__dirtyNormals||J.__dirtyColors||J.__dirtyTangents||T){T=p.DYNAMIC_DRAW;var W=void 0,R=void 0,Y=void 0,S=void 0,X=void 0,U=void 0,ma=void 0,ka=void 0,Ea=void 0,Ja=void 0,Ga=void 0,Na=void 0,Za=void 0,xa=void 0,Ca=void 0,Ia=void 0,Ra=void 0,Q=void 0,ua=void 0,I=void 0,fb=void 0,ib=void 0,Wa=0,Va=0,hb=0,eb=0,bb=0,ab=0,Qa=0,$a=0,Xa=0,ja=0,Fa=0,Sa=K.__vertexArray,jb=K.__uvArray,nb=K.__uv2Array,db=K.__normalArray,
Ka=K.__tangentArray,ga=K.__colorArray,wa=K.__skinVertexAArray,ta=K.__skinVertexBArray,qa=K.__skinIndexArray,Ba=K.__skinWeightArray,Pa=K.__morphTargetsArrays,za=K.__webglCustomAttributes,ia=K.__faceArray,Ma=K.__lineArray,mb=K.__needsSmoothNormals;Ja=K.__vertexColorType;Ea=K.__uvType;Ga=K.__normalType;var Ta=z.geometry,kb=Ta.__dirtyVertices,ob=Ta.__dirtyElements,gb=Ta.__dirtyUvs,lb=Ta.__dirtyNormals,vb=Ta.__dirtyTangents,wb=Ta.__dirtyColors,xb=Ta.__dirtyMorphTargets,rb=Ta.vertices,yb=K.faces,Bb=Ta.faces,
zb=Ta.faceVertexUvs[0],Ab=Ta.faceVertexUvs[1],sb=Ta.skinVerticesA,tb=Ta.skinVerticesB,ub=Ta.skinIndices,pb=Ta.skinWeights,qb=z instanceof THREE.ShadowVolume?Ta.edgeFaces:undefined;morphTargets=Ta.morphTargets;if(za)for(ib in za){za[ib].offset=0;za[ib].offsetSrc=0}W=0;for(R=yb.length;W<R;W++){Y=yb[W];S=Bb[Y];zb&&(Na=zb[Y]);Ab&&(Za=Ab[Y]);Y=S.vertexNormals;X=S.normal;U=S.vertexColors;ma=S.color;ka=S.vertexTangents;if(S instanceof THREE.Face3){if(kb){xa=rb[S.a].position;Ca=rb[S.b].position;Ia=rb[S.c].position;
Sa[Va]=xa.x;Sa[Va+1]=xa.y;Sa[Va+2]=xa.z;Sa[Va+3]=Ca.x;Sa[Va+4]=Ca.y;Sa[Va+5]=Ca.z;Sa[Va+6]=Ia.x;Sa[Va+7]=Ia.y;Sa[Va+8]=Ia.z;Va+=9}if(za)for(ib in za){I=za[ib];if(I.needsUpdate){Q=I.offset;ua=I.offsetSrc;if(I.size===1){if(I.boundTo===undefined||I.boundTo==="vertices"){I.array[Q+0]=I.value[S.a];I.array[Q+1]=I.value[S.b];I.array[Q+2]=I.value[S.c]}else if(I.boundTo==="faces"){I.array[Q+0]=I.value[ua];I.array[Q+1]=I.value[ua];I.array[Q+2]=I.value[ua];I.offsetSrc++}else if(I.boundTo==="faceVertices"){I.array[Q+
0]=I.value[ua+0];I.array[Q+1]=I.value[ua+1];I.array[Q+2]=I.value[ua+2];I.offsetSrc+=3}I.offset+=3}else{if(I.boundTo===undefined||I.boundTo==="vertices"){xa=I.value[S.a];Ca=I.value[S.b];Ia=I.value[S.c]}else if(I.boundTo==="faces"){xa=I.value[ua];Ca=I.value[ua];Ia=I.value[ua];I.offsetSrc++}else if(I.boundTo==="faceVertices"){xa=I.value[ua+0];Ca=I.value[ua+1];Ia=I.value[ua+2];I.offsetSrc+=3}if(I.size===2){I.array[Q+0]=xa.x;I.array[Q+1]=xa.y;I.array[Q+2]=Ca.x;I.array[Q+3]=Ca.y;I.array[Q+4]=Ia.x;I.array[Q+
5]=Ia.y;I.offset+=6}else if(I.size===3){if(I.type==="c"){I.array[Q+0]=xa.r;I.array[Q+1]=xa.g;I.array[Q+2]=xa.b;I.array[Q+3]=Ca.r;I.array[Q+4]=Ca.g;I.array[Q+5]=Ca.b;I.array[Q+6]=Ia.r;I.array[Q+7]=Ia.g;I.array[Q+8]=Ia.b}else{I.array[Q+0]=xa.x;I.array[Q+1]=xa.y;I.array[Q+2]=xa.z;I.array[Q+3]=Ca.x;I.array[Q+4]=Ca.y;I.array[Q+5]=Ca.z;I.array[Q+6]=Ia.x;I.array[Q+7]=Ia.y;I.array[Q+8]=Ia.z}I.offset+=9}else{I.array[Q+0]=xa.x;I.array[Q+1]=xa.y;I.array[Q+2]=xa.z;I.array[Q+3]=xa.w;I.array[Q+4]=Ca.x;I.array[Q+
5]=Ca.y;I.array[Q+6]=Ca.z;I.array[Q+7]=Ca.w;I.array[Q+8]=Ia.x;I.array[Q+9]=Ia.y;I.array[Q+10]=Ia.z;I.array[Q+11]=Ia.w;I.offset+=12}}}}if(xb){Q=0;for(ua=morphTargets.length;Q<ua;Q++){xa=morphTargets[Q].vertices[S.a].position;Ca=morphTargets[Q].vertices[S.b].position;Ia=morphTargets[Q].vertices[S.c].position;I=Pa[Q];I[Fa+0]=xa.x;I[Fa+1]=xa.y;I[Fa+2]=xa.z;I[Fa+3]=Ca.x;I[Fa+4]=Ca.y;I[Fa+5]=Ca.z;I[Fa+6]=Ia.x;I[Fa+7]=Ia.y;I[Fa+8]=Ia.z}Fa+=9}if(pb.length){Q=pb[S.a];ua=pb[S.b];I=pb[S.c];Ba[ja]=Q.x;Ba[ja+
1]=Q.y;Ba[ja+2]=Q.z;Ba[ja+3]=Q.w;Ba[ja+4]=ua.x;Ba[ja+5]=ua.y;Ba[ja+6]=ua.z;Ba[ja+7]=ua.w;Ba[ja+8]=I.x;Ba[ja+9]=I.y;Ba[ja+10]=I.z;Ba[ja+11]=I.w;Q=ub[S.a];ua=ub[S.b];I=ub[S.c];qa[ja]=Q.x;qa[ja+1]=Q.y;qa[ja+2]=Q.z;qa[ja+3]=Q.w;qa[ja+4]=ua.x;qa[ja+5]=ua.y;qa[ja+6]=ua.z;qa[ja+7]=ua.w;qa[ja+8]=I.x;qa[ja+9]=I.y;qa[ja+10]=I.z;qa[ja+11]=I.w;Q=sb[S.a];ua=sb[S.b];I=sb[S.c];wa[ja]=Q.x;wa[ja+1]=Q.y;wa[ja+2]=Q.z;wa[ja+3]=1;wa[ja+4]=ua.x;wa[ja+5]=ua.y;wa[ja+6]=ua.z;wa[ja+7]=1;wa[ja+8]=I.x;wa[ja+9]=I.y;wa[ja+10]=
I.z;wa[ja+11]=1;Q=tb[S.a];ua=tb[S.b];I=tb[S.c];ta[ja]=Q.x;ta[ja+1]=Q.y;ta[ja+2]=Q.z;ta[ja+3]=1;ta[ja+4]=ua.x;ta[ja+5]=ua.y;ta[ja+6]=ua.z;ta[ja+7]=1;ta[ja+8]=I.x;ta[ja+9]=I.y;ta[ja+10]=I.z;ta[ja+11]=1;ja+=12}if(wb&&Ja){if(U.length==3&&Ja==THREE.VertexColors){S=U[0];Q=U[1];ua=U[2]}else ua=Q=S=ma;ga[Xa]=S.r;ga[Xa+1]=S.g;ga[Xa+2]=S.b;ga[Xa+3]=Q.r;ga[Xa+4]=Q.g;ga[Xa+5]=Q.b;ga[Xa+6]=ua.r;ga[Xa+7]=ua.g;ga[Xa+8]=ua.b;Xa+=9}if(vb&&Ta.hasTangents){U=ka[0];ma=ka[1];S=ka[2];Ka[Qa]=U.x;Ka[Qa+1]=U.y;Ka[Qa+2]=U.z;
Ka[Qa+3]=U.w;Ka[Qa+4]=ma.x;Ka[Qa+5]=ma.y;Ka[Qa+6]=ma.z;Ka[Qa+7]=ma.w;Ka[Qa+8]=S.x;Ka[Qa+9]=S.y;Ka[Qa+10]=S.z;Ka[Qa+11]=S.w;Qa+=12}if(lb&&Ga)if(Y.length==3&&mb)for(ka=0;ka<3;ka++){X=Y[ka];db[ab]=X.x;db[ab+1]=X.y;db[ab+2]=X.z;ab+=3}else for(ka=0;ka<3;ka++){db[ab]=X.x;db[ab+1]=X.y;db[ab+2]=X.z;ab+=3}if(gb&&Na!==undefined&&Ea)for(ka=0;ka<3;ka++){Y=Na[ka];jb[hb]=Y.u;jb[hb+1]=Y.v;hb+=2}if(gb&&Za!==undefined&&Ea)for(ka=0;ka<3;ka++){Y=Za[ka];nb[eb]=Y.u;nb[eb+1]=Y.v;eb+=2}if(ob){ia[bb]=Wa;ia[bb+1]=Wa+1;ia[bb+
2]=Wa+2;bb+=3;Ma[$a]=Wa;Ma[$a+1]=Wa+1;Ma[$a+2]=Wa;Ma[$a+3]=Wa+2;Ma[$a+4]=Wa+1;Ma[$a+5]=Wa+2;$a+=6;Wa+=3}}else if(S instanceof THREE.Face4){if(kb){xa=rb[S.a].position;Ca=rb[S.b].position;Ia=rb[S.c].position;Ra=rb[S.d].position;Sa[Va]=xa.x;Sa[Va+1]=xa.y;Sa[Va+2]=xa.z;Sa[Va+3]=Ca.x;Sa[Va+4]=Ca.y;Sa[Va+5]=Ca.z;Sa[Va+6]=Ia.x;Sa[Va+7]=Ia.y;Sa[Va+8]=Ia.z;Sa[Va+9]=Ra.x;Sa[Va+10]=Ra.y;Sa[Va+11]=Ra.z;Va+=12}if(za)for(ib in za){I=za[ib];if(I.needsUpdate){Q=I.offset;ua=I.offsetSrc;if(I.size===1){if(I.boundTo===
undefined||I.boundTo==="vertices"){I.array[Q+0]=I.value[S.a];I.array[Q+1]=I.value[S.b];I.array[Q+2]=I.value[S.c];I.array[Q+3]=I.value[S.d]}else if(I.boundTo==="faces"){I.array[Q+0]=I.value[ua];I.array[Q+1]=I.value[ua];I.array[Q+2]=I.value[ua];I.array[Q+3]=I.value[ua];I.offsetSrc++}else if(I.boundTo==="faceVertices"){I.array[Q+0]=I.value[ua+0];I.array[Q+1]=I.value[ua+1];I.array[Q+2]=I.value[ua+2];I.array[Q+3]=I.value[ua+3];I.offsetSrc+=4}I.offset+=4}else{if(I.boundTo===undefined||I.boundTo==="vertices"){xa=
I.value[S.a];Ca=I.value[S.b];Ia=I.value[S.c];Ra=I.value[S.d]}else if(I.boundTo==="faces"){xa=I.value[ua];Ca=I.value[ua];Ia=I.value[ua];Ra=I.value[ua];I.offsetSrc++}else if(I.boundTo==="faceVertices"){xa=I.value[ua+0];Ca=I.value[ua+1];Ia=I.value[ua+2];Ra=I.value[ua+3];I.offsetSrc+=4}if(I.size===2){I.array[Q+0]=xa.x;I.array[Q+1]=xa.y;I.array[Q+2]=Ca.x;I.array[Q+3]=Ca.y;I.array[Q+4]=Ia.x;I.array[Q+5]=Ia.y;I.array[Q+6]=Ra.x;I.array[Q+7]=Ra.y;I.offset+=8}else if(I.size===3){if(I.type==="c"){I.array[Q+
0]=xa.r;I.array[Q+1]=xa.g;I.array[Q+2]=xa.b;I.array[Q+3]=Ca.r;I.array[Q+4]=Ca.g;I.array[Q+5]=Ca.b;I.array[Q+6]=Ia.r;I.array[Q+7]=Ia.g;I.array[Q+8]=Ia.b;I.array[Q+9]=Ra.r;I.array[Q+10]=Ra.g;I.array[Q+11]=Ra.b}else{I.array[Q+0]=xa.x;I.array[Q+1]=xa.y;I.array[Q+2]=xa.z;I.array[Q+3]=Ca.x;I.array[Q+4]=Ca.y;I.array[Q+5]=Ca.z;I.array[Q+6]=Ia.x;I.array[Q+7]=Ia.y;I.array[Q+8]=Ia.z;I.array[Q+9]=Ra.x;I.array[Q+10]=Ra.y;I.array[Q+11]=Ra.z}I.offset+=12}else{I.array[Q+0]=xa.x;I.array[Q+1]=xa.y;I.array[Q+2]=xa.z;
I.array[Q+3]=xa.w;I.array[Q+4]=Ca.x;I.array[Q+5]=Ca.y;I.array[Q+6]=Ca.z;I.array[Q+7]=Ca.w;I.array[Q+8]=Ia.x;I.array[Q+9]=Ia.y;I.array[Q+10]=Ia.z;I.array[Q+11]=Ia.w;I.array[Q+12]=Ra.x;I.array[Q+13]=Ra.y;I.array[Q+14]=Ra.z;I.array[Q+15]=Ra.w;I.offset+=16}}}}if(xb){Q=0;for(ua=morphTargets.length;Q<ua;Q++){xa=morphTargets[Q].vertices[S.a].position;Ca=morphTargets[Q].vertices[S.b].position;Ia=morphTargets[Q].vertices[S.c].position;Ra=morphTargets[Q].vertices[S.d].position;I=Pa[Q];I[Fa+0]=xa.x;I[Fa+1]=
xa.y;I[Fa+2]=xa.z;I[Fa+3]=Ca.x;I[Fa+4]=Ca.y;I[Fa+5]=Ca.z;I[Fa+6]=Ia.x;I[Fa+7]=Ia.y;I[Fa+8]=Ia.z;I[Fa+9]=Ra.x;I[Fa+10]=Ra.y;I[Fa+11]=Ra.z}Fa+=12}if(pb.length){Q=pb[S.a];ua=pb[S.b];I=pb[S.c];fb=pb[S.d];Ba[ja]=Q.x;Ba[ja+1]=Q.y;Ba[ja+2]=Q.z;Ba[ja+3]=Q.w;Ba[ja+4]=ua.x;Ba[ja+5]=ua.y;Ba[ja+6]=ua.z;Ba[ja+7]=ua.w;Ba[ja+8]=I.x;Ba[ja+9]=I.y;Ba[ja+10]=I.z;Ba[ja+11]=I.w;Ba[ja+12]=fb.x;Ba[ja+13]=fb.y;Ba[ja+14]=fb.z;Ba[ja+15]=fb.w;Q=ub[S.a];ua=ub[S.b];I=ub[S.c];fb=ub[S.d];qa[ja]=Q.x;qa[ja+1]=Q.y;qa[ja+2]=Q.z;qa[ja+
3]=Q.w;qa[ja+4]=ua.x;qa[ja+5]=ua.y;qa[ja+6]=ua.z;qa[ja+7]=ua.w;qa[ja+8]=I.x;qa[ja+9]=I.y;qa[ja+10]=I.z;qa[ja+11]=I.w;qa[ja+12]=fb.x;qa[ja+13]=fb.y;qa[ja+14]=fb.z;qa[ja+15]=fb.w;Q=sb[S.a];ua=sb[S.b];I=sb[S.c];fb=sb[S.d];wa[ja]=Q.x;wa[ja+1]=Q.y;wa[ja+2]=Q.z;wa[ja+3]=1;wa[ja+4]=ua.x;wa[ja+5]=ua.y;wa[ja+6]=ua.z;wa[ja+7]=1;wa[ja+8]=I.x;wa[ja+9]=I.y;wa[ja+10]=I.z;wa[ja+11]=1;wa[ja+12]=fb.x;wa[ja+13]=fb.y;wa[ja+14]=fb.z;wa[ja+15]=1;Q=tb[S.a];ua=tb[S.b];I=tb[S.c];S=tb[S.d];ta[ja]=Q.x;ta[ja+1]=Q.y;ta[ja+2]=
Q.z;ta[ja+3]=1;ta[ja+4]=ua.x;ta[ja+5]=ua.y;ta[ja+6]=ua.z;ta[ja+7]=1;ta[ja+8]=I.x;ta[ja+9]=I.y;ta[ja+10]=I.z;ta[ja+11]=1;ta[ja+12]=S.x;ta[ja+13]=S.y;ta[ja+14]=S.z;ta[ja+15]=1;ja+=16}if(wb&&Ja){if(U.length==4&&Ja==THREE.VertexColors){S=U[0];Q=U[1];ua=U[2];U=U[3]}else U=ua=Q=S=ma;ga[Xa]=S.r;ga[Xa+1]=S.g;ga[Xa+2]=S.b;ga[Xa+3]=Q.r;ga[Xa+4]=Q.g;ga[Xa+5]=Q.b;ga[Xa+6]=ua.r;ga[Xa+7]=ua.g;ga[Xa+8]=ua.b;ga[Xa+9]=U.r;ga[Xa+10]=U.g;ga[Xa+11]=U.b;Xa+=12}if(vb&&Ta.hasTangents){U=ka[0];ma=ka[1];S=ka[2];ka=ka[3];
Ka[Qa]=U.x;Ka[Qa+1]=U.y;Ka[Qa+2]=U.z;Ka[Qa+3]=U.w;Ka[Qa+4]=ma.x;Ka[Qa+5]=ma.y;Ka[Qa+6]=ma.z;Ka[Qa+7]=ma.w;Ka[Qa+8]=S.x;Ka[Qa+9]=S.y;Ka[Qa+10]=S.z;Ka[Qa+11]=S.w;Ka[Qa+12]=ka.x;Ka[Qa+13]=ka.y;Ka[Qa+14]=ka.z;Ka[Qa+15]=ka.w;Qa+=16}if(lb&&Ga)if(Y.length==4&&mb)for(ka=0;ka<4;ka++){X=Y[ka];db[ab]=X.x;db[ab+1]=X.y;db[ab+2]=X.z;ab+=3}else for(ka=0;ka<4;ka++){db[ab]=X.x;db[ab+1]=X.y;db[ab+2]=X.z;ab+=3}if(gb&&Na!==undefined&&Ea)for(ka=0;ka<4;ka++){Y=Na[ka];jb[hb]=Y.u;jb[hb+1]=Y.v;hb+=2}if(gb&&Za!==undefined&&
Ea)for(ka=0;ka<4;ka++){Y=Za[ka];nb[eb]=Y.u;nb[eb+1]=Y.v;eb+=2}if(ob){ia[bb]=Wa;ia[bb+1]=Wa+1;ia[bb+2]=Wa+3;ia[bb+3]=Wa+1;ia[bb+4]=Wa+2;ia[bb+5]=Wa+3;bb+=6;Ma[$a]=Wa;Ma[$a+1]=Wa+1;Ma[$a+2]=Wa;Ma[$a+3]=Wa+3;Ma[$a+4]=Wa+1;Ma[$a+5]=Wa+2;Ma[$a+6]=Wa+2;Ma[$a+7]=Wa+3;$a+=8;Wa+=4}}}if(qb){W=0;for(R=qb.length;W<R;W++){ia[bb]=qb[W].a;ia[bb+1]=qb[W].b;ia[bb+2]=qb[W].c;ia[bb+3]=qb[W].a;ia[bb+4]=qb[W].c;ia[bb+5]=qb[W].d;bb+=6}}if(kb){p.bindBuffer(p.ARRAY_BUFFER,K.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,
Sa,T)}if(za)for(ib in za){I=za[ib];if(I.needsUpdate){p.bindBuffer(p.ARRAY_BUFFER,I.buffer);p.bufferData(p.ARRAY_BUFFER,I.array,T);I.needsUpdate=!1}}if(xb){Q=0;for(ua=morphTargets.length;Q<ua;Q++){p.bindBuffer(p.ARRAY_BUFFER,K.__webglMorphTargetsBuffers[Q]);p.bufferData(p.ARRAY_BUFFER,Pa[Q],T)}}if(wb&&Xa>0){p.bindBuffer(p.ARRAY_BUFFER,K.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,ga,T)}if(lb){p.bindBuffer(p.ARRAY_BUFFER,K.__webglNormalBuffer);p.bufferData(p.ARRAY_BUFFER,db,T)}if(vb&&Ta.hasTangents){p.bindBuffer(p.ARRAY_BUFFER,
K.__webglTangentBuffer);p.bufferData(p.ARRAY_BUFFER,Ka,T)}if(gb&&hb>0){p.bindBuffer(p.ARRAY_BUFFER,K.__webglUVBuffer);p.bufferData(p.ARRAY_BUFFER,jb,T)}if(gb&&eb>0){p.bindBuffer(p.ARRAY_BUFFER,K.__webglUV2Buffer);p.bufferData(p.ARRAY_BUFFER,nb,T)}if(ob){p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,K.__webglFaceBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,ia,T);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,K.__webglLineBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,Ma,T)}if(ja>0){p.bindBuffer(p.ARRAY_BUFFER,K.__webglSkinVertexABuffer);
p.bufferData(p.ARRAY_BUFFER,wa,T);p.bindBuffer(p.ARRAY_BUFFER,K.__webglSkinVertexBBuffer);p.bufferData(p.ARRAY_BUFFER,ta,T);p.bindBuffer(p.ARRAY_BUFFER,K.__webglSkinIndicesBuffer);p.bufferData(p.ARRAY_BUFFER,qa,T);p.bindBuffer(p.ARRAY_BUFFER,K.__webglSkinWeightsBuffer);p.bufferData(p.ARRAY_BUFFER,Ba,T)}}}J.__dirtyVertices=!1;J.__dirtyMorphTargets=!1;J.__dirtyElements=!1;J.__dirtyUvs=!1;J.__dirtyNormals=!1;J.__dirtyTangents=!1;J.__dirtyColors=!1}else if(z instanceof THREE.Ribbon){J=z.geometry;if(J.__dirtyVertices||
J.__dirtyColors){z=J;P=p.DYNAMIC_DRAW;Ja=z.vertices;K=z.colors;Ga=Ja.length;T=K.length;Na=z.__vertexArray;W=z.__colorArray;Za=z.__dirtyColors;if(z.__dirtyVertices){for(R=0;R<Ga;R++){Ea=Ja[R].position;M=R*3;Na[M]=Ea.x;Na[M+1]=Ea.y;Na[M+2]=Ea.z}p.bindBuffer(p.ARRAY_BUFFER,z.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,Na,P)}if(Za){for(R=0;R<T;R++){color=K[R];M=R*3;W[M]=color.r;W[M+1]=color.g;W[M+2]=color.b}p.bindBuffer(p.ARRAY_BUFFER,z.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,W,P)}}J.__dirtyVertices=
!1;J.__dirtyColors=!1}else if(z instanceof THREE.Line){J=z.geometry;if(J.__dirtyVertices||J.__dirtyColors){z=J;P=p.DYNAMIC_DRAW;Ja=z.vertices;K=z.colors;Ga=Ja.length;T=K.length;Na=z.__vertexArray;W=z.__colorArray;Za=z.__dirtyColors;if(z.__dirtyVertices){for(R=0;R<Ga;R++){Ea=Ja[R].position;M=R*3;Na[M]=Ea.x;Na[M+1]=Ea.y;Na[M+2]=Ea.z}p.bindBuffer(p.ARRAY_BUFFER,z.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,Na,P)}if(Za){for(R=0;R<T;R++){color=K[R];M=R*3;W[M]=color.r;W[M+1]=color.g;W[M+2]=color.b}p.bindBuffer(p.ARRAY_BUFFER,
z.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,W,P)}}J.__dirtyVertices=!1;J.__dirtyColors=!1}else if(z instanceof THREE.ParticleSystem){J=z.geometry;(J.__dirtyVertices||J.__dirtyColors||z.sortParticles)&&e(J,p.DYNAMIC_DRAW,z);J.__dirtyVertices=!1;J.__dirtyColors=!1}}function D(z){function P(ma){var ka=[];J=0;for(K=ma.length;J<K;J++)ma[J]==undefined?ka.push("undefined"):ka.push(ma[J].id);return ka.join("_")}var J,K,M,T,W,R,Y,S,X={},U=z.morphTargets!==undefined?z.morphTargets.length:0;z.geometryGroups=
{};M=0;for(T=z.faces.length;M<T;M++){W=z.faces[M];R=W.materials;Y=P(R);X[Y]==undefined&&(X[Y]={hash:Y,counter:0});S=X[Y].hash+"_"+X[Y].counter;z.geometryGroups[S]==undefined&&(z.geometryGroups[S]={faces:[],materials:R,vertices:0,numMorphTargets:U});W=W instanceof THREE.Face3?3:4;if(z.geometryGroups[S].vertices+W>65535){X[Y].counter+=1;S=X[Y].hash+"_"+X[Y].counter;z.geometryGroups[S]==undefined&&(z.geometryGroups[S]={faces:[],materials:R,vertices:0,numMorphTargets:U})}z.geometryGroups[S].faces.push(M);
z.geometryGroups[S].vertices+=W}}function C(z,P,J){z.push({buffer:P,object:J,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function G(z){if(z!=na){switch(z){case THREE.AdditiveBlending:p.blendEquation(p.FUNC_ADD);p.blendFunc(p.SRC_ALPHA,p.ONE);break;case THREE.SubtractiveBlending:p.blendEquation(p.FUNC_ADD);p.blendFunc(p.ZERO,p.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:p.blendEquation(p.FUNC_ADD);p.blendFunc(p.ZERO,p.SRC_COLOR);break;default:p.blendEquationSeparate(p.FUNC_ADD,
p.FUNC_ADD);p.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA)}na=z}}function F(z,P,J){if((J.width&J.width-1)==0&&(J.height&J.height-1)==0){p.texParameteri(z,p.TEXTURE_WRAP_S,N(P.wrapS));p.texParameteri(z,p.TEXTURE_WRAP_T,N(P.wrapT));p.texParameteri(z,p.TEXTURE_MAG_FILTER,N(P.magFilter));p.texParameteri(z,p.TEXTURE_MIN_FILTER,N(P.minFilter));p.generateMipmap(z)}else{p.texParameteri(z,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(z,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);
p.texParameteri(z,p.TEXTURE_MAG_FILTER,H(P.magFilter));p.texParameteri(z,p.TEXTURE_MIN_FILTER,H(P.minFilter))}}function E(z,P){if(z.needsUpdate){if(z.__webglInit){p.bindTexture(p.TEXTURE_2D,z.__webglTexture);p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,z.image)}else{z.__webglTexture=p.createTexture();p.bindTexture(p.TEXTURE_2D,z.__webglTexture);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,z.image);z.__webglInit=!0}F(p.TEXTURE_2D,z,z.image);p.bindTexture(p.TEXTURE_2D,null);
z.needsUpdate=!1}p.activeTexture(p.TEXTURE0+P);p.bindTexture(p.TEXTURE_2D,z.__webglTexture)}function O(z){if(z&&!z.__webglFramebuffer){if(z.depthBuffer===undefined)z.depthBuffer=!0;if(z.stencilBuffer===undefined)z.stencilBuffer=!0;z.__webglFramebuffer=p.createFramebuffer();z.__webglRenderbuffer=p.createRenderbuffer();z.__webglTexture=p.createTexture();p.bindTexture(p.TEXTURE_2D,z.__webglTexture);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,N(z.wrapS));p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,
N(z.wrapT));p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,N(z.magFilter));p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,N(z.minFilter));p.texImage2D(p.TEXTURE_2D,0,N(z.format),z.width,z.height,0,N(z.format),N(z.type),null);p.bindRenderbuffer(p.RENDERBUFFER,z.__webglRenderbuffer);p.bindFramebuffer(p.FRAMEBUFFER,z.__webglFramebuffer);p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,z.__webglTexture,0);if(z.depthBuffer&&!z.stencilBuffer){p.renderbufferStorage(p.RENDERBUFFER,
p.DEPTH_COMPONENT16,z.width,z.height);p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,z.__webglRenderbuffer)}else if(z.depthBuffer&&z.stencilBuffer){p.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_STENCIL,z.width,z.height);p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,z.__webglRenderbuffer)}else p.renderbufferStorage(p.RENDERBUFFER,p.RGBA4,z.width,z.height);p.bindTexture(p.TEXTURE_2D,null);p.bindRenderbuffer(p.RENDERBUFFER,null);p.bindFramebuffer(p.FRAMEBUFFER,
null)}var P,J;if(z){P=z.__webglFramebuffer;J=z.width;z=z.height}else{P=null;J=Ha;z=Da}if(P!=V){p.bindFramebuffer(p.FRAMEBUFFER,P);p.viewport(ya,va,J,z);V=P}}function L(z,P){var J;if(z=="fragment")J=p.createShader(p.FRAGMENT_SHADER);else z=="vertex"&&(J=p.createShader(p.VERTEX_SHADER));p.shaderSource(J,P);p.compileShader(J);if(!p.getShaderParameter(J,p.COMPILE_STATUS)){console.error(p.getShaderInfoLog(J));console.error(P);return null}return J}function H(z){switch(z){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return p.NEAREST;
default:return p.LINEAR}}function N(z){switch(z){case THREE.RepeatWrapping:return p.REPEAT;case THREE.ClampToEdgeWrapping:return p.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return p.MIRRORED_REPEAT;case THREE.NearestFilter:return p.NEAREST;case THREE.NearestMipMapNearestFilter:return p.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return p.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return p.LINEAR;case THREE.LinearMipMapNearestFilter:return p.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return p.LINEAR_MIPMAP_LINEAR;
case THREE.ByteType:return p.BYTE;case THREE.UnsignedByteType:return p.UNSIGNED_BYTE;case THREE.ShortType:return p.SHORT;case THREE.UnsignedShortType:return p.UNSIGNED_SHORT;case THREE.IntType:return p.INT;case THREE.UnsignedShortType:return p.UNSIGNED_INT;case THREE.FloatType:return p.FLOAT;case THREE.AlphaFormat:return p.ALPHA;case THREE.RGBFormat:return p.RGB;case THREE.RGBAFormat:return p.RGBA;case THREE.LuminanceFormat:return p.LUMINANCE;case THREE.LuminanceAlphaFormat:return p.LUMINANCE_ALPHA}return 0}
var ea=this,p,ha=document.createElement("canvas"),fa=[],oa=null,V=null,Z=!0,aa=null,pa=null,na=null,sa=null,ya=0,va=0,Ha=0,Da=0,ra=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Aa=new THREE.Matrix4,La=new Float32Array(16),Ua=new Float32Array(16),Ya=new THREE.Vector4,$={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};stencil=b.stencil!==undefined?b.stencil:!0;
antialias=b.antialias!==undefined?b.antialias:!1;clearColor=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0);clearAlpha=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=ha;this.autoClear=!0;this.sortObjects=!0;(function(z,P,J,K){try{if(!(p=ha.getContext("experimental-webgl",{antialias:z,stencil:K})))throw"Error creating WebGL context.";}catch(M){console.error(M)}console.log(navigator.userAgent+" | "+
p.getParameter(p.VERSION)+" | "+p.getParameter(p.VENDOR)+" | "+p.getParameter(p.RENDERER)+" | "+p.getParameter(p.SHADING_LANGUAGE_VERSION));p.clearColor(0,0,0,1);p.clearDepth(1);p.enable(p.DEPTH_TEST);p.depthFunc(p.LEQUAL);p.frontFace(p.CCW);p.cullFace(p.BACK);p.enable(p.CULL_FACE);p.enable(p.BLEND);p.blendEquation(p.FUNC_ADD);p.blendFunc(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA);p.clearColor(P.r,P.g,P.b,J)})(antialias,clearColor,clearAlpha,stencil);this.context=p;var la=p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>
0;if(stencil){var ca={};ca.vertices=new Float32Array(12);ca.faces=new Uint16Array(6);ca.darkness=0.5;ca.vertices[0]=-20;ca.vertices[1]=-20;ca.vertices[2]=-1;ca.vertices[3]=20;ca.vertices[4]=-20;ca.vertices[5]=-1;ca.vertices[6]=20;ca.vertices[7]=20;ca.vertices[8]=-1;ca.vertices[9]=-20;ca.vertices[10]=20;ca.vertices[11]=-1;ca.faces[0]=0;ca.faces[1]=1;ca.faces[2]=2;ca.faces[3]=0;ca.faces[4]=2;ca.faces[5]=3;ca.vertexBuffer=p.createBuffer();ca.elementBuffer=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,
ca.vertexBuffer);p.bufferData(p.ARRAY_BUFFER,ca.vertices,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,ca.faces,p.STATIC_DRAW);ca.program=p.createProgram();p.attachShader(ca.program,L("fragment",THREE.ShaderLib.shadowPost.fragmentShader));p.attachShader(ca.program,L("vertex",THREE.ShaderLib.shadowPost.vertexShader));p.linkProgram(ca.program);ca.vertexLocation=p.getAttribLocation(ca.program,"position");ca.projectionLocation=p.getUniformLocation(ca.program,
"projectionMatrix");ca.darknessLocation=p.getUniformLocation(ca.program,"darkness")}var da={};da.vertices=new Float32Array(16);da.faces=new Uint16Array(6);b=0;da.vertices[b++]=-1;da.vertices[b++]=-1;da.vertices[b++]=0;da.vertices[b++]=0;da.vertices[b++]=1;da.vertices[b++]=-1;da.vertices[b++]=1;da.vertices[b++]=0;da.vertices[b++]=1;da.vertices[b++]=1;da.vertices[b++]=1;da.vertices[b++]=1;da.vertices[b++]=-1;da.vertices[b++]=1;da.vertices[b++]=0;da.vertices[b++]=1;b=0;da.faces[b++]=0;da.faces[b++]=
1;da.faces[b++]=2;da.faces[b++]=0;da.faces[b++]=2;da.faces[b++]=3;da.vertexBuffer=p.createBuffer();da.elementBuffer=p.createBuffer();da.tempTexture=p.createTexture();da.occlusionTexture=p.createTexture();p.bindBuffer(p.ARRAY_BUFFER,da.vertexBuffer);p.bufferData(p.ARRAY_BUFFER,da.vertices,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,da.elementBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,da.faces,p.STATIC_DRAW);p.bindTexture(p.TEXTURE_2D,da.tempTexture);p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,
0,p.RGB,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);p.bindTexture(p.TEXTURE_2D,da.occlusionTexture);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,
p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);if(p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){da.hasVertexTexture=!1;da.program=p.createProgram();p.attachShader(da.program,L("fragment",THREE.ShaderLib.lensFlare.fragmentShader));p.attachShader(da.program,L("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{da.hasVertexTexture=!0;da.program=p.createProgram();p.attachShader(da.program,L("fragment",
THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));p.attachShader(da.program,L("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}p.linkProgram(da.program);da.attributes={};da.uniforms={};da.attributes.vertex=p.getAttribLocation(da.program,"position");da.attributes.uv=p.getAttribLocation(da.program,"UV");da.uniforms.renderType=p.getUniformLocation(da.program,"renderType");da.uniforms.map=p.getUniformLocation(da.program,"map");da.uniforms.occlusionMap=p.getUniformLocation(da.program,
"occlusionMap");da.uniforms.opacity=p.getUniformLocation(da.program,"opacity");da.uniforms.scale=p.getUniformLocation(da.program,"scale");da.uniforms.rotation=p.getUniformLocation(da.program,"rotation");da.uniforms.screenPosition=p.getUniformLocation(da.program,"screenPosition");var Oa=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=
-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=p.createBuffer();_sprite.elementBuffer=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,_sprite.vertexBuffer);
p.bufferData(p.ARRAY_BUFFER,_sprite.vertices,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,_sprite.faces,p.STATIC_DRAW);_sprite.program=p.createProgram();p.attachShader(_sprite.program,L("fragment",THREE.ShaderLib.sprite.fragmentShader));p.attachShader(_sprite.program,L("vertex",THREE.ShaderLib.sprite.vertexShader));p.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=p.getAttribLocation(_sprite.program,
"position");_sprite.attributes.uv=p.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=p.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=p.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=p.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=p.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=p.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=p.getUniformLocation(_sprite.program,
"map");_sprite.uniforms.opacity=p.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=p.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=p.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=p.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=p.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=p.getUniformLocation(_sprite.program,
"projectionMatrix");var cb=!1;this.setSize=function(z,P){ha.width=z;ha.height=P;this.setViewport(0,0,ha.width,ha.height)};this.setViewport=function(z,P,J,K){ya=z;va=P;Ha=J;Da=K;p.viewport(ya,va,Ha,Da)};this.setScissor=function(z,P,J,K){p.scissor(z,P,J,K)};this.enableScissorTest=function(z){z?p.enable(p.SCISSOR_TEST):p.disable(p.SCISSOR_TEST)};this.enableDepthBufferWrite=function(z){Z=z;p.depthMask(z)};this.setClearColorHex=function(z,P){var J=new THREE.Color(z);p.clearColor(J.r,J.g,J.b,P)};this.setClearColor=
function(z,P){p.clearColor(z.r,z.g,z.b,P)};this.clear=function(){p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT|p.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(z){ca.darkness=z};this.getContext=function(){return p};this.initMaterial=function(z,P,J,K){var M,T,W;if(z instanceof THREE.MeshDepthMaterial)W="depth";else if(z instanceof THREE.ShadowVolumeDynamicMaterial)W="shadowVolumeDynamic";else if(z instanceof THREE.MeshNormalMaterial)W="normal";else if(z instanceof THREE.MeshBasicMaterial)W=
"basic";else if(z instanceof THREE.MeshLambertMaterial)W="lambert";else if(z instanceof THREE.MeshPhongMaterial)W="phong";else if(z instanceof THREE.LineBasicMaterial)W="basic";else z instanceof THREE.ParticleBasicMaterial&&(W="particle_basic");if(W){var R=THREE.ShaderLib[W];z.uniforms=THREE.UniformsUtils.clone(R.uniforms);z.vertexShader=R.vertexShader;z.fragmentShader=R.fragmentShader}var Y,S,X;Y=X=R=0;for(S=P.length;Y<S;Y++){T=P[Y];T instanceof THREE.DirectionalLight&&X++;T instanceof THREE.PointLight&&
R++}if(R+X<=4)P=X;else{P=Math.ceil(4*X/(R+X));R=4-P}T={directional:P,point:R};X=50;if(K!==undefined&&K instanceof THREE.SkinnedMesh)X=K.bones.length;var U;a:{Y=z.fragmentShader;S=z.vertexShader;R=z.uniforms;P=z.attributes;J={map:!!z.map,envMap:!!z.envMap,lightMap:!!z.lightMap,vertexColors:z.vertexColors,fog:J,sizeAttenuation:z.sizeAttenuation,skinning:z.skinning,morphTargets:z.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:T.directional,maxPointLights:T.point,maxBones:X};var ma;T=
[];if(W)T.push(W);else{T.push(Y);T.push(S)}for(ma in J){T.push(ma);T.push(J[ma])}W=T.join();ma=0;for(T=fa.length;ma<T;ma++)if(fa[ma].code==W){U=fa[ma].program;break a}ma=p.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+J.maxDirLights,"#define MAX_POINT_LIGHTS "+J.maxPointLights,J.fog?"#define USE_FOG":"",J.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",J.map?"#define USE_MAP":"",J.envMap?"#define USE_ENVMAP":"",J.lightMap?"#define USE_LIGHTMAP":
"",J.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");prefix_vertex=[la?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+J.maxDirLights,"#define MAX_POINT_LIGHTS "+J.maxPointLights,"#define MAX_BONES "+J.maxBones,J.map?"#define USE_MAP":"",J.envMap?"#define USE_ENVMAP":"",J.lightMap?"#define USE_LIGHTMAP":"",J.vertexColors?"#define USE_COLOR":"",J.skinning?"#define USE_SKINNING":"",J.morphTargets?"#define USE_MORPHTARGETS":"",J.sizeAttenuation?
"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
p.attachShader(ma,L("fragment",prefix_fragment+Y));p.attachShader(ma,L("vertex",prefix_vertex+S));p.linkProgram(ma);p.getProgramParameter(ma,p.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+p.getProgramParameter(ma,p.VALIDATE_STATUS)+", gl error ["+p.getError()+"]");ma.uniforms={};ma.attributes={};var ka;Y=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(ka in R)Y.push(ka);ka=Y;R=0;for(Y=ka.length;R<Y;R++){S=ka[R];ma.uniforms[S]=p.getUniformLocation(ma,S)}Y=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(ka=0;ka<J.maxMorphTargets;ka++)Y.push("morphTarget"+ka);for(U in P)Y.push(U);U=Y;ka=0;for(P=U.length;ka<P;ka++){J=U[ka];ma.attributes[J]=p.getAttribLocation(ma,J)}fa.push({program:ma,code:W});U=ma}z.program=U;U=z.program.attributes;p.enableVertexAttribArray(U.position);U.color>=0&&p.enableVertexAttribArray(U.color);
U.normal>=0&&p.enableVertexAttribArray(U.normal);U.tangent>=0&&p.enableVertexAttribArray(U.tangent);if(z.skinning&&U.skinVertexA>=0&&U.skinVertexB>=0&&U.skinIndex>=0&&U.skinWeight>=0){p.enableVertexAttribArray(U.skinVertexA);p.enableVertexAttribArray(U.skinVertexB);p.enableVertexAttribArray(U.skinIndex);p.enableVertexAttribArray(U.skinWeight)}for(M in z.attributes)U[M]>=0&&p.enableVertexAttribArray(U[M]);if(z.morphTargets){z.numSupportedMorphTargets=0;if(U.morphTarget0>=0){p.enableVertexAttribArray(U.morphTarget0);
z.numSupportedMorphTargets++}if(U.morphTarget1>=0){p.enableVertexAttribArray(U.morphTarget1);z.numSupportedMorphTargets++}if(U.morphTarget2>=0){p.enableVertexAttribArray(U.morphTarget2);z.numSupportedMorphTargets++}if(U.morphTarget3>=0){p.enableVertexAttribArray(U.morphTarget3);z.numSupportedMorphTargets++}if(U.morphTarget4>=0){p.enableVertexAttribArray(U.morphTarget4);z.numSupportedMorphTargets++}if(U.morphTarget5>=0){p.enableVertexAttribArray(U.morphTarget5);z.numSupportedMorphTargets++}if(U.morphTarget6>=
0){p.enableVertexAttribArray(U.morphTarget6);z.numSupportedMorphTargets++}if(U.morphTarget7>=0){p.enableVertexAttribArray(U.morphTarget7);z.numSupportedMorphTargets++}K.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);z=0;for(M=this.maxMorphTargets;z<M;z++)K.__webglMorphTargetInfluences[z]=0}};this.render=function(z,P,J,K){var M,T,W,R,Y,S,X,U,ma=z.lights,ka=z.fog;ea.data.vertices=0;ea.data.faces=0;ea.data.drawCalls=0;P.matrixAutoUpdate&&P.update(undefined,!0);z.update(undefined,
!1,P);P.matrixWorldInverse.flattenToArray(Ua);P.projectionMatrix.flattenToArray(La);Aa.multiply(P.projectionMatrix,P.matrixWorldInverse);n(Aa);this.initWebGLObjects(z);O(J);(this.autoClear||K)&&this.clear();Y=z.__webglObjects.length;for(K=0;K<Y;K++){M=z.__webglObjects[K];X=M.object;if(X.visible)if(!(X instanceof THREE.Mesh)||m(X)){X.matrixWorld.flattenToArray(X._objectMatrixArray);A(X,P);u(M);M.render=!0;if(this.sortObjects){Ya.copy(X.position);Aa.multiplyVector3(Ya);M.z=Ya.z}}else M.render=!1;else M.render=
!1}this.sortObjects&&z.__webglObjects.sort(w);S=z.__webglObjectsImmediate.length;for(K=0;K<S;K++){M=z.__webglObjectsImmediate[K];X=M.object;if(X.visible){X.matrixAutoUpdate&&X.matrixWorld.flattenToArray(X._objectMatrixArray);A(X,P);t(M)}}G(THREE.NormalBlending);for(K=0;K<Y;K++){M=z.__webglObjects[K];if(M.render){X=M.object;U=M.buffer;W=M.opaque;h(X);for(M=0;M<W.count;M++){R=W.list[M];g(R.depthTest);d(P,ma,ka,R,U,X)}}}for(K=0;K<S;K++){M=z.__webglObjectsImmediate[K];X=M.object;if(X.visible){W=M.opaque;
h(X);for(M=0;M<W.count;M++){R=W.list[M];g(R.depthTest);T=c(P,ma,ka,R,X);X.render(function(Ea){f(Ea,T,R.shading)})}}}for(K=0;K<Y;K++){M=z.__webglObjects[K];if(M.render){X=M.object;U=M.buffer;W=M.transparent;h(X);for(M=0;M<W.count;M++){R=W.list[M];G(R.blending);g(R.depthTest);d(P,ma,ka,R,U,X)}}}for(K=0;K<S;K++){M=z.__webglObjectsImmediate[K];X=M.object;if(X.visible){W=M.transparent;h(X);for(M=0;M<W.count;M++){R=W.list[M];G(R.blending);g(R.depthTest);T=c(P,ma,ka,R,X);X.render(function(Ea){f(Ea,T,R.shading)})}}}z.__webglSprites.length&&
x(z,P);stencil&&z.__webglShadowVolumes.length&&z.lights.length&&v(z);z.__webglLensFlares.length&&y(z,P);if(J&&J.minFilter!==THREE.NearestFilter&&J.minFilter!==THREE.LinearFilter){p.bindTexture(p.TEXTURE_2D,J.__webglTexture);p.generateMipmap(p.TEXTURE_2D);p.bindTexture(p.TEXTURE_2D,null)}};this.initWebGLObjects=function(z){if(!z.__webglObjects){z.__webglObjects=[];z.__webglObjectsImmediate=[];z.__webglShadowVolumes=[];z.__webglLensFlares=[];z.__webglSprites=[]}for(;z.__objectsAdded.length;){var P=
z.__objectsAdded[0],J=z,K=void 0,M=void 0,T=void 0;if(P._modelViewMatrix==undefined){P._modelViewMatrix=new THREE.Matrix4;P._normalMatrixArray=new Float32Array(9);P._modelViewMatrixArray=new Float32Array(16);P._objectMatrixArray=new Float32Array(16);P.matrixWorld.flattenToArray(P._objectMatrixArray)}if(P instanceof THREE.Mesh){M=P.geometry;M.geometryGroups==undefined&&D(M);for(K in M.geometryGroups){T=M.geometryGroups[K];if(!T.__webglVertexBuffer){var W=T;W.__webglVertexBuffer=p.createBuffer();W.__webglNormalBuffer=
p.createBuffer();W.__webglTangentBuffer=p.createBuffer();W.__webglColorBuffer=p.createBuffer();W.__webglUVBuffer=p.createBuffer();W.__webglUV2Buffer=p.createBuffer();W.__webglSkinVertexABuffer=p.createBuffer();W.__webglSkinVertexBBuffer=p.createBuffer();W.__webglSkinIndicesBuffer=p.createBuffer();W.__webglSkinWeightsBuffer=p.createBuffer();W.__webglFaceBuffer=p.createBuffer();W.__webglLineBuffer=p.createBuffer();if(W.numMorphTargets){var R=void 0,Y=void 0;W.__webglMorphTargetsBuffers=[];R=0;for(Y=
W.numMorphTargets;R<Y;R++)W.__webglMorphTargetsBuffers.push(p.createBuffer())}W=T;R=P;var S=void 0,X=void 0,U=void 0,ma=void 0,ka=void 0,Ea=void 0,Ja=Ea=Y=0,Ga=void 0;ma=R.geometry;Ga=ma.faces;ka=W.faces;S=0;for(X=ka.length;S<X;S++){U=ka[S];U=Ga[U];if(U instanceof THREE.Face3){Y+=3;Ea+=1;Ja+=3}else if(U instanceof THREE.Face4){Y+=4;Ea+=2;Ja+=4}}S=W;X=R;var Na=void 0,Za=void 0;U=[];Ga=0;for(ka=X.materials.length;Ga<ka;Ga++){Na=X.materials[Ga];if(Na instanceof THREE.MeshFaceMaterial){Na=0;for(l=S.materials.length;Na<
l;Na++)(Za=S.materials[Na])&&U.push(Za)}else(Za=Na)&&U.push(Za)}S=U;a:{ka=S.length;for(X=0;X<ka;X++){Ga=S[X];if(Ga.map||Ga.lightMap||Ga instanceof THREE.MeshShaderMaterial){X=!0;break a}}X=!1}a:{Ga=S;Na=Ga.length;for(ka=0;ka<Na;ka++){U=Ga[ka];if(!(U instanceof THREE.MeshBasicMaterial&&!U.envMap||U instanceof THREE.MeshDepthMaterial)){Ga=U&&U.shading!=undefined&&U.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}Ga=!1}a:{Na=S.length;for(ka=0;ka<Na;ka++){U=S[ka];if(U.vertexColors){U=
U.vertexColors;break a}}U=!1}W.__vertexArray=new Float32Array(Y*3);if(Ga)W.__normalArray=new Float32Array(Y*3);if(ma.hasTangents)W.__tangentArray=new Float32Array(Y*4);if(U)W.__colorArray=new Float32Array(Y*3);if(X){if(ma.faceUvs.length>0||ma.faceVertexUvs.length>0)W.__uvArray=new Float32Array(Y*2);if(ma.faceUvs.length>1||ma.faceVertexUvs.length>1)W.__uv2Array=new Float32Array(Y*2)}if(R.geometry.skinWeights.length&&R.geometry.skinIndices.length){W.__skinVertexAArray=new Float32Array(Y*4);W.__skinVertexBArray=
new Float32Array(Y*4);W.__skinIndexArray=new Float32Array(Y*4);W.__skinWeightArray=new Float32Array(Y*4)}W.__faceArray=new Uint16Array(Ea*3+(R.geometry.edgeFaces?R.geometry.edgeFaces.length*6:0));W.__lineArray=new Uint16Array(Ja*2);if(W.numMorphTargets){W.__morphTargetsArrays=[];ma=0;for(ka=W.numMorphTargets;ma<ka;ma++)W.__morphTargetsArrays.push(new Float32Array(Y*3))}W.__needsSmoothNormals=Ga==THREE.SmoothShading;W.__uvType=X;W.__vertexColorType=U;W.__normalType=Ga;W.__webglFaceCount=Ea*3+(R.geometry.edgeFaces?
R.geometry.edgeFaces.length*6:0);W.__webglLineCount=Ja*2;ma=0;for(ka=S.length;ma<ka;ma++)if(S[ma].attributes){W.__webglCustomAttributes={};for(a in S[ma].attributes){X=S[ma].attributes[a];if(!X.__webglInitialized||X.createUniqueBuffers){X.__webglInitialized=!0;Ea=1;if(X.type==="v2")Ea=2;else if(X.type==="v3")Ea=3;else if(X.type==="v4")Ea=4;else X.type==="c"&&(Ea=3);X.size=Ea;X.needsUpdate=!0;X.array=new Float32Array(Y*Ea);X.buffer=p.createBuffer();X.buffer.belongsToAttribute=a}W.__webglCustomAttributes[a]=
X}}M.__dirtyVertices=!0;M.__dirtyMorphTargets=!0;M.__dirtyElements=!0;M.__dirtyUvs=!0;M.__dirtyNormals=!0;M.__dirtyTangents=!0;M.__dirtyColors=!0}P instanceof THREE.ShadowVolume?C(J.__webglShadowVolumes,T,P):C(J.__webglObjects,T,P)}}else if(P instanceof THREE.LensFlare)C(J.__webglLensFlares,undefined,P);else if(P instanceof THREE.Ribbon){M=P.geometry;if(!M.__webglVertexBuffer){K=M;K.__webglVertexBuffer=p.createBuffer();K.__webglColorBuffer=p.createBuffer();K=M;T=K.vertices.length;K.__vertexArray=
new Float32Array(T*3);K.__colorArray=new Float32Array(T*3);K.__webglVertexCount=T;M.__dirtyVertices=!0;M.__dirtyColors=!0}C(J.__webglObjects,M,P)}else if(P instanceof THREE.Line){M=P.geometry;if(!M.__webglVertexBuffer){K=M;K.__webglVertexBuffer=p.createBuffer();K.__webglColorBuffer=p.createBuffer();K=M;T=K.vertices.length;K.__vertexArray=new Float32Array(T*3);K.__colorArray=new Float32Array(T*3);K.__webglLineCount=T;M.__dirtyVertices=!0;M.__dirtyColors=!0}C(J.__webglObjects,M,P)}else if(P instanceof
THREE.ParticleSystem){M=P.geometry;if(!M.__webglVertexBuffer){K=M;K.__webglVertexBuffer=p.createBuffer();K.__webglColorBuffer=p.createBuffer();K=M;T=K.vertices.length;K.__vertexArray=new Float32Array(T*3);K.__colorArray=new Float32Array(T*3);K.__sortArray=[];K.__webglParticleCount=T;M.__dirtyVertices=!0;M.__dirtyColors=!0}C(J.__webglObjects,M,P)}else if(THREE.MarchingCubes!==undefined&&P instanceof THREE.MarchingCubes)J.__webglObjectsImmediate.push({object:P,opaque:{list:[],count:0},transparent:{list:[],
count:0}});else P instanceof THREE.Sprite&&J.__webglSprites.push(P);z.__objectsAdded.splice(0,1)}for(;z.__objectsRemoved.length;){P=z.__objectsRemoved[0];J=z;if(P instanceof THREE.Mesh)for(M=J.__webglObjects.length-1;M>=0;M--){K=J.__webglObjects[M].object;if(P==K){J.__webglObjects.splice(M,1);break}}else if(P instanceof THREE.Sprite)for(M=J.__webglSprites.length-1;M>=0;M--){K=J.__webglSprites[M];if(P==K){J.__webglSprites.splice(M,1);break}}z.__objectsRemoved.splice(0,1)}P=0;for(J=z.__webglObjects.length;P<
J;P++)B(z.__webglObjects[P].object,z);P=0;for(J=z.__webglShadowVolumes.length;P<J;P++)B(z.__webglShadowVolumes[P].object,z);P=0;for(J=z.__webglLensFlares.length;P<J;P++)B(z.__webglLensFlares[P].object,z)};this.setFaceCulling=function(z,P){if(z){!P||P=="ccw"?p.frontFace(p.CCW):p.frontFace(p.CW);if(z=="back")p.cullFace(p.BACK);else z=="front"?p.cullFace(p.FRONT):p.cullFace(p.FRONT_AND_BACK);p.enable(p.CULL_FACE)}else p.disable(p.CULL_FACE)};this.supportsVertexTextures=function(){return la}};
THREE.WebGLRenderTarget=function(b,e,c){this.width=b;this.height=e;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==
undefined?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:!0};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,e,c){c&&b.update(undefined,!1,e);c=b.sounds;var d,f=c.length;for(d=0;d<f;d++){b=c[d];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(e.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};
THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.materials=null};
THREE.AnimationHandler=function(){var b=[],e={},c={};c.update=function(f){for(var h=0;h<b.length;h++)b[h].update(f)};c.addToUpdate=function(f){b.indexOf(f)===-1&&b.push(f)};c.removeFromUpdate=function(f){f=b.indexOf(f);f!==-1&&b.splice(f,1)};c.add=function(f){e[f.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.");e[f.name]=f;if(f.initialized!==!0){for(var h=0;h<f.hierarchy.length;h++){for(var g=0;g<f.hierarchy[h].keys.length;g++){if(f.hierarchy[h].keys[g].time<
0)f.hierarchy[h].keys[g].time=0;if(f.hierarchy[h].keys[g].rot!==undefined&&!(f.hierarchy[h].keys[g].rot instanceof THREE.Quaternion)){var n=f.hierarchy[h].keys[g].rot;f.hierarchy[h].keys[g].rot=new THREE.Quaternion(n[0],n[1],n[2],n[3])}}if(f.hierarchy[h].keys[0].morphTargets!==undefined){n={};for(g=0;g<f.hierarchy[h].keys.length;g++)for(var m=0;m<f.hierarchy[h].keys[g].morphTargets.length;m++){var o=f.hierarchy[h].keys[g].morphTargets[m];n[o]=-1}f.hierarchy[h].usedMorphTargets=n;for(g=0;g<f.hierarchy[h].keys.length;g++){var t=
{};for(o in n){for(m=0;m<f.hierarchy[h].keys[g].morphTargets.length;m++)if(f.hierarchy[h].keys[g].morphTargets[m]===o){t[o]=f.hierarchy[h].keys[g].morphTargetsInfluences[m];break}m===f.hierarchy[h].keys[g].morphTargets.length&&(t[o]=0)}f.hierarchy[h].keys[g].morphTargetsInfluences=t}}for(g=1;g<f.hierarchy[h].keys.length;g++)if(f.hierarchy[h].keys[g].time===f.hierarchy[h].keys[g-1].time){f.hierarchy[h].keys.splice(g,1);g--}for(g=1;g<f.hierarchy[h].keys.length;g++)f.hierarchy[h].keys[g].index=g}g=parseInt(f.length*
f.fps,10);f.JIT={};f.JIT.hierarchy=[];for(h=0;h<f.hierarchy.length;h++)f.JIT.hierarchy.push(Array(g));f.initialized=!0}};c.get=function(f){if(typeof f==="string")if(e[f])return e[f];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}};c.parse=function(f){var h=[];if(f instanceof THREE.SkinnedMesh)for(var g=0;g<f.bones.length;g++)h.push(f.bones[g]);else d(f,h);return h};var d=function(f,h){h.push(f);for(var g=0;g<f.children.length;g++)d(f.children[g],h)};c.LINEAR=
0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,e,c,d){this.root=b;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.JITCompile=d!==undefined?d:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,e){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==undefined?b:!0;this.currentTime=e!==undefined?e:0;var c,d=this.hierarchy.length,f;for(c=0;c<d;c++){f=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=!0;f.matrixAutoUpdate=!0;if(f.animationCache===undefined){f.animationCache={};f.animationCache.prevKey={pos:0,rot:0,scl:0};f.animationCache.nextKey={pos:0,rot:0,scl:0};f.animationCache.originalMatrix=
f instanceof THREE.Bone?f.skinMatrix:f.matrix}var h=f.animationCache.prevKey;f=f.animationCache.nextKey;h.pos=this.data.hierarchy[c].keys[0];h.rot=this.data.hierarchy[c].keys[0];h.scl=this.data.hierarchy[c].keys[0];f.pos=this.getNextKeyWith("pos",c,1);f.rot=this.getNextKeyWith("rot",c,1);f.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==undefined){if(this.hierarchy[b]instanceof THREE.Bone)this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix;else this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var e=["pos","rot","scl"],c,d,f,h,g,n,m,o,t=this.data.JIT.hierarchy,u,w;this.currentTime+=b*this.timeScale;w=this.currentTime;u=this.currentTime%=this.data.length;o=parseInt(Math.min(u*this.data.fps,this.data.length*this.data.fps),10);for(var v=0,x=this.hierarchy.length;v<x;v++){b=this.hierarchy[v];m=b.animationCache;if(this.JITCompile&&t[v][o]!==undefined)if(b instanceof THREE.Bone){b.skinMatrix=t[v][o];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=
!1}else{b.matrix=t[v][o];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(b instanceof THREE.Bone)b.skinMatrix=b.animationCache.originalMatrix;else b.matrix=b.animationCache.originalMatrix;for(var y=0;y<3;y++){c=e[y];g=m.prevKey[c];n=m.nextKey[c];if(n.time<=w){if(u<w)if(this.loop){g=this.data.hierarchy[v].keys[0];for(n=this.getNextKeyWith(c,v,1);n.time<u;){g=n;n=this.getNextKeyWith(c,v,n.index+1)}}else{this.stop();return}else{do{g=n;n=this.getNextKeyWith(c,v,n.index+1)}while(n.time<
u)}m.prevKey[c]=g;m.nextKey[c]=n}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;d=(u-g.time)/(n.time-g.time);f=g[c];h=n[c];if(d<0||d>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+v);d=d<0?0:1}if(c==="pos"){c=b.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=f[0]+(h[0]-f[0])*d;c.y=f[1]+(h[1]-f[1])*d;c.z=f[2]+(h[2]-f[2])*d}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",v,g.index-1).pos;this.points[1]=f;this.points[2]=h;this.points[3]=this.getNextKeyWith("pos",v,n.index+1).pos;d=d*0.33+0.33;f=this.interpolateCatmullRom(this.points,d);c.x=f[0];c.y=f[1];c.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){d=this.interpolateCatmullRom(this.points,d*1.01);this.target.set(d[0],d[1],d[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();d=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,d,0)}}}else if(c===
"rot")THREE.Quaternion.slerp(f,h,b.quaternion,d);else if(c==="scl"){c=b.scale;c.x=f[0]+(h[0]-f[0])*d;c.y=f[1]+(h[1]-f[1])*d;c.z=f[2]+(h[2]-f[2])*d}}}}if(this.JITCompile&&t[0][o]===undefined){this.hierarchy[0].update(undefined,!0);for(v=0;v<this.hierarchy.length;v++)t[v][o]=this.hierarchy[v]instanceof THREE.Bone?this.hierarchy[v].skinMatrix.clone():this.hierarchy[v].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,e){var c=[],d=[],f,h,g,n,m,o;f=(b.length-1)*e;h=Math.floor(f);f-=h;c[0]=h==0?h:h-1;c[1]=h;c[2]=h>b.length-2?h:h+1;c[3]=h>b.length-3?h:h+2;h=b[c[0]];n=b[c[1]];m=b[c[2]];o=b[c[3]];c=f*f;g=f*c;d[0]=this.interpolate(h[0],n[0],m[0],o[0],f,c,g);d[1]=this.interpolate(h[1],n[1],m[1],o[1],f,c,g);d[2]=this.interpolate(h[2],n[2],m[2],o[2],f,c,g);return d};
THREE.Animation.prototype.interpolate=function(b,e,c,d,f,h,g){b=(c-b)*0.5;d=(d-e)*0.5;return(2*(e-c)+b+d)*g+(-3*(e-c)-2*b-d)*h+b*f+e};THREE.Animation.prototype.getNextKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<d.length-1?c:d.length-1;else c%=d.length;for(;c<d.length;c++)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[d.length-1]};
THREE.ColorUtils={adjustHSV:function(b,e,c,d){var f=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,f);f.h=THREE.ColorUtils.clamp(f.h+e,0,1);f.s=THREE.ColorUtils.clamp(f.s+c,0,1);f.v=THREE.ColorUtils.clamp(f.v+d,0,1);b.setHSV(f.h,f.s,f.v)},rgbToHsv:function(b,e){var c=b.r,d=b.g,f=b.b,h=Math.max(Math.max(c,d),f),g=Math.min(Math.min(c,d),f);if(g==h)g=c=0;else{var n=h-g;g=n/h;c=c==h?(d-f)/n:d==h?2+(f-c)/n:4+(c-d)/n;c/=6;c<0&&(c+=1);c>1&&(c-=1)}e===undefined&&(e={h:0,s:0,v:0});e.h=c;e.s=g;e.v=h;return e},
clamp:function(b,e,c){return b<e?e:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,e){var c=e instanceof THREE.Mesh,d=b.vertices.length,f=c?e.geometry:e,h=b.vertices,g=f.vertices,n=b.faces,m=f.faces,o=b.faceVertexUvs[0];f=f.faceVertexUvs[0];c&&e.matrixAutoUpdate&&e.updateMatrix();for(var t=0,u=g.length;t<u;t++){var w=new THREE.Vertex(g[t].position.clone());c&&e.matrix.multiplyVector3(w.position);h.push(w)}t=0;for(u=m.length;t<u;t++){g=m[t];var v,x,y=g.vertexNormals;w=g.vertexColors;if(g instanceof THREE.Face3)v=new THREE.Face3(g.a+d,g.b+d,g.c+
d);else g instanceof THREE.Face4&&(v=new THREE.Face4(g.a+d,g.b+d,g.c+d,g.d+d));v.normal.copy(g.normal);c=0;for(h=y.length;c<h;c++){x=y[c];v.vertexNormals.push(x.clone())}v.color.copy(g.color);c=0;for(h=w.length;c<h;c++){x=w[c];v.vertexColors.push(x.clone())}v.materials=g.materials.slice();v.centroid.copy(g.centroid);n.push(v)}t=0;for(u=f.length;t<u;t++){d=f[t];n=[];c=0;for(h=d.length;c<h;c++)n.push(new THREE.UV(d[c].u,d[c].v));o.push(n)}}};
THREE.ImageUtils={loadTexture:function(b,e,c){var d=new Image,f=new THREE.Texture(d,e);d.onload=function(){f.needsUpdate=!0;c&&c(this)};d.src=b;return f},loadTextureCube:function(b,e,c){var d,f=[],h=new THREE.Texture(f,e);e=f.loadCount=0;for(d=b.length;e<d;++e){f[e]=new Image;f[e].onload=function(){f.loadCount+=1;if(f.loadCount==6)h.needsUpdate=!0;c&&c(this)};f[e].src=b[e]}return h}};
THREE.SceneUtils={addMesh:function(b,e,c,d,f,h,g,n,m,o){e=new THREE.Mesh(e,o);e.scale.x=e.scale.y=e.scale.z=c;e.position.x=d;e.position.y=f;e.position.z=h;e.rotation.x=g;e.rotation.y=n;e.rotation.z=m;b.addObject(e);return e},addPanoramaCubeWebGL:function(b,e,c){var d=THREE.ShaderUtils.lib.cube;d.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms});e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,1,null,!0),c);b.addObject(e);
return e},addPanoramaCube:function(b,e,c){var d=[];d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,d,!0),
new THREE.MeshFaceMaterial);b.addObject(e);return e},addPanoramaCubePlanes:function(b,e,c){var d=e/2;e=new THREE.Plane(e,e);var f=Math.PI,h=Math.PI/2;THREE.SceneUtils.addMesh(b,e,1,0,0,-d,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,e,1,-d,0,0,0,h,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,e,1,d,0,0,0,-h,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,e,1,0,d,0,h,
0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,e,1,0,-d,0,-h,0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,e){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=e})},traverseHierarchy:function(b,e){var c,d,f=b.children.length;for(d=0;d<f;d++){c=b.children[d];e(c);THREE.SceneUtils.traverseHierarchy(c,e)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var e,c,d,f,h=2*Math.ceil(b*3)+1;h>25&&(h=25);f=(h-1)*0.5;c=Array(h);for(e=d=0;e<h;++e){c[e]=Math.exp(-((e-f)*(e-f))/(2*b*b));d+=c[e]}for(e=0;e<h;++e)c[e]/=d;return c}};
THREE.QuakeCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.noFly!==undefined)this.noFly=b.noFly;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.autoForward!==undefined)this.autoForward=b.autoForward;if(b.activeLook!==undefined)this.activeLook=b.activeLook;if(b.heightSpeed!==undefined)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==undefined)this.heightCoef=b.heightCoef;if(b.heightMin!==undefined)this.heightMin=b.heightMin;if(b.heightMax!==undefined)this.heightMax=
b.heightMax;if(b.constrainVertical!==undefined)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==undefined)this.verticalMin=b.verticalMin;if(b.verticalMax!==undefined)this.verticalMax=b.verticalMax;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.moveForward=!1;this.moveBackward=!1;this.moveLeft=!1;this.moveRight=!1;this.freeze=!1;this.mouseDragOn=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=
window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=
function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/
1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var d=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(d+this.autoSpeedFactor));this.moveBackward&&this.translateZ(d);this.moveLeft&&this.translateX(-d);this.moveRight&&this.translateX(d);d=this.tdiff*this.lookSpeed;
this.activeLook||(d=0);this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=
(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",e(this,
this.onMouseMove),!1);this.domElement.addEventListener("mousedown",e(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",e(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",e(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",e(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);if(this.noFly)e.y=0;this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};
THREE.PathCamera=function(b){function e(o,t,u,w){var v={name:u,fps:0.6,length:w,hierarchy:[]},x,y=t.getControlPointsArray(),A=t.getLength(),B=y.length,D=0;x=B-1;t={parent:-1,keys:[]};t.keys[0]={time:0,pos:y[0],rot:[0,0,0,1],scl:[1,1,1]};t.keys[x]={time:w,pos:y[x],rot:[0,0,0,1],scl:[1,1,1]};for(x=1;x<B-1;x++){D=w*A.chunks[x]/A.total;t.keys[x]={time:D,pos:y[x]}}v.hierarchy[0]=t;THREE.AnimationHandler.add(v);return new THREE.Animation(o,u,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(o,t){var u,
w,v=new THREE.Geometry;for(u=0;u<o.points.length*t;u++){w=u/(o.points.length*t);w=o.getPoint(w);v.vertices[u]=new THREE.Vertex(new THREE.Vector3(w.x,w.y,w.z))}return v}function d(o,t){var u=c(t,10),w=c(t,10),v=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(u,v);particleObj=new THREE.ParticleSystem(w,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);o.addChild(lineObj);particleObj.scale.set(1,1,1);o.addChild(particleObj);w=new THREE.Sphere(1,
16,8);v=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<t.points.length;i++){u=new THREE.Mesh(w,v);u.position.copy(t.points[i]);u.updateMatrix();o.addChild(u)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.0050;this.lookVertical=
!0;this.lookHorizontal=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==undefined)this.duration=b.duration*1E3;if(b.waypoints!==undefined)this.waypoints=b.waypoints;if(b.useConstantSpeed!==undefined)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==undefined)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==undefined)this.createDebugPath=b.createDebugPath;
if(b.createDebugDummy!==undefined)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==undefined)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==undefined)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==undefined)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var f=Math.PI*2,h=Math.PI/180;this.update=function(o,t,u){var w,v;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*h;this.theta=this.lon*h;w=this.phi%f;this.phi=w>=0?w:w+f;w=this.verticalAngleMap.srcRange;v=this.verticalAngleMap.dstRange;
this.phi=(this.phi-w[0])*(v[1]-v[0])/(w[1]-w[0])+v[0];w=this.horizontalAngleMap.srcRange;v=this.horizontalAngleMap.dstRange;this.theta=(this.theta-w[0])*(v[1]-v[0])/(w[1]-w[0])+v[0];w=this.target.position;w.x=100*Math.sin(this.phi)*Math.cos(this.theta);w.y=100*Math.cos(this.phi);w.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,o,t,u)};this.onMouseMove=function(o){this.mouseX=o.clientX-this.windowHalfX;this.mouseY=o.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);
this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var g=new THREE.MeshLambertMaterial({color:65280}),n=new THREE.Cube(10,10,20),m=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(n,b);b=new THREE.Mesh(m,g);b.position.set(0,10,0);this.animation=e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=
e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&d(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(o,t){return function(){t.apply(o,arguments)}}(this,this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.0050;this.dragToLook=!1;this.autoForward=!1;this.domElement=document;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==undefined)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==undefined)this.dragToLook=b.dragToLook;if(b.autoForward!==undefined)this.autoForward=
b.autoForward;if(b.domElement!==undefined)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var d=this.getContainerDimensions(),f=d.size[0]/2,h=d.size[1]/2;this.moveState.yawLeft=-(c.clientX-d.offset[0]-f)/f;this.moveState.pitchDown=(c.clientY-
d.offset[1]-h)/h;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var d=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*d,this.rotationVector.y*d,this.rotationVector.z*d,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",e(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",e(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",e(this,this.mouseup),!1);window.addEventListener("keydown",e(this,this.keydown),!1);window.addEventListener("keyup",e(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,e,c,d){THREE.Camera.call(this,b,e,c,d);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.useTarget=!1;this.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var f=new THREE.Vector3,h=new THREE.Vector3,g=new THREE.Vector3,n=new THREE.Matrix4,m=!1,o=1,t=0,u=0,w=0,v=0,x=0,y=window.innerWidth/2,A=window.innerHeight/2;this.update=
function(){var B=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=B;this.delta=(B-this.lastUpdate)/1E3;this.lastUpdate=B;if(this.mouseLook){B=this.delta*this.lookSpeed;this.rotateHorizontally(B*v);this.rotateVertically(B*x)}B=this.delta*this.movementSpeed;this.translateZ(B*(t>0||this.autoForward&&!(t<0)?1:t));this.translateX(B*u);this.translateY(B*w);m&&(this.roll+=this.rollSpeed*this.delta*o);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}g.copy(this.forward);h.set(0,1,0);f.cross(h,g).normalize();h.cross(g,f).normalize();this.matrix.n11=f.x;this.matrix.n12=h.x;this.matrix.n13=g.x;this.matrix.n21=f.y;this.matrix.n22=h.y;this.matrix.n23=g.y;this.matrix.n31=f.z;this.matrix.n32=h.z;this.matrix.n33=g.z;n.identity();n.n11=Math.cos(this.roll);n.n12=-Math.sin(this.roll);n.n21=Math.sin(this.roll);n.n22=Math.cos(this.roll);this.matrix.multiplySelf(n);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(B){this.position.x+=this.matrix.n11*B;this.position.y+=this.matrix.n21*B;this.position.z+=this.matrix.n31*B};this.translateY=function(B){this.position.x+=this.matrix.n12*B;this.position.y+=this.matrix.n22*B;this.position.z+=this.matrix.n32*B};this.translateZ=function(B){this.position.x-=this.matrix.n13*B;this.position.y-=
this.matrix.n23*B;this.position.z-=this.matrix.n33*B};this.rotateHorizontally=function(B){f.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);f.multiplyScalar(B);this.forward.subSelf(f);this.forward.normalize()};this.rotateVertically=function(B){h.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);h.multiplyScalar(B);this.forward.addSelf(h);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(B){B.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(B){v=(B.clientX-y)/window.innerWidth;x=(B.clientY-A)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(B){B.preventDefault();B.stopPropagation();switch(B.button){case 0:t=1;break;case 2:t=-1}},!1);this.domElement.addEventListener("mouseup",function(B){B.preventDefault();B.stopPropagation();switch(B.button){case 0:t=0;break;case 2:t=0}},!1);this.domElement.addEventListener("keydown",function(B){switch(B.keyCode){case 38:case 87:t=1;break;case 37:case 65:u=-1;break;
case 40:case 83:t=-1;break;case 39:case 68:u=1;break;case 81:m=!0;o=1;break;case 69:m=!0;o=-1;break;case 82:w=1;break;case 70:w=-1}},!1);this.domElement.addEventListener("keyup",function(B){switch(B.keyCode){case 38:case 87:t=0;break;case 37:case 65:u=0;break;case 40:case 83:t=0;break;case 39:case 68:u=0;break;case 81:m=!1;break;case 69:m=!1;break;case 82:w=0;break;case 70:w=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.Cube=function(b,e,c,d,f,h,g,n,m){function o(A,B,D,C,G,F,E,O){var L,H,N=d||1,ea=f||1,p=G/2,ha=F/2,fa=t.vertices.length;if(A=="x"&&B=="y"||A=="y"&&B=="x")L="z";else if(A=="x"&&B=="z"||A=="z"&&B=="x"){L="y";ea=h||1}else if(A=="z"&&B=="y"||A=="y"&&B=="z"){L="x";N=h||1}var oa=N+1,V=ea+1;G/=N;var Z=F/ea;for(H=0;H<V;H++)for(F=0;F<oa;F++){var aa=new THREE.Vector3;aa[A]=(F*G-p)*D;aa[B]=(H*Z-ha)*C;aa[L]=E;t.vertices.push(new THREE.Vertex(aa))}for(H=0;H<ea;H++)for(F=0;F<N;F++){t.faces.push(new THREE.Face4(F+
oa*H+fa,F+oa*(H+1)+fa,F+1+oa*(H+1)+fa,F+1+oa*H+fa,null,null,O));t.faceVertexUvs[0].push([new THREE.UV(F/N,H/ea),new THREE.UV(F/N,(H+1)/ea),new THREE.UV((F+1)/N,(H+1)/ea),new THREE.UV((F+1)/N,H/ea)])}}THREE.Geometry.call(this);var t=this,u=b/2,w=e/2,v=c/2;n=n?-1:1;if(g!==undefined)if(g instanceof Array)this.materials=g;else{this.materials=[];for(var x=0;x<6;x++)this.materials.push([g])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(m!=undefined)for(var y in m)this.sides[y]!=
undefined&&(this.sides[y]=m[y]);this.sides.px&&o("z","y",1*n,-1,c,e,-u,this.materials[0]);this.sides.nx&&o("z","y",-1*n,-1,c,e,u,this.materials[1]);this.sides.py&&o("x","z",1*n,1,b,c,w,this.materials[2]);this.sides.ny&&o("x","z",1*n,-1,b,c,-w,this.materials[3]);this.sides.pz&&o("x","y",1*n,-1,b,e,v,this.materials[4]);this.sides.nz&&o("x","y",-1*n,-1,b,e,-v,this.materials[5]);(function(){for(var A=[],B=[],D=0,C=t.vertices.length;D<C;D++){for(var G=t.vertices[D],F=!1,E=0,O=A.length;E<O;E++){var L=A[E];
if(G.position.x==L.position.x&&G.position.y==L.position.y&&G.position.z==L.position.z){B[D]=E;F=!0;break}}if(!F){B[D]=A.length;A.push(new THREE.Vertex(G.position.clone()))}}D=0;for(C=t.faces.length;D<C;D++){G=t.faces[D];G.a=B[G.a];G.b=B[G.b];G.c=B[G.c];G.d=B[G.d]}t.vertices=A})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,e,c,d,f,h){function g(w,v,x){n.vertices.push(new THREE.Vertex(new THREE.Vector3(w,v,x)))}THREE.Geometry.call(this);var n=this,m,o=Math.PI*2,t=d/2;for(m=0;m<b;m++)g(Math.sin(o*m/b)*e,Math.cos(o*m/b)*e,-t);for(m=0;m<b;m++)g(Math.sin(o*m/b)*c,Math.cos(o*m/b)*c,t);for(m=0;m<b;m++)n.faces.push(new THREE.Face4(m,m+b,b+(m+1)%b,(m+1)%b));if(c>0){g(0,0,-t-(h||0));for(m=b;m<b+b/2;m++)n.faces.push(new THREE.Face4(2*b,(2*m-2*b)%b,(2*m-2*b+1)%b,(2*m-2*b+2)%b))}if(e>0){g(0,0,t+(f||0));
for(m=b+b/2;m<2*b;m++)n.faces.push(new THREE.Face4(2*b+1,(2*m-2*b+2)%b+b,(2*m-2*b+1)%b+b,(2*m-2*b)%b+b))}m=0;for(b=this.faces.length;m<b;m++){e=[];c=this.faces[m];f=this.vertices[c.a];h=this.vertices[c.b];t=this.vertices[c.c];var u=this.vertices[c.d];e.push(new THREE.UV(0.5+Math.atan2(f.position.x,f.position.y)/o,0.5+f.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(h.position.x,h.position.y)/o,0.5+h.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(t.position.x,t.position.y)/o,0.5+t.position.z/
d));c instanceof THREE.Face4&&e.push(new THREE.UV(0.5+Math.atan2(u.position.x,u.position.y)/o,0.5+u.position.z/d));this.faceVertexUvs[0].push(e)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function e(u,w,v){var x=Math.sqrt(u*u+w*w+v*v);return f.vertices.push(new THREE.Vertex(new THREE.Vector3(u/x,w/x,v/x)))-1}function c(u,w,v,x){x.faces.push(new THREE.Face3(u,w,v))}function d(u,w){var v=f.vertices[u].position,x=f.vertices[w].position;return e((v.x+x.x)/2,(v.y+x.y)/2,(v.z+x.z)/2)}var f=this,h=new THREE.Geometry,g;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;e(-1,b,0);e(1,b,0);e(-1,-b,0);e(1,-b,0);e(0,-1,b);e(0,1,b);e(0,-1,-b);e(0,
1,-b);e(b,0,-1);e(b,0,1);e(-b,0,-1);e(-b,0,1);c(0,11,5,h);c(0,5,1,h);c(0,1,7,h);c(0,7,10,h);c(0,10,11,h);c(1,5,9,h);c(5,11,4,h);c(11,10,2,h);c(10,7,6,h);c(7,1,8,h);c(3,9,4,h);c(3,4,2,h);c(3,2,6,h);c(3,6,8,h);c(3,8,9,h);c(4,9,5,h);c(2,4,11,h);c(6,2,10,h);c(8,6,7,h);c(9,8,1,h);for(b=0;b<this.subdivisions;b++){g=new THREE.Geometry;for(var n in h.faces){var m=d(h.faces[n].a,h.faces[n].b),o=d(h.faces[n].b,h.faces[n].c),t=d(h.faces[n].c,h.faces[n].a);c(h.faces[n].a,m,t,g);c(h.faces[n].b,o,m,g);c(h.faces[n].c,
t,o,g);c(m,o,t,g)}h.faces=g.faces}f.faces=h.faces;delete h;delete g;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,e,c){THREE.Geometry.call(this);this.steps=e||12;this.angle=c||2*Math.PI;e=this.angle/this.steps;c=[];for(var d=[],f=[],h=[],g=(new THREE.Matrix4).setRotationZ(e),n=0;n<b.length;n++){this.vertices.push(new THREE.Vertex(b[n]));c[n]=b[n].clone();d[n]=this.vertices.length-1}for(var m=0;m<=this.angle+0.0010;m+=e){for(n=0;n<c.length;n++)if(m<this.angle){c[n]=g.multiplyVector3(c[n].clone());this.vertices.push(new THREE.Vertex(c[n]));f[n]=this.vertices.length-1}else f=h;m==0&&(h=d);
for(n=0;n<d.length-1;n++){this.faces.push(new THREE.Face4(f[n],f[n+1],d[n+1],d[n]));this.faceVertexUvs[0].push([new THREE.UV(1-m/this.angle,n/b.length),new THREE.UV(1-m/this.angle,(n+1)/b.length),new THREE.UV(1-(m-e)/this.angle,(n+1)/b.length),new THREE.UV(1-(m-e)/this.angle,n/b.length)])}d=f;f=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,e,c,d){THREE.Geometry.call(this);var f,h=b/2,g=e/2;c=c||1;d=d||1;var n=c+1,m=d+1;b/=c;var o=e/d;for(f=0;f<m;f++)for(e=0;e<n;e++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(e*b-h,-(f*o-g),0)));for(f=0;f<d;f++)for(e=0;e<c;e++){this.faces.push(new THREE.Face4(e+n*f,e+n*(f+1),e+1+n*(f+1),e+1+n*f));this.faceVertexUvs[0].push([new THREE.UV(e/c,f/d),new THREE.UV(e/c,(f+1)/d),new THREE.UV((e+1)/c,(f+1)/d),new THREE.UV((e+1)/c,f/d)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,e,c){THREE.Geometry.call(this);var d,f=Math.PI,h=Math.max(3,e||8),g=Math.max(2,c||6);e=[];for(c=0;c<g+1;c++){d=c/g;var n=b*Math.cos(d*f),m=b*Math.sin(d*f),o=[],t=0;for(d=0;d<h;d++){var u=2*d/h,w=m*Math.sin(u*f);u=m*Math.cos(u*f);(c==0||c==g)&&d>0||(t=this.vertices.push(new THREE.Vertex(new THREE.Vector3(u,n,w)))-1);o.push(t)}e.push(o)}var v,x,y;f=e.length;for(c=0;c<f;c++){h=e[c].length;if(c>0)for(d=0;d<h;d++){o=d==h-1;g=e[c][o?0:d+1];n=e[c][o?h-1:d];m=e[c-1][o?h-1:d];o=e[c-
1][o?0:d+1];w=c/(f-1);v=(c-1)/(f-1);x=(d+1)/h;u=d/h;t=new THREE.UV(1-x,w);w=new THREE.UV(1-u,w);u=new THREE.UV(1-u,v);var A=new THREE.UV(1-x,v);if(c<e.length-1){v=this.vertices[g].position.clone();x=this.vertices[n].position.clone();y=this.vertices[m].position.clone();v.normalize();x.normalize();y.normalize();this.faces.push(new THREE.Face3(g,n,m,[new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([t,w,u])}if(c>1){v=this.vertices[g].position.clone();
x=this.vertices[m].position.clone();y=this.vertices[o].position.clone();v.normalize();x.normalize();y.normalize();this.faces.push(new THREE.Face3(g,m,o,[new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([t,u,A])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,e,c,d){THREE.Geometry.call(this);this.radius=b||100;this.tube=e||40;this.segmentsR=c||8;this.segmentsT=d||6;b=[];for(e=0;e<=this.segmentsR;++e)for(c=0;c<=this.segmentsT;++c){d=c/this.segmentsT*2*Math.PI;var f=e/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(f))*Math.cos(d),(this.radius+this.tube*Math.cos(f))*Math.sin(d),this.tube*Math.sin(f))));b.push([c/this.segmentsT,1-e/this.segmentsR])}for(e=1;e<=this.segmentsR;++e)for(c=
1;c<=this.segmentsT;++c){d=(this.segmentsT+1)*e+c;f=(this.segmentsT+1)*e+c-1;var h=(this.segmentsT+1)*(e-1)+c-1,g=(this.segmentsT+1)*(e-1)+c;this.faces.push(new THREE.Face4(d,f,h,g));this.faceVertexUvs[0].push([new THREE.UV(b[d][0],b[d][1]),new THREE.UV(b[f][0],b[f][1]),new THREE.UV(b[h][0],b[h][1]),new THREE.UV(b[g][0],b[g][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,e,c,d,f,h,g){function n(u,w,v,x,y,A){w=v/x*u;v=Math.cos(w);return new THREE.Vector3(y*(2+v)*0.5*Math.cos(u),y*(2+v)*Math.sin(u)*0.5,A*y*Math.sin(w)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=e||40;this.segmentsR=c||64;this.segmentsT=d||8;this.p=f||2;this.q=h||3;this.heightScale=g||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;d=new THREE.Vector3;h=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(e=0;e<this.segmentsT;++e){var m=
b/this.segmentsR*2*this.p*Math.PI;g=e/this.segmentsT*2*Math.PI;f=n(m,g,this.q,this.p,this.radius,this.heightScale);m=n(m+0.01,g,this.q,this.p,this.radius,this.heightScale);c.x=m.x-f.x;c.y=m.y-f.y;c.z=m.z-f.z;d.x=m.x+f.x;d.y=m.y+f.y;d.z=m.z+f.z;h.cross(c,d);d.cross(h,c);h.normalize();d.normalize();m=-this.tube*Math.cos(g);g=this.tube*Math.sin(g);f.x+=m*d.x+g*h.x;f.y+=m*d.y+g*h.y;f.z+=m*d.z+g*h.z;this.grid[b][e]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(f.x,f.y,f.z)))-1}}for(b=0;b<this.segmentsR;++b)for(e=
0;e<this.segmentsT;++e){d=(b+1)%this.segmentsR;h=(e+1)%this.segmentsT;f=this.grid[b][e];c=this.grid[d][e];d=this.grid[d][h];h=this.grid[b][h];g=new THREE.UV(b/this.segmentsR,e/this.segmentsT);m=new THREE.UV((b+1)/this.segmentsR,e/this.segmentsT);var o=new THREE.UV((b+1)/this.segmentsR,(e+1)/this.segmentsT),t=new THREE.UV(b/this.segmentsR,(e+1)/this.segmentsT);this.faces.push(new THREE.Face4(f,c,d,h));this.faceVertexUvs[0].push([g,m,o,t])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var e="Loaded ";e+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=e},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,e,c){b.materials=[];for(var d=0;d<e.length;++d)b.materials[d]=[THREE.Loader.prototype.createMaterial(e[d],c)]},createMaterial:function(b,e){function c(n){n=Math.log(n)/Math.LN2;return Math.floor(n)==n}function d(n,m){var o=new Image;o.onload=function(){if(!c(this.width)||!c(this.height)){var t=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),u=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));n.image.width=t;n.image.height=u;n.image.getContext("2d").drawImage(this,0,0,t,u)}else n.image=this;n.needsUpdate=!0};o.src=m}var f,h,g;f="MeshLambertMaterial";h={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};if(b.shading)if(b.shading=="Phong")f="MeshPhongMaterial";else b.shading=="Basic"&&(f="MeshBasicMaterial");if(b.blending)if(b.blending=="Additive")h.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")h.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")h.blending=THREE.MultiplyBlending;if(b.transparent!==undefined||b.opacity<1)h.transparent=b.transparent;if(b.depthTest!==undefined)h.depthTest=b.depthTest;if(b.vertexColors!==undefined)if(b.vertexColors=="face")h.vertexColors=THREE.FaceColors;else if(b.vertexColors)h.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&e){g=document.createElement("canvas");h.map=new THREE.Texture(g);h.map.sourceFile=b.mapDiffuse;d(h.map,e+"/"+b.mapDiffuse)}else if(b.colorDiffuse){g=(b.colorDiffuse[0]*255<<
16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255;h.color=g;h.opacity=b.transparency}else if(b.DbgColor)h.color=b.DbgColor;if(b.mapLightmap&&e){g=document.createElement("canvas");h.lightMap=new THREE.Texture(g);h.lightMap.sourceFile=b.mapLightmap;d(h.lightMap,e+"/"+b.mapLightmap)}return new THREE[f](h)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var e=this,c=b.model,d=b.callback,f=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(h){e.createModel(h.data,d,f);e.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,e,c){var d=new THREE.Geometry,f=b.scale!==undefined?1/b.scale:1;this.init_materials(d,b.materials,c);(function(h){if(b.version===undefined||b.version!=2)console.error("Deprecated file format.");else{var g,n,m,o,t,u,w,v,x,y,A,B,D,C,G=b.faces;u=b.vertices;var F=b.normals,E=b.colors,O=0;for(g=0;g<b.uvs.length;g++)b.uvs[g].length&&O++;for(g=0;g<O;g++){d.faceUvs[g]=[];d.faceVertexUvs[g]=[]}o=0;for(t=u.length;o<t;){w=new THREE.Vertex;w.position.x=u[o++]*
h;w.position.y=u[o++]*h;w.position.z=u[o++]*h;d.vertices.push(w)}o=0;for(t=G.length;o<t;){h=G[o++];u=h&1;m=h&2;g=h&4;n=h&8;v=h&16;w=h&32;y=h&64;h&=128;if(u){A=new THREE.Face4;A.a=G[o++];A.b=G[o++];A.c=G[o++];A.d=G[o++];u=4}else{A=new THREE.Face3;A.a=G[o++];A.b=G[o++];A.c=G[o++];u=3}if(m){m=G[o++];A.materials=d.materials[m]}m=d.faces.length;if(g)for(g=0;g<O;g++){B=b.uvs[g];x=G[o++];C=B[x*2];x=B[x*2+1];d.faceUvs[g][m]=new THREE.UV(C,x)}if(n)for(g=0;g<O;g++){B=b.uvs[g];D=[];for(n=0;n<u;n++){x=G[o++];
C=B[x*2];x=B[x*2+1];D[n]=new THREE.UV(C,x)}d.faceVertexUvs[g][m]=D}if(v){v=G[o++]*3;n=new THREE.Vector3;n.x=F[v++];n.y=F[v++];n.z=F[v];A.normal=n}if(w)for(g=0;g<u;g++){v=G[o++]*3;n=new THREE.Vector3;n.x=F[v++];n.y=F[v++];n.z=F[v];A.vertexNormals.push(n)}if(y){w=G[o++];w=new THREE.Color(E[w]);A.color=w}if(h)for(g=0;g<u;g++){w=G[o++];w=new THREE.Color(E[w]);A.vertexColors.push(w)}d.faces.push(A)}}})(f);(function(){var h,g,n,m;if(b.skinWeights){h=0;for(g=b.skinWeights.length;h<g;h+=2){n=b.skinWeights[h];
m=b.skinWeights[h+1];d.skinWeights.push(new THREE.Vector4(n,m,0,0))}}if(b.skinIndices){h=0;for(g=b.skinIndices.length;h<g;h+=2){n=b.skinIndices[h];m=b.skinIndices[h+1];d.skinIndices.push(new THREE.Vector4(n,m,0,0))}}d.bones=b.bones;d.animation=b.animation})();(function(h){if(b.morphTargets!==undefined){var g,n,m,o,t,u,w,v,x;g=0;for(n=b.morphTargets.length;g<n;g++){d.morphTargets[g]={};d.morphTargets[g].name=b.morphTargets[g].name;d.morphTargets[g].vertices=[];v=d.morphTargets[g].vertices;x=b.morphTargets[g].vertices;
m=0;for(o=x.length;m<o;m+=3){t=x[m]*h;u=x[m+1]*h;w=x[m+2]*h;v.push(new THREE.Vertex(new THREE.Vector3(t,u,w)))}}}if(b.morphColors!==undefined){g=0;for(n=b.morphColors.length;g<n;g++){d.morphColors[g]={};d.morphColors[g].name=b.morphColors[g].name;d.morphColors[g].colors=[];o=d.morphColors[g].colors;t=b.morphColors[g].colors;h=0;for(m=t.length;h<m;h+=3){u=new THREE.Color(16755200);u.setRGB(t[h],t[h+1],t[h+2]);o.push(u)}}}})(f);(function(){if(b.edges!==undefined){var h,g,n;for(h=0;h<b.edges.length;h+=
2){g=b.edges[h];n=b.edges[h+1];d.edges.push(new THREE.Edge(d.vertices[g],d.vertices[n],g,n))}}})();d.computeFaceNormals();e(d)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var e=b.model,c=b.callback,d=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(e),f=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(e);b=(new Date).getTime();e=new Worker(e);var h=this.showProgress?THREE.Loader.prototype.updateProgress:null;e.onmessage=function(g){THREE.BinaryLoader.prototype.loadAjaxBuffers(g.data.buffers,g.data.materials,c,f,d,h)};e.onerror=function(g){alert("worker.onerror: "+g.message+"\n"+g.data);g.preventDefault()};
e.postMessage(b)},loadAjaxBuffers:function(b,e,c,d,f,h){var g=new XMLHttpRequest,n=d+"/"+b,m=0;g.onreadystatechange=function(){if(g.readyState==4)g.status==200||g.status==0?THREE.BinaryLoader.prototype.createBinModel(g.responseText,c,f,e):alert("Couldn't load ["+n+"] ["+g.status+"]");else if(g.readyState==3){if(h){m==0&&(m=g.getResponseHeader("Content-Length"));h({total:m,loaded:g.responseText.length})}}else g.readyState==2&&(m=g.getResponseHeader("Content-Length"))};g.open("GET",n,!0);g.overrideMimeType("text/plain; charset=x-user-defined");
g.setRequestHeader("Content-Type","text/plain");g.send(null)},createBinModel:function(b,e,c,d){var f=function(h){function g($,la){var ca=t($,la),da=t($,la+1),Oa=t($,la+2),cb=t($,la+3),z=(cb<<1&255|Oa>>7)-127;ca|=(Oa&127)<<16|da<<8;if(ca==0&&z==-127)return 0;return(1-2*(cb>>7))*(1+ca*Math.pow(2,-23))*Math.pow(2,z)}function n($,la){var ca=t($,la),da=t($,la+1),Oa=t($,la+2);return(t($,la+3)<<24)+(Oa<<16)+(da<<8)+ca}function m($,la){var ca=t($,la);return(t($,la+1)<<8)+ca}function o($,la){var ca=t($,la);
return ca>127?ca-256:ca}function t($,la){return $.charCodeAt(la)&255}function u($){var la,ca,da;la=n(b,$);ca=n(b,$+E);da=n(b,$+O);$=m(b,$+L);THREE.BinaryLoader.prototype.f3(B,la,ca,da,$)}function w($){var la,ca,da,Oa,cb,z;la=n(b,$);ca=n(b,$+E);da=n(b,$+O);Oa=m(b,$+L);cb=n(b,$+H);z=n(b,$+N);$=n(b,$+ea);THREE.BinaryLoader.prototype.f3n(B,G,la,ca,da,Oa,cb,z,$)}function v($){var la,ca,da,Oa;la=n(b,$);ca=n(b,$+p);da=n(b,$+ha);Oa=n(b,$+fa);$=m(b,$+oa);THREE.BinaryLoader.prototype.f4(B,la,ca,da,Oa,$)}function x($){var la,
ca,da,Oa,cb,z,P,J;la=n(b,$);ca=n(b,$+p);da=n(b,$+ha);Oa=n(b,$+fa);cb=m(b,$+oa);z=n(b,$+V);P=n(b,$+Z);J=n(b,$+aa);$=n(b,$+pa);THREE.BinaryLoader.prototype.f4n(B,G,la,ca,da,Oa,cb,z,P,J,$)}function y($){var la,ca;la=n(b,$);ca=n(b,$+na);$=n(b,$+sa);THREE.BinaryLoader.prototype.uv3(B.faceVertexUvs[0],F[la*2],F[la*2+1],F[ca*2],F[ca*2+1],F[$*2],F[$*2+1])}function A($){var la,ca,da;la=n(b,$);ca=n(b,$+ya);da=n(b,$+va);$=n(b,$+Ha);THREE.BinaryLoader.prototype.uv4(B.faceVertexUvs[0],F[la*2],F[la*2+1],F[ca*2],
F[ca*2+1],F[da*2],F[da*2+1],F[$*2],F[$*2+1])}var B=this,D=0,C,G=[],F=[],E,O,L,H,N,ea,p,ha,fa,oa,V,Z,aa,pa,na,sa,ya,va,Ha,Da,ra,Aa,La,Ua,Ya;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(B,d,h);C={signature:b.substr(D,8),header_bytes:t(b,D+8),vertex_coordinate_bytes:t(b,D+9),normal_coordinate_bytes:t(b,D+10),uv_coordinate_bytes:t(b,D+11),vertex_index_bytes:t(b,D+12),normal_index_bytes:t(b,D+13),uv_index_bytes:t(b,D+14),material_index_bytes:t(b,D+15),nvertices:n(b,D+16),nnormals:n(b,
D+16+4),nuvs:n(b,D+16+8),ntri_flat:n(b,D+16+12),ntri_smooth:n(b,D+16+16),ntri_flat_uv:n(b,D+16+20),ntri_smooth_uv:n(b,D+16+24),nquad_flat:n(b,D+16+28),nquad_smooth:n(b,D+16+32),nquad_flat_uv:n(b,D+16+36),nquad_smooth_uv:n(b,D+16+40)};D+=C.header_bytes;E=C.vertex_index_bytes;O=C.vertex_index_bytes*2;L=C.vertex_index_bytes*3;H=C.vertex_index_bytes*3+C.material_index_bytes;N=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes;ea=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes*
2;p=C.vertex_index_bytes;ha=C.vertex_index_bytes*2;fa=C.vertex_index_bytes*3;oa=C.vertex_index_bytes*4;V=C.vertex_index_bytes*4+C.material_index_bytes;Z=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes;aa=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*2;pa=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*3;na=C.uv_index_bytes;sa=C.uv_index_bytes*2;ya=C.uv_index_bytes;va=C.uv_index_bytes*2;Ha=C.uv_index_bytes*3;h=C.vertex_index_bytes*3+C.material_index_bytes;
Ya=C.vertex_index_bytes*4+C.material_index_bytes;Da=C.ntri_flat*h;ra=C.ntri_smooth*(h+C.normal_index_bytes*3);Aa=C.ntri_flat_uv*(h+C.uv_index_bytes*3);La=C.ntri_smooth_uv*(h+C.normal_index_bytes*3+C.uv_index_bytes*3);Ua=C.nquad_flat*Ya;h=C.nquad_smooth*(Ya+C.normal_index_bytes*4);Ya=C.nquad_flat_uv*(Ya+C.uv_index_bytes*4);D+=function($){for(var la,ca,da,Oa=C.vertex_coordinate_bytes*3,cb=$+C.nvertices*Oa;$<cb;$+=Oa){la=g(b,$);ca=g(b,$+C.vertex_coordinate_bytes);da=g(b,$+C.vertex_coordinate_bytes*2);
THREE.BinaryLoader.prototype.v(B,la,ca,da)}return C.nvertices*Oa}(D);D+=function($){for(var la,ca,da,Oa=C.normal_coordinate_bytes*3,cb=$+C.nnormals*Oa;$<cb;$+=Oa){la=o(b,$);ca=o(b,$+C.normal_coordinate_bytes);da=o(b,$+C.normal_coordinate_bytes*2);G.push(la/127,ca/127,da/127)}return C.nnormals*Oa}(D);D+=function($){for(var la,ca,da=C.uv_coordinate_bytes*2,Oa=$+C.nuvs*da;$<Oa;$+=da){la=g(b,$);ca=g(b,$+C.uv_coordinate_bytes);F.push(la,ca)}return C.nuvs*da}(D);Da=D+Da;ra=Da+ra;Aa=ra+Aa;La=Aa+La;Ua=La+
Ua;h=Ua+h;Ya=h+Ya;(function($){var la,ca=C.vertex_index_bytes*3+C.material_index_bytes,da=ca+C.uv_index_bytes*3,Oa=$+C.ntri_flat_uv*da;for(la=$;la<Oa;la+=da){u(la);y(la+ca)}return Oa-$})(ra);(function($){var la,ca=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes*3,da=ca+C.uv_index_bytes*3,Oa=$+C.ntri_smooth_uv*da;for(la=$;la<Oa;la+=da){w(la);y(la+ca)}return Oa-$})(Aa);(function($){var la,ca=C.vertex_index_bytes*4+C.material_index_bytes,da=ca+C.uv_index_bytes*4,Oa=$+C.nquad_flat_uv*
da;for(la=$;la<Oa;la+=da){v(la);A(la+ca)}return Oa-$})(h);(function($){var la,ca=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*4,da=ca+C.uv_index_bytes*4,Oa=$+C.nquad_smooth_uv*da;for(la=$;la<Oa;la+=da){x(la);A(la+ca)}return Oa-$})(Ya);(function($){var la,ca=C.vertex_index_bytes*3+C.material_index_bytes,da=$+C.ntri_flat*ca;for(la=$;la<da;la+=ca)u(la);return da-$})(D);(function($){var la,ca=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes*3,da=$+C.ntri_smooth*
ca;for(la=$;la<da;la+=ca)w(la);return da-$})(Da);(function($){var la,ca=C.vertex_index_bytes*4+C.material_index_bytes,da=$+C.nquad_flat*ca;for(la=$;la<da;la+=ca)v(la);return da-$})(La);(function($){var la,ca=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*4,da=$+C.nquad_smooth*ca;for(la=$;la<da;la+=ca)x(la);return da-$})(Ua);this.computeCentroids();this.computeFaceNormals()};f.prototype=new THREE.Geometry;f.prototype.constructor=f;e(new f(c))},v:function(b,e,c,d){b.vertices.push(new THREE.Vertex(new THREE.Vector3(e,
c,d)))},f3:function(b,e,c,d,f){b.faces.push(new THREE.Face3(e,c,d,null,null,b.materials[f]))},f4:function(b,e,c,d,f,h){b.faces.push(new THREE.Face4(e,c,d,f,null,null,b.materials[h]))},f3n:function(b,e,c,d,f,h,g,n,m){h=b.materials[h];var o=e[n*3],t=e[n*3+1];n=e[n*3+2];var u=e[m*3],w=e[m*3+1];m=e[m*3+2];b.faces.push(new THREE.Face3(c,d,f,[new THREE.Vector3(e[g*3],e[g*3+1],e[g*3+2]),new THREE.Vector3(o,t,n),new THREE.Vector3(u,w,m)],null,h))},f4n:function(b,e,c,d,f,h,g,n,m,o,t){g=b.materials[g];var u=
e[m*3],w=e[m*3+1];m=e[m*3+2];var v=e[o*3],x=e[o*3+1];o=e[o*3+2];var y=e[t*3],A=e[t*3+1];t=e[t*3+2];b.faces.push(new THREE.Face4(c,d,f,h,[new THREE.Vector3(e[n*3],e[n*3+1],e[n*3+2]),new THREE.Vector3(u,w,m),new THREE.Vector3(v,x,o),new THREE.Vector3(y,A,t)],null,g))},uv3:function(b,e,c,d,f,h,g){var n=[];n.push(new THREE.UV(e,c));n.push(new THREE.UV(d,f));n.push(new THREE.UV(h,g));b.push(n)},uv4:function(b,e,c,d,f,h,g,n,m){var o=[];o.push(new THREE.UV(e,c));o.push(new THREE.UV(d,f));o.push(new THREE.UV(h,
g));o.push(new THREE.UV(n,m));b.push(o)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,e){var c=this,d=new Worker(b);d.postMessage(0);var f=THREE.Loader.prototype.extractUrlbase(b);d.onmessage=function(h){function g(na,sa){return sa=="relativeToHTML"?na:f+"/"+na}function n(){for(v in N.objects)if(!V.objects[v]){D=N.objects[v];if(D.geometry!==undefined){if(E=V.geometries[D.geometry]){H=[];for(pa=0;pa<D.materials.length;pa++)H[pa]=V.materials[D.materials[pa]];C=D.position;r=D.rotation;q=D.quaternion;s=D.scale;q=0;H.length==0&&(H[0]=new THREE.MeshFaceMaterial);
H.length>1&&(H=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(E,H);object.name=v;object.position.set(C[0],C[1],C[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=D.visible;V.scene.addObject(object);V.objects[v]=object;if(D.meshCollider){var na=THREE.CollisionUtils.MeshColliderWBox(object);V.scene.collisions.colliders.push(na)}if(D.castsShadow){na=new THREE.ShadowVolume(E);V.scene.addChild(na);
na.position=object.position;na.rotation=object.rotation;na.scale=object.scale}if(D.trigger&&D.trigger.toLowerCase()!="none"){na={type:D.trigger,object:D};V.triggers[object.name]=na}}}else{C=D.position;r=D.rotation;q=D.quaternion;s=D.scale;q=0;object=new THREE.Object3D;object.name=v;object.position.set(C[0],C[1],C[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=D.visible!==undefined?
D.visible:!1;V.scene.addObject(object);V.objects[v]=object;V.empties[v]=object;if(D.trigger&&D.trigger.toLowerCase()!="none"){na={type:D.trigger,object:D};V.triggers[object.name]=na}}}}function m(na){return function(sa){V.geometries[na]=sa;n();p-=1;c.onLoadComplete();t()}}function o(na){return function(sa){V.geometries[na]=sa}}function t(){c.callbackProgress({totalModels:fa,totalTextures:oa,loadedModels:fa-p,loadedTextures:oa-ha},V);c.onLoadProgress();p==0&&ha==0&&e(V)}var u,w,v,x,y,A,B,D,C,G,F,E,
O,L,H,N,ea,p,ha,fa,oa,V;N=h.data;h=new THREE.BinaryLoader;ea=new THREE.JSONLoader;ha=p=0;V={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var Z=!1;for(v in N.objects){D=N.objects[v];if(D.meshCollider){Z=!0;break}}if(Z)V.scene.collisions=new THREE.CollisionSystem;if(N.transform){Z=N.transform.position;G=N.transform.rotation;var aa=N.transform.scale;Z&&V.scene.position.set(Z[0],Z[1],Z[2]);G&&V.scene.rotation.set(G[0],G[1],
G[2]);aa&&V.scene.scale.set(aa[0],aa[1],aa[2]);(Z||G||aa)&&V.scene.updateMatrix()}Z=function(){ha-=1;t();c.onLoadComplete()};for(y in N.cameras){G=N.cameras[y];if(G.type=="perspective")O=new THREE.Camera(G.fov,G.aspect,G.near,G.far);else if(G.type=="ortho"){O=new THREE.Camera;O.projectionMatrix=THREE.Matrix4.makeOrtho(G.left,G.right,G.top,G.bottom,G.near,G.far)}C=G.position;G=G.target;O.position.set(C[0],C[1],C[2]);O.target.position.set(G[0],G[1],G[2]);V.cameras[y]=O}for(x in N.lights){y=N.lights[x];
O=y.color!==undefined?y.color:16777215;G=y.intensity!==undefined?y.intensity:1;if(y.type=="directional"){C=y.direction;light=new THREE.DirectionalLight(O,G);light.position.set(C[0],C[1],C[2]);light.position.normalize()}else if(y.type=="point"){C=y.position;light=new THREE.PointLight(O,G);light.position.set(C[0],C[1],C[2])}V.scene.addLight(light);V.lights[x]=light}for(A in N.fogs){x=N.fogs[A];if(x.type=="linear")L=new THREE.Fog(0,x.near,x.far);else x.type=="exp2"&&(L=new THREE.FogExp2(0,x.density));
G=x.color;L.color.setRGB(G[0],G[1],G[2]);V.fogs[A]=L}if(V.cameras&&N.defaults.camera)V.currentCamera=V.cameras[N.defaults.camera];if(V.fogs&&N.defaults.fog)V.scene.fog=V.fogs[N.defaults.fog];G=N.defaults.bgcolor;V.bgColor=new THREE.Color;V.bgColor.setRGB(G[0],G[1],G[2]);V.bgColorAlpha=N.defaults.bgalpha;for(u in N.geometries){A=N.geometries[u];if(A.type=="bin_mesh"||A.type=="ascii_mesh"){p+=1;c.onLoadStart()}}fa=p;for(u in N.geometries){A=N.geometries[u];if(A.type=="cube"){E=new THREE.Cube(A.width,
A.height,A.depth,A.segmentsWidth,A.segmentsHeight,A.segmentsDepth,null,A.flipped,A.sides);V.geometries[u]=E}else if(A.type=="plane"){E=new THREE.Plane(A.width,A.height,A.segmentsWidth,A.segmentsHeight);V.geometries[u]=E}else if(A.type=="sphere"){E=new THREE.Sphere(A.radius,A.segmentsWidth,A.segmentsHeight);V.geometries[u]=E}else if(A.type=="cylinder"){E=new THREE.Cylinder(A.numSegs,A.topRad,A.botRad,A.height,A.topOffset,A.botOffset);V.geometries[u]=E}else if(A.type=="torus"){E=new THREE.Torus(A.radius,
A.tube,A.segmentsR,A.segmentsT);V.geometries[u]=E}else if(A.type=="icosahedron"){E=new THREE.Icosahedron(A.subdivisions);V.geometries[u]=E}else if(A.type=="bin_mesh")h.load({model:g(A.url,N.urlBaseType),callback:m(u)});else if(A.type=="ascii_mesh")ea.load({model:g(A.url,N.urlBaseType),callback:m(u)});else A.type=="embedded_mesh"&&(A=N.embeds[A.id])&&ea.createModel(A,o(u),"")}for(B in N.textures){u=N.textures[B];if(u.url instanceof Array){ha+=u.url.length;for(h=0;h<u.url.length;h++)c.onLoadStart()}else{ha+=
1;c.onLoadStart()}}oa=ha;for(B in N.textures){u=N.textures[B];if(u.mapping!=undefined&&THREE[u.mapping]!=undefined)u.mapping=new THREE[u.mapping];if(u.url instanceof Array){h=[];for(var pa=0;pa<u.url.length;pa++)h[pa]=g(u.url[pa],N.urlBaseType);h=THREE.ImageUtils.loadTextureCube(h,u.mapping,Z)}else{h=THREE.ImageUtils.loadTexture(g(u.url,N.urlBaseType),u.mapping,Z);if(THREE[u.minFilter]!=undefined)h.minFilter=THREE[u.minFilter];if(THREE[u.magFilter]!=undefined)h.magFilter=THREE[u.magFilter]}V.textures[B]=
h}for(w in N.materials){B=N.materials[w];for(F in B.parameters)if(F=="envMap"||F=="map"||F=="lightMap")B.parameters[F]=V.textures[B.parameters[F]];else if(F=="shading")B.parameters[F]=B.parameters[F]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(F=="blending")B.parameters[F]=THREE[B.parameters[F]]?THREE[B.parameters[F]]:THREE.NormalBlending;else if(F=="combine")B.parameters[F]=B.parameters[F]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(F=="vertexColors")if(B.parameters[F]==
"face")B.parameters[F]=THREE.FaceColors;else if(B.parameters[F])B.parameters[F]=THREE.VertexColors;if(B.parameters.opacity!==undefined&&B.parameters.opacity<1)B.parameters.transparent=!0;B=new THREE[B.type](B.parameters);V.materials[w]=B}n();c.callbackSync(V)}}};
THREE.MarchingCubes=function(b,e){THREE.Object3D.call(this);this.materials=e instanceof Array?e:[e];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasPos=!1;this.hasNormal=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,d,f){return c+(d-c)*f};this.VIntX=function(c,d,f,h,g,n,m,o,t,u){g=(g-t)/(u-t);t=this.normal_cache;d[h]=n+g*this.delta;d[h+1]=m;d[h+2]=o;f[h]=this.lerp(t[c],t[c+3],g);f[h+1]=this.lerp(t[c+1],t[c+4],g);f[h+2]=this.lerp(t[c+2],t[c+5],g)};this.VIntY=function(c,d,f,h,g,n,m,o,t,u){g=(g-t)/(u-t);t=this.normal_cache;d[h]=n;d[h+1]=m+g*this.delta;d[h+
2]=o;d=c+this.yd*3;f[h]=this.lerp(t[c],t[d],g);f[h+1]=this.lerp(t[c+1],t[d+1],g);f[h+2]=this.lerp(t[c+2],t[d+2],g)};this.VIntZ=function(c,d,f,h,g,n,m,o,t,u){g=(g-t)/(u-t);t=this.normal_cache;d[h]=n;d[h+1]=m;d[h+2]=o+g*this.delta;d=c+this.zd*3;f[h]=this.lerp(t[c],t[d],g);f[h+1]=this.lerp(t[c+1],t[d+1],g);f[h+2]=this.lerp(t[c+2],t[d+2],g)};this.compNorm=function(c){var d=c*3;if(this.normal_cache[d]==0){this.normal_cache[d]=this.field[c-1]-this.field[c+1];this.normal_cache[d+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[d+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,d,f,h,g,n){var m=h+1,o=h+this.yd,t=h+this.zd,u=m+this.yd,w=m+this.zd,v=h+this.yd+this.zd,x=m+this.yd+this.zd,y=0,A=this.field[h],B=this.field[m],D=this.field[o],C=this.field[u],G=this.field[t],F=this.field[w],E=this.field[v],O=this.field[x];A<g&&(y|=1);B<g&&(y|=2);D<g&&(y|=8);C<g&&(y|=4);G<g&&(y|=16);F<g&&(y|=32);E<g&&(y|=128);O<g&&(y|=64);var L=THREE.edgeTable[y];if(L==0)return 0;
var H=this.delta,N=c+H,ea=d+H;H=f+H;if(L&1){this.compNorm(h);this.compNorm(m);this.VIntX(h*3,this.vlist,this.nlist,0,g,c,d,f,A,B)}if(L&2){this.compNorm(m);this.compNorm(u);this.VIntY(m*3,this.vlist,this.nlist,3,g,N,d,f,B,C)}if(L&4){this.compNorm(o);this.compNorm(u);this.VIntX(o*3,this.vlist,this.nlist,6,g,c,ea,f,D,C)}if(L&8){this.compNorm(h);this.compNorm(o);this.VIntY(h*3,this.vlist,this.nlist,9,g,c,d,f,A,D)}if(L&16){this.compNorm(t);this.compNorm(w);this.VIntX(t*3,this.vlist,this.nlist,12,g,c,d,
H,G,F)}if(L&32){this.compNorm(w);this.compNorm(x);this.VIntY(w*3,this.vlist,this.nlist,15,g,N,d,H,F,O)}if(L&64){this.compNorm(v);this.compNorm(x);this.VIntX(v*3,this.vlist,this.nlist,18,g,c,ea,H,E,O)}if(L&128){this.compNorm(t);this.compNorm(v);this.VIntY(t*3,this.vlist,this.nlist,21,g,c,d,H,G,E)}if(L&256){this.compNorm(h);this.compNorm(t);this.VIntZ(h*3,this.vlist,this.nlist,24,g,c,d,f,A,G)}if(L&512){this.compNorm(m);this.compNorm(w);this.VIntZ(m*3,this.vlist,this.nlist,27,g,N,d,f,B,F)}if(L&1024){this.compNorm(u);
this.compNorm(x);this.VIntZ(u*3,this.vlist,this.nlist,30,g,N,ea,f,C,O)}if(L&2048){this.compNorm(o);this.compNorm(v);this.VIntZ(o*3,this.vlist,this.nlist,33,g,c,ea,f,D,E)}y<<=4;for(g=h=0;THREE.triTable[y+g]!=-1;){c=y+g;d=c+1;f=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[d],3*THREE.triTable[f],n);g+=3;h++}return h};this.posnormtriv=function(c,d,f,h,g,n){var m=this.count*3;this.positionArray[m]=c[f];this.positionArray[m+1]=c[f+1];this.positionArray[m+2]=c[f+2];this.positionArray[m+
3]=c[h];this.positionArray[m+4]=c[h+1];this.positionArray[m+5]=c[h+2];this.positionArray[m+6]=c[g];this.positionArray[m+7]=c[g+1];this.positionArray[m+8]=c[g+2];this.normalArray[m]=d[f];this.normalArray[m+1]=d[f+1];this.normalArray[m+2]=d[f+2];this.normalArray[m+3]=d[h];this.normalArray[m+4]=d[h+1];this.normalArray[m+5]=d[h+2];this.normalArray[m+6]=d[g];this.normalArray[m+7]=d[g+1];this.normalArray[m+8]=d[g+2];this.hasPos=!0;this.hasNormal=!0;this.count+=3;this.count>=this.maxCount-3&&n(this)};this.begin=
function(){this.count=0;this.hasPos=!1;this.hasNormal=!1};this.end=function(c){if(this.count!=0){for(var d=this.count*3;d<this.positionArray.length;d++)this.positionArray[d]=0;c(this)}};this.addBall=function(c,d,f,h,g){var n=this.size*Math.sqrt(h/g),m=f*this.size,o=d*this.size,t=c*this.size,u=Math.floor(m-n);u<1&&(u=1);m=Math.floor(m+n);m>this.size-1&&(m=this.size-1);var w=Math.floor(o-n);w<1&&(w=1);o=Math.floor(o+n);o>this.size-1&&(o=this.size-1);var v=Math.floor(t-n);v<1&&(v=1);n=Math.floor(t+n);
n>this.size-1&&(n=this.size-1);for(var x,y,A,B,D,C;u<m;u++){t=this.size2*u;y=u/this.size-f;D=y*y;for(y=w;y<o;y++){A=t+this.size*y;x=y/this.size-d;C=x*x;for(x=v;x<n;x++){B=x/this.size-c;B=h/(1.0E-6+B*B+C+D)-g;B>0&&(this.field[A+x]+=B)}}}};this.addPlaneX=function(c,d){var f,h,g,n,m,o=this.size,t=this.yd,u=this.zd,w=this.field,v=o*Math.sqrt(c/d);v>o&&(v=o);for(f=0;f<v;f++){h=f/o;h*=h;n=c/(1.0E-4+h)-d;if(n>0)for(h=0;h<o;h++){m=f+h*t;for(g=0;g<o;g++)w[u*g+m]+=n}}};this.addPlaneY=function(c,d){var f,h,
g,n,m,o,t=this.size,u=this.yd,w=this.zd,v=this.field,x=t*Math.sqrt(c/d);x>t&&(x=t);for(h=0;h<x;h++){f=h/t;f*=f;n=c/(1.0E-4+f)-d;if(n>0){m=h*u;for(f=0;f<t;f++){o=m+f;for(g=0;g<t;g++)v[w*g+o]+=n}}}};this.addPlaneZ=function(c,d){var f,h,g,n,m,o;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/d);dist>size&&(dist=size);for(g=0;g<dist;g++){f=g/size;f*=f;n=c/(1.0E-4+f)-d;if(n>0){m=zd*g;for(h=0;h<size;h++){o=m+h*yd;for(f=0;f<size;f++)field[o+f]+=n}}}};this.reset=function(){var c;
for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var d,f,h,g,n,m,o,t,u,w=this.size-2;for(g=1;g<w;g++){u=this.size2*g;o=(g-this.halfsize)/this.halfsize;for(h=1;h<w;h++){t=u+this.size*h;m=(h-this.halfsize)/this.halfsize;for(f=1;f<w;f++){n=(f-this.halfsize)/this.halfsize;d=t+f;this.polygonize(n,m,o,d,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,d=new THREE.Geometry,f=[];this.render(function(h){var g,n,m,o,t,u,w,v;for(g=
0;g<h.count;g++){w=g*3;t=w+1;v=w+2;n=h.positionArray[w];m=h.positionArray[t];o=h.positionArray[v];u=new THREE.Vector3(n,m,o);n=h.normalArray[w];m=h.normalArray[t];o=h.normalArray[v];w=new THREE.Vector3(n,m,o);w.normalize();t=new THREE.Vertex(u);d.vertices.push(t);f.push(w)}nfaces=h.count/3;for(g=0;g<nfaces;g++){w=(c+g)*3;t=w+1;v=w+2;u=f[w];n=f[t];m=f[v];w=new THREE.Face3(w,t,v,[u,n,m]);d.faces.push(w)}c+=nfaces;h.count=0});return d};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;
THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function e(h){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:h}))}function c(h,g){var n=new THREE.Geometry;n.vertices=[new THREE.Vertex,new THREE.Vertex(h)];return new THREE.Line(n,new THREE.LineBasicMaterial({color:g}))}THREE.Object3D.call(this);var d=Math.PI/2,f;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(f in THREE.Trident.defaultParams)b.hasOwnProperty(f)||(b[f]=THREE.Trident.defaultParams[f]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){f=e(b.xAxisColor);f.rotation.y=-d;f.position.x=b.length;this.addChild(f);f=e(b.yAxisColor);f.rotation.x=d;f.position.y=b.length;this.addChild(f);f=e(b.zAxisColor);f.rotation.y=Math.PI;f.position.z=b.length;this.addChild(f)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,e){this.point=b;this.normal=e};THREE.SphereCollider=function(b,e){this.center=b;this.radius=e;this.radiusSq=e*e};THREE.BoxCollider=function(b,e){this.min=b;this.max=e;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,e,c,d){this.vertices=b;this.faces=e;this.normals=c;this.box=d;this.numFaces=this.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var e,c,d,f,h=0;e=0;for(c=this.colliders.length;e<c;e++){f=this.colliders[e];d=this.rayCast(b,f);if(d<Number.MAX_VALUE){f.distance=d;d>h?this.hits.push(f):this.hits.unshift(f);h=d}}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var e=this.rayCastAll(b);if(e.length==0)return null;for(var c=0;e[c]instanceof THREE.MeshCollider;){var d=this.rayMesh(b,e[c]);if(d<Number.MAX_VALUE){e[c].distance=d;break}c++}if(c>e.length)return null;return e[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,e){if(e instanceof THREE.PlaneCollider)return this.rayPlane(b,e);else if(e instanceof THREE.SphereCollider)return this.raySphere(b,e);else if(e instanceof THREE.BoxCollider)return this.rayBox(b,e);else if(e instanceof THREE.MeshCollider&&e.box)return this.rayBox(b,e.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,e){for(var c=this.makeRayLocal(b,e.mesh),d=Number.MAX_VALUE,f=0;f<e.numFaces/3;f++){var h=f*3;h=this.rayTriangle(c,e.vertices[e.faces[h+0]],e.vertices[e.faces[h+1]],e.vertices[e.faces[h+2]],d,this.collisionNormal);if(h<d){d=h;e.normal.copy(this.collisionNormal);e.normal.normalize()}}return d};
THREE.CollisionSystem.prototype.rayTriangle=function(b,e,c,d,f,h){var g=THREE.CollisionSystem.__v1,n=THREE.CollisionSystem.__v2;h.set(0,0,0);g.sub(c,e);n.sub(d,c);h.cross(g,n);n=h.dot(b.direction);if(!(n<0))return Number.MAX_VALUE;g=h.dot(e)-h.dot(b.origin);if(!(g<=0))return Number.MAX_VALUE;if(!(g>=n*f))return Number.MAX_VALUE;g/=n;n=THREE.CollisionSystem.__v3;n.copy(b.direction);n.multiplyScalar(g);n.addSelf(b.origin);if(Math.abs(h.x)>Math.abs(h.y))if(Math.abs(h.x)>Math.abs(h.z)){b=n.y-e.y;h=c.y-
e.y;f=d.y-e.y;n=n.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=n.x-e.x;h=c.x-e.x;f=d.x-e.x;n=n.y-e.y;c=c.y-e.y;d=d.y-e.y}else if(Math.abs(h.y)>Math.abs(h.z)){b=n.x-e.x;h=c.x-e.x;f=d.x-e.x;n=n.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=n.x-e.x;h=c.x-e.x;f=d.x-e.x;n=n.y-e.y;c=c.y-e.y;d=d.y-e.y}e=h*d-c*f;if(e==0)return Number.MAX_VALUE;e=1/e;d=(b*d-n*f)*e;if(!(d>=0))return Number.MAX_VALUE;e*=h*n-c*b;if(!(e>=0))return Number.MAX_VALUE;if(!(1-d-e>=0))return Number.MAX_VALUE;return g};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,e){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(e.matrixWorld,c);var d=THREE.CollisionSystem.__r;d.origin.copy(b.origin);d.direction.copy(b.direction);c.multiplyVector3(d.origin);c.rotateAxis(d.direction);d.direction.normalize();return d};
THREE.CollisionSystem.prototype.rayBox=function(b,e){var c;if(e.dynamic&&e.mesh&&e.mesh.matrixWorld)c=this.makeRayLocal(b,e.mesh);else{c=THREE.CollisionSystem.__r;c.origin.copy(b.origin);c.direction.copy(b.direction)}var d=0,f=0,h=0,g=0,n=0,m=0,o=!0;if(c.origin.x<e.min.x){d=e.min.x-c.origin.x;d/=c.direction.x;o=!1;g=-1}else if(c.origin.x>e.max.x){d=e.max.x-c.origin.x;d/=c.direction.x;o=!1;g=1}if(c.origin.y<e.min.y){f=e.min.y-c.origin.y;f/=c.direction.y;o=!1;n=-1}else if(c.origin.y>e.max.y){f=e.max.y-
c.origin.y;f/=c.direction.y;o=!1;n=1}if(c.origin.z<e.min.z){h=e.min.z-c.origin.z;h/=c.direction.z;o=!1;m=-1}else if(c.origin.z>e.max.z){h=e.max.z-c.origin.z;h/=c.direction.z;o=!1;m=1}if(o)return-1;o=0;if(f>d){o=1;d=f}if(h>d){o=2;d=h}switch(o){case 0:n=c.origin.y+c.direction.y*d;if(n<e.min.y||n>e.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(g,0,0);break;case 1:g=c.origin.x+c.direction.x*d;if(g<e.min.x||g>e.max.x)return Number.MAX_VALUE;
c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(0,n,0);break;case 2:g=c.origin.x+c.direction.x*d;if(g<e.min.x||g>e.max.x)return Number.MAX_VALUE;n=c.origin.y+c.direction.y*d;if(n<e.min.y||n>e.max.y)return Number.MAX_VALUE;e.normal.set(0,0,m)}return d};THREE.CollisionSystem.prototype.rayPlane=function(b,e){var c=b.direction.dot(e.normal),d=e.point.dot(e.normal);if(c<0)c=(d-b.origin.dot(e.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,e){var c=e.center.clone().subSelf(b.origin);if(c.lengthSq<e.radiusSq)return-1;var d=c.dot(b.direction.clone());if(d<=0)return Number.MAX_VALUE;c=e.radiusSq-(c.lengthSq()-d*d);if(c>=0)return Math.abs(d)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var e=b.geometry.boundingBox,c=new THREE.Vector3(e.x[0],e.y[0],e.z[0]);e=new THREE.Vector3(e.x[1],e.y[1],e.z[1]);c=new THREE.BoxCollider(c,e);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var e=THREE.CollisionUtils.MeshOBB(b);e.min.addSelf(b.position);e.max.addSelf(b.position);e.dynamic=!1;return e};
THREE.CollisionUtils.MeshColliderWBox=function(b){for(var e=b.geometry.vertices,c=e.length,d=b.geometry.faces,f=d.length,h=[],g=[],n=[],m=0;m<c;m++)h.push(new THREE.Vector3(e[m].position.x,e[m].position.y,e[m].position.z));for(m=0;m<f;m++){g.push(d[m].a,d[m].b,d[m].c);n.push(new THREE.Vector3(d[m].normal.x,d[m].normal.y,d[m].normal.z))}e=new THREE.MeshCollider(h,g,n,THREE.CollisionUtils.MeshOBB(b));e.mesh=b;return e};
var LoadingBar=function(b){function e(){var m=g/h;if(m>n){n=m;f.style.width=m*300+"px"}}var c,d,f,h=0,g=0,n=0;c=document.createElement("div");d=document.createElement("div");d.style.position="absolute";d.style.display="block";d.style.width="300px";d.style.height="8px";d.style.borderStyle="solid";d.style.borderColor="rgba(255,255,255,0.5)";d.style.borderWidth="1px";d.style.borderRadius="5px";c.appendChild(d);f=document.createElement("div");f.style.position="absolute";f.style.height="10px";f.style.width=
"0px";f.style.background="#fff";f.style.borderRadius="5px";c.appendChild(f);c.style.margin="30px 0 0 0";this.addItem=function(){h++;e()};this.completeItem=function(){g++;e();h!=0&&h==g&&b()};this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,e=[],c=[],d=[],f=0,h=0,g=0,n=!1;this.add=function(m,o,t,u){m.__active=!1;m.__start=o;m.__duration=t-o;m.__end=t;m.__layer=u;m.init();e.push(m);e.sort(function(w,v){return w.__start-v.__start});d.push(m);d.sort(function(w,v){return w.__end-v.__end})};this.update=function(m){if(m<g){this.clear();g=m}for(;e[f];){b=e[f];if(b.__start>m)break;if(!b.__active&&b.__end>m){b.show((m-b.__start)/b.__duration);b.__active=!0;c.push(b);n=!0}f++}for(;d[h];){b=d[h];if(b.__end>m)break;
if(b.__active){b.hide();b.__active=!1;var o=c.indexOf(b);o!==-1&&c.splice(o,1)}h++}if(n){c.sort(function(u,w){return u.__layer-w.__layer});n=!1}o=0;for(var t=c.length;o<t;o++){b=c[o];b.update((m-b.__start)/b.__duration,m-g,m)}g=m};this.clear=function(){for(h=f=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var e,c,d;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(f){e=f;d=1/e*6E4};this.getBPM=function(){return e};this.setMS=function(f){d=f;e=1/d*6E4};this.getMS=function(){return d};this.setRows=function(f){c=f};this.getRows=function(){return c};this.getBeatMS=function(f){return d*f};this.getPatternMS=function(f){return d*c*f}};function preInitModel(b,e,c){e.initWebGLObjects(c);for(e=0;e<b.materials.length;e++);}
function preInitScene(b,e){e.initWebGLObjects(b.scene);var c,d;for(c in b.materials){d=b.materials[c];d instanceof THREE.MeshFaceMaterial||d.program||setTimeout(function(){e.initMaterial(d,b.scene.lights,b.scene.fog)},250)}}function preinitAnimal(b,e,c){e.initWebGLObjects(c)}LensFlareTextures={texture0:undefined,texture1:undefined,texture2:undefined};
function initLensFlares(b,e,c,d){if(LensFlareTextures.texture0===undefined){LensFlareTextures.texture0=THREE.ImageUtils.loadTexture("files/textures/lensflare0.png");LensFlareTextures.texture1=THREE.ImageUtils.loadTexture("files/textures/lensflare2.png");LensFlareTextures.texture2=THREE.ImageUtils.loadTexture("files/textures/lensflare3.png")}b.lensFlare=new THREE.LensFlare(LensFlareTextures.texture0,700,0,THREE.AdditiveBlending);b.lensFlare.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);
b.lensFlare.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);b.lensFlare.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);b.lensFlare.add(LensFlareTextures.texture2,60,0.6,THREE.AdditiveBlending);b.lensFlare.add(LensFlareTextures.texture2,70,0.7,THREE.AdditiveBlending);b.lensFlare.add(LensFlareTextures.texture2,120,0.9,THREE.AdditiveBlending);b.lensFlare.add(LensFlareTextures.texture2,70,1,THREE.AdditiveBlending);b.lensFlare.customUpdateCallback=lensFlareUpdateCallback;b.lensFlare.position.copy(e);
b.lensFlareRotate=new THREE.Object3D;b.lensFlareRotate.addChild(b.lensFlare);b.lensFlareRotate.rotation.x=c*Math.PI/180;b.lensFlareRotate.rotation.y=d*Math.PI/180;b.scene.addChild(b.lensFlareRotate);return b.lensFlareRotate}
function lensFlareUpdateCallback(b){var e,c,d=b.lensFlares.length,f=-b.positionScreen.x*2,h=-b.positionScreen.y*2;for(c=0;c<d;c++){e=b.lensFlares[c];e.x=b.positionScreen.x+f*e.distance;e.y=b.positionScreen.y+h*e.distance;e.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var e,c,d;e=0;for(c=b.objects.length;e<c;e++){d=b.objects[e];d.matrixAutoUpdate=!1;d.updateMatrix()}}
function hideColliders(b){var e,c,d;e=0;for(c=b.collisions.colliders.length;e<c;e++){d=b.collisions.colliders[e].mesh;d.visible=!1}}function applyMaterial(b,e,c){var d,f,h,g=e.length;for(d=0;d<g;d++){f=e[d][0];h=e[d][1];b.objects[f]&&(b.objects[f].geometry.materials[h][0]=c)}}
var UgcObject=function(b){var e={},c=0;this.addVoxel=function(n,m,o,t,u){e[n+"."+m+"."+o]={x:n,y:m,z:o,color:t,object:u};c++};this.getVoxel=function(n,m,o){return e[n+"."+m+"."+o]};this.deleteVoxel=function(n,m,o){delete e[n+"."+m+"."+o];c--};this.isEmpty=function(){return c==0};this.getJSON=function(){function n(){if(w.length){t.push(u);t.push(v);t=t.concat(w)}}var m,o,t=[4],u=null,w=[],v=0;for(m in e){o=e[m];if(o.color!=u){n();u=o.color;v=0;w=[]}w.push(o.x,o.y,o.z);v++}n();return JSON.stringify(t)};
this.getMesh=function(){var n=new THREE.Cube(50,50,50),m=new THREE.Object3D,o;for(o in e){var t=e[o],u=new THREE.Mesh(n,new THREE.MeshLambertMaterial({color:t.color}));u.position.x=t.x*50;u.position.y=t.y*50;u.position.z=t.z*50;u.matrixAutoUpdate=!1;u.updateMatrix();u.update();m.addChild(u)}return m};if(b&&b[0]==4)for(var d=1,f=b.length,h=0,g=0;d<f;){h=b[d++];g=b[d++];for(j=0;j<g;j++)this.addVoxel(b[d++],b[d++],b[d++],h)}};UgcObject.TYPE_SAND="UgcObject.TYPE_SAND";UgcObject.TYPE_CLOUD="UgcObject.TYPE_CLOUD";
var UgcHandler=function(){this.getLatestUGOs=function(b){var e=new XMLHttpRequest;e.open("GET","/ugc/objects/latest",!0);e.onreadystatechange=function(){e.readyState==4&&(e.status==200?b(JSON.parse(e.responseText)):console.log("Unable to load latest User Generated Content"))};e.send(null)};this.getUGO=function(b,e){var c=new XMLHttpRequest;c.open("GET","/ugc/objects/"+b);c.onreadystatechange=function(){if(c.readyState==4)if(c.status==200){var d=JSON.parse(c.responseText);e(d)}else console.log("Could not fetch "+
b)};c.send(null)};this.submitUGO=function(b,e,c){var d=new XMLHttpRequest;d.open("POST","/ugc/objects");d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200){var f=JSON.parse(d.responseText);c(f)}else console.log("Submission of model failed")};d.send(JSON.stringify(b))}};
window.GEE=function(b){b||(b={});if(document.createElement("canvas").getContext){var e=this,c={},d={ctx:undefined,domElement:undefined,width:undefined,height:undefined,desiredFrameTime:1E3/60,frameCount:0,key:undefined,keyCode:undefined,mouseX:0,mouseY:0,pmouseX:undefined,pmouseY:undefined,mousePressed:!1},f,h=function(){for(var m=f,o=0,t=0;m;){t+=m.offsetTop;o+=m.offsetLeft;m=m.offsetParent}offset={x:o,y:t}};b.context||(b.context="2d");b.width||(b.width=500);b.height||(b.height=500);f=d.domElement=
document.createElement("canvas");d.ctx=f.getContext(b.context);if(d.ctx==null)b.fallback&&b.fallback();else{if(b.fullscreen){var g=function(){h();d.width=f.width=window.innerWidth;d.height=f.height=window.innerHeight-4};window.addEventListener("resize",g,!1);g();b.container||(b.container=document.body);document.body.style.margin="0px";document.body.style.padding="0px"}else{h();e.__defineSetter__("width",function(m){d.width=f.width=m});e.__defineSetter__("height",function(m){d.height=f.height=m});
e.width=b.width;e.height=b.height}if(b.container){b.container.appendChild(f);h()}b=function(m){e.__defineGetter__(m,function(){return d[m]})};b("ctx");b("width");b("height");b("frameCount");b("key");b("keyCode");b("mouseX");b("mouseY");b("pmouseX");b("pmouseY");b("mousePressed");b=function(){};e.loop=!0;e.keyup=b;e.keydown=b;e.draw=b;e.mousedown=b;e.mouseup=b;e.mousemove=b;e.mousedrag=b;e.__defineGetter__("frameRate",function(){return NaN});e.__defineGetter__("frameTime",function(){});e.__defineGetter__("keyPressed",
function(){for(var m in c)if(c[m])return!0;return!1});e.__defineSetter__("frameTime",function(m){d.desiredFrameTime=m});e.__defineSetter__("frameRate",function(m){d.desiredFrameTime=k/m});f.addEventListener("mouseenter",function(){h()},!1);var n=function(){e.mousemove()};window.addEventListener("mousemove",function(m){var o=m.pageX-offset.x;m=m.pageY-offset.y;if(d.pmouseX==undefined){d.pmouseX=o;d.pmouseY=m}else{d.pmouseX=d.mouseX;d.pmouseY=d.mouseY}d.mouseX=o;d.mouseY=m},!1);window.addEventListener("mousemove",
n,!1);f.addEventListener("mousedown",function(){d.mousePressed=!0;e.mousedown();f.addEventListener("mousemove",e.mousedrag,!1);f.removeEventListener("mousemove",n,!1)},!1);f.addEventListener("mouseup",function(){d.mousePressed=!1;e.mouseup();f.removeEventListener("mousemove",e.mousedrag,!1);f.addEventListener("mousemove",n,!1)},!1);window.addEventListener("keydown",function(m){m=m.keyCode;d.key=String.fromCharCode(m);d.keyCode=m;c[m]=!0;e.keydown()},!1);window.addEventListener("keyup",function(m){m=
m.keyCode;d.key=String.fromCharCode(m);d.keyCode=m;c[m]=!1;e.keyup()},!1)}}else b.fallback&&b.fallback()};function loadSVG(b,e,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200)if(d.responseXML==null)c!=undefined&&c.call(this,b);else{var f=d.responseXML.getElementsByTagName("svg").item(0);f=new SVG(f);f.filename=b;e.call(this,f,b)}else c!=undefined&&c.call(this,b)};d.open("GET",b,!0);d.send(null)}
var SVG=function(b){this.filename="";this.children=[];var e=b.getAttribute("width"),c=b.getAttribute("height");this.width=e==null?0:parseFloat(e.replace("px",""));this.height=c==null?0:parseFloat(c.replace("px",""));for(var d in b.childNodes)b.childNodes.item(d).getAttribute&&this.children.push(b.childNodes.item(d).nodeName=="g"?new SVG(b.childNodes.item(d)):new Path(b.childNodes.item(d)));this.draw=function(f){for(var h in this.children)this.children[h].draw(f)};this.__defineGetter__("path",function(){})},
Path=function(b){this.element=b;this.commands=commands(b);this.lineWidth=parseLineWidth(b);this.strokeStyle=parseStrokeStyle(b);this.fillStyle=parseFillStyle(b);this.totalLength=0;this.lengths=[];this.tlengths=[];var e=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0};this.reset()};this.draw=function(c){this.style(c);c.beginPath();this.shape(c);this.end(c)};this.getAnchorPoints=function(){var c=[],d;for(d in this.commands)c.push(this.commands[d].getAnchorPoints(e));
return c};this.shape=function(c){for(var d in this.commands)this.commands[d].shape(e,c)};this.lerp=function(c,d,f,h,g){var n=1-g;return c*n*n*n+3*d*g*n*n+3*f*g*g*n+h*g*g*g};this.at=function(c,d){var f,h;this.lengths.length==0&&this.calcLengths(d);h=this.tlengths[0];for(f=0;c>h;){f++;h+=this.tlengths[f]}pt=h-this.tlengths[f];h=this.map(c,pt,h,0,1);for(var g=0;g<=f;g++)this.commands[g].shape(e,d);var n=e.x;g=e.y;this.commands[f+1].shape(e,d);f=this.lerp(n,e.x1,e.x2,e.x,h);h=this.lerp(g,e.y1,e.y2,e.y,
h);return{x:f,y:h}};this.map=function(c,d,f,h,g){return h+(g-h)*((c-d)/(f-d))};this.calcLengths=function(c){var d,f,h,g,n=0;this.commands[0].shape(e,c);for(var m=h=e.x,o=g=e.y,t=1;t<this.commands.length;t++){n=0;m=e.x;o=e.y;this.commands[t].shape(e,c);for(var u=0;u<=1;u+=0.0010){d=this.lerp(m,e.x1,e.x2,e.x,u);f=this.lerp(o,e.y1,e.y2,e.y,u);n+=this.dist(d,f,h,g);h=d;g=f}this.lengths.push(n);this.totalLength+=n}for(c=0;c<this.lengths.length;c++)this.tlengths.push(this.lengths[c]/this.totalLength)};
this.dist=function(c,d,f,h){return Math.sqrt((c-f)*(c-f)+(d-h)*(d-h))};this.style=function(c){if(this.lineWidth!=null)c.lineWidth=this.lineWidth;if(this.strokeStyle!=null){c.strokeStyle=this.strokeStyle;if(this.lineWidth==undefined)c.lineWidth=1}if(this.fillStyle!=null)c.fillStyle=this.fillStyle};this.end=function(c){this.fillStyle!=null&&c.fill();this.strokeStyle!=null&&c.stroke()}},parseLineWidth=function(b){b=b.attributes.getNamedItem("stroke-width");return b==null?null:parseFloat(b.nodeValue)},
parseStrokeStyle=function(b){b=b.attributes.getNamedItem("stroke");return b==null?null:b.nodeValue},parseFillStyle=function(b){var e=b.attributes.getNamedItem("fill");if(e==null)return b.attributes.getNamedItem("stroke")!=null?null:"#000000";else{if(e.nodeValue=="none")return null;return e.nodeValue}},Command=function(b,e){this.type=b;this.data=e;this.debug=!1;this.shape=function(c,d){if(this.type=="M"){c.x=this.data[0];c.y=this.data[1];d&&d.moveTo(c.x,c.y)}else if(this.type=="C"){c.x=this.data[4];
c.y=this.data[5];if(d)d.bezierCurveTo(c.x1=this.data[0],c.y1=this.data[1],c.x2=this.data[2],c.y2=this.data[3],c.x,c.y)}else if(this.type=="c"){if(d)d.bezierCurveTo(c.x1=c.x+this.data[0],c.y1=c.y+this.data[1],c.x2=c.x+this.data[2],c.y2=c.y+this.data[3],c.x+=this.data[4],c.y+=this.data[5])}else if(this.type=="S"){c.x=this.data[2];c.y=this.data[3];var f=c.x-c.x2,h=c.y-c.y2;if(d)d.bezierCurveTo(c.x1=c.x+f,c.y1=c.y+h,c.x2=this.data[0],c.y2=this.data[1],c.x,c.y)}else if(this.type=="s"){f=c.x-c.x2;h=c.y-
c.y2;if(d)d.bezierCurveTo(c.x1=c.x+f,c.y1=c.y+h,c.x2=c.x+this.data[0],c.y2=c.y+this.data[1],c.x+=this.data[2],c.y+=this.data[3])}else if(this.type=="L"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="l"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=this.data[0],c.y+=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="H"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="h"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=
this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="V"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x,c.y=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="v"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x,c.y+=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="z")d.closePath();else console&&console.log("unrecognized command "+this.type);if(d){d.strokeStyle="#000000";d.lineWidth=1;if(this.debug){d.strokeRect(c.x-1.5,c.y-1.5,3,3);d.beginPath();d.moveTo(c.px,c.py);d.lineTo(c.x1,c.y1);d.closePath();d.stroke()}}}},
commands=function(b){if(b.nodeName.toLowerCase()=="path")return commandsFromD(b.getAttribute("d"));if(b.nodeName.toLowerCase()=="polygon")return commandsFromPoints(b.getAttribute("points"));if(b.nodeName.toLowerCase()=="line")return commandsFromLine(b);if(b.nodeName.toLowerCase()=="rect")return commandsFromRect(b);return[]},commandsFromD=function(b){var e=[];b=b.match(/[a-zA-Z][0-9\.\-\,]+/g);for(var c=0;c<b.length;c++){var d=b[c].charAt(0),f=b[c].substr(1);f=f.replace(/\-/g,",-");f.charAt(0)==","&&
(f=f.substr(1));f=f.split(",");for(var h=0;h<f.length;h++)f[h]=parseFloat(f[h]);e.push(new Command(d,f))}return e},commandsFromLine=function(b){var e=[],c=parseFloat(b.getAttribute("x1")),d=parseFloat(b.getAttribute("x2")),f=parseFloat(b.getAttribute("y1"));b=parseFloat(b.getAttribute("y2"));e.push(new Command("M",[c,f]));e.push(new Command("L",[d,b]));return e},commandsFromPoints=function(b){var e=!0;if(b.indexOf(",")==-1)for(var c=0;c<b.length;c++)if(b.charAt(c)==" "){e&&(b=b.setCharAt(c,","));
e=!e}b=("M"+b).replace(/ /g,"L")+"z";return commandsFromD(b)};String.prototype.setCharAt=function(b,e){if(b>this.length-1)return str;return this.substr(0,b)+e+this.substr(b+1)};
var commandsFromRect=function(b){var e=[],c=parseFloat(b.getAttribute("x")),d=parseFloat(b.getAttribute("y")),f=parseFloat(b.getAttribute("width"));b=parseFloat(b.getAttribute("height"));e.push(new Command("M",[c,d]));e.push(new Command("h",[f]));e.push(new Command("v",[b]));e.push(new Command("h",[-f]));e.push(new Command("v",[-b]));return e},WonderWall=WonderWall||{};
WonderWall.Point=function(b,e,c){var d=e,f=c,h=0;this.x=e;this.y=c;this.r=0.15;this.threshold=0.1;this.easing=0.125;this.updating=!1;this.angle=0;this.update=function(){if(this.updating){var g=b.mouseY-f;e=d+(b.mouseX-d)*this.r;c=f+g*this.r;this.easing=0.0625}else{e=d;c=f;h=0;this.easing=0.125}this.x=this.ease(this.x,e,this.easing);this.y=this.ease(this.y,c,this.easing);this.angle=this.ease(this.angle,h,this.easing)};this.setPosition=function(g,n){d=g;f=n};this.getOriginPosition=function(){return{x:d,
y:f}};this.getPoint=function(){return{x:this.x,y:this.y}}};WonderWall.Point.prototype.ease=function(b,e,c){var d=e-b;if(Math.abs(d)<c/100)b=e;else b+=d*c;return b};
WonderWall.Pentagon=function(b,e,c,d){var f=b.ctx;this.separate=!1;this.showFill=!0;this.showStroke=!0;this.insides=!1;this.x=e;this.y=c;if(this.x==undefined||this.x==null||this.x==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y==NaN)this.y=b.height/2;e=this.generatePoints(this.x,this.y,d,5);var h=[];for(c=0;c<e.length;c++){var g=e[c];h.push(new WonderWall.Point(b,g.x,g.y))}this.update=function(){this.x=b.width/2;this.y=b.height/2;var n=this.generatePoints(this.x,this.y,d,5);if(!this.separate)this.separate=
!0;for(var m=0;m<h.length;m++){var o=h[m],t=n[m];o.update();var u=o.getOriginPosition();(t.x!=u.x||t.y!=u.y)&&o.setPosition(t.x,t.y)}return this};this.render=function(){if(this.insides&&this.showStroke)for(var n=0;n<h.length;n++){var m=h[n];this.separate||m.update();f.beginPath();f.moveTo(this.x,this.y);f.lineTo(m.x,m.y);f.stroke()}f.beginPath();for(n=0;n<h.length;n++){m=h[n];this.separate||m.update();n<1?f.moveTo(m.x,m.y):f.lineTo(m.x,m.y)}f.closePath();this.showFill&&f.fill();this.showStroke&&f.stroke()};
this.setUpdate=function(n){for(var m=0;m<h.length;m++)h[m].updating=n};this.setUpdatePoint=function(n,m){h[m].updating=n};this.setRadius=function(n){for(var m=0;m<h.length;m++)h[m].r=n};this.getPoints=function(){return h}};WonderWall.Pentagon.prototype.generatePoints=function(b,e,c,d){for(var f=[],h=0;h<d;h++)f.push({x:c*Math.sin(h/d*2*Math.PI)+b,y:-c*Math.cos(h/d*2*Math.PI)+e});return f};
function Heart(b,e,c,d){var f=this,h=b.ctx;this.x=c;this.y=d;if(this.x==undefined||this.x==null||this.x||this==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y||this==NaN)this.y=b.height/2;var g,n=!1;this.update=function(){return this};this.render=function(){if(n){h.save();h.translate(this.x,this.y);h.save();h.translate(-this.width/2,-this.height/2);g.draw(h);h.restore();h.restore()}};loadSVG(e,function(m,o){g=m;f.source=o;f.width=g.width;f.height=g.height;n=!0},function(){})}
var ClearEffect=function(b){SequencerItem.call(this);var e,c=b.renderer,d=b.renderTarget;this.init=function(){e=new THREE.Camera(60,1,1,1E4);e.position.z=2;new THREE.Scene};this.update=function(){c.clear();var f=c.getContext();f.bindFramebuffer(f.FRAMEBUFFER,d.__webglFramebuffer);f.viewport(0,0,d.width,d.height);f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,e){SequencerItem.call(this);var c,d,f,h,g=e.renderer,n=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});h=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(h)};this.update=function(m){f.opacity=1-m;g.render(d,c,n)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,e){SequencerItem.call(this);var c,d,f,h,g=e.renderer,n=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});h=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(h)};this.update=function(m){f.opacity=m;g.render(d,c,n)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,h=b.renderTarget;this.init=function(){e=new THREE.Camera;e.position.z=200;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var g=new THREE.MeshBasicMaterial({map:h,depthTest:!1});d=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),g);d.scale.y=-1;d.doubleSided=!0;c.addObject(d)};this.update=function(){f.render(c,e)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,e,c,d){SequencerItem.call(this);var f,h,g,n,m,o=b.renderer,t=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;h=new THREE.Scene;n=THREE.ShaderUtils.lib.film;m=THREE.UniformsUtils.clone(n.uniforms);m.tDiffuse.texture=t;g=new THREE.MeshShaderMaterial({uniforms:m,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader});m.grayscale.value=
0;if(e!==undefined)m.nIntensity.value=e;if(c!==undefined)m.sIntensity.value=c;if(d!==undefined)m.sCount.value=d;var u=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),g);u.position.z=-500;h.addObject(u)};this.update=function(u,w,v){m.time.value=v*0.01%1E4;o.render(h,f,t,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,e){SequencerItem.call(this);var c,d,f,h,g,n,m,o,t,u,w,v=b.renderer,x=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;d=new THREE.Scene;var y={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};m=new THREE.WebGLRenderTarget(256,512,y);o=new THREE.WebGLRenderTarget(512,256,y);y=THREE.ShaderUtils.lib.screen;
h=THREE.UniformsUtils.clone(y.uniforms);h.tDiffuse.texture=x;h.opacity.value=e!==undefined?e:1;f=new THREE.MeshShaderMaterial({uniforms:h,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});y=THREE.ShaderUtils.lib.convolution;g=THREE.UniformsUtils.clone(y.uniforms);u=new THREE.Vector2(0.001953125,0);w=new THREE.Vector2(0,0.001953125);g.tDiffuse.texture=x;g.uImageIncrement.value=u;g.cKernel.value=THREE.ShaderUtils.buildKernel(4);n=new THREE.MeshShaderMaterial({uniforms:g,
vertexShader:"#define KERNEL_SIZE 25.0\n"+y.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+y.fragmentShader});t=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),n);t.position.z=-500;d.addObject(t)};this.update=function(){t.materials[0]=n;g.tDiffuse.texture=x;g.uImageIncrement.value=u;v.render(d,c,m,!0);g.tDiffuse.texture=m;g.uImageIncrement.value=w;v.render(d,c,o,!0);t.materials[0]=f;f.blending=THREE.AdditiveBlending;h.tDiffuse.texture=o;v.render(d,c,x,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var e,c,d,f,h=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={time:{type:"f",value:0},map:{type:"t",value:0,texture:g},sampleDistance:{type:"f",value:1/b.baseWidth}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(n,m,o){f.time.value=o*0.01;h.render(c,e,g,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,h=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.54},waveFactor:{type:"f",value:0.00127},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var g=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);g.position.z=-500;c.addObject(g)};this.update=function(){f.render(c,e)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,h=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.49},waveFactor:{type:"f",value:0.00161},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.55 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var g=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);g.position.z=-500;c.addObject(g)};this.update=function(){f.render(c,e)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,h=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.64},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.00756},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (1.86 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var g=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);g.position.z=-500;c.addObject(g)};this.update=function(){f.render(c,e)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintEffectVideo=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,h=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.5},
colorOffset:{type:"f",value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0},waveFactor:{type:"f",value:0},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var g=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);g.position.z=-500;c.addObject(g)};this.update=function(){f.render(c,e)}};PaintEffectVideo.prototype=new SequencerItem;PaintEffectVideo.prototype.constructor=PaintEffectVideo;
var PaintDarkEffect=function(b){SequencerItem.call(this);var e,c,d,f,h=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={map:{type:"t",value:0,texture:g}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){h.render(c,e,g,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,e){SequencerItem.call(this);var c,d,f,h=b.renderer,g=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:e,transparent:!0});f=new THREE.Mesh(new THREE.Plane(3,3),this.material);d.addObject(f)};this.update=function(){this.material.opacity=0.25;h.render(d,c,g)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,e){SequencerItem.call(this);this.show=function(){document.body.style.cursor=e?'url("files/pointer.png"), auto':"none"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var PointerImageEffect=function(b,e){SequencerItem.call(this);var c=document.createElement("img");c.src=e;c.style.position="absolute";c.style.zIndex=1E3;c.style.display="none";document.body.appendChild(c);this.show=function(){document.body.style.cursor='url("files/pointer-transparent.png"), auto';c.style.display="block"};this.hide=function(){c.style.display="none";document.body.style.cursor="none"};this.update=function(){c.style.left=b.mouse.x-40+"px";c.style.top=b.mouse.y-6+"px"}};
PointerImageEffect.prototype=new SequencerItem;PointerImageEffect.prototype.constructor=PointerImageEffect;
var CityWorld=function(b){function e(n){var m=n.scene;hideColliders(m);makeSceneStatic(m);preInitScene(n,b.renderer);m.scale.set(d,d,d);m.updateMatrix();c.scene.addChild(m);m.collisions&&c.scene.collisions.merge(m.collisions);TriggerUtils.setupCityTriggers(n);n.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;n.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;c.portals.push({object:n.objects.Portal,radius:150,currentDistance:9999999});c.portals.push({object:n.objects["Portal.001"],
radius:150,currentDistance:9999999});c.portals.push({object:n.objects["Portal.002"],radius:150,currentDistance:9999999});c.portals.push({object:n.objects["Portal.003"],radius:150,currentDistance:9999999});applyCityShader(n,["Backdrop_City"]);c.scene.update(undefined,!0)}var c=this,d=0.1;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;c.portals=[];this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var f=new THREE.DirectionalLight(16777215);
f.castShadow=!1;this.scene.addLight(f);var h=new THREE.DirectionalLight(16777215);h.castShadow=!1;this.scene.addLight(h);var g={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,s:0.494,v:0},directionalLight1:{h:0.565,s:0.329,v:0.841,x:0.5176767580772196,y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,
theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,flarey:358,flyCamera:{position:{x:16.574202591686277,y:462.26953453589,z:-10184.707948888321},target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(g.fogColor.h,g.fogColor.s,g.fogColor.v);this.scene.fog.density=g.fogDensity;f.color.setHSV(g.directionalLight1.h,
g.directionalLight1.s,g.directionalLight1.v);h.color.setHSV(g.directionalLight2.h,g.directionalLight2.s,g.directionalLight2.v);f.position.set(g.directionalLight1.x,g.directionalLight1.y,g.directionalLight1.z);h.position.set(g.directionalLight2.x,g.directionalLight2.y,g.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;f=new THREE.Vector3(0,0,-5E3);initLensFlares(c,f,20,358);f=new THREE.SceneLoader;f.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};
b.debug||f.load("files/models/city/City.js",e);this.update=function(n,m,o){m.matrixWorld.getPosition();TriggerUtils.effectorRadius=300;TriggerUtils.update("city");updateCityShader(n);if(o){n=m.matrixWorld.getPosition();for(m=0;m<c.portals.length;m++){c.portals[m].currentDistance=c.portals[m].object.matrixWorld.getPosition().distanceTo(n);c.portals[m].currentDistance<c.portals[m].radius&&b.signals.startexploration.dispatch("dunes")}}}},PrairieWorld=function(b){var e=this;this.scene=new THREE.Scene;
this.scene.collisions=new THREE.CollisionSystem;this.portals=[];this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.196,0.93,-0.3);this.directionalLight1.color.setHSV(0,0,0.876);this.scene.addLight(this.directionalLight1);this.directionalLight2=
new THREE.DirectionalLight(16772829);this.directionalLight2.position.set(0.19,-0.31,-0.93);this.directionalLight2.color.setHSV(0.347,0.51,0.135);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.0588E-5,fogColor:{h:0.5235,s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,
y:0.8775825618903728,z:-0.1553545034191468,phi:-1.588470588235294,theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,
this.settings.directionalLight1.s,this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,this.settings.directionalLight2.y,this.settings.directionalLight2.z);this.lensFlareRotate=
this.lensFlare=null;var c=new THREE.Vector3(0,0,-3E3);initLensFlares(e,c,14,311);var d=THREE.ImageUtils.loadTexture("files/textures/trailMarkTexture.jpg");c=new THREE.SceneLoader;c.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};c.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};c.load("files/models/prairie/Prairie.js",function(f){var h=f.scene;hideColliders(h);makeSceneStatic(h);ROME.TrailShaderUtils.setMaterials([f.objects.Ground],2500,d,b.renderer);TriggerUtils.setupPrairieTriggers(f);
e.scene.addChild(h);f.objects.Backdrop.materials[0].map.wrapS=THREE.RepeatWrapping;f.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;e.portals.push({object:f.objects.Portal,radius:120,currentDistance:9999999});e.portals.push({object:f.objects["Portal.001"],radius:120,currentDistance:9999999});e.portals[0].object.visible=!1;e.portals[1].object.visible=!1;preInitScene(f,b.renderer);h.collisions&&e.scene.collisions.merge(h.collisions);e.scene.update(undefined,!0)});this.update=function(f,
h,g){ROME.TrailShaderUtils.updateLava(f*1.0E-4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=50;TriggerUtils.update("prairie");if(g){f=h.matrixWorld.getPosition();for(h=0;h<e.portals.length;h++){e.portals[h].currentDistance=e.portals[h].object.matrixWorld.getPosition().distanceTo(f);e.portals[h].currentDistance<e.portals[h].radius&&b.signals.startexploration.dispatch("dunes")}}}},DunesWorld=function(b){function e(L){var H=
L.scene;applyDunesShader(L);g(H);h(H,!0);D[F]=H.collisions.colliders[0].mesh;D[F].rotation.x=-90*Math.PI/180;D[F].scale.set(o,o,o);m.scene.addChild(D[F]);m.scene.collisions.merge(H.collisions);for(L=0;L<C[F];L++)B[F].push(c(H));F++;m.scene.update(undefined,!0)}function c(L){for(var H=0;H<L.children.length;H++)if(!L.children[H].__isCollider){L=L.children[H];L=new THREE.Mesh(L.geometry,L.materials);L.rotation.x=-90*Math.PI/180;L.scale.set(o,o,o);m.scene.addChild(L);return L}}function d(L){var H=L.scene;
H.scale.set(o,o,o);H.matrixAutoUpdate=!0;g(H);h(H,!0);preInitScene(L,b.renderer);m.scene.addChild(H);H.collisions&&m.scene.collisions.merge(H.collisions);for(var N in L.objects)N.toLowerCase().indexOf("cloud")>=0&&applyCloudsShader(L.objects[N],CloudsShader,w,v,u);return H}function f(L,H){return Math.round(Math.sin(L*0.0010)*Math.cos(H*0.0050)*4)*(Math.PI/2)}function h(L,H){THREE.SceneUtils.traverseHierarchy(L,function(N){if(!N.__isCollider)N.visible=H})}function g(L){THREE.SceneUtils.traverseHierarchy(L,
function(H){for(var N=L.collisions.colliders,ea=0;ea<N.length;ea++)if(N[ea].mesh==H)H.__isCollider=!0})}function n(L){L.state=0;L.radius*=o;b.influenceSpheres.push(L);L.type===0&&m.portals.push(L)}var m=this,o=0.2,t=29990*o;m.portals=[];b.influenceSpheres=[];b.cameraSlowDown=!1;var u=[],w=new THREE.Vector3,v=new THREE.Vector3;m.scene=new THREE.Scene;m.scene.collisions=new THREE.CollisionSystem;m.scene.fog=new THREE.FogExp2(16777215,2.75E-6);m.scene.fog.color.setHSV(0.576,0.382,0.9);var x=new THREE.AmbientLight(2232576),
y=new THREE.DirectionalLight(16772829),A=new THREE.DirectionalLight(16772829);m.ambient=x;m.directionalLight1=y;m.directionalLight2=A;m.skyWhite=1;x.color.setHSV(0,0,0.1);y.position.set(0.81,0.31,-0.5);y.color.setHSV(0.088,0,1);A.position.set(0.094,0.98,0.158);A.color.setHSV(0,0,0.86);m.scene.addLight(x);m.scene.addLight(y);m.scene.addLight(A);m.lensFlare=null;m.lensFlareRotate=null;initLensFlares(m,new THREE.Vector3(-5500,3500,-1E4),0,0);var B=[[],[],[],[],[],[],[]],D=[],C=[0,0,0,0,1,1,1],G=[],F=
0,E;for(x=0;x<5;x++){A=[];G.push(A);for(y=0;y<5;y++)if(y===0&&x===0)A.push(4);else if(y===1&&x===4)A.push(5);else if(y===3&&x===3)A.push(6);else{E=Math.floor(Math.random()*3.99999);A.push(E);C[E]++}}var O=new THREE.Mesh(new THREE.Cube(5E4,5E4,5E4),undefined);O.flipSided=!0;applyDunesShader({objects:{skydome:O}});m.scene.addChild(O);x=new THREE.SceneLoader;x.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};x.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};x.load("files/models/dunes/D_tile_walk.js",
function(L){applyDunesShader(L);B[4][0]=d(L);m.scene.update(undefined,!0)});x.load("files/models/dunes/D_tile_prairie.js",function(L){applyDunesShader(L,{D_tile_Prairie_Collis:!0,D_tile_Prairie_Island:!0},{"D_tile_Prairie_Is.000":-0.05},{D_tile_Prairie_Water:0.65});B[5][0]=d(L);n({name:"prairiePortal",object:L.empties.Prairie_Portal,radius:2E3,type:0,destination:"prairie"});n({name:"prairieSlowDown",object:L.empties.Prairie_Center,radius:8E3,type:1});m.scene.update(undefined,!0)});x.load("files/models/dunes/D_tile_city.js",
function(L){applyDunesShader(L,{D_tile_City_Collision:!0,D_tile_City_Island_Co:!0},{D_tile_City_Island:-1},{D_tile_City_Water:0.65});B[6][0]=d(L);n({name:"cityPortal",object:L.empties.City_Portal,radius:2500,type:0,destination:"city"});n({name:"citySlowDown",object:L.empties.City_Center,radius:1E4,type:1});m.scene.update(undefined,!0)});x.load("files/models/dunes/D_tile_1.js",e);x.load("files/models/dunes/D_tile_2.js",e);x.load("files/models/dunes/D_tile_3.js",e);x.load("files/models/dunes/D_tile_4.js",
e);(new UgcHandler).getLatestUGOs(function(L){for(var H=0,N=L.length;H<N;H++){var ea=new UgcObject(L[H]);if(!ea.isEmpty()){ea=ea.getMesh();ea.position.x=Math.random()*1E4-5E3;ea.position.z=Math.random()*1E4-5E3;m.scene.addObject(ea)}}});m.update=function(L,H,N){m.checkInfluenceSpheres(H,N);m.updateTiles(H);updateDunesShader(L,m.skyWhite);O.position.copy(H.matrixWorld.getPosition());O.updateMatrix();m.lensFlareRotate.position.copy(H.matrixWorld.getPosition());m.lensFlareRotate.updateMatrix()};m.checkInfluenceSpheres=
function(L,H){var N,ea,p,ha,fa=L.matrixWorld.getPosition();N=0;for(ea=b.influenceSpheres.length;N<ea;N++){ha=b.influenceSpheres[N];p=ha.object.matrixWorld.getPosition().distanceTo(fa);ha.currentDistance=p;if(p<ha.radius)if(ha.type===0&&ha.state===0){ha.state=1;H&&b.signals.startexploration.dispatch(ha.destination)}else{if(ha.type==1)b.cameraSlowDown=!0}else{ha.state=0;b.cameraSlowDown=!1}}};m.updateTiles=function(L){var H=Math.floor(2.5),N=L.matrixWorld.getPosition(),ea=N.x,p=N.z;N.addSelf(L.matrixWorld.getColumnZ().multiplyScalar(-t*
1.5));L=Math.floor(N.x/t)%5;for(var ha=Math.floor(N.z/t)%5;L<0;)L+=5;for(;ha<0;)ha+=5;var fa,oa,V,Z,aa,pa,na,sa=[0,0,0,0,0,0,0],ya=[-1,-1,-1,-1];for(oa=-H;oa<H+1;oa++)for(fa=-H;fa<H+1;fa++){aa=(Math.floor(N.x/t)+fa)*t;pa=(Math.floor(N.z/t)+oa)*t;V=(L+fa)%5;for(Z=(ha+oa)%5;V<0;)V+=5;for(;Z<0;)Z+=5;na=G[Z][V];if(V=B[na][sa[na]++]){V.position.x=aa;V.position.z=pa;V.rotation.z=f(aa,pa)}if(na<4){V=aa-ea;Z=pa-p;V=V*V+Z*Z;if(ya[na]===-1||V<ya[na]){ya[na]=V;if(V=D[na]){V.position.x=aa;V.position.z=pa;V.rotation.z=
f(aa,pa)}}}}}},CityShaderEffectors=[new THREE.Vector4(0,0,-1E3,50),new THREE.Vector4(-100,0,-1500,150),new THREE.Vector4(100,0,-2E3,150),new THREE.Vector4(0,0,-2500,100)],CityShader={uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},time:{type:"f",value:0},targets:{type:"fv",value:[]},radiuses:{type:"fv1",value:[]}},vertexShader:"varying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;","const \t int  \tNUMTARGETS = "+CityShaderEffectors.length+";","uniform vec3 \ttargets[ NUMTARGETS ];\nuniform float \tradiuses[ NUMTARGETS ];\nuniform float time;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvoid main() {\nfloat distance = -9999999.0;\nfor( int i = 0; i < NUMTARGETS; i++ ) {\ndistance = max( distance, length( vWorldPosition - targets[ i ].xyz ) * -1.0 / radiuses[ i ] );\n}\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec4 grass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += ( 0.5 + grass.g ) * texture2D( surfaceImage, worldPosition.zx * vec2( 3.0 )).g;\nvec3 surface = vec3( 0.15 * 2.0, 0.18 * 2.0, 0.2 * 2.0 );\nif( distance > 0.0 )\nsurface = grass.rgb;\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 0.0001;\ngl_FragColor = vec4( surface * vColor * 2.0, 1.0 );\ngl_FragColor = vec4( mix( gl_FragColor.rgb, vec3( 0.64, 0.88, 1 ), depth ), 1.0 );\n}"].join("\n")};
function applyCityShader(b,e){var c,d,f,h,g,n={};for(c=0;c<e.length;c++)n[e[c]]=!0;updateCityShader(0);c={uniforms:CityShader.uniforms,vertexShader:CityShader.vertexShader,fragmentShader:CityShader.fragmentShader,shading:THREE.FlatShading,vertexColors:THREE.VertexColors};c.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;c.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;c.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;c.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;
g=new THREE.MeshShaderMaterial(c);for(d in b.objects){h=b.objects[d];if(!n[d]&&h.geometry&&h.geometry.morphTargets.length===0){f=h.geometry;for(c=0;c<f.materials.length;c++)h.materials[0]=g}}return g}function updateCityShader(b){var e,c,d=CityShaderEffectors.length,f,h=CityShader.uniforms.targets.value,g,n=CityShader.uniforms.radiuses.value;for(c=g=f=0;c<d;c++){e=CityShaderEffectors[c];h[f++]=e.x;h[f++]=e.y;h[f++]=e.z;n[g++]=e.w}CityShader.uniforms.time.value+=b/1E4}
var DunesShaderEffectors={position:[new THREE.Vector3(0,-2E3,-1E3),new THREE.Vector3(-100,-2E3,-2500),new THREE.Vector3(100,-2E3,-4E3),new THREE.Vector3(2E3,-2E3,-2500)],radius:[500,500,500,500],darkness:[0,1,0.5,0],positionFlat:[],materials:[]},DunesShader={uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},time:{type:"f",value:0},
target:{type:"fv",value:[]},radius:{type:"fv1",value:[]},darkness:{type:"fv1",value:[]},skyWhite:{type:"f",value:1},dunesOpacity:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",
value:[]}},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );","const \t int  \tNUMTARGETS = "+DunesShaderEffectors.position.length+";","uniform vec3 \ttarget[ NUMTARGETS ];\nuniform float \tradius[ NUMTARGETS ];\nuniform float \tdarkness[ NUMTARGETS ];\nuniform float  skyWhite;\nuniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform float time;\nuniform float dunesOpacity;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vNormalsquare;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nfloat distance = -9999999.0;\nfloat fragmentDarkness = 1.0;\nfloat tempDistance;\nfor( int i = 0; i < NUMTARGETS; i++ ) {\ntempDistance = length( vWorldPosition - target[ i ].xyz ) * -1.0 / radius[ i ];\nif( tempDistance > distance ) {\ndistance = tempDistance;\nfragmentDarkness = 1.0 - darkness[ i ];\n}\n}\nvec3 worldPosition = vWorldPosition * 0.0005;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.x + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.y + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.z;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4( vColor, 1.0 );\nif(distance > 0.0)\nsurface = vec4( grass.rgb * fragmentDarkness, grass.w );\ngl_FragColor = mix( surface * texture2D( surfaceImage, worldPosition.zx * vec2( 0.4 ) + vec2(time)), surface, vec4( cloudMix, 0.1 ));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float LOG2 = 1.442695;\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 50.0;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.255 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\ngl_FragColor.a = dunesOpacity;\n}"].join("\n")};
function applyDunesShader(b,e,c,d){function f(u,w){n=new THREE.MeshShaderMaterial(m);n.uniforms=THREE.UniformsUtils.clone(m.uniforms);n.uniforms.target.value=DunesShaderEffectors.positionFlat;n.uniforms.radius.value=DunesShaderEffectors.radius;n.uniforms.darkness.value=DunesShaderEffectors.darkness;n.uniforms.grassImage.texture=m.uniforms.grassImage.texture;n.uniforms.surfaceImage.texture=m.uniforms.surfaceImage.texture;n.uniforms.invertLightY.value=u;n.uniforms.dunesOpacity.value=w;g.materials=[n];
DunesShaderEffectors.materials.push(n)}var h,g,n;c=c!==undefined?c:{};e=e!==undefined?e:{};d=d!==undefined?d:{};var m={uniforms:DunesShader.uniforms,vertexShader:DunesShader.vertexShader,fragmentShader:DunesShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};m.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;m.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;m.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;m.uniforms.surfaceImage.texture.wrapT=
THREE.RepeatWrapping;var o=1,t=1;for(h in b.objects)if(!e[h]){g=b.objects[h];o=c[h]?c[h]:1;t=d[h]?d[h]:1;g.geometry&&g.geometry.morphTargets.length===0&&f(o,t)}}
function updateDunesShader(b,e){e=e!==undefined?e:1;var c,d,f=DunesShaderEffectors.position.length,h,g=DunesShaderEffectors.positionFlat;for(d=h=0;d<f;d++){c=DunesShaderEffectors.position[d];g[h++]=c.x;g[h++]=c.y;g[h++]=c.z}c=DunesShader.uniforms.time.value+=b*1.0E-5;d=0;for(f=DunesShaderEffectors.materials.length;d<f;d++){DunesShaderEffectors.materials[d].uniforms.time.value=c;DunesShaderEffectors.materials[d].uniforms.skyWhite.value=e}}
var CloudsShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",value:0},targetStart:{type:"v3",
value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},
colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\n}",
fragmentShader:"const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nuniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\ngl_FragColor = vec4(vec3(vLightWeighting) * vec3(0.9, 0.5, 0.3) + vec3(0.7, 0.6, 0.6), vLightWeighting * 0.95 + 0.05 );\nconst float LOG2 = 1.442695;\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 50.0;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.255 );\nsky_color = mix( vec3( 1.0 ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.a ), fogFactor );\n}"};
function applyCloudsShader(b,e,c,d,f){var h={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},g=new THREE.MeshShaderMaterial(h);g.uniforms=THREE.UniformsUtils.clone(h.uniforms);g.uniforms.targetStart.value=c;g.uniforms.targetEnd.value=d;g.uniforms.grassImage.texture=h.uniforms.grassImage.texture;g.uniforms.surfaceImage.texture=h.uniforms.surfaceImage.texture;g.uniforms.colorA.value=e.colors.colorA;
g.uniforms.colorB.value=e.colors.colorB;g.uniforms.colorC.value=e.colors.colorC;b.materials[0]=g;f.push(g);h.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;h.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;h.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;h.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping}
DunesCamera=function(b){var e=new THREE.Ray,c,d,f=new THREE.Vector3,h={forward:1,left:1,right:1,up:1,down:1},g=0,n,m;n=b.worlds.dunes;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);n.scene.addChild(m);n.scene.addChild(m.target);n.scene.addChild(c);n.scene.addChild(d);var o={};o.camera=m;o.resetCamera=function(){c.position.set(0,50,1E3);d.position.set(0,50,300);d.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
m.position.copy(c.position);m.target.position.copy(d.position)};o.updateCamera=function(t,u){u=u*(1E3/30)/1E3;var w=b.mouse.x/b.screenWidth-0.5,v=b.mouse.y/b.screenHeight-0.5;if(t<0.1){e.origin.copy(c.matrixWorld.getPosition()).y+=100;e.direction.set(0,-1,0);var x=n.scene.collisions.rayCastNearest(e),y=-1;if(x&&x.distance!==-1){y=x.distance*0.1;c.position.y=e.origin.y-y+5}f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*200-f.z*12*w*2*u;d.position.x=Math.min(300,Math.max(-300,
d.position.x));d.position.z=c.position.z-200;m.position.y=m.target.position.y=d.position.y=c.position.y;m.target.position.x+=(d.position.x-m.target.position.x)*0.15*u;m.target.position.z+=(d.position.z-m.target.position.z)*0.15*u}else if(t<0.39){e.origin.copy(c.matrixWorld.getPosition()).y+=100;e.direction.set(0,-1,0);if((x=n.scene.collisions.rayCastNearest(e))&&x.distance!==-1){y=x.distance*0.1;c.position.y=e.origin.y-y+5}if(Math.abs(d.position.y-c.position.y)<160)d.position.y+=Math.max(0,-v)*7.5;
else{d.position.y>c.position.y&&(d.position.y-=7.5);d.position.y<c.position.y&&(d.position.y+=7.5)}d.position.y=Math.max(d.position.y,5);d.position.y=Math.min(d.position.y,4500);f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*200-f.z*12*w*2*u;d.position.x=Math.min(300,Math.max(-300,d.position.x));d.position.z=c.position.z-200;w=(t-0.1)/(0.39-0.1);cameraSpeed=6*w;c.position.z-=cameraSpeed*u;c.position.y+=Math.sin(c.position.z*0.07)*2*(1-w);m.position.x+=(c.position.x-m.position.x)*
0.01*u;m.position.y+=(c.position.y-m.position.y)*0.75*u;m.position.z+=(c.position.z-m.position.z)*0.01*u;m.target.position.x+=(d.position.x-m.target.position.x)*0.25*u;m.target.position.y+=(d.position.y-m.target.position.y)*0.25*u;m.target.position.z+=(d.position.z-m.target.position.z)*0.25*u}else{var A,B,D;switch(g){case 0:D="forward";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnZ().negate());A=200;B=50;break;case 1:D="left";e.origin.copy(c.matrixWorld.getPosition());
e.direction.copy(m.matrixWorld.getColumnX().negate());A=40;B=50;break;case 2:D="right";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnX());A=40;B=50;break;case 3:D="down";e.origin.copy(c.matrixWorld.getPosition()).y+=100;e.direction.copy(m.matrixWorld.getColumnY().negate());B=A=50;break;case 4:D="up";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnY());A=40;B=50}g++;g>4&&(g=0);h[D]=1;x=n.scene.collisions.rayCastNearest(e);y=-1;
if(x&&x.distance!==-1){y=x.distance*0.1;D!=="down"&&y<A+B&&(h[D]=y<A?0:1-(y-A)/B)}if(D!=="forward"&&h[D]<1){x=new THREE.Vector3;x.copy(e.direction).negate().multiplyScalar((1-h[D])*15);if(D==="left"||D==="right")x.y=0;else{x.x=0;x.z=0}d.position.addSelf(x);h[D]=Math.max(h[D],0.3);w*=0.1;v*=0.1}if(D==="down"&&y<50){D=c.position.y;c.position.y=e.origin.addSelf(e.direction.multiplyScalar(y)).y+10;d.position.y+=c.position.y-D}else e.origin.addSelf(e.direction.multiplyScalar(y)).y<200&&(h[D]=1);y=h.forward*
h.up*h.down*h.right*h.left;if(Math.abs(d.position.y-c.position.y)<80)d.position.y-=v*15;else{d.position.y>c.position.y&&(d.position.y-=15);d.position.y<c.position.y&&(d.position.y+=15)}d.position.y=Math.max(d.position.y,10);d.position.y=Math.min(d.position.y,4500);f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*200-f.z*12*w*u;d.position.z=c.position.z+f.z*200+f.x*12*w*u;cameraSpeed=10;b.cameraSlowDown||(cameraSpeed+=5*((Math.min(Math.max(c.position.y,10),3E3)-10)/2990));c.position.addSelf(f.multiplyScalar(cameraSpeed*
y*u));if(t<0.475){c.position.y+=7.5*u;d.position.y+=u*6.75}c.position.y=Math.max(c.position.y,10);c.position.y=Math.min(c.position.y,4500);m.position.x+=(c.position.x-m.position.x)*0.02*u;m.position.y+=(c.position.y-m.position.y)*0.02*u;m.position.z+=(c.position.z-m.position.z)*0.02*u;m.target.position.x+=(d.position.x-m.target.position.x)*0.02*u;m.target.position.y+=(d.position.y-m.target.position.y)*0.02*u;m.target.position.z+=(d.position.z-m.target.position.z)*0.02*u;w=m.matrixWorld.getColumnZ();
f.normalize();f.y=w.y;f.subSelf(w).normalize();f.multiplyScalar(0.3*u);c.up.set(0,1,0);c.up.subSelf(f).normalize();m.up.x+=(c.up.x-m.up.x)*0.02;m.up.y+=(c.up.y-m.up.y)*0.02;m.up.z+=(c.up.z-m.up.z)*0.02}};return o};
DunesCameraFreeExplore=function(b){var e=new THREE.Ray,c,d,f=new THREE.Vector3,h={forward:1,left:1,right:1,up:1,down:1},g=0,n,m;n=b.worlds.dunes;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);n.scene.addChild(m);n.scene.addChild(m.target);n.scene.addChild(c);n.scene.addChild(d);var o={};o.camera=m;o.resetCamera=function(){c.position.set(0,300,0);d.position.set(0,300,-500);d.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
m.position.copy(c.position);m.target.position.copy(d.position)};o.switchDirection=function(t){f.sub(m.position,m.target.position).normalize().multiplyScalar(t.radius*1.5).addSelf(t.object.matrixWorld.getPosition());c.position.copy(f);f.sub(m.position,m.target.position).normalize().multiplyScalar(t.radius*1.5+200).addSelf(t.object.matrixWorld.getPosition());d.position.copy(f);m.position.copy(c.position);m.target.position.copy(d.position)};o.updateCamera=function(t,u){u=1;var w,v,x;switch(g){case 0:x=
"forward";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnZ().negate());w=200;v=60;break;case 1:x="left";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnX().negate());w=40;v=60;break;case 2:x="right";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnX());w=40;v=60;break;case 3:x="down";e.origin.copy(c.matrixWorld.getPosition()).y+=100;e.direction.copy(m.matrixWorld.getColumnY().negate());w=50;v=
60;break;case 4:x="up";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnY());w=40;v=60}g++;g>4&&(g=0);h[x]=1;var y=n.scene.collisions.rayCastNearest(e),A=-1;if(y&&y.distance!==-1){A=y.distance*0.1;x!=="down"&&A<w+v&&(h[x]=A<w?0:1-(A-w)/v)}w=b.mouse.x/b.screenWidth-0.5;v=b.mouse.y/b.screenHeight-0.5;if(x!=="forward"&&h[x]<1){y=new THREE.Vector3;y.copy(e.direction).negate().multiplyScalar((1-h[x])*15);if(x==="left"||x==="right")y.y=0;else{y.x=0;y.z=0}d.position.addSelf(y);
h[x]=Math.max(h[x],0.3);w*=0.1;v*=0.1}if(x==="down"&&A<50){x=c.position.y;c.position.y=e.origin.addSelf(e.direction.multiplyScalar(A)).y+150;d.position.y+=c.position.y-x}else e.origin.addSelf(e.direction.multiplyScalar(A)).y<200&&(h[x]=1);A=h.forward*h.up*h.down*h.right*h.left;if(Math.abs(d.position.y-c.position.y)<100)d.position.y-=v*20;else{d.position.y>c.position.y&&(d.position.y-=20);d.position.y<c.position.y&&(d.position.y+=20)}d.position.y=Math.max(d.position.y,150);d.position.y=Math.min(d.position.y,
4500);f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*200-f.z*15*w*u;d.position.z=c.position.z+f.z*200+f.x*15*w*u;cameraSpeed=12;b.cameraSlowDown||(cameraSpeed+=13*((Math.min(Math.max(c.position.y,150),3E3)-150)/2850));c.position.addSelf(f.multiplyScalar(cameraSpeed*A*u));c.position.y=Math.max(c.position.y,150);c.position.y=Math.min(c.position.y,4500);m.position.x+=(c.position.x-m.position.x)*0.02*u;m.position.y+=(c.position.y-m.position.y)*0.02*u;m.position.z+=(c.position.z-
m.position.z)*0.02*u;m.target.position.x+=(d.position.x-m.target.position.x)*0.02*u;m.target.position.y+=(d.position.y-m.target.position.y)*0.02*u;m.target.position.z+=(d.position.z-m.target.position.z)*0.02*u;A=m.matrixWorld.getColumnZ();f.normalize();f.y=A.y;f.subSelf(A).normalize();f.multiplyScalar(0.4*u);c.up.set(0,1,0);c.up.subSelf(f).normalize();m.up.x+=(c.up.x-m.up.x)*0.02;m.up.y+=(c.up.y-m.up.y)*0.02;m.up.z+=(c.up.z-m.up.z)*0.02};return o};
PrairieCameraFreeExplore=function(b){var e,c,d=new THREE.Vector3,f,h,g,n,m=new THREE.Vector3;f=b.worlds.prairie;h=f.portals;n=new THREE.Vector3(350,0,-300);g=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);g.target.position.set(0,0,-100);e=new THREE.Object3D;c=new THREE.Object3D;c.position.set(0,0,-100);f.scene.addChild(g);f.scene.addChild(g.target);f.scene.addChild(e);f.scene.addChild(c);f={};f.camera=g;f.resetCamera=function(){e.position.set(n.x-200,25,n.z);c.position.set(n.x+300,25,
n.z);g.position.copy(e.position);g.target.position.copy(c.position)};f.updateCamera=function(o,t){t=1;var u=b.mouse.x/b.screenWidth-0.5,w=b.mouse.y/b.screenHeight-0.5;if(Math.abs(c.position.y-e.position.y)<200)c.position.y-=w*20;else{c.position.y>e.position.y&&(c.position.y-=20);c.position.y<e.position.y&&(c.position.y+=20)}d.sub(c.position,e.position).normalize();c.position.x=e.position.x+d.x*350-d.z*15*u*t;c.position.z=e.position.z+d.z*350+d.x*15*u*t;var v;w=9999999999;for(var x=0;x<h.length;x++){var y=
h[x];u=m.sub(y.object.matrixWorld.getPosition(),e.position).normalize().dot(d);if(u>0.7&&y.currentDistance<w){w=y.currentDistance;v=y}}if(v&&w<v.radius*2){m.sub(v.object.matrixWorld.getPosition(),e.position);e.position.addSelf(m.normalize().multiplyScalar(2*t))}else{v=d.multiplyScalar(2*t);v.y=(25-e.position.y)*0.03;e.position.addSelf(v);w=e.position.x-n.x;x=e.position.z-n.z;u=m.sub(n,e.position).normalize().dot(d);Math.sqrt(w*w+x*x)>795&&u<0&&e.position.subSelf(v)}g.position.x+=(e.position.x-g.position.x)*
0.02*t;g.position.y+=(e.position.y-g.position.y)*0.02*t;g.position.z+=(e.position.z-g.position.z)*0.02*t;g.target.position.x+=(c.position.x-g.target.position.x)*0.02*t;g.target.position.y+=(c.position.y-g.target.position.y)*0.02*t;g.target.position.z+=(c.position.z-g.target.position.z)*0.02*t;u=g.matrixWorld.getColumnZ();d.normalize();d.y=u.y;d.subSelf(u).normalize();d.multiplyScalar(0.4*t);e.up.set(0,1,0);e.up.subSelf(d).normalize();g.up.x+=(e.up.x-g.up.x)*0.02;g.up.y+=(e.up.y-g.up.y)*0.02;g.up.z+=
(e.up.z-g.up.z)*0.02};return f};
CityCameraFreeExplore=function(b){var e={start:new THREE.Vector3(-3E3,10,-1500),end:new THREE.Vector3(3E3,200,-1500)},c={start:new THREE.Vector3(0,10,-300),end:new THREE.Vector3(0,250,-3200)},d,f,h=new THREE.Vector3,g=new THREE.Vector3,n,m,o;n=b.worlds.city;o=n.portals;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);d=new THREE.Object3D;f=new THREE.Object3D;f.position.set(0,0,-100);n.scene.addChild(m);n.scene.addChild(m.target);n.scene.addChild(d);n.scene.addChild(f);
n={};n.camera=m;n.resetCamera=function(){d.position.set(c.start.x,c.start.y,(c.end.z+c.start.z)*0.5);f.position.set(e.start.x,c.start.y,d.position.z);m.position.copy(d.position);m.target.position.copy(f.position)};n.updateCamera=function(t,u){u=1;var w=b.mouse.x/b.screenWidth-0.5,v=b.mouse.y/b.screenHeight-0.5;Math.abs(f.position.y-d.position.y)<50&&(f.position.y-=v*20);f.position.y=Math.max(f.position.y,c.start.y);f.position.y=Math.min(f.position.y,c.end.y);h.sub(f.position,d.position).normalize();
f.position.x=d.position.x+h.x*500-h.z*25*w*u;f.position.z=d.position.z+h.z*500+h.x*25*w*u;var x;w=9999999999;for(v=0;v<o.length;v++){var y=o[v];if(g.sub(y.object.matrixWorld.getPosition(),d.position).normalize().dot(h)>0.7&&y.currentDistance<w){w=y.currentDistance;x=y}}if(x&&w<x.radius*4){g.sub(x.object.matrixWorld.getPosition(),d.position);d.position.addSelf(g.normalize().multiplyScalar(10*u))}else{cameraSpeed=10;cameraSpeed+=2*((Math.min(Math.max(d.position.y,c.start.y),c.end.y)-c.start.y)/(c.end.y-
c.start.y));d.position.addSelf(h.multiplyScalar(cameraSpeed*u));d.position.x=c.start.x;d.position.y=Math.max(Math.min(d.position.y,c.end.y),c.start.y);d.position.z=Math.min(Math.max(d.position.z,c.end.z),c.start.z)}m.position.x+=(d.position.x-m.position.x)*0.05*u;m.position.y+=(d.position.y-m.position.y)*0.05*u;m.position.z+=(d.position.z-m.position.z)*0.05*u;m.target.position.x+=(f.position.x-m.target.position.x)*0.2*u;m.target.position.y+=(f.position.y-m.target.position.y)*0.2*u;m.target.position.z+=
(f.position.z-m.target.position.z)*0.2*u;x=m.matrixWorld.getColumnZ();h.normalize();h.y=x.y;h.subSelf(x).normalize();h.multiplyScalar(0.4*u);d.up.set(0,1,0);d.up.subSelf(h).normalize();m.up.x+=(d.up.x-m.up.x)*0.05;m.up.y+=(d.up.y-m.up.y)*0.05;m.up.z+=(d.up.z-m.up.z)*0.05};return n};
Trigger=function(b,e){var c={},d=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,d);var f=1,h=0;e=e!==undefined?e:0;var g=c.mesh.morphTargetForcedOrder,n=(b.morphTargets.length-1)*1E3;g[0]=0;g[1]=1;c.play=function(m){f=m||1;h=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);
c.update(0)};c.update=function(m){h+=m*f;if(h>=n){g[0]=0;g[1]=c.mesh.geometry.morphTargets.length-1;d.uniforms.morph.value=1;d.uniforms.darkness.value=e;THREE.AnimationHandler.removeFromUpdate(c)}else{m=h/n;var o,t=0.1,u=0.7;if(m==0)m=0;else if(m==1)m=1;else{u||(u=0.3);if(!t||t<1){t=1;o=u/4}else o=u/(2*Math.PI)*Math.asin(1/t);m=t*Math.pow(2,-10*m)*Math.sin((m-o)*2*Math.PI/u)+1}m*=n;if(m<n){g[0]=Math.floor(m/1E3);g[1]=Math.ceil(m/1E3)}else{g[0]=c.mesh.geometry.morphTargets.length-2;g[1]=c.mesh.geometry.morphTargets.length-
1}d.uniforms.morph.value=m/n;d.uniforms.darkness.value=e*h/n}};return c};
var TriggerBig=function(b){var e={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});e.mesh=new THREE.Mesh(b,c);e.mesh.doubleSided=!0;var d=0.1,f=0,h=(b.morphTargets.length-1)*1E3,g=e.mesh.morphTargetForcedOrder;g[0]=0;g[1]=1;e.play=function(n){d=n||1;f=0;THREE.AnimationHandler.addToUpdate(e);e.update(0)};e.update=
function(n){f+=n*d;if(f>=h){g[0]=0;g[1]=e.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(e)}else{n=f/h*h;if(n<h){g[0]=Math.floor(n/1E3);g[1]=Math.ceil(n/1E3)}else{g[0]=e.mesh.geometry.morphTargets.length-2;g[1]=e.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=n/h}};return e},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var e=[],c=[],d=[];b.setupCityTriggers=function(f){if(f.triggers){var h,g,n,m,o=f.triggers,
t=[];for(n in o)if(n.indexOf("TriggerMesh")!==-1){m=o[n];m.name=n.slice(n.indexOf("_")+1);m.geometry=f.geometries[m.object.geometry];t.push(m);f.objects[n].parent.removeChild(f.objects[n]);f.objects[n].visible=!1;delete o[n]}e=[];c=[];for(n in o){h=0;for(g=t.length;h<g;h++)if(n.indexOf(t[h].name)!==-1&&t[h].geometry.morphTargets.length){if(o[n].type==="Small"){m=new Trigger(t[h].geometry);f.objects[n].addChild(m.mesh);m.mesh.visible=!1;e.push(m)}else{m=new TriggerBig(t[h].geometry);f.objects[n].addChild(m.mesh);
c.push(m)}m.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(f){var h,g,n=f.geometries,m,o,t,u,w,v,x;for(h in n){g=n[h];if(g.morphTargets.length){m=0;for(o=g.morphTargets.length;m<o;m++){w=g.morphTargets[m].vertices;t=0;for(u=w.length;t<u;t++){v=w[t].position;x=v.y;v.y=-v.z;v.z=x}}}}g=f.objects;d=[];for(h in g)if(g[h].geometry&&g[h].geometry.morphTargets.length){f=new Trigger(g[h].geometry,Math.random()*0.25+0.5);g[h].addChild(f.mesh);g[h].visible=!1;d.push(f)}};b.update=function(f){var h,
g,n,m,o=b.effectors,t,u,w,v=b.effectorRadius*1.5;if(f==="city"){f=0;for(h=e.length;f<h;f++){g=e[f].mesh.matrixWorld.getPosition();n=0;for(m=o.length;n<m;n+=3){t=Math.abs(o[n+0]-g.x);u=Math.abs(o[n+1]-g.y);w=Math.abs(o[n+2]-g.z);if(t+u+w<v){e[f].play(0.1+Math.random()*0.05);e.splice(f,1);f--;h--;break}}}f=0;for(h=c.length;f<h;f++){g=c[f].mesh.matrixWorld.getPosition();n=0;for(m=o.length;n<m;n+=3){t=Math.abs(o[n+0]-g.x);u=Math.abs(o[n+1]-g.y);w=Math.abs(o[n+2]-g.z);if(t+u+w<v){c[f].play(0.2+Math.random()*
0.1);c.splice(f,1);f--;h--;break}}}}else{f=0;for(h=d.length;f<h;f++){g=d[f].mesh.matrixWorld.getPosition();n=0;for(m=o.length;n<m;n+=3){t=Math.abs(o[n+0]-g.x);u=Math.abs(o[n+1]-g.y);w=Math.abs(o[n+2]-g.z);if(t+u+w<v){d[f].play(0.1+Math.random()*0.05);d.splice(f,1);f--;h--;break}}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,e,c){var d=this;d.camera=b;renderer=c.renderer;c.camPos=new THREE.Vector3(0,0,-300);var f=new THREE.JSONLoader;f.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};c.trigger=new THREE.Vector3(0,0,0);var h=0,g=new CollisionScene(d.camera,e,0.1,c,500,!0);g.settings.maxSpeedDivider=2;g.settings.capBottom=3;g.settings.capTop=1E3;g.settings.shootRayDown=!1;g.settings.allowFlying=!1;g.settings.emitterDivider=8;
g.settings.normalOffsetAmount=8;g.settings.minDistance=100;g.settings.keepEmitterFollowDown=!0;g.emitter.position.z=-100;g.emitterFollow.position.z=-100;g.cameraTarget.position.z=-100;f.load({model:"files/models/city/collision/City.Collision_Big.js",callback:function(E){var O=new THREE.Vector3(-1.570796,0,3.141591),L=new THREE.Vector3;g.addLoaded(E,0.1,O,L,e)}});f.load({model:"files/models/city/collision/City.Collision_Big.001.js",callback:function(E){var O=new THREE.Vector3(-1.570796,0,0),L=new THREE.Vector3;
g.addLoaded(E,0.1,O,L,e)}});f.load({model:"files/models/city/collision/City.Collision_Big.002.js",callback:function(E){var O=new THREE.Vector3(-1.570796,0,0),L=new THREE.Vector3;g.addLoaded(E,0.1,O,L,e)}});f.load({model:"files/models/city/collision/City.Collision_Big.003.js",callback:function(E){var O=new THREE.Vector3(-1.570796,0,1.570797),L=new THREE.Vector3;g.addLoaded(E,0.1,O,L,e)}});b.target=g.cameraTarget;b=new THREE.Vector3(0,0,100);var n=new Vectors(50,2,2,b),m=[new THREE.MeshLambertMaterial({color:5997888,
opacity:1}),new THREE.MeshLambertMaterial({color:4285993,opacity:1}),new THREE.MeshLambertMaterial({color:3103761,opacity:1}),new THREE.MeshLambertMaterial({color:6525252,opacity:1})],o=new Ribbons(4,n.array,e,m);o.settings.ribbonPulseMultiplier_1=15;o.settings.ribbonPulseMultiplier_2=0;o.settings.ribbonMin=0.1;o.settings.ribbonMax=0.2;m=THREE.ImageUtils.loadTexture("files/textures/particle_0.png");var t=THREE.ImageUtils.loadTexture("files/textures/particle_1.png"),u=THREE.ImageUtils.loadTexture("files/textures/particle_2.png"),
w=THREE.ImageUtils.loadTexture("files/textures/particle_3.png"),v=THREE.ImageUtils.loadTexture("files/textures/particle_4.png"),x=new Particles(22,e,5,[m,t,u,w,v],20,70,THREE.AdditiveBlending);x.settings.gravitateTowardsCamera=!0;var y=new Stragglers(5,e,n.array);y.settings.capy=0;var A=new AnimalSwarm(30,e,n.array);A.settings.addaptiveSpeed=!0;A.settings.capy=0;A.settings.startPosition=b;A.settings.constantSpeed=0.75;A.array[0]="moose";A.array[22]="moose";A.array[2]="elk";A.array[10]="elk";A.array[1]=
"elk";A.array[25]="elk";A.array[8]="fish";A.array[16]="fish";A.array[5]="sockjump";A.array[26]="sockjump";A.array[13]="sockpopup";A.array[29]="sockjump";f.load({model:"files/models/soup/animals_A_life.js",callback:function(E){var O=[1,0,4,3,2,1,0,5,2,7,8,9,10,1,0,3,3,9,2,3],L=[6.5,13.12,9.76,7.47,4.74,4.94,0.777,6.252,3.412,5.52,5.576];A.addAnimal(E,null,1.5,O,L);O=[8,9,7,9,10];E=y.addAnimal(E,null,1.8,O,L);preinitAnimal(E,renderer,e)}});f.load({model:"files/models/soup/elk_life.js",callback:function(E){E=
A.addAnimal(E,"elk",2.2,null,[6]);preinitAnimal(E,renderer,e)}});f.load({model:"files/models/soup/moose_life.js",callback:function(E){E=A.addAnimal(E,"moose",1.1,null,[13.964]);preinitAnimal(E,renderer,e)}});f.load({model:"files/models/soup/fish_life.js",callback:function(E){E=A.addAnimal(E,"fish",1.6,[0,1,2,3],[2]);preinitAnimal(E,renderer,e);A.array[8].isFish=!0;A.array[16].isFish=!0}});f.load({model:"files/models/soup/sockpuppet_jump.js",callback:function(E){E=A.addAnimal(E,"sockjump",1.8,null,
[3],!0);preinitAnimal(E,c.renderer,e)}});f.load({model:"files/models/soup/sockpuppet_popup.js",callback:function(E){E=A.addAnimal(E,"sockpopup",2,null,[0.1],!0);preinitAnimal(E,c.renderer,e)}});var B=new AnimalSwarm(10,e,n.array);B.settings.flying=!0;B.settings.flyingDistance=45;for(b=0;b<10;++b)b%2==0&&(B.array[b]="b");f.load({model:"files/models/soup/birds_A_life.js",callback:function(E){E=B.addAnimal(E,null,1.3,[0,1,2,3,0,1,2,3,0,1],[4.848,7,7.5,3.5]);preinitAnimal(E,renderer,e)}});f.load({model:"files/models/soup/birds_B_life.js",
callback:function(E){E=B.addAnimal(E,"b",1.3,[1,1,0,0,1,0,0,1,0,0],[8.5,8.623]);preinitAnimal(E,renderer,e)}});var D=new AnimalSwarm(70,e,n.array);D.settings.flying=!0;D.settings.divider=1;D.settings.flyingDistance=30;D.settings.xPositionMultiplier=20;D.settings.zPositionMultiplier=20;D.settings.constantSpeed=2;D.settings.butterfly=!0;f.load({model:"files/models/soup/butterfly_low.js",callback:function(E){D.addAnimal(E,null,5,[0,1,2,3],5,null,!0)}});var C=new AnimalInFrontOfCamera(15,e);f.load({model:"files/models/soup/butterfly_hiD.js",
callback:C.addAnimal});var G=new AnimalInFrontOfCamera(15,e);f.load({model:"files/models/soup/butterfly_hiC.js",callback:G.addAnimal});var F=new Trail(80,e);F.settings.freeRotation=!1;F.settings.tweenTime=2500;F.settings.aliveDivider=30;F.settings.offsetAmount=10;for(b=0;b<80;++b){m=b%4;F.array[b]="0"+(m+1)}F.array[10]="tree1";F.array[30]="tree2";F.array[45]="tree3";F.array[60]="tree4";F.array[75]="tree5";for(b=0;b<80;b+=8){m=b/8%4;F.array[b]="tree"+(m+1)}F.array[70]="light";f.load({model:"files/models/soup/grass01.js",
callback:function(E){F.addInstance(E,"01",!1)}});f.load({model:"files/models/soup/grass02.js",callback:function(E){var O=F.addInstance(E,"02",!1);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/grass03.js",callback:function(E){var O=F.addInstance(E,"03",!1);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/grassFlower.js",callback:function(E){var O=F.addInstance(E,"04",!1);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/evergreen_low.js",callback:function(E){var O=
F.addInstance(E,"tree1",!0);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/evergreen_high.js",callback:function(E){var O=F.addInstance(E,"tree2",!0);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/treeGeneric.js",callback:function(E){var O=F.addInstance(E,"tree3",!0);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/treeGenericLower.js",callback:function(E){var O=F.addInstance(E,"tree4",!0);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/treeOrange.js",
callback:function(E){var O=F.addInstance(E,"tree5",!0);preInitModel(E,renderer,e,O)}});f.load({model:"files/models/soup/lighthouse.js",callback:function(E){var O=F.addInstance(E,"light",!1,!0);preInitModel(E,renderer,e,O);F.array[4].maxHeight=12}});this.update=function(E){if(!isNaN(E)&&!(E>1E3||E==0)){c.camPos.x=d.camera.matrixWorld.n14;c.camPos.y=d.camera.matrixWorld.n24;c.camPos.z=d.camera.matrixWorld.n34;if(c.camPos.z<=-3290||c.camPos.x>1640||c.camPos.x<-1640){c.camPos=new THREE.Vector3(0,0,-300);
g.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);A.reset(c.camPos.x,c.camPos.y,c.camPos.z);B.reset(c.camPos.x,c.camPos.y,c.camPos.z);D.reset(c.camPos.x,c.camPos.y,c.camPos.z);x.reset(c.camPos.x,c.camPos.y,c.camPos.z);y.reset(c.camPos.x,c.camPos.y,c.camPos.z)}h%8==7&&y.create(g.emitterFollow.position,g.currentNormal,g.emitter.position);++h;var O=0;h%4==0&&(O=(Math.random()-0.5)*1.2);if(h%2==0)d.camera.animationParent.position.y=18+(Math.random()-0.5)*1.2;d.camera.position.x=
0+O;if(h%15==14){A.create(n.array[1].position,g.currentNormal);B.create(n.array[1].position,g.currentNormal)}g.update(c.camPos,E);n.update(g.emitterFollow.position,g.currentNormal);o.update(g.emitterFollow.position);x.update(E,n.array[0].position,c.camPos);A.update(E,c.camPos);y.update(E,c.camPos);B.update(E,c.camPos);D.update();G.update(c.camPos,d.camera.theta,E);C.update(c.camPos,d.camera.theta,E,!0);F.update(g.emitter.position,g.emitterNormal,c.camPos,E);TWEEN.update();TriggerUtils.effectors[0]=
g.emitter.position.x;TriggerUtils.effectors[1]=g.emitter.position.y;TriggerUtils.effectors[2]=g.emitter.position.z}};this.changeCamera=function(E){d.camera=E;g.settings.camera=E};this.destruct=function(){}},PrairieSoup=function(b,e,c){c.camPos=new THREE.Vector3(302.182,-9.045,-105.662);var d=new THREE.JSONLoader;d.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=0,h=0,g=[],n,m,o,t,u,w=new CollisionScene(b,e,1,c,1100);
w.settings.maxSpeedDivider=1;w.settings.allowFlying=!1;w.settings.emitterDivider=2;w.settings.shootRayDown=!1;w.settings.keepEmitterFollowDown=!0;w.settings.normalOffsetAmount=7;w.settings.minDistance=0;w.emitter.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);w.emitterFollow.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);var v=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30);n=new Vectors(30,10,10,v);var x=THREE.ImageUtils.loadTexture("files/textures/dark_0.png"),y=THREE.ImageUtils.loadTexture("files/textures/dark_1.png"),
A=THREE.ImageUtils.loadTexture("files/textures/dark_2.png"),B=THREE.ImageUtils.loadTexture("files/textures/dark_3.png"),D=THREE.ImageUtils.loadTexture("files/textures/dark_4.png");u=new Particles(20,e,1.5,[x,y,A,B,D],70,60);u.settings.zeroAlphaStart=!1;u.settings.aliveDivider=2;o=new AnimalSwarm(40,e,n.array);o.settings.xPositionMultiplier=22;o.settings.zPositionMultiplier=18;o.settings.shootRayDown=!0;o.settings.adaptiveSpeed=!0;o.settings.divider=1;o.settings.startPosition=v;o.array[7]="gator";
o.array[8]="gator";o.array[9]="animal";o.array[11]="goat";o.array[13]="gator";o.array[14]="arm";o.array[15]="gator";o.array[16]="goat";o.array[18]="goat";o.array[19]="animal";o.array[20]="animal";o.array[21]="animal";o.array[22]="animal";o.array[23]="animal";o.array[24]="animal";o.array[25]="animal";o.array[26]="animal";o.array[27]="animal";o.array[28]="animal";o.array[29]="animal";o.array[30]="octo";o.array[31]="octo";o.array[32]="octo";o.array[33]="octo";o.array[34]="centipede";o.array[35]="goat";
o.array[36]="octo";d.load({model:"files/models/soup/taruffalo_black.js",callback:function(G){G=o.addAnimal(G,null,0.25,[0,1,0,1],[9.2,9.2]);preinitAnimal(G,c.renderer,e)}});d.load({model:"files/models/soup/animals_A_black.js",callback:function(G){G=o.addAnimal(G,"animal",0.35,[3,1,2,0,1,0,2,0,2,3,0],[11.12,9.73,6.7,3.06]);preinitAnimal(G,c.renderer,e)}});d.load({model:"files/models/soup/gator_black.js",callback:function(G){G=o.addAnimal(G,"gator",0.35,null,[4.5]);preinitAnimal(G,c.renderer,e)}});
d.load({model:"files/models/soup/goat_black.js",callback:function(G){G=o.addAnimal(G,"goat",0.45,null,[5.2]);preinitAnimal(G,c.renderer,e)}});d.load({model:"files/models/soup/arm_black.js",callback:function(G){G=o.addAnimal(G,"arm",3,null,[1]);preinitAnimal(G,c.renderer,e);o.array[14].generalSpecialCase=!0}});d.load({model:"files/models/soup/octo_black.js",callback:function(G){G=o.addAnimal(G,"octo",0.25,[0,0,1,2],[1.629,3,1.7]);preinitAnimal(G,c.renderer,e)}});d.load({model:"files/models/soup/sickle.js",
callback:function(G){G=o.addAnimal(G,"sickle",1.5,null,[0.5]);preinitAnimal(G,c.renderer,e)}});d.load({model:"files/models/soup/centipede.js",callback:function(G){G=o.addAnimal(G,"centipede",0.5,null,[1]);preinitAnimal(G,c.renderer,e)}});t=new AnimalSwarm(10,e,n.array);t.settings.flying=!0;t.settings.xPositionMultiplier=24;t.settings.zPositionMultiplier=12;t.settings.constantSpeed=2;t.settings.divider=4;t.settings.flyingDistance=-15;d.load({model:"files/models/soup/birds_A_black.js",callback:function(G){G=
t.addAnimal(G,null,0.4,[0,0,0,0,1,0,0,1,0,1],[12,14]);preinitAnimal(G,c.renderer,e)}});var C=[new THREE.MeshLambertMaterial({color:65793})];m=new Trail(80,e);for(i=0;i<80;++i)m.array[i]="01";m.settings.spread=10;m.settings.aliveDivider=40;m.settings.tweenTime=800;m.settings.scale=0.3;m.settings.offsetAmount=10;d.load({model:"files/models/soup/darkblob01.js",callback:function(G){var F=m.addInstance(G,"01",!1,!1);preInitModel(G,renderer,e,F)}});d.load({model:"files/models/soup/darkblob02.js",callback:function(G){var F=
m.addInstance(G,"02",!1,!1);preInitModel(G,renderer,e,F)}});d.load({model:"files/models/soup/grass03.js",callback:function(G){var F=m.addInstance(G,"03",!1,!1,C);preInitModel(G,renderer,e,F)}});d.load({model:"files/models/soup/grass04.js",callback:function(G){var F=m.addInstance(G,"04",!1,!1,C);preInitModel(G,renderer,e,F)}});d.load({model:"files/models/soup/grass05.js",callback:function(G){var F=m.addInstance(G,"05",!1,!1);preInitModel(G,renderer,e,F)}});this.update=function(G,F){if(F){c.camPos.copy(F.matrixWorld.getPosition());
w.settings.camera=F}else{c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;w.settings.camera=b}if(c.camPos.x>1090){c.camPos.set(302.182,-9.045,-105.662);w.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);o.reset(c.camPos.x,c.camPos.y,c.camPos.z);t.reset(c.camPos.x,c.camPos.y,c.camPos.z);u.reset(c.camPos.x,c.camPos.y,c.camPos.z)}f+=G;h+=G;w.update(c.camPos,G);n.update(w.emitterFollow.position,w.currentNormal);u.update(G,n.array[0].position);
o.update(G,c.camPos);t.update(G,c.camPos);m.update(w.emitter.position,w.emitterNormal,c.camPos,G);if(f>=100){var E=Math.random()*20-10,O=Math.random()*20-10,L=new THREE.Vector3,H=new THREE.Vector3;L.copy(w.emitterFollow.position);H.copy(w.emitter.position);L.x+=E;H.x+=E;L.z+=O;H.z+=O;o.create(L,w.currentNormal,H);f=0}if(h>=500){t.create(w.emitterFollow.position,w.currentNormal,w.emitter.position);h=0}TWEEN.update();E=new THREE.Vector3(w.emitter.position.x,w.emitter.position.y,w.emitter.position.z);
g.unshift(E);if(g.length>50){E=g[50];c.lavatrailx=E.x;c.lavatrailz=E.z}if(g.length>40){E=g[40];ROME.TrailShader.uniforms.lavaHeadPosition.value.set(E.x,0,-E.z)}TriggerUtils.effectors[0]=w.emitter.position.x;TriggerUtils.effectors[1]=w.emitter.position.y;TriggerUtils.effectors[2]=w.emitter.position.z};this.destruct=function(){}},DunesSoup=function(b,e,c){c.camPos=new THREE.Vector3(0,150,0);var d=new THREE.JSONLoader;d.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};
var f=new CollisionScene(b,e,0.15,c,3E3);f.settings.emitterDivider=4;f.settings.maxSpeedDivider=0.5;f.settings.allowFlying=!0;var h=new Vectors;h.settings.divider=3;var g=[new THREE.MeshBasicMaterial({color:14283771,opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,
opacity:0.25})],n=new Ribbons(6,h.array,e,g);n.settings.ribbonPulseMultiplier_1=20;n.settings.ribbonPulseMultiplier_2=0.01;n.settings.ribbonMin=0.05;n.settings.ribbonMax=0.1;var m=new AnimalSwarm(20,e,h.array);m.settings.flying=!0;m.settings.flyingDistance=10;m.settings.divider=10;m.settings.constantSpeed=0.8;m.settings.respawn=!1;for(g=0;g<20;++g)g%2==0&&(m.array[g]="b");d.load({model:"files/models/soup/birds_A_life.js",callback:function(o){o=m.addAnimal(o,null,2.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(o,
c.renderer,e)}});d.load({model:"files/models/soup/birds_B_life.js",callback:function(o){o=m.addAnimal(o,"b",2.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(o,c.renderer,e)}});this.update=function(o){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;m.create(h.array[1].position,f.currentNormal);f.update(c.camPos,o);h.update(f.emitterFollow.position,f.currentNormal);n.update(f.emitterFollow.position);m.update(o,c.camPos)};this.destruct=function(){}},Ribbon=function(b,
e,c){b=b||100;e=e||10;c=c||10;THREE.Geometry.call(this);e/=2;b/=c;for(var d=[],f=0;f<c+2;++f){var h=f*b,g=-e;d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(h,e,0)))-1);d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(h,g,0)))-1)}for(f=0;f<c*2;f+=2){this.faces.push(new THREE.Face3(d[f],d[f+2],d[f+1]));this.faces.push(new THREE.Face3(d[f+2],d[f+3],d[f+1]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;
Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,e){var c=ROME.AnimalAnimationData.init(b,e),d={};d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.availableAnimals=c.availableAnimals;d.mesh=new THREE.Mesh(b,c.material);var f=!1,h=d.mesh.morphTargetForcedOrder,g=c.material;d.play=function(m,o,t,u,w){if(!f){f=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}o=
o!==undefined?o:m;n(m,d.animalA);n(o,d.animalB);d.animalA.currentTime=u?u:0;d.animalB.currentTime=w?w:0;d.update(0)};d.update=function(m){if(d.mesh._modelViewMatrix){var o,t=["animalA","animalB"],u,w,v,x,y,A;u=0;w=t.length;for(A=0;u<w;u++){o=d[t[u]];y=o.currentTime;o.currentTime=(o.currentTime+m*o.timeScale)%o.lengthInMS;if(y>o.currentTime)o.currentFrame=0;y=0;v=o.currentFrame;for(x=o.lengthInFrames-1;v<x;v++)if(o.currentTime>=o.frames[v].time&&o.currentTime<o.frames[v+1].time){y=v;break}o.currentFrame=
y;v=y+1<x?y+1:0;h[A++]=o.frames[y].index;h[A++]=o.frames[v].index;y=o.frames[y].time;v=o.frames[v].time>y?o.frames[v].time:o.frames[v].time+o.lengthInMS;o=(o.currentTime-y)/(v-y);g.uniforms[t[u]+"Interpolation"].value=o}g.uniforms.animalMorphValue.value=d.morph;if(g.attributes[d.animalA.name]!==undefined)g.attributes.colorAnimalA.buffer=g.attributes[d.animalA.name].buffer;if(g.attributes[d.animalB.name]!==undefined)g.attributes.colorAnimalB.buffer=g.attributes[d.animalB.name].buffer}};d.setNewTargetAnimal=
function(m,o){if(d.morph===1){for(var t in d.animalA)d.animalA[t]=d.animalB[t];d.animalB.currentTime=o?o:0;n(m,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var n=function(m,o){if(ROME.AnimalAnimationData[m]!==undefined){o.frames=ROME.AnimalAnimationData[m];o.lengthInFrames=o.frames.length;o.lengthInMS=o.frames[o.lengthInFrames-1].time;o.name=m.toLowerCase();o.normalsOffset=Math.floor(o.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
m)};return d};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 1.0 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 ) * vec4( 0.9, 0.85, 0.8, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["tarbuffalo","bearbrown","horse","deer","mountainlion","goldenRetreiver","fox","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","blackWidow","crab","scorp","goat","gator","tarbuffalo_runB","tarbuffalo","wolf","panther","bearblack","toad","eagle","owl","parrot","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD","raven",
"vulture","bison","sickle","armHand","sickle","centipede","shdw2","shdw5","drownArm_A","drownArm_C"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.15,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},blackWidow:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,
vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.45},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:-0.1},cow:{hRange:0,sRange:0,
vRange:0.2,hOffset:0,sOffset:0.05,vOffset:-0.25},cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,sRange:0,vRange:0.15,hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},
flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},frog:{hRange:0.05,sRange:0.1,vRange:0.25,hOffset:0.01,sOffset:0.05,vOffset:-0.1},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.26},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,
sRange:0.1,vRange:0.25,hOffset:-0.0050,sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},moose:{hRange:0.07,sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.0050,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.16},parrot:{hRange:0.05,sRange:0.1,
vRange:0.3,hOffset:-0.025,sOffset:0.1,vOffset:-0.1},raccoon:{hRange:0,sRange:0.1,vRange:0.25,hOffset:0.6,sOffset:-0.1,vOffset:-0.2},raven:{hRange:0.02,sRange:0.1,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.15},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:-0.1},shdw2:{hRange:0,sRange:0.1,vRange:0.06,hOffset:0,sOffset:-0.05,vOffset:-0.15},sickle:{hRange:0.04,sRange:0,vRange:0.1,hOffset:0,sOffset:-0.2,vOffset:-0.3},
stork:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.175},toad:{hRange:0.07,sRange:0,vRange:0.1,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.08,hOffset:0,sOffset:-0.1,vOffset:-0.16},wolf:{hRange:0,sRange:0.2,vRange:0.06,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",
bearbrown:"bearBrown",bearblack:"bearBlack",blackwidow:"blackWidow",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",
mountainlion:"mountainlion",mountainlionblack:"panther",owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,e){if(b.initialized){t=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,
morphTargets:!0});for(g in b.customAttributes){var c=b.customAttributes[g];t.attributes[g]=g==="colorAnimalA"||g==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var d,f,h;t=b.morphTargets;var g,n,m,o;if(e){n=0;for(m=t.length;n<m;n++){g=0;for(h=this.animalNames.length;g<h;g++){f=this.animalNames[g];if(t[n].name.indexOf(f)!==-1)break}if(g===h){f=t[n].name;for(g=0;g<f.length;g++){h=
f.charCodeAt(g);if(!(h>=65&&h<=90||h>=97&&h<=122))break}this.animalNames.push(f.slice(0,g))}}}g=0;for(h=this.animalNames.length;g<h;g++){f=this.animalNames[g];d=this[f];o=0;if(d===undefined||d.length===0){d=this[f]=[];n=0;for(m=t.length;n<m;n++)if(t[n].name.indexOf(f)!==-1){d.push({index:n,time:o});o+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{n=0;for(m=t.length;n<m;n++)c.indexOf(f)===-1&&t[n].name.indexOf(f)!==-1&&c.push(f)}}var t=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),
attributes:ROME.AnimalShader.attributes(),vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors}),u;d=b.morphColors;o=t.attributes;if(b.morphColors&&b.morphColors.length){n=0;for(m=d.length;n<m;n++){u=d[n];f=u.name;for(g=0;g<f.length;g++){h=f.charCodeAt(g);if(!(h>=65&&h<=90||h>=97&&h<=122))break}f=f.slice(0,g).toLowerCase();o[f]={type:"c",boundTo:"faces",value:u.colors};g=this.colorVariations.zero;this.animalVariationMap[f]!==
undefined&&(g=this.colorVariations[this.animalVariationMap[f]]);t.uniforms.lightScale.value=g.lScale?g.lScale:0.5;g.lOffset?t.uniforms.lightOffset.value.set(g.lOffset[0],g.lOffset[1],g.lOffset[2]):t.uniforms.lightOffset.value.set(0.6,0.6,0.6);randomizeColors(o[f].value,g)}o.colorAnimalA.value=d[0].colors;o.colorAnimalB.value=d[0].colors;g=0;for(h=c.length;g<h;g++){f=c[g].toLowerCase();n=0;for(m=d.length;n<m;n++){u=d[n].name.toLowerCase();if(u.indexOf(f)!==-1)break}if(n===m){console.error("Animal.constructor: Morph Color missing for animal "+
f+". Deploying backup plan.");o[f]={type:"c",boundTo:"faces",value:[]};n=0;for(m=b.faces.length;n<m;n++)o[f].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");n=0;for(m=b.faces.length;n<m;n++)o.colorAnimalA.value.push(new THREE.Color(16711935));o.colorAnimalB.value=o.colorAnimalA.value;g=0;for(h=c;g<h;g++)o[c[g]]={type:"c",boundTo:"faces",value:o.colorAnimalA.value}}b.availableAnimals=c;b.customAttributes=t.attributes}return{availableAnimals:b.availableAnimals,
material:t}}};function randomizeColors(b,e){var c,d,f,h,g,n;c=0;for(d=b.length;c<d;c++){f=b[c];h=e.hRange*Math.random()+e.hOffset;g=e.sRange*Math.random()+e.sOffset;n=e.vRange*Math.random()+e.vOffset;THREE.ColorUtils.adjustHSV(f,h,g,n)}}
ROME.Animal_old=function(b,e){var c=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader_old.uniforms,vertexShader:ROME.AnimalShader_old.vertex,fragmentShader:ROME.AnimalShader_old.fragment,morphTargets:!0,vertexColors:b.materials[0][0].vertexColors,lights:!0}),d={};d.mesh=new THREE.Mesh(b,c);d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};
d.availableAnimals=ROME.AnimalAnimationData_old.init(b,e);for(var f=!1,h=d.mesh.morphTargetForcedOrder,g,n,m,o,t=0;t<b.faces.length;t++){g=b.faces[t].color;n=0*Math.random()+0;m=0*Math.random()+0;o=0.4*Math.random()+-0.3;THREE.ColorUtils.adjustHSV(g,n,m,o)}d.play=function(w,v,x,y,A){if(!f){f=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}u(w,d.animalA);u(v,d.animalB);d.animalA.currentTime=y?y:0;d.animalB.currentTime=A?A:0;d.update(0)};d.update=function(w){var v,x=["animalA","animalB"],y,A,B,D,
C,G;y=0;A=x.length;for(G=0;y<A;y++){v=d[x[y]];C=v.currentTime;v.currentTime=(v.currentTime+w*v.timeScale)%v.lengthInMS;if(C>v.currentTime)v.currentFrame=0;C=0;B=v.currentFrame;for(D=v.lengthInFrames-1;B<D;B++)if(v.currentTime>=v.frames[B].time&&v.currentTime<v.frames[B+1].time){C=B;break}v.currentFrame=C;B=C+1<D?C+1:0;h[G++]=v.frames[C].index;h[G++]=v.frames[B].index;C=v.frames[C].time;B=v.frames[B].time>C?v.frames[B].time:v.frames[B].time+v.lengthInMS;v=(v.currentTime-C)/(B-C);c.uniforms[x[y]+"Interpolation"].value=
v}c.uniforms.animalMorphValue.value=d.morph};d.setNewTargetAnimal=function(w,v){if(d.morph===1){for(var x in d.animalA)d.animalA[x]=d.animalB[x];d.animalB.currentTime=v?v:0;u(w,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var u=function(w,v){if(ROME.AnimalAnimationData_old[w]!==undefined){v.frames=ROME.AnimalAnimationData_old[w];v.lengthInFrames=v.frames.length;v.lengthInMS=v.frames[v.lengthInFrames-1].time}else console.log("Error: Couldn't find data for animal "+
w)};return d};
ROME.AnimalShader_old={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0}}]),vertex:["uniform float\tanimalAInterpolation;\nuniform float\tanimalBInterpolation;\nuniform float\tanimalMorphValue;\nvarying vec3 \tvLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,
THREE.ShaderChunk.color_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"vec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragment:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,
THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData_old={animalNames:["sockPuppet_jump","sockPuppet_popUp"],init:function(b,e){var c=[],d,f,h=b.morphTargets,g,n,m,o,t;if(e){m=0;for(o=h.length;m<o;m++){g=0;for(n=this.animalNames.length;g<n;g++){f=this.animalNames[g];if(h[m].name.indexOf(f)!==-1)break}if(g===n){f=h[m].name;for(g=0;n<f.length;g++){d=f.charCodeAt(g);if(!(d>=65&&d<=90||d>=97&&d<=122))break}this.animalNames.push(f.slice(0,g))}}}g=0;for(n=this.animalNames.length;g<n;g++){f=this.animalNames[g];d=this[f];t=0;if(d===
undefined||d.length===0){d=this[f]=[];m=0;for(o=h.length;m<o;m++)if(h[m].name.indexOf(f)!==-1){d.push({index:m,time:t});t+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{m=0;for(o=h.length;m<o;m++)c.indexOf(f)===-1&&h[m].name.indexOf(f)!==-1&&c.push(f)}}return c}};
var Ribbons=function(b,e,c,d){var f=this,h=[],g=[];f.initSettings={numOfRibbons:b||6};f.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var n=0,m;for(m=0;m<f.initSettings.numOfRibbons;++m){var o=new Ribbon(15,6,e.length-20),t=new THREE.Mesh(o,d[m%d.length]);t.doubleSided=!0;c.addObject(t);h.push({r:o,rm:t,offset:3+Math.floor(Math.random()*10)});g.push(t)}this.update=function(u){n+=0.1;for(m=0;m<e.length;++m)for(var w=e[m].position.x,v=e[m].position.y,
x=e[m].position.z,y=0;y<b;++y){var A=h[y].r,B=h[y].offset;if(!(m<B)){var D=Math.cos((m-n*10)/10)*f.settings.ribbonPulseMultiplier_1,C=Math.cos((m-n*10)/8)*f.settings.ribbonPulseMultiplier_2,G=y*(Math.PI*2/h.length),F=Math.cos(G+(m-n*10)/8)*D;D*=Math.sin(G+(m-n*10)/8);for(G=0;G<2;++G){var E=(m-B)*2+G;if(A.vertices[E]!=undefined){var O=m-n*2,L=Math.max(f.settings.ribbonMin,m/(10+C));L=Math.min(L,f.settings.ribbonMax);var H=Math.cos(O/3)*L;O=Math.sin(O/3)*L;A.vertices[E].position.x=w-u.x+H+F;if(G==0){A.vertices[E].position.y=
v+O+D-u.y;A.vertices[E].position.z=x+H+F-u.z}else{A.vertices[E].position.y=v-O+D-u.y;A.vertices[E].position.z=x-H+F-u.z}}}}}for(m=0;m<h.length;++m){w=h[m].rm;w.position=u;A=h[m].r;A.__dirtyVertices=!0;w.visible=f.settings.visible}}},Vectors=function(b,e,c,d){var f=this;f.array=[];var h;f.initSettings={length:b||50};f.settings={divider:e||4,normaldivider:c||10,absoluteTrail:!1,startPosition:d||new THREE.Vector3(0,0,0)};for(h=0;h<f.initSettings.length;++h){b=new THREE.Vector3(0,0,0);b.copy(f.settings.startPosition);
b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};f.array.push(b)}this.update=function(g,n){for(h=0;h<f.initSettings.length;++h){var m=f.array[h];if(h==0)var o=g.x,t=g.y,u=g.z,w=n.x,v=n.y,x=n.z;else{o=f.array[h-1].lastposition.x;t=f.array[h-1].lastposition.y;u=f.array[h-1].lastposition.z;w=f.array[h-1].normal.x;v=f.array[h-1].normal.y;x=f.array[h-1].normal.z}f.array[h].lastposition.x=m.position.x;f.array[h].lastposition.y=m.position.y;f.array[h].lastposition.z=
m.position.z;if(f.settings.absoluteTrail){m.position.x=o;m.position.y=t;m.position.z=u;m.normal.x=w;m.normal.y=v;m.normal.z=x}else{t=(t-m.position.y)/f.settings.divider;u=(u-m.position.z)/f.settings.divider;m.position.x+=(o-m.position.x)/f.settings.divider;m.position.y+=t;m.position.z+=u;o=(v-m.normal.y)/f.settings.normaldivider;x=(x-m.normal.z)/f.settings.normaldivider;m.normal.x+=(w-m.normal.x)/f.settings.normaldivider;m.normal.y+=o;m.normal.z+=x}}};this.reset=function(g,n,m){for(var o=0;o<f.array.length;++o){var t=
f.array[o];t.position.x=g;t.position.y=n;t.position.z=m}}},Particles=function(b,e,c,d,f,h,g){var n=this,m=[];g=g||THREE.NormalBlending;n.initSettings={numOfParticleSystems:b||25,numInSystem:f||60,spread:h||50,particleSize:c||8};n.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var o;c=new THREE.Geometry;for(o=0;o<n.initSettings.numInSystem;o++){f=new THREE.Vector3(Math.random()*n.initSettings.spread-n.initSettings.spread/2,Math.random()*n.initSettings.spread-n.initSettings.spread/
2,Math.random()*n.initSettings.spread-n.initSettings.spread/2);c.vertices.push(new THREE.Vertex(f))}for(o=0;o<n.initSettings.numOfParticleSystems;o++){f=new THREE.ParticleBasicMaterial({size:n.initSettings.particleSize,map:d[o%d.length],transparent:!0,depthTest:!0,blending:g});f=new THREE.ParticleSystem(c,f);f.rotation.x=Math.random()*Math.PI;f.rotation.y=Math.random()*Math.PI;f.rotation.z=Math.random()*Math.PI;m.push({c:f,alivetime:o});e.addObject(f)}this.update=function(t,u,w){if(isNaN(t)||t>1E3)t=
1E3/60;t/=60;for(o=0;o<b;++o){var v=m[o].c;m[o].alivetime+=t/n.settings.aliveDivider;if(m[o].alivetime>=b){m[o].alivetime=0;v.scale.x=v.scale.y=v.scale.z=0.5;v.position.x=u.x;v.position.y=u.y;v.position.z=u.z;if(n.settings.gravitateTowardsCamera){var x=-100;u.x>w.x&&(x=100);m[o].c.tox=u.x-x;m[o].c.toy=0;m[o].c.toz=u.z-100;x=v.position.x-m[o].c.tox;var y=v.position.y-m[o].c.toy,A=v.position.z-m[o].c.toz;x=1E3+Math.abs(x*x+y*y+A*A)/25;v.position.y=u.y+50;v.rotation.x=Math.random()*Math.PI+Math.PI/2;
v.rotation.y=Math.random()*Math.PI;v.rotation.z=Math.random()*Math.PI+Math.PI/2;v.scale.x=v.scale.y=v.scale.z=1.25;(new TWEEN.Tween(v.position)).to({x:m[o].c.tox,y:m[o].c.toy,z:m[o].c.toz},x).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(v.rotation)).to({x:0,z:0},x).easing(TWEEN.Easing.Quadratic.EaseIn).start();(new TWEEN.Tween(v.scale)).to({x:5,y:0.05,z:5},x).easing(TWEEN.Easing.Linear.EaseNone).start()}v.materials[0].opacity=n.settings.zeroAlphaStart?0:1}else{x=m[o].alivetime;if(!n.settings.gravitateTowardsCamera){v.position.y+=
0.1;v.rotation.y+=0.015;v.rotation.z+=0.01;v.scale.x=v.scale.y=v.scale.z=0.5+Math.max(x/15,1)}x=n.settings.zeroAlphaStart?x/4:1-x/(m.length*2);x=Math.min(x,1);v.materials[0].opacity=x}}};this.reset=function(t,u,w){for(var v=0;v<m.length;++v){var x=m[v].c;x.position.x=t;x.position.y=u;x.position.z=w}}},AnimalSwarm=function(b,e,c){var d=this;d.array=[];new THREE.Vector3;var f=0;d.initSettings={numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,
constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1,respawn:!0,gravity:!1};var h=0,g;this.addAnimal=function(n,m,o,t,u,w){m=m||null;var v=o||1.2;t=t||null;for(g=0;g<d.initSettings.numOfAnimals;++g)if(!(m==null&&d.array[g]!=undefined||m!=d.array[g])){u==null&&(u=[1]);var x=w?ROME.Animal_old(n,!1):ROME.Animal(n,!1),y=x.mesh;y.position.copy(d.settings.startPosition);o=0.02+Math.random()/8;g<2&&(o=0.15);o=Math.max(o,0.1);y.matrixAutoUpdate=
!1;y.visible=!1;e.addChild(y);var A=0,B=0;if(t!=null){A=t[g%t.length]%x.availableAnimals.length;B=A+1;if(Math.round(Math.random())==1&&A>0||B>x.availableAnimals.length-1)B=A-1}var D=u[A],C=u[B];x.play(x.availableAnimals[A],x.availableAnimals[B],0,Math.random(),Math.random());var G=Math.random();g<2&&(G=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);o={c:y,a:x,f:g,keepRunning:!1,time:0,lifetime:0,dead:!1,startMorph:A,endMorph:B,speeda:D,speedb:C,toPosition:new THREE.Vector3(0,0,0),active:!1,
normal:new THREE.Vector3(0,1,0),count:G,scale:o*v,origscale:o*v,ray:ray,rayIndex:g%4,lastToy:0,sockPuppetSpecialCase:w,generalSpecialCase:!1};d.array[g]=o}return x};this.removeAnimal=function(n,m){for(g=0;g<d.initSettings.numOfAnimals;++g){var o=d.array[g].a;if(o!=undefined){var t=d.array[g].startMorph,u=d.array[g].endMorph;if(o.mesh.geometry==n&&(m==t||m==u)){e.removeChild(d.array[g].c);delete d.array[g].a;d.array[g].active=!1;break}}}};this.switchAnimal=function(n,m,o,t,u){var w=m||1.2;for(g=0;g<
d.initSettings.numOfAnimals;++g){u!=undefined&&(g=u);m=d.array[g].a;var v=d.array[g].startMorph,x=d.array[g].endMorph;if(!(m!=undefined&&m.mesh.geometry==n&&u==undefined&&(v==t||x==t))){console.log("adding on "+g);u=d.array[g].c.position;n=ROME.Animal(n,!1);v=n.mesh;m=0.02+Math.random()/8;g<2&&(m=0.15);m=Math.max(m,0.1);v.position=u;v.visible=!1;v.scale.set(1.0E-5,1.0E-5,1.0E-5);v.updateMatrix();v.matrixAutoUpdate=!1;e.removeChild(d.array[g].c);e.addChild(v);n.play(n.availableAnimals[t],n.availableAnimals[t],
0,Math.random(),Math.random());d.array[g].c=v;d.array[g].a=n;d.array[g].scale=m*w;d.array[g].origscale=m*w;d.array[g].speeda=o;d.array[g].speedb=o;d.array[g].active=!1;d.array[g].startMorph=t;d.array[g].endMorph=t;break}}};this.create=function(n,m,o){for(g=0;g<d.initSettings.numOfAnimals;++g)if(!(d.array[g].active||d.array[g].a==undefined)){d.array[g].active=!0;d.array[g].c.position.copy(n);d.array[g].normal.copy(m);d.array[g].c.visible=!0;d.array[g].f=0;d.array[g].time=0;d.array[g].lifetime=0;d.array[g].dead=
!1;d.array[g].scale=d.array[g].origscale;d.array[g].keepRunning=!1;d.array[g].gravity=0;if(d.settings.gravity){d.array[g].c.matrixAutoUpdate=!0;d.array[g].c.scale.set(d.array[g].scale,d.array[g].scale,d.array[g].scale);d.array[g].c.rotation.x=0;d.array[g].c.rotation.y=Math.random()*Math.PI}if(!d.settings.respawn)d.array[g].f=g;if(o!=undefined){var t=new THREE.Vector3,u=new THREE.Vector3;t.copy(n);u.copy(o);d.array[g].keepRunning=!0;d.array[g].toPosition=u.subSelf(t).normalize();d.array[g].toPosition.x<
0&&(d.array[g].toPosition.x*=-1);d.array[g].toPosition.x<0.5&&(d.array[g].toPosition.x+=0.5);d.array[g].toPosition.z<0&&(d.array[g].toPosition.z+=0.5)}if(o==undefined){d.array[g].scale*=0.25;(new TWEEN.Tween(d.array[g])).to({scale:d.array[g].origscale},2E3).easing(TWEEN.Easing.Elastic.EaseOut).delay(200).start()}n=d.array[g].scale;d.array[g].c.position.x-=m.x*n*300;d.array[g].c.position.y-=m.y*n*300;d.array[g].c.position.z-=m.z*n*300;d.array[g].lastToy=d.array[g].c.position.y;break}};this.update=
function(n){if(isNaN(n)||n>1E3||n==0)n=1E3/60;++f;for(g=0;g<d.initSettings.numOfAnimals;++g){var m=d.array[g];if(m.active){var o=m.c,t=m.scale,u=m.normal,w=m.f,v=d.array[g].dead;d.array[g].time+=n;d.array[g].lifetime+=n;if(d.array[g].lifetime>2500&&d.settings.respawn)d.array[g].dead=!0;d.array[g].count+=0.03;var x=Math.max(Math.cos(d.array[g].count),0);x=Math.min(x,1);d.array[g].a.morph=x;var y=m.speeda;if(Math.round(x)==1)y=m.speedb;if(d.array[g].keepRunning){x=o.position.x+d.array[g].toPosition.x*
100;A=o.position.y+d.array[g].toPosition.y*100;B=o.position.z+d.array[g].toPosition.z*100}else{if(d.array[g].time>Math.max(y*20,40)&&d.settings.respawn){++d.array[g].f;if(d.array[g].f>=40){d.array[g].f=40;d.array[g].dead=!0}w=d.array[g].f;d.array[g].time=0}u=g*(Math.PI*2/6);x=Math.cos(u+(g-h*2)/8)*d.settings.xPositionMultiplier;A=B=Math.sin(u+(g-h*2)/8)*d.settings.zPositionMultiplier;u=c[w].normal;x=c[w].position.x+x*(1-Math.abs(u.x));var A=c[w].position.y+A*(1-Math.abs(u.y)),B=c[w].position.z+B*
(1-Math.abs(u.z))}d.array[g].keepRunning||u.y>0.5&&(A=c[w].position.y-10);if(d.settings.capy!=null&&A<d.settings.capy)A=d.settings.capy;if(d.settings.flying)if(d.array[g].keepRunning){d.array[g].toPosition.y+=0.12;A=d.array[g].toPosition.y+d.settings.flyingDistance}else{var D=d.settings.flyingDistance;u.x<-0.8&&(x-=D);u.x>0.8&&(x+=D);if(u.y<-0.8||u.y>0.8)A+=D;u.z<-0.8&&(B-=D);u.z>0.8&&(B+=D)}if(d.settings.constantSpeed!=null){d.array[g].a.animalA.timeScale=d.settings.constantSpeed;d.array[g].a.animalB.timeScale=
d.settings.constantSpeed}if(d.settings.shootRayDown)if(d.array[g].rayIndex==f%4){m=m.ray;m.origin.copy(o.position);m.origin.y+=500;if(D=e.collisions.rayCastNearest(m)){A=m.origin.y-(D.distance*1+3);u=D.mesh.matrixRotationWorld.multiplyVector3(D.normal).normalize();d.array[g].lastToy=A;d.array[g].normal.copy(u)}}else A=d.array[g].lastToy;if(d.settings.gravity){d.array[g].gravity+=0.3;A=o.position.y-=d.array[g].gravity;B=o.position.z;x=o.position.x;o.rotation.x+=0.04;o.rotation.y+=0.02}D=m=17;if(d.array[g].keepRunning){m=
4;D=Math.abs(A-o.position.y)>10?m/2:m*2}d.settings.flying&&(D=8);d.array[g].sockPuppetSpecialCase&&(m=100);if(d.array[g].dead&&!d.array[g].generalSpecialCase){A-=u.y*13;x-=u.x*13;B-=u.z*13;d.settings.flying&&(A+=10);D=20}if(d.array[g].isFish){h+=0.06;A=o.position.y*Math.sin(h)*50}x=(x-o.position.x)/m;A=(A-o.position.y)/D;B=(B-o.position.z)/m;if(d.array[g].dead&&!v){(new TWEEN.Tween(d.array[g])).to({scale:d.array[g].scale*0.0010},1E3).easing(TWEEN.Easing.Quartic.EaseIn).start();d.array[g].startMorph==
1&&d.array[g].a.morph==0&&(new TWEEN.Tween(d.array[g].a)).to({morph:1},500).easing(TWEEN.Easing.Quartic.EaseIn).start()}v=0.1;d.array[g].keepRunning&&(v=0.01);if(d.array[g].dead&&t<=v){d.array[g].active=!1;d.array[g].c.visible=!1}else{w=d.array[g].keepRunning?y/32:y/(2+w/10);isNaN(w)&&(w=1);if(!d.array[g].keepRunning){A>w&&(A=w);A<-w&&(A=-w)}x>w&&(x=w);x<-w&&(x=-w);B>w&&(B=w);B<-w&&(B=-w);if(!d.settings.gravity){w=new THREE.Vector3(o.position.x+x,o.position.y+A,o.position.z+B);w.subSelf(o.position).normalize();
y=new THREE.Vector3;u=new THREE.Vector3(u.x*-1,u.y*-1,u.z*-1);if(d.settings.flying||d.settings.gravity)u=new THREE.Vector3(0,-1,0);y.cross(w,u);u.cross(w,y);o.matrixWorld.n11=y.x*t;o.matrixWorld.n12=u.x*t;o.matrixWorld.n13=w.x*t;o.matrixWorld.n14=o.position.x;o.matrixWorld.n21=y.y*t;o.matrixWorld.n22=u.y*t;o.matrixWorld.n23=w.y*t;o.matrixWorld.n24=o.position.y;o.matrixWorld.n31=y.z*t;o.matrixWorld.n32=u.z*t;o.matrixWorld.n33=w.z*t;o.matrixWorld.n34=o.position.z}o.position.x+=x;o.position.y+=A;o.position.z+=
B}}}};this.reset=function(n,m,o){for(var t=0;t<d.initSettings.numOfAnimals;++t){var u=d.array[t].c;u.position.x=n;u.position.y=m;u.position.z=o;d.array[t].active=!1}}},AnimalInFrontOfCamera=function(b,e){var c=this,d=[];c.initSettings={numOfAnimals:b||30};c.settings={};var f=0,h,g=new THREE.Cube(10,10,10),n=new THREE.Mesh(g);e.addChild(n);this.addAnimal=function(m){for(var o=0;o<c.initSettings.numOfAnimals;++o){var t=ROME.Animal(m,!1),u=t.mesh,w=0.02+Math.random()/8,v=Math.random()*120-60,x=o*10-
10,y=Math.random()*120-60;u.position.x=v;u.position.y=x;u.position.z=y;n.addChild(u);t.animalA.timeScale=0.8;t.animalB.timeScale=0.8;t.play(t.availableAnimals[0],t.availableAnimals[0],0,Math.random());d.push({c:u,x:v,y:x,z:y,a:t,scale:w*1.5})}};this.update=function(m,o,t,u){f+=0.1;n.position=m;if(!u){n.position.x-=Math.cos(o)*110;n.position.z-=Math.sin(o)*110}if(isNaN(t)||t>1E3)t=1E3/60;for(h=0;h<c.initSettings.numOfAnimals;++h){var w=d[h];m=w.c;o=w.x;u=w.y;w=w.z;var v=Math.sin(h-f);o+=Math.cos(h-
f);u+=0.5*(t/20);w+=v;u>140&&(u=-10);m.lookAt(new THREE.Vector3(o,u,w));m.position.x=o;m.position.y=u;m.position.z=w;d[h].x=o;d[h].y=u;d[h].z=w}}},Trail=function(b,e){var c=this;c.array=[];c.initSettings={numOfInstances:b||100};c.settings={spread:70,visible:!0,aliveDivider:c.initSettings.numOfInstances,tweenTime:2500,scale:1,offsetAmount:6,freeRotation:!0};var d;this.addInstance=function(f,h,g,n,m){h=h||null;g=g||!1;n=n||!1;for(d=0;d<c.initSettings.numOfInstances;++d)if(!(h==null&&c.array[d]!=undefined||
h!=c.array[d])){var o=m==undefined?new THREE.Mesh(f,new THREE.MeshFaceMaterial):new THREE.Mesh(f,m[d%m.length]);o.scale.x=o.scale.y=o.scale.z=1.0E-8;var t={c:o,alivetime:d,normal:new THREE.Vector3,tree:g,lightHouse:n};e.addObject(o);c.array[d]=t}return o};this.update=function(f,h,g,n){if(isNaN(n)||n>1E3)n=1E3/60;n/=c.settings.aliveDivider;for(d=0;d<c.array.length;++d){var m=c.array[d],o=m.c,t=m.alivetime,u=m.tree;m=m.lightHouse;t+=n;if(t>c.initSettings.numOfInstances){o.position.x=f.x;o.position.y=
f.y;o.position.z=f.z;o.rotation.x=0;o.rotation.z=0;o.rotation.y=0;t=c.settings.offsetAmount;u&&(t=c.settings.offsetAmount+2);var w=0,v=0,x=0;if(c.settings.freeRotation){o.position.x=f.x-h.x*t;o.position.y=f.y-h.y*t;o.position.z=f.z-h.z*t;o.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(h.x));o.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(h.z));o.rotation.x=0;o.rotation.z=0;o.rotation.y=Math.random()*Math.PI;o.up.copy(h);o.lookAt(o.position)}else{if(h.x<
-0.5){o.position.x=f.x+t/2;o.rotation.z=1.57;o.rotation.x=Math.random()*Math.PI;if(u){x=o.rotation.z+(Math.random()-0.5);o.rotation.z=0;w=o.rotation.x;v=o.rotation.y}o.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;o.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.x>0.5){o.position.x=f.x-t/2;o.rotation.z=-1.57;if(u){x=o.rotation.z+(Math.random()-0.5);o.rotation.z=0;w=o.rotation.x;v=o.rotation.y}o.rotation.x=Math.random()*Math.PI;o.position.y+=Math.random()*c.settings.spread-
c.settings.spread/2;o.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.y<-0.9){o.position.y=f.y+t;o.rotation.y=Math.random()*Math.PI;if(u){x=o.rotation.z+(Math.random()-0.5);o.rotation.z=1.57;w=o.rotation.x;v=o.rotation.y}o.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;o.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.y>0.9){o.position.y=f.y-t;o.rotation.y=Math.random()*Math.PI;if(u){x+=o.rotation.z+(Math.random()-0.5);o.rotation.z=1.57;w=
o.rotation.x;v=o.rotation.y}o.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;o.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.z<-0.5){o.position.z=f.z+t/2;o.rotation.x=-1.57;o.rotation.y=Math.random()*Math.PI;if(u){w=o.rotation.x+(Math.random()-0.5);o.rotation.x=0;x=o.rotation.z;v=o.rotation.y}o.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;o.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.z>0.5){o.position.z=f.z-t/2;o.rotation.x=
1.57;o.rotation.y=Math.random()*Math.PI;if(u){w=o.rotation.x+(Math.random()-0.5);o.rotation.x=0;x=o.rotation.z;v=o.rotation.y}o.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;o.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}}u&&(new TWEEN.Tween(o.rotation)).to({x:w,y:v,z:x},c.settings.tweenTime*2).easing(TWEEN.Easing.Elastic.EaseOut).start();if(u&&o.position.x<g.x+60&&o.position.x>g.x-60){o.position.x=g.x+60;if(o.position.x<g.x)o.position.x=g.x-60}o.scale.x=o.scale.y=
o.scale.z=0.0010*c.settings.scale;t=zscale=yscale=0.1*c.settings.scale;if(m){t=zscale=yscale=0.4*c.settings.scale;if(Math.abs(h.y)<0.9)continue;o.visible=!1}if(!u&&!m){yscale=0.12*c.settings.scale;t=zscale=0.4*c.settings.scale}w=TWEEN.Easing.Quintic.EaseOut;if(u||m)w=TWEEN.Easing.Elastic.EaseOut;(new TWEEN.Tween(o.scale)).to({x:t,y:yscale,z:zscale},c.settings.tweenTime).easing(w).start();t=0}c.array[d].alivetime=t}}},CollisionScene=function(b,e,c,d,f,h){function g(F,E,O,L,H,N,ea,p,ha){F=new THREE.Mesh(F,
ha);F.scale.set(E,E,E);F.position.set(O,L,H);F.rotation.set(N,ea,p);F.updateMatrix();n.settings.useOldRay?x.addObject(F):e.addObject(F);return F}var n=this;n.currentNormal=new THREE.Vector3(0,1,0);n.emitterNormal=new THREE.Vector3(0,1,0);n.distance=0;n.initSettings={};n.settings={useOldRay:h||!1,maxSpeedDivider:2,emitterDivider:5,cameraTargetDivider:10,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:f||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,minDistance:10,
camera:b};var m=new THREE.Vector3(0,0,1),o=new THREE.Ray,t=new THREE.Matrix4,u=new THREE.Matrix4,w=new THREE.Vector3,v=new THREE.Projector,x=new THREE.Scene;b=new THREE.Cube(5,5,5);n.emitter=g(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));n.emitterFollow=g(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,opacity:0.4}));if(n.settings.useOldRay)n.cameraTarget=g(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407667,
opacity:0.4}));n.emitter.visible=!1;n.emitterFollow.visible=!1;b=new THREE.Cube(5E4,5E4,10,1,1,1);c=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var y=new THREE.Mesh(b,c),A=new THREE.Mesh(b,c);b=new THREE.Cube(10,5E4,5E4,1,1,1);var B=new THREE.Mesh(b,c),D=new THREE.Mesh(b,c);b=new THREE.Cube(5E4,10,5E4,1,1,1);var C=new THREE.Mesh(b,c),G=new THREE.Mesh(b,c);if(n.settings.useOldRay){x.addObject(y);x.addObject(A);x.addObject(B);x.addObject(D);x.addObject(C);x.addObject(G)}else{e.addObject(y);
e.addObject(A);e.addObject(B);e.addObject(D);e.addObject(C);e.addObject(G);y.visible=!1;A.visible=!1;B.visible=!1;D.visible=!1;C.visible=!1;G.visible=!1}this.addLoaded=function(F,E,O,L){var H=new THREE.MeshLambertMaterial({color:16711680,opacity:0.5});F=new THREE.Mesh(F,H);F.scale.x=F.scale.y=F.scale.z=E;F.rotation=O||new THREE.Vector3;F.position=L||new THREE.Vector3;x.addObject(F)};this.update=function(F,E){D.position.x=F.x+n.settings.collisionDistance;B.position.x=F.x-n.settings.collisionDistance;
D.position.z=F.z;D.position.y=F.y;B.position.z=F.z;B.position.y=F.y;y.position.z=F.z-n.settings.collisionDistance;A.position.z=F.z+n.settings.collisionDistance;y.position.x=F.x;y.position.y=F.y;A.position.x=F.x;A.position.y=F.y;G.position.y=F.y-n.settings.collisionDistance;C.position.y=F.y+n.settings.collisionDistance;G.position.x=F.x;G.position.z=F.z;C.position.x=F.x;C.position.z=F.z;if(n.settings.capBottom!=null&&G.position.y<n.settings.capBottom)G.position.y=n.settings.capBottom;if(n.settings.capTop!=
null&&C.position.y<n.settings.capTop)C.position.y=n.settings.capTop;if(n.settings.useOldRay){var O=new THREE.Vector3(d.mouse.x/d.screenWidth*2-1,-(d.mouse.y/d.screenHeight)*2+1,0.5);v.unprojectVector(O,n.settings.camera);var L=new THREE.Ray(F,O.subSelf(F).normalize()),H=L.intersectScene(x);if(H.length>0)for(var N=0;N<H.length;++N)if((O.z<0?H[N].point.z<F.z:H[N].point.z>F.z)&&H[N].object!=n.emitter&&H[N].object!=n.emitterFollow){n.emitter.position=H[N].point;L=Math.atan2(F.z-n.emitter.position.z,F.x-
n.emitter.position.x);n.emitter.position.x-=Math.cos(L)*n.settings.minDistance/10;n.emitter.position.z-=Math.sin(L)*n.settings.minDistance;if(n.emitter.position.z>F.z-20)n.emitter.position.z=F.z-20;L=H[N].object.matrixRotationWorld.multiplyVector3(H[N].face.normal.clone());n.emitterNormal=L;if(H[N].object==D||H[N].object==y||H[N].object==A||H[N].object==B||H[N].object==C){n.emitterNormal.x=0;n.emitterNormal.y=1;n.emitterNormal.z=0;if(!n.settings.allowFlying)n.emitter.position.y=G.position.y+5}break}}else{m.x=
d.mouse.x/d.screenWidth*2-1;m.y=-(d.mouse.y/d.screenHeight)*2+1;m.z=1;o.origin.copy(m);t.copy(n.settings.camera.matrixWorld);t.multiplySelf(THREE.Matrix4.makeInvert(n.settings.camera.projectionMatrix,u));t.multiplyVector3(o.origin);o.direction.copy(o.origin);o.direction.subSelf(F);if((H=e.collisions.rayCastNearest(o))&&H.distance>n.settings.minDistance){N=H.distance*n.settings.scale;if(N>n.settings.collisionDistance)N=n.settings.collisionDistance}else{H={mesh:D};N=n.settings.collisionDistance}n.distance=
N;w.copy(o.origin);w.addSelf(o.direction.multiplyScalar(N));n.emitter.position=w;if(H.normal!=undefined){L=H.mesh.matrixRotationWorld.multiplyVector3(H.normal).normalize();n.currentNormal=L;n.emitterNormal=L}if(H.mesh==D||H.mesh==y||H.mesh==A||H.mesh==B||H.mesh==C||H.mesh==G){n.currentNormal.set(0,1,0);if(!n.settings.allowFlying&&!n.settings.shootRayDown)n.emitter.position.y=G.position.y;if(n.settings.shootRayDown){o.origin.copy(n.emitter.position);o.direction.set(0,-1,0);if((H=e.collisions.rayCastNearest(o))&&
H.distance!==-1){n.emitter.position.y-=H.distance*n.settings.scale;L=H.mesh.matrixRotationWorld.multiplyVector3(H.normal).normalize();n.currentNormal=L}else{n.emitter.position.y=-n.settings.collisionDistance;n.currentNormal.set(0,1,0)}}}n.emitter.position.x+=n.currentNormal.x*n.settings.normalOffsetAmount;n.emitter.position.y+=n.currentNormal.y*n.settings.normalOffsetAmount;n.emitter.position.z+=n.currentNormal.z*n.settings.normalOffsetAmount}if(isNaN(E)||E>1E3||E==0)E=1E3/60;H=E/n.settings.maxSpeedDivider;
N=n.emitter.position.x;N=(N-n.emitterFollow.position.x)/n.settings.emitterDivider;L=n.emitter.position.y;L=(L-n.emitterFollow.position.y)/n.settings.emitterDivider;O=n.emitter.position.z;O=(O-n.emitterFollow.position.z)/n.settings.emitterDivider;L>H&&(L=H);L<-H&&(L=-H);N>H&&(N=H);N<-H&&(N=-H);O>H&&(O=H);O<-H&&(O=-H);n.emitterFollow.position.x+=N;n.emitterFollow.position.y+=L;n.emitterFollow.position.z+=O;if(n.settings.keepEmitterFollowDown&&!n.settings.useOldRay){n.emitterFollow.position.y=n.emitter.position.y+
n.settings.collisionDistance;o.origin.copy(n.emitterFollow.position);o.direction.set(0,-1,0);if(H=e.collisions.rayCastNearest(o)){n.emitterFollow.position.y-=H.distance*n.settings.scale-n.settings.normalOffsetAmount;L=H.mesh.matrixRotationWorld.multiplyVector3(H.normal).normalize();n.currentNormal=L}}if(n.settings.useOldRay){O=new THREE.Vector3;L=new THREE.Ray(n.emitterFollow.position,O);var ea=1E4,p=n.emitterFollow.position,ha,fa;O.set(-1,0,0);L.direction=O;H=L.intersectScene(x);if(H.length>0)for(N=
0;N<H.length;++N)if(H[N].object!=n.emitter&&H[N].object!=B&&H[N].object!=D){if(H[N].distance<ea){ea=H[N].distance;p=H[N].point;fa=H[N].face;ha=H[N].object}break}O.set(1,0,0);L.direction=O;H=L.intersectScene(x);if(H.length>0)for(N=0;N<H.length;++N)if(H[N].object!=n.emitter&&H[N].object!=B&&H[N].object!=D){if(H[N].distance<ea){ea=H[N].distance;p=H[N].point;fa=H[N].face;ha=H[N].object}break}O.set(0,-1,0);L.direction=O;H=L.intersectScene(x);if(H.length>0)for(N=0;N<H.length;++N)if(H[N].object!=n.emitter&&
H[N].object!=C){if(H[N].distance<ea){p=H[N].point;fa=H[N].face;ha=H[N].object}break}n.emitterFollow.position=p;if(ha!=undefined){L=ha.matrixRotationWorld.multiplyVector3(fa.normal.clone());n.currentNormal=L}L=n.emitterFollow.position.y;L=(L-n.cameraTarget.position.y)/n.settings.cameraTargetDivider;N=n.emitterFollow.position.x;N=(N-n.cameraTarget.position.x)/n.settings.cameraTargetDivider;O=n.emitterFollow.position.z;O=(O-n.cameraTarget.position.z)/n.settings.cameraTargetDivider;H=8;L>4&&(L=4);L<-4&&
(L=-4);N>H&&(N=H);N<-H&&(N=-H);O>H&&(O=H);O<-H&&(O=-H);n.cameraTarget.position.x+=N;n.cameraTarget.position.y+=L;n.cameraTarget.position.z+=O;if(n.cameraTarget.position.z>F.z-80)n.cameraTarget.position.z=F.z-80;d.renderer.render(x,n.settings.camera);d.renderer.clear()}};this.reset=function(F,E,O){n.emitter.position.set(F,E,O);n.emitterFollow.position.set(F,E,O);n.settings.useOldRay&&n.cameraTarget.position.set(F,E,O)}};
ROME.TrailShaderUtils=function(){var b={},e,c,d,f,h,g=-9999999,n=-9999999,m=9999999,o=9999999,t,u;b.setMaterials=function(w,v,x,y){d=v;c=x;h=y;f=h.getContext();e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);f.texImage2D(f.TEXTURE_2D,0,f.RGB,d,d,0,f.RGB,f.UNSIGNED_BYTE,null);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,
f.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=e;var A,B,D,C,G,F;v=0;for(x=w.length;v<x;v++){A=w[v];y=A.position.x;B=A.position.y;F=A.geometry.vertices;C=0;for(G=F.length;C<G;C++){D=F[C].position;A=D.x+y;D=D.y+B;g=Math.max(g,A);n=Math.max(n,D);m=Math.min(m,A);o=Math.min(o,D)}}t=g-m;u=n-o;var E,O;for(v=0;v<x;v++){A=w[v];y=A.position.x;B=A.position.y;F=A.geometry.vertices;E=ROME.TrailShader.attributes();
O=E.trailUV.value;C=0;for(G=F.length;C<G;C++){D=F[C].position;O.push(new THREE.Vector2((D.x+y-m)/t,(D.y+B-o)/u))}y=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:E,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});y.fog=!0;y.lights=!0;y.vertexColors=2;y.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;y.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;y.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
y.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;y.uniforms.lavaMap.texture.wrapS=y.uniforms.lavaMap.texture.wrapT=THREE.Repeat;y.uniforms.lavaNoiseMap.texture.wrapS=y.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;A.materials[0]=y}};b.updateLava=function(w,v,x){w=w!==undefined?w:1;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(v!==undefined?v:0,0,x!=undefined?x:0);ROME.TrailShader.uniforms.lavaTime.value+=w};b.setMarkAtWorldPosition=function(w,v){if(d){var x=(w-m)/t*
d,y=(v-o)/u*d;if(x>=0&&x<d-c.image.width&&y>=0&&y<d-c.image.height){f.bindTexture(f.TEXTURE_2D,e);f.texSubImage2D(f.TEXTURE_2D,0,x,y,f.RGB,f.UNSIGNED_BYTE,c.image)}}};return b}();
ROME.TrailShader={textures:{trailMap:undefined,faceMap:THREE.ImageUtils.loadTexture("files/textures/PaintDubs.jpg"),lavaMap:THREE.ImageUtils.loadTexture("files/textures/lava.jpg"),lavaNoiseMap:THREE.ImageUtils.loadTexture("files/textures/Color_noise.jpg")},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,
0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",
value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue, f;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0)).rg;\nf = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nmixValue = f + max(1.0 - length(vec2(0.030) * vec2(vPos.xy - lavaHeadPosition.xz) + lookup * vec2(0.4)), 0.0);\nif(mixValue > 0.5)\n{\nmixValue = abs((texture2D(lavaNoiseMap, vTrailUV.yx * vec2(40.0, -40.0)).r - 0.5));\nmixValue = max(max(1.0 - mixValue * 32.0, 0.0) * (lookup.r - 0.5) * 8.0, 0.0);\ngl_FragColor = vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0) - vec2( lavaTime * 2.5)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) - vec2( lavaTime * 2.5)).rrrr * vec4(2.0);\n}/* else {\n}*/\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,e){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var d;this.addAnimal=function(f,h,g,n,m){h=h||null;var o=g||1.2;n=n||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(h==null&&c.array[d]!=undefined||h!=c.array[d])){m==null&&(m=[1]);var t=ROME.Animal(f,!1),u=t.mesh;g=0.02+Math.random()/8;g=Math.max(g,0.1);u.matrixAutoUpdate=!1;u.visible=!1;e.addChild(u);var w=0,v=0;if(n!=null){w=n[d%n.length]%
t.availableAnimals.length;v=w+1;if(Math.round(Math.random())==1&&w>0||v>t.availableAnimals.length-1)v=w-1}var x=m[w],y=m[v];t.play(t.availableAnimals[w],t.availableAnimals[v],0,Math.random(),Math.random());v=Math.random();d<2&&(v=0);g={c:u,a:t,active:!1,startMorph:w,lifetime:0,speeda:x,speedb:y,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:v,scale:g*o,origscale:g*o};c.array[d]=g}};this.create=function(f,h,g){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=
!0;c.array[d].position.copy(f);c.array[d].normal.copy(h);c.array[d].c.position.copy(f);c.array[d].c.visible=!0;c.array[d].toVector=g.subSelf(f).normalize();c.array[d].lifetime=0;c.array[d].toVector.x*=1-Math.abs(h.x);c.array[d].toVector.y*=1-Math.abs(h.y);c.array[d].toVector.z*=1-Math.abs(h.z);c.array[d].toVector.z=Math.random();c.array[d].toVector.x=Math.random()-0.5;c.array[d].scale=0.01;(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();
f=c.array[d].scale;c.array[d].c.position.x-=h.x*f*150;c.array[d].c.position.y-=h.y*f*150;c.array[d].c.position.z-=h.z*f*150;break}};this.update=function(f){if(isNaN(f)||f>1E3||f==0)f=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var h=c.array[d];if(h.active){var g=h.c,n=h.scale,m=h.normal,o=h.position,t=h.toVector;c.array[d].lifetime+=f;if(c.array[d].lifetime>4E3){c.array[d].active=!1;c.array[d].c.visible=!1}else{var u=o.x+t.x*10,w=o.y+t.y*10,v=o.z+t.z*10;m.y>0.5&&(w-=10);if(c.settings.capy!=
null&&w<c.settings.capy){w=c.settings.capy;m.set(0,1,0)}c.array[d].count+=0.03;o=Math.max(Math.cos(c.array[d].count),0);o=Math.min(o,1);c.array[d].a.morph=o;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}var x=h.speeda;if(Math.round(o)==1)x=h.speedb;h=(u-g.position.x)/5;o=(w-g.position.y)/5;t=(v-g.position.z)/5;o>x&&(o=x);o<-x&&(o=-x);h>x&&(h=x);h<-x&&(h=-x);t>x&&(t=x);t<-x&&(t=-x);u=new THREE.Vector3(u,
w,v);u.subSelf(g.position).normalize();w=new THREE.Vector3;m=new THREE.Vector3(m.x*-1,m.y*-1,m.z*-1);w.cross(u,m);m.cross(u,w);g.matrixWorld.n11=w.x*n;g.matrixWorld.n12=m.x*n;g.matrixWorld.n13=u.x*n;g.matrixWorld.n14=g.position.x;g.matrixWorld.n21=w.y*n;g.matrixWorld.n22=m.y*n;g.matrixWorld.n23=u.y*n;g.matrixWorld.n24=g.position.y;g.matrixWorld.n31=w.z*n;g.matrixWorld.n32=m.z*n;g.matrixWorld.n33=u.z*n;g.matrixWorld.n34=g.position.z;g.position.x+=h;g.position.y+=o;g.position.z+=t;c.array[d].position.copy(g.position)}}}};
this.reset=function(f,h,g){for(var n=0;n<c.array.length;++n){var m=c.array[n].c;m.position.x=f;m.position.y=h;m.position.z=g;c.array[n].active=!1;c.array[n].c.visible=!1}}},VideoPlane=function(b,e,c){var d,f,h,g,n,m=!1,o=!1,t=e.path.match("png$")||e.path.match("jpg$"),u=e.bendForce||400,w=new PolyTrail(-b.mouse.x*c.aspect,-b.mouse.y),v=e.fps||20;this.locked=e.locked;this.path=e.path;this.removed=!1;this.removeAt=e.removeAt||1;if(t)f=THREE.ImageUtils.loadTexture(e.path);else{VideoLoadRegister[e.path]=
1;d=document.createElement("video");d.src=e.path;d.preload=!0;d.load();b.signals.loadItemAdded.dispatch();d.addEventListener("canplaythrough",function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},!1);setTimeout(function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},1E4);f=new THREE.Texture(d);f.minFilter=THREE.LinearFilter;f.magFilter=THREE.LinearFilter}switch(e.shaderId){case VIDEO_OPAQUE:g=
VideoShaderSource.opaque;break;case VIDEO_OPAQUE_DISTORT:g=VideoShaderSource.distortOpaque;m=!0;break;case VIDEO_KEYED_DISTORT:g=VideoShaderSource.distortKeyed;m=!0;o=!0;break;case VIDEO_HALFALPHA:g=VideoShaderSource.halfAlpha;break;case VIDEO_SMARTALPHA:g=VideoShaderSource.smartAlpha;break;case VIDEO_SMARTALPHA_DISTORT:g=VideoShaderSource.distortSmartalpha;m=!0;break;case VIDEO_KEYED_INVERSE:g=VideoShaderSource.keyedInverse;o=!0;break;default:g=VideoShaderSource.keyed;o=!0}var x=THREE.UniformsUtils.clone(g.uniforms);
x.map.texture=f;if(m){x.mouseXY.value=new THREE.Vector2(0,0);x.aspect.value=c.aspect;x.mouseSpeed.value=0;x.mouseRad.value=1}if(o){x.colorScale.value=e.colorScale;x.threshold.value=e.threshold;x.alphaFadeout.value=e.alphaFadeout}n=new THREE.MeshShaderMaterial({uniforms:x,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,depthTest:!1});if(!e.width)e.width=m?1.104:1;if(!e.height)e.height=m?1.24:1;g=m?c.grid:e.paralax?new THREE.Plane(1,1,50,10):new THREE.Plane(1,1,1,1);if(e.paralax)for(var y=
0;y<g.vertices.length;++y){o=Math.sin((g.vertices[y].position.x+0.5)*Math.PI);g.vertices[y].position.z=(1-o)*u*e.width;g.vertices[y].position.y*=1+(1-o)*0.35*e.height}this.mesh=new THREE.Mesh(g,n);this.mesh.scale.x=e.width;this.mesh.scale.y=e.height;this.mesh.position.z=e.z;this.mesh.position.y=e.y||0;this.mesh.scale.x*=Math.abs(e.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(e.z)*c.adj;this.start=function(A){if(!t){try{d.currentTime=d.duration*A}catch(B){console.log(B);d.currentTime=0}d.play();f.needsUpdate=
!0;h=setInterval(function(){if(d.readyState===d.HAVE_ENOUGH_DATA)f.needsUpdate=!0},1E3/v)}};this.stop=function(){if(!t){d.pause();d.currentTime=0;clearInterval(h)}};this.update=function(A,B,D,C){if(m){w.target.x=-A*c.aspect;w.target.y=-B;w.update();for(y=0;y<=4;y++)n.uniforms["trail"+y].value=w.s[y*4];n.uniforms.mouseXY.value.x=-A*c.aspect;n.uniforms.mouseXY.value.y=-B;n.uniforms.mouseSpeed.value=D;n.uniforms.mouseRad.value=C}}};
function PolyTrail(b,e){this.target=new THREE.Vector2(b,e);this.s=[];this.g=[];for(var c=0;c<=16;c++){this.s[c]=new THREE.Vector2(b,e);this.g[c]=new THREE.Vector2(b,e)}}PolyTrail.prototype.update=function(){for(var b=16;b>=1;b-=1){this.s[b].x+=this.g[b].x-this.s[b].x;this.s[b].y+=this.g[b].y-this.s[b].y;if(this.s[b].x==this.g[b].x)this.g[b].x=this.s[b-1].x;if(this.s[b].y==this.g[b].y)this.g[b].y=this.s[b-1].y}this.s[0].x=this.target.x;this.s[0].y=this.target.y};
var VideoLoadRegister={},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VIDEO_KEYED_INVERSE=6,VIDEO_SMARTALPHA=7,VIDEO_SMARTALPHA_DISTORT=8,VideoPlayer=function(b,e){var c=this,d=(new Date).getTime();SequencerItem.call(this);var f={},h=[],g=!1,n,m,o=b.renderer,t=b.renderTarget,u=0,w=0,v=0,x=0,y=0,A=0,B=new THREE.Vector2(0,0),D;this.duration=e[0].duration;this.init=function(){f.prx=e[0].paralaxHorizontal||0;f.pry=e[0].paralaxVertical||0;f.tgd=e[0].targetDistance||
1500;onGrid=function(C){f.grid=C;c.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){g=!0;b.signals.mousemoved.add(function(){u=b.mouse.x/b.screenWidth*-2+1;w=b.mouse.y/b.screenHeight*2-1});D=new THREE.Vector2(0,0);f.fov=54;f.aspect=2.35;f.adj=Math.tan(f.fov*Math.PI/360)*2;m=new THREE.Camera(f.fov,f.aspect,1,1E5);m.target.position=new THREE.Vector3(0,0,f.tgd*-1);m.updateMatrix();n=new THREE.Scene;n.addLight(new THREE.AmbientLight(0));
n.addObject(m);for(var C=0;C<e.length;C++){var G=new VideoPlane(b,e[C],f);h.push(G)}};this.show=function(C){for(var G=0;G<h.length;G++){var F=h[G];F.locked?m.addChild(F.mesh):n.addChild(F.mesh);F.start(C)}};this.hide=function(){for(var C=0;C<h.length;C++)h[C].stop()};this.update=function(C,G,F){F=(new Date).getTime();G=F-d;d=F;if(g){y=u;A=w;B.x+=(1E3*Math.max(Math.min(y-v,0.05),-0.05)/G-B.x)/12;B.y+=(1E3*Math.max(Math.min(A-x,0.05),-0.05)/G-B.y)/12;v=u;x=w;D.x=u*-2*f.prx;D.y=w*2*f.pry;D.x=Math.min(D.x,
f.prx);D.x=Math.max(D.x,-f.prx);D.y=Math.min(D.y,f.pry);D.y=Math.max(D.y,-f.pry);m.target.position.x+=(D.x-m.target.position.x)/2;m.target.position.y+=(D.y-m.target.position.y)/2;for(G=0;G<h.length;G++){F=h[G];if(C>F.removeAt&&!F.removed){F.locked&&m.removeChild(F.mesh);n.removeChild(F.mesh);F.stop();F.removed=!0}else F.update(u,w,B,1)}o.render(n,m,t)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var DistortUniforms={aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5},mouseXY:{type:"v2",value:new THREE.Vector2},trail0:{type:"v2",value:new THREE.Vector2},trail1:{type:"v2",value:new THREE.Vector2},trail2:{type:"v2",value:new THREE.Vector2},trail3:{type:"v2",value:new THREE.Vector2},trail4:{type:"v2",value:new THREE.Vector2},mouseSpeed:{type:"v2",value:new THREE.Vector2},mouseRad:{type:"f",
value:1}},DistortShaderFragmentPars="uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distancePoly;\nvarying float distance;\nvarying vec2 closestPoly;",DistortVertexShader="uniform vec2 mouseXY;\nuniform vec2 trail0;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform vec2 trail4;\nuniform float aspect;\nuniform vec2 mouseSpeed;\nuniform float mouseRad;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distance;\nvarying float distancePoly;\nvarying vec2 closestPoly;\nvec2 getClosest(vec2 p, vec2 l1, vec2 l2){\nvec2 pl1 = p - l1;\nvec2 l2l1 = l2 - l1;\nfloat dot = pl1.x * l2l1.x + pl1.y * l2l1.y;\nfloat len_sq = pow(length(l2l1),2.);\nfloat param = dot / len_sq;\nif(param < 0.) return l1;\nelse if(param > 1.) return l2;\nelse return (l1 + l2l1 * param);\n}\nfloat getDistance(vec2 p, vec2 li){\nreturn max(0., 1. - sqrt( (p.x-li.x)*(p.x-li.x) + (p.y-li.y)*(p.y-li.y) ) );\n}\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUvPoly = uv+vec2(normal.x,normal.y);\nvec4 glPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nvec2 projPos = vec2(aspect,1.)*vec2(gl_Position.x/gl_Position.z,gl_Position.y/gl_Position.z);\nvec2 projPosPoly = vec2(aspect,1.)*vec2(glPosPoly.x/glPosPoly.z,glPosPoly.y/glPosPoly.z);\nfloat distRand = normal.z+.5;\nvec2 closestTrailPoly1 = getClosest(projPosPoly,trail0,trail1);\nvec2 closestTrailPoly2 = getClosest(projPosPoly,trail1,trail2);\nvec2 closestTrailPoly3 = getClosest(projPosPoly,trail2,trail3);\nvec2 closestTrailPoly4 = getClosest(projPosPoly,trail3,trail4);\nfloat distanceTrailPoly1 = 1.0*mouseRad*distRand * getDistance(projPosPoly,closestTrailPoly1);\nfloat distanceTrailPoly2 = 0.9*mouseRad*distRand * getDistance(projPosPoly,closestTrailPoly2);\nfloat distanceTrailPoly3 = 0.8*mouseRad*distRand * getDistance(projPosPoly,closestTrailPoly3);\nfloat distanceTrailPoly4 = 0.7*mouseRad*distRand * getDistance(projPosPoly,closestTrailPoly4);\ndistancePoly = max(distanceTrailPoly1,max(distanceTrailPoly2,max(distanceTrailPoly3,distanceTrailPoly4)));\ndistance = mouseRad*max(0.,1.-length(projPos-trail0));\ngl_Position.xy = gl_Position.xy + normalize(projPos.xy-trail0)*vec2(distance*100.);\ngl_Position.xy = gl_Position.xy -mouseSpeed.xy*pow(distance,2.)*100.;\n}",
VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( map, vUv );\n}"},keyedInverse:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t > threshold )\nalpha = 0.0;//(1.0 - (t - 2.0)) * alphaFadeout;\ngl_FragColor = vec4( c.xyz * cs, alpha );\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},distortSmartalpha:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\nc.a = a.r;\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x * 0.6666, vUvPoly.y ) );\nvec4 aPoly = texture2D( map, vec2( 0.6666 + vUvPoly.x * 0.3333, vUvPoly.y ) );\ncPoly.a = aPoly.r;\nif ((distancePoly)>0.5) c = cPoly; \ngl_FragColor = c;\n}"].join("\n")},
smartAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},keyed:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",
value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},
distortOpaque:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \nelse gl_FragColor = c;\n}"].join("\n")},distortKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"].join("\n")}},
VideoShots={introLayers:[{path:"files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,fps:48,duration:22E3}],s01_01:[{path:"files/videos/city/s01_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:3120},{path:"files/videos/city/s01_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900},{path:"files/videos/city/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-800}],s01_03:[{path:"files/videos/city/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1100,width:1.56,height:1.59,duration:8120},{path:"files/videos/city/s03_layer02.webm",
shaderId:VIDEO_SMARTALPHA,z:-1100,width:1.56,height:1.59},{path:"files/videos/city/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0,removeAt:0.3}],s01_06:[{path:"files/videos/city/s06_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:2030},{path:"files/videos/city/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900}],s01_09:[{path:"files/videos/city/s09_layer04.webm",shaderId:VIDEO_KEYED,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,paralax:!0,width:1.5625,height:1.1627,
duration:8230,paralaxHorizontal:600,paralaxVertical:100},{path:"files/videos/city/s09_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-800,paralax:!0,removeAt:0.8,width:1.5625,height:1.1627},{path:"files/videos/city/s09_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-500,locked:!0,removeAt:0.3}],s02_01:[{path:"files/videos/prairie/s01_layer04.webm",shaderId:VIDEO_OPAQUE,z:-1400,width:1,height:1.83,paralax:!0,bendForce:200,duration:9230,paralaxHorizontal:400,paralaxVertical:200},{path:"files/videos/prairie/s01_layer03.webm",
shaderId:VIDEO_SMARTALPHA_DISTORT,bendForce:200,z:-1300,width:1.56,height:1.22,paralax:!0},{path:"files/videos/prairie/s01_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-1E3,paralax:!0,bendForce:200,width:1.56,height:1.83},{path:"files/videos/prairie/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-30,locked:!0}],s02_02:[{path:"files/videos/prairie/s02_layer03.jpg",shaderId:VIDEO_OPAQUE,z:-1010,duration:2020},{path:"files/videos/prairie/s02_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3},{path:"files/videos/prairie/s02_layer01.webm",
shaderId:VIDEO_SMARTALPHA,z:-990}],s02_03:[{path:"files/videos/prairie/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1500,duration:2030},{path:"files/videos/prairie/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_04:[{path:"files/videos/prairie/s04_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:5E3},{path:"files/videos/prairie/s04_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_06:[{path:"files/videos/prairie/s06_layer02.webm",shaderId:VIDEO_SMARTALPHA,colorScale:1,
threshold:2.4,alphaFadeout:1,z:-1010,duration:6060},{path:"files/videos/prairie/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,removeAt:0.7,z:-1E3}],s03_01:[{path:"files/videos/dunes/s01_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1E3,width:1.56,height:1.22,paralax:!0,duration:8E3,paralaxHorizontal:600,paralaxVertical:100},{path:"files/videos/dunes/s01_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-800,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,width:1.56,height:1.22,paralax:!0},{path:"files/videos/dunes/s01_layer01.webm",
shaderId:VIDEO_KEYED,colorScale:0,threshold:0.5,alphaFadeout:0.5,z:-100,locked:!0}],s03_02:[{path:"files/videos/dunes/s02_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:3500},{path:"files/videos/dunes/s02_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,z:-1E3}],s03_03:[{path:"files/videos/dunes/s03_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-400,paralax:!0,width:1.526,height:1.11,duration:11E3,paralaxHorizontal:600,paralaxVertical:100},{path:"files/videos/dunes/s03_layer01.webm",
shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0}]},City=function(b){var e=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("city initScene");e.update(0.0010,34.99,45199)});var c,d,f,h,g,n=b.renderer,m=b.renderTarget,o=[],t=[],u=!1;b.debug=!1;if(function(w){return(w=RegExp("[?&]"+w+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(w[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){o=[[0,18,-300],[0,18,-1210]];d=new THREE.PathCamera({fov:60,
aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:o,duration:10.5,useConstantSpeed:!0,resamplingCoef:30,createDebugPath:b.debug,createDebugDummy:b.debug,lookSpeed:0.0025,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2.8]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});d.position.set(0,0,0);d.lon=90;c=d;h=new CityWorld(b);g=new CitySoup(c,h.scene,b);b.worlds.city=h;b.soups.city=g;b.sequences.city=this;b.debug&&h.scene.addObject(c.debugPath);
h.scene.addObject(c.animationParent);console.log("city init")};this.resetCamera=function(){c.animation.play(!1,0);n.setClearColor(h.scene.fog.color);n.setStencilShadowDarkness(0.7)};this.show=function(){this.resetCamera();b.started.city=!0;console.log("show city")};this.hide=function(){};this.update=function(w,v){if(isNaN(v)||v>1E3||v==0)v=1E3/60;var x=c.animationParent.position.z;if(x<-1200&&!u){t=[[0,18,x],[0,18,-3350]];f=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,
far:1E5,waypoints:t,duration:14.3,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0025,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2.8]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});f.lat=d.lat;f.lon=d.lon;h.scene.addObject(f.animationParent);f.animation.play(!1,0);c=f;g.changeCamera(c);d.animation.stop();u=!0}THREE.AnimationHandler.update(v);g.update(v);if(c.animationParent)c.animationParent.rotation.z=
c.target.position.x/400;n.render(h.scene,c,m);h.update(v,c,!1);b.logger.log("vertices: "+n.data.vertices);b.logger.log("faces: "+n.data.faces);b.logger.log("draw calls: "+n.data.drawCalls)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){var e=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("prairie initScene");e.update(9.0E-4,49.99,90375)});var c,d,f,h=b.renderer,g=b.renderTarget,n,m=[],o=0;this.init=function(){m=[[302.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,
-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var t,u;for(t=0;t<m.length;t++){u=m[t][1];m[t][1]=m[t][2]+6;m[t][2]=-u}n=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E6,waypoints:m,duration:27,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,
lookSpeed:0.0028,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});n.position.set(0,0,0);n.lon=360;c=n;d=new PrairieWorld(b,c);f=new PrairieSoup(c,d.scene,b);b.worlds.prairie=d;b.soups.prairie=f;b.sequences.prairie=this;d.scene.addObject(n.animationParent);console.log("prairie init")};this.show=function(){this.resetCamera();b.started.prairie=!0;console.log("show prairie")};this.hide=function(){};this.resetCamera=
function(){o=0;c.position.set(0,0,0);c.lon=360;c.animation.play(!0,0)};this.update=function(t,u){if(isNaN(u)||u>1E3||u==0)u=1E3/60;o+=u;if(o<2500)c.lon=360;THREE.AnimationHandler.update(u);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/300;c.animationParent.position.y+=(Math.random()-0.5)*0.3;d.update(u,c,!1);f.update(u);h.render(d.scene,c,g);b.logger.log("vertices: "+h.data.vertices);b.logger.log("faces: "+h.data.faces);b.logger.log("draw calls: "+h.data.drawCalls)}};
Prairie.prototype=new SequencerItem;Prairie.prototype.constructor=Prairie;
var Dunes=function(b){SequencerItem.call(this);var e=this,c,d,f,h=b.renderer,g=b.renderTarget;b.signals.initscenes.add(function(){console.log("dunes initScene");e.update(9.0E-4,49.99,90375)});this.init=function(){d=new DunesWorld(b);b.worlds.dunes=d;b.sequences.dunes=this;c=DunesCamera(b);f=new DunesSoup(c.camera,d.scene,b);console.log("dunes init")};this.show=function(){c.resetCamera();b.started.dunes=!0;d.ambient.color.setHSV(0,0,0);d.directionalLight1.color.setHSV(0.08823529411764706,0,0);d.directionalLight2.color.setHSV(0,
0,0);d.lensFlare.position.y=-500;d.skyWhite=0.02;console.log("show dunes")};this.hide=function(){};this.resetCamera=function(){c.resetCamera();h.setClearColor(d.scene.fog.color)};this.update=function(n,m,o){if(n>0.05&&n<0.15){var t=Math.sin((n-0.05)/(0.15-0.05)*Math.PI*0.5);d.lensFlare.position.y=-1E3+4500*t;d.skyWhite=0.05+0.95*t;d.ambient.color.setHSV(0,0,0.1*t);d.directionalLight1.color.setHSV(0.08823529411764706,0,t);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*t)}else if(n>0.9){t=
Math.sin((1-(n-0.9)/0.1)*Math.PI*0.5);t*=t;d.lensFlare.position.y=-1E3+4500*t;d.skyWhite=0.05+0.95*t;d.ambient.color.setHSV(0,0,0.1*t);d.directionalLight1.color.setHSV(0.08823529411764706,0,t);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*t)}else if(n>0.05){d.skyWhite=1;d.ambient.color.setHSV(0,0,0.1);d.directionalLight1.color.setHSV(0.08823529411764706,0,1);d.directionalLight2.color.setHSV(0,0,0.8647058823529412);d.lensFlare.position.y=3500}n>0.15&&f.update(m);c.updateCamera(n,m,o);THREE.AnimationHandler.update(m);
d.update(m,c.camera,!1);h.render(d.scene,c.camera,g)}};Dunes.prototype=new SequencerItem;Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var e,c,d,f,h,g,n,m,o,t,u,w;e=document.createElement("div");e.style.width=window.innerWidth+"px";e.style.height=window.innerHeight+"px";e.style.backgroundColor="#4584b4";e.style.textAlign="center";var v=!1;this.load=function(){function x(y,A,B){var D=document.createElement("div");D.style.position="absolute";D.style.cursor="pointer";D.style.margin=y;var C=document.createElement("img");C.src=A;D.appendChild(C);D.addEventListener("mouseout",function(){C.src=
A},!1);D.addEventListener("mouseover",function(){C.src=B},!1);return D}c=document.createElement("canvas");c.width=32;c.height=window.innerHeight;d=c.getContext("2d");f=d.createLinearGradient(0,0,0,c.height);f.addColorStop(0,"#0e223a");f.addColorStop(0.5,"#4584b4");d.fillStyle=f;d.fillRect(0,0,c.width,c.height);e.style.backgroundImage="url("+c.toDataURL("image/png")+")";e.style.backgroundRepeat="repeat-x";h=new Clouds(b);h.getDomElement().style.position="absolute";h.getDomElement().style.left="0px";
h.getDomElement().style.top="0px";h.getDomElement().style.width=window.innerWidth+"px";h.getDomElement().style.height=window.innerHeight+"px";e.appendChild(h.getDomElement());o=document.createElement("div");o.style.position="absolute";o.setAttribute("id","ui-container");g=document.createElement("div");g.style.position="absolute";g.innerHTML='<img src="files/logo_heart.png">';o.appendChild(g);n=x("10px 0 0 85px","files/enter_idle.png","files/enter_rollover.png");n.addEventListener("click",function(){u.getDomElement().style.display=
"block";n.style.display="none";v=!0;b.signals.load.dispatch()},!1);o.appendChild(n);m=x("10px 0 0 85px","files/start_idle.png","files/start_rollover.png");m.style.display="none";m.addEventListener("click",function(){b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1)},1E3)},!1);o.appendChild(m);u=new LoadingBar(function(){u.getDomElement().style.display="none";m.style.display="block";v=!1;b.signals.initscenes.dispatch()});u.getDomElement().style.position="absolute";
u.getDomElement().style.display="none";o.appendChild(u.getDomElement());b.signals.loadItemAdded.add(u.addItem);b.signals.loadItemCompleted.add(u.completeItem);if(HandleErrors.isWebGLAndFireFox){t=document.createElement("div");t.style.paddingTop="60px";t.style.marginLeft="-2px";t.innerHTML="<img src = 'files/footer/header-trans.png' alt = 'ROME' />";e.appendChild(t)}else e.appendChild(o);w=document.createElement("div");w.style.position="absolute";w.style.left="0";w.style.bottom="0";w.style.width="100%";
new Footer(w);e.appendChild(w)};this.show=function(){h.show();e.style.display="block"};this.resize=function(x,y){h.resize(x,y);if(g){g.style.top="60px";g.style.left=(window.innerWidth-358)/2+"px"}if(n){n.style.top=m.style.top="210px";n.style.left=m.style.left=(window.innerWidth-358)/2+"px"}if(u){u.getDomElement().style.top="215px";u.getDomElement().style.left=(window.innerWidth-300)/2+"px"}e.style.width=x+"px";e.style.height=y+"px"};this.hide=function(){h.hide();e.style.display="none"};this.update=
function(){v||h.update()};LauncherSection.showUI=function(){e.removeChild(t);e.appendChild(o)};this.getDomElement=function(){return e}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function e(){g=!1;f.pause()}function c(L){switch(L.keyCode){case 32:f.paused?f.play():f.pause();break;case 37:f.currentTime--;n.clear();break;case 39:f.currentTime++;n.clear();break;case 38:f.playbackRate+=0.1;break;case 40:f.playbackRate-=0.1;break;case 77:f.volume=f.volume?0:1}}Section.call(this);var d,f,h,g=!1,n,m,o;d=document.createElement("div");d.style.display="none";f=document.createElement("audio");f.preload=!0;d.appendChild(f);source=document.createElement("source");
source.src="files/Black.ogg";f.appendChild(source);h=new Tune(f);h.setBPM(85);h.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);m=new THREE.WebGLRenderer;m.domElement.style.position="absolute";m.setSize(b.viewportWidth,b.baseHeight);m.sortObjects=!1;m.autoClear=!1;o=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);o.minFilter=THREE.LinearFilter;o.magFilter=THREE.LinearFilter;
b.renderer=m;b.renderTarget=o;b.signals.startfilm.add(function(L,H){d.appendChild(m.domElement);g=!0;f.currentTime=h.getPatternMS(L)/1E3;f.play();f.volume=H});b.signals.stopfilm.add(e);THREE.ImageUtils.loadTexture("files/textures/fingerprints.png");var t=new VideoPlayer(b,VideoShots.introLayers),u=new VideoPlayer(b,VideoShots.s01_01),w=new VideoPlayer(b,VideoShots.s01_03),v=new VideoPlayer(b,VideoShots.s01_06),x=new VideoPlayer(b,VideoShots.s01_09),y=new VideoPlayer(b,VideoShots.s02_01),A=new VideoPlayer(b,
VideoShots.s02_02),B=new VideoPlayer(b,VideoShots.s02_03),D=new VideoPlayer(b,VideoShots.s02_04),C=new VideoPlayer(b,VideoShots.s02_06),G=new VideoPlayer(b,VideoShots.s03_01),F=new VideoPlayer(b,VideoShots.s03_02),E=new VideoPlayer(b,VideoShots.s03_03);n=new Sequencer;n.add(new ClearEffect(b),h.getPatternMS(0),h.getPatternMS(73.25),0);n.add(t,h.getPatternMS(0),h.getPatternMS(8),1);t=h.getPatternMS(8);var O=h.getPatternMS(16);n.add(u,t,t+u.duration,1);t+=u.duration;n.add(w,t,t+w.duration,1);t+=w.duration;
n.add(v,t,t+v.duration,1);t+=v.duration;n.add(x,t,O,4);u=h.getPatternMS(16)-2E3;n.add(new City(b),u,h.getPatternMS(24),1);n.add(new PaintEffect(b),u,h.getPatternMS(24),5);u=h.getPatternMS(24);h.getPatternMS(32);n.add(y,u,u+y.duration,1);u+=y.duration;n.add(A,u,u+A.duration,1);u+=A.duration;n.add(B,u,u+B.duration,1);u+=B.duration;n.add(D,u,u+D.duration,1);u+=D.duration;n.add(C,u,u+C.duration,4);y=h.getPatternMS(32)-3E3;n.add(new Prairie(b),y,h.getPatternMS(40),1);n.add(new PaintEffectPrairie(b),y,
h.getPatternMS(40),5);y=h.getPatternMS(40);h.getPatternMS(48);n.add(G,y,y+G.duration,1);y+=G.duration;n.add(F,y,y+F.duration,1);y+=F.duration;n.add(E,y,y+E.duration,4);y+=E.duration;G=h.getPatternMS(48)-11E3;n.add(new Dunes(b),G,h.getPatternMS(73.25),1);n.add(new PaintEffectDunes(b),G,h.getPatternMS(73.25),5);n.add(new FadeOutEffect(0,b),h.getPatternMS(23.5),h.getPatternMS(24),3);n.add(new FadeOutEffect(0,b),h.getPatternMS(39.5),h.getPatternMS(40),3);n.add(new FadeOutEffect(0,b),h.getPatternMS(73),
h.getPatternMS(73.25),3);n.add(new PointerEffect(b,!1),h.getPatternMS(0),h.getPatternMS(8),1);n.add(new PointerImageEffect(b,"files/cursor_arrow.gif"),h.getPatternMS(8),h.getPatternMS(16)-1E3,1);n.add(new PointerEffect(b,!0),h.getPatternMS(16),h.getPatternMS(73.25),1);n.add(new RenderEffect(b),h.getPatternMS(0),h.getPatternMS(8),6);n.add(new PaintEffect(b),h.getPatternMS(8),h.getPatternMS(16)-2E3,6);n.add(new PaintEffectPrairie(b),h.getPatternMS(24),h.getPatternMS(32)-3E3,6);n.add(new RenderEffect(b),
h.getPatternMS(40),h.getPatternMS(48)-11E3,6);this.getDomElement=function(){return d};this.show=function(){d.style.display="block";b.signals.keydown.add(c)};this.hide=function(){d.style.display="none";b.signals.keydown.remove(c);e()};this.resize=function(L,H){b.viewportWidth=b.baseWidth*(L/b.baseWidth);b.viewportHeight=b.baseHeight*(L/b.baseWidth);m.setSize(b.viewportWidth,b.viewportHeight);o.width=b.viewportWidth;o.height=b.viewportHeight;delete o.__webglFramebuffer;m.domElement.style.left="0px";
m.domElement.style.top=(H-b.viewportHeight)/2+"px"};this.update=function(){if(g)if(f.currentTime==f.duration){b.signals.showrelauncher.dispatch();e()}else n.update(f.currentTime*1E3)}};FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function e(){for(var D=x.getPoints(),C=0;C<D.length;C++){var G=D[C].getOriginPosition(),F=f.list[C],E=G.x;G=G.y;if(C==0){E-=113;G-=162}else if(C==1){E+=137;G-=46}else if(C==2){E+=106;G+=78}else if(C==3){E-=312;G+=75}else{E-=344;G-=46}F.style.left=E+"px";F.style.top=G+"px"}}function c(D,C,G,F,E){C=document.createElement(C);C.setAttribute("id",G);C.setAttribute("class",F);C.innerHTML=E;D.appendChild(C);return C}Section.call(this);var d=document.createElement("div");
d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.display="none";d.style.backgroundColor="#ffffff";d.setAttribute("id","relauncher-section");var f={},h,g=document.createTextNode("#relauncher-section div.after-experience { position: absolute; height: 57px; overflow: hidden; cursor: pointer; } #relauncher-section div.after-experience img { display: block; } #relauncher-section div.after-experience:hover img { margin-top: -57px; }"),n=document.getElementsByTagName("head")[0],
m=document.createElement("style");m.type="text/css";if(m.styleSheet)m.styleSheet.cssText=g.nodeValue;else m.appendChild(g);n.appendChild(m);var o=new Clouds(b,!0);o.getDomElement().style.position="absolute";o.getDomElement().style.left="0px";o.getDomElement().style.top="0px";o.getDomElement().style.width=window.innerWidth+"px";o.getDomElement().style.height=window.innerHeight+"px";d.appendChild(o.getDomElement());g=document.createElement("div");g.setAttribute("id","container");g.setAttribute("style",
"position: absolute;");d.appendChild(g);var t=document.createElement("div");t.setAttribute("style","-webkit-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -moz-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -o-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750);");t.style.position="absolute";t.style.width="100%";t.style.height="100%";t.style.backgroundColor="#000";d.appendChild(t);var u=new GEE({fullscreen:!0,
container:g,loop:!1}),w=u.ctx;h=document.createElement("div");h.style.position="absolute";h.style.width="100%";h.style.top=window.innerHeight-78+"px";h.style.left="0";new Footer(h);d.appendChild(h);var v=new WonderWall.Pentagon(u,u.width*0.5,u.height*0.5,80),x=new WonderWall.Pentagon(u,u.width*0.5,u.height*0.5,95),y=new WonderWall.Pentagon(u,u.width*0.5,u.height*0.5,130,0.25);y.showFill=!1;y.insides=!0;x.showFill=!1;y.setRadius(0.19);v.setRadius(0.12);var A={svg:new Heart(u,"files/eminating-heart.svg",
0,0),point:new WonderWall.Point(u,u.width*0.5,u.height*0.5+6)};A.point.r=0.0625;var B=B||{};B.color={red:"#f15d22",black:"#30302e",white:"#f4f4ea"};f=function(D){var C={},G=c(D,"div","start-over","after-experience","<img src = 'files/relaunch_section/start_over.png' alt = 'Start Over' />"),F=c(D,"div","technology","after-experience","<img src = 'files/relaunch_section/technology.png' alt = 'Technology' />"),E=c(D,"div","add-to-the-dream","after-experience","<img src = 'files/relaunch_section/add_dreams.png' alt = 'Add to the Dream' />"),
O=c(D,"div","explore-other-dreams","after-experience","<img src = 'files/relaunch_section/explore_dreams.png' alt = 'Explore Other Dreams' />");D=c(D,"div","continue-to-explore","after-experience","<img src = 'files/relaunch_section/continue.png' alt = 'Continue To Explore' />");G.addEventListener("click",function(L){L.preventDefault();b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(0,1)},!1);F.addEventListener("click",function(L){L.preventDefault();window.location="/tech"},!1);E.addEventListener("click",
function(L){L.preventDefault();b.signals.showugcintro.dispatch()},!1);O.addEventListener("click",function(L){L.preventDefault();window.location="/gallery"},!1);D.addEventListener("click",function(L){L.preventDefault();b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes")},!1);C.start=G;C.technology=F;C.add=E;C.otherDreams=O;C.explore=D;C.list=[D,G,O,E,F];init=!0;return C}(d);for(g=0;g<f.list.length;g++){n=f.list[g];n.addEventListener("mouseover",function(){var D=f.list.indexOf(this);
v.setUpdatePoint(!0,D);x.setUpdatePoint(!0,D);y.setUpdatePoint(!0,D);A.point.updating=!0},!1);n.addEventListener("mouseout",function(){var D=f.list.indexOf(this);v.setUpdatePoint(!1,D);x.setUpdatePoint(!1,D);y.setUpdatePoint(!1,D);A.point.updating=!1},!1)}e();u.draw=function(){x.update();x.getPoints();w.clearRect(0,0,u.width,u.height);w.globalCompositeOperation="source-over";w.strokeStyle=B.color.black;w.lineWidth=0.5;y.update().render();w.globalCompositeOperation="destination-out";v.update().render();
w.globalCompositeOperation="xor";w.lineWidth=24;x.showStroke=!0;x.showFill=!1;x.render();w.globalCompositeOperation="source-over";w.save();w.translate(u.width/2,u.height/2);A.svg.render();w.restore()};this.show=function(){o.show();e();d.style.display="block";setTimeout(function(){t.style.opacity=0},1)};this.resize=function(D,C){d.style.width=D+"px";d.style.height=C+"px";o.resize(D,C);h.style.top=window.innerHeight-78+"px";e()};this.hide=function(){o.hide();d.style.display="none";t.style.opacity=1};
this.getDomElement=function(){return d};this.update=function(){o.update();u.draw()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){function e(){var C=window.innerWidth/b.baseWidth;b.viewportWidth=b.baseWidth*C;b.viewportHeight=b.baseHeight*C;h.setSize(b.viewportWidth,b.viewportHeight);g.width=b.viewportWidth;g.height=b.viewportHeight;delete g.__webglFramebuffer;h.domElement.style.left="0px";h.domElement.style.top=(window.innerHeight-b.viewportHeight)/2+"px"}Section.call(this);var c=document.createElement("div");c.style.display="none";var d=0,f=0,h=b.renderer,g=b.renderTarget,n,m,o,t,u,w,v,x,
y=0,A="";t=new ClearEffect(b);t.init();x=new FadeOutEffect(0,b);x.init();u=new PaintEffect(b);u.init();w=new PaintEffectPrairie(b);w.init();v=new PaintEffectDunes(b);v.init();var B,D={};D.dunes=new DunesCameraFreeExplore(b);D.prairie=new PrairieCameraFreeExplore(b);D.city=new CityCameraFreeExplore(b);b.signals.startexploration.add(function(C){n=b.worlds[C];m=n.portals;B=D[C];if(C==="dunes"&&A!==""&&A!=="dunes"&&m){for(var G=99999999999,F,E=0;E<m.length;E++)if(m[E].currentDistance<G){G=m[E].currentDistance;
F=m[E]}B.switchDirection(F)}else B.resetCamera();A=C;y=0;if(C=="city")o=u;else if(C=="prairie")o=w;else{o=v;n.skyWhite=1;n.ambient.color.setHSV(0,0,0.1);n.directionalLight1.color.setHSV(0.08823529411764706,0,1);n.directionalLight2.color.setHSV(0,0,0.8647058823529412);n.lensFlare.position.y=3500}e();d=f=(new Date).getTime()});b.signals.windowresized.add(e);this.getDomElement=function(){return c};this.show=function(){c.style.display="block";c.appendChild(h.domElement)};this.hide=function(){c.style.display=
"none"};this.resize=function(){console.log("Exploration Resize")};this.update=function(){if(n&&n.scene){time=(new Date).getTime()-d;delta=time-f;f=time;delta=33;B.updateCamera(0,delta,time);n.update(delta,B.camera,!0);t.update(0,delta,time);h.setClearColor(n.scene.fog?n.scene.fog.color:16777215);h.render(n.scene,B.camera,g);if(y<1E3){y+=delta;x.update(1-y/1E3)}else for(var C=0;C<m.length;C++)m[C].currentDistance<m[C].radius*1.5&&x.update(1-(m[C].currentDistance-m[C].radius)/(m[C].radius*0.5));o.update(0,
delta,time)}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){var e,c,d,f=document.createElement("div");f.style.display="none";this.getDomElement=function(){return f};this.load=function(){var h=signals.Signal;b.ugcSignals={};b.ugcSignals.showintro=new h;b.ugcSignals.showobjectcreator=new h;b.ugcSignals.object_createmode=new h;b.ugcSignals.object_erasemode=new h;b.ugcSignals.object_symmetrymode=new h;b.ugcSignals.object_changecolor=new h;b.ugcSignals.object_changesize=new h;b.ugcSignals.submit=new h;e=new UgcIntro(b);f.appendChild(e.getDomElement());
c=new UgcObjectCreator(b);c.getDomElement().style.display="none";f.appendChild(c.getDomElement());d=new UgcUI(b);d.getDomElement().style.position="absolute";d.getDomElement().style.left="20px";d.getDomElement().style.top="50%";d.getDomElement().style.display="none";f.appendChild(d.getDomElement());d.addListeners();d.HANDLERS.updateCapacity(0);b.ugcSignals.showintro.add(function(){e.getDomElement().style.display="block";c.getDomElement().style.display="none";d.getDomElement().style.display="none"});
b.ugcSignals.showobjectcreator.add(function(){e.getDomElement().style.display="none";c.getDomElement().style.display="block";d.getDomElement().style.display="block"})};this.show=function(){f.style.display="block";c.show()};this.hide=function(){f.style.display="none";c.hide()};this.resize=function(h,g){d.scale(h/1342);d.getDomElement().style.marginTop=-255*h/1342+"px";c.resize(h,g)};this.update=function(){c.update()}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b,e){function c(){if(!e){o.x=b.mouse.x/b.screenWidth*100-50;o.y=b.mouse.y/b.screenHeight*100-50;t=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}}function d(oa){for(var V=0;V<2;V++){f=n[V]=new Boid;f.position.x=320;f.position.y=20+Math.random()*10;f.position.z=200+Math.random();f.velocity.x=Math.random()*2-1;f.velocity.y=Math.random()*2-1;f.velocity.z=Math.random()*2-1;f.setAvoidWalls(!0);f.setWorldSize(1E3,200,400);m[V]=new ROME.Animal(oa,!0);m[V].timeOffset=
Math.random()*100;h=g[V]=m[V].mesh;h.phase=Math.floor(Math.random()*62.8);h.rotation.set(0,-0.5,0);h.updateMatrix();h.update();window.morphObject=m[V];m[V].play(m[V].availableAnimals[0],m[V].availableAnimals[0]);h.position=n[V].position;h.doubleSided=!1;h.scale.x=h.scale.y=h.scale.z=0.03+0.05*Math.random();G.addChild(h)}F.position.z=-4E3;A.addObject(F);E.position.z=0;A.addObject(E);D.addObject(G)}var f,h,g=[],n=[],m=[],o={x:0,y:0},t={x:0,y:0,z:0},u,w,v=start_time=(new Date).getTime(),x,y,A,B,D,C,
G,F,E,O,L,H,N,ea,p,ha=0;L=new THREE.Fog(4555956,-100,3E3);x=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);x.position.z=6E3;A=new THREE.Scene;D=new THREE.Scene;G=new THREE.Object3D;O=new THREE.Geometry;var fa=THREE.ImageUtils.loadTexture("files/cloud256.png",null,function(){H=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:fa},fogColor:{type:"c",value:L.color},fogNear:{type:"f",value:L.near},fogFar:{type:"f",value:L.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var oa=new THREE.Mesh(new THREE.Plane(64,64)),V=0;V<4E3;V++){oa.position.x=
Math.random()*1E3-500;oa.position.y=e?-Math.random()*Math.random()*200+25:-Math.random()*Math.random()*200-15;oa.position.z=V;oa.rotation.z=Math.random()*Math.PI;oa.scale.x=oa.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(O,oa)}F=new THREE.Mesh(O,H);E=new THREE.Mesh(O,H);(new THREE.JSONLoader).load({model:"./files/models/soup/birds_B_life.js",callback:d})});fa.magFilter=THREE.LinearMipMapLinearFilter;fa.minFilter=THREE.LinearMipMapLinearFilter;C=new THREE.WebGLRenderer({antialias:!1,
clearColor:0,clearAlpha:0});C.domElement.style.position="absolute";C.domElement.style.left="0px";C.domElement.style.top="0px";C.sortObjects=!1;C.autoClear=!1;ea=new THREE.WebGLRenderTarget(window.innerWidth/2,window.innerHeight/2,{minFilter:THREE.NearestFilter,magFilter:THREE.LinearFilter});p=new THREE.WebGLRenderTarget(window.innerWidth*2,window.innerHeight*2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});window.renderTargetClouds=ea;y=new THREE.Camera;y.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);B=new THREE.Scene;N=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:ea},tFlamingos:{type:"t",value:1,texture:p},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:L.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos *= 1./4.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.15*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
B.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),N));this.getDomElement=function(){return C.domElement};this.show=function(){b.signals.mousemoved.add(c)};this.hide=function(){b.signals.mousemoved.remove(c)};this.resize=function(oa,V){x.aspect=oa/V;x.updateProjectionMatrix();C.setSize(oa,V);C.domElement.style.width=oa+"px";C.domElement.style.height=V+"px"};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;w=(new Date).getTime();u=w-v;v=w;x.position.x+=
(o.x-x.position.x)*0.0090;x.position.y+=(-o.y-x.position.y)*0.0090;x.position.z=-position+4E3;G.position.z=x.position.z-500;G.position.y=-50;ha=Math.min(Math.max(-0.3,(o.x-x.position.x)*0.0050),0.3);x.up.x+=(ha-x.up.x)*0.0050;x.up.normalize();x.target.position.x=x.position.x;x.target.position.y=x.position.y;x.target.position.z=x.position.z-1E3;C.clear();C.render(A,x,ea,!0);C.render(D,x,p,!0);C.render(B,y);for(var oa=0,V=g.length;oa<V;oa++){f=n[oa];t.z=f.position.z;f.run(n);h=g[oa];h.rotation.y=Math.atan2(-f.velocity.z,
f.velocity.x)+Math.PI/2;h.rotation.z=Math.asin(f.velocity.y/f.velocity.length());h.phase=(h.phase+(Math.max(0,h.rotation.z)+0.1))%62.83;m[oa].update(u*h.phase/100)}}},Boid=function(){var b=new THREE.Vector3,e,c=500,d=500,f=200,h,g=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;e=new THREE.Vector3;this.setGoal=function(n){h=n};this.setAvoidWalls=function(n){g=n};this.setWorldSize=function(n,m,o){c=n;d=m;f=o};this.run=function(n){if(g){b.set(-c*15,this.position.y,this.position.z);
b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(c,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,0,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,d,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,-f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b)}Math.random()>
0.5&&this.flock(n);this.move()};this.flock=function(n){h&&e.addSelf(this.reach(h,0.0050));e.addSelf(this.alignment(n));e.addSelf(this.cohesion(n));e.addSelf(this.separation(n))};this.move=function(){this.velocity.addSelf(e);var n=this.velocity.length();n>1&&this.velocity.divideScalar(n/1);this.position.addSelf(this.velocity);e.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>d)this.position.y=-d;if(this.position.y<
-d)this.position.y=d;if(this.position.z>f)this.position.z=-f;if(this.position.z<-f)this.position.z=f};this.avoid=function(n){var m=new THREE.Vector3;m.copy(this.position);m.subSelf(n);m.multiplyScalar(1/this.position.distanceToSquared(n));return m};this.repulse=function(n){var m=this.position.distanceTo(n);if(m<150){var o=new THREE.Vector3;o.sub(this.position,n);o.multiplyScalar(0.5/m);e.addSelf(o)}};this.reach=function(n,m){var o=new THREE.Vector3;o.sub(n,this.position);o.multiplyScalar(m);return o};
this.alignment=function(n){for(var m,o=new THREE.Vector3,t=0,u=0,w=n.length;u<w;u++)if(!(Math.random()>0.6)){m=n[u];distance=m.position.distanceTo(this.position);if(distance>0&&distance<=3E3){o.addSelf(m.velocity);t++}}if(t>0){o.divideScalar(t);n=o.length();n>0.03&&o.divideScalar(n/0.03)}return o};this.cohesion=function(n){for(var m,o,t=new THREE.Vector3,u=new THREE.Vector3,w=0,v=0,x=n.length;v<x;v++)if(!(Math.random()>0.6)){m=n[v];o=m.position.distanceTo(this.position);if(o>0&&o<=3E3){t.addSelf(m.position);
w++}}w>0&&t.divideScalar(w);u.sub(t,this.position);n=u.length();n>0.03&&u.divideScalar(n/0.03);return u};this.separation=function(n){for(var m,o,t=new THREE.Vector3,u=new THREE.Vector3,w=0,v=n.length;w<v;w++)if(!(Math.random()>0.6)){m=n[w];o=m.position.distanceTo(this.position);if(o>0&&o<=3E3){u.sub(this.position,m.position);u.normalize();u.divideScalar(o);t.addSelf(u)}}return t}},UgcUI=function(b){var e=document.createElement("style");e.setAttribute("type","text/css");e.innerHTML="#ugcui g {\n  cursor: pointer;\n}\n#ugcui g.menu polygon.hitbox {\n  display: none;\n}\n#ugcui g.menu:hover polygon.hitbox {\n  display: inherit;\n}\n#ugcui g.folder polygon.folder-hitbox {\n  display: none;\n}\n#ugcui g.folder:hover polygon.folder-hitbox {\n  display: inherit;\n}\n#ugcui g.menu g.menu-buttons {\n  display: none;\n}\n#ugcui g.active polygon.hex {\n  fill: #f65824;\n}\n#ugcui g#color g.options polygon.selected {\n  stroke: #fff;\n  stroke-width: 4; z-index: 100\n}\n#ugcui g#color g.options polygon#white.selected {\n  stroke: #000;\n}\n#ugcui g#color g.options polygon:not(.selected):hover {\n  stroke: #fff;\n  stroke-width: 4; z-index: 200\n}\n#ugcui g#color g.options polygon#white:not(.selected):hover {\n  stroke: #000;\n}\n#ugcui g.menu-buttons g:hover:not(.active) .hex {\n  fill: #fff;\n}\n#ugcui g.folder g.options {\n  display: none;\n}\n#ugcui g.folder:hover g.options {\n  display: block;\n}\n#ugcui g#size g g:hover polygon.bg {\n  fill: #fff;\n}\n#ugcui g#size:hover g g polygon.bg.active {\n  fill: #f65824;\n}\n#ugcui g#smoother g.options g:hover polygon.bg {\n  fill: #fff;\n}";
document.getElementsByTagName("head")[0].appendChild(e);var c=document.createElement("div");c.innerHTML='<svg id="ugcui" \n\t\tversion="1.1"\n     xmlns="http://www.w3.org/2000/svg"\n     xmlns:xlink="http://www.w3.org/1999/xlink"\n     xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n  \t width="800px" \n  \t height="800px"\n     xml:space="preserve"><g>\n<g class="menu">\n<polygon class="hex main" fill="#282828"\n         points="13.128,45.47 0.002,22.735 13.128,0 39.379,0 52.505,22.735 39.379,45.47 "></polygon>\n<polygon fill="#ED957A"\n         points="26.747,35.233 15.912,28.403 15.912,15.66 26.747,22.488 \t"></polygon>\n<polygon fill="#EA7B59"\n         points="37.583,15.66 26.747,22.49 26.747,35.233 37.583,28.405 \t"></polygon>\n<polygon fill="#F15C22"\n         points="15.912,15.66 26.75,22.49 37.583,15.66 26.75,9.119 \t"></polygon>\n<polygon opacity="0" class="hitbox" points="140.184,\n    72.916 126.007,48.362 98.374,48.362 84.558,24.432 56.924,24.432\n\t43.107,0.5 14.756,0.5 0.58,25.054 14.397,48.985 0.58,72.917 14.397,96.847 0.58,120.779 14.756,145.332 42.389,145.332\n\t56.206,169.263 84.556,169.263 98.373,145.332 126.007,145.332 140.184,120.778 126.366,96.847 "></polygon>\n<g class="menu-buttons">\n<g id="reflect" name="hover" title="reflect" class="toggle">\n  <polygon class="hex" fill="rgba(255, 255, 255,\n      0.4)" points="13.128,\n      93.332 0.002,70.598 13.128,47.862 39.379,47.862 52.505,70.598\n39.379,93.332 "></polygon>\n<path fill="#404040" d="M26.031,77.49c-0.428,0-0.771,0.345-0.771,0.771v1.158c0,0.428,0.343,0.772,0.771,0.772\ns0.771-0.345,0.771-0.772v-1.158C26.802,77.835,26.459,77.49,26.031,77.49 M26.031,74.017c-0.428,0-0.771,0.344-0.771,0.771v1.158\nc0,0.425,0.343,0.771,0.771,0.771s0.771-0.346,0.771-0.771v-1.158C26.802,74.361,26.459,74.017,26.031,74.017 M20.066,64.992\nl-4.149-4.594c-0.238-0.262-0.61-0.351-0.939-0.224c-0.327,0.125-0.545,0.441-0.545,0.794v9.187v9.188\nc0,0.351,0.218,0.667,0.545,0.793c0.1,0.039,0.203,0.057,0.306,0.057c0.235,0,0.467-0.098,0.633-0.28l4.149-4.594l4.149-4.593\nc0.293-0.324,0.293-0.817,0-1.142L20.066,64.992z M18.804,74.178l-2.667,2.952v-6.976v-6.976l2.667,2.955l3.632,4.021L18.804,74.178\nz M27.847,69.584c-0.292,0.324-0.292,0.817,0,1.142l4.149,4.593l4.149,4.594c0.165,0.183,0.397,0.28,0.633,0.28\nc0.103,0,0.205-0.018,0.306-0.057c0.327-0.126,0.544-0.442,0.544-0.793v-9.188v-9.187c0-0.353-0.216-0.669-0.544-0.794\nc-0.33-0.127-0.702-0.038-0.938,0.224l-4.149,4.594L27.847,69.584z M29.626,70.154l3.634-4.021l2.667-2.955v6.976v6.976\nl-2.667-2.952L29.626,70.154z M26.031,70.541c-0.428,0-0.771,0.345-0.771,0.772v1.159c0,0.427,0.343,0.772,0.771,0.772\ns0.771-0.345,0.771-0.772v-1.159C26.802,70.886,26.459,70.541,26.031,70.541 M26.031,60.118c-0.428,0-0.771,0.346-0.771,0.772v1.158\nc0,0.427,0.343,0.773,0.771,0.773s0.771-0.347,0.771-0.773V60.89C26.802,60.464,26.459,60.118,26.031,60.118 M26.031,63.593\nc-0.428,0-0.771,0.345-0.771,0.772v1.158c0,0.428,0.343,0.771,0.771,0.771s0.771-0.343,0.771-0.771v-1.158\nC26.802,63.938,26.459,63.593,26.031,63.593 M26.031,67.066c-0.428,0-0.771,0.346-0.771,0.772v1.158\nc0,0.426,0.343,0.772,0.771,0.772s0.771-0.346,0.771-0.772v-1.158C26.802,67.412,26.459,67.066,26.031,67.066"></path>\n</g>\n<g id="create" name="hover" title="create"  class="active">\n  <polygon class="hex" fill="rgba(255, 255, 255,\n      0.4)" points="54.578,\n      69.401 41.452,46.666 54.578,23.932 80.83,23.932 93.956,46.666\n\t80.829,69.401 "></polygon>\n\t<path fill="#404040" d="M67.756,32.3l-12.121,7.29l-0.154-0.098v13.47l12.256,7.661l12.258-7.661V40.317L67.756,32.3z\n\t\t M67.719,34.201l9.991,6.543l-9.978,6.405l-10.564-6.602L67.719,34.201z M57.091,42.398l9.842,6.151v9.673l-9.842-6.151V42.398z\n\t\t M78.384,52.071l-9.842,6.15v-9.679l9.842-6.318V52.071z"></path>\n</g>\n<g id="erase" name="hover" title="erase" >\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="96.028,\n  93.332 82.902,\n  70.598 96.028,47.862 122.279,47.862 135.406,70.597\n\t122.279,93.332 "></polygon>\n\t<path fill="#404040" d="M111.564,61.336l-13.493,7.131v5.163l9.462,5.387l13.086-7.798V66.25L111.564,61.336z M113.314,69.774\n\t\tl-5.788,3.394l-7.658-4.416l6.083-3.215L113.314,69.774z M108.074,74.114l5.928-3.477v3.252l-5.928,3.534V74.114z M99.164,69.608\n\t\tl7.817,4.509v3.328l-7.817-4.45V69.608z"></path>\n</g>\n<g id="undo" name="hover" title="undo" >\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n  117.263 41.452,\n  94.528 54.578,71.794 80.829,71.794 93.955,94.528\n\t80.829,117.263 "></polygon>\n\t<path fill="#404040" d="M66.79,84.794v-0.083v-0.826c0-0.561-0.399-0.79-0.885-0.51l-0.716,0.414\n\t\tc-0.485,0.281-1.281,0.738-1.768,1.021l-0.714,0.413c-0.486,0.281-0.486,0.739,0,1.02l0.714,0.414\n\t\tc0.487,0.281,1.283,0.741,1.768,1.02l0.716,0.415c0.486,0.28,0.885,0.051,0.885-0.509v-0.827v-0.152\n\t\tc4.616,0.128,8.316,3.893,8.325,8.539c-0.008,4.722-3.829,8.542-8.551,8.549v0.001v-0.001c-0.414,0-0.822-0.027-1.219-0.084\n\t\tc-0.491-0.071-0.947,0.272-1.016,0.763c-0.07,0.493,0.271,0.948,0.762,1.017c0.482,0.07,0.974,0.104,1.473,0.105v0.001\n\t\tc5.717-0.002,10.351-4.635,10.352-10.352C76.914,89.499,72.401,84.916,66.79,84.794"></path>\n</g>\n<g class="folder" id="size">\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="126.366,\n144.709 140.184,120.778 126.007,96.225 97.656,96.225 83.48,120.779\n\t97.297,144.71 83.48,168.642 97.297,192.572 83.479,216.504 97.655,241.057 126.006,241.057 140.182,216.504 126.366,192.573\n\t140.183,168.642 "></polygon>\n  <g class="size" name="hover" title="size"  id="icon-size-small">\n    <g>\n      <polygon class="active bg" fill="rgba(255, 255, 255, 0.4)" points="96.028,\n  141.194 82.902,\n  118.46 96.028,95.725 122.279,95.725 135.406,118.459\n\t122.279,141.194 "></polygon>\n\t<path fill="#404040" d="M114.923,113.88v-6.316l-6.006-3.258l-6.285,3.118v6.456l-12.364,7.334l18.509,11.5l18.509-11.5\n\t\tL114.923,113.88z M103.259,121.247l5.477-3.378l5.539,3.391l-5.497,3.367L103.259,121.247z M108.257,124.945l-5.517,3.378\n\t\tl-5.457-3.391l5.457-3.367L108.257,124.945z M111.739,116.016l2.936-1.65l5.515,3.272l-5.395,3.304l-5.541-3.393L111.739,116.016z\n\t\t M102.949,114.324l5.266,3.226l-5.476,3.378l-5.374-3.29L102.949,114.324z M114.795,121.579l5.477,3.354l-5.457,3.39l-5.517-3.378\n\t\tL114.795,121.579z M115.316,121.26l5.403-3.309l5.52,3.274l-5.45,3.386L115.316,121.26z M96.836,117.951l5.384,3.297l-5.454,3.364\n\t\tl-5.45-3.386L96.836,117.951z M103.258,128.646l5.521-3.381l5.52,3.38l-5.52,3.43L103.258,128.646z"></path>\n    </g>\n  </g>\n  <g class="options">\n    <g class="size" id="icon-size-med">\n      <\!-- Hex --\>\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="96.028,189.057 82.902,166.323 96.028,143.588 122.28,143.588 135.405,166.323 122.279,189.057 "></polygon>\n      <\!-- Med icon --\>\t\t\t\t<path fill="#404040" d="M117.967,164.776v-9.757l-8.837-4.797l-9.248,4.927v9.452l-9.613,5.704l18.509,11.5l18.509-11.5\n\t\t\t\t\t\t\t\tL117.967,164.776z M103.258,170.335l2.864-1.765l2.803,1.666l2.609-1.564l2.74,1.678l-5.496,3.367L103.258,170.335z\n\t\t\t\t\t\t\t\t M108.257,174.035l-5.517,3.378l-5.459-3.391l5.458-3.367L108.257,174.035z M117.472,165.114l2.718,1.612l-5.395,3.305l-2.734-1.674\n\t\t\t\t\t\t\t\tL117.472,165.114z M105.594,168.255l-2.856,1.761l-5.373-3.291l2.832-1.68L105.594,168.255z M114.795,170.668l5.478,3.354\n\t\t\t\t\t\t\t\tl-5.458,3.391l-5.517-3.378L114.795,170.668z M115.315,170.349l5.404-3.31l5.52,3.276l-5.45,3.386L115.315,170.349z M96.836,167.04\n\t\t\t\t\t\t\t\tl5.383,3.297l-5.454,3.364l-5.449-3.385L96.836,167.04z M103.258,177.734l5.52-3.381l5.519,3.381l-5.519,3.43L103.258,177.734z"></path>\n    </g>\n    <g class="size" id="icon-size-large">\n      <\!-- Hex --\>\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="96.027,236.919 82.901,214.186 96.027,191.451 122.279,191.451 135.404,214.186 122.278,236.919 "></polygon>\n      <\!-- Big icon --\>\n      <path fill="#404040" d="M120.976,215.299v-13.17l-11.994-5.938l-12.195,6.058v12.926l-6.519,3.868l18.509,11.499l18.509-11.499\n\t\t\t\tL120.976,215.299z M108.257,222.772l-5.517,3.379l-5.459-3.392l5.458-3.365L108.257,222.772z M114.795,219.406l5.478,3.354\n\t\t\t\tl-5.458,3.392l-5.517-3.379L114.795,219.406z M115.315,219.087l5.404-3.31l5.52,3.275l-5.45,3.387L115.315,219.087z M96.836,215.777\n\t\t\t\tl5.383,3.299l-5.454,3.363l-5.449-3.387L96.836,215.777z M103.258,226.473l5.52-3.382l5.519,3.382l-5.519,3.43L103.258,226.473z"></path>\n    </g>\n  </g>\n</g>\n<g class="folder"   id="smoother">\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="84.916,\n168.64 98.732,\n144.71 84.556,120.157 56.206,120.157 42.029,144.71\n\t55.847,168.641 42.029,192.573 55.846,216.503 42.029,240.435 56.206,264.988 84.556,264.988 98.732,240.435 84.916,216.503\n\t98.732,192.573 "></polygon>\n<g name="hover" title="smooth">  <\!--hex --\>\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n  165.125 41.452,\n  142.391 54.578,119.657 80.829,119.657 93.955,142.391\n\t80.829,165.125 "></polygon>\n  <\!--icon--\>\n  <polygon fill="#575759"\n           points="68.279,159.028 62.1,155.134 62.1,147.868 68.279,151.761 \t"></polygon>\n  <polygon fill="#3A3A3A"\n           points="74.458,147.868 68.279,151.762 68.279,159.028 74.458,155.135 \t"></polygon>\n  <polygon fill="#282828"\n           points="62.1,147.868 68.28,151.762 74.458,147.868 68.28,144.138 \t"></polygon>\n  <circle fill="#575759" cx="68.167" cy="134.167" r="5"></circle></g>\n  <g class="options">\n    <g id="smoother-up">\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="54.578,212.988 41.452,190.254 54.578,167.519 80.829,167.519 93.955,190.254 80.829,212.988 "></polygon>\n\t\t\t\t\t\t\t<polygon fill="#404040" points="74.25,189.179 69.071,189.179 69.071,184 66.929,184 66.929,189.179 61.75,189.179 61.75,191.321 \n\t\t\t\t\t\t\t\t66.929,191.321 66.929,196.5 69.071,196.5 69.071,191.321 74.25,191.321 "></polygon>\n    </g>\n    <g id="smoother-down">\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="54.578,260.85 41.452,238.116 54.578,215.381 80.829,215.381 93.955,238.116 80.829,260.85 "></polygon>\n\t\t\t\t\t\t<rect x="61.75" y="236.5" fill="#404040" width="12.5" height="2.143"></rect>\n    </g>\n  </g>\n</g>\n<g class="folder" id="color">\n<polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="13.128,\n  141.194 0.002,\n  118.46 13.128,95.725 39.379,95.725 52.505,118.46\n\t39.379,141.194 "></polygon>\n  <\!-- Paint Bucket --\><path fill="#404040" d="M38.662,114.453c-2.85-3.684-8.097-1.808-8.097-1.808s3.946,3.913,5.455,5.42\n\t\tc1.633,1.633,2.081,10.199,3.058,8.201C40.606,123.139,40.855,117.29,38.662,114.453 M27.774,110.481v2.259l6.309,6.309\n\t\tL24.01,129.12l-8.699-8.697l10.074-10.073l0.27,0.271v-2.149c-0.084-0.031-0.176-0.049-0.27-0.049c-0.213,0-0.414,0.082-0.565,0.233\n\t\tl-11.202,11.204c-0.312,0.311-0.312,0.817,0,1.129l9.827,9.828c0.152,0.151,0.352,0.235,0.565,0.235\n\t\tc0.211,0,0.413-0.084,0.565-0.235l11.202-11.203c0.151-0.152,0.235-0.353,0.235-0.565c0-0.214-0.084-0.413-0.236-0.563\n\t\tL27.774,110.481z M18.961,107.69c0.001-0.733,0.593-1.325,1.324-1.326h4.543c0.729,0.001,1.322,0.593,1.323,1.324v8.447\n\t\tc-0.212,0.081-0.41,0.205-0.579,0.374c-0.321,0.32-0.485,0.748-0.483,1.17c-0.001,0.421,0.163,0.85,0.484,1.172\n\t\tc0.322,0.323,0.749,0.487,1.173,0.485h0.004c0.419,0,0.844-0.162,1.167-0.484l-0.396-0.397l0.398,0.396\n\t\tc0.321-0.322,0.484-0.75,0.484-1.172s-0.163-0.85-0.485-1.171c-0.186-0.186-0.407-0.313-0.642-0.391v-8.429\n\t\tc0-1.353-1.095-2.449-2.448-2.449h-4.543c-1.353,0-2.45,1.096-2.45,2.451v7.208l1.126-1.126V107.69z M26.369,117.305\n\t\tc0.107-0.107,0.239-0.156,0.378-0.158c0.137,0.001,0.271,0.051,0.374,0.156c0.107,0.106,0.155,0.239,0.155,0.376\n\t\tc0,0.136-0.049,0.271-0.155,0.378c-0.104,0.104-0.239,0.153-0.374,0.153c-0.139,0-0.272-0.051-0.377-0.154\n\t\tc-0.104-0.105-0.155-0.24-0.155-0.377C26.216,117.541,26.266,117.409,26.369,117.305"></path>\n <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="140.182,\n        216.504 126.007,\n191.951 98.373,191.951 84.557,168.019 56.923,168.019\n\t43.466,144.709 57.283,120.779 43.107,96.225 14.756,96.225 0.58,120.779 14.396,144.709 0.579,168.642 14.396,192.572\n\t0.579,216.505 14.396,240.435 0.578,264.368 14.395,288.298 0.578,312.232 14.754,336.784 43.104,336.784 56.924,312.85\n\t84.557,312.85 98.373,288.919 126.006,288.919 140.182,264.367 126.365,240.434 "></polygon>\n  <g class="options">\n    <polygon fill="#80C5D8"\n             points="54.578,212.988 41.452,190.254 54.578,167.519 80.829,167.519 93.955,190.254 80.829,212.988 \t"></polygon>\n    <polygon fill="#2EA8CE" points="96.027,236.919 82.901,214.186 96.027,191.451 122.279,191.451 135.404,214.186 122.278,236.919\n\t\t"></polygon>\n    <polygon fill="#3F2249" points="96.027,284.782 82.901,262.048 96.027,239.313 122.279,239.313 135.404,262.048 122.278,284.782\n\t\t"></polygon>\n    <polygon fill="#EF7B1B"\n             points="54.578,260.85 41.452,238.116 54.578,215.381 80.829,215.381 93.955,238.116 80.829,260.85 \t"></polygon>\n    <polygon fill="#FF066C"\n             points="54.578,308.713 41.452,285.979 54.578,263.244 80.829,263.244 93.954,285.979 80.829,308.713 \t"></polygon>\n    <polygon fill="#FFF200"\n             points="13.126,332.646 0,309.913 13.126,287.176 39.377,287.176 52.503,309.913 39.377,332.646 \t"></polygon>\n    <polygon id="white" class="selected" fill="#FFFFFF"\n             points="13.127,189.057 0.001,166.323 13.127,143.588 39.379,143.588 52.504,166.323 39.378,189.057 \t"></polygon>\n    <polygon fill="#DBCE9A"\n             points="13.127,236.92 0.001,214.186 13.127,191.451 39.378,191.451 52.504,214.186 39.378,236.92 \t"></polygon>\n    <polygon fill="#458C65"\n             points="13.126,284.783 0,262.049 13.126,239.313 39.378,239.313 52.503,262.049 39.377,284.783 \t"></polygon>\n  </g>\n</g>\n</g>\n</g>\n<g class="menu">\n  <polygon fill="#282828" points="13.128,508.477 0.002,485.742 13.128,\n  463.007 39.379,463.007 52.505,485.742\n  39.379,508.477 "></polygon>\n\t<polygon fill="#F15C22" points="16.651,481.812 15.914,484.478 17.082,486.813 17.082,487.183 20.013,488.679 18.824,484.211 \n\t\t20.115,480.439 "></polygon>\n\t<polygon fill="#F15C22" points="35.652,480.172 36.308,480.029 38.501,481.792 39.238,481.423 39.628,481.361 39.158,478.492 \n\t\t39.137,478.083 38.788,476.936 39.198,476.319 39.628,475.355 38.419,476.218 38.316,476.545 34.874,476.218 36.124,477.057 \n\t\t33.971,478.656 32.618,481.505 34.095,482.694 "></polygon>\n\t<polygon fill="#CC481F" points="38.071,482.242 38.071,482.694 38.46,483.063 38.931,483.063 39.424,482.879 39.875,481.792 \n\t\t39.628,481.361 39.239,481.423 38.501,481.792 36.308,480.029 35.653,480.172 36.759,480.891 "></polygon>\n\t<path fill="#EA7B59" d="M37.764,488.946l-0.677-1.107l-2.788-2.398H34.3l0.041-1.536l-0.246-1.21l-1.477-1.189l1.354-2.849\n\t\tl2.152-1.6l-1.25-0.839l-2.726,1.394l-2.829,2.254l-2.768,1.148l-3.709-0.41l-2.726-0.164l-1.291,3.771l1.188,4.468l0.656,0.268\n\t\tl0.758-1.292l2.009,0.287l0,0l3.812,0.737l4.284-1.496l2.972,1.087l1.619,0.677l0.84,0.573l2.356,2.726l0.411,0.021l0.144,0.47\n\t\tv0.493l0.492,0.349h0.923l0.389-0.175L37.764,488.946z"></path>\n\t<polygon fill="#F15C22" points="28.334,490.258 29.441,489.52 30.262,490.483 33.828,489.135 33.828,488.843 31.532,487.183 \n\t\t34.504,488.27 34.709,489.314 33.766,490.053 30.589,491.16 "></polygon>\n\t<polygon fill="#CC481F" points="13.905,488.822 14.397,494.623 15.114,495.423 15.114,496.037 15.217,496.264 16.262,496.264 \n\t\t16.672,496.119 15.289,494.295 14.91,489.868 17.02,489.847 20.669,488.946 17.082,487.183 16.345,487.941 "></polygon>\n\t<polygon fill="#F15C22" points="25.526,494.828 25.096,493.987 20.833,491.16 20.115,490.236 20.669,488.946 21.427,487.654 \n\t\t23.437,487.941 22.658,489.048 21.469,490.011 21.571,490.483 25.855,493.578 26.695,494.274 "></polygon>\n\t<polygon fill="#F15C22" points="16.945,481.696 15.771,481.546 15.012,481.792 13.7,481.792 9.908,484.107 9.765,484.313 \n\t\t9.232,484.907 11.897,484.293 15.176,482.837 15.914,482.223 16.557,482.157 16.651,481.812 "></polygon>\n  <polygon opacity="0" class="hitbox" fill="#FFFFFF" stroke="#000000"\n           points="98.732,\n    464.13 84.556,\n  439.577 56.924,439.577 43.106,415.645 14.756,415.645\n  0.58,440.199 14.396,464.129 0.58,488.061 14.756,512.614 42.388,512.614 56.206,536.545 84.556,536.545 98.732,511.993\n  84.916,488.061 "></polygon>\n  <g class="menu-buttons">\n    <g class="active" name="hover" title="life"  id="life">\n      <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n    484.546 41.452,461.812 54.578,439.076 80.829,439.076 93.955,461.812\n  80.829,484.546 "></polygon>\n\t<path fill="#404040" d="M76.445,455.355c0.048-0.254,0.076-0.519,0.076-0.787c0-2.188-1.681-3.963-3.756-3.963\n\t\tc-0.558,0-1.082,0.136-1.557,0.365c-0.594-1.382-1.965-2.351-3.564-2.351c-1.177,0-2.223,0.538-2.934,1.37\n\t\tc-0.549-0.222-1.149-0.347-1.781-0.347c-2.605,0-4.717,2.062-4.717,4.606c0,0.582,0.122,1.137,0.326,1.651\n\t\tc-1.942,0.353-3.396,1.81-3.396,3.555c0,1.494,1.066,2.773,2.592,3.336c-0.007,0.071-0.025,0.136-0.025,0.207\n\t\tc0,1.421,1.358,2.572,3.031,2.572c1.187,0,2.202-0.584,2.699-1.426c1.352,1.293,3.396,2.136,5.715,2.136\n\t\tc2.936,0,5.45-1.332,6.633-3.249c0.17,0.035,0.345,0.065,0.525,0.065c1.748,0,3.165-1.736,3.165-3.878\n\t\tC79.478,457.13,78.131,455.442,76.445,455.355"></path>\n\t<path fill="#404040" d="M63.33,465.571l-0.651,0.415l3.015,3.845c0,0,0.889,1.064,1.067,1.95c0.176,0.889,0,2.486,0,2.486\n\t\tl-0.179,0.77c0,0,0.414,0.412,1.953,0.412c1.539,0,1.479-0.531,1.479-0.531s-0.948-2.13-0.858-3.608c0,0,0.326-1.953,1.686-3.195\n\t\tl0.679-1.124l-0.5-0.236l-2.012,2.013c0,0-0.413,0.117-0.65-0.473c-0.236-0.592-0.713-0.889-0.713-0.889l-0.546,0.236l0.254,0.945\n\t\tc0,0-0.119,0.828-0.888,0.12C65.694,467.996,63.981,466.754,63.33,465.571"></path>\n    </g>\n    <g id="dark" name="hover" title="dark" >\n      <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n    532.408 41.452,509.674 54.578,486.938 80.829,486.938 93.955,509.674\n  80.829,532.408 "></polygon>\n\t<path fill="#404040" d="M78.214,506.532c-0.465-7.85-9.32-8.604-10.63-8.673v-0.007c0,0-0.033,0-0.083,0.004\n\t\tc-0.05-0.004-0.083-0.004-0.083-0.004v0.007c-1.31,0.069-10.165,0.823-10.632,8.673c0,0-0.202,3.329,1.514,5.046\n\t\tc0,0,0.605,1.109,0.202,2.422c0,0-0.605,3.229,1.311,3.936c0,0,2.826,0.807,2.826,1.615c0,0,0.204,1.615,1.919,1.716\n\t\tc1.367,0.08,2.466,0.287,2.86,0.367v0.036c0,0,0.034-0.007,0.083-0.018c0.05,0.011,0.083,0.018,0.083,0.018v-0.036\n\t\tc0.394-0.08,1.493-0.287,2.86-0.367c1.716-0.101,1.917-1.716,1.917-1.716c0-0.809,2.825-1.615,2.825-1.615\n\t\tC77.104,517.229,76.5,514,76.5,514c-0.404-1.312,0.202-2.422,0.202-2.422C78.417,509.861,78.214,506.532,78.214,506.532\n\t\t M64.814,514.231c-1.02,1.268-2.725,1.586-3.811,0.715c-1.086-0.873-1.138-2.608-0.119-3.876s2.727-1.586,3.811-0.713\n\t\tC65.781,511.229,65.834,512.964,64.814,514.231 M67.63,517.499c-2,0-1.49-1.25-1.49-1.25s0.588-0.293,0.516-1.134\n\t\tc-0.076-0.838,0.974-1.217,0.974-1.217s1.049,0.379,0.974,1.217c-0.074,0.841,0.514,1.134,0.514,1.134S69.632,517.499,67.63,517.499\n\t\t M74.083,514.953c-1.085,0.876-2.799,0.555-3.82-0.717c-1.022-1.271-0.97-3.013,0.119-3.886c1.089-0.876,2.799-0.557,3.823,0.715\n\t\tC75.226,512.338,75.174,514.078,74.083,514.953"></path>\n\t\t\n    </g>\n    <text id="capacity" x="27" y="438" text-anchor="middle"\n          font-family="FuturaBT-Medium"\n          font-size="11" dominant-baseline="middle"\n          fill="#000">\n    </text>\n  </g>\n</g></g>\n</svg>';
var d=document.createElement("div");d.style.position="fixed";d.style.font="12px/0px FuturaBT-Medium";d.style.padding="13px 7px 10px 7px";d.style.display="none";d.style.backgroundColor="#fff";d.style.boxShadow="-1px 1px 0px rgba(0,0,0,0.4)";d.style.textTransform="uppercase";d.style.color="#000";d.innerHTML="CREATE";c.appendChild(d);var f={updateCapacity:function(n){document.getElementById("capacity").textContent=Math.round(n*100)+"%"},oncreatemode:function(){b.ugcSignals.object_createmode.dispatch()},
onerasemode:function(){b.ugcSignals.object_erasemode.dispatch()},onreflectmode:function(n){b.ugcSignals.object_symmetrymode.dispatch(n)},onundo:function(){alert("saved");b.ugcSignals.submit.dispatch()},oncolorchange:function(n){b.ugcSignals.object_changecolor.dispatch(n)},onsmoothup:function(){},onsmoothdown:function(){},onsize:function(n){b.ugcSignals.object_changesize.dispatch(n)},onlife:function(){},ondark:function(){}};this.__defineGetter__("HANDLERS",function(){return f});var h=function(n,m){(typeof n==
"string"?document.getElementById(n):n).addEventListener("mouseup",m,!1)},g=function(n){return document.getElementById(n).getElementsByClassName("bg")[0]};this.addListeners=function(){c.addEventListener("mousemove",function(u){d.style.top=u.pageY-40+"px";d.style.left=u.pageX+20+"px"},!0);for(var n=document.getElementById("ugcui").getElementsByClassName("menu"),m=0;m<n.length;m++){n[m].addEventListener("mouseover",function(){clearTimeout(this.hideTimeout);for(var u=this.getElementsByClassName("menu-buttons"),
w=0;w<u.length;w++)u[w].style.display="block"},!1);n[m].addEventListener("mouseout",function(){clearTimeout(this.hideTimeout);var u=this.getElementsByClassName("menu-buttons");this.hideTimeout=setTimeout(function(){for(var w=0;w<u.length;w++)u[w].style.display="none"},550)},!1)}n=document.getElementsByName("hover");for(m=0;m<n.length;m++){n[m].addEventListener("mouseover",function(){d.style.display="inline-block";d.innerHTML=this.getAttribute("title")},!1);n[m].addEventListener("mouseout",function(){d.style.display=
"none"},!1)}h("create",function(){this.setAttribute("class","active");document.getElementById("erase").setAttribute("class","");f.oncreatemode()});h("erase",function(){this.setAttribute("class","active");document.getElementById("create").setAttribute("class","");f.onerasemode()});h("life",function(){this.setAttribute("class","active");document.getElementById("dark").setAttribute("class","");f.onlife()});h("dark",function(){this.setAttribute("class","active");document.getElementById("life").setAttribute("class",
"");f.ondark()});h("reflect",function(){if(this.getAttribute("class")=="toggle"){this.setAttribute("class","toggle active");f.onreflectmode(!0)}else{this.setAttribute("class","toggle");f.onreflectmode(!1)}});h("undo",f.onundo);var o=document.getElementById("color").getElementsByClassName("options")[0].getElementsByTagName("polygon");for(m=0;m<o.length;m++)h(o[m],function(){for(var u=parseInt(this.getAttribute("fill").substr(1),16),w=0;w<o.length;w++)o[w].setAttribute("class","");this.setAttribute("class",
"selected");f.oncolorchange(u)});h("smoother-up",f.onsmoothup);h("smoother-down",f.onsmoothdown);var t=function(){g("icon-size-small").setAttribute("class","bg");g("icon-size-med").setAttribute("class","bg");g("icon-size-large").setAttribute("class","bg")};h("icon-size-small",function(){t();g("icon-size-small").setAttribute("class","active bg");f.onsize(1)});h("icon-size-med",function(){t();g("icon-size-med").setAttribute("class","active bg");f.onsize(3)});h("icon-size-large",function(){t();g("icon-size-large").setAttribute("class",
"active bg");f.onsize(5)})};this.scale=function(n){c.firstChild.firstChild.setAttribute("transform","translate(10, 0) scale("+n+")")};this.getDomElement=function(){return c}},UgcObjectCreator=function(b){function e(){v=!0;n()}function c(){v=!1;n()}function d(){O.moveMouse(b.mouse.x/b.viewportWidth,(b.mouse.y-F)/b.viewportHeight);n()}function f(H){x-=H.wheelDeltaY;n()}function h(H){switch(H.keyCode){case 16:w=!0}}function g(H){switch(H.keyCode){case 16:w=!1}}function n(){if(w){y+=b.mouse.x/b.screenWidth*
4-2;A+=-(b.mouse.y/b.screenHeight)*4+2;A=A>90?90:A<0?0:A}u.position.x=x*Math.sin(y*t)*Math.cos(A*t);u.position.y=x*Math.sin(A*t);u.position.z=x*Math.cos(y*t)*Math.cos(A*t);O.update(v);b.renderer.clear();b.renderer.render(m.scene,u,b.renderTarget,!0);b.renderer.render(O.getScene(),u,b.renderTarget);E.update(0,0,0)}var m=this,o=document.createElement("div"),t=Math.PI/180,u,w=!1,v=!1,x=1500,y=45,A=15;u=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,2E4);u.target.position.y=200;m.scene=new THREE.Scene;
m.scene.fog=new THREE.FogExp2(16777215,1.75E-4);m.scene.fog.color.setHSV(0.576,0.382,0.9);var B=new THREE.AmbientLight(2232576),D=new THREE.DirectionalLight(16772829),C=new THREE.DirectionalLight(16772829);B.color.setHSV(0,0,0.1);D.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);D.color.setHSV(0.08823529411764706,0,1);C.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);C.color.setHSV(0,0,0.8647058823529412);m.scene.addLight(B);m.scene.addLight(D);m.scene.addLight(C);
m.lensFlare=null;m.lensFlareRotate=null;B=new THREE.Vector3(0,0,-7500);initLensFlares(m,B,60,292);(new THREE.SceneLoader).load("files/models/dunes/D_tile_1.js",function(H){for(var N=0,ea=H.scene.objects.length;N<ea;N++){var p=H.scene.objects[N];if(p.visible){p.rotation.x=-90*Math.PI/180;p.position.y=-100;p.position.x=1750;p.scale.x=p.scale.y=p.scale.z=0.5;m.scene.addObject(p)}}n()});if(!b.renderer){var G=new THREE.WebGLRenderer;G.domElement.style.position="absolute";G.setSize(window.innerWidth,window.innerHeight);
G.setClearColor(m.scene.fog.color);G.sortObjects=!1;G.autoClear=!1;b.renderer=G}var F=0;b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.baseHeight);if(!b.renderTarget){B=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);B.minFilter=THREE.LinearFilter;B.magFilter=THREE.LinearFilter;b.renderTarget=B}var E=new PaintEffectDunes(b);E.init();var O=new VoxelPainter(u),
L=new UgcHandler;b.ugcSignals.object_createmode.add(function(){O.setMode(VoxelPainter.MODE_CREATE)});b.ugcSignals.object_erasemode.add(function(){O.setMode(VoxelPainter.MODE_ERASE)});b.ugcSignals.object_symmetrymode.add(function(H){O.setSymmetry(H)});b.ugcSignals.object_changecolor.add(function(H){O.setColor(H)});b.ugcSignals.object_changesize.add(function(H){O.setSize(H)});b.ugcSignals.submit.add(function(){var H=document.createElement("canvas");H.width=300;H.height=180;H.getContext("2d").drawImage(G.domElement,
0,0,H.width,H.height);var N=H.toDataURL();delete H;H={title:"Amorphous Building",email:"romepreview@gmail.com",category:"ground",data:O.getObject().getJSON(),thumbnail:N};L.submitUGO(H,N,function(ea){console.log(ea.id)})});this.getDomElement=function(){return o};this.show=function(){b.signals.mousedown.add(e);b.signals.mouseup.add(c);b.signals.mousemoved.add(d);b.signals.mousewheel.add(f);b.signals.keydown.add(h);b.signals.keyup.add(g);o.appendChild(b.renderer.domElement);b.renderer.setClearColor(m.scene.fog.color)};
this.hide=function(){b.signals.mousedown.remove(e);b.signals.mouseup.remove(c);b.signals.mousemoved.remove(d);b.signals.mousewheel.remove(f);b.signals.keydown.remove(h);b.signals.keyup.remove(g)};this.resize=function(H,N){u.aspect=H/N;u.updateProjectionMatrix();b.viewportWidth=H;b.viewportHeight=N;b.renderTarget.width=H;b.renderTarget.height=N;delete b.renderTarget.__webglFramebuffer;b.renderer.setSize(H,N);b.renderer.domElement.style.left="0px";b.renderer.domElement.style.top="0px"};this.update=
function(){}},UgcSoupCreator=function(){var b;domElement=document.createElement("div");b=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);b.position.z=6E3;this.getDomElement=function(){return(void 0).domElement};this.show=function(){};this.hide=function(){};this.resize=function(e,c){b.aspect=e/c;b.updateProjectionMatrix();(void 0).setSize(e,c)};this.update=function(){(void 0).clear();(void 0).render(void 0,b)}},VoxelPainter=function(b){function e(p){return Math.round(p/f)}function c(p){var ha=
e(p.x),fa=e(p.y);p=e(p.z);if(!o.getVoxel(ha,fa,p)){var oa=new THREE.Mesh(N[h],new THREE.MeshLambertMaterial({color:g}));oa.position.x=ha*f;oa.position.y=fa*f;oa.position.z=p*f;oa.matrixAutoUpdate=!1;oa.updateMatrix();oa.update();O.addObject(oa);o.addVoxel(ha,fa,p,g,oa)}}function d(p){var ha=e(p.position.x),fa=e(p.position.y),oa=e(p.position.z);o.deleteVoxel(ha,fa,oa);O.removeObject(p);v.removeObject(p)}var f=50,h=1,g=16777215,n=VoxelPainter.MODE_CREATE,m=!1,o=new UgcObject,t,u,w=[],v=new THREE.Scene,
x=new THREE.AmbientLight(2232576),y=new THREE.DirectionalLight(16772829),A=new THREE.DirectionalLight(16772829);x.color.setHSV(0,0,0.1);y.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);y.color.setHSV(0.08823529411764706,0,1);A.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);A.color.setHSV(0,0,0.8647058823529412);v.addLight(x);v.addLight(y);v.addLight(A);var B=new THREE.Scene;v.addObject(B);var D=new THREE.Object3D;D.visible=!1;x=new THREE.Plane(2E3,
2E3,16,16);y=new THREE.MeshBasicMaterial({color:0,opacity:0.2,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(x,y);_plane.doubleSided=!0;_plane.visible=D.visible;D.addChild(_plane);_plane=new THREE.Mesh(x,y);_plane.rotation.y=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=D.visible;D.addChild(_plane);D.matrixAutoUpdate=!1;B.addObject(D);var C,G,F,E;C=new THREE.Projector;G=new THREE.Vector3(0,0,0.5);E=new THREE.Ray(b.position,null);var O=new THREE.Scene;v.addObject(O);var L=new THREE.Mesh(new THREE.Plane(2E3,
2E3,40,40),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparency:!0,wireframe:!0}));L.position.x=-25;L.position.y=-25;L.position.z=-25;L.rotation.x=-90*Math.PI/180;O.addObject(L);var H=[],N=[],ea=[new THREE.MeshLambertMaterial({color:g,opacity:0.25,transparent:!0}),new THREE.MeshBasicMaterial({color:g,opacity:0.75,wireframe:!0,transparent:!0})];N[1]=new THREE.Cube(f,f,f);N[3]=new THREE.Cube(f*3,f*3,f*3,3,3,3);N[5]=new THREE.Cube(f*5,f*5,f*5,5,5,5);H[0]=new THREE.Mesh(N[h],ea);v.addObject(H[0]);
H[1]=new THREE.Mesh(N[h],ea);v.addObject(H[1]);this.setMode=function(p){n=p};this.setColor=function(p){g=p;ea[0].color.setHex(g);ea[1].color.setHex(g)};this.setSize=function(){};this.setSymmetry=function(p){m=p};this.moveMouse=function(p,ha){G.x=p*2-1;G.y=-ha*2+1;F=C.unprojectVector(G.clone(),b);E.direction=F.subSelf(b.position).normalize()};this.update=function(p){var ha;ha=0;for(var fa=w.length;ha<fa;ha++)w[ha].materials[0].opacity=1;switch(n){case VoxelPainter.MODE_CREATE:ha=E.intersectScene(O);
if(p){H[0].visible=!1;H[1].visible=!1;ha=E.intersectScene(B);if(t&&ha.length>0){ha=ha[0].point;p=u.matrixRotationWorld.multiplyVector3(t.centroid.clone()).addSelf(u.position);ha=p.distanceTo(ha);p=p.addSelf(u.matrixRotationWorld.multiplyVector3(t.normal.clone()).multiplyScalar(ha));c(p);if(m){p.x=-p.x;c(p)}}}else if(ha.length>0){u=ha[0].object;t=ha[0].face;D.position.copy(u.matrixRotationWorld.multiplyVector3(t.centroid.clone()).addSelf(u.position));D.position.addSelf(u.matrixRotationWorld.multiplyVector3(t.normal.clone()).multiplyScalar(f*
h*0.5));D.position.x=e(D.position.x)*f;D.position.y=e(D.position.y)*f;D.position.z=e(D.position.z)*f;D.updateMatrix();D.update();H[0].position.copy(D.position);H[0].visible=!0;if(m){H[1].position.copy(H[0].position);H[1].position.x=-H[1].position.x;H[1].visible=!0}}else{t=u=null;H[0].visible=!1;H[1].visible=!1}break;case VoxelPainter.MODE_ERASE:ha=E.intersectScene(O);if(ha.length>0&&ha[0].object!=L){u=ha[0].object;if(p){d(u);if(m){p=o.getVoxel(-e(u.position.x),e(u.position.y),e(u.position.z));p!==
undefined&&d(p.object)}}else{u.materials[0].opacity=0.5;w=[];w.push(u);if(m){p=o.getVoxel(-e(u.position.x),e(u.position.y),e(u.position.z));if(p!==undefined){p.object.materials[0].opacity=0.5;w.push(p.object)}}}}}};this.getScene=function(){return v};this.getObject=function(){return o}};VoxelPainter.MODE_CREATE="VoxelPainter.MODE_CREATE";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var emiBuyButtonUrl="http://widgets.platform.emi.com/widget/1.0/",emiBuyButtonUuids=["c9e456919b824bdeb2e3a326b122db43"],gaJsHost="https:"==document.location.protocol?"https://ssl.":"http://www.";document.write(unescape("%3Cscript src='"+gaJsHost+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));document.writeln(unescape("%3Cscript src='"+emiBuyButtonUrl+"js/emi_buy_button.js' type='text/javascript'%3E%3C/script%3E"));
var Footer=function(b,e){var c=e||"files/footer";this.id=Footer.multipleInstances;var d="rome_footer_buy_album-"+this.id;this.getDomElement=function(){return b};this.load=function(){EMIBuyButton&&(new EMIBuyButton({buttonID:"c9e456919b824bdeb2e3a326b122db43",buttonImageUrl:c+"/buy_button-trans.png",useVendorImages:!0})).replaceDiv(d);return this};window.addEventListener("load",this.load,!1);var f=['<div class="rome-footer">\n<div class="shout-out">\n  <ul>','    <li class="last"><a href="http://chromeexperiments.com/"><img src="'+
c+'/chrome-trans.png" alt="This is a Chrome Experiment" border="0" /></a></li>','    <li class="divider">&nbsp;</li>','    <li class="last"><a href="http://google.com/"><img src="'+c+'/google-trans.png" alt="Made With Friends From Google" border="0" /></a></li>','    <li class="clear">&nbsp;</li>\n  </ul>\n</div>\n<div class="navigation">\n  <ul class="primary">\n    <li class="first"><a href="http://ro.me/tech">Technology</a></li>\n    <li><a href="http://ro.me/credits">Credits</a></li>\n    <li><a href="http://ro.me/album">Rome Album</a></li>',
'    <li id="'+d+'" class="rome_footer_buy_album">','    </li>\n    <li class="last">Share</li>','    <li class="last icons"><a href="http://www.facebook.com/sharer.php?u=http://ro.me" target="_blank"><img src="'+c+'/fb-trans.png" alt="facebook" border="0"  /></a></li>','    <li class="last icons"><a href="http://twitter.com/share?text=\u201cROME\u201d&amp;url=http://ro.me" target="_blank"><img src="'+c+'/twitter-trans.png" alt="twitter" border="0" /></a></li>','    <li class="clear last">&nbsp;</li>\n  </ul>\n  <ul class="secondary">\n    <li class="first"><a href="http://ro.me/terms">Terms</a></li>\n    <li class="last"><a href="http://ro.me/privacy">Privacy</a></li>\n    <li class="clear last">&nbsp;</li>\n  </ul>\n</div>\n<div class="clear">&nbsp;</div>\n</div>\n</div>'].join("\n");
b.innerHTML=f;if(Footer.multipleInstances<1){f=document.createTextNode(".rome-footer * {\n  margin: 0;\n  padding: 0;\n}\n.rome-footer {\n  font: 500 10px/18px FuturaBT-Medium, Arial, sans-serif;\n  color: #434343;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n.rome-footer .shout-out {\n  float: left;\n  margin: 0 0 0 18px;\n}\n.rome-footer .navigation {\n  float: right;\n  margin: 20px 26px 0 0;\n  vertical-align: middle;\n}\n.rome-footer ul li {\n  height: 16px;\n  border-right: 1px solid #a0a0a0;\n  padding: 0 10px 0 10px;\n  width: auto;\n  float: left;\n  line-height: 18px;\n  list-style: none;\n}\n.rome-footer ul li.last,\n.rome-footer ul li.last li {\n  border: none;\n  padding: 0 0 0 10px;\n}\n.rome-footer .shout-out ul li {\n  margin: 0;\n  border: 0;\n}\n.rome-footer .shout-out li.divider {\n  margin: 15px 0 15px 15px;\n  height: 24px;\n  border-left: 1px solid #a0a0a0;\n  border-right: 0 !important;\n}\n.rome-footer a img {\n  border: 0;\n}\n.rome-footer .secondary a:link, .rome-footer .secondary a:visited {\n  color: #777;\n}\n.rome-footer a:link, .rome-footer a:visited,\n.rome-footer .secondary a:hover, .rome-footer .secondary a:active {\n  color: #434343;\n  text-decoration: none;\n}\n.rome-footer a:hover, .rome-footer a:active {\n  color: #000;\n}\n.emi_buy_button_link {\n  margin-top: 2px;\n  height: 8px;\n  line-height: 8px;\n  overflow: hidden;\n}\n.rome-footer .rome_footer_buy_album img {\n  display: block;\n  margin-top: 0;\n}\n.rome-footer .rome_footer_buy_album a:hover img {\n  margin-top: -8px;\n}\n.emi_vendor_menu.using_image a:hover img {\n  margin-top: 0;\n}\n.emi_vendor_menu.using_image {\n  margin-top: -145px;\n  margin-left: -11px;\n  padding: 10px;\n}\n.emi_vendor_menu.using_image * {\n  text-transform: none;\n}\n.emi_vendor_menu.using_image .emi_vendor_link {\n  margin-top: 5px;\n}\n.rome-footer .secondary {\n  margin: 10px 0 0 0;\n  float: right;\n}\n.clear {\n  clear: both;\n  display: block;\n  overflow: hidden;\n  visibility: hidden;\n  width: 0;\n  height: 0;\n}");
var h=document.getElementsByTagName("head")[0],g=document.createElement("style");if(g.stylesheet)g.styleSheet.cssText=f.nodeValue;else g.appendChild(f);h.appendChild(g)}Footer.multipleInstances++};Footer.multipleInstances=0;
var Shortcuts=function(b){function e(){var g=document.createElement("span");g.innerHTML=" ";h.appendChild(g)}function c(g,n){var m=document.createElement("span");m.style.cursor="pointer";m.style.padding="0.5em";m.style.marginRight="4px";m.style.background="rgba(255,255,255,0.15)";m.innerHTML=g;m.addEventListener("click",n,!1);h.appendChild(m)}function d(g,n){c(g,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(n,1)})}function f(g,n){c(g,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(n)})}var h=document.createElement("div");h.style.position="absolute";h.style.left="0px";h.style.top="0px";h.style.padding="0.5em";h.style.fontSize="10px";(function(g){c(g,function(){b.signals.showlauncher.dispatch()})})("Launcher");e();d("Intro",0);e();d("Transition to City",8);d("City",16);e();d("Transition to Prairie",24);d("Prairie",32);e();d("Transition to Dunes",40);d("Dunes",48);e();(function(g){c(g,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
e();f("Explore City","city");f("Explore Prairie","prairie");f("Explore Dunes","dunes");e();(function(g){c(g,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return h}};
(function(){function b(y){n&&n.hide();if(!y.__loaded){y.load();y.__loaded=!0}y.resize(window.innerWidth,window.innerHeight);y.show();n=y}function e(y){if(!y.gamma&&!y.beta){y.gamma=-(y.x*(180/Math.PI));y.beta=-(y.y*(180/Math.PI))}else if(y.alpha==null&&y.beta==null&&y.gamma==null){window.removeEventListener("deviceorientation",e,!1);window.removeEventListener("MozOrientation",e,!1)}var A=Math.abs(y.gamma)>4||Math.abs(y.beta)>4,B=A?y.gamma:0;A=A?y.beta:0;if(x!=B||v!=A){var D=Math.round(1.5*B)+h.mouse.x,
C=-Math.round(1.5*A)+h.mouse.y;Math.abs(D)>window.innerWidth&&(D=D<0?-window.innerWidth:window.innerWidth);Math.abs(C)>window.innerHeight&&(C=C<0?-window.innerHeight:window.innerHeight);h.mouse.x=D;h.mouse.y=C;x=B;v=A;h.signals.mousemoved.dispatch(y)}}function c(){requestAnimationFrame(c);d.clear();n.update();f.update()}var d,f,h,g=signals.Signal,n,m,o,t,u,w,v=0,x=0;d=new Logger;d.domElement.style.position="fixed";d.domElement.style.right="100px";d.domElement.style.top="0px";document.body.appendChild(d.domElement);
f=new Stats;f.domElement.style.position="fixed";f.domElement.style.right="0px";f.domElement.style.top="0px";document.body.appendChild(f.domElement);h={logger:d,mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,signals:{mousedown:new g,mouseup:new g,mousemoved:new g,mousewheel:new g,keydown:new g,keyup:new g,windowresized:new g,load:new g,showlauncher:new g,showfilm:new g,showrelauncher:new g,showexploration:new g,showugc:new g,loadBegin:new g,loadItemAdded:new g,loadItemCompleted:new g,
startfilm:new g,stopfilm:new g,startexploration:new g,initscenes:new g},worlds:{},soups:{},sequences:{},started:{city:!1,prairie:!1,dunes:!1}};m=new LauncherSection(h);document.body.appendChild(m.getDomElement());t=new RelauncherSection(h);document.body.appendChild(t.getDomElement());w=new UgcSection(h);document.body.appendChild(w.getDomElement());g=new Shortcuts(h);document.body.appendChild(g.getDomElement());h.signals.load.add(function(){h.signals.loadBegin.dispatch();o=new FilmSection(h);document.body.appendChild(o.getDomElement());
u=new ExplorationSection(h);document.body.appendChild(u.getDomElement());h.signals.showfilm.add(function(){b(o)});h.signals.showexploration.add(function(){b(u)})});h.signals.showlauncher.add(function(){b(m)});h.signals.showrelauncher.add(function(){b(t)});h.signals.showugc.add(function(){b(w)});document.addEventListener("mousedown",function(y){h.signals.mousedown.dispatch(y);y.preventDefault();y.stopPropagation()},!1);document.addEventListener("mouseup",function(y){h.signals.mouseup.dispatch(y);y.preventDefault();
y.stopPropagation()},!1);document.addEventListener("mousemove",function(y){h.mouse.x=y.clientX;h.mouse.y=y.clientY;h.signals.mousemoved.dispatch(y)},!1);document.addEventListener("mousewheel",function(y){h.signals.mousewheel.dispatch(y)},!1);document.addEventListener("keydown",function(y){h.signals.keydown.dispatch(y)},!1);document.addEventListener("keyup",function(y){h.signals.keyup.dispatch(y)},!1);window.addEventListener("deviceorientation",e,!1);window.addEventListener("MozOrientation",e,!1);
window.addEventListener("resize",function(){n.resize(window.innerWidth,window.innerHeight);h.screenWidth=window.innerWidth;h.screenHeight=window.innerHeight;h.signals.windowresized.dispatch()},!1);b(m);c()})();
