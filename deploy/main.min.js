function HandleErrors(b){function e(f){return navigator.userAgent.match(f)}var c=this,d=b||"/alternate";Trailer="<ul id = 'trailer'><li class = 'first'><a href = '#'>Watch Trailer</a></li><li><a href = 'http://ro.me/album'>Rome Album</a></li><li class = 'last'><a href = 'http://ro.me/tech'>The Technology</a></li><li class = 'clear'></li></ul>";this.MagicVariable="case";this.Errors=["<p>We are very sorry, but &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears that your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards. Although you are unable to participate in the full experience today, we expect this website to be up for a while, so please check back if you&#39;re on a different computer. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site and learn more about WebGL technology.</p>"+
Trailer,"<p>Apologies for the tech trouble. &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards. Although you are unable to participate in the full experience today, we expect this website to be up for a while, so please check back if you&#39;re on a different computer. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site and learn more about WebGL technology.<p>"+
Trailer,"<p>We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again. If you are unable to install a new web browser, you can try downloading the <a href = 'http://www.google.com/chromeframe'>Google Chrome Frame plugin</a> instead.</p>","<p>We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again.</p>",
"<p>We are sorry, but it appears that your browser does not support WebGL. &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. Please try launching this site again on a computer with up-to-date graphics drivers. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site, and learn more about WebGL technology.</p>"+Trailer,"<p>We&#39;re sorry, but &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. As a result, it may not work perfectly in your current browser. For the best viewing experience, you can <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and launch this site again, or go ahead and <a id = 'escape-from-warning' href = '#'>try it anyway</a>.</p>"];
this.getUrlVars=function(){for(var f=null,g=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),h=0;h<g.length;h++){var j=g[h].split("=");if(j.length==2){var m=j[0];j=j[1];if(m&&j){f==null&&(f={});f[m]=j}}}return f};this.checkForErrors=function(){var f;try{f=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(g){f=!1}f={webgl:f,conditions:[e(/[cC]hrome/),e(/[Ff]ire[Ff]ox\/[4-9]/),e(/MSIE [789]/)&&e(/[Ww]indows [Nn][Tt] [6789]\./),
e(/[Ss]afari/)&&e(/[Mm]ac [Oo][Ss] [Xx] 10\_[6789]/),e(/i[Pp]hone/)||e(/i[Pp]ad/)||e(/[Aa]ndroid/)],message:""};if(f.webgl){if(f=f.conditions[1]){var h;try{h="localStorage"in window&&window.localStorage!==null}catch(j){h=!1}f=h&&!localStorage.RomeError}if(f){window.addEventListener("load",function(){var m=document.createElement("div"),n=document.createElement("div"),p=document.createElement("div");p.setAttribute("id","rome-error");var t=document.createElement("style");t.innerHTML="a { color: #fff; }";
document.getElementsByTagName("head")[0].appendChild(t);m.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");n.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");p.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; font: color: #fff; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");
p.innerHTML=c.Errors[5];var v=function(){n.style.left=(window.innerWidth-400)/2+"px";n.style.top=window.innerHeight/2+"px"},u=function(){document.body.removeChild(m);document.body.removeChild(n);window.removeEventListener("resize",v,!1)};m.addEventListener("click",function(){u()},!1);window.addEventListener("resize",v,!1);n.appendChild(p);document.body.appendChild(m);document.body.appendChild(n);document.getElementById("escape-from-warning").addEventListener("click",function(w){w.preventDefault();
u()},!1)},!1);localStorage.RomeError=!0}}else for(h=0;h<f.conditions.length;h++)if(f.conditions[h]){window.location=d+"?"+this.MagicVariable+"="+h;break}}}var romeErrors=new HandleErrors,variables=romeErrors.getUrlVars();if(variables)variables[romeErrors.MagicVariable]&&window.addEventListener("load",function(){var b=variables[romeErrors.MagicVariable];document.getElementById("error").innerHTML=romeErrors.Errors[b]},!1);else romeErrors.checkForErrors();
var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b(U,Y,$){var na,ma,ra;for(ma=0;ma<30;ma++)for(na=0;na<73;na++){ra=(na+ma*74)*4;U[ra]=U[ra+4];U[ra+1]=U[ra+5];U[ra+2]=U[ra+6]}for(ma=0;ma<30;ma++){ra=(73+ma*74)*4;if(ma<Y){U[ra]=ga[$].bg.r;U[ra+1]=ga[$].bg.g;U[ra+2]=ga[$].bg.b}else{U[ra]=ga[$].fg.r;U[ra+1]=ga[$].fg.g;U[ra+2]=ga[$].fg.b}}}var e=0,c=2,d,f=0,g=(new Date).getTime(),h=g,j=g,m=0,n=1E3,p=0,t,v,u,w,y,z=0,A=1E3,E=0,C,D,B,I,N=0,J=1E3,K=0,L,aa,o,ja,ga={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,
b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};d=document.createElement("div");d.style.cursor="pointer";d.style.width="80px";d.style.opacity="0.9";d.style.zIndex="10001";d.addEventListener("click",function(){e++;e==c&&(e=0);t.style.display="none";C.style.display="none";L.style.display="none";switch(e){case 0:t.style.display="block";break;case 1:C.style.display="block";break;case 2:L.style.display="block"}},!1);t=document.createElement("div");t.style.backgroundColor="rgb("+
Math.floor(ga.fps.bg.r/2)+","+Math.floor(ga.fps.bg.g/2)+","+Math.floor(ga.fps.bg.b/2)+")";t.style.padding="2px 0px 3px 0px";d.appendChild(t);v=document.createElement("div");v.style.fontFamily="Helvetica, Arial, sans-serif";v.style.textAlign="left";v.style.fontSize="9px";v.style.color="rgb("+ga.fps.fg.r+","+ga.fps.fg.g+","+ga.fps.fg.b+")";v.style.margin="0px 0px 1px 3px";v.innerHTML='<span style="font-weight:bold">FPS</span>';t.appendChild(v);u=document.createElement("canvas");u.width=74;u.height=
30;u.style.display="block";u.style.marginLeft="3px";t.appendChild(u);w=u.getContext("2d");w.fillStyle="rgb("+ga.fps.bg.r+","+ga.fps.bg.g+","+ga.fps.bg.b+")";w.fillRect(0,0,u.width,u.height);y=w.getImageData(0,0,u.width,u.height);C=document.createElement("div");C.style.backgroundColor="rgb("+Math.floor(ga.ms.bg.r/2)+","+Math.floor(ga.ms.bg.g/2)+","+Math.floor(ga.ms.bg.b/2)+")";C.style.padding="2px 0px 3px 0px";C.style.display="none";d.appendChild(C);D=document.createElement("div");D.style.fontFamily=
"Helvetica, Arial, sans-serif";D.style.textAlign="left";D.style.fontSize="9px";D.style.color="rgb("+ga.ms.fg.r+","+ga.ms.fg.g+","+ga.ms.fg.b+")";D.style.margin="0px 0px 1px 3px";D.innerHTML='<span style="font-weight:bold">MS</span>';C.appendChild(D);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";C.appendChild(u);B=u.getContext("2d");B.fillStyle="rgb("+ga.ms.bg.r+","+ga.ms.bg.g+","+ga.ms.bg.b+")";B.fillRect(0,0,u.width,u.height);I=B.getImageData(0,
0,u.width,u.height);try{webkitPerformance&&webkitPerformance.memory.totalJSHeapSize&&(c=3)}catch(qa){}L=document.createElement("div");L.style.backgroundColor="rgb("+Math.floor(ga.mem.bg.r/2)+","+Math.floor(ga.mem.bg.g/2)+","+Math.floor(ga.mem.bg.b/2)+")";L.style.padding="2px 0px 3px 0px";L.style.display="none";d.appendChild(L);aa=document.createElement("div");aa.style.fontFamily="Helvetica, Arial, sans-serif";aa.style.textAlign="left";aa.style.fontSize="9px";aa.style.color="rgb("+ga.mem.fg.r+","+
ga.mem.fg.g+","+ga.mem.fg.b+")";aa.style.margin="0px 0px 1px 3px";aa.innerHTML='<span style="font-weight:bold">MEM</span>';L.appendChild(aa);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";L.appendChild(u);o=u.getContext("2d");o.fillStyle="#301010";o.fillRect(0,0,u.width,u.height);ja=o.getImageData(0,0,u.width,u.height);return{domElement:d,update:function(){f++;g=(new Date).getTime();z=g-h;A=Math.min(A,z);E=Math.max(E,z);b(I.data,Math.min(30,
30-z/200*30),"ms");D.innerHTML='<span style="font-weight:bold">'+z+" MS</span> ("+A+"-"+E+")";B.putImageData(I,0,0);h=g;if(g>j+1E3){m=Math.round(f*1E3/(g-j));n=Math.min(n,m);p=Math.max(p,m);b(y.data,Math.min(30,30-m/100*30),"fps");v.innerHTML='<span style="font-weight:bold">'+m+" FPS</span> ("+n+"-"+p+")";w.putImageData(y,0,0);if(c==3){N=webkitPerformance.memory.usedJSHeapSize*9.54E-7;J=Math.min(J,N);K=Math.max(K,N);b(ja.data,Math.min(30,30-N/2),"mem");aa.innerHTML='<span style="font-weight:bold">'+
Math.round(N)+" MEM</span> ("+Math.round(J)+"-"+Math.round(K)+")";o.putImageData(ja,0,0)}j=g;f=0}}}},GUI=function(){var b=this,e=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
e.appendChild(c);var d=[],f=[],g=!0,h,j,m=0;b=this;var n=!1,p=280,t=!1,v,u,w=0,y;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=p+"px";var z=document.createElement("div");z.setAttribute("class","guidat-controllers");z.addEventListener("DOMMouseScroll",function(Y){var $=this.scrollTop;if(Y.wheelDelta)$+=Y.wheelDelta;else Y.detail&&($+=Y.detail);Y.preventDefault&&Y.preventDefault();Y.returnValue=!1;z.scrollTop=$},!1);z.style.height=
"0px";var A=document.createElement("a");A.setAttribute("class","guidat-toggle");A.setAttribute("href","#");A.innerHTML="Show Controls";var E=!1,C=0,D=!1,B,I,N,J,K=function(Y){I=B;J=N;B=Y.pageY;N=Y.pageX;Y=B-I;if(!n)if(Y>0){n=!0;m=v=1;A.innerHTML=u||"Hide Controls"}else return;var $=J-N;if(Y>0&&m>j){var na=GUI.map(m,j,j+100,1,0);Y*=na}E=!0;C+=Y;dragDisplacementX+=$;v+=Y;p+=$;m+=Y;z.style.height=v+"px";p=GUI.constrain(p,240,500);b.domElement.style.width=p+"px";ja()};A.addEventListener("mousedown",function(Y){I=
B=Y.pageY;J=N=Y.pageX;D=!0;Y.preventDefault();dragDisplacementX=C=0;document.addEventListener("mousemove",K,!1);return!1},!1);A.addEventListener("click",function(Y){Y.preventDefault();return!1},!1);document.addEventListener("mouseup",function(Y){if(D&&!E){b.toggle();b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(D&&E){if(dragDisplacementX==0){b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(v>j){clearTimeout(y);
v=w=j;qa()}else if(z.children.length>=1){var $=z.children[0].offsetHeight;clearTimeout(y);w=Math.round(m/$)*$-1;if(w<=0){b.hide();v=$*2}else{v=w;qa()}}}document.removeEventListener("mousemove",K,!1);Y.preventDefault();E=!1;D=!1;return!1},!1);this.domElement.appendChild(z);this.domElement.appendChild(A);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var L=function(){h=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(Y){if(g=Y)f.length>0&&L();else clearInterval(h)});this.__defineGetter__("autoListen",function(){return g});this.listenTo=function(Y){f.length==0&&L();f.push(Y)};this.unlistenTo=function(Y){for(var $=0;$<f.length;$++)f[$]==Y&&f.splice($,1);f.length<=0&&clearInterval(h)};this.listen=function(Y){Y=Y||f;for(var $ in Y)Y[$].updateDisplay()};this.listenAll=function(){this.listen(d)};
this.autoListen=!0;var aa=function(Y,$){for(var na in d)if(d[na].object==Y&&d[na].propertyName==$)return!0;return!1},o=function(Y,$){function na(){return Y.apply(this,$)}na.prototype=Y.prototype;return new na};this.add=function(){var Y=arguments[0],$=arguments[1];aa(Y,$);var na=Y[$];if(na==undefined)GUI.error(Y+' either has no property "'+$+'", or the property is inaccessible.');else{Y=typeof na;na=ga[Y];if(na==undefined)GUI.error('Cannot create controller for data type "'+Y+'"');else{for(var ma=
[this],ra=0;ra<arguments.length;ra++)ma.push(arguments[ra]);if(na=o(na,ma)){z.appendChild(na.domElement);d.push(na);GUI.allControllers.push(na);if(Y!="function"&&GUI.saveIndex<GUI.savedValues.length){na.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}ja();t||(v=j);return na}else GUI.error('Error creating controller for "'+$+'".')}}};var ja=function(){j=0;for(var Y in d)j+=d[Y].domElement.offsetHeight;z.style.overflowY=j-1>v?"auto":"hidden"},ga={number:GUI.NumberController,string:GUI.StringController,
"boolean":GUI.BooleanController,"function":GUI.FunctionController};aa=function(Y,$){for(var na in d)if(d[na].object==Y&&d[na].propertyName==$)return!0;return!1};o=function(Y,$){function na(){return Y.apply(this,$)}na.prototype=Y.prototype;return new na};this.reset=function(){};this.toggle=function(){n?this.hide():this.show()};this.show=function(){A.innerHTML=u||"Hide Controls";w=v;clearTimeout(y);qa();n=!0};this.hide=function(){A.innerHTML=u||"Show Controls";w=0;clearTimeout(y);qa();n=!1};this.name=
function(Y){u=Y;A.innerHTML=Y};this.appearanceVars=function(){return[n,p,v,z.scrollTop]};var qa=function(){m+=(w-m)*0.6;if(Math.abs(m-w)<1)m=w;else y=setTimeout(qa,1E3/30);z.style.height=Math.round(m)+"px";ja()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){p=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=p+"px";v=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);t=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){m=v;var U=GUI.savedAppearanceVars[GUI.guiIndex][3];
setTimeout(function(){z.scrollTop=U},0);if(GUI.scrollTop>-1)document.body.scrollTop=GUI.scrollTop;w=v;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var e=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<e;c++){var d=b.splice(2,4);GUI.savedAppearanceVars.push(d)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var e in GUI.allGuis)for(var c=GUI.allGuis[e].appearanceVars(),d=0;d<c.length;d++)b.push(c[d]);for(e in GUI.allControllers)if(GUI.allControllers[e].type!="function"){c=GUI.allControllers[e].getValue();GUI.allControllers[e].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var e,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){e=c[d].split("=");if(e!=undefined&&e[0]==b)return e[1]}return null};
GUI.replaceGetVar=function(b,e){for(var c,d=window.location.href,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<f.length;g++){c=f[g].split("=");if(c!=undefined&&c[0]==b)return d.replace(c[1],e)}if(window.location.href.indexOf("?")!=-1)return d+"&"+b+"="+e;return d+"?"+b+"="+e};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,e,c,d,f){return d+(f-d)*((b-e)/(c-e))};GUI.constrain=function(b,e,c){if(b<e)b=e;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,e){var c=Math.pow(10,e);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,e,c,d,f){var g=!1,h=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(m){this.fg.style.width=GUI.map(m,e,c,0,100)+"%"});var j=function(m){if(g){var n;n=h.domElement;var p=curtop=0;if(n.offsetParent){do{p+=n.offsetLeft;curtop+=n.offsetTop}while(n=n.offsetParent);
n=[p,curtop]}else n=void 0;m=GUI.map(m.pageX,n[0],n[0]+h.domElement.offsetWidth,e,c);m=Math.round(m/d)*d;b.setValue(m)}};this.domElement.addEventListener("mousedown",function(m){g=!0;h.domElement.setAttribute("class","guidat-slider-bg active");h.fg.setAttribute("class","guidat-slider-fg active");j(m)},!1);document.addEventListener("mouseup",function(){h.domElement.setAttribute("class","guidat-slider-bg");h.fg.setAttribute("class","guidat-slider-fg");g=!1},!1);document.addEventListener("mousemove",
j,!1);this.value=f};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var e=document.createElement("input"),c=this.getValue();e.setAttribute("value",c);e.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){e.focus();e.select()},!1);e.addEventListener("keyup",function(){b.setValue(e.value)},!1);this.updateDisplay=function(){e.value=b.getValue()};this.domElement.appendChild(e)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,e=!1,c=!1,d=py=0,f=arguments[3],g=arguments[4],h=arguments[5];h||(h=f!=undefined&&g!=undefined?(g-f)*0.01:1);var j=document.createElement("input");j.setAttribute("id",this.propertyName);j.setAttribute("type","text");j.setAttribute("value",this.getValue());h&&j.setAttribute("step",h);this.domElement.appendChild(j);var m;if(f!=undefined&&g!=undefined){m=new GUI.Slider(this,f,g,h,this.getValue());this.domElement.appendChild(m.domElement)}j.addEventListener("blur",
function(){var p=parseFloat(this.value);if(isNaN(p))this.value=b.getValue();else b.updateDisplay()},!1);j.addEventListener("mousewheel",function(p){p.preventDefault();b.setValue(b.getValue()+Math.abs(p.wheelDeltaY)/p.wheelDeltaY*h);return!1},!1);j.addEventListener("mousedown",function(p){py=d=p.pageY;c=!0;document.addEventListener("mousemove",n,!1)},!1);j.addEventListener("keydown",function(p){switch(p.keyCode){case 38:p=b.getValue()+h;b.setValue(p);break;case 40:p=b.getValue()-h;b.setValue(p)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",n,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(j);if(c&&!e){j.focus();j.select()}e=!1;c=!1},!1);var n=function(p){e=!0;p.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(j);py=d;d=p.pageY;p=py-d;p=b.getValue()+p*h;b.setValue(p);return!1};this.setValue=function(p){p=parseFloat(p);if(f!=undefined&&p<=f)p=f;else g!=undefined&&p>=g&&(p=g);return GUI.Controller.prototype.setValue.call(this,
p)};this.updateDisplay=function(){j.value=GUI.roundToDecimal(b.getValue(),4);if(m)m.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,e=document.createElement("input");e.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){e.checked=!e.checked;c.preventDefault();b.setValue(e.checked)},!1);e.addEventListener("mouseup",function(){e.checked=!e.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(e);this.updateDisplay=function(){e.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(d){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);
var signals=function(){function b(c,d,f,g,h){this._listener=d;this._isOnce=f;this.context=g;this._signal=c;this._priority=h||0}var e={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var d;if(this._isEnabled){d=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return d},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};e.Signal=function(){this._bindings=[]};e.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,d,f,g){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var h=this._indexOfListener(c);if(h!==-1){c=this._bindings[h];if(c.isOnce()!==d)throw Error("You cannot add"+(d?"":"Once")+"() then add"+(!d?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,d,f,g);this._addBinding(c)}return c},_addBinding:function(c){var d=this._bindings.length;do--d;while(this._bindings[d]&&c._priority<=this._bindings[d]._priority);this._bindings.splice(d+1,0,c)},_indexOfListener:function(c){for(var d=this._bindings.length;d--;)if(this._bindings[d]._listener===
c)return d;return-1},add:function(c,d,f){return this._registerListener(c,!1,d,f)},addOnce:function(c,d,f){return this._registerListener(c,!0,d,f)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var d=this._indexOfListener(c);if(d!==-1){this._bindings[d]._destroy();this._bindings.splice(d,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),d=this._bindings.slice(),f=this._bindings.length;this._shouldPropagate=!0;do f--;while(d[f]&&this._shouldPropagate&&d[f].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return e}(),TWEEN=TWEEN||function(){var b,e,c,d=[];this.add=function(f){d.push(f)};this.remove=function(f){b=d.indexOf(f);b!==-1&&d.splice(b,1)};this.update=function(){b=0;e=d.length;for(c=(new Date).getTime();b<e;)if(d[b].update(c))b++;else{d.splice(b,1);e--}};return this}();
TWEEN.Tween=function(b){var e={},c={},d={},f=1E3,g=0,h=null,j=TWEEN.Easing.Linear.EaseNone,m=null,n=null,p=null;this.to=function(t,v){v!==null&&(f=v);for(var u in t)b[u]!==null&&(d[u]=t[u]);return this};this.start=function(){TWEEN.add(this);h=(new Date).getTime()+g;for(var t in d)if(b[t]!==null){e[t]=b[t];c[t]=d[t]-b[t]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(t){g=t;return this};this.easing=function(t){j=t;return this};this.chain=function(t){m=t};this.onUpdate=
function(t){n=t;return this};this.onComplete=function(t){p=t;return this};this.update=function(t){var v,u;if(t<h)return!0;t=(t-h)/f;t=t>1?1:t;u=j(t);for(v in c)b[v]=e[v]+c[v]*u;n!==null&&n.call(b,u);if(t==1){p!==null&&p.call(b);m!==null&&m.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d))};
TWEEN.Easing.Elastic.EaseOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-e)*2*Math.PI/d)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-e)*2*Math.PI/d)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,e,c){this.r=b;this.g=e;this.b=c;this.updateHex()},setHSV:function(b,e,c){var d,f,g,h,j,m;if(c==0)d=f=g=0;else{h=Math.floor(b*6);j=b*6-h;b=c*(1-e);m=c*(1-e*j);e=c*(1-e*(1-j));switch(h){case 1:d=m;f=c;g=b;break;case 2:d=b;f=c;g=e;break;case 3:d=b;f=m;g=c;break;case 4:d=e;f=b;g=c;break;case 5:d=c;f=b;g=m;break;case 6:case 0:d=c;f=e;g=b}}this.setRGB(d,
f,g)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,e){this.set(b||0,e||0)};
THREE.Vector2.prototype={set:function(b,e){this.x=b;this.y=e;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,e,c){this.set(b||0,e||0,c||0)};
THREE.Vector3.prototype={set:function(b,e,c){this.x=b;this.y=e;this.z=c;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
e){this.set(b.y*e.z-b.z*e.y,b.z*e.x-b.x*e.z,b.x*e.y-b.y*e.x);return this},crossSelf:function(b){var e=this.x,c=this.y,d=this.z;this.set(c*b.z-d*b.y,d*b.x-e*b.z,e*b.y-c*b.x);return this},multiply:function(b,e){this.set(b.x*e.x,b.y*e.y,b.z*e.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var e=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return e*e+c*c+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var e=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(e)>1.0E-5){this.x=Math.atan2(-b.n23/e,b.n33/e);this.z=Math.atan2(-b.n12/e,b.n11/e)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,e,c,d){this.set(b||0,e||0,c||0,d||1)};
THREE.Vector4.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z,b.w+e.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z,b.w-e.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,e){this.set(this.x+(b.x-this.x)*e,this.y+(b.y-this.y)*e,this.z+(b.z-this.z)*e,this.w+(b.w-this.w)*e)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,e){this.origin=b||new THREE.Vector3;this.direction=e||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){var e,c,d=b.objects,f=[];b=0;for(e=d.length;b<e;b++){c=d[b];c instanceof THREE.Mesh&&(f=f.concat(this.intersectObject(c)))}f.sort(function(g,h){return g.distance-h.distance});return f},intersectObject:function(b){function e(z,A,E,C){C=C.clone().subSelf(A);E=E.clone().subSelf(A);var D=z.clone().subSelf(A);z=C.dot(C);A=C.dot(E);C=C.dot(D);var B=E.dot(E);E=E.dot(D);D=1/(z*B-A*A);B=(B*C-A*E)*D;z=(z*E-A*C)*D;return B>0&&z>0&&B+z<1}var c,d,f,g,h,j,m,n,p,t,
v,u=b.geometry,w=u.vertices,y=[];c=0;for(d=u.faces.length;c<d;c++){f=u.faces[c];t=this.origin.clone();v=this.direction.clone();m=b.matrixWorld;g=m.multiplyVector3(w[f.a].position.clone());h=m.multiplyVector3(w[f.b].position.clone());j=m.multiplyVector3(w[f.c].position.clone());m=f instanceof THREE.Face4?m.multiplyVector3(w[f.d].position.clone()):null;n=b.matrixRotationWorld.multiplyVector3(f.normal.clone());p=v.dot(n);if(b.doubleSided||(b.flipSided?p>0:p<0)){n=n.dot((new THREE.Vector3).sub(g,t))/
p;t=t.addSelf(v.multiplyScalar(n));if(f instanceof THREE.Face3){if(e(t,g,h,j)){f={distance:this.origin.distanceTo(t),point:t,face:f,object:b};y.push(f)}}else if(f instanceof THREE.Face4&&(e(t,g,h,m)||e(t,h,j,m))){f={distance:this.origin.distanceTo(t),point:t,face:f,object:b};y.push(f)}}}return y}};
THREE.Rectangle=function(){function b(){g=d-e;h=f-c}var e,c,d,f,g,h,j=!0;this.getX=function(){return e};this.getY=function(){return c};this.getWidth=function(){return g};this.getHeight=function(){return h};this.getLeft=function(){return e};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return f};this.set=function(m,n,p,t){j=!1;e=m;c=n;d=p;f=t;b()};this.addPoint=function(m,n){if(j){j=!1;e=m;c=n;d=m;f=n}else{e=e<m?e:m;c=c<n?c:n;d=d>m?d:m;f=f>n?f:n}b()};
this.add3Points=function(m,n,p,t,v,u){if(j){j=!1;e=m<p?m<v?m:v:p<v?p:v;c=n<t?n<u?n:u:t<u?t:u;d=m>p?m>v?m:v:p>v?p:v;f=n>t?n>u?n:u:t>u?t:u}else{e=m<p?m<v?m<e?m:e:v<e?v:e:p<v?p<e?p:e:v<e?v:e;c=n<t?n<u?n<c?n:c:u<c?u:c:t<u?t<c?t:c:u<c?u:c;d=m>p?m>v?m>d?m:d:v>d?v:d:p>v?p>d?p:d:v>d?v:d;f=n>t?n>u?n>f?n:f:u>f?u:f:t>u?t>f?t:f:u>f?u:f}b()};this.addRectangle=function(m){if(j){j=!1;e=m.getLeft();c=m.getTop();d=m.getRight();f=m.getBottom()}else{e=e<m.getLeft()?e:m.getLeft();c=c<m.getTop()?c:m.getTop();d=d>m.getRight()?
d:m.getRight();f=f>m.getBottom()?f:m.getBottom()}b()};this.inflate=function(m){e-=m;c-=m;d+=m;f+=m;b()};this.minSelf=function(m){e=e>m.getLeft()?e:m.getLeft();c=c>m.getTop()?c:m.getTop();d=d<m.getRight()?d:m.getRight();f=f<m.getBottom()?f:m.getBottom();b()};this.instersects=function(m){return Math.min(d,m.getRight())-Math.max(e,m.getLeft())>=0&&Math.min(f,m.getBottom())-Math.max(c,m.getTop())>=0};this.empty=function(){j=!0;f=d=c=e=0;b()};this.isEmpty=function(){return j}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,e=this.m;b=e[1];e[1]=e[3];e[3]=b;b=e[2];e[2]=e[6];e[6]=b;b=e[5];e[5]=e[7];e[7]=b;return this},transposeIntoArray:function(b){var e=this.m;b[0]=e[0];b[1]=e[3];b[2]=e[6];b[3]=e[1];b[4]=e[4];b[5]=e[7];b[6]=e[2];b[7]=e[5];b[8]=e[8];return this}};
THREE.Matrix4=function(b,e,c,d,f,g,h,j,m,n,p,t,v,u,w,y){this.set(b||1,e||0,c||0,d||0,f||0,g||1,h||0,j||0,m||0,n||0,p||1,t||0,v||0,u||0,w||0,y||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,e,c,d,f,g,h,j,m,n,p,t,v,u,w,y){this.n11=b;this.n12=e;this.n13=c;this.n14=d;this.n21=f;this.n22=g;this.n23=h;this.n24=j;this.n31=m;this.n32=n;this.n33=p;this.n34=t;this.n41=v;this.n42=u;this.n43=w;this.n44=y;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,e,c){var d=THREE.Matrix4.__v1,
f=THREE.Matrix4.__v2,g=THREE.Matrix4.__v3;g.sub(b,e).normalize();if(g.length()===0)g.z=1;d.cross(c,g).normalize();if(d.length()===0){g.x+=1.0E-4;d.cross(c,g).normalize()}f.cross(g,d).normalize();this.n11=d.x;this.n12=f.x;this.n13=g.x;this.n21=d.y;this.n22=f.y;this.n23=g.y;this.n31=d.z;this.n32=f.z;this.n33=g.z;return this},multiplyVector3:function(b){var e=b.x,c=b.y,d=b.z,f=1/(this.n41*e+this.n42*c+this.n43*d+this.n44);b.x=(this.n11*e+this.n12*c+this.n13*d+this.n14)*f;b.y=(this.n21*e+this.n22*c+this.n23*
d+this.n24)*f;b.z=(this.n31*e+this.n32*c+this.n33*d+this.n34)*f;return b},multiplyVector4:function(b){var e=b.x,c=b.y,d=b.z,f=b.w;b.x=this.n11*e+this.n12*c+this.n13*d+this.n14*f;b.y=this.n21*e+this.n22*c+this.n23*d+this.n24*f;b.z=this.n31*e+this.n32*c+this.n33*d+this.n34*f;b.w=this.n41*e+this.n42*c+this.n43*d+this.n44*f;return b},rotateAxis:function(b){var e=b.x,c=b.y,d=b.z;b.x=e*this.n11+c*this.n12+d*this.n13;b.y=e*this.n21+c*this.n22+d*this.n23;b.z=e*this.n31+c*this.n32+d*this.n33;b.normalize();
return b},crossVector:function(b){var e=new THREE.Vector4;e.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;e.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;e.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;e.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return e},multiply:function(b,e){var c=b.n11,d=b.n12,f=b.n13,g=b.n14,h=b.n21,j=b.n22,m=b.n23,n=b.n24,p=b.n31,t=b.n32,v=b.n33,u=b.n34,w=b.n41,y=b.n42,z=b.n43,A=b.n44,E=e.n11,C=e.n12,D=e.n13,B=e.n14,I=e.n21,N=e.n22,
J=e.n23,K=e.n24,L=e.n31,aa=e.n32,o=e.n33,ja=e.n34;this.n11=c*E+d*I+f*L;this.n12=c*C+d*N+f*aa;this.n13=c*D+d*J+f*o;this.n14=c*B+d*K+f*ja+g;this.n21=h*E+j*I+m*L;this.n22=h*C+j*N+m*aa;this.n23=h*D+j*J+m*o;this.n24=h*B+j*K+m*ja+n;this.n31=p*E+t*I+v*L;this.n32=p*C+t*N+v*aa;this.n33=p*D+t*J+v*o;this.n34=p*B+t*K+v*ja+u;this.n41=w*E+y*I+z*L;this.n42=w*C+y*N+z*aa;this.n43=w*D+y*J+z*o;this.n44=w*B+y*K+z*ja+A;return this},multiplyToArray:function(b,e,c){this.multiply(b,e);c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;
c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=
this.n11,e=this.n12,c=this.n13,d=this.n14,f=this.n21,g=this.n22,h=this.n23,j=this.n24,m=this.n31,n=this.n32,p=this.n33,t=this.n34,v=this.n41,u=this.n42,w=this.n43,y=this.n44;return d*h*n*v-c*j*n*v-d*g*p*v+e*j*p*v+c*g*t*v-e*h*t*v-d*h*m*u+c*j*m*u+d*f*p*u-b*j*p*u-c*f*t*u+b*h*t*u+d*g*m*w-e*j*m*w-d*f*n*w+b*j*n*w+e*f*t*w-b*g*t*w-c*g*m*y+e*h*m*y+c*f*n*y-b*h*n*y-e*f*p*y+b*g*p*y},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=
this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;
this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=
this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,e){b[e]=this.n11;b[e+1]=this.n21;b[e+2]=this.n31;b[e+3]=this.n41;b[e+4]=this.n12;b[e+5]=this.n22;b[e+6]=this.n32;b[e+7]=this.n42;b[e+8]=this.n13;b[e+9]=this.n23;b[e+10]=this.n33;b[e+11]=this.n43;b[e+12]=this.n14;b[e+13]=this.n24;b[e+14]=this.n34;b[e+15]=this.n44;return b},setTranslation:function(b,e,c){this.set(1,0,0,b,0,1,0,e,0,0,1,c,0,0,0,1);return this},setScale:function(b,
e,c){this.set(b,0,0,0,0,e,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,e,-b,0,0,b,e,0,0,0,0,1);return this},setRotationY:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,0,b,0,0,1,0,0,-b,0,e,0,0,0,0,1);return this},setRotationZ:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,-b,0,0,b,e,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,e){var c=Math.cos(e),d=Math.sin(e),f=1-c,g=b.x,h=b.y,j=b.z,m=f*g,n=f*h;this.set(m*
g+c,m*h-d*j,m*j+d*h,0,m*h+d*j,n*h+c,n*j-d*g,0,m*j-d*h,n*j+d*g,f*j*j+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;
this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var e=b.x,c=b.y,d=b.z;b=Math.cos(e);e=Math.sin(e);var f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=b*c,j=e*c;this.n11=f*g;this.n12=-f*d;this.n13=c;this.n21=j*g+b*d;this.n22=-j*d+b*g;this.n23=-e*f;this.n31=-h*g+e*d;this.n32=h*d+e*g;this.n33=b*f;return this},
setRotationFromQuaternion:function(b){var e=b.x,c=b.y,d=b.z,f=b.w,g=e+e,h=c+c,j=d+d;b=e*g;var m=e*h;e*=j;var n=c*h;c*=j;d*=j;g*=f;h*=f;f*=j;this.n11=1-(n+d);this.n12=m-f;this.n13=e+h;this.n21=m+f;this.n22=1-(b+d);this.n23=c-g;this.n31=e-h;this.n32=c+g;this.n33=1-(b+n);return this},scale:function(b){var e=b.x,c=b.y;b=b.z;this.n11*=e;this.n12*=c;this.n13*=b;this.n21*=e;this.n22*=c;this.n23*=b;this.n31*=e;this.n32*=c;this.n33*=b;this.n41*=e;this.n42*=c;this.n43*=b;return this},extractPosition:function(b){this.n14=
b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,e){var c=1/e.x,d=1/e.y,f=1/e.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*d;this.n22=b.n22*d;this.n32=b.n32*d;this.n13=b.n13*f;this.n23=b.n23*f;this.n33=b.n33*f}};
THREE.Matrix4.makeInvert=function(b,e){var c=b.n11,d=b.n12,f=b.n13,g=b.n14,h=b.n21,j=b.n22,m=b.n23,n=b.n24,p=b.n31,t=b.n32,v=b.n33,u=b.n34,w=b.n41,y=b.n42,z=b.n43,A=b.n44;e===undefined&&(e=new THREE.Matrix4);e.n11=m*u*y-n*v*y+n*t*z-j*u*z-m*t*A+j*v*A;e.n12=g*v*y-f*u*y-g*t*z+d*u*z+f*t*A-d*v*A;e.n13=f*n*y-g*m*y+g*j*z-d*n*z-f*j*A+d*m*A;e.n14=g*m*t-f*n*t-g*j*v+d*n*v+f*j*u-d*m*u;e.n21=n*v*w-m*u*w-n*p*z+h*u*z+m*p*A-h*v*A;e.n22=f*u*w-g*v*w+g*p*z-c*u*z-f*p*A+c*v*A;e.n23=g*m*w-f*n*w-g*h*z+c*n*z+f*h*A-c*m*A;
e.n24=f*n*p-g*m*p+g*h*v-c*n*v-f*h*u+c*m*u;e.n31=j*u*w-n*t*w+n*p*y-h*u*y-j*p*A+h*t*A;e.n32=g*t*w-d*u*w-g*p*y+c*u*y+d*p*A-c*t*A;e.n33=f*n*w-g*j*w+g*h*y-c*n*y-d*h*A+c*j*A;e.n34=g*j*p-d*n*p-g*h*t+c*n*t+d*h*u-c*j*u;e.n41=m*t*w-j*v*w-m*p*y+h*v*y+j*p*z-h*t*z;e.n42=d*v*w-f*t*w+f*p*y-c*v*y-d*p*z+c*t*z;e.n43=f*j*w-d*m*w-f*h*y+c*m*y+d*h*z-c*j*z;e.n44=d*m*p-f*j*p+f*h*t-c*m*t-d*h*v+c*j*v;e.multiplyScalar(1/b.determinant());return e};
THREE.Matrix4.makeInvert3x3=function(b){var e=b.m33,c=e.m,d=b.n33*b.n22-b.n32*b.n23,f=-b.n33*b.n21+b.n31*b.n23,g=b.n32*b.n21-b.n31*b.n22,h=-b.n33*b.n12+b.n32*b.n13,j=b.n33*b.n11-b.n31*b.n13,m=-b.n32*b.n11+b.n31*b.n12,n=b.n23*b.n12-b.n22*b.n13,p=-b.n23*b.n11+b.n21*b.n13,t=b.n22*b.n11-b.n21*b.n12;b=b.n11*d+b.n21*h+b.n31*n;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*d;c[1]=b*f;c[2]=b*g;c[3]=b*h;c[4]=b*j;c[5]=b*m;c[6]=b*n;c[7]=b*p;c[8]=b*t;return e};
THREE.Matrix4.makeFrustum=function(b,e,c,d,f,g){var h;h=new THREE.Matrix4;h.n11=2*f/(e-b);h.n12=0;h.n13=(e+b)/(e-b);h.n14=0;h.n21=0;h.n22=2*f/(d-c);h.n23=(d+c)/(d-c);h.n24=0;h.n31=0;h.n32=0;h.n33=-(g+f)/(g-f);h.n34=-2*g*f/(g-f);h.n41=0;h.n42=0;h.n43=-1;h.n44=0;return h};THREE.Matrix4.makePerspective=function(b,e,c,d){var f;b=c*Math.tan(b*Math.PI/360);f=-b;return THREE.Matrix4.makeFrustum(f*e,b*e,f,b,c,d)};
THREE.Matrix4.makeOrtho=function(b,e,c,d,f,g){var h,j,m,n;h=new THREE.Matrix4;j=e-b;m=c-d;n=g-f;h.n11=2/j;h.n12=0;h.n13=0;h.n14=-((e+b)/j);h.n21=0;h.n22=2/m;h.n23=0;h.n24=-((c+d)/m);h.n31=0;h.n32=0;h.n33=-2/n;h.n34=-((g+f)/n);h.n41=0;h.n42=0;h.n43=0;h.n44=1;return h};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=
!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var e=this;e.parent!==undefined;)e=e.parent;e!==undefined&&e instanceof THREE.Scene&&e.addChildRecurse(b)}},removeChild:function(b){var e=this.children.indexOf(b);if(e!==-1){b.parent=undefined;this.children.splice(e,1)}},getChildByName:function(b,e){var c,d,f;c=0;for(d=this.children.length;c<d;c++){f=this.children[c];if(f.name===b)return f;if(e){f=f.getChildByName(b,e);if(f!==undefined)return f}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,e,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;e=!0}b=0;for(var d=this.children.length;b<d;b++)this.children[b].update(this.matrixWorld,e,c)}};THREE.Quaternion=function(b,e,c,d){this.set(b||0,e||0,c||0,d!==undefined?d:1)};
THREE.Quaternion.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var e=0.5*Math.PI/360,c=b.x*e,d=b.y*e,f=b.z*e;b=Math.cos(d);d=Math.sin(d);e=Math.cos(-f);f=Math.sin(-f);var g=Math.cos(c);c=Math.sin(c);var h=b*e,j=d*f;this.w=h*g-j*c;this.x=h*c+j*g;this.y=d*e*g+b*f*c;this.z=b*f*g-d*e*c;return this},setFromAxisAngle:function(b,e){var c=e/2,d=Math.sin(c);this.x=b.x*d;this.y=
b.y*d;this.z=b.z*d;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var e=this.x,c=this.y,d=this.z,f=this.w,g=b.x,h=b.y,j=b.z;b=b.w;this.x=e*b+f*g+c*j-d*h;this.y=c*b+f*h+d*g-e*j;this.z=d*b+f*j+e*h-c*g;this.w=f*b-e*g-c*h-d*j;return this},multiply:function(b,e){this.x=b.x*e.w+b.y*e.z-b.z*e.y+b.w*e.x;this.y=-b.x*e.z+b.y*e.w+b.z*e.x+b.w*e.y;this.z=b.x*e.y-b.y*e.x+b.z*e.w+b.w*e.z;this.w=-b.x*e.x-b.y*e.y-b.z*e.z+b.w*e.w;return this},multiplyVector3:function(b,e){e||(e=b);var c=b.x,d=b.y,f=b.z,g=this.x,h=this.y,j=this.z,m=this.w,n=m*c+h*f-j*d,p=
m*d+j*c-g*f,t=m*f+g*d-h*c;c=-g*c-h*d-j*f;e.x=n*m+c*-g+p*-j-t*-h;e.y=p*m+c*-h+t*-g-n*-j;e.z=t*m+c*-j+n*-h-p*-g;return e}};
THREE.Quaternion.slerp=function(b,e,c,d){var f=b.w*e.w+b.x*e.x+b.y*e.y+b.z*e.z;if(Math.abs(f)>=1){c.w=b.w;c.x=b.x;c.y=b.y;c.z=b.z;return c}var g=Math.acos(f),h=Math.sqrt(1-f*f);if(Math.abs(h)<0.0010){c.w=0.5*(b.w+e.w);c.x=0.5*(b.x+e.x);c.y=0.5*(b.y+e.y);c.z=0.5*(b.z+e.z);return c}f=Math.sin((1-d)*g)/h;d=Math.sin(d*g)/h;c.w=b.w*f+e.w*d;c.x=b.x*f+e.x*d;c.y=b.y*f+e.y*d;c.z=b.z*f+e.z*d;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,e,c,d,f,g){this.a=b;this.b=e;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=g instanceof Array?g:[g];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,e,c,d,f,g,h){this.a=b;this.b=e;this.c=c;this.d=d;this.normal=f instanceof THREE.Vector3?f:new THREE.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=h instanceof Array?h:[h];this.centroid=new THREE.Vector3};THREE.UV=function(b,e){this.set(b||0,e||0)};
THREE.UV.prototype={set:function(b,e){this.u=b;this.v=e;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,e,c;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var e,c,d,f,g,h,j=new THREE.Vector3,m=new THREE.Vector3;d=0;for(f=this.faces.length;d<f;d++){g=this.faces[d];if(b&&g.vertexNormals.length){j.set(0,0,0);e=0;for(c=g.vertexNormals.length;e<c;e++)j.addSelf(g.vertexNormals[e]);j.divideScalar(3)}else{e=this.vertices[g.a];c=this.vertices[g.b];h=this.vertices[g.c];j.sub(h.position,c.position);m.sub(e.position,c.position);j.crossSelf(m)}j.isZero()||
j.normalize();g.normal.copy(j)}},computeVertexNormals:function(){var b,e,c,d;if(this.__tmpVertices==undefined){d=this.__tmpVertices=Array(this.vertices.length);b=0;for(e=this.vertices.length;b<e;b++)d[b]=new THREE.Vector3;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{d=
this.__tmpVertices;b=0;for(e=this.vertices.length;b<e;b++)d[b].set(0,0,0)}b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal);d[c.d].addSelf(c.normal)}}b=0;for(e=this.vertices.length;b<e;b++)d[b].normalize();b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(d[c.a]);
c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c])}else if(c instanceof THREE.Face4){c.vertexNormals[0].copy(d[c.a]);c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c]);c.vertexNormals[3].copy(d[c.d])}}},computeTangents:function(){function b(Y,$,na,ma,ra,xa,ua){j=Y.vertices[$].position;m=Y.vertices[na].position;n=Y.vertices[ma].position;p=h[ra];t=h[xa];v=h[ua];u=m.x-j.x;w=n.x-j.x;y=m.y-j.y;z=n.y-j.y;A=m.z-j.z;E=n.z-j.z;C=t.u-p.u;D=v.u-p.u;B=t.v-p.v;I=v.v-p.v;N=1/(C*I-D*B);
aa.set((I*u-B*w)*N,(I*y-B*z)*N,(I*A-B*E)*N);o.set((C*w-D*u)*N,(C*z-D*y)*N,(C*E-D*A)*N);K[$].addSelf(aa);K[na].addSelf(aa);K[ma].addSelf(aa);L[$].addSelf(o);L[na].addSelf(o);L[ma].addSelf(o)}var e,c,d,f,g,h,j,m,n,p,t,v,u,w,y,z,A,E,C,D,B,I,N,J,K=[],L=[],aa=new THREE.Vector3,o=new THREE.Vector3,ja=new THREE.Vector3,ga=new THREE.Vector3,qa=new THREE.Vector3;e=0;for(c=this.vertices.length;e<c;e++){K[e]=new THREE.Vector3;L[e]=new THREE.Vector3}e=0;for(c=this.faces.length;e<c;e++){g=this.faces[e];h=this.faceVertexUvs[0][e];
if(g instanceof THREE.Face3)b(this,g.a,g.b,g.c,0,1,2);else if(g instanceof THREE.Face4){b(this,g.a,g.b,g.c,0,1,2);b(this,g.a,g.b,g.d,0,1,3)}}var U=["a","b","c","d"];e=0;for(c=this.faces.length;e<c;e++){g=this.faces[e];for(d=0;d<g.vertexNormals.length;d++){qa.copy(g.vertexNormals[d]);f=g[U[d]];J=K[f];ja.copy(J);ja.subSelf(qa.multiplyScalar(qa.dot(J))).normalize();ga.cross(g.vertexNormals[d],J);f=ga.dot(L[f]);f=f<0?-1:1;g.vertexTangents[d]=new THREE.Vector4(ja.x,ja.y,ja.z,f)}}this.hasTangents=!0},computeBoundingBox:function(){var b;
if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var e=1,c=this.vertices.length;e<c;e++){b=this.vertices[e];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;
else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,e=0,c=this.vertices.length;e<c;e++)b=Math.max(b,this.vertices[e].position.length());this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(m,n){return Math.min(m,
n)+"_"+Math.max(m,n)}function e(m,n,p){if(m[n]===undefined){m[n]={set:{},array:[]};m[n].set[p]=1;m[n].array.push(p)}else if(m[n].set[p]===undefined){m[n].set[p]=1;m[n].array.push(p)}}var c,d,f,g,h,j={};c=0;for(d=this.faces.length;c<d;c++){h=this.faces[c];if(h instanceof THREE.Face3){f=b(h.a,h.b);e(j,f,c);f=b(h.b,h.c);e(j,f,c);f=b(h.a,h.c);e(j,f,c)}else if(h instanceof THREE.Face4){f=b(h.b,h.d);e(j,f,c);f=b(h.a,h.b);e(j,f,c);f=b(h.a,h.d);e(j,f,c);f=b(h.b,h.c);e(j,f,c);f=b(h.c,h.d);e(j,f,c)}}c=0;for(d=
this.edges.length;c<d;c++){h=this.edges[c];f=h.vertexIndices[0];g=h.vertexIndices[1];h.faceIndices=j[b(f,g)].array;for(f=0;f<h.faceIndices.length;f++){g=h.faceIndices[f];h.faces.push(this.faces[g])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function e(u,w,y,z,A,E,C){u=(y-u)*0.5;z=(z-w)*0.5;return(2*(w-y)+u+z)*C+(-3*(w-y)-2*u-z)*E+u*A+w}this.points=b;var c=[],d={x:0,y:0,z:0},f,g,h,j,m,n,p,t,v;this.initFromArray=function(u){this.points=[];for(var w=0;w<u.length;w++)this.points[w]={x:u[w][0],y:u[w][1],z:u[w][2]}};this.getPoint=function(u){f=(this.points.length-1)*u;g=Math.floor(f);h=f-g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>this.points.length-2?g:g+1;c[3]=g>this.points.length-3?g:g+2;n=this.points[c[0]];p=this.points[c[1]];
t=this.points[c[2]];v=this.points[c[3]];j=h*h;m=h*j;d.x=e(n.x,p.x,t.x,v.x,h,j,m);d.y=e(n.y,p.y,t.y,v.y,h,j,m);d.z=e(n.z,p.z,t.z,v.z,h,j,m);return d};this.getControlPointsArray=function(){var u,w,y=this.points.length,z=[];for(u=0;u<y;u++){w=this.points[u];z[u]=[w.x,w.y,w.z]}return z};this.getLength=function(u){var w,y,z=0,A=new THREE.Vector3,E=new THREE.Vector3,C=[],D=0;C[0]=0;u||(u=100);y=this.points.length*u;A.copy(this.points[0]);for(u=1;u<y;u++){w=u/y;position=this.getPoint(w);E.copy(position);
D+=E.distanceTo(A);A.copy(position);w*=this.points.length-1;w=Math.floor(w);if(w!=z){C[w]=D;z=w}}C[C.length]=D;return{chunks:C,total:D}};this.reparametrizeByArcLength=function(u){var w,y,z,A,E,C,D=[],B=new THREE.Vector3,I=this.getLength();D.push(B.copy(this.points[0]).clone());for(w=1;w<this.points.length;w++){y=I.chunks[w]-I.chunks[w-1];C=Math.ceil(u*y/I.total);A=(w-1)/(this.points.length-1);E=w/(this.points.length-1);for(y=1;y<C-1;y++){z=A+y*(1/C)*(E-A);position=this.getPoint(z);D.push(B.copy(position).clone())}D.push(B.copy(this.points[w]).clone())}this.points=
D}};THREE.Edge=function(b,e,c,d){this.vertices=[b,e];this.vertexIndices=[c,d];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,e,c,d,f){THREE.Object3D.call(this);this.fov=b||50;this.aspect=e||1;this.near=c||0.1;this.far=d||2E3;this.target=f||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,e,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);e=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;e=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,e,c,d){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=e||1;this.distance=c||0;this.castShadow=d!==undefined?d:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,e,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=e||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,e,c,d){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,e,c,d)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,e,c,d){e===undefined&&(e=-1);c===undefined&&(c=0);if(d===undefined)d=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:e,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,e=this.lensFlares.length,c,d=-this.positionScreen.x*2,f=-this.positionScreen.y*2;for(b=0;b<e;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+f*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ParticleCanvasMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.program=b.program!==undefined?b.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(b){THREE.Material.call(this);this.domElement=b};
THREE.Texture=function(b,e,c,d,f,g){this.image=b;this.mapping=e!==undefined?e:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==undefined?d:THREE.ClampToEdgeWrapping;this.magFilter=f!==undefined?f:THREE.LinearFilter;this.minFilter=g!==undefined?g:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.materials=b instanceof Array?b:[b]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;
THREE.Line=function(b,e,c){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e&&e.length?e:[e];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[c].name]=c}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.skinMatrix,e,c):b.update(this.matrixWorld,!0,c)}}else for(d=0;d<f;d++)this.children[d].update(this.skinMatrix,
e,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,e){THREE.Mesh.call(this,b,e);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,d,f,g,h,j;if(this.geometry.bones!==undefined){for(c=0;c<this.geometry.bones.length;c++){f=this.geometry.bones[c];g=f.pos;h=f.rotq;j=f.scl;d=this.addBone();d.name=f.name;d.position.set(g[0],g[1],g[2]);d.quaternion.set(h[0],h[1],h[2],h[3]);d.useQuaternion=!0;j!==undefined?d.scale.set(j[0],j[1],j[2]):d.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){f=this.geometry.bones[c];
d=this.bones[c];f.parent===-1?this.addChild(d):this.bones[f.parent].addChild(d)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,e,c){if(this.visible){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,e,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(e=0;e<c;e++)ba[e].skinMatrix.flattenToArrayOffset(bm,
e*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,e=[],c=0;c<this.bones.length;c++){b=this.bones[c];e.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var d;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var f=this.geometry.skinIndices[b].x,g=this.geometry.skinIndices[b].y;
d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(e[f].multiplyVector3(d));d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(e[g].multiplyVector3(d));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=c;this.geometry.skinWeights[b].y+=c}}}};
THREE.Ribbon=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,e,c,d){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=e!==undefined?Math.abs(e):100;this.volume=Math.min(1,Math.max(0,c!==undefined?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=d!==undefined?d:!0;this.sources=b instanceof Array?b:[b];var f;c=this.sources.length;for(b=0;b<c;b++){e=this.sources[b];e.toLowerCase();if(e.indexOf(".mp3")!==-1)f=
"audio/mpeg";else if(e.indexOf(".ogg")!==-1)f="audio/ogg";else e.indexOf(".wav")!==-1&&(f="audio/wav");if(this.domElement.canPlayType(f)){f=document.createElement("source");f.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(f);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,e,c){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);e=!0}if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d=this.children.length;for(b=0;b<d;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,e){e===undefined&&(e=0);e=Math.abs(e);for(var c=0;c<this.LODs.length;c++)if(e<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:e,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length;d++)if(b>=this.LODs[d].visibleAtDistance){this.LODs[d-1].object3D.visible=
!1;this.LODs[d].object3D.visible=!0}else break;for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.ShadowVolume=function(b,e){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,e,c,d,f,g,h,j,m,n,p,t,v,u,w=new THREE.Geometry;w.vertices=this.geometry.vertices;d=w.faces=this.geometry.faces;var y=w.egdes=this.geometry.edges,z=w.edgeFaces=[];f=0;var A=[];b=0;for(e=d.length;b<e;b++){c=d[b];A.push(f);f+=c instanceof THREE.Face3?3:4;c.vertexNormals[0]=c.normal;c.vertexNormals[1]=c.normal;c.vertexNormals[2]=c.normal;if(c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal}b=0;for(e=y.length;b<e;b++){j=y[b];c=j.faces[0];d=j.faces[1];f=j.faceIndices[0];g=j.faceIndices[1];h=j.vertexIndices[0];j=j.vertexIndices[1];if(c.a===h){m="a";p=A[f]+0}else if(c.b===h){m="b";p=A[f]+1}else if(c.c===h){m="c";p=A[f]+2}else if(c.d===h){m="d";p=A[f]+3}if(c.a===j){m+="a";t=A[f]+0}else if(c.b===j){m+="b";t=A[f]+1}else if(c.c===j){m+="c";t=A[f]+2}else if(c.d===j){m+="d";t=A[f]+3}if(d.a===h){n="a";v=A[g]+0}else if(d.b===h){n="b";v=A[g]+1}else if(d.c===h){n="c";v=A[g]+2}else if(d.d===
h){n="d";v=A[g]+3}if(d.a===j){n+="a";u=A[g]+0}else if(d.b===j){n+="b";u=A[g]+1}else if(d.c===j){n+="c";u=A[g]+2}else if(d.d===j){n+="d";u=A[g]+3}if(m==="ac"||m==="ad"||m==="ca"||m==="da"){if(p>t){c=p;p=t;t=c}}else if(p<t){c=p;p=t;t=c}if(n==="ac"||n==="ad"||n==="ca"||n==="da"){if(v>u){c=v;v=u;u=c}}else if(v<u){c=v;v=u;u=c}c=new THREE.Face4(p,t,v,u);c.normal.set(1,0,0);z.push(c)}this.geometry=w}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var e=this.geometry.vertices,c=this.geometry.faces,d=this.geometry.edgeFaces,f=b.faces;b=b.vertices;var g=f.length,h,j,m,n,p,t=["a","b","c","d"];for(m=0;m<g;m++){j=e.length;h=f[m];if(h instanceof THREE.Face4){n=4;j=new THREE.Face4(j,j+1,j+2,j+3)}else{n=3;j=new THREE.Face3(j,j+1,j+2)}j.normal.copy(h.normal);c.push(j);
for(j=0;j<n;j++){p=b[h[t[j]]];e.push(new THREE.Vertex(p.position.clone()))}}for(g=0;g<f.length-1;g++){b=c[g];for(h=g+1;h<f.length;h++){j=c[h];j=this.facesShareEdge(e,b,j);if(j!==undefined){j=new THREE.Face4(j.indices[0],j.indices[3],j.indices[2],j.indices[1]);j.normal.set(1,0,0);d.push(j)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,e,c){var d,f,g,h,j,m,n,p,t,v,u,w,y,z=0,A=["a","b","c","d"];d=e instanceof THREE.Face4?4:3;f=c instanceof THREE.Face4?4:3;for(w=0;w<d;w++){g=e[A[w]];j=b[g];for(y=0;y<f;y++){h=c[A[y]];m=b[h];if(Math.abs(j.position.x-m.position.x)<1.0E-4&&Math.abs(j.position.y-m.position.y)<1.0E-4&&Math.abs(j.position.z-m.position.z)<1.0E-4){z++;if(z===1){n=j;p=m;t=g;v=h;u=A[w]}if(z===2){u+=A[w];return u==="ad"||u==="ac"?{faces:[e,c],vertices:[n,p,m,j],indices:[t,
v,h,g],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[e,c],vertices:[n,j,m,p],indices:[t,g,h,v],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var e=0;e<b.children.length;e++)this.addChildRecurse(b.children[e])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var e=this.lights.indexOf(b);e!==-1&&this.lights.splice(e,1)}else if(b instanceof THREE.Sound){e=this.sounds.indexOf(b);e!==-1&&this.sounds.splice(e,1)}else if(!(b instanceof THREE.Camera)){e=this.objects.indexOf(b);if(e!==-1){this.objects.splice(e,1);this.__objectsRemoved.push(b)}}for(e=0;e<b.children.length;e++)this.removeChildRecurse(b.children[e])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,e,c){this.color=new THREE.Color(b);this.near=e||1;this.far=c||1E3};THREE.FogExp2=function(b,e){this.color=new THREE.Color(b);this.density=e!==undefined?e:2.5E-4};
THREE.Projector=function(){function b(){var aa=m[j]=m[j]||new THREE.RenderableVertex;j++;return aa}function e(aa,o){return o.z-aa.z}function c(aa,o){var ja=0,ga=1,qa=aa.z+aa.w,U=o.z+o.w,Y=-aa.z+aa.w,$=-o.z+o.w;if(qa>=0&&U>=0&&Y>=0&&$>=0)return!0;else if(qa<0&&U<0||Y<0&&$<0)return!1;else{if(qa<0)ja=Math.max(ja,qa/(qa-U));else U<0&&(ga=Math.min(ga,qa/(qa-U)));if(Y<0)ja=Math.max(ja,Y/(Y-$));else $<0&&(ga=Math.min(ga,Y/(Y-$)));if(ga<ja)return!1;else{aa.lerpSelf(o,ja);o.lerpSelf(aa,1-ga);return!0}}}var d,
f,g=[],h,j,m=[],n,p,t=[],v,u=[],w,y,z=[],A,E,C=[],D=new THREE.Vector4,B=new THREE.Vector4,I=new THREE.Matrix4,N=new THREE.Matrix4,J=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],K=new THREE.Vector4,L=new THREE.Vector4;this.projectVector=function(aa,o){I.multiply(o.projectionMatrix,o.matrixWorldInverse);I.multiplyVector3(aa);return aa};this.unprojectVector=function(aa,o){I.multiply(o.matrixWorld,THREE.Matrix4.makeInvert(o.projectionMatrix));
I.multiplyVector3(aa);return aa};this.projectObjects=function(aa,o,ja){o=[];var ga,qa,U;f=0;qa=aa.objects;aa=0;for(ga=qa.length;aa<ga;aa++){U=qa[aa];var Y;if(!(Y=!U.visible))if(Y=U instanceof THREE.Mesh){a:{for(var $=U.matrixWorld,na=-U.geometry.boundingSphere.radius*Math.max(U.scale.x,Math.max(U.scale.y,U.scale.z)),ma=0;ma<6;ma++){Y=J[ma].x*$.n14+J[ma].y*$.n24+J[ma].z*$.n34+J[ma].w;if(Y<=na){Y=!1;break a}}Y=!0}Y=!Y}if(!Y){Y=g[f]=g[f]||new THREE.RenderableObject;f++;d=Y;D.copy(U.position);I.multiplyVector3(D);
d.object=U;d.z=D.z;o.push(d)}}ja&&o.sort(e);return o};this.projectScene=function(aa,o,ja){var ga=[],qa=o.near,U=o.far,Y,$,na,ma,ra,xa,ua,Ga,Ca,pa,za,Ka,Ta,Xa,Z,ka,ca;E=y=v=p=0;o.matrixAutoUpdate&&o.update(undefined,!0);aa.update(undefined,!1,o);I.multiply(o.projectionMatrix,o.matrixWorldInverse);J[0].set(I.n41-I.n11,I.n42-I.n12,I.n43-I.n13,I.n44-I.n14);J[1].set(I.n41+I.n11,I.n42+I.n12,I.n43+I.n13,I.n44+I.n14);J[2].set(I.n41+I.n21,I.n42+I.n22,I.n43+I.n23,I.n44+I.n24);J[3].set(I.n41-I.n21,I.n42-I.n22,
I.n43-I.n23,I.n44-I.n24);J[4].set(I.n41-I.n31,I.n42-I.n32,I.n43-I.n33,I.n44-I.n34);J[5].set(I.n41+I.n31,I.n42+I.n32,I.n43+I.n33,I.n44+I.n34);for(Y=0;Y<6;Y++){Ca=J[Y];Ca.divideScalar(Math.sqrt(Ca.x*Ca.x+Ca.y*Ca.y+Ca.z*Ca.z))}Ca=this.projectObjects(aa,o,!0);aa=0;for(Y=Ca.length;aa<Y;aa++){pa=Ca[aa].object;if(pa.visible){za=pa.matrixWorld;Ka=pa.matrixRotationWorld;Ta=pa.materials;Xa=pa.overdraw;j=0;if(pa instanceof THREE.Mesh){Z=pa.geometry;ma=Z.vertices;ka=Z.faces;Z=Z.faceVertexUvs;$=0;for(na=ma.length;$<
na;$++){h=b();h.positionWorld.copy(ma[$].position);za.multiplyVector3(h.positionWorld);h.positionScreen.copy(h.positionWorld);I.multiplyVector4(h.positionScreen);h.positionScreen.x/=h.positionScreen.w;h.positionScreen.y/=h.positionScreen.w;h.visible=h.positionScreen.z>qa&&h.positionScreen.z<U}ma=0;for($=ka.length;ma<$;ma++){na=ka[ma];if(na instanceof THREE.Face3){ra=m[na.a];xa=m[na.b];ua=m[na.c];if(ra.visible&&xa.visible&&ua.visible&&(pa.doubleSided||pa.flipSided!=(ua.positionScreen.x-ra.positionScreen.x)*
(xa.positionScreen.y-ra.positionScreen.y)-(ua.positionScreen.y-ra.positionScreen.y)*(xa.positionScreen.x-ra.positionScreen.x)<0)){Ga=t[p]=t[p]||new THREE.RenderableFace3;p++;n=Ga;n.v1.copy(ra);n.v2.copy(xa);n.v3.copy(ua)}else continue}else if(na instanceof THREE.Face4){ra=m[na.a];xa=m[na.b];ua=m[na.c];Ga=m[na.d];if(ra.visible&&xa.visible&&ua.visible&&Ga.visible&&(pa.doubleSided||pa.flipSided!=((Ga.positionScreen.x-ra.positionScreen.x)*(xa.positionScreen.y-ra.positionScreen.y)-(Ga.positionScreen.y-
ra.positionScreen.y)*(xa.positionScreen.x-ra.positionScreen.x)<0||(xa.positionScreen.x-ua.positionScreen.x)*(Ga.positionScreen.y-ua.positionScreen.y)-(xa.positionScreen.y-ua.positionScreen.y)*(Ga.positionScreen.x-ua.positionScreen.x)<0))){ca=u[v]=u[v]||new THREE.RenderableFace4;v++;n=ca;n.v1.copy(ra);n.v2.copy(xa);n.v3.copy(ua);n.v4.copy(Ga)}else continue}n.normalWorld.copy(na.normal);Ka.multiplyVector3(n.normalWorld);n.centroidWorld.copy(na.centroid);za.multiplyVector3(n.centroidWorld);n.centroidScreen.copy(n.centroidWorld);
I.multiplyVector3(n.centroidScreen);ua=na.vertexNormals;ra=0;for(xa=ua.length;ra<xa;ra++){Ga=n.vertexNormalsWorld[ra];Ga.copy(ua[ra]);Ka.multiplyVector3(Ga)}ra=0;for(xa=Z.length;ra<xa;ra++)if(ca=Z[ra][ma]){ua=0;for(Ga=ca.length;ua<Ga;ua++)n.uvs[ra][ua]=ca[ua]}n.meshMaterials=Ta;n.faceMaterials=na.materials;n.overdraw=Xa;n.z=n.centroidScreen.z;ga.push(n)}}else if(pa instanceof THREE.Line){N.multiply(I,za);ma=pa.geometry.vertices;ra=b();ra.positionScreen.copy(ma[0].position);N.multiplyVector4(ra.positionScreen);
$=1;for(na=ma.length;$<na;$++){ra=b();ra.positionScreen.copy(ma[$].position);N.multiplyVector4(ra.positionScreen);xa=m[j-2];K.copy(ra.positionScreen);L.copy(xa.positionScreen);if(c(K,L)){K.multiplyScalar(1/K.w);L.multiplyScalar(1/L.w);za=z[y]=z[y]||new THREE.RenderableLine;y++;w=za;w.v1.positionScreen.copy(K);w.v2.positionScreen.copy(L);w.z=Math.max(K.z,L.z);w.materials=pa.materials;ga.push(w)}}}else if(pa instanceof THREE.Particle){B.set(pa.matrixWorld.n14,pa.matrixWorld.n24,pa.matrixWorld.n34,1);
I.multiplyVector4(B);B.z/=B.w;if(B.z>0&&B.z<1){za=C[E]=C[E]||new THREE.RenderableParticle;E++;A=za;A.x=B.x/B.w;A.y=B.y/B.w;A.z=B.z;A.rotation=pa.rotation.z;A.scale.x=pa.scale.x*Math.abs(A.x-(B.x+o.projectionMatrix.n11)/(B.w+o.projectionMatrix.n14));A.scale.y=pa.scale.y*Math.abs(A.y-(B.y+o.projectionMatrix.n22)/(B.w+o.projectionMatrix.n24));A.materials=pa.materials;ga.push(A)}}}}ja&&ga.sort(e);return ga}};
THREE.DOMRenderer=function(){THREE.Renderer.call(this);var b=null,e=new THREE.Projector,c,d,f,g;this.domElement=document.createElement("div");this.setSize=function(h,j){c=h;d=j;f=c/2;g=d/2};this.render=function(h,j){var m,n,p,t,v,u,w,y;b=e.projectScene(h,j);m=0;for(n=b.length;m<n;m++){v=b[m];if(v instanceof THREE.RenderableParticle){w=v.x*f+f;y=v.y*g+g;p=0;for(t=v.material.length;p<t;p++){u=v.material[p];if(u instanceof THREE.ParticleDOMMaterial){u=u.domElement;u.style.left=w+"px";u.style.top=y+"px"}}}}}};
THREE.CanvasRenderer=function(){function b(wa){if(z!=wa)u.globalAlpha=z=wa}function e(wa){if(A!=wa){switch(wa){case THREE.NormalBlending:u.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:u.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:u.globalCompositeOperation="darker"}A=wa}}function c(wa){if(E!=wa.hex){E=wa.hex;u.strokeStyle="#"+f(E.toString(16))}}function d(wa){if(C!=wa.hex){C=wa.hex;u.fillStyle="#"+f(C.toString(16))}}function f(wa){for(;wa.length<
6;)wa="0"+wa;return wa}var g=this,h=null,j=new THREE.Projector,m=document.createElement("canvas"),n,p,t,v,u=m.getContext("2d"),w=new THREE.Color(0),y=0,z=1,A=0,E=null,C=null,D=null,B=null,I=null,N,J,K,L,aa=new THREE.RenderableVertex,o=new THREE.RenderableVertex,ja,ga,qa,U,Y,$,na,ma,ra,xa,ua,Ga,Ca=new THREE.Color(0),pa=new THREE.Color(0),za=new THREE.Color(0),Ka=new THREE.Color(0),Ta=new THREE.Color(0),Xa,Z,ka,ca,da,Na,bb,x,O,G,H=new THREE.Rectangle,M=new THREE.Rectangle,S=new THREE.Rectangle,V=!1,
Q=new THREE.Color,X=new THREE.Color,R=new THREE.Color,W=new THREE.Color,T=new THREE.Vector3,la,ia,Da,Ia,Fa,Ma,Ya=16;la=document.createElement("canvas");la.width=la.height=2;ia=la.getContext("2d");ia.fillStyle="rgba(0,0,0,1)";ia.fillRect(0,0,2,2);Da=ia.getImageData(0,0,2,2);Ia=Da.data;Fa=document.createElement("canvas");Fa.width=Fa.height=Ya;Ma=Fa.getContext("2d");Ma.translate(-Ya/2,-Ya/2);Ma.scale(Ya,Ya);Ya--;this.domElement=m;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,
faces:0};this.setSize=function(wa,Ba){n=wa;p=Ba;t=n/2;v=p/2;m.width=n;m.height=p;H.set(-t,-v,t,v);z=1;A=0;I=B=D=C=E=null};this.setClearColor=function(wa,Ba){w=wa;y=Ba};this.setClearColorHex=function(wa,Ba){w.setHex(wa);y=Ba};this.clear=function(){u.setTransform(1,0,0,-1,t,v);if(!M.isEmpty()){M.inflate(1);M.minSelf(H);if(w.hex==0&&y==0)u.clearRect(M.getX(),M.getY(),M.getWidth(),M.getHeight());else{e(THREE.NormalBlending);b(1);u.fillStyle="rgba("+Math.floor(w.r*255)+","+Math.floor(w.g*255)+","+Math.floor(w.b*
255)+","+y+")";u.fillRect(M.getX(),M.getY(),M.getWidth(),M.getHeight())}M.empty()}};this.render=function(wa,Ba){function Ha(ea){var va,sa,oa,Aa=ea.lights;X.setRGB(0,0,0);R.setRGB(0,0,0);W.setRGB(0,0,0);ea=0;for(va=Aa.length;ea<va;ea++){sa=Aa[ea];oa=sa.color;if(sa instanceof THREE.AmbientLight){X.r+=oa.r;X.g+=oa.g;X.b+=oa.b}else if(sa instanceof THREE.DirectionalLight){R.r+=oa.r;R.g+=oa.g;R.b+=oa.b}else if(sa instanceof THREE.PointLight){W.r+=oa.r;W.g+=oa.g;W.b+=oa.b}}}function Qa(ea,va,sa,oa){var Aa,
Oa,ya,fa,La=ea.lights;ea=0;for(Aa=La.length;ea<Aa;ea++){Oa=La[ea];ya=Oa.color;if(Oa instanceof THREE.DirectionalLight){fa=sa.dot(Oa.position);if(!(fa<=0)){fa*=Oa.intensity;oa.r+=ya.r*fa;oa.g+=ya.g*fa;oa.b+=ya.b*fa}}else if(Oa instanceof THREE.PointLight){fa=sa.dot(T.sub(Oa.position,va).normalize());if(!(fa<=0)){fa*=Oa.distance==0?1:1-Math.min(va.distanceTo(Oa.position)/Oa.distance,1);if(fa!=0){fa*=Oa.intensity;oa.r+=ya.r*fa;oa.g+=ya.g*fa;oa.b+=ya.b*fa}}}}}function P(ea,va,sa){b(sa.opacity);e(sa.blending);
var oa,Aa,Oa,ya,fa,La;if(sa instanceof THREE.ParticleBasicMaterial){if(sa.map){ya=sa.map.image;fa=ya.width>>1;La=ya.height>>1;sa=va.scale.x*t;Oa=va.scale.y*v;oa=sa*fa;Aa=Oa*La;S.set(ea.x-oa,ea.y-Aa,ea.x+oa,ea.y+Aa);if(H.instersects(S)){u.save();u.translate(ea.x,ea.y);u.rotate(-va.rotation);u.scale(sa,-Oa);u.translate(-fa,-La);u.drawImage(ya,0,0);u.restore()}}}else if(sa instanceof THREE.ParticleCanvasMaterial){oa=va.scale.x*t;Aa=va.scale.y*v;S.set(ea.x-oa,ea.y-Aa,ea.x+oa,ea.y+Aa);if(H.instersects(S)){c(sa.color);
d(sa.color);u.save();u.translate(ea.x,ea.y);u.rotate(-va.rotation);u.scale(oa,Aa);sa.program(u);u.restore()}}}function ta(ea,va,sa,oa){b(oa.opacity);e(oa.blending);u.beginPath();u.moveTo(ea.positionScreen.x,ea.positionScreen.y);u.lineTo(va.positionScreen.x,va.positionScreen.y);u.closePath();if(oa instanceof THREE.LineBasicMaterial){ea=oa.linewidth;if(D!=ea)u.lineWidth=D=ea;ea=oa.linecap;if(B!=ea)u.lineCap=B=ea;ea=oa.linejoin;if(I!=ea)u.lineJoin=I=ea;c(oa.color);u.stroke();S.inflate(oa.linewidth*2)}}
function F(ea,va,sa,oa,Aa,Oa,ya,fa,La){g.data.vertices+=3;g.data.faces++;b(fa.opacity);e(fa.blending);ja=ea.positionScreen.x;ga=ea.positionScreen.y;qa=va.positionScreen.x;U=va.positionScreen.y;Y=sa.positionScreen.x;$=sa.positionScreen.y;hb(ja,ga,qa,U,Y,$);if(fa instanceof THREE.MeshBasicMaterial)if(fa.map){if(fa.map.mapping instanceof THREE.UVMapping){ca=ya.uvs[0];db(ja,ga,qa,U,Y,$,fa.map.image,ca[oa].u,ca[oa].v,ca[Aa].u,ca[Aa].v,ca[Oa].u,ca[Oa].v)}}else if(fa.envMap){if(fa.envMap.mapping instanceof
THREE.SphericalReflectionMapping){ea=Ba.matrixWorldInverse;T.copy(ya.vertexNormalsWorld[0]);da=(T.x*ea.n11+T.y*ea.n12+T.z*ea.n13)*0.5+0.5;Na=-(T.x*ea.n21+T.y*ea.n22+T.z*ea.n23)*0.5+0.5;T.copy(ya.vertexNormalsWorld[1]);bb=(T.x*ea.n11+T.y*ea.n12+T.z*ea.n13)*0.5+0.5;x=-(T.x*ea.n21+T.y*ea.n22+T.z*ea.n23)*0.5+0.5;T.copy(ya.vertexNormalsWorld[2]);O=(T.x*ea.n11+T.y*ea.n12+T.z*ea.n13)*0.5+0.5;G=-(T.x*ea.n21+T.y*ea.n22+T.z*ea.n23)*0.5+0.5;db(ja,ga,qa,U,Y,$,fa.envMap.image,da,Na,bb,x,O,G)}}else fa.wireframe?
Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color);else if(fa instanceof THREE.MeshLambertMaterial){if(fa.map&&!fa.wireframe){if(fa.map.mapping instanceof THREE.UVMapping){ca=ya.uvs[0];db(ja,ga,qa,U,Y,$,fa.map.image,ca[oa].u,ca[oa].v,ca[Aa].u,ca[Aa].v,ca[Oa].u,ca[Oa].v)}e(THREE.SubtractiveBlending)}if(V)if(!fa.wireframe&&fa.shading==THREE.SmoothShading&&ya.vertexNormalsWorld.length==3){pa.r=za.r=Ka.r=X.r;pa.g=za.g=Ka.g=X.g;pa.b=za.b=Ka.b=X.b;Qa(La,ya.v1.positionWorld,
ya.vertexNormalsWorld[0],pa);Qa(La,ya.v2.positionWorld,ya.vertexNormalsWorld[1],za);Qa(La,ya.v3.positionWorld,ya.vertexNormalsWorld[2],Ka);Ta.r=(za.r+Ka.r)*0.5;Ta.g=(za.g+Ka.g)*0.5;Ta.b=(za.b+Ka.b)*0.5;ka=ab(pa,za,Ka,Ta);db(ja,ga,qa,U,Y,$,ka,0,0,1,0,0,1)}else{Q.r=X.r;Q.g=X.g;Q.b=X.b;Qa(La,ya.centroidWorld,ya.normalWorld,Q);Ca.r=Math.max(0,Math.min(fa.color.r*Q.r,1));Ca.g=Math.max(0,Math.min(fa.color.g*Q.g,1));Ca.b=Math.max(0,Math.min(fa.color.b*Q.b,1));Ca.updateHex();fa.wireframe?Ua(Ca,fa.wireframeLinewidth,
fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}else fa.wireframe?Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color)}else if(fa instanceof THREE.MeshDepthMaterial){Xa=Ba.near;Z=Ba.far;pa.r=pa.g=pa.b=1-$a(ea.positionScreen.z,Xa,Z);za.r=za.g=za.b=1-$a(va.positionScreen.z,Xa,Z);Ka.r=Ka.g=Ka.b=1-$a(sa.positionScreen.z,Xa,Z);Ta.r=(za.r+Ka.r)*0.5;Ta.g=(za.g+Ka.g)*0.5;Ta.b=(za.b+Ka.b)*0.5;ka=ab(pa,za,Ka,Ta);db(ja,ga,qa,U,Y,$,ka,0,0,1,0,0,1)}else if(fa instanceof THREE.MeshNormalMaterial){Ca.r=
Pa(ya.normalWorld.x);Ca.g=Pa(ya.normalWorld.y);Ca.b=Pa(ya.normalWorld.z);Ca.updateHex();fa.wireframe?Ua(Ca,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}}function eb(ea,va,sa,oa,Aa,Oa,ya,fa,La){g.data.vertices+=4;g.data.faces++;b(fa.opacity);e(fa.blending);if(fa.map||fa.envMap){F(ea,va,oa,0,1,3,ya,fa,La);F(Aa,sa,Oa,1,2,3,ya,fa,La)}else{ja=ea.positionScreen.x;ga=ea.positionScreen.y;qa=va.positionScreen.x;U=va.positionScreen.y;Y=sa.positionScreen.x;$=sa.positionScreen.y;na=
oa.positionScreen.x;ma=oa.positionScreen.y;ra=Aa.positionScreen.x;xa=Aa.positionScreen.y;ua=Oa.positionScreen.x;Ga=Oa.positionScreen.y;if(fa instanceof THREE.MeshBasicMaterial){Va(ja,ga,qa,U,Y,$,na,ma);fa.wireframe?Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color)}else if(fa instanceof THREE.MeshLambertMaterial)if(V)if(!fa.wireframe&&fa.shading==THREE.SmoothShading&&ya.vertexNormalsWorld.length==4){pa.r=za.r=Ka.r=Ta.r=X.r;pa.g=za.g=Ka.g=Ta.g=X.g;pa.b=za.b=Ka.b=
Ta.b=X.b;Qa(La,ya.v1.positionWorld,ya.vertexNormalsWorld[0],pa);Qa(La,ya.v2.positionWorld,ya.vertexNormalsWorld[1],za);Qa(La,ya.v4.positionWorld,ya.vertexNormalsWorld[3],Ka);Qa(La,ya.v3.positionWorld,ya.vertexNormalsWorld[2],Ta);ka=ab(pa,za,Ka,Ta);hb(ja,ga,qa,U,na,ma);db(ja,ga,qa,U,na,ma,ka,0,0,1,0,0,1);hb(ra,xa,Y,$,ua,Ga);db(ra,xa,Y,$,ua,Ga,ka,1,0,1,1,0,1)}else{Q.r=X.r;Q.g=X.g;Q.b=X.b;Qa(La,ya.centroidWorld,ya.normalWorld,Q);Ca.r=Math.max(0,Math.min(fa.color.r*Q.r,1));Ca.g=Math.max(0,Math.min(fa.color.g*
Q.g,1));Ca.b=Math.max(0,Math.min(fa.color.b*Q.b,1));Ca.updateHex();Va(ja,ga,qa,U,Y,$,na,ma);fa.wireframe?Ua(Ca,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}else{Va(ja,ga,qa,U,Y,$,na,ma);fa.wireframe?Ua(fa.color,fa.wireframeLinewidth,fa.wireframeLinecap,fa.wireframeLinejoin):gb(fa.color)}else if(fa instanceof THREE.MeshNormalMaterial){Ca.r=Pa(ya.normalWorld.x);Ca.g=Pa(ya.normalWorld.y);Ca.b=Pa(ya.normalWorld.z);Ca.updateHex();Va(ja,ga,qa,U,Y,$,na,ma);fa.wireframe?Ua(Ca,fa.wireframeLinewidth,
fa.wireframeLinecap,fa.wireframeLinejoin):gb(Ca)}else if(fa instanceof THREE.MeshDepthMaterial){Xa=Ba.near;Z=Ba.far;pa.r=pa.g=pa.b=1-$a(ea.positionScreen.z,Xa,Z);za.r=za.g=za.b=1-$a(va.positionScreen.z,Xa,Z);Ka.r=Ka.g=Ka.b=1-$a(oa.positionScreen.z,Xa,Z);Ta.r=Ta.g=Ta.b=1-$a(sa.positionScreen.z,Xa,Z);ka=ab(pa,za,Ka,Ta);hb(ja,ga,qa,U,na,ma);db(ja,ga,qa,U,na,ma,ka,0,0,1,0,0,1);hb(ra,xa,Y,$,ua,Ga);db(ra,xa,Y,$,ua,Ga,ka,1,0,1,1,0,1)}}}function hb(ea,va,sa,oa,Aa,Oa){u.beginPath();u.moveTo(ea,va);u.lineTo(sa,
oa);u.lineTo(Aa,Oa);u.lineTo(ea,va);u.closePath()}function Va(ea,va,sa,oa,Aa,Oa,ya,fa){u.beginPath();u.moveTo(ea,va);u.lineTo(sa,oa);u.lineTo(Aa,Oa);u.lineTo(ya,fa);u.lineTo(ea,va);u.closePath()}function Ua(ea,va,sa,oa){if(D!=va)u.lineWidth=D=va;if(B!=sa)u.lineCap=B=sa;if(I!=oa)u.lineJoin=I=oa;c(ea);u.stroke();S.inflate(va*2)}function gb(ea){d(ea);u.fill()}function db(ea,va,sa,oa,Aa,Oa,ya,fa,La,lb,Sa,jb,nb){var fb,kb;fb=ya.width-1;kb=ya.height-1;fa*=fb;La*=kb;lb*=fb;Sa*=kb;jb*=fb;nb*=kb;sa-=ea;oa-=
va;Aa-=ea;Oa-=va;lb-=fa;Sa-=La;jb-=fa;nb-=La;fb=lb*nb-jb*Sa;if(fb!=0){kb=1/fb;fb=(nb*sa-Sa*Aa)*kb;Sa=(nb*oa-Sa*Oa)*kb;sa=(lb*Aa-jb*sa)*kb;oa=(lb*Oa-jb*oa)*kb;ea=ea-fb*fa-sa*La;va=va-Sa*fa-oa*La;u.save();u.transform(fb,Sa,sa,oa,ea,va);u.clip();u.drawImage(ya,0,0);u.restore()}}function ab(ea,va,sa,oa){var Aa=~~(ea.r*255),Oa=~~(ea.g*255);ea=~~(ea.b*255);var ya=~~(va.r*255),fa=~~(va.g*255);va=~~(va.b*255);var La=~~(sa.r*255),lb=~~(sa.g*255);sa=~~(sa.b*255);var Sa=~~(oa.r*255),jb=~~(oa.g*255);oa=~~(oa.b*
255);Ia[0]=Aa<0?0:Aa>255?255:Aa;Ia[1]=Oa<0?0:Oa>255?255:Oa;Ia[2]=ea<0?0:ea>255?255:ea;Ia[4]=ya<0?0:ya>255?255:ya;Ia[5]=fa<0?0:fa>255?255:fa;Ia[6]=va<0?0:va>255?255:va;Ia[8]=La<0?0:La>255?255:La;Ia[9]=lb<0?0:lb>255?255:lb;Ia[10]=sa<0?0:sa>255?255:sa;Ia[12]=Sa<0?0:Sa>255?255:Sa;Ia[13]=jb<0?0:jb>255?255:jb;Ia[14]=oa<0?0:oa>255?255:oa;ia.putImageData(Da,0,0);Ma.drawImage(la,0,0);return Fa}function $a(ea,va,sa){ea=(ea-va)/(sa-va);return ea*ea*(3-2*ea)}function Pa(ea){ea=(ea+1)*0.5;return ea<0?0:ea>1?1:
ea}function Za(ea,va){var sa=va.x-ea.x,oa=va.y-ea.y,Aa=1/Math.sqrt(sa*sa+oa*oa);sa*=Aa;oa*=Aa;va.x+=sa;va.y+=oa;ea.x-=sa;ea.y-=oa}var Wa,ha,Ea,Ra,ib,mb,cb,Ja;this.autoClear?this.clear():u.setTransform(1,0,0,-1,t,v);g.data.vertices=0;g.data.faces=0;h=j.projectScene(wa,Ba,this.sortElements);(V=wa.lights.length>0)&&Ha(wa);Wa=0;for(ha=h.length;Wa<ha;Wa++){Ea=h[Wa];S.empty();if(Ea instanceof THREE.RenderableParticle){N=Ea;N.x*=t;N.y*=v;Ra=0;for(ib=Ea.materials.length;Ra<ib;){Ja=Ea.materials[Ra++];Ja.opacity!=
0&&P(N,Ea,Ja,wa)}}else if(Ea instanceof THREE.RenderableLine){N=Ea.v1;J=Ea.v2;N.positionScreen.x*=t;N.positionScreen.y*=v;J.positionScreen.x*=t;J.positionScreen.y*=v;S.addPoint(N.positionScreen.x,N.positionScreen.y);S.addPoint(J.positionScreen.x,J.positionScreen.y);if(H.instersects(S)){Ra=0;for(ib=Ea.materials.length;Ra<ib;){Ja=Ea.materials[Ra++];Ja.opacity!=0&&ta(N,J,Ea,Ja,wa)}}}else if(Ea instanceof THREE.RenderableFace3){N=Ea.v1;J=Ea.v2;K=Ea.v3;N.positionScreen.x*=t;N.positionScreen.y*=v;J.positionScreen.x*=
t;J.positionScreen.y*=v;K.positionScreen.x*=t;K.positionScreen.y*=v;if(Ea.overdraw){Za(N.positionScreen,J.positionScreen);Za(J.positionScreen,K.positionScreen);Za(K.positionScreen,N.positionScreen)}S.add3Points(N.positionScreen.x,N.positionScreen.y,J.positionScreen.x,J.positionScreen.y,K.positionScreen.x,K.positionScreen.y);if(H.instersects(S)){Ra=0;for(ib=Ea.meshMaterials.length;Ra<ib;){Ja=Ea.meshMaterials[Ra++];if(Ja instanceof THREE.MeshFaceMaterial){mb=0;for(cb=Ea.faceMaterials.length;mb<cb;)(Ja=
Ea.faceMaterials[mb++])&&Ja.opacity!=0&&F(N,J,K,0,1,2,Ea,Ja,wa)}else Ja.opacity!=0&&F(N,J,K,0,1,2,Ea,Ja,wa)}}}else if(Ea instanceof THREE.RenderableFace4){N=Ea.v1;J=Ea.v2;K=Ea.v3;L=Ea.v4;N.positionScreen.x*=t;N.positionScreen.y*=v;J.positionScreen.x*=t;J.positionScreen.y*=v;K.positionScreen.x*=t;K.positionScreen.y*=v;L.positionScreen.x*=t;L.positionScreen.y*=v;aa.positionScreen.copy(J.positionScreen);o.positionScreen.copy(L.positionScreen);if(Ea.overdraw){Za(N.positionScreen,J.positionScreen);Za(J.positionScreen,
L.positionScreen);Za(L.positionScreen,N.positionScreen);Za(K.positionScreen,aa.positionScreen);Za(K.positionScreen,o.positionScreen)}S.addPoint(N.positionScreen.x,N.positionScreen.y);S.addPoint(J.positionScreen.x,J.positionScreen.y);S.addPoint(K.positionScreen.x,K.positionScreen.y);S.addPoint(L.positionScreen.x,L.positionScreen.y);if(H.instersects(S)){Ra=0;for(ib=Ea.meshMaterials.length;Ra<ib;){Ja=Ea.meshMaterials[Ra++];if(Ja instanceof THREE.MeshFaceMaterial){mb=0;for(cb=Ea.faceMaterials.length;mb<
cb;)(Ja=Ea.faceMaterials[mb++])&&Ja.opacity!=0&&eb(N,J,K,L,aa,o,Ea,Ja,wa)}else Ja.opacity!=0&&eb(N,J,K,L,aa,o,Ea,Ja,wa)}}}M.addRectangle(S)}u.setTransform(1,0,0,1,0,0)}};
THREE.SVGRenderer=function(){function b($,na,ma){var ra,xa,ua,Ga;ra=0;for(xa=$.lights.length;ra<xa;ra++){ua=$.lights[ra];if(ua instanceof THREE.DirectionalLight){Ga=na.normalWorld.dot(ua.position)*ua.intensity;if(Ga>0){ma.r+=ua.color.r*Ga;ma.g+=ua.color.g*Ga;ma.b+=ua.color.b*Ga}}else if(ua instanceof THREE.PointLight){aa.sub(ua.position,na.centroidWorld);aa.normalize();Ga=na.normalWorld.dot(aa)*ua.intensity;if(Ga>0){ma.r+=ua.color.r*Ga;ma.g+=ua.color.g*Ga;ma.b+=ua.color.b*Ga}}}}function e($,na,ma,
ra,xa,ua){h.data.vertices+=3;h.data.faces++;ga=d(qa++);ga.setAttribute("d","M "+$.positionScreen.x+" "+$.positionScreen.y+" L "+na.positionScreen.x+" "+na.positionScreen.y+" L "+ma.positionScreen.x+","+ma.positionScreen.y+"z");if(xa instanceof THREE.MeshBasicMaterial)B.hex=xa.color.hex;else if(xa instanceof THREE.MeshLambertMaterial)if(D){I.r=N.r;I.g=N.g;I.b=N.b;b(ua,ra,I);B.r=Math.max(0,Math.min(xa.color.r*I.r,1));B.g=Math.max(0,Math.min(xa.color.g*I.g,1));B.b=Math.max(0,Math.min(xa.color.b*I.b,
1));B.updateHex()}else B.hex=xa.color.hex;else if(xa instanceof THREE.MeshDepthMaterial){L=1-xa.__2near/(xa.__farPlusNear-ra.z*xa.__farMinusNear);B.setRGB(L,L,L)}else xa instanceof THREE.MeshNormalMaterial&&B.setRGB(f(ra.normalWorld.x),f(ra.normalWorld.y),f(ra.normalWorld.z));xa.wireframe?ga.setAttribute("style","fill: none; stroke: #"+g(B.hex.toString(16))+"; stroke-width: "+xa.wireframeLinewidth+"; stroke-opacity: "+xa.opacity+"; stroke-linecap: "+xa.wireframeLinecap+"; stroke-linejoin: "+xa.wireframeLinejoin):
ga.setAttribute("style","fill: #"+g(B.hex.toString(16))+"; fill-opacity: "+xa.opacity);n.appendChild(ga)}function c($,na,ma,ra,xa,ua,Ga){h.data.vertices+=4;h.data.faces++;ga=d(qa++);ga.setAttribute("d","M "+$.positionScreen.x+" "+$.positionScreen.y+" L "+na.positionScreen.x+" "+na.positionScreen.y+" L "+ma.positionScreen.x+","+ma.positionScreen.y+" L "+ra.positionScreen.x+","+ra.positionScreen.y+"z");if(ua instanceof THREE.MeshBasicMaterial)B.hex=ua.color.hex;else if(ua instanceof THREE.MeshLambertMaterial)if(D){I.r=
N.r;I.g=N.g;I.b=N.b;b(Ga,xa,I);B.r=Math.max(0,Math.min(ua.color.r*I.r,1));B.g=Math.max(0,Math.min(ua.color.g*I.g,1));B.b=Math.max(0,Math.min(ua.color.b*I.b,1));B.updateHex()}else B.hex=ua.color.hex;else if(ua instanceof THREE.MeshDepthMaterial){L=1-ua.__2near/(ua.__farPlusNear-xa.z*ua.__farMinusNear);B.setRGB(L,L,L)}else ua instanceof THREE.MeshNormalMaterial&&B.setRGB(f(xa.normalWorld.x),f(xa.normalWorld.y),f(xa.normalWorld.z));ua.wireframe?ga.setAttribute("style","fill: none; stroke: #"+g(B.hex.toString(16))+
"; stroke-width: "+ua.wireframeLinewidth+"; stroke-opacity: "+ua.opacity+"; stroke-linecap: "+ua.wireframeLinecap+"; stroke-linejoin: "+ua.wireframeLinejoin):ga.setAttribute("style","fill: #"+g(B.hex.toString(16))+"; fill-opacity: "+ua.opacity);n.appendChild(ga)}function d($){if(o[$]==null){o[$]=document.createElementNS("http://www.w3.org/2000/svg","path");Y==0&&o[$].setAttribute("shape-rendering","crispEdges")}return o[$]}function f($){$=($+1)*0.5;return $<0?0:$>1?1:$}function g($){for(;$.length<
6;)$="0"+$;return $}var h=this,j=null,m=new THREE.Projector,n=document.createElementNS("http://www.w3.org/2000/svg","svg"),p,t,v,u,w,y,z,A,E=new THREE.Rectangle,C=new THREE.Rectangle,D=!1,B=new THREE.Color(16777215),I=new THREE.Color(16777215),N=new THREE.Color(0),J=new THREE.Color(0),K=new THREE.Color(0),L,aa=new THREE.Vector3,o=[],ja=[],ga,qa,U,Y=1;this.domElement=n;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,faces:0};this.setQuality=function($){switch($){case "high":Y=
1;break;case "low":Y=0}};this.setSize=function($,na){p=$;t=na;v=p/2;u=t/2;n.setAttribute("viewBox",-v+" "+-u+" "+p+" "+t);n.setAttribute("width",p);n.setAttribute("height",t);E.set(-v,-u,v,u)};this.clear=function(){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])};this.render=function($,na){var ma,ra,xa,ua,Ga,Ca,pa,za;this.autoClear&&this.clear();h.data.vertices=0;h.data.faces=0;j=m.projectScene($,na,this.sortElements);U=qa=0;if(D=$.lights.length>0){pa=$.lights;N.setRGB(0,0,0);J.setRGB(0,
0,0);K.setRGB(0,0,0);ma=0;for(ra=pa.length;ma<ra;ma++){xa=pa[ma];ua=xa.color;if(xa instanceof THREE.AmbientLight){N.r+=ua.r;N.g+=ua.g;N.b+=ua.b}else if(xa instanceof THREE.DirectionalLight){J.r+=ua.r;J.g+=ua.g;J.b+=ua.b}else if(xa instanceof THREE.PointLight){K.r+=ua.r;K.g+=ua.g;K.b+=ua.b}}}ma=0;for(ra=j.length;ma<ra;ma++){pa=j[ma];C.empty();if(pa instanceof THREE.RenderableParticle){w=pa;w.x*=v;w.y*=-u;xa=0;for(ua=pa.materials.length;xa<ua;)xa++}else if(pa instanceof THREE.RenderableLine){w=pa.v1;
y=pa.v2;w.positionScreen.x*=v;w.positionScreen.y*=-u;y.positionScreen.x*=v;y.positionScreen.y*=-u;C.addPoint(w.positionScreen.x,w.positionScreen.y);C.addPoint(y.positionScreen.x,y.positionScreen.y);if(E.instersects(C)){xa=0;for(ua=pa.materials.length;xa<ua;)if((za=pa.materials[xa++])&&za.opacity!=0){Ga=w;Ca=y;var Ka=U++;if(ja[Ka]==null){ja[Ka]=document.createElementNS("http://www.w3.org/2000/svg","line");Y==0&&ja[Ka].setAttribute("shape-rendering","crispEdges")}ga=ja[Ka];ga.setAttribute("x1",Ga.positionScreen.x);
ga.setAttribute("y1",Ga.positionScreen.y);ga.setAttribute("x2",Ca.positionScreen.x);ga.setAttribute("y2",Ca.positionScreen.y);if(za instanceof THREE.LineBasicMaterial){ga.setAttribute("style","fill: none; stroke: ##"+g(za.color.hex.toString(16))+"; stroke-width: "+za.linewidth+"; stroke-opacity: "+za.opacity+"; stroke-linecap: "+za.linecap+"; stroke-linejoin: "+za.linejoin);n.appendChild(ga)}}}}else if(pa instanceof THREE.RenderableFace3){w=pa.v1;y=pa.v2;z=pa.v3;w.positionScreen.x*=v;w.positionScreen.y*=
-u;y.positionScreen.x*=v;y.positionScreen.y*=-u;z.positionScreen.x*=v;z.positionScreen.y*=-u;C.addPoint(w.positionScreen.x,w.positionScreen.y);C.addPoint(y.positionScreen.x,y.positionScreen.y);C.addPoint(z.positionScreen.x,z.positionScreen.y);if(E.instersects(C)){xa=0;for(ua=pa.meshMaterials.length;xa<ua;){za=pa.meshMaterials[xa++];if(za instanceof THREE.MeshFaceMaterial){Ga=0;for(Ca=pa.faceMaterials.length;Ga<Ca;)(za=pa.faceMaterials[Ga++])&&za.opacity!=0&&e(w,y,z,pa,za,$)}else za&&za.opacity!=0&&
e(w,y,z,pa,za,$)}}}else if(pa instanceof THREE.RenderableFace4){w=pa.v1;y=pa.v2;z=pa.v3;A=pa.v4;w.positionScreen.x*=v;w.positionScreen.y*=-u;y.positionScreen.x*=v;y.positionScreen.y*=-u;z.positionScreen.x*=v;z.positionScreen.y*=-u;A.positionScreen.x*=v;A.positionScreen.y*=-u;C.addPoint(w.positionScreen.x,w.positionScreen.y);C.addPoint(y.positionScreen.x,y.positionScreen.y);C.addPoint(z.positionScreen.x,z.positionScreen.y);C.addPoint(A.positionScreen.x,A.positionScreen.y);if(E.instersects(C)){xa=0;
for(ua=pa.meshMaterials.length;xa<ua;){za=pa.meshMaterials[xa++];if(za instanceof THREE.MeshFaceMaterial){Ga=0;for(Ca=pa.faceMaterials.length;Ga<Ca;)(za=pa.faceMaterials[Ga++])&&za.opacity!=0&&c(w,y,z,A,pa,za,$)}else za&&za.opacity!=0&&c(w,y,z,A,pa,za,$)}}}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",
envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",
map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var e,c,d,f={};for(e=0;e<b.length;e++){d=this.clone(b[e]);for(c in d)f[c]=d[c]}return f},clone:function(b){var e,c,d,f={};for(e in b){f[e]={};for(c in b[e]){d=b[e][c];f[e][c]=d instanceof THREE.Color||d instanceof THREE.Vector3||d instanceof THREE.Texture?d.clone():d}}return f}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function e(x,O,G){var H,M,S,V=x.vertices,Q=V.length,X=x.colors,R=X.length,W=x.__vertexArray,T=x.__colorArray,la=x.__sortArray,ia=x.__dirtyVertices,Da=x.__dirtyColors;if(G.sortParticles){za.multiplySelf(G.matrixWorld);for(H=0;H<Q;H++){M=V[H].position;Xa.copy(M);za.multiplyVector3(Xa);la[H]=[Xa.z,H]}la.sort(function(Ia,Fa){return Fa[0]-Ia[0]});for(H=0;H<Q;H++){M=V[la[H][1]].position;S=H*3;W[S]=M.x;W[S+1]=M.y;W[S+2]=M.z}for(H=0;H<R;H++){S=H*3;color=X[la[H][1]];T[S]=color.r;
T[S+1]=color.g;T[S+2]=color.b}}else{if(ia)for(H=0;H<Q;H++){M=V[H].position;S=H*3;W[S]=M.x;W[S+1]=M.y;W[S+2]=M.z}if(Da)for(H=0;H<R;H++){color=X[H];S=H*3;T[S]=color.r;T[S+1]=color.g;T[S+2]=color.b}}if(ia||G.sortParticles){o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,W,O)}if(Da||G.sortParticles){o.bindBuffer(o.ARRAY_BUFFER,x.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,T,O)}}function c(x,O,G,H,M){H.program||aa.initMaterial(H,O,G,M);var S=H.program,V=S.uniforms,Q=
H.uniforms;if(S!=qa){o.useProgram(S);qa=S}o.uniformMatrix4fv(V.projectionMatrix,!1,Ka);if(G&&(H instanceof THREE.MeshBasicMaterial||H instanceof THREE.MeshLambertMaterial||H instanceof THREE.MeshPhongMaterial||H instanceof THREE.LineBasicMaterial||H instanceof THREE.ParticleBasicMaterial||H.fog)){Q.fogColor.value=G.color;if(G instanceof THREE.Fog){Q.fogNear.value=G.near;Q.fogFar.value=G.far}else if(G instanceof THREE.FogExp2)Q.fogDensity.value=G.density}if(H instanceof THREE.MeshPhongMaterial||H instanceof
THREE.MeshLambertMaterial||H.lights){var X,R,W=0,T=0,la=0,ia,Da,Ia,Fa,Ma=Z,Ya=Ma.directional.colors,wa=Ma.directional.positions,Ba=Ma.point.colors,Ha=Ma.point.positions,Qa=Ma.point.distances,P=0,ta=0;G=0;for(X=O.length;G<X;G++){R=O[G];ia=R.color;Da=R.position;Ia=R.intensity;Fa=R.distance;if(R instanceof THREE.AmbientLight){W+=ia.r;T+=ia.g;la+=ia.b}else if(R instanceof THREE.DirectionalLight){Fa=P*3;Ya[Fa]=ia.r*Ia;Ya[Fa+1]=ia.g*Ia;Ya[Fa+2]=ia.b*Ia;wa[Fa]=Da.x;wa[Fa+1]=Da.y;wa[Fa+2]=Da.z;P+=1}else if(R instanceof
THREE.PointLight){R=ta*3;Ba[R]=ia.r*Ia;Ba[R+1]=ia.g*Ia;Ba[R+2]=ia.b*Ia;Ha[R]=Da.x;Ha[R+1]=Da.y;Ha[R+2]=Da.z;Qa[ta]=Fa;ta+=1}}for(G=P*3;G<Ya.length;G++)Ya[G]=0;for(G=ta*3;G<Ba.length;G++)Ba[G]=0;Ma.point.length=ta;Ma.directional.length=P;Ma.ambient[0]=W;Ma.ambient[1]=T;Ma.ambient[2]=la;G=Z;Q.enableLighting.value=G.directional.length+G.point.length;Q.ambientLightColor.value=G.ambient;Q.directionalLightColor.value=G.directional.colors;Q.directionalLightDirection.value=G.directional.positions;Q.pointLightColor.value=
G.point.colors;Q.pointLightPosition.value=G.point.positions;Q.pointLightDistance.value=G.point.distances}if(H instanceof THREE.MeshBasicMaterial||H instanceof THREE.MeshLambertMaterial||H instanceof THREE.MeshPhongMaterial){Q.diffuse.value=H.color;Q.opacity.value=H.opacity;Q.map.texture=H.map;Q.lightMap.texture=H.lightMap;Q.envMap.texture=H.envMap;Q.reflectivity.value=H.reflectivity;Q.refractionRatio.value=H.refractionRatio;Q.combine.value=H.combine;Q.useRefract.value=H.envMap&&H.envMap.mapping instanceof
THREE.CubeRefractionMapping}if(H instanceof THREE.LineBasicMaterial){Q.diffuse.value=H.color;Q.opacity.value=H.opacity}else if(H instanceof THREE.ParticleBasicMaterial){Q.psColor.value=H.color;Q.opacity.value=H.opacity;Q.size.value=H.size;Q.scale.value=ja.height/2;Q.map.texture=H.map}else if(H instanceof THREE.MeshPhongMaterial){Q.ambient.value=H.ambient;Q.specular.value=H.specular;Q.shininess.value=H.shininess}else if(H instanceof THREE.MeshDepthMaterial){Q.mNear.value=x.near;Q.mFar.value=x.far;
Q.opacity.value=H.opacity}else if(H instanceof THREE.MeshNormalMaterial)Q.opacity.value=H.opacity;for(var F in Q)if(T=S.uniforms[F]){X=Q[F];W=X.type;G=X.value;if(W=="i")o.uniform1i(T,G);else if(W=="f")o.uniform1f(T,G);else if(W=="fv1")o.uniform1fv(T,G);else if(W=="fv")o.uniform3fv(T,G);else if(W=="v2")o.uniform2f(T,G.x,G.y);else if(W=="v3")o.uniform3f(T,G.x,G.y,G.z);else if(W=="v4")o.uniform4f(T,G.x,G.y,G.z,G.w);else if(W=="c")o.uniform3f(T,G.r,G.g,G.b);else if(W=="t"){o.uniform1i(T,G);if(X=X.texture)if(X.image instanceof
Array&&X.image.length==6){if(X.image.length==6){if(X.needsUpdate){if(X.__webglInit){o.bindTexture(o.TEXTURE_CUBE_MAP,X.image.__webglTextureCube);for(W=0;W<6;++W)o.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,o.RGBA,o.UNSIGNED_BYTE,X.image[W])}else{X.image.__webglTextureCube=o.createTexture();o.bindTexture(o.TEXTURE_CUBE_MAP,X.image.__webglTextureCube);for(W=0;W<6;++W)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,X.image[W]);X.__webglInit=!0}B(o.TEXTURE_CUBE_MAP,
X,X.image[0]);o.bindTexture(o.TEXTURE_CUBE_MAP,null);X.needsUpdate=!1}o.activeTexture(o.TEXTURE0+G);o.bindTexture(o.TEXTURE_CUBE_MAP,X.image.__webglTextureCube)}}else I(X,G)}}o.uniformMatrix4fv(V.modelViewMatrix,!1,M._modelViewMatrixArray);o.uniformMatrix3fv(V.normalMatrix,!1,M._normalMatrixArray);(H instanceof THREE.MeshShaderMaterial||H instanceof THREE.MeshPhongMaterial||H.envMap)&&V.cameraPosition!==null&&o.uniform3f(V.cameraPosition,x.position.x,x.position.y,x.position.z);(H instanceof THREE.MeshShaderMaterial||
H.envMap||H.skinning)&&V.objectMatrix!==null&&o.uniformMatrix4fv(V.objectMatrix,!1,M._objectMatrixArray);(H instanceof THREE.MeshPhongMaterial||H instanceof THREE.MeshLambertMaterial||H instanceof THREE.MeshShaderMaterial||H.skinning)&&V.viewMatrix!==null&&o.uniformMatrix4fv(V.viewMatrix,!1,Ta);if(H instanceof THREE.ShadowVolumeDynamicMaterial){x=Q.directionalLightDirection.value;x[0]=-O[1].position.x;x[1]=-O[1].position.y;x[2]=-O[1].position.z;o.uniform3fv(V.directionalLightDirection,x);o.uniformMatrix4fv(V.objectMatrix,
!1,M._objectMatrixArray);o.uniformMatrix4fv(V.viewMatrix,!1,Ta)}if(H.skinning){o.uniformMatrix4fv(V.cameraInverseMatrix,!1,Ta);o.uniformMatrix4fv(V.boneGlobalMatrices,!1,M.boneMatrices)}return S}function d(x,O,G,H,M,S){if(H.opacity!=0){var V;x=c(x,O,G,H,S).attributes;if(!H.morphTargets&&x.position>=0){o.bindBuffer(o.ARRAY_BUFFER,M.__webglVertexBuffer);o.vertexAttribPointer(x.position,3,o.FLOAT,!1,0,0)}else{O=H.program.attributes;if(S.morphTargetBase!==-1){o.bindBuffer(o.ARRAY_BUFFER,M.__webglMorphTargetsBuffers[S.morphTargetBase]);
o.vertexAttribPointer(O.position,3,o.FLOAT,!1,0,0)}else if(O.position>=0){o.bindBuffer(o.ARRAY_BUFFER,M.__webglVertexBuffer);o.vertexAttribPointer(O.position,3,o.FLOAT,!1,0,0)}if(S.morphTargetForcedOrder.length){G=0;for(var Q=S.morphTargetForcedOrder,X=S.morphTargetInfluences;G<H.numSupportedMorphTargets&&G<Q.length;){o.bindBuffer(o.ARRAY_BUFFER,M.__webglMorphTargetsBuffers[Q[G]]);o.vertexAttribPointer(O["morphTarget"+G],3,o.FLOAT,!1,0,0);S.__webglMorphTargetInfluences[G]=X[Q[G]];G++}}else{Q=[];var R=
-1,W=0;X=S.morphTargetInfluences;var T,la=X.length;G=0;for(S.morphTargetBase!==-1&&(Q[S.morphTargetBase]=!0);G<H.numSupportedMorphTargets;){for(T=0;T<la;T++)if(!Q[T]&&X[T]>R){W=T;R=X[W]}o.bindBuffer(o.ARRAY_BUFFER,M.__webglMorphTargetsBuffers[W]);o.vertexAttribPointer(O["morphTarget"+G],3,o.FLOAT,!1,0,0);S.__webglMorphTargetInfluences[G]=R;Q[W]=1;R=-1;G++}}H.program.uniforms.morphTargetInfluences!==null&&o.uniform1fv(H.program.uniforms.morphTargetInfluences,S.__webglMorphTargetInfluences)}if(H.attributes)for(V in H.attributes)if(x[V]>=
0){O=H.attributes[V];o.bindBuffer(o.ARRAY_BUFFER,O.buffer);o.vertexAttribPointer(x[V],O.size,o.FLOAT,!1,0,0)}if(x.color>=0){o.bindBuffer(o.ARRAY_BUFFER,M.__webglColorBuffer);o.vertexAttribPointer(x.color,3,o.FLOAT,!1,0,0)}if(x.normal>=0){o.bindBuffer(o.ARRAY_BUFFER,M.__webglNormalBuffer);o.vertexAttribPointer(x.normal,3,o.FLOAT,!1,0,0)}if(x.tangent>=0){o.bindBuffer(o.ARRAY_BUFFER,M.__webglTangentBuffer);o.vertexAttribPointer(x.tangent,4,o.FLOAT,!1,0,0)}if(x.uv>=0)if(M.__webglUVBuffer){o.bindBuffer(o.ARRAY_BUFFER,
M.__webglUVBuffer);o.vertexAttribPointer(x.uv,2,o.FLOAT,!1,0,0);o.enableVertexAttribArray(x.uv)}else o.disableVertexAttribArray(x.uv);if(x.uv2>=0)if(M.__webglUV2Buffer){o.bindBuffer(o.ARRAY_BUFFER,M.__webglUV2Buffer);o.vertexAttribPointer(x.uv2,2,o.FLOAT,!1,0,0);o.enableVertexAttribArray(x.uv2)}else o.disableVertexAttribArray(x.uv2);if(H.skinning&&x.skinVertexA>=0&&x.skinVertexB>=0&&x.skinIndex>=0&&x.skinWeight>=0){o.bindBuffer(o.ARRAY_BUFFER,M.__webglSkinVertexABuffer);o.vertexAttribPointer(x.skinVertexA,
4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,M.__webglSkinVertexBBuffer);o.vertexAttribPointer(x.skinVertexB,4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,M.__webglSkinIndicesBuffer);o.vertexAttribPointer(x.skinIndex,4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,M.__webglSkinWeightsBuffer);o.vertexAttribPointer(x.skinWeight,4,o.FLOAT,!1,0,0)}if(S instanceof THREE.Mesh){if(H.wireframe){o.lineWidth(H.wireframeLinewidth);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,M.__webglLineBuffer);o.drawElements(o.LINES,
M.__webglLineCount,o.UNSIGNED_SHORT,0)}else{o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,M.__webglFaceBuffer);o.drawElements(o.TRIANGLES,M.__webglFaceCount,o.UNSIGNED_SHORT,0)}aa.data.vertices+=M.__webglFaceCount;aa.data.faces+=M.__webglFaceCount/3;aa.data.drawCalls++}else if(S instanceof THREE.Line){S=S.type==THREE.LineStrip?o.LINE_STRIP:o.LINES;o.lineWidth(H.linewidth);o.drawArrays(S,0,M.__webglLineCount);aa.data.drawCalls++}else if(S instanceof THREE.ParticleSystem){o.drawArrays(o.POINTS,0,M.__webglParticleCount);
aa.data.drawCalls++}else if(S instanceof THREE.Ribbon){o.drawArrays(o.TRIANGLE_STRIP,0,M.__webglVertexCount);aa.data.drawCalls++}}}function f(x,O,G){if(!x.__webglVertexBuffer)x.__webglVertexBuffer=o.createBuffer();if(!x.__webglNormalBuffer)x.__webglNormalBuffer=o.createBuffer();if(x.hasPos){o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,x.positionArray,o.DYNAMIC_DRAW);o.enableVertexAttribArray(O.attributes.position);o.vertexAttribPointer(O.attributes.position,3,o.FLOAT,
!1,0,0)}if(x.hasNormal){o.bindBuffer(o.ARRAY_BUFFER,x.__webglNormalBuffer);if(G==THREE.FlatShading){var H,M,S,V,Q,X,R,W,T,la,ia=x.count*3;for(la=0;la<ia;la+=9){G=x.normalArray;H=G[la];M=G[la+1];S=G[la+2];V=G[la+3];X=G[la+4];W=G[la+5];Q=G[la+6];R=G[la+7];T=G[la+8];H=(H+V+Q)/3;M=(M+X+R)/3;S=(S+W+T)/3;G[la]=H;G[la+1]=M;G[la+2]=S;G[la+3]=H;G[la+4]=M;G[la+5]=S;G[la+6]=H;G[la+7]=M;G[la+8]=S}}o.bufferData(o.ARRAY_BUFFER,x.normalArray,o.DYNAMIC_DRAW);o.enableVertexAttribArray(O.attributes.normal);o.vertexAttribPointer(O.attributes.normal,
3,o.FLOAT,!1,0,0)}o.drawArrays(o.TRIANGLES,0,x.count);x.count=0}function g(x){if($!=x.doubleSided){x.doubleSided?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE);$=x.doubleSided}if(na!=x.flipSided){x.flipSided?o.frontFace(o.CW):o.frontFace(o.CCW);na=x.flipSided}}function h(x){if(ra!=x){x?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST);ra=x}}function j(x){pa[0].set(x.n41-x.n11,x.n42-x.n12,x.n43-x.n13,x.n44-x.n14);pa[1].set(x.n41+x.n11,x.n42+x.n12,x.n43+x.n13,x.n44+x.n14);pa[2].set(x.n41+x.n21,x.n42+x.n22,
x.n43+x.n23,x.n44+x.n24);pa[3].set(x.n41-x.n21,x.n42-x.n22,x.n43-x.n23,x.n44-x.n24);pa[4].set(x.n41-x.n31,x.n42-x.n32,x.n43-x.n33,x.n44-x.n34);pa[5].set(x.n41+x.n31,x.n42+x.n32,x.n43+x.n33,x.n44+x.n34);var O;for(x=0;x<6;x++){O=pa[x];O.divideScalar(Math.sqrt(O.x*O.x+O.y*O.y+O.z*O.z))}}function m(x){for(var O=x.matrixWorld,G=-x.geometry.boundingSphere.radius*Math.max(x.scale.x,Math.max(x.scale.y,x.scale.z)),H=0;H<6;H++){x=pa[H].x*O.n14+pa[H].y*O.n24+pa[H].z*O.n34+pa[H].w;if(x<=G)return!1}return!0}function n(x,
O){x.list[x.count]=O;x.count+=1}function p(x){var O,G,H=x.object,M=x.opaque,S=x.transparent;S.count=0;x=M.count=0;for(O=H.materials.length;x<O;x++){G=H.materials[x];G.transparent?n(S,G):n(M,G)}}function t(x){var O,G,H,M,S=x.object,V=x.buffer,Q=x.opaque,X=x.transparent;X.count=0;x=Q.count=0;for(H=S.materials.length;x<H;x++){O=S.materials[x];if(O instanceof THREE.MeshFaceMaterial){O=0;for(G=V.materials.length;O<G;O++)(M=V.materials[O])&&(M.transparent?n(X,M):n(Q,M))}else(M=O)&&(M.transparent?n(X,M):
n(Q,M))}}function v(x,O){return O.z-x.z}function u(x){o.enable(o.POLYGON_OFFSET_FILL);o.polygonOffset(0.1,1);o.enable(o.STENCIL_TEST);o.enable(o.DEPTH_TEST);o.depthMask(!1);o.colorMask(!1,!1,!1,!1);o.stencilFunc(o.ALWAYS,1,255);o.stencilOpSeparate(o.BACK,o.KEEP,o.INCR,o.KEEP);o.stencilOpSeparate(o.FRONT,o.KEEP,o.DECR,o.KEEP);var O,G=x.lights.length,H,M=x.lights,S=[],V,Q,X,R,W,T=x.__webglShadowVolumes.length;for(O=0;O<G;O++){H=x.lights[O];if(H instanceof THREE.DirectionalLight&&H.castShadow){S[0]=
-H.position.x;S[1]=-H.position.y;S[2]=-H.position.z;for(W=0;W<T;W++){H=x.__webglShadowVolumes[W].object;V=x.__webglShadowVolumes[W].buffer;Q=H.materials[0];Q.program||aa.initMaterial(Q,M,undefined,H);Q=Q.program;X=Q.uniforms;R=Q.attributes;if(qa!==Q){o.useProgram(Q);qa=Q;o.uniformMatrix4fv(X.projectionMatrix,!1,Ka);o.uniformMatrix4fv(X.viewMatrix,!1,Ta);o.uniform3fv(X.directionalLightDirection,S)}H.matrixWorld.flattenToArray(H._objectMatrixArray);o.uniformMatrix4fv(X.objectMatrix,!1,H._objectMatrixArray);
o.bindBuffer(o.ARRAY_BUFFER,V.__webglVertexBuffer);o.vertexAttribPointer(R.position,3,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,V.__webglNormalBuffer);o.vertexAttribPointer(R.normal,3,o.FLOAT,!1,0,0);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,V.__webglFaceBuffer);o.cullFace(o.FRONT);o.drawElements(o.TRIANGLES,V.__webglFaceCount,o.UNSIGNED_SHORT,0);o.cullFace(o.BACK);o.drawElements(o.TRIANGLES,V.__webglFaceCount,o.UNSIGNED_SHORT,0)}}}o.disable(o.POLYGON_OFFSET_FILL);o.colorMask(!0,!0,!0,!0);o.stencilFunc(o.NOTEQUAL,
0,255);o.stencilOp(o.KEEP,o.KEEP,o.KEEP);o.disable(o.DEPTH_TEST);ma="";qa=ca.program;o.useProgram(ca.program);o.uniformMatrix4fv(ca.projectionLocation,!1,Ka);o.uniform1f(ca.darknessLocation,ca.darkness);o.bindBuffer(o.ARRAY_BUFFER,ca.vertexBuffer);o.vertexAttribPointer(ca.vertexLocation,3,o.FLOAT,!1,0,0);o.enableVertexAttribArray(ca.vertexLocation);o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA);o.blendEquation(o.FUNC_ADD);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);o.drawElements(o.TRIANGLES,
6,o.UNSIGNED_SHORT,0);o.disable(o.STENCIL_TEST);o.enable(o.DEPTH_TEST);o.depthMask(Y)}function w(x,O){var G,H,M;G=_sprite.attributes;var S=_sprite.uniforms,V=Ca/Ga,Q,X=[],R=Ga*0.5,W=Ca*0.5,T=!0;o.useProgram(_sprite.program);qa=_sprite.program;ma="";if(!bb){o.enableVertexAttribArray(_sprite.attributes.position);o.enableVertexAttribArray(_sprite.attributes.uv);bb=!0}o.disable(o.CULL_FACE);o.enable(o.BLEND);o.depthMask(!0);o.bindBuffer(o.ARRAY_BUFFER,_sprite.vertexBuffer);o.vertexAttribPointer(G.position,
2,o.FLOAT,!1,16,0);o.vertexAttribPointer(G.uv,2,o.FLOAT,!1,16,8);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);o.uniformMatrix4fv(S.projectionMatrix,!1,Ka);o.activeTexture(o.TEXTURE0);o.uniform1i(S.map,0);G=0;for(H=x.__webglSprites.length;G<H;G++){M=x.__webglSprites[G];if(M.useScreenCoordinates)M.z=-M.position.z;else{M._modelViewMatrix.multiplyToArray(O.matrixWorldInverse,M.matrixWorld,M._modelViewMatrixArray);M.z=-M._modelViewMatrix.n34}}x.__webglSprites.sort(v);G=0;for(H=x.__webglSprites.length;G<
H;G++){M=x.__webglSprites[G];if(M.material===undefined&&M.map&&M.map.image&&M.map.image.width){if(M.useScreenCoordinates){o.uniform1i(S.useScreenCoordinates,1);o.uniform3f(S.screenPosition,(M.position.x-R)/R,(W-M.position.y)/W,Math.max(0,Math.min(1,M.position.z)))}else{o.uniform1i(S.useScreenCoordinates,0);o.uniform1i(S.affectedByDistance,M.affectedByDistance?1:0);o.uniformMatrix4fv(S.modelViewMatrix,!1,M._modelViewMatrixArray)}Q=M.map.image.width/(M.affectedByDistance?1:Ca);X[0]=Q*V*M.scale.x;X[1]=
Q*M.scale.y;o.uniform2f(S.uvScale,M.uvScale.x,M.uvScale.y);o.uniform2f(S.uvOffset,M.uvOffset.x,M.uvOffset.y);o.uniform2f(S.alignment,M.alignment.x,M.alignment.y);o.uniform1f(S.opacity,M.opacity);o.uniform1f(S.rotation,M.rotation);o.uniform2fv(S.scale,X);if(M.mergeWith3D&&!T){o.enable(o.DEPTH_TEST);T=!0}else if(!M.mergeWith3D&&T){o.disable(o.DEPTH_TEST);T=!1}D(M.blending);I(M.map,0);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}}o.enable(o.CULL_FACE);o.enable(o.DEPTH_TEST);o.depthMask(Y)}function y(x,
O){var G,H,M=x.__webglLensFlares.length,S,V,Q,X=new THREE.Vector3,R=Ca/Ga,W=Ga*0.5,T=Ca*0.5,la=16/Ca,ia=[la*R,la],Da=[1,1,0],Ia=[1,1],Fa=da.uniforms;G=da.attributes;o.useProgram(da.program);qa=da.program;ma="";if(!Na){o.enableVertexAttribArray(da.attributes.vertex);o.enableVertexAttribArray(da.attributes.uv);Na=!0}o.uniform1i(Fa.occlusionMap,0);o.uniform1i(Fa.map,1);o.bindBuffer(o.ARRAY_BUFFER,da.vertexBuffer);o.vertexAttribPointer(G.vertex,2,o.FLOAT,!1,16,0);o.vertexAttribPointer(G.uv,2,o.FLOAT,
!1,16,8);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,da.elementBuffer);o.disable(o.CULL_FACE);o.depthMask(!1);o.activeTexture(o.TEXTURE0);o.bindTexture(o.TEXTURE_2D,da.occlusionTexture);o.activeTexture(o.TEXTURE1);for(H=0;H<M;H++){G=x.__webglLensFlares[H].object;X.set(G.matrixWorld.n14,G.matrixWorld.n24,G.matrixWorld.n34);O.matrixWorldInverse.multiplyVector3(X);O.projectionMatrix.multiplyVector3(X);Da[0]=X.x;Da[1]=X.y;Da[2]=X.z;Ia[0]=Da[0]*W+W;Ia[1]=Da[1]*T+T;if(da.hasVertexTexture||Ia[0]>0&&Ia[0]<Ga&&Ia[1]>
0&&Ia[1]<Ca){o.bindTexture(o.TEXTURE_2D,da.tempTexture);o.copyTexImage2D(o.TEXTURE_2D,0,o.RGB,Ia[0]-8,Ia[1]-8,16,16,0);o.uniform1i(Fa.renderType,0);o.uniform2fv(Fa.scale,ia);o.uniform3fv(Fa.screenPosition,Da);o.disable(o.BLEND);o.enable(o.DEPTH_TEST);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0);o.bindTexture(o.TEXTURE_2D,da.occlusionTexture);o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,Ia[0]-8,Ia[1]-8,16,16,0);o.uniform1i(Fa.renderType,1);o.disable(o.DEPTH_TEST);o.bindTexture(o.TEXTURE_2D,da.tempTexture);
o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0);G.positionScreen.x=Da[0];G.positionScreen.y=Da[1];G.positionScreen.z=Da[2];G.customUpdateCallback?G.customUpdateCallback(G):G.updateLensFlares();o.uniform1i(Fa.renderType,2);o.enable(o.BLEND);S=0;for(V=G.lensFlares.length;S<V;S++){Q=G.lensFlares[S];if(Q.opacity>0.0010&&Q.scale>0.0010){Da[0]=Q.x;Da[1]=Q.y;Da[2]=Q.z;la=Q.size*Q.scale/Ca;ia[0]=la*R;ia[1]=la;o.uniform3fv(Fa.screenPosition,Da);o.uniform2fv(Fa.scale,ia);o.uniform1f(Fa.rotation,Q.rotation);
o.uniform1f(Fa.opacity,Q.opacity);D(Q.blending);I(Q.texture,1);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}}}}o.enable(o.CULL_FACE);o.enable(o.DEPTH_TEST);o.depthMask(Y)}function z(x,O){x._modelViewMatrix.multiplyToArray(O.matrixWorldInverse,x.matrixWorld,x._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(x._modelViewMatrix).transposeIntoArray(x._normalMatrixArray)}function A(x){var O,G,H,M,S;if(x instanceof THREE.Mesh){G=x.geometry;for(O in G.geometryGroups){H=G.geometryGroups[O];S=!1;for(M in H.__webglCustomAttributes)if(H.__webglCustomAttributes[M].needsUpdate){S=
!0;break}if(G.__dirtyVertices||G.__dirtyMorphTargets||G.__dirtyElements||G.__dirtyUvs||G.__dirtyNormals||G.__dirtyColors||G.__dirtyTangents||S){S=o.DYNAMIC_DRAW;var V=void 0,Q=void 0,X=void 0,R=void 0,W=void 0,T=void 0,la=void 0,ia=void 0,Da=void 0,Ia=void 0,Fa=void 0,Ma=void 0,Ya=void 0,wa=void 0,Ba=void 0,Ha=void 0,Qa=void 0,P=void 0,ta=void 0,F=void 0,eb=void 0,hb=void 0,Va=0,Ua=0,gb=0,db=0,ab=0,$a=0,Pa=0,Za=0,Wa=0,ha=0,Ea=0,Ra=H.__vertexArray,ib=H.__uvArray,mb=H.__uv2Array,cb=H.__normalArray,
Ja=H.__tangentArray,ea=H.__colorArray,va=H.__skinVertexAArray,sa=H.__skinVertexBArray,oa=H.__skinIndexArray,Aa=H.__skinWeightArray,Oa=H.__morphTargetsArrays,ya=H.__webglCustomAttributes,fa=H.__faceArray,La=H.__lineArray,lb=H.__needsSmoothNormals;Ia=H.__vertexColorType;Da=H.__uvType;Fa=H.__normalType;var Sa=x.geometry,jb=Sa.__dirtyVertices,nb=Sa.__dirtyElements,fb=Sa.__dirtyUvs,kb=Sa.__dirtyNormals,ub=Sa.__dirtyTangents,vb=Sa.__dirtyColors,wb=Sa.__dirtyMorphTargets,qb=Sa.vertices,xb=H.faces,Ab=Sa.faces,
yb=Sa.faceVertexUvs[0],zb=Sa.faceVertexUvs[1],rb=Sa.skinVerticesA,sb=Sa.skinVerticesB,tb=Sa.skinIndices,ob=Sa.skinWeights,pb=x instanceof THREE.ShadowVolume?Sa.edgeFaces:undefined;morphTargets=Sa.morphTargets;if(ya)for(hb in ya){ya[hb].offset=0;ya[hb].offsetSrc=0}V=0;for(Q=xb.length;V<Q;V++){X=xb[V];R=Ab[X];yb&&(Ma=yb[X]);zb&&(Ya=zb[X]);X=R.vertexNormals;W=R.normal;T=R.vertexColors;la=R.color;ia=R.vertexTangents;if(R instanceof THREE.Face3){if(jb){wa=qb[R.a].position;Ba=qb[R.b].position;Ha=qb[R.c].position;
Ra[Ua]=wa.x;Ra[Ua+1]=wa.y;Ra[Ua+2]=wa.z;Ra[Ua+3]=Ba.x;Ra[Ua+4]=Ba.y;Ra[Ua+5]=Ba.z;Ra[Ua+6]=Ha.x;Ra[Ua+7]=Ha.y;Ra[Ua+8]=Ha.z;Ua+=9}if(ya)for(hb in ya){F=ya[hb];if(F.needsUpdate){P=F.offset;ta=F.offsetSrc;if(F.size===1){if(F.boundTo===undefined||F.boundTo==="vertices"){F.array[P+0]=F.value[R.a];F.array[P+1]=F.value[R.b];F.array[P+2]=F.value[R.c]}else if(F.boundTo==="faces"){F.array[P+0]=F.value[ta];F.array[P+1]=F.value[ta];F.array[P+2]=F.value[ta];F.offsetSrc++}else if(F.boundTo==="faceVertices"){F.array[P+
0]=F.value[ta+0];F.array[P+1]=F.value[ta+1];F.array[P+2]=F.value[ta+2];F.offsetSrc+=3}F.offset+=3}else{if(F.boundTo===undefined||F.boundTo==="vertices"){wa=F.value[R.a];Ba=F.value[R.b];Ha=F.value[R.c]}else if(F.boundTo==="faces"){wa=F.value[ta];Ba=F.value[ta];Ha=F.value[ta];F.offsetSrc++}else if(F.boundTo==="faceVertices"){wa=F.value[ta+0];Ba=F.value[ta+1];Ha=F.value[ta+2];F.offsetSrc+=3}if(F.size===2){F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=Ba.x;F.array[P+3]=Ba.y;F.array[P+4]=Ha.x;F.array[P+
5]=Ha.y;F.offset+=6}else if(F.size===3){if(F.type==="c"){F.array[P+0]=wa.r;F.array[P+1]=wa.g;F.array[P+2]=wa.b;F.array[P+3]=Ba.r;F.array[P+4]=Ba.g;F.array[P+5]=Ba.b;F.array[P+6]=Ha.r;F.array[P+7]=Ha.g;F.array[P+8]=Ha.b}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;F.array[P+3]=Ba.x;F.array[P+4]=Ba.y;F.array[P+5]=Ba.z;F.array[P+6]=Ha.x;F.array[P+7]=Ha.y;F.array[P+8]=Ha.z}F.offset+=9}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;F.array[P+3]=wa.w;F.array[P+4]=Ba.x;F.array[P+
5]=Ba.y;F.array[P+6]=Ba.z;F.array[P+7]=Ba.w;F.array[P+8]=Ha.x;F.array[P+9]=Ha.y;F.array[P+10]=Ha.z;F.array[P+11]=Ha.w;F.offset+=12}}}}if(wb){P=0;for(ta=morphTargets.length;P<ta;P++){wa=morphTargets[P].vertices[R.a].position;Ba=morphTargets[P].vertices[R.b].position;Ha=morphTargets[P].vertices[R.c].position;F=Oa[P];F[Ea+0]=wa.x;F[Ea+1]=wa.y;F[Ea+2]=wa.z;F[Ea+3]=Ba.x;F[Ea+4]=Ba.y;F[Ea+5]=Ba.z;F[Ea+6]=Ha.x;F[Ea+7]=Ha.y;F[Ea+8]=Ha.z}Ea+=9}if(ob.length){P=ob[R.a];ta=ob[R.b];F=ob[R.c];Aa[ha]=P.x;Aa[ha+
1]=P.y;Aa[ha+2]=P.z;Aa[ha+3]=P.w;Aa[ha+4]=ta.x;Aa[ha+5]=ta.y;Aa[ha+6]=ta.z;Aa[ha+7]=ta.w;Aa[ha+8]=F.x;Aa[ha+9]=F.y;Aa[ha+10]=F.z;Aa[ha+11]=F.w;P=tb[R.a];ta=tb[R.b];F=tb[R.c];oa[ha]=P.x;oa[ha+1]=P.y;oa[ha+2]=P.z;oa[ha+3]=P.w;oa[ha+4]=ta.x;oa[ha+5]=ta.y;oa[ha+6]=ta.z;oa[ha+7]=ta.w;oa[ha+8]=F.x;oa[ha+9]=F.y;oa[ha+10]=F.z;oa[ha+11]=F.w;P=rb[R.a];ta=rb[R.b];F=rb[R.c];va[ha]=P.x;va[ha+1]=P.y;va[ha+2]=P.z;va[ha+3]=1;va[ha+4]=ta.x;va[ha+5]=ta.y;va[ha+6]=ta.z;va[ha+7]=1;va[ha+8]=F.x;va[ha+9]=F.y;va[ha+10]=
F.z;va[ha+11]=1;P=sb[R.a];ta=sb[R.b];F=sb[R.c];sa[ha]=P.x;sa[ha+1]=P.y;sa[ha+2]=P.z;sa[ha+3]=1;sa[ha+4]=ta.x;sa[ha+5]=ta.y;sa[ha+6]=ta.z;sa[ha+7]=1;sa[ha+8]=F.x;sa[ha+9]=F.y;sa[ha+10]=F.z;sa[ha+11]=1;ha+=12}if(vb&&Ia){if(T.length==3&&Ia==THREE.VertexColors){R=T[0];P=T[1];ta=T[2]}else ta=P=R=la;ea[Wa]=R.r;ea[Wa+1]=R.g;ea[Wa+2]=R.b;ea[Wa+3]=P.r;ea[Wa+4]=P.g;ea[Wa+5]=P.b;ea[Wa+6]=ta.r;ea[Wa+7]=ta.g;ea[Wa+8]=ta.b;Wa+=9}if(ub&&Sa.hasTangents){T=ia[0];la=ia[1];R=ia[2];Ja[Pa]=T.x;Ja[Pa+1]=T.y;Ja[Pa+2]=T.z;
Ja[Pa+3]=T.w;Ja[Pa+4]=la.x;Ja[Pa+5]=la.y;Ja[Pa+6]=la.z;Ja[Pa+7]=la.w;Ja[Pa+8]=R.x;Ja[Pa+9]=R.y;Ja[Pa+10]=R.z;Ja[Pa+11]=R.w;Pa+=12}if(kb&&Fa)if(X.length==3&&lb)for(ia=0;ia<3;ia++){W=X[ia];cb[$a]=W.x;cb[$a+1]=W.y;cb[$a+2]=W.z;$a+=3}else for(ia=0;ia<3;ia++){cb[$a]=W.x;cb[$a+1]=W.y;cb[$a+2]=W.z;$a+=3}if(fb&&Ma!==undefined&&Da)for(ia=0;ia<3;ia++){X=Ma[ia];ib[gb]=X.u;ib[gb+1]=X.v;gb+=2}if(fb&&Ya!==undefined&&Da)for(ia=0;ia<3;ia++){X=Ya[ia];mb[db]=X.u;mb[db+1]=X.v;db+=2}if(nb){fa[ab]=Va;fa[ab+1]=Va+1;fa[ab+
2]=Va+2;ab+=3;La[Za]=Va;La[Za+1]=Va+1;La[Za+2]=Va;La[Za+3]=Va+2;La[Za+4]=Va+1;La[Za+5]=Va+2;Za+=6;Va+=3}}else if(R instanceof THREE.Face4){if(jb){wa=qb[R.a].position;Ba=qb[R.b].position;Ha=qb[R.c].position;Qa=qb[R.d].position;Ra[Ua]=wa.x;Ra[Ua+1]=wa.y;Ra[Ua+2]=wa.z;Ra[Ua+3]=Ba.x;Ra[Ua+4]=Ba.y;Ra[Ua+5]=Ba.z;Ra[Ua+6]=Ha.x;Ra[Ua+7]=Ha.y;Ra[Ua+8]=Ha.z;Ra[Ua+9]=Qa.x;Ra[Ua+10]=Qa.y;Ra[Ua+11]=Qa.z;Ua+=12}if(ya)for(hb in ya){F=ya[hb];if(F.needsUpdate){P=F.offset;ta=F.offsetSrc;if(F.size===1){if(F.boundTo===
undefined||F.boundTo==="vertices"){F.array[P+0]=F.value[R.a];F.array[P+1]=F.value[R.b];F.array[P+2]=F.value[R.c];F.array[P+3]=F.value[R.d]}else if(F.boundTo==="faces"){F.array[P+0]=F.value[ta];F.array[P+1]=F.value[ta];F.array[P+2]=F.value[ta];F.array[P+3]=F.value[ta];F.offsetSrc++}else if(F.boundTo==="faceVertices"){F.array[P+0]=F.value[ta+0];F.array[P+1]=F.value[ta+1];F.array[P+2]=F.value[ta+2];F.array[P+3]=F.value[ta+3];F.offsetSrc+=4}F.offset+=4}else{if(F.boundTo===undefined||F.boundTo==="vertices"){wa=
F.value[R.a];Ba=F.value[R.b];Ha=F.value[R.c];Qa=F.value[R.d]}else if(F.boundTo==="faces"){wa=F.value[ta];Ba=F.value[ta];Ha=F.value[ta];Qa=F.value[ta];F.offsetSrc++}else if(F.boundTo==="faceVertices"){wa=F.value[ta+0];Ba=F.value[ta+1];Ha=F.value[ta+2];Qa=F.value[ta+3];F.offsetSrc+=4}if(F.size===2){F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=Ba.x;F.array[P+3]=Ba.y;F.array[P+4]=Ha.x;F.array[P+5]=Ha.y;F.array[P+6]=Qa.x;F.array[P+7]=Qa.y;F.offset+=8}else if(F.size===3){if(F.type==="c"){F.array[P+
0]=wa.r;F.array[P+1]=wa.g;F.array[P+2]=wa.b;F.array[P+3]=Ba.r;F.array[P+4]=Ba.g;F.array[P+5]=Ba.b;F.array[P+6]=Ha.r;F.array[P+7]=Ha.g;F.array[P+8]=Ha.b;F.array[P+9]=Qa.r;F.array[P+10]=Qa.g;F.array[P+11]=Qa.b}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;F.array[P+3]=Ba.x;F.array[P+4]=Ba.y;F.array[P+5]=Ba.z;F.array[P+6]=Ha.x;F.array[P+7]=Ha.y;F.array[P+8]=Ha.z;F.array[P+9]=Qa.x;F.array[P+10]=Qa.y;F.array[P+11]=Qa.z}F.offset+=12}else{F.array[P+0]=wa.x;F.array[P+1]=wa.y;F.array[P+2]=wa.z;
F.array[P+3]=wa.w;F.array[P+4]=Ba.x;F.array[P+5]=Ba.y;F.array[P+6]=Ba.z;F.array[P+7]=Ba.w;F.array[P+8]=Ha.x;F.array[P+9]=Ha.y;F.array[P+10]=Ha.z;F.array[P+11]=Ha.w;F.array[P+12]=Qa.x;F.array[P+13]=Qa.y;F.array[P+14]=Qa.z;F.array[P+15]=Qa.w;F.offset+=16}}}}if(wb){P=0;for(ta=morphTargets.length;P<ta;P++){wa=morphTargets[P].vertices[R.a].position;Ba=morphTargets[P].vertices[R.b].position;Ha=morphTargets[P].vertices[R.c].position;Qa=morphTargets[P].vertices[R.d].position;F=Oa[P];F[Ea+0]=wa.x;F[Ea+1]=
wa.y;F[Ea+2]=wa.z;F[Ea+3]=Ba.x;F[Ea+4]=Ba.y;F[Ea+5]=Ba.z;F[Ea+6]=Ha.x;F[Ea+7]=Ha.y;F[Ea+8]=Ha.z;F[Ea+9]=Qa.x;F[Ea+10]=Qa.y;F[Ea+11]=Qa.z}Ea+=12}if(ob.length){P=ob[R.a];ta=ob[R.b];F=ob[R.c];eb=ob[R.d];Aa[ha]=P.x;Aa[ha+1]=P.y;Aa[ha+2]=P.z;Aa[ha+3]=P.w;Aa[ha+4]=ta.x;Aa[ha+5]=ta.y;Aa[ha+6]=ta.z;Aa[ha+7]=ta.w;Aa[ha+8]=F.x;Aa[ha+9]=F.y;Aa[ha+10]=F.z;Aa[ha+11]=F.w;Aa[ha+12]=eb.x;Aa[ha+13]=eb.y;Aa[ha+14]=eb.z;Aa[ha+15]=eb.w;P=tb[R.a];ta=tb[R.b];F=tb[R.c];eb=tb[R.d];oa[ha]=P.x;oa[ha+1]=P.y;oa[ha+2]=P.z;oa[ha+
3]=P.w;oa[ha+4]=ta.x;oa[ha+5]=ta.y;oa[ha+6]=ta.z;oa[ha+7]=ta.w;oa[ha+8]=F.x;oa[ha+9]=F.y;oa[ha+10]=F.z;oa[ha+11]=F.w;oa[ha+12]=eb.x;oa[ha+13]=eb.y;oa[ha+14]=eb.z;oa[ha+15]=eb.w;P=rb[R.a];ta=rb[R.b];F=rb[R.c];eb=rb[R.d];va[ha]=P.x;va[ha+1]=P.y;va[ha+2]=P.z;va[ha+3]=1;va[ha+4]=ta.x;va[ha+5]=ta.y;va[ha+6]=ta.z;va[ha+7]=1;va[ha+8]=F.x;va[ha+9]=F.y;va[ha+10]=F.z;va[ha+11]=1;va[ha+12]=eb.x;va[ha+13]=eb.y;va[ha+14]=eb.z;va[ha+15]=1;P=sb[R.a];ta=sb[R.b];F=sb[R.c];R=sb[R.d];sa[ha]=P.x;sa[ha+1]=P.y;sa[ha+2]=
P.z;sa[ha+3]=1;sa[ha+4]=ta.x;sa[ha+5]=ta.y;sa[ha+6]=ta.z;sa[ha+7]=1;sa[ha+8]=F.x;sa[ha+9]=F.y;sa[ha+10]=F.z;sa[ha+11]=1;sa[ha+12]=R.x;sa[ha+13]=R.y;sa[ha+14]=R.z;sa[ha+15]=1;ha+=16}if(vb&&Ia){if(T.length==4&&Ia==THREE.VertexColors){R=T[0];P=T[1];ta=T[2];T=T[3]}else T=ta=P=R=la;ea[Wa]=R.r;ea[Wa+1]=R.g;ea[Wa+2]=R.b;ea[Wa+3]=P.r;ea[Wa+4]=P.g;ea[Wa+5]=P.b;ea[Wa+6]=ta.r;ea[Wa+7]=ta.g;ea[Wa+8]=ta.b;ea[Wa+9]=T.r;ea[Wa+10]=T.g;ea[Wa+11]=T.b;Wa+=12}if(ub&&Sa.hasTangents){T=ia[0];la=ia[1];R=ia[2];ia=ia[3];
Ja[Pa]=T.x;Ja[Pa+1]=T.y;Ja[Pa+2]=T.z;Ja[Pa+3]=T.w;Ja[Pa+4]=la.x;Ja[Pa+5]=la.y;Ja[Pa+6]=la.z;Ja[Pa+7]=la.w;Ja[Pa+8]=R.x;Ja[Pa+9]=R.y;Ja[Pa+10]=R.z;Ja[Pa+11]=R.w;Ja[Pa+12]=ia.x;Ja[Pa+13]=ia.y;Ja[Pa+14]=ia.z;Ja[Pa+15]=ia.w;Pa+=16}if(kb&&Fa)if(X.length==4&&lb)for(ia=0;ia<4;ia++){W=X[ia];cb[$a]=W.x;cb[$a+1]=W.y;cb[$a+2]=W.z;$a+=3}else for(ia=0;ia<4;ia++){cb[$a]=W.x;cb[$a+1]=W.y;cb[$a+2]=W.z;$a+=3}if(fb&&Ma!==undefined&&Da)for(ia=0;ia<4;ia++){X=Ma[ia];ib[gb]=X.u;ib[gb+1]=X.v;gb+=2}if(fb&&Ya!==undefined&&
Da)for(ia=0;ia<4;ia++){X=Ya[ia];mb[db]=X.u;mb[db+1]=X.v;db+=2}if(nb){fa[ab]=Va;fa[ab+1]=Va+1;fa[ab+2]=Va+3;fa[ab+3]=Va+1;fa[ab+4]=Va+2;fa[ab+5]=Va+3;ab+=6;La[Za]=Va;La[Za+1]=Va+1;La[Za+2]=Va;La[Za+3]=Va+3;La[Za+4]=Va+1;La[Za+5]=Va+2;La[Za+6]=Va+2;La[Za+7]=Va+3;Za+=8;Va+=4}}}if(pb){V=0;for(Q=pb.length;V<Q;V++){fa[ab]=pb[V].a;fa[ab+1]=pb[V].b;fa[ab+2]=pb[V].c;fa[ab+3]=pb[V].a;fa[ab+4]=pb[V].c;fa[ab+5]=pb[V].d;ab+=6}}if(jb){o.bindBuffer(o.ARRAY_BUFFER,H.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,
Ra,S)}if(ya)for(hb in ya){F=ya[hb];if(F.needsUpdate){o.bindBuffer(o.ARRAY_BUFFER,F.buffer);o.bufferData(o.ARRAY_BUFFER,F.array,S);F.needsUpdate=!1}}if(wb){P=0;for(ta=morphTargets.length;P<ta;P++){o.bindBuffer(o.ARRAY_BUFFER,H.__webglMorphTargetsBuffers[P]);o.bufferData(o.ARRAY_BUFFER,Oa[P],S)}}if(vb&&Wa>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,ea,S)}if(kb){o.bindBuffer(o.ARRAY_BUFFER,H.__webglNormalBuffer);o.bufferData(o.ARRAY_BUFFER,cb,S)}if(ub&&Sa.hasTangents){o.bindBuffer(o.ARRAY_BUFFER,
H.__webglTangentBuffer);o.bufferData(o.ARRAY_BUFFER,Ja,S)}if(fb&&gb>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglUVBuffer);o.bufferData(o.ARRAY_BUFFER,ib,S)}if(fb&&db>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglUV2Buffer);o.bufferData(o.ARRAY_BUFFER,mb,S)}if(nb){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,H.__webglFaceBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,fa,S);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,H.__webglLineBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,La,S)}if(ha>0){o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinVertexABuffer);
o.bufferData(o.ARRAY_BUFFER,va,S);o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinVertexBBuffer);o.bufferData(o.ARRAY_BUFFER,sa,S);o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinIndicesBuffer);o.bufferData(o.ARRAY_BUFFER,oa,S);o.bindBuffer(o.ARRAY_BUFFER,H.__webglSkinWeightsBuffer);o.bufferData(o.ARRAY_BUFFER,Aa,S)}}}G.__dirtyVertices=!1;G.__dirtyMorphTargets=!1;G.__dirtyElements=!1;G.__dirtyUvs=!1;G.__dirtyNormals=!1;G.__dirtyTangents=!1;G.__dirtyColors=!1}else if(x instanceof THREE.Ribbon){G=x.geometry;if(G.__dirtyVertices||
G.__dirtyColors){x=G;O=o.DYNAMIC_DRAW;Ia=x.vertices;H=x.colors;Fa=Ia.length;S=H.length;Ma=x.__vertexArray;V=x.__colorArray;Ya=x.__dirtyColors;if(x.__dirtyVertices){for(Q=0;Q<Fa;Q++){Da=Ia[Q].position;M=Q*3;Ma[M]=Da.x;Ma[M+1]=Da.y;Ma[M+2]=Da.z}o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,Ma,O)}if(Ya){for(Q=0;Q<S;Q++){color=H[Q];M=Q*3;V[M]=color.r;V[M+1]=color.g;V[M+2]=color.b}o.bindBuffer(o.ARRAY_BUFFER,x.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,V,O)}}G.__dirtyVertices=
!1;G.__dirtyColors=!1}else if(x instanceof THREE.Line){G=x.geometry;if(G.__dirtyVertices||G.__dirtyColors){x=G;O=o.DYNAMIC_DRAW;Ia=x.vertices;H=x.colors;Fa=Ia.length;S=H.length;Ma=x.__vertexArray;V=x.__colorArray;Ya=x.__dirtyColors;if(x.__dirtyVertices){for(Q=0;Q<Fa;Q++){Da=Ia[Q].position;M=Q*3;Ma[M]=Da.x;Ma[M+1]=Da.y;Ma[M+2]=Da.z}o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,Ma,O)}if(Ya){for(Q=0;Q<S;Q++){color=H[Q];M=Q*3;V[M]=color.r;V[M+1]=color.g;V[M+2]=color.b}o.bindBuffer(o.ARRAY_BUFFER,
x.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,V,O)}}G.__dirtyVertices=!1;G.__dirtyColors=!1}else if(x instanceof THREE.ParticleSystem){G=x.geometry;(G.__dirtyVertices||G.__dirtyColors||x.sortParticles)&&e(G,o.DYNAMIC_DRAW,x);G.__dirtyVertices=!1;G.__dirtyColors=!1}}function E(x){function O(la){var ia=[];G=0;for(H=la.length;G<H;G++)la[G]==undefined?ia.push("undefined"):ia.push(la[G].id);return ia.join("_")}var G,H,M,S,V,Q,X,R,W={},T=x.morphTargets!==undefined?x.morphTargets.length:0;x.geometryGroups=
{};M=0;for(S=x.faces.length;M<S;M++){V=x.faces[M];Q=V.materials;X=O(Q);W[X]==undefined&&(W[X]={hash:X,counter:0});R=W[X].hash+"_"+W[X].counter;x.geometryGroups[R]==undefined&&(x.geometryGroups[R]={faces:[],materials:Q,vertices:0,numMorphTargets:T});V=V instanceof THREE.Face3?3:4;if(x.geometryGroups[R].vertices+V>65535){W[X].counter+=1;R=W[X].hash+"_"+W[X].counter;x.geometryGroups[R]==undefined&&(x.geometryGroups[R]={faces:[],materials:Q,vertices:0,numMorphTargets:T})}x.geometryGroups[R].faces.push(M);
x.geometryGroups[R].vertices+=V}}function C(x,O,G){x.push({buffer:O,object:G,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function D(x){if(x!=ma){switch(x){case THREE.AdditiveBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.SRC_ALPHA,o.ONE);break;case THREE.SubtractiveBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.ZERO,o.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.ZERO,o.SRC_COLOR);break;default:o.blendEquationSeparate(o.FUNC_ADD,
o.FUNC_ADD);o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)}ma=x}}function B(x,O,G){if((G.width&G.width-1)==0&&(G.height&G.height-1)==0){o.texParameteri(x,o.TEXTURE_WRAP_S,L(O.wrapS));o.texParameteri(x,o.TEXTURE_WRAP_T,L(O.wrapT));o.texParameteri(x,o.TEXTURE_MAG_FILTER,L(O.magFilter));o.texParameteri(x,o.TEXTURE_MIN_FILTER,L(O.minFilter));o.generateMipmap(x)}else{o.texParameteri(x,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(x,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);
o.texParameteri(x,o.TEXTURE_MAG_FILTER,K(O.magFilter));o.texParameteri(x,o.TEXTURE_MIN_FILTER,K(O.minFilter))}}function I(x,O){if(x.needsUpdate){if(x.__webglInit){o.bindTexture(o.TEXTURE_2D,x.__webglTexture);o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,x.image)}else{x.__webglTexture=o.createTexture();o.bindTexture(o.TEXTURE_2D,x.__webglTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,x.image);x.__webglInit=!0}B(o.TEXTURE_2D,x,x.image);o.bindTexture(o.TEXTURE_2D,null);
x.needsUpdate=!1}o.activeTexture(o.TEXTURE0+O);o.bindTexture(o.TEXTURE_2D,x.__webglTexture)}function N(x){if(x&&!x.__webglFramebuffer){if(x.depthBuffer===undefined)x.depthBuffer=!0;if(x.stencilBuffer===undefined)x.stencilBuffer=!0;x.__webglFramebuffer=o.createFramebuffer();x.__webglRenderbuffer=o.createRenderbuffer();x.__webglTexture=o.createTexture();o.bindTexture(o.TEXTURE_2D,x.__webglTexture);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,L(x.wrapS));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,
L(x.wrapT));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,L(x.magFilter));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,L(x.minFilter));o.texImage2D(o.TEXTURE_2D,0,L(x.format),x.width,x.height,0,L(x.format),L(x.type),null);o.bindRenderbuffer(o.RENDERBUFFER,x.__webglRenderbuffer);o.bindFramebuffer(o.FRAMEBUFFER,x.__webglFramebuffer);o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,x.__webglTexture,0);if(x.depthBuffer&&!x.stencilBuffer){o.renderbufferStorage(o.RENDERBUFFER,
o.DEPTH_COMPONENT16,x.width,x.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,x.__webglRenderbuffer)}else if(x.depthBuffer&&x.stencilBuffer){o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,x.width,x.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,x.__webglRenderbuffer)}else o.renderbufferStorage(o.RENDERBUFFER,o.RGBA4,x.width,x.height);o.bindTexture(o.TEXTURE_2D,null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,
null)}var O,G;if(x){O=x.__webglFramebuffer;G=x.width;x=x.height}else{O=null;G=Ga;x=Ca}if(O!=U){o.bindFramebuffer(o.FRAMEBUFFER,O);o.viewport(xa,ua,G,x);U=O}}function J(x,O){var G;if(x=="fragment")G=o.createShader(o.FRAGMENT_SHADER);else x=="vertex"&&(G=o.createShader(o.VERTEX_SHADER));o.shaderSource(G,O);o.compileShader(G);if(!o.getShaderParameter(G,o.COMPILE_STATUS)){console.error(o.getShaderInfoLog(G));console.error(O);return null}return G}function K(x){switch(x){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return o.NEAREST;
default:return o.LINEAR}}function L(x){switch(x){case THREE.RepeatWrapping:return o.REPEAT;case THREE.ClampToEdgeWrapping:return o.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return o.MIRRORED_REPEAT;case THREE.NearestFilter:return o.NEAREST;case THREE.NearestMipMapNearestFilter:return o.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return o.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return o.LINEAR;case THREE.LinearMipMapNearestFilter:return o.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return o.LINEAR_MIPMAP_LINEAR;
case THREE.ByteType:return o.BYTE;case THREE.UnsignedByteType:return o.UNSIGNED_BYTE;case THREE.ShortType:return o.SHORT;case THREE.UnsignedShortType:return o.UNSIGNED_SHORT;case THREE.IntType:return o.INT;case THREE.UnsignedShortType:return o.UNSIGNED_INT;case THREE.FloatType:return o.FLOAT;case THREE.AlphaFormat:return o.ALPHA;case THREE.RGBFormat:return o.RGB;case THREE.RGBAFormat:return o.RGBA;case THREE.LuminanceFormat:return o.LUMINANCE;case THREE.LuminanceAlphaFormat:return o.LUMINANCE_ALPHA}return 0}
var aa=this,o,ja=document.createElement("canvas"),ga=[],qa=null,U=null,Y=!0,$=null,na=null,ma=null,ra=null,xa=0,ua=0,Ga=0,Ca=0,pa=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],za=new THREE.Matrix4,Ka=new Float32Array(16),Ta=new Float32Array(16),Xa=new THREE.Vector4,Z={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};stencil=b.stencil!==undefined?b.stencil:!0;antialias=
b.antialias!==undefined?b.antialias:!1;clearColor=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0);clearAlpha=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=ja;this.autoClear=!0;this.sortObjects=!0;(function(x,O,G,H){try{if(!(o=ja.getContext("experimental-webgl",{antialias:x,stencil:H})))throw"Error creating WebGL context.";}catch(M){console.error(M)}console.log(navigator.userAgent+" | "+o.getParameter(o.VERSION)+
" | "+o.getParameter(o.VENDOR)+" | "+o.getParameter(o.RENDERER)+" | "+o.getParameter(o.SHADING_LANGUAGE_VERSION));o.clearColor(0,0,0,1);o.clearDepth(1);o.enable(o.DEPTH_TEST);o.depthFunc(o.LEQUAL);o.frontFace(o.CCW);o.cullFace(o.BACK);o.enable(o.CULL_FACE);o.enable(o.BLEND);o.blendEquation(o.FUNC_ADD);o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA);o.clearColor(O.r,O.g,O.b,G)})(antialias,clearColor,clearAlpha,stencil);this.context=o;var ka=o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(stencil){var ca=
{};ca.vertices=new Float32Array(12);ca.faces=new Uint16Array(6);ca.darkness=0.5;ca.vertices[0]=-20;ca.vertices[1]=-20;ca.vertices[2]=-1;ca.vertices[3]=20;ca.vertices[4]=-20;ca.vertices[5]=-1;ca.vertices[6]=20;ca.vertices[7]=20;ca.vertices[8]=-1;ca.vertices[9]=-20;ca.vertices[10]=20;ca.vertices[11]=-1;ca.faces[0]=0;ca.faces[1]=1;ca.faces[2]=2;ca.faces[3]=0;ca.faces[4]=2;ca.faces[5]=3;ca.vertexBuffer=o.createBuffer();ca.elementBuffer=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,ca.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,
ca.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,ca.faces,o.STATIC_DRAW);ca.program=o.createProgram();o.attachShader(ca.program,J("fragment",THREE.ShaderLib.shadowPost.fragmentShader));o.attachShader(ca.program,J("vertex",THREE.ShaderLib.shadowPost.vertexShader));o.linkProgram(ca.program);ca.vertexLocation=o.getAttribLocation(ca.program,"position");ca.projectionLocation=o.getUniformLocation(ca.program,"projectionMatrix");ca.darknessLocation=
o.getUniformLocation(ca.program,"darkness")}var da={};da.vertices=new Float32Array(16);da.faces=new Uint16Array(6);b=0;da.vertices[b++]=-1;da.vertices[b++]=-1;da.vertices[b++]=0;da.vertices[b++]=0;da.vertices[b++]=1;da.vertices[b++]=-1;da.vertices[b++]=1;da.vertices[b++]=0;da.vertices[b++]=1;da.vertices[b++]=1;da.vertices[b++]=1;da.vertices[b++]=1;da.vertices[b++]=-1;da.vertices[b++]=1;da.vertices[b++]=0;da.vertices[b++]=1;b=0;da.faces[b++]=0;da.faces[b++]=1;da.faces[b++]=2;da.faces[b++]=0;da.faces[b++]=
2;da.faces[b++]=3;da.vertexBuffer=o.createBuffer();da.elementBuffer=o.createBuffer();da.tempTexture=o.createTexture();da.occlusionTexture=o.createTexture();o.bindBuffer(o.ARRAY_BUFFER,da.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,da.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,da.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,da.faces,o.STATIC_DRAW);o.bindTexture(o.TEXTURE_2D,da.tempTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGB,16,16,0,o.RGB,o.UNSIGNED_BYTE,null);o.texParameteri(o.TEXTURE_2D,
o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);o.bindTexture(o.TEXTURE_2D,da.occlusionTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,16,16,0,o.RGBA,o.UNSIGNED_BYTE,null);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,
o.NEAREST);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);if(o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){da.hasVertexTexture=!1;da.program=o.createProgram();o.attachShader(da.program,J("fragment",THREE.ShaderLib.lensFlare.fragmentShader));o.attachShader(da.program,J("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{da.hasVertexTexture=!0;da.program=o.createProgram();o.attachShader(da.program,J("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));o.attachShader(da.program,
J("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}o.linkProgram(da.program);da.attributes={};da.uniforms={};da.attributes.vertex=o.getAttribLocation(da.program,"position");da.attributes.uv=o.getAttribLocation(da.program,"UV");da.uniforms.renderType=o.getUniformLocation(da.program,"renderType");da.uniforms.map=o.getUniformLocation(da.program,"map");da.uniforms.occlusionMap=o.getUniformLocation(da.program,"occlusionMap");da.uniforms.opacity=o.getUniformLocation(da.program,"opacity");
da.uniforms.scale=o.getUniformLocation(da.program,"scale");da.uniforms.rotation=o.getUniformLocation(da.program,"rotation");da.uniforms.screenPosition=o.getUniformLocation(da.program,"screenPosition");var Na=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=
1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=o.createBuffer();_sprite.elementBuffer=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,_sprite.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,_sprite.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,
_sprite.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,_sprite.faces,o.STATIC_DRAW);_sprite.program=o.createProgram();o.attachShader(_sprite.program,J("fragment",THREE.ShaderLib.sprite.fragmentShader));o.attachShader(_sprite.program,J("vertex",THREE.ShaderLib.sprite.vertexShader));o.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=o.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=o.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=
o.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=o.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=o.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=o.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=o.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=o.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=o.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=
o.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=o.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=o.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=o.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=o.getUniformLocation(_sprite.program,"projectionMatrix");var bb=!1;this.setSize=function(x,O){ja.width=x;ja.height=O;this.setViewport(0,
0,ja.width,ja.height)};this.setViewport=function(x,O,G,H){xa=x;ua=O;Ga=G;Ca=H;o.viewport(xa,ua,Ga,Ca)};this.setScissor=function(x,O,G,H){o.scissor(x,O,G,H)};this.enableScissorTest=function(x){x?o.enable(o.SCISSOR_TEST):o.disable(o.SCISSOR_TEST)};this.enableDepthBufferWrite=function(x){Y=x;o.depthMask(x)};this.setClearColorHex=function(x,O){var G=new THREE.Color(x);o.clearColor(G.r,G.g,G.b,O)};this.setClearColor=function(x,O){o.clearColor(x.r,x.g,x.b,O)};this.clear=function(){o.clear(o.COLOR_BUFFER_BIT|
o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(x){ca.darkness=x};this.getContext=function(){return o};this.initMaterial=function(x,O,G,H){var M,S,V;if(x instanceof THREE.MeshDepthMaterial)V="depth";else if(x instanceof THREE.ShadowVolumeDynamicMaterial)V="shadowVolumeDynamic";else if(x instanceof THREE.MeshNormalMaterial)V="normal";else if(x instanceof THREE.MeshBasicMaterial)V="basic";else if(x instanceof THREE.MeshLambertMaterial)V="lambert";else if(x instanceof
THREE.MeshPhongMaterial)V="phong";else if(x instanceof THREE.LineBasicMaterial)V="basic";else x instanceof THREE.ParticleBasicMaterial&&(V="particle_basic");if(V){var Q=THREE.ShaderLib[V];x.uniforms=THREE.UniformsUtils.clone(Q.uniforms);x.vertexShader=Q.vertexShader;x.fragmentShader=Q.fragmentShader}var X,R,W;X=W=Q=0;for(R=O.length;X<R;X++){S=O[X];S instanceof THREE.DirectionalLight&&W++;S instanceof THREE.PointLight&&Q++}if(Q+W<=4)O=W;else{O=Math.ceil(4*W/(Q+W));Q=4-O}S={directional:O,point:Q};W=
50;if(H!==undefined&&H instanceof THREE.SkinnedMesh)W=H.bones.length;var T;a:{X=x.fragmentShader;R=x.vertexShader;Q=x.uniforms;O=x.attributes;G={map:!!x.map,envMap:!!x.envMap,lightMap:!!x.lightMap,vertexColors:x.vertexColors,fog:G,sizeAttenuation:x.sizeAttenuation,skinning:x.skinning,morphTargets:x.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:S.directional,maxPointLights:S.point,maxBones:W};var la;S=[];if(V)S.push(V);else{S.push(X);S.push(R)}for(la in G){S.push(la);S.push(G[la])}V=
S.join();la=0;for(S=ga.length;la<S;la++)if(ga[la].code==V){T=ga[la].program;break a}la=o.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,G.fog?"#define USE_FOG":"",G.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",G.map?"#define USE_MAP":"",G.envMap?"#define USE_ENVMAP":"",G.lightMap?"#define USE_LIGHTMAP":"",G.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
prefix_vertex=[ka?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,"#define MAX_BONES "+G.maxBones,G.map?"#define USE_MAP":"",G.envMap?"#define USE_ENVMAP":"",G.lightMap?"#define USE_LIGHTMAP":"",G.vertexColors?"#define USE_COLOR":"",G.skinning?"#define USE_SKINNING":"",G.morphTargets?"#define USE_MORPHTARGETS":"",G.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
o.attachShader(la,J("fragment",prefix_fragment+X));o.attachShader(la,J("vertex",prefix_vertex+R));o.linkProgram(la);o.getProgramParameter(la,o.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+o.getProgramParameter(la,o.VALIDATE_STATUS)+", gl error ["+o.getError()+"]");la.uniforms={};la.attributes={};var ia;X=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(ia in Q)X.push(ia);ia=X;Q=0;for(X=ia.length;Q<X;Q++){R=ia[Q];la.uniforms[R]=o.getUniformLocation(la,R)}X=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(ia=0;ia<G.maxMorphTargets;ia++)X.push("morphTarget"+ia);for(T in O)X.push(T);T=X;ia=0;for(O=T.length;ia<O;ia++){G=T[ia];la.attributes[G]=o.getAttribLocation(la,G)}ga.push({program:la,code:V});T=la}x.program=T;T=x.program.attributes;o.enableVertexAttribArray(T.position);T.color>=0&&o.enableVertexAttribArray(T.color);
T.normal>=0&&o.enableVertexAttribArray(T.normal);T.tangent>=0&&o.enableVertexAttribArray(T.tangent);if(x.skinning&&T.skinVertexA>=0&&T.skinVertexB>=0&&T.skinIndex>=0&&T.skinWeight>=0){o.enableVertexAttribArray(T.skinVertexA);o.enableVertexAttribArray(T.skinVertexB);o.enableVertexAttribArray(T.skinIndex);o.enableVertexAttribArray(T.skinWeight)}for(M in x.attributes)T[M]>=0&&o.enableVertexAttribArray(T[M]);if(x.morphTargets){x.numSupportedMorphTargets=0;if(T.morphTarget0>=0){o.enableVertexAttribArray(T.morphTarget0);
x.numSupportedMorphTargets++}if(T.morphTarget1>=0){o.enableVertexAttribArray(T.morphTarget1);x.numSupportedMorphTargets++}if(T.morphTarget2>=0){o.enableVertexAttribArray(T.morphTarget2);x.numSupportedMorphTargets++}if(T.morphTarget3>=0){o.enableVertexAttribArray(T.morphTarget3);x.numSupportedMorphTargets++}if(T.morphTarget4>=0){o.enableVertexAttribArray(T.morphTarget4);x.numSupportedMorphTargets++}if(T.morphTarget5>=0){o.enableVertexAttribArray(T.morphTarget5);x.numSupportedMorphTargets++}if(T.morphTarget6>=
0){o.enableVertexAttribArray(T.morphTarget6);x.numSupportedMorphTargets++}if(T.morphTarget7>=0){o.enableVertexAttribArray(T.morphTarget7);x.numSupportedMorphTargets++}H.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);x=0;for(M=this.maxMorphTargets;x<M;x++)H.__webglMorphTargetInfluences[x]=0}};this.render=function(x,O,G,H){var M,S,V,Q,X,R,W,T,la=x.lights,ia=x.fog;aa.data.vertices=0;aa.data.faces=0;aa.data.drawCalls=0;O.matrixAutoUpdate&&O.update(undefined,!0);x.update(undefined,
!1,O);O.matrixWorldInverse.flattenToArray(Ta);O.projectionMatrix.flattenToArray(Ka);za.multiply(O.projectionMatrix,O.matrixWorldInverse);j(za);this.initWebGLObjects(x);N(G);(this.autoClear||H)&&this.clear();X=x.__webglObjects.length;for(H=0;H<X;H++){M=x.__webglObjects[H];W=M.object;if(W.visible)if(!(W instanceof THREE.Mesh)||m(W)){W.matrixWorld.flattenToArray(W._objectMatrixArray);z(W,O);t(M);M.render=!0;if(this.sortObjects){Xa.copy(W.position);za.multiplyVector3(Xa);M.z=Xa.z}}else M.render=!1;else M.render=
!1}this.sortObjects&&x.__webglObjects.sort(v);R=x.__webglObjectsImmediate.length;for(H=0;H<R;H++){M=x.__webglObjectsImmediate[H];W=M.object;if(W.visible){W.matrixAutoUpdate&&W.matrixWorld.flattenToArray(W._objectMatrixArray);z(W,O);p(M)}}D(THREE.NormalBlending);for(H=0;H<X;H++){M=x.__webglObjects[H];if(M.render){W=M.object;T=M.buffer;V=M.opaque;g(W);for(M=0;M<V.count;M++){Q=V.list[M];h(Q.depthTest);d(O,la,ia,Q,T,W)}}}for(H=0;H<R;H++){M=x.__webglObjectsImmediate[H];W=M.object;if(W.visible){V=M.opaque;
g(W);for(M=0;M<V.count;M++){Q=V.list[M];h(Q.depthTest);S=c(O,la,ia,Q,W);W.render(function(Da){f(Da,S,Q.shading)})}}}for(H=0;H<X;H++){M=x.__webglObjects[H];if(M.render){W=M.object;T=M.buffer;V=M.transparent;g(W);for(M=0;M<V.count;M++){Q=V.list[M];D(Q.blending);h(Q.depthTest);d(O,la,ia,Q,T,W)}}}for(H=0;H<R;H++){M=x.__webglObjectsImmediate[H];W=M.object;if(W.visible){V=M.transparent;g(W);for(M=0;M<V.count;M++){Q=V.list[M];D(Q.blending);h(Q.depthTest);S=c(O,la,ia,Q,W);W.render(function(Da){f(Da,S,Q.shading)})}}}x.__webglSprites.length&&
w(x,O);stencil&&x.__webglShadowVolumes.length&&x.lights.length&&u(x);x.__webglLensFlares.length&&y(x,O);if(G&&G.minFilter!==THREE.NearestFilter&&G.minFilter!==THREE.LinearFilter){o.bindTexture(o.TEXTURE_2D,G.__webglTexture);o.generateMipmap(o.TEXTURE_2D);o.bindTexture(o.TEXTURE_2D,null)}};this.initWebGLObjects=function(x){if(!x.__webglObjects){x.__webglObjects=[];x.__webglObjectsImmediate=[];x.__webglShadowVolumes=[];x.__webglLensFlares=[];x.__webglSprites=[]}for(;x.__objectsAdded.length;){var O=
x.__objectsAdded[0],G=x,H=void 0,M=void 0,S=void 0;if(O._modelViewMatrix==undefined){O._modelViewMatrix=new THREE.Matrix4;O._normalMatrixArray=new Float32Array(9);O._modelViewMatrixArray=new Float32Array(16);O._objectMatrixArray=new Float32Array(16);O.matrixWorld.flattenToArray(O._objectMatrixArray)}if(O instanceof THREE.Mesh){M=O.geometry;M.geometryGroups==undefined&&E(M);for(H in M.geometryGroups){S=M.geometryGroups[H];if(!S.__webglVertexBuffer){var V=S;V.__webglVertexBuffer=o.createBuffer();V.__webglNormalBuffer=
o.createBuffer();V.__webglTangentBuffer=o.createBuffer();V.__webglColorBuffer=o.createBuffer();V.__webglUVBuffer=o.createBuffer();V.__webglUV2Buffer=o.createBuffer();V.__webglSkinVertexABuffer=o.createBuffer();V.__webglSkinVertexBBuffer=o.createBuffer();V.__webglSkinIndicesBuffer=o.createBuffer();V.__webglSkinWeightsBuffer=o.createBuffer();V.__webglFaceBuffer=o.createBuffer();V.__webglLineBuffer=o.createBuffer();if(V.numMorphTargets){var Q=void 0,X=void 0;V.__webglMorphTargetsBuffers=[];Q=0;for(X=
V.numMorphTargets;Q<X;Q++)V.__webglMorphTargetsBuffers.push(o.createBuffer())}V=S;Q=O;var R=void 0,W=void 0,T=void 0,la=void 0,ia=void 0,Da=void 0,Ia=Da=X=0,Fa=void 0;la=Q.geometry;Fa=la.faces;ia=V.faces;R=0;for(W=ia.length;R<W;R++){T=ia[R];T=Fa[T];if(T instanceof THREE.Face3){X+=3;Da+=1;Ia+=3}else if(T instanceof THREE.Face4){X+=4;Da+=2;Ia+=4}}R=V;W=Q;var Ma=void 0,Ya=void 0;T=[];Fa=0;for(ia=W.materials.length;Fa<ia;Fa++){Ma=W.materials[Fa];if(Ma instanceof THREE.MeshFaceMaterial){Ma=0;for(l=R.materials.length;Ma<
l;Ma++)(Ya=R.materials[Ma])&&T.push(Ya)}else(Ya=Ma)&&T.push(Ya)}R=T;a:{ia=R.length;for(W=0;W<ia;W++){Fa=R[W];if(Fa.map||Fa.lightMap||Fa instanceof THREE.MeshShaderMaterial){W=!0;break a}}W=!1}a:{Fa=R;Ma=Fa.length;for(ia=0;ia<Ma;ia++){T=Fa[ia];if(!(T instanceof THREE.MeshBasicMaterial&&!T.envMap||T instanceof THREE.MeshDepthMaterial)){Fa=T&&T.shading!=undefined&&T.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}Fa=!1}a:{Ma=R.length;for(ia=0;ia<Ma;ia++){T=R[ia];if(T.vertexColors){T=
T.vertexColors;break a}}T=!1}V.__vertexArray=new Float32Array(X*3);if(Fa)V.__normalArray=new Float32Array(X*3);if(la.hasTangents)V.__tangentArray=new Float32Array(X*4);if(T)V.__colorArray=new Float32Array(X*3);if(W){if(la.faceUvs.length>0||la.faceVertexUvs.length>0)V.__uvArray=new Float32Array(X*2);if(la.faceUvs.length>1||la.faceVertexUvs.length>1)V.__uv2Array=new Float32Array(X*2)}if(Q.geometry.skinWeights.length&&Q.geometry.skinIndices.length){V.__skinVertexAArray=new Float32Array(X*4);V.__skinVertexBArray=
new Float32Array(X*4);V.__skinIndexArray=new Float32Array(X*4);V.__skinWeightArray=new Float32Array(X*4)}V.__faceArray=new Uint16Array(Da*3+(Q.geometry.edgeFaces?Q.geometry.edgeFaces.length*6:0));V.__lineArray=new Uint16Array(Ia*2);if(V.numMorphTargets){V.__morphTargetsArrays=[];la=0;for(ia=V.numMorphTargets;la<ia;la++)V.__morphTargetsArrays.push(new Float32Array(X*3))}V.__needsSmoothNormals=Fa==THREE.SmoothShading;V.__uvType=W;V.__vertexColorType=T;V.__normalType=Fa;V.__webglFaceCount=Da*3+(Q.geometry.edgeFaces?
Q.geometry.edgeFaces.length*6:0);V.__webglLineCount=Ia*2;la=0;for(ia=R.length;la<ia;la++)if(R[la].attributes){V.__webglCustomAttributes={};for(a in R[la].attributes){W=R[la].attributes[a];if(!W.__webglInitialized||W.createUniqueBuffers){W.__webglInitialized=!0;Da=1;if(W.type==="v2")Da=2;else if(W.type==="v3")Da=3;else if(W.type==="v4")Da=4;else W.type==="c"&&(Da=3);W.size=Da;W.needsUpdate=!0;W.array=new Float32Array(X*Da);W.buffer=o.createBuffer();W.buffer.belongsToAttribute=a}V.__webglCustomAttributes[a]=
W}}M.__dirtyVertices=!0;M.__dirtyMorphTargets=!0;M.__dirtyElements=!0;M.__dirtyUvs=!0;M.__dirtyNormals=!0;M.__dirtyTangents=!0;M.__dirtyColors=!0}O instanceof THREE.ShadowVolume?C(G.__webglShadowVolumes,S,O):C(G.__webglObjects,S,O)}}else if(O instanceof THREE.LensFlare)C(G.__webglLensFlares,undefined,O);else if(O instanceof THREE.Ribbon){M=O.geometry;if(!M.__webglVertexBuffer){H=M;H.__webglVertexBuffer=o.createBuffer();H.__webglColorBuffer=o.createBuffer();H=M;S=H.vertices.length;H.__vertexArray=
new Float32Array(S*3);H.__colorArray=new Float32Array(S*3);H.__webglVertexCount=S;M.__dirtyVertices=!0;M.__dirtyColors=!0}C(G.__webglObjects,M,O)}else if(O instanceof THREE.Line){M=O.geometry;if(!M.__webglVertexBuffer){H=M;H.__webglVertexBuffer=o.createBuffer();H.__webglColorBuffer=o.createBuffer();H=M;S=H.vertices.length;H.__vertexArray=new Float32Array(S*3);H.__colorArray=new Float32Array(S*3);H.__webglLineCount=S;M.__dirtyVertices=!0;M.__dirtyColors=!0}C(G.__webglObjects,M,O)}else if(O instanceof
THREE.ParticleSystem){M=O.geometry;if(!M.__webglVertexBuffer){H=M;H.__webglVertexBuffer=o.createBuffer();H.__webglColorBuffer=o.createBuffer();H=M;S=H.vertices.length;H.__vertexArray=new Float32Array(S*3);H.__colorArray=new Float32Array(S*3);H.__sortArray=[];H.__webglParticleCount=S;M.__dirtyVertices=!0;M.__dirtyColors=!0}C(G.__webglObjects,M,O)}else if(THREE.MarchingCubes!==undefined&&O instanceof THREE.MarchingCubes)G.__webglObjectsImmediate.push({object:O,opaque:{list:[],count:0},transparent:{list:[],
count:0}});else O instanceof THREE.Sprite&&G.__webglSprites.push(O);x.__objectsAdded.splice(0,1)}for(;x.__objectsRemoved.length;){O=x.__objectsRemoved[0];G=x;if(O instanceof THREE.Mesh)for(M=G.__webglObjects.length-1;M>=0;M--){H=G.__webglObjects[M].object;if(O==H){G.__webglObjects.splice(M,1);break}}else if(O instanceof THREE.Sprite)for(M=G.__webglSprites.length-1;M>=0;M--){H=G.__webglSprites[M];if(O==H){G.__webglSprites.splice(M,1);break}}x.__objectsRemoved.splice(0,1)}O=0;for(G=x.__webglObjects.length;O<
G;O++)A(x.__webglObjects[O].object,x);O=0;for(G=x.__webglShadowVolumes.length;O<G;O++)A(x.__webglShadowVolumes[O].object,x);O=0;for(G=x.__webglLensFlares.length;O<G;O++)A(x.__webglLensFlares[O].object,x)};this.setFaceCulling=function(x,O){if(x){!O||O=="ccw"?o.frontFace(o.CCW):o.frontFace(o.CW);if(x=="back")o.cullFace(o.BACK);else x=="front"?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK);o.enable(o.CULL_FACE)}else o.disable(o.CULL_FACE)};this.supportsVertexTextures=function(){return ka}};
THREE.WebGLRenderTarget=function(b,e,c){this.width=b;this.height=e;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==
undefined?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:!0};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,e,c){c&&b.update(undefined,!1,e);c=b.sounds;var d,f=c.length;for(d=0;d<f;d++){b=c[d];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(e.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};
THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.materials=null};
THREE.AnimationHandler=function(){var b=[],e={},c={};c.update=function(f){for(var g=0;g<b.length;g++)b[g].update(f)};c.addToUpdate=function(f){b.indexOf(f)===-1&&b.push(f)};c.removeFromUpdate=function(f){f=b.indexOf(f);f!==-1&&b.splice(f,1)};c.add=function(f){e[f.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.");e[f.name]=f;if(f.initialized!==!0){for(var g=0;g<f.hierarchy.length;g++){for(var h=0;h<f.hierarchy[g].keys.length;h++){if(f.hierarchy[g].keys[h].time<
0)f.hierarchy[g].keys[h].time=0;if(f.hierarchy[g].keys[h].rot!==undefined&&!(f.hierarchy[g].keys[h].rot instanceof THREE.Quaternion)){var j=f.hierarchy[g].keys[h].rot;f.hierarchy[g].keys[h].rot=new THREE.Quaternion(j[0],j[1],j[2],j[3])}}if(f.hierarchy[g].keys[0].morphTargets!==undefined){j={};for(h=0;h<f.hierarchy[g].keys.length;h++)for(var m=0;m<f.hierarchy[g].keys[h].morphTargets.length;m++){var n=f.hierarchy[g].keys[h].morphTargets[m];j[n]=-1}f.hierarchy[g].usedMorphTargets=j;for(h=0;h<f.hierarchy[g].keys.length;h++){var p=
{};for(n in j){for(m=0;m<f.hierarchy[g].keys[h].morphTargets.length;m++)if(f.hierarchy[g].keys[h].morphTargets[m]===n){p[n]=f.hierarchy[g].keys[h].morphTargetsInfluences[m];break}m===f.hierarchy[g].keys[h].morphTargets.length&&(p[n]=0)}f.hierarchy[g].keys[h].morphTargetsInfluences=p}}for(h=1;h<f.hierarchy[g].keys.length;h++)if(f.hierarchy[g].keys[h].time===f.hierarchy[g].keys[h-1].time){f.hierarchy[g].keys.splice(h,1);h--}for(h=1;h<f.hierarchy[g].keys.length;h++)f.hierarchy[g].keys[h].index=h}h=parseInt(f.length*
f.fps,10);f.JIT={};f.JIT.hierarchy=[];for(g=0;g<f.hierarchy.length;g++)f.JIT.hierarchy.push(Array(h));f.initialized=!0}};c.get=function(f){if(typeof f==="string")if(e[f])return e[f];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}};c.parse=function(f){var g=[];if(f instanceof THREE.SkinnedMesh)for(var h=0;h<f.bones.length;h++)g.push(f.bones[h]);else d(f,g);return g};var d=function(f,g){g.push(f);for(var h=0;h<f.children.length;h++)d(f.children[h],g)};c.LINEAR=
0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,e,c,d){this.root=b;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.JITCompile=d!==undefined?d:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,e){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==undefined?b:!0;this.currentTime=e!==undefined?e:0;var c,d=this.hierarchy.length,f;for(c=0;c<d;c++){f=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=!0;f.matrixAutoUpdate=!0;if(f.animationCache===undefined){f.animationCache={};f.animationCache.prevKey={pos:0,rot:0,scl:0};f.animationCache.nextKey={pos:0,rot:0,scl:0};f.animationCache.originalMatrix=
f instanceof THREE.Bone?f.skinMatrix:f.matrix}var g=f.animationCache.prevKey;f=f.animationCache.nextKey;g.pos=this.data.hierarchy[c].keys[0];g.rot=this.data.hierarchy[c].keys[0];g.scl=this.data.hierarchy[c].keys[0];f.pos=this.getNextKeyWith("pos",c,1);f.rot=this.getNextKeyWith("rot",c,1);f.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==undefined){if(this.hierarchy[b]instanceof THREE.Bone)this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix;else this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var e=["pos","rot","scl"],c,d,f,g,h,j,m,n,p=this.data.JIT.hierarchy,t,v;this.currentTime+=b*this.timeScale;v=this.currentTime;t=this.currentTime%=this.data.length;n=parseInt(Math.min(t*this.data.fps,this.data.length*this.data.fps),10);for(var u=0,w=this.hierarchy.length;u<w;u++){b=this.hierarchy[u];m=b.animationCache;if(this.JITCompile&&p[u][n]!==undefined)if(b instanceof THREE.Bone){b.skinMatrix=p[u][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=
!1}else{b.matrix=p[u][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(b instanceof THREE.Bone)b.skinMatrix=b.animationCache.originalMatrix;else b.matrix=b.animationCache.originalMatrix;for(var y=0;y<3;y++){c=e[y];h=m.prevKey[c];j=m.nextKey[c];if(j.time<=v){if(t<v)if(this.loop){h=this.data.hierarchy[u].keys[0];for(j=this.getNextKeyWith(c,u,1);j.time<t;){h=j;j=this.getNextKeyWith(c,u,j.index+1)}}else{this.stop();return}else{do{h=j;j=this.getNextKeyWith(c,u,j.index+1)}while(j.time<
t)}m.prevKey[c]=h;m.nextKey[c]=j}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;d=(t-h.time)/(j.time-h.time);f=h[c];g=j[c];if(d<0||d>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+u);d=d<0?0:1}if(c==="pos"){c=b.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=f[0]+(g[0]-f[0])*d;c.y=f[1]+(g[1]-f[1])*d;c.z=f[2]+(g[2]-f[2])*d}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",u,h.index-1).pos;this.points[1]=f;this.points[2]=g;this.points[3]=this.getNextKeyWith("pos",u,j.index+1).pos;d=d*0.33+0.33;f=this.interpolateCatmullRom(this.points,d);c.x=f[0];c.y=f[1];c.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){d=this.interpolateCatmullRom(this.points,d*1.01);this.target.set(d[0],d[1],d[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();d=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,d,0)}}}else if(c===
"rot")THREE.Quaternion.slerp(f,g,b.quaternion,d);else if(c==="scl"){c=b.scale;c.x=f[0]+(g[0]-f[0])*d;c.y=f[1]+(g[1]-f[1])*d;c.z=f[2]+(g[2]-f[2])*d}}}}if(this.JITCompile&&p[0][n]===undefined){this.hierarchy[0].update(undefined,!0);for(u=0;u<this.hierarchy.length;u++)p[u][n]=this.hierarchy[u]instanceof THREE.Bone?this.hierarchy[u].skinMatrix.clone():this.hierarchy[u].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,e){var c=[],d=[],f,g,h,j,m,n;f=(b.length-1)*e;g=Math.floor(f);f-=g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>b.length-2?g:g+1;c[3]=g>b.length-3?g:g+2;g=b[c[0]];j=b[c[1]];m=b[c[2]];n=b[c[3]];c=f*f;h=f*c;d[0]=this.interpolate(g[0],j[0],m[0],n[0],f,c,h);d[1]=this.interpolate(g[1],j[1],m[1],n[1],f,c,h);d[2]=this.interpolate(g[2],j[2],m[2],n[2],f,c,h);return d};
THREE.Animation.prototype.interpolate=function(b,e,c,d,f,g,h){b=(c-b)*0.5;d=(d-e)*0.5;return(2*(e-c)+b+d)*h+(-3*(e-c)-2*b-d)*g+b*f+e};THREE.Animation.prototype.getNextKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<d.length-1?c:d.length-1;else c%=d.length;for(;c<d.length;c++)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[d.length-1]};
THREE.ColorUtils={adjustHSV:function(b,e,c,d){var f=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,f);f.h=THREE.ColorUtils.clamp(f.h+e,0,1);f.s=THREE.ColorUtils.clamp(f.s+c,0,1);f.v=THREE.ColorUtils.clamp(f.v+d,0,1);b.setHSV(f.h,f.s,f.v)},rgbToHsv:function(b,e){var c=b.r,d=b.g,f=b.b,g=Math.max(Math.max(c,d),f),h=Math.min(Math.min(c,d),f);if(h==g)h=c=0;else{var j=g-h;h=j/g;c=c==g?(d-f)/j:d==g?2+(f-c)/j:4+(c-d)/j;c/=6;c<0&&(c+=1);c>1&&(c-=1)}e===undefined&&(e={h:0,s:0,v:0});e.h=c;e.s=h;e.v=g;return e},
clamp:function(b,e,c){return b<e?e:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,e){var c=e instanceof THREE.Mesh,d=b.vertices.length,f=c?e.geometry:e,g=b.vertices,h=f.vertices,j=b.faces,m=f.faces,n=b.faceVertexUvs[0];f=f.faceVertexUvs[0];c&&e.matrixAutoUpdate&&e.updateMatrix();for(var p=0,t=h.length;p<t;p++){var v=new THREE.Vertex(h[p].position.clone());c&&e.matrix.multiplyVector3(v.position);g.push(v)}p=0;for(t=m.length;p<t;p++){h=m[p];var u,w,y=h.vertexNormals;v=h.vertexColors;if(h instanceof THREE.Face3)u=new THREE.Face3(h.a+d,h.b+d,h.c+
d);else h instanceof THREE.Face4&&(u=new THREE.Face4(h.a+d,h.b+d,h.c+d,h.d+d));u.normal.copy(h.normal);c=0;for(g=y.length;c<g;c++){w=y[c];u.vertexNormals.push(w.clone())}u.color.copy(h.color);c=0;for(g=v.length;c<g;c++){w=v[c];u.vertexColors.push(w.clone())}u.materials=h.materials.slice();u.centroid.copy(h.centroid);j.push(u)}p=0;for(t=f.length;p<t;p++){d=f[p];j=[];c=0;for(g=d.length;c<g;c++)j.push(new THREE.UV(d[c].u,d[c].v));n.push(j)}}};
THREE.ImageUtils={loadTexture:function(b,e,c){var d=new Image,f=new THREE.Texture(d,e);d.onload=function(){f.needsUpdate=!0;c&&c(this)};d.src=b;return f},loadTextureCube:function(b,e,c){var d,f=[],g=new THREE.Texture(f,e);e=f.loadCount=0;for(d=b.length;e<d;++e){f[e]=new Image;f[e].onload=function(){f.loadCount+=1;if(f.loadCount==6)g.needsUpdate=!0;c&&c(this)};f[e].src=b[e]}return g}};
THREE.SceneUtils={addMesh:function(b,e,c,d,f,g,h,j,m,n){e=new THREE.Mesh(e,n);e.scale.x=e.scale.y=e.scale.z=c;e.position.x=d;e.position.y=f;e.position.z=g;e.rotation.x=h;e.rotation.y=j;e.rotation.z=m;b.addObject(e);return e},addPanoramaCubeWebGL:function(b,e,c){var d=THREE.ShaderUtils.lib.cube;d.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms});e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,1,null,!0),c);b.addObject(e);
return e},addPanoramaCube:function(b,e,c){var d=[];d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,d,!0),
new THREE.MeshFaceMaterial);b.addObject(e);return e},addPanoramaCubePlanes:function(b,e,c){var d=e/2;e=new THREE.Plane(e,e);var f=Math.PI,g=Math.PI/2;THREE.SceneUtils.addMesh(b,e,1,0,0,-d,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,e,1,-d,0,0,0,g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,e,1,d,0,0,0,-g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,e,1,0,d,0,g,
0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,e,1,0,-d,0,-g,0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,e){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=e})},traverseHierarchy:function(b,e){var c,d,f=b.children.length;for(d=0;d<f;d++){c=b.children[d];e(c);THREE.SceneUtils.traverseHierarchy(c,e)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var e,c,d,f,g=2*Math.ceil(b*3)+1;g>25&&(g=25);f=(g-1)*0.5;c=Array(g);for(e=d=0;e<g;++e){c[e]=Math.exp(-((e-f)*(e-f))/(2*b*b));d+=c[e]}for(e=0;e<g;++e)c[e]/=d;return c}};
THREE.QuakeCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.noFly!==undefined)this.noFly=b.noFly;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.autoForward!==undefined)this.autoForward=b.autoForward;if(b.activeLook!==undefined)this.activeLook=b.activeLook;if(b.heightSpeed!==undefined)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==undefined)this.heightCoef=b.heightCoef;if(b.heightMin!==undefined)this.heightMin=b.heightMin;if(b.heightMax!==undefined)this.heightMax=
b.heightMax;if(b.constrainVertical!==undefined)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==undefined)this.verticalMin=b.verticalMin;if(b.verticalMax!==undefined)this.verticalMax=b.verticalMax;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.moveForward=!1;this.moveBackward=!1;this.moveLeft=!1;this.moveRight=!1;this.freeze=!1;this.mouseDragOn=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=
window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=
function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/
1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var d=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(d+this.autoSpeedFactor));this.moveBackward&&this.translateZ(d);this.moveLeft&&this.translateX(-d);this.moveRight&&this.translateX(d);d=this.tdiff*this.lookSpeed;
this.activeLook||(d=0);this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=
(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",e(this,
this.onMouseMove),!1);this.domElement.addEventListener("mousedown",e(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",e(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",e(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",e(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);if(this.noFly)e.y=0;this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};
THREE.PathCamera=function(b){function e(n,p,t,v){var u={name:t,fps:0.6,length:v,hierarchy:[]},w,y=p.getControlPointsArray(),z=p.getLength(),A=y.length,E=0;w=A-1;p={parent:-1,keys:[]};p.keys[0]={time:0,pos:y[0],rot:[0,0,0,1],scl:[1,1,1]};p.keys[w]={time:v,pos:y[w],rot:[0,0,0,1],scl:[1,1,1]};for(w=1;w<A-1;w++){E=v*z.chunks[w]/z.total;p.keys[w]={time:E,pos:y[w]}}u.hierarchy[0]=p;THREE.AnimationHandler.add(u);return new THREE.Animation(n,t,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(n,p){var t,
v,u=new THREE.Geometry;for(t=0;t<n.points.length*p;t++){v=t/(n.points.length*p);v=n.getPoint(v);u.vertices[t]=new THREE.Vertex(new THREE.Vector3(v.x,v.y,v.z))}return u}function d(n,p){var t=c(p,10),v=c(p,10),u=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(t,u);particleObj=new THREE.ParticleSystem(v,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);n.addChild(lineObj);particleObj.scale.set(1,1,1);n.addChild(particleObj);v=new THREE.Sphere(1,
16,8);u=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<p.points.length;i++){t=new THREE.Mesh(v,u);t.position.copy(p.points[i]);t.updateMatrix();n.addChild(t)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.0050;this.lookVertical=
!0;this.lookHorizontal=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==undefined)this.duration=b.duration*1E3;if(b.waypoints!==undefined)this.waypoints=b.waypoints;if(b.useConstantSpeed!==undefined)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==undefined)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==undefined)this.createDebugPath=b.createDebugPath;
if(b.createDebugDummy!==undefined)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==undefined)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==undefined)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==undefined)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var f=Math.PI*2,g=Math.PI/180;this.update=function(n,p,t){var v,u;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*g;this.theta=this.lon*g;v=this.phi%f;this.phi=v>=0?v:v+f;v=this.verticalAngleMap.srcRange;u=this.verticalAngleMap.dstRange;
this.phi=(this.phi-v[0])*(u[1]-u[0])/(v[1]-v[0])+u[0];v=this.horizontalAngleMap.srcRange;u=this.horizontalAngleMap.dstRange;this.theta=(this.theta-v[0])*(u[1]-u[0])/(v[1]-v[0])+u[0];v=this.target.position;v.x=100*Math.sin(this.phi)*Math.cos(this.theta);v.y=100*Math.cos(this.phi);v.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,n,p,t)};this.onMouseMove=function(n){this.mouseX=n.clientX-this.windowHalfX;this.mouseY=n.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);
this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var h=new THREE.MeshLambertMaterial({color:65280}),j=new THREE.Cube(10,10,20),m=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(j,b);b=new THREE.Mesh(m,h);b.position.set(0,10,0);this.animation=e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=
e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&d(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(n,p){return function(){p.apply(n,arguments)}}(this,this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.0050;this.dragToLook=!1;this.autoForward=!1;this.domElement=document;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==undefined)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==undefined)this.dragToLook=b.dragToLook;if(b.autoForward!==undefined)this.autoForward=
b.autoForward;if(b.domElement!==undefined)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var d=this.getContainerDimensions(),f=d.size[0]/2,g=d.size[1]/2;this.moveState.yawLeft=-(c.clientX-d.offset[0]-f)/f;this.moveState.pitchDown=(c.clientY-
d.offset[1]-g)/g;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var d=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*d,this.rotationVector.y*d,this.rotationVector.z*d,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",e(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",e(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",e(this,this.mouseup),!1);window.addEventListener("keydown",e(this,this.keydown),!1);window.addEventListener("keyup",e(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,e,c,d){THREE.Camera.call(this,b,e,c,d);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.useTarget=!1;this.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,j=new THREE.Matrix4,m=!1,n=1,p=0,t=0,v=0,u=0,w=0,y=window.innerWidth/2,z=window.innerHeight/2;this.update=
function(){var A=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=A;this.delta=(A-this.lastUpdate)/1E3;this.lastUpdate=A;if(this.mouseLook){A=this.delta*this.lookSpeed;this.rotateHorizontally(A*u);this.rotateVertically(A*w)}A=this.delta*this.movementSpeed;this.translateZ(A*(p>0||this.autoForward&&!(p<0)?1:p));this.translateX(A*t);this.translateY(A*v);m&&(this.roll+=this.rollSpeed*this.delta*n);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}h.copy(this.forward);g.set(0,1,0);f.cross(g,h).normalize();g.cross(h,f).normalize();this.matrix.n11=f.x;this.matrix.n12=g.x;this.matrix.n13=h.x;this.matrix.n21=f.y;this.matrix.n22=g.y;this.matrix.n23=h.y;this.matrix.n31=f.z;this.matrix.n32=g.z;this.matrix.n33=h.z;j.identity();j.n11=Math.cos(this.roll);j.n12=-Math.sin(this.roll);j.n21=Math.sin(this.roll);j.n22=Math.cos(this.roll);this.matrix.multiplySelf(j);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(A){this.position.x+=this.matrix.n11*A;this.position.y+=this.matrix.n21*A;this.position.z+=this.matrix.n31*A};this.translateY=function(A){this.position.x+=this.matrix.n12*A;this.position.y+=this.matrix.n22*A;this.position.z+=this.matrix.n32*A};this.translateZ=function(A){this.position.x-=this.matrix.n13*A;this.position.y-=
this.matrix.n23*A;this.position.z-=this.matrix.n33*A};this.rotateHorizontally=function(A){f.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);f.multiplyScalar(A);this.forward.subSelf(f);this.forward.normalize()};this.rotateVertically=function(A){g.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);g.multiplyScalar(A);this.forward.addSelf(g);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(A){A.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(A){u=(A.clientX-y)/window.innerWidth;w=(A.clientY-z)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(A){A.preventDefault();A.stopPropagation();switch(A.button){case 0:p=1;break;case 2:p=-1}},!1);this.domElement.addEventListener("mouseup",function(A){A.preventDefault();A.stopPropagation();switch(A.button){case 0:p=0;break;case 2:p=0}},!1);this.domElement.addEventListener("keydown",function(A){switch(A.keyCode){case 38:case 87:p=1;break;case 37:case 65:t=-1;break;
case 40:case 83:p=-1;break;case 39:case 68:t=1;break;case 81:m=!0;n=1;break;case 69:m=!0;n=-1;break;case 82:v=1;break;case 70:v=-1}},!1);this.domElement.addEventListener("keyup",function(A){switch(A.keyCode){case 38:case 87:p=0;break;case 37:case 65:t=0;break;case 40:case 83:p=0;break;case 39:case 68:t=0;break;case 81:m=!1;break;case 69:m=!1;break;case 82:v=0;break;case 70:v=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.Cube=function(b,e,c,d,f,g,h,j,m){function n(z,A,E,C,D,B,I,N){var J,K,L=d||1,aa=f||1,o=D/2,ja=B/2,ga=p.vertices.length;if(z=="x"&&A=="y"||z=="y"&&A=="x")J="z";else if(z=="x"&&A=="z"||z=="z"&&A=="x"){J="y";aa=g||1}else if(z=="z"&&A=="y"||z=="y"&&A=="z"){J="x";L=g||1}var qa=L+1,U=aa+1;D/=L;var Y=B/aa;for(K=0;K<U;K++)for(B=0;B<qa;B++){var $=new THREE.Vector3;$[z]=(B*D-o)*E;$[A]=(K*Y-ja)*C;$[J]=I;p.vertices.push(new THREE.Vertex($))}for(K=0;K<aa;K++)for(B=0;B<L;B++){p.faces.push(new THREE.Face4(B+
qa*K+ga,B+qa*(K+1)+ga,B+1+qa*(K+1)+ga,B+1+qa*K+ga,null,null,N));p.faceVertexUvs[0].push([new THREE.UV(B/L,K/aa),new THREE.UV(B/L,(K+1)/aa),new THREE.UV((B+1)/L,(K+1)/aa),new THREE.UV((B+1)/L,K/aa)])}}THREE.Geometry.call(this);var p=this,t=b/2,v=e/2,u=c/2;j=j?-1:1;if(h!==undefined)if(h instanceof Array)this.materials=h;else{this.materials=[];for(var w=0;w<6;w++)this.materials.push([h])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(m!=undefined)for(var y in m)this.sides[y]!=
undefined&&(this.sides[y]=m[y]);this.sides.px&&n("z","y",1*j,-1,c,e,-t,this.materials[0]);this.sides.nx&&n("z","y",-1*j,-1,c,e,t,this.materials[1]);this.sides.py&&n("x","z",1*j,1,b,c,v,this.materials[2]);this.sides.ny&&n("x","z",1*j,-1,b,c,-v,this.materials[3]);this.sides.pz&&n("x","y",1*j,-1,b,e,u,this.materials[4]);this.sides.nz&&n("x","y",-1*j,-1,b,e,-u,this.materials[5]);(function(){for(var z=[],A=[],E=0,C=p.vertices.length;E<C;E++){for(var D=p.vertices[E],B=!1,I=0,N=z.length;I<N;I++){var J=z[I];
if(D.position.x==J.position.x&&D.position.y==J.position.y&&D.position.z==J.position.z){A[E]=I;B=!0;break}}if(!B){A[E]=z.length;z.push(new THREE.Vertex(D.position.clone()))}}E=0;for(C=p.faces.length;E<C;E++){D=p.faces[E];D.a=A[D.a];D.b=A[D.b];D.c=A[D.c];D.d=A[D.d]}p.vertices=z})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,e,c,d,f,g){function h(v,u,w){j.vertices.push(new THREE.Vertex(new THREE.Vector3(v,u,w)))}THREE.Geometry.call(this);var j=this,m,n=Math.PI*2,p=d/2;for(m=0;m<b;m++)h(Math.sin(n*m/b)*e,Math.cos(n*m/b)*e,-p);for(m=0;m<b;m++)h(Math.sin(n*m/b)*c,Math.cos(n*m/b)*c,p);for(m=0;m<b;m++)j.faces.push(new THREE.Face4(m,m+b,b+(m+1)%b,(m+1)%b));if(c>0){h(0,0,-p-(g||0));for(m=b;m<b+b/2;m++)j.faces.push(new THREE.Face4(2*b,(2*m-2*b)%b,(2*m-2*b+1)%b,(2*m-2*b+2)%b))}if(e>0){h(0,0,p+(f||0));
for(m=b+b/2;m<2*b;m++)j.faces.push(new THREE.Face4(2*b+1,(2*m-2*b+2)%b+b,(2*m-2*b+1)%b+b,(2*m-2*b)%b+b))}m=0;for(b=this.faces.length;m<b;m++){e=[];c=this.faces[m];f=this.vertices[c.a];g=this.vertices[c.b];p=this.vertices[c.c];var t=this.vertices[c.d];e.push(new THREE.UV(0.5+Math.atan2(f.position.x,f.position.y)/n,0.5+f.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/n,0.5+g.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(p.position.x,p.position.y)/n,0.5+p.position.z/
d));c instanceof THREE.Face4&&e.push(new THREE.UV(0.5+Math.atan2(t.position.x,t.position.y)/n,0.5+t.position.z/d));this.faceVertexUvs[0].push(e)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function e(t,v,u){var w=Math.sqrt(t*t+v*v+u*u);return f.vertices.push(new THREE.Vertex(new THREE.Vector3(t/w,v/w,u/w)))-1}function c(t,v,u,w){w.faces.push(new THREE.Face3(t,v,u))}function d(t,v){var u=f.vertices[t].position,w=f.vertices[v].position;return e((u.x+w.x)/2,(u.y+w.y)/2,(u.z+w.z)/2)}var f=this,g=new THREE.Geometry,h;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;e(-1,b,0);e(1,b,0);e(-1,-b,0);e(1,-b,0);e(0,-1,b);e(0,1,b);e(0,-1,-b);e(0,
1,-b);e(b,0,-1);e(b,0,1);e(-b,0,-1);e(-b,0,1);c(0,11,5,g);c(0,5,1,g);c(0,1,7,g);c(0,7,10,g);c(0,10,11,g);c(1,5,9,g);c(5,11,4,g);c(11,10,2,g);c(10,7,6,g);c(7,1,8,g);c(3,9,4,g);c(3,4,2,g);c(3,2,6,g);c(3,6,8,g);c(3,8,9,g);c(4,9,5,g);c(2,4,11,g);c(6,2,10,g);c(8,6,7,g);c(9,8,1,g);for(b=0;b<this.subdivisions;b++){h=new THREE.Geometry;for(var j in g.faces){var m=d(g.faces[j].a,g.faces[j].b),n=d(g.faces[j].b,g.faces[j].c),p=d(g.faces[j].c,g.faces[j].a);c(g.faces[j].a,m,p,h);c(g.faces[j].b,n,m,h);c(g.faces[j].c,
p,n,h);c(m,n,p,h)}g.faces=h.faces}f.faces=g.faces;delete g;delete h;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,e,c){THREE.Geometry.call(this);this.steps=e||12;this.angle=c||2*Math.PI;e=this.angle/this.steps;c=[];for(var d=[],f=[],g=[],h=(new THREE.Matrix4).setRotationZ(e),j=0;j<b.length;j++){this.vertices.push(new THREE.Vertex(b[j]));c[j]=b[j].clone();d[j]=this.vertices.length-1}for(var m=0;m<=this.angle+0.0010;m+=e){for(j=0;j<c.length;j++)if(m<this.angle){c[j]=h.multiplyVector3(c[j].clone());this.vertices.push(new THREE.Vertex(c[j]));f[j]=this.vertices.length-1}else f=g;m==0&&(g=d);
for(j=0;j<d.length-1;j++){this.faces.push(new THREE.Face4(f[j],f[j+1],d[j+1],d[j]));this.faceVertexUvs[0].push([new THREE.UV(1-m/this.angle,j/b.length),new THREE.UV(1-m/this.angle,(j+1)/b.length),new THREE.UV(1-(m-e)/this.angle,(j+1)/b.length),new THREE.UV(1-(m-e)/this.angle,j/b.length)])}d=f;f=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,e,c,d){THREE.Geometry.call(this);var f,g=b/2,h=e/2;c=c||1;d=d||1;var j=c+1,m=d+1;b/=c;var n=e/d;for(f=0;f<m;f++)for(e=0;e<j;e++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(e*b-g,-(f*n-h),0)));for(f=0;f<d;f++)for(e=0;e<c;e++){this.faces.push(new THREE.Face4(e+j*f,e+j*(f+1),e+1+j*(f+1),e+1+j*f));this.faceVertexUvs[0].push([new THREE.UV(e/c,f/d),new THREE.UV(e/c,(f+1)/d),new THREE.UV((e+1)/c,(f+1)/d),new THREE.UV((e+1)/c,f/d)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,e,c){THREE.Geometry.call(this);var d,f=Math.PI,g=Math.max(3,e||8),h=Math.max(2,c||6);e=[];for(c=0;c<h+1;c++){d=c/h;var j=b*Math.cos(d*f),m=b*Math.sin(d*f),n=[],p=0;for(d=0;d<g;d++){var t=2*d/g,v=m*Math.sin(t*f);t=m*Math.cos(t*f);(c==0||c==h)&&d>0||(p=this.vertices.push(new THREE.Vertex(new THREE.Vector3(t,j,v)))-1);n.push(p)}e.push(n)}var u,w,y;f=e.length;for(c=0;c<f;c++){g=e[c].length;if(c>0)for(d=0;d<g;d++){n=d==g-1;h=e[c][n?0:d+1];j=e[c][n?g-1:d];m=e[c-1][n?g-1:d];n=e[c-
1][n?0:d+1];v=c/(f-1);u=(c-1)/(f-1);w=(d+1)/g;t=d/g;p=new THREE.UV(1-w,v);v=new THREE.UV(1-t,v);t=new THREE.UV(1-t,u);var z=new THREE.UV(1-w,u);if(c<e.length-1){u=this.vertices[h].position.clone();w=this.vertices[j].position.clone();y=this.vertices[m].position.clone();u.normalize();w.normalize();y.normalize();this.faces.push(new THREE.Face3(h,j,m,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([p,v,t])}if(c>1){u=this.vertices[h].position.clone();
w=this.vertices[m].position.clone();y=this.vertices[n].position.clone();u.normalize();w.normalize();y.normalize();this.faces.push(new THREE.Face3(h,m,n,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([p,t,z])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,e,c,d){THREE.Geometry.call(this);this.radius=b||100;this.tube=e||40;this.segmentsR=c||8;this.segmentsT=d||6;b=[];for(e=0;e<=this.segmentsR;++e)for(c=0;c<=this.segmentsT;++c){d=c/this.segmentsT*2*Math.PI;var f=e/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(f))*Math.cos(d),(this.radius+this.tube*Math.cos(f))*Math.sin(d),this.tube*Math.sin(f))));b.push([c/this.segmentsT,1-e/this.segmentsR])}for(e=1;e<=this.segmentsR;++e)for(c=
1;c<=this.segmentsT;++c){d=(this.segmentsT+1)*e+c;f=(this.segmentsT+1)*e+c-1;var g=(this.segmentsT+1)*(e-1)+c-1,h=(this.segmentsT+1)*(e-1)+c;this.faces.push(new THREE.Face4(d,f,g,h));this.faceVertexUvs[0].push([new THREE.UV(b[d][0],b[d][1]),new THREE.UV(b[f][0],b[f][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[h][0],b[h][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,e,c,d,f,g,h){function j(t,v,u,w,y,z){v=u/w*t;u=Math.cos(v);return new THREE.Vector3(y*(2+u)*0.5*Math.cos(t),y*(2+u)*Math.sin(t)*0.5,z*y*Math.sin(v)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=e||40;this.segmentsR=c||64;this.segmentsT=d||8;this.p=f||2;this.q=g||3;this.heightScale=h||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;d=new THREE.Vector3;g=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(e=0;e<this.segmentsT;++e){var m=
b/this.segmentsR*2*this.p*Math.PI;h=e/this.segmentsT*2*Math.PI;f=j(m,h,this.q,this.p,this.radius,this.heightScale);m=j(m+0.01,h,this.q,this.p,this.radius,this.heightScale);c.x=m.x-f.x;c.y=m.y-f.y;c.z=m.z-f.z;d.x=m.x+f.x;d.y=m.y+f.y;d.z=m.z+f.z;g.cross(c,d);d.cross(g,c);g.normalize();d.normalize();m=-this.tube*Math.cos(h);h=this.tube*Math.sin(h);f.x+=m*d.x+h*g.x;f.y+=m*d.y+h*g.y;f.z+=m*d.z+h*g.z;this.grid[b][e]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(f.x,f.y,f.z)))-1}}for(b=0;b<this.segmentsR;++b)for(e=
0;e<this.segmentsT;++e){d=(b+1)%this.segmentsR;g=(e+1)%this.segmentsT;f=this.grid[b][e];c=this.grid[d][e];d=this.grid[d][g];g=this.grid[b][g];h=new THREE.UV(b/this.segmentsR,e/this.segmentsT);m=new THREE.UV((b+1)/this.segmentsR,e/this.segmentsT);var n=new THREE.UV((b+1)/this.segmentsR,(e+1)/this.segmentsT),p=new THREE.UV(b/this.segmentsR,(e+1)/this.segmentsT);this.faces.push(new THREE.Face4(f,c,d,g));this.faceVertexUvs[0].push([h,m,n,p])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var e="Loaded ";e+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=e},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,e,c){b.materials=[];for(var d=0;d<e.length;++d)b.materials[d]=[THREE.Loader.prototype.createMaterial(e[d],c)]},createMaterial:function(b,e){function c(j){j=Math.log(j)/Math.LN2;return Math.floor(j)==j}function d(j,m){var n=new Image;n.onload=function(){if(!c(this.width)||!c(this.height)){var p=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),t=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));j.image.width=p;j.image.height=t;j.image.getContext("2d").drawImage(this,0,0,p,t)}else j.image=this;j.needsUpdate=!0};n.src=m}var f,g,h;f="MeshLambertMaterial";g={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};if(b.shading)if(b.shading=="Phong")f="MeshPhongMaterial";else b.shading=="Basic"&&(f="MeshBasicMaterial");if(b.blending)if(b.blending=="Additive")g.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")g.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")g.blending=THREE.MultiplyBlending;if(b.transparent!==undefined||b.opacity<1)g.transparent=b.transparent;if(b.depthTest!==undefined)g.depthTest=b.depthTest;if(b.vertexColors!==undefined)if(b.vertexColors=="face")g.vertexColors=THREE.FaceColors;else if(b.vertexColors)g.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&e){h=document.createElement("canvas");g.map=new THREE.Texture(h);g.map.sourceFile=b.mapDiffuse;d(g.map,e+"/"+b.mapDiffuse)}else if(b.colorDiffuse){h=(b.colorDiffuse[0]*255<<
16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255;g.color=h;g.opacity=b.transparency}else if(b.DbgColor)g.color=b.DbgColor;if(b.mapLightmap&&e){h=document.createElement("canvas");g.lightMap=new THREE.Texture(h);g.lightMap.sourceFile=b.mapLightmap;d(g.lightMap,e+"/"+b.mapLightmap)}return new THREE[f](g)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var e=this,c=b.model,d=b.callback,f=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(g){e.createModel(g.data,d,f);e.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,e,c){var d=new THREE.Geometry,f=b.scale!==undefined?1/b.scale:1;this.init_materials(d,b.materials,c);(function(g){if(b.version===undefined||b.version!=2)console.error("Deprecated file format.");else{var h,j,m,n,p,t,v,u,w,y,z,A,E,C,D=b.faces;t=b.vertices;var B=b.normals,I=b.colors,N=0;for(h=0;h<b.uvs.length;h++)b.uvs[h].length&&N++;for(h=0;h<N;h++){d.faceUvs[h]=[];d.faceVertexUvs[h]=[]}n=0;for(p=t.length;n<p;){v=new THREE.Vertex;v.position.x=t[n++]*
g;v.position.y=t[n++]*g;v.position.z=t[n++]*g;d.vertices.push(v)}n=0;for(p=D.length;n<p;){g=D[n++];t=g&1;m=g&2;h=g&4;j=g&8;u=g&16;v=g&32;y=g&64;g&=128;if(t){z=new THREE.Face4;z.a=D[n++];z.b=D[n++];z.c=D[n++];z.d=D[n++];t=4}else{z=new THREE.Face3;z.a=D[n++];z.b=D[n++];z.c=D[n++];t=3}if(m){m=D[n++];z.materials=d.materials[m]}m=d.faces.length;if(h)for(h=0;h<N;h++){A=b.uvs[h];w=D[n++];C=A[w*2];w=A[w*2+1];d.faceUvs[h][m]=new THREE.UV(C,w)}if(j)for(h=0;h<N;h++){A=b.uvs[h];E=[];for(j=0;j<t;j++){w=D[n++];
C=A[w*2];w=A[w*2+1];E[j]=new THREE.UV(C,w)}d.faceVertexUvs[h][m]=E}if(u){u=D[n++]*3;j=new THREE.Vector3;j.x=B[u++];j.y=B[u++];j.z=B[u];z.normal=j}if(v)for(h=0;h<t;h++){u=D[n++]*3;j=new THREE.Vector3;j.x=B[u++];j.y=B[u++];j.z=B[u];z.vertexNormals.push(j)}if(y){v=D[n++];v=new THREE.Color(I[v]);z.color=v}if(g)for(h=0;h<t;h++){v=D[n++];v=new THREE.Color(I[v]);z.vertexColors.push(v)}d.faces.push(z)}}})(f);(function(){var g,h,j,m;if(b.skinWeights){g=0;for(h=b.skinWeights.length;g<h;g+=2){j=b.skinWeights[g];
m=b.skinWeights[g+1];d.skinWeights.push(new THREE.Vector4(j,m,0,0))}}if(b.skinIndices){g=0;for(h=b.skinIndices.length;g<h;g+=2){j=b.skinIndices[g];m=b.skinIndices[g+1];d.skinIndices.push(new THREE.Vector4(j,m,0,0))}}d.bones=b.bones;d.animation=b.animation})();(function(g){if(b.morphTargets!==undefined){var h,j,m,n,p,t,v,u,w;h=0;for(j=b.morphTargets.length;h<j;h++){d.morphTargets[h]={};d.morphTargets[h].name=b.morphTargets[h].name;d.morphTargets[h].vertices=[];u=d.morphTargets[h].vertices;w=b.morphTargets[h].vertices;
m=0;for(n=w.length;m<n;m+=3){p=w[m]*g;t=w[m+1]*g;v=w[m+2]*g;u.push(new THREE.Vertex(new THREE.Vector3(p,t,v)))}}}if(b.morphColors!==undefined){h=0;for(j=b.morphColors.length;h<j;h++){d.morphColors[h]={};d.morphColors[h].name=b.morphColors[h].name;d.morphColors[h].colors=[];n=d.morphColors[h].colors;p=b.morphColors[h].colors;g=0;for(m=p.length;g<m;g+=3){t=new THREE.Color(16755200);t.setRGB(p[g],p[g+1],p[g+2]);n.push(t)}}}})(f);(function(){if(b.edges!==undefined){var g,h,j;for(g=0;g<b.edges.length;g+=
2){h=b.edges[g];j=b.edges[g+1];d.edges.push(new THREE.Edge(d.vertices[h],d.vertices[j],h,j))}}})();d.computeFaceNormals();e(d)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var e=b.model,c=b.callback,d=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(e),f=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(e);b=(new Date).getTime();e=new Worker(e);var g=this.showProgress?THREE.Loader.prototype.updateProgress:null;e.onmessage=function(h){THREE.BinaryLoader.prototype.loadAjaxBuffers(h.data.buffers,h.data.materials,c,f,d,g)};e.onerror=function(h){alert("worker.onerror: "+h.message+"\n"+h.data);h.preventDefault()};
e.postMessage(b)},loadAjaxBuffers:function(b,e,c,d,f,g){var h=new XMLHttpRequest,j=d+"/"+b,m=0;h.onreadystatechange=function(){if(h.readyState==4)h.status==200||h.status==0?THREE.BinaryLoader.prototype.createBinModel(h.responseText,c,f,e):alert("Couldn't load ["+j+"] ["+h.status+"]");else if(h.readyState==3){if(g){m==0&&(m=h.getResponseHeader("Content-Length"));g({total:m,loaded:h.responseText.length})}}else h.readyState==2&&(m=h.getResponseHeader("Content-Length"))};h.open("GET",j,!0);h.overrideMimeType("text/plain; charset=x-user-defined");
h.setRequestHeader("Content-Type","text/plain");h.send(null)},createBinModel:function(b,e,c,d){var f=function(g){function h(Z,ka){var ca=p(Z,ka),da=p(Z,ka+1),Na=p(Z,ka+2),bb=p(Z,ka+3),x=(bb<<1&255|Na>>7)-127;ca|=(Na&127)<<16|da<<8;if(ca==0&&x==-127)return 0;return(1-2*(bb>>7))*(1+ca*Math.pow(2,-23))*Math.pow(2,x)}function j(Z,ka){var ca=p(Z,ka),da=p(Z,ka+1),Na=p(Z,ka+2);return(p(Z,ka+3)<<24)+(Na<<16)+(da<<8)+ca}function m(Z,ka){var ca=p(Z,ka);return(p(Z,ka+1)<<8)+ca}function n(Z,ka){var ca=p(Z,ka);
return ca>127?ca-256:ca}function p(Z,ka){return Z.charCodeAt(ka)&255}function t(Z){var ka,ca,da;ka=j(b,Z);ca=j(b,Z+I);da=j(b,Z+N);Z=m(b,Z+J);THREE.BinaryLoader.prototype.f3(A,ka,ca,da,Z)}function v(Z){var ka,ca,da,Na,bb,x;ka=j(b,Z);ca=j(b,Z+I);da=j(b,Z+N);Na=m(b,Z+J);bb=j(b,Z+K);x=j(b,Z+L);Z=j(b,Z+aa);THREE.BinaryLoader.prototype.f3n(A,D,ka,ca,da,Na,bb,x,Z)}function u(Z){var ka,ca,da,Na;ka=j(b,Z);ca=j(b,Z+o);da=j(b,Z+ja);Na=j(b,Z+ga);Z=m(b,Z+qa);THREE.BinaryLoader.prototype.f4(A,ka,ca,da,Na,Z)}function w(Z){var ka,
ca,da,Na,bb,x,O,G;ka=j(b,Z);ca=j(b,Z+o);da=j(b,Z+ja);Na=j(b,Z+ga);bb=m(b,Z+qa);x=j(b,Z+U);O=j(b,Z+Y);G=j(b,Z+$);Z=j(b,Z+na);THREE.BinaryLoader.prototype.f4n(A,D,ka,ca,da,Na,bb,x,O,G,Z)}function y(Z){var ka,ca;ka=j(b,Z);ca=j(b,Z+ma);Z=j(b,Z+ra);THREE.BinaryLoader.prototype.uv3(A.faceVertexUvs[0],B[ka*2],B[ka*2+1],B[ca*2],B[ca*2+1],B[Z*2],B[Z*2+1])}function z(Z){var ka,ca,da;ka=j(b,Z);ca=j(b,Z+xa);da=j(b,Z+ua);Z=j(b,Z+Ga);THREE.BinaryLoader.prototype.uv4(A.faceVertexUvs[0],B[ka*2],B[ka*2+1],B[ca*2],
B[ca*2+1],B[da*2],B[da*2+1],B[Z*2],B[Z*2+1])}var A=this,E=0,C,D=[],B=[],I,N,J,K,L,aa,o,ja,ga,qa,U,Y,$,na,ma,ra,xa,ua,Ga,Ca,pa,za,Ka,Ta,Xa;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(A,d,g);C={signature:b.substr(E,8),header_bytes:p(b,E+8),vertex_coordinate_bytes:p(b,E+9),normal_coordinate_bytes:p(b,E+10),uv_coordinate_bytes:p(b,E+11),vertex_index_bytes:p(b,E+12),normal_index_bytes:p(b,E+13),uv_index_bytes:p(b,E+14),material_index_bytes:p(b,E+15),nvertices:j(b,E+16),nnormals:j(b,
E+16+4),nuvs:j(b,E+16+8),ntri_flat:j(b,E+16+12),ntri_smooth:j(b,E+16+16),ntri_flat_uv:j(b,E+16+20),ntri_smooth_uv:j(b,E+16+24),nquad_flat:j(b,E+16+28),nquad_smooth:j(b,E+16+32),nquad_flat_uv:j(b,E+16+36),nquad_smooth_uv:j(b,E+16+40)};E+=C.header_bytes;I=C.vertex_index_bytes;N=C.vertex_index_bytes*2;J=C.vertex_index_bytes*3;K=C.vertex_index_bytes*3+C.material_index_bytes;L=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes;aa=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes*
2;o=C.vertex_index_bytes;ja=C.vertex_index_bytes*2;ga=C.vertex_index_bytes*3;qa=C.vertex_index_bytes*4;U=C.vertex_index_bytes*4+C.material_index_bytes;Y=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes;$=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*2;na=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*3;ma=C.uv_index_bytes;ra=C.uv_index_bytes*2;xa=C.uv_index_bytes;ua=C.uv_index_bytes*2;Ga=C.uv_index_bytes*3;g=C.vertex_index_bytes*3+C.material_index_bytes;
Xa=C.vertex_index_bytes*4+C.material_index_bytes;Ca=C.ntri_flat*g;pa=C.ntri_smooth*(g+C.normal_index_bytes*3);za=C.ntri_flat_uv*(g+C.uv_index_bytes*3);Ka=C.ntri_smooth_uv*(g+C.normal_index_bytes*3+C.uv_index_bytes*3);Ta=C.nquad_flat*Xa;g=C.nquad_smooth*(Xa+C.normal_index_bytes*4);Xa=C.nquad_flat_uv*(Xa+C.uv_index_bytes*4);E+=function(Z){for(var ka,ca,da,Na=C.vertex_coordinate_bytes*3,bb=Z+C.nvertices*Na;Z<bb;Z+=Na){ka=h(b,Z);ca=h(b,Z+C.vertex_coordinate_bytes);da=h(b,Z+C.vertex_coordinate_bytes*2);
THREE.BinaryLoader.prototype.v(A,ka,ca,da)}return C.nvertices*Na}(E);E+=function(Z){for(var ka,ca,da,Na=C.normal_coordinate_bytes*3,bb=Z+C.nnormals*Na;Z<bb;Z+=Na){ka=n(b,Z);ca=n(b,Z+C.normal_coordinate_bytes);da=n(b,Z+C.normal_coordinate_bytes*2);D.push(ka/127,ca/127,da/127)}return C.nnormals*Na}(E);E+=function(Z){for(var ka,ca,da=C.uv_coordinate_bytes*2,Na=Z+C.nuvs*da;Z<Na;Z+=da){ka=h(b,Z);ca=h(b,Z+C.uv_coordinate_bytes);B.push(ka,ca)}return C.nuvs*da}(E);Ca=E+Ca;pa=Ca+pa;za=pa+za;Ka=za+Ka;Ta=Ka+
Ta;g=Ta+g;Xa=g+Xa;(function(Z){var ka,ca=C.vertex_index_bytes*3+C.material_index_bytes,da=ca+C.uv_index_bytes*3,Na=Z+C.ntri_flat_uv*da;for(ka=Z;ka<Na;ka+=da){t(ka);y(ka+ca)}return Na-Z})(pa);(function(Z){var ka,ca=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes*3,da=ca+C.uv_index_bytes*3,Na=Z+C.ntri_smooth_uv*da;for(ka=Z;ka<Na;ka+=da){v(ka);y(ka+ca)}return Na-Z})(za);(function(Z){var ka,ca=C.vertex_index_bytes*4+C.material_index_bytes,da=ca+C.uv_index_bytes*4,Na=Z+C.nquad_flat_uv*
da;for(ka=Z;ka<Na;ka+=da){u(ka);z(ka+ca)}return Na-Z})(g);(function(Z){var ka,ca=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*4,da=ca+C.uv_index_bytes*4,Na=Z+C.nquad_smooth_uv*da;for(ka=Z;ka<Na;ka+=da){w(ka);z(ka+ca)}return Na-Z})(Xa);(function(Z){var ka,ca=C.vertex_index_bytes*3+C.material_index_bytes,da=Z+C.ntri_flat*ca;for(ka=Z;ka<da;ka+=ca)t(ka);return da-Z})(E);(function(Z){var ka,ca=C.vertex_index_bytes*3+C.material_index_bytes+C.normal_index_bytes*3,da=Z+C.ntri_smooth*
ca;for(ka=Z;ka<da;ka+=ca)v(ka);return da-Z})(Ca);(function(Z){var ka,ca=C.vertex_index_bytes*4+C.material_index_bytes,da=Z+C.nquad_flat*ca;for(ka=Z;ka<da;ka+=ca)u(ka);return da-Z})(Ka);(function(Z){var ka,ca=C.vertex_index_bytes*4+C.material_index_bytes+C.normal_index_bytes*4,da=Z+C.nquad_smooth*ca;for(ka=Z;ka<da;ka+=ca)w(ka);return da-Z})(Ta);this.computeCentroids();this.computeFaceNormals()};f.prototype=new THREE.Geometry;f.prototype.constructor=f;e(new f(c))},v:function(b,e,c,d){b.vertices.push(new THREE.Vertex(new THREE.Vector3(e,
c,d)))},f3:function(b,e,c,d,f){b.faces.push(new THREE.Face3(e,c,d,null,null,b.materials[f]))},f4:function(b,e,c,d,f,g){b.faces.push(new THREE.Face4(e,c,d,f,null,null,b.materials[g]))},f3n:function(b,e,c,d,f,g,h,j,m){g=b.materials[g];var n=e[j*3],p=e[j*3+1];j=e[j*3+2];var t=e[m*3],v=e[m*3+1];m=e[m*3+2];b.faces.push(new THREE.Face3(c,d,f,[new THREE.Vector3(e[h*3],e[h*3+1],e[h*3+2]),new THREE.Vector3(n,p,j),new THREE.Vector3(t,v,m)],null,g))},f4n:function(b,e,c,d,f,g,h,j,m,n,p){h=b.materials[h];var t=
e[m*3],v=e[m*3+1];m=e[m*3+2];var u=e[n*3],w=e[n*3+1];n=e[n*3+2];var y=e[p*3],z=e[p*3+1];p=e[p*3+2];b.faces.push(new THREE.Face4(c,d,f,g,[new THREE.Vector3(e[j*3],e[j*3+1],e[j*3+2]),new THREE.Vector3(t,v,m),new THREE.Vector3(u,w,n),new THREE.Vector3(y,z,p)],null,h))},uv3:function(b,e,c,d,f,g,h){var j=[];j.push(new THREE.UV(e,c));j.push(new THREE.UV(d,f));j.push(new THREE.UV(g,h));b.push(j)},uv4:function(b,e,c,d,f,g,h,j,m){var n=[];n.push(new THREE.UV(e,c));n.push(new THREE.UV(d,f));n.push(new THREE.UV(g,
h));n.push(new THREE.UV(j,m));b.push(n)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,e){var c=this,d=new Worker(b);d.postMessage(0);var f=THREE.Loader.prototype.extractUrlbase(b);d.onmessage=function(g){function h(ma,ra){return ra=="relativeToHTML"?ma:f+"/"+ma}function j(){for(u in L.objects)if(!U.objects[u]){E=L.objects[u];if(E.geometry!==undefined){if(I=U.geometries[E.geometry]){K=[];for(na=0;na<E.materials.length;na++)K[na]=U.materials[E.materials[na]];C=E.position;r=E.rotation;q=E.quaternion;s=E.scale;q=0;K.length==0&&(K[0]=new THREE.MeshFaceMaterial);
K.length>1&&(K=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(I,K);object.name=u;object.position.set(C[0],C[1],C[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=E.visible;U.scene.addObject(object);U.objects[u]=object;if(E.meshCollider){var ma=THREE.CollisionUtils.MeshColliderWBox(object);U.scene.collisions.colliders.push(ma)}if(E.castsShadow){ma=new THREE.ShadowVolume(I);U.scene.addChild(ma);
ma.position=object.position;ma.rotation=object.rotation;ma.scale=object.scale}if(E.trigger&&E.trigger.toLowerCase()!="none"){ma={type:E.trigger,object:E};U.triggers[object.name]=ma}}}else{C=E.position;r=E.rotation;q=E.quaternion;s=E.scale;q=0;object=new THREE.Object3D;object.name=u;object.position.set(C[0],C[1],C[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=E.visible!==undefined?
E.visible:!1;U.scene.addObject(object);U.objects[u]=object;U.empties[u]=object;if(E.trigger&&E.trigger.toLowerCase()!="none"){ma={type:E.trigger,object:E};U.triggers[object.name]=ma}}}}function m(ma){return function(ra){U.geometries[ma]=ra;j();o-=1;c.onLoadComplete();p()}}function n(ma){return function(ra){U.geometries[ma]=ra}}function p(){c.callbackProgress({totalModels:ga,totalTextures:qa,loadedModels:ga-o,loadedTextures:qa-ja},U);c.onLoadProgress();o==0&&ja==0&&e(U)}var t,v,u,w,y,z,A,E,C,D,B,I,
N,J,K,L,aa,o,ja,ga,qa,U;L=g.data;g=new THREE.BinaryLoader;aa=new THREE.JSONLoader;ja=o=0;U={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var Y=!1;for(u in L.objects){E=L.objects[u];if(E.meshCollider){Y=!0;break}}if(Y)U.scene.collisions=new THREE.CollisionSystem;if(L.transform){Y=L.transform.position;D=L.transform.rotation;var $=L.transform.scale;Y&&U.scene.position.set(Y[0],Y[1],Y[2]);D&&U.scene.rotation.set(D[0],D[1],
D[2]);$&&U.scene.scale.set($[0],$[1],$[2]);(Y||D||$)&&U.scene.updateMatrix()}Y=function(){ja-=1;p();c.onLoadComplete()};for(y in L.cameras){D=L.cameras[y];if(D.type=="perspective")N=new THREE.Camera(D.fov,D.aspect,D.near,D.far);else if(D.type=="ortho"){N=new THREE.Camera;N.projectionMatrix=THREE.Matrix4.makeOrtho(D.left,D.right,D.top,D.bottom,D.near,D.far)}C=D.position;D=D.target;N.position.set(C[0],C[1],C[2]);N.target.position.set(D[0],D[1],D[2]);U.cameras[y]=N}for(w in L.lights){y=L.lights[w];N=
y.color!==undefined?y.color:16777215;D=y.intensity!==undefined?y.intensity:1;if(y.type=="directional"){C=y.direction;light=new THREE.DirectionalLight(N,D);light.position.set(C[0],C[1],C[2]);light.position.normalize()}else if(y.type=="point"){C=y.position;light=new THREE.PointLight(N,D);light.position.set(C[0],C[1],C[2])}U.scene.addLight(light);U.lights[w]=light}for(z in L.fogs){w=L.fogs[z];if(w.type=="linear")J=new THREE.Fog(0,w.near,w.far);else w.type=="exp2"&&(J=new THREE.FogExp2(0,w.density));
D=w.color;J.color.setRGB(D[0],D[1],D[2]);U.fogs[z]=J}if(U.cameras&&L.defaults.camera)U.currentCamera=U.cameras[L.defaults.camera];if(U.fogs&&L.defaults.fog)U.scene.fog=U.fogs[L.defaults.fog];D=L.defaults.bgcolor;U.bgColor=new THREE.Color;U.bgColor.setRGB(D[0],D[1],D[2]);U.bgColorAlpha=L.defaults.bgalpha;for(t in L.geometries){z=L.geometries[t];if(z.type=="bin_mesh"||z.type=="ascii_mesh"){o+=1;c.onLoadStart()}}ga=o;for(t in L.geometries){z=L.geometries[t];if(z.type=="cube"){I=new THREE.Cube(z.width,
z.height,z.depth,z.segmentsWidth,z.segmentsHeight,z.segmentsDepth,null,z.flipped,z.sides);U.geometries[t]=I}else if(z.type=="plane"){I=new THREE.Plane(z.width,z.height,z.segmentsWidth,z.segmentsHeight);U.geometries[t]=I}else if(z.type=="sphere"){I=new THREE.Sphere(z.radius,z.segmentsWidth,z.segmentsHeight);U.geometries[t]=I}else if(z.type=="cylinder"){I=new THREE.Cylinder(z.numSegs,z.topRad,z.botRad,z.height,z.topOffset,z.botOffset);U.geometries[t]=I}else if(z.type=="torus"){I=new THREE.Torus(z.radius,
z.tube,z.segmentsR,z.segmentsT);U.geometries[t]=I}else if(z.type=="icosahedron"){I=new THREE.Icosahedron(z.subdivisions);U.geometries[t]=I}else if(z.type=="bin_mesh")g.load({model:h(z.url,L.urlBaseType),callback:m(t)});else if(z.type=="ascii_mesh")aa.load({model:h(z.url,L.urlBaseType),callback:m(t)});else z.type=="embedded_mesh"&&(z=L.embeds[z.id])&&aa.createModel(z,n(t),"")}for(A in L.textures){t=L.textures[A];if(t.url instanceof Array){ja+=t.url.length;for(g=0;g<t.url.length;g++)c.onLoadStart()}else{ja+=
1;c.onLoadStart()}}qa=ja;for(A in L.textures){t=L.textures[A];if(t.mapping!=undefined&&THREE[t.mapping]!=undefined)t.mapping=new THREE[t.mapping];if(t.url instanceof Array){g=[];for(var na=0;na<t.url.length;na++)g[na]=h(t.url[na],L.urlBaseType);g=THREE.ImageUtils.loadTextureCube(g,t.mapping,Y)}else{g=THREE.ImageUtils.loadTexture(h(t.url,L.urlBaseType),t.mapping,Y);if(THREE[t.minFilter]!=undefined)g.minFilter=THREE[t.minFilter];if(THREE[t.magFilter]!=undefined)g.magFilter=THREE[t.magFilter]}U.textures[A]=
g}for(v in L.materials){A=L.materials[v];for(B in A.parameters)if(B=="envMap"||B=="map"||B=="lightMap")A.parameters[B]=U.textures[A.parameters[B]];else if(B=="shading")A.parameters[B]=A.parameters[B]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(B=="blending")A.parameters[B]=THREE[A.parameters[B]]?THREE[A.parameters[B]]:THREE.NormalBlending;else if(B=="combine")A.parameters[B]=A.parameters[B]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(B=="vertexColors")if(A.parameters[B]==
"face")A.parameters[B]=THREE.FaceColors;else if(A.parameters[B])A.parameters[B]=THREE.VertexColors;if(A.parameters.opacity!==undefined&&A.parameters.opacity<1)A.parameters.transparent=!0;A=new THREE[A.type](A.parameters);U.materials[v]=A}j();c.callbackSync(U)}}};
THREE.MarchingCubes=function(b,e){THREE.Object3D.call(this);this.materials=e instanceof Array?e:[e];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasPos=!1;this.hasNormal=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,d,f){return c+(d-c)*f};this.VIntX=function(c,d,f,g,h,j,m,n,p,t){h=(h-p)/(t-p);p=this.normal_cache;d[g]=j+h*this.delta;d[g+1]=m;d[g+2]=n;f[g]=this.lerp(p[c],p[c+3],h);f[g+1]=this.lerp(p[c+1],p[c+4],h);f[g+2]=this.lerp(p[c+2],p[c+5],h)};this.VIntY=function(c,d,f,g,h,j,m,n,p,t){h=(h-p)/(t-p);p=this.normal_cache;d[g]=j;d[g+1]=m+h*this.delta;d[g+
2]=n;d=c+this.yd*3;f[g]=this.lerp(p[c],p[d],h);f[g+1]=this.lerp(p[c+1],p[d+1],h);f[g+2]=this.lerp(p[c+2],p[d+2],h)};this.VIntZ=function(c,d,f,g,h,j,m,n,p,t){h=(h-p)/(t-p);p=this.normal_cache;d[g]=j;d[g+1]=m;d[g+2]=n+h*this.delta;d=c+this.zd*3;f[g]=this.lerp(p[c],p[d],h);f[g+1]=this.lerp(p[c+1],p[d+1],h);f[g+2]=this.lerp(p[c+2],p[d+2],h)};this.compNorm=function(c){var d=c*3;if(this.normal_cache[d]==0){this.normal_cache[d]=this.field[c-1]-this.field[c+1];this.normal_cache[d+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[d+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,d,f,g,h,j){var m=g+1,n=g+this.yd,p=g+this.zd,t=m+this.yd,v=m+this.zd,u=g+this.yd+this.zd,w=m+this.yd+this.zd,y=0,z=this.field[g],A=this.field[m],E=this.field[n],C=this.field[t],D=this.field[p],B=this.field[v],I=this.field[u],N=this.field[w];z<h&&(y|=1);A<h&&(y|=2);E<h&&(y|=8);C<h&&(y|=4);D<h&&(y|=16);B<h&&(y|=32);I<h&&(y|=128);N<h&&(y|=64);var J=THREE.edgeTable[y];if(J==0)return 0;
var K=this.delta,L=c+K,aa=d+K;K=f+K;if(J&1){this.compNorm(g);this.compNorm(m);this.VIntX(g*3,this.vlist,this.nlist,0,h,c,d,f,z,A)}if(J&2){this.compNorm(m);this.compNorm(t);this.VIntY(m*3,this.vlist,this.nlist,3,h,L,d,f,A,C)}if(J&4){this.compNorm(n);this.compNorm(t);this.VIntX(n*3,this.vlist,this.nlist,6,h,c,aa,f,E,C)}if(J&8){this.compNorm(g);this.compNorm(n);this.VIntY(g*3,this.vlist,this.nlist,9,h,c,d,f,z,E)}if(J&16){this.compNorm(p);this.compNorm(v);this.VIntX(p*3,this.vlist,this.nlist,12,h,c,d,
K,D,B)}if(J&32){this.compNorm(v);this.compNorm(w);this.VIntY(v*3,this.vlist,this.nlist,15,h,L,d,K,B,N)}if(J&64){this.compNorm(u);this.compNorm(w);this.VIntX(u*3,this.vlist,this.nlist,18,h,c,aa,K,I,N)}if(J&128){this.compNorm(p);this.compNorm(u);this.VIntY(p*3,this.vlist,this.nlist,21,h,c,d,K,D,I)}if(J&256){this.compNorm(g);this.compNorm(p);this.VIntZ(g*3,this.vlist,this.nlist,24,h,c,d,f,z,D)}if(J&512){this.compNorm(m);this.compNorm(v);this.VIntZ(m*3,this.vlist,this.nlist,27,h,L,d,f,A,B)}if(J&1024){this.compNorm(t);
this.compNorm(w);this.VIntZ(t*3,this.vlist,this.nlist,30,h,L,aa,f,C,N)}if(J&2048){this.compNorm(n);this.compNorm(u);this.VIntZ(n*3,this.vlist,this.nlist,33,h,c,aa,f,E,I)}y<<=4;for(h=g=0;THREE.triTable[y+h]!=-1;){c=y+h;d=c+1;f=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[d],3*THREE.triTable[f],j);h+=3;g++}return g};this.posnormtriv=function(c,d,f,g,h,j){var m=this.count*3;this.positionArray[m]=c[f];this.positionArray[m+1]=c[f+1];this.positionArray[m+2]=c[f+2];this.positionArray[m+
3]=c[g];this.positionArray[m+4]=c[g+1];this.positionArray[m+5]=c[g+2];this.positionArray[m+6]=c[h];this.positionArray[m+7]=c[h+1];this.positionArray[m+8]=c[h+2];this.normalArray[m]=d[f];this.normalArray[m+1]=d[f+1];this.normalArray[m+2]=d[f+2];this.normalArray[m+3]=d[g];this.normalArray[m+4]=d[g+1];this.normalArray[m+5]=d[g+2];this.normalArray[m+6]=d[h];this.normalArray[m+7]=d[h+1];this.normalArray[m+8]=d[h+2];this.hasPos=!0;this.hasNormal=!0;this.count+=3;this.count>=this.maxCount-3&&j(this)};this.begin=
function(){this.count=0;this.hasPos=!1;this.hasNormal=!1};this.end=function(c){if(this.count!=0){for(var d=this.count*3;d<this.positionArray.length;d++)this.positionArray[d]=0;c(this)}};this.addBall=function(c,d,f,g,h){var j=this.size*Math.sqrt(g/h),m=f*this.size,n=d*this.size,p=c*this.size,t=Math.floor(m-j);t<1&&(t=1);m=Math.floor(m+j);m>this.size-1&&(m=this.size-1);var v=Math.floor(n-j);v<1&&(v=1);n=Math.floor(n+j);n>this.size-1&&(n=this.size-1);var u=Math.floor(p-j);u<1&&(u=1);j=Math.floor(p+j);
j>this.size-1&&(j=this.size-1);for(var w,y,z,A,E,C;t<m;t++){p=this.size2*t;y=t/this.size-f;E=y*y;for(y=v;y<n;y++){z=p+this.size*y;w=y/this.size-d;C=w*w;for(w=u;w<j;w++){A=w/this.size-c;A=g/(1.0E-6+A*A+C+E)-h;A>0&&(this.field[z+w]+=A)}}}};this.addPlaneX=function(c,d){var f,g,h,j,m,n=this.size,p=this.yd,t=this.zd,v=this.field,u=n*Math.sqrt(c/d);u>n&&(u=n);for(f=0;f<u;f++){g=f/n;g*=g;j=c/(1.0E-4+g)-d;if(j>0)for(g=0;g<n;g++){m=f+g*p;for(h=0;h<n;h++)v[t*h+m]+=j}}};this.addPlaneY=function(c,d){var f,g,
h,j,m,n,p=this.size,t=this.yd,v=this.zd,u=this.field,w=p*Math.sqrt(c/d);w>p&&(w=p);for(g=0;g<w;g++){f=g/p;f*=f;j=c/(1.0E-4+f)-d;if(j>0){m=g*t;for(f=0;f<p;f++){n=m+f;for(h=0;h<p;h++)u[v*h+n]+=j}}}};this.addPlaneZ=function(c,d){var f,g,h,j,m,n;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/d);dist>size&&(dist=size);for(h=0;h<dist;h++){f=h/size;f*=f;j=c/(1.0E-4+f)-d;if(j>0){m=zd*h;for(g=0;g<size;g++){n=m+g*yd;for(f=0;f<size;f++)field[n+f]+=j}}}};this.reset=function(){var c;
for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var d,f,g,h,j,m,n,p,t,v=this.size-2;for(h=1;h<v;h++){t=this.size2*h;n=(h-this.halfsize)/this.halfsize;for(g=1;g<v;g++){p=t+this.size*g;m=(g-this.halfsize)/this.halfsize;for(f=1;f<v;f++){j=(f-this.halfsize)/this.halfsize;d=p+f;this.polygonize(j,m,n,d,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,d=new THREE.Geometry,f=[];this.render(function(g){var h,j,m,n,p,t,v,u;for(h=
0;h<g.count;h++){v=h*3;p=v+1;u=v+2;j=g.positionArray[v];m=g.positionArray[p];n=g.positionArray[u];t=new THREE.Vector3(j,m,n);j=g.normalArray[v];m=g.normalArray[p];n=g.normalArray[u];v=new THREE.Vector3(j,m,n);v.normalize();p=new THREE.Vertex(t);d.vertices.push(p);f.push(v)}nfaces=g.count/3;for(h=0;h<nfaces;h++){v=(c+h)*3;p=v+1;u=v+2;t=f[v];j=f[p];m=f[u];v=new THREE.Face3(v,p,u,[t,j,m]);d.faces.push(v)}c+=nfaces;g.count=0});return d};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;
THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function e(g){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:g}))}function c(g,h){var j=new THREE.Geometry;j.vertices=[new THREE.Vertex,new THREE.Vertex(g)];return new THREE.Line(j,new THREE.LineBasicMaterial({color:h}))}THREE.Object3D.call(this);var d=Math.PI/2,f;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(f in THREE.Trident.defaultParams)b.hasOwnProperty(f)||(b[f]=THREE.Trident.defaultParams[f]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){f=e(b.xAxisColor);f.rotation.y=-d;f.position.x=b.length;this.addChild(f);f=e(b.yAxisColor);f.rotation.x=d;f.position.y=b.length;this.addChild(f);f=e(b.zAxisColor);f.rotation.y=Math.PI;f.position.z=b.length;this.addChild(f)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,e){this.point=b;this.normal=e};THREE.SphereCollider=function(b,e){this.center=b;this.radius=e;this.radiusSq=e*e};THREE.BoxCollider=function(b,e){this.min=b;this.max=e;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,e,c,d){this.vertices=b;this.faces=e;this.normals=c;this.box=d;this.numFaces=this.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var e,c,d,f,g=0;e=0;for(c=this.colliders.length;e<c;e++){f=this.colliders[e];d=this.rayCast(b,f);if(d<Number.MAX_VALUE){f.distance=d;d>g?this.hits.push(f):this.hits.unshift(f);g=d}}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var e=this.rayCastAll(b);if(e.length==0)return null;for(var c=0;e[c]instanceof THREE.MeshCollider;){var d=this.rayMesh(b,e[c]);if(d<Number.MAX_VALUE){e[c].distance=d;break}c++}if(c>e.length)return null;return e[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,e){if(e instanceof THREE.PlaneCollider)return this.rayPlane(b,e);else if(e instanceof THREE.SphereCollider)return this.raySphere(b,e);else if(e instanceof THREE.BoxCollider)return this.rayBox(b,e);else if(e instanceof THREE.MeshCollider&&e.box)return this.rayBox(b,e.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,e){for(var c=this.makeRayLocal(b,e.mesh),d=Number.MAX_VALUE,f=0;f<e.numFaces/3;f++){var g=f*3;g=this.rayTriangle(c,e.vertices[e.faces[g+0]],e.vertices[e.faces[g+1]],e.vertices[e.faces[g+2]],d,this.collisionNormal);if(g<d){d=g;e.normal.copy(this.collisionNormal);e.normal.normalize()}}return d};
THREE.CollisionSystem.prototype.rayTriangle=function(b,e,c,d,f,g){var h=THREE.CollisionSystem.__v1,j=THREE.CollisionSystem.__v2;g.set(0,0,0);h.sub(c,e);j.sub(d,c);g.cross(h,j);j=g.dot(b.direction);if(!(j<0))return Number.MAX_VALUE;h=g.dot(e)-g.dot(b.origin);if(!(h<=0))return Number.MAX_VALUE;if(!(h>=j*f))return Number.MAX_VALUE;h/=j;j=THREE.CollisionSystem.__v3;j.copy(b.direction);j.multiplyScalar(h);j.addSelf(b.origin);if(Math.abs(g.x)>Math.abs(g.y))if(Math.abs(g.x)>Math.abs(g.z)){b=j.y-e.y;g=c.y-
e.y;f=d.y-e.y;j=j.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=j.x-e.x;g=c.x-e.x;f=d.x-e.x;j=j.y-e.y;c=c.y-e.y;d=d.y-e.y}else if(Math.abs(g.y)>Math.abs(g.z)){b=j.x-e.x;g=c.x-e.x;f=d.x-e.x;j=j.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=j.x-e.x;g=c.x-e.x;f=d.x-e.x;j=j.y-e.y;c=c.y-e.y;d=d.y-e.y}e=g*d-c*f;if(e==0)return Number.MAX_VALUE;e=1/e;d=(b*d-j*f)*e;if(!(d>=0))return Number.MAX_VALUE;e*=g*j-c*b;if(!(e>=0))return Number.MAX_VALUE;if(!(1-d-e>=0))return Number.MAX_VALUE;return h};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,e){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(e.matrixWorld,c);var d=THREE.CollisionSystem.__r;d.origin.copy(b.origin);d.direction.copy(b.direction);c.multiplyVector3(d.origin);c.rotateAxis(d.direction);d.direction.normalize();return d};
THREE.CollisionSystem.prototype.rayBox=function(b,e){var c;if(e.dynamic&&e.mesh&&e.mesh.matrixWorld)c=this.makeRayLocal(b,e.mesh);else{c=THREE.CollisionSystem.__r;c.origin.copy(b.origin);c.direction.copy(b.direction)}var d=0,f=0,g=0,h=0,j=0,m=0,n=!0;if(c.origin.x<e.min.x){d=e.min.x-c.origin.x;d/=c.direction.x;n=!1;h=-1}else if(c.origin.x>e.max.x){d=e.max.x-c.origin.x;d/=c.direction.x;n=!1;h=1}if(c.origin.y<e.min.y){f=e.min.y-c.origin.y;f/=c.direction.y;n=!1;j=-1}else if(c.origin.y>e.max.y){f=e.max.y-
c.origin.y;f/=c.direction.y;n=!1;j=1}if(c.origin.z<e.min.z){g=e.min.z-c.origin.z;g/=c.direction.z;n=!1;m=-1}else if(c.origin.z>e.max.z){g=e.max.z-c.origin.z;g/=c.direction.z;n=!1;m=1}if(n)return-1;n=0;if(f>d){n=1;d=f}if(g>d){n=2;d=g}switch(n){case 0:j=c.origin.y+c.direction.y*d;if(j<e.min.y||j>e.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(h,0,0);break;case 1:h=c.origin.x+c.direction.x*d;if(h<e.min.x||h>e.max.x)return Number.MAX_VALUE;
c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(0,j,0);break;case 2:h=c.origin.x+c.direction.x*d;if(h<e.min.x||h>e.max.x)return Number.MAX_VALUE;j=c.origin.y+c.direction.y*d;if(j<e.min.y||j>e.max.y)return Number.MAX_VALUE;e.normal.set(0,0,m)}return d};THREE.CollisionSystem.prototype.rayPlane=function(b,e){var c=b.direction.dot(e.normal),d=e.point.dot(e.normal);if(c<0)c=(d-b.origin.dot(e.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,e){var c=e.center.clone().subSelf(b.origin);if(c.lengthSq<e.radiusSq)return-1;var d=c.dot(b.direction.clone());if(d<=0)return Number.MAX_VALUE;c=e.radiusSq-(c.lengthSq()-d*d);if(c>=0)return Math.abs(d)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var e=b.geometry.boundingBox,c=new THREE.Vector3(e.x[0],e.y[0],e.z[0]);e=new THREE.Vector3(e.x[1],e.y[1],e.z[1]);c=new THREE.BoxCollider(c,e);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var e=THREE.CollisionUtils.MeshOBB(b);e.min.addSelf(b.position);e.max.addSelf(b.position);e.dynamic=!1;return e};
THREE.CollisionUtils.MeshColliderWBox=function(b){for(var e=b.geometry.vertices,c=e.length,d=b.geometry.faces,f=d.length,g=[],h=[],j=[],m=0;m<c;m++)g.push(new THREE.Vector3(e[m].position.x,e[m].position.y,e[m].position.z));for(m=0;m<f;m++){h.push(d[m].a,d[m].b,d[m].c);j.push(new THREE.Vector3(d[m].normal.x,d[m].normal.y,d[m].normal.z))}e=new THREE.MeshCollider(g,h,j,THREE.CollisionUtils.MeshOBB(b));e.mesh=b;return e};
var LoadingBar=function(b){function e(){var m=h/g;if(m>j){j=m;f.style.width=m*300+"px"}}var c,d,f,g=0,h=0,j=0;c=document.createElement("div");d=document.createElement("div");d.style.position="absolute";d.style.display="block";d.style.width="300px";d.style.height="8px";d.style.borderStyle="solid";d.style.borderColor="rgba(255,255,255,0.5)";d.style.borderWidth="1px";d.style.borderRadius="5px";c.appendChild(d);f=document.createElement("div");f.style.position="absolute";f.style.height="10px";f.style.width=
"0px";f.style.background="#fff";f.style.borderRadius="5px";c.appendChild(f);c.style.margin="30px 0 0 0";this.addItem=function(){g++;e()};this.completeItem=function(){h++;e();g!=0&&g==h&&b()};this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,e=[],c=[],d=[],f=0,g=0,h=0,j=!1;this.add=function(m,n,p,t){m.__active=!1;m.__start=n;m.__duration=p-n;m.__end=p;m.__layer=t;m.init();e.push(m);e.sort(function(v,u){return v.__start-u.__start});d.push(m);d.sort(function(v,u){return v.__end-u.__end})};this.update=function(m){if(m<h){this.clear();h=m}for(;e[f];){b=e[f];if(b.__start>m)break;if(!b.__active&&b.__end>m){b.show((m-b.__start)/b.__duration);b.__active=!0;c.push(b);j=!0}f++}for(;d[g];){b=d[g];if(b.__end>m)break;
if(b.__active){b.hide();b.__active=!1;var n=c.indexOf(b);n!==-1&&c.splice(n,1)}g++}if(j){c.sort(function(t,v){return t.__layer-v.__layer});j=!1}n=0;for(var p=c.length;n<p;n++){b=c[n];b.update((m-b.__start)/b.__duration,m-h,m)}h=m};this.clear=function(){for(g=f=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var e,c,d;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(f){e=f;d=1/e*6E4};this.getBPM=function(){return e};this.setMS=function(f){d=f;e=1/d*6E4};this.getMS=function(){return d};this.setRows=function(f){c=f};this.getRows=function(){return c};this.getBeatMS=function(f){return d*f};this.getPatternMS=function(f){return d*c*f}};function preInitModel(b,e,c){e.initWebGLObjects(c);for(e=0;e<b.materials.length;e++);}
function preInitScene(b,e){e.initWebGLObjects(b.scene);var c,d;for(c in b.materials){d=b.materials[c];d instanceof THREE.MeshFaceMaterial||d.program||setTimeout(function(){e.initMaterial(d,b.scene.lights,b.scene.fog)},250)}}function preinitAnimal(b,e,c){e.initWebGLObjects(c)}
function initLensFlares(b,e,c,d){var f=THREE.ImageUtils.loadTexture("files/textures/lensflare0.png"),g=THREE.ImageUtils.loadTexture("files/textures/lensflare2.png"),h=THREE.ImageUtils.loadTexture("files/textures/lensflare3.png");b.lensFlare=new THREE.LensFlare(f,700,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(h,60,0.6,THREE.AdditiveBlending);b.lensFlare.add(h,
70,0.7,THREE.AdditiveBlending);b.lensFlare.add(h,120,0.9,THREE.AdditiveBlending);b.lensFlare.add(h,70,1,THREE.AdditiveBlending);b.lensFlare.customUpdateCallback=lensFlareUpdateCallback;b.lensFlare.position.copy(e);b.lensFlareRotate=new THREE.Object3D;b.lensFlareRotate.addChild(b.lensFlare);b.lensFlareRotate.rotation.x=c*Math.PI/180;b.lensFlareRotate.rotation.y=d*Math.PI/180;b.scene.addChild(b.lensFlareRotate);return b.lensFlareRotate}
function lensFlareUpdateCallback(b){var e,c,d=b.lensFlares.length,f=-b.positionScreen.x*2,g=-b.positionScreen.y*2;for(c=0;c<d;c++){e=b.lensFlares[c];e.x=b.positionScreen.x+f*e.distance;e.y=b.positionScreen.y+g*e.distance;e.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var e,c,d;e=0;for(c=b.objects.length;e<c;e++){d=b.objects[e];d.matrixAutoUpdate=!1;d.updateMatrix()}}
function hideColliders(b){var e,c,d;e=0;for(c=b.collisions.colliders.length;e<c;e++){d=b.collisions.colliders[e].mesh;d.visible=!1}}function applyMaterial(b,e,c){var d,f,g,h=e.length;for(d=0;d<h;d++){f=e[d][0];g=e[d][1];b.objects[f]&&(b.objects[f].geometry.materials[g][0]=c)}}
var UgcObject=function(b){var e={},c=0;this.addVoxel=function(g,h,j,m){e[g+"."+h+"."+j]={x:g,y:h,z:j,color:m};c++};this.checkVoxel=function(g,h,j){return e[g+"."+h+"."+j]};this.removeVoxel=function(g,h,j){delete e[g+"."+h+"."+j];c--};this.isEmpty=function(){return c==0};this.getJSON=function(){var g,h,j=[3];for(g in e){h=e[g];j.push(h.x,h.y,h.z,h.color)}g=JSON.stringify(j);console.log(g);return g};this.getMesh=function(){var g=new THREE.Cube(50,50,50),h=new THREE.Object3D,j;for(j in e){var m=e[j],
n=new THREE.Mesh(g,new THREE.MeshLambertMaterial({color:m.color}));n.position.x=m.x*50;n.position.y=m.y*50;n.position.z=m.z*50;n.matrixAutoUpdate=!1;n.updateMatrix();n.update();h.addChild(n)}return h};if(b&&b[0]==3)for(var d=1,f=b.length;d<f;)this.addVoxel(b[d++],b[d++],b[d++],b[d++])};UgcObject.TYPE_SAND="UgcObject.TYPE_SAND";UgcObject.TYPE_CLOUD="UgcObject.TYPE_CLOUD";
var UgcHandler=function(){this.getLatestUGOs=function(b){var e=new XMLHttpRequest;e.open("GET","/ugc/objects/latest",!0);e.onreadystatechange=function(){e.readyState==4&&(e.status==200?b(JSON.parse(e.responseText)):console.log("Unable to load latest User Generated Content"))};e.send(null)};this.submitUGO=function(b,e,c,d,f,g){b="title="+b+"&email="+e+"&type="+c+"&data="+d+"&image="+f;var h=new XMLHttpRequest;h.open("POST","/ugc/objects",!0);h.setRequestHeader("Content-type","application/x-www-form-urlencoded");
h.onreadystatechange=function(){h.readyState==4&&(h.status==200?g(h.responseText):console.log("Submission of model failed"))};h.send(b)}};
window.GEE=function(b){b||(b={});if(document.createElement("canvas").getContext){var e=this,c={},d={ctx:undefined,domElement:undefined,width:undefined,height:undefined,desiredFrameTime:1E3/60,frameCount:0,key:undefined,keyCode:undefined,mouseX:0,mouseY:0,pmouseX:undefined,pmouseY:undefined,mousePressed:!1},f,g=function(){for(var m=f,n=0,p=0;m;){p+=m.offsetTop;n+=m.offsetLeft;m=m.offsetParent}offset={x:n,y:p}};b.context||(b.context="2d");b.width||(b.width=500);b.height||(b.height=500);f=d.domElement=
document.createElement("canvas");d.ctx=f.getContext(b.context);if(d.ctx==null)b.fallback&&b.fallback();else{if(b.fullscreen){var h=function(){g();d.width=f.width=window.innerWidth;d.height=f.height=window.innerHeight-4};window.addEventListener("resize",h,!1);h();b.container||(b.container=document.body);document.body.style.margin="0px";document.body.style.padding="0px"}else{g();e.__defineSetter__("width",function(m){d.width=f.width=m});e.__defineSetter__("height",function(m){d.height=f.height=m});
e.width=b.width;e.height=b.height}if(b.container){b.container.appendChild(f);g()}b=function(m){e.__defineGetter__(m,function(){return d[m]})};b("ctx");b("width");b("height");b("frameCount");b("key");b("keyCode");b("mouseX");b("mouseY");b("pmouseX");b("pmouseY");b("mousePressed");b=function(){};e.loop=!0;e.keyup=b;e.keydown=b;e.draw=b;e.mousedown=b;e.mouseup=b;e.mousemove=b;e.mousedrag=b;e.__defineGetter__("frameRate",function(){return NaN});e.__defineGetter__("frameTime",function(){});e.__defineGetter__("keyPressed",
function(){for(var m in c)if(c[m])return!0;return!1});e.__defineSetter__("frameTime",function(m){d.desiredFrameTime=m});e.__defineSetter__("frameRate",function(m){d.desiredFrameTime=k/m});f.addEventListener("mouseenter",function(){g()},!1);var j=function(){e.mousemove()};window.addEventListener("mousemove",function(m){var n=m.pageX-offset.x;m=m.pageY-offset.y;if(d.pmouseX==undefined){d.pmouseX=n;d.pmouseY=m}else{d.pmouseX=d.mouseX;d.pmouseY=d.mouseY}d.mouseX=n;d.mouseY=m},!1);window.addEventListener("mousemove",
j,!1);f.addEventListener("mousedown",function(){d.mousePressed=!0;e.mousedown();f.addEventListener("mousemove",e.mousedrag,!1);f.removeEventListener("mousemove",j,!1)},!1);f.addEventListener("mouseup",function(){d.mousePressed=!1;e.mouseup();f.removeEventListener("mousemove",e.mousedrag,!1);f.addEventListener("mousemove",j,!1)},!1);window.addEventListener("keydown",function(m){m=m.keyCode;d.key=String.fromCharCode(m);d.keyCode=m;c[m]=!0;e.keydown()},!1);window.addEventListener("keyup",function(m){m=
m.keyCode;d.key=String.fromCharCode(m);d.keyCode=m;c[m]=!1;e.keyup()},!1)}}else b.fallback&&b.fallback()};function loadSVG(b,e,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200)if(d.responseXML==null)c!=undefined&&c.call(this,b);else{var f=d.responseXML.getElementsByTagName("svg").item(0);f=new SVG(f);f.filename=b;e.call(this,f,b)}else c!=undefined&&c.call(this,b)};d.open("GET",b,!0);d.send(null)}
var SVG=function(b){this.filename="";this.children=[];var e=b.getAttribute("width"),c=b.getAttribute("height");this.width=e==null?0:parseFloat(e.replace("px",""));this.height=c==null?0:parseFloat(c.replace("px",""));for(var d in b.childNodes)b.childNodes.item(d).getAttribute&&this.children.push(b.childNodes.item(d).nodeName=="g"?new SVG(b.childNodes.item(d)):new Path(b.childNodes.item(d)));this.draw=function(f){for(var g in this.children)this.children[g].draw(f)};this.__defineGetter__("path",function(){})},
Path=function(b){this.element=b;this.commands=commands(b);this.lineWidth=parseLineWidth(b);this.strokeStyle=parseStrokeStyle(b);this.fillStyle=parseFillStyle(b);this.totalLength=0;this.lengths=[];this.tlengths=[];var e=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0};this.reset()};this.draw=function(c){this.style(c);c.beginPath();this.shape(c);this.end(c)};this.getAnchorPoints=function(){var c=[],d;for(d in this.commands)c.push(this.commands[d].getAnchorPoints(e));
return c};this.shape=function(c){for(var d in this.commands)this.commands[d].shape(e,c)};this.lerp=function(c,d,f,g,h){var j=1-h;return c*j*j*j+3*d*h*j*j+3*f*h*h*j+g*h*h*h};this.at=function(c,d){var f,g;this.lengths.length==0&&this.calcLengths(d);g=this.tlengths[0];for(f=0;c>g;){f++;g+=this.tlengths[f]}pt=g-this.tlengths[f];g=this.map(c,pt,g,0,1);for(var h=0;h<=f;h++)this.commands[h].shape(e,d);var j=e.x;h=e.y;this.commands[f+1].shape(e,d);f=this.lerp(j,e.x1,e.x2,e.x,g);g=this.lerp(h,e.y1,e.y2,e.y,
g);return{x:f,y:g}};this.map=function(c,d,f,g,h){return g+(h-g)*((c-d)/(f-d))};this.calcLengths=function(c){var d,f,g,h,j=0;this.commands[0].shape(e,c);for(var m=g=e.x,n=h=e.y,p=1;p<this.commands.length;p++){j=0;m=e.x;n=e.y;this.commands[p].shape(e,c);for(var t=0;t<=1;t+=0.0010){d=this.lerp(m,e.x1,e.x2,e.x,t);f=this.lerp(n,e.y1,e.y2,e.y,t);j+=this.dist(d,f,g,h);g=d;h=f}this.lengths.push(j);this.totalLength+=j}for(c=0;c<this.lengths.length;c++)this.tlengths.push(this.lengths[c]/this.totalLength)};
this.dist=function(c,d,f,g){return Math.sqrt((c-f)*(c-f)+(d-g)*(d-g))};this.style=function(c){if(this.lineWidth!=null)c.lineWidth=this.lineWidth;if(this.strokeStyle!=null){c.strokeStyle=this.strokeStyle;if(this.lineWidth==undefined)c.lineWidth=1}if(this.fillStyle!=null)c.fillStyle=this.fillStyle};this.end=function(c){this.fillStyle!=null&&c.fill();this.strokeStyle!=null&&c.stroke()}},parseLineWidth=function(b){b=b.attributes.getNamedItem("stroke-width");return b==null?null:parseFloat(b.nodeValue)},
parseStrokeStyle=function(b){b=b.attributes.getNamedItem("stroke");return b==null?null:b.nodeValue},parseFillStyle=function(b){var e=b.attributes.getNamedItem("fill");if(e==null)return b.attributes.getNamedItem("stroke")!=null?null:"#000000";else{if(e.nodeValue=="none")return null;return e.nodeValue}},Command=function(b,e){this.type=b;this.data=e;this.debug=!1;this.shape=function(c,d){if(this.type=="M"){c.x=this.data[0];c.y=this.data[1];d&&d.moveTo(c.x,c.y)}else if(this.type=="C"){c.x=this.data[4];
c.y=this.data[5];if(d)d.bezierCurveTo(c.x1=this.data[0],c.y1=this.data[1],c.x2=this.data[2],c.y2=this.data[3],c.x,c.y)}else if(this.type=="c"){if(d)d.bezierCurveTo(c.x1=c.x+this.data[0],c.y1=c.y+this.data[1],c.x2=c.x+this.data[2],c.y2=c.y+this.data[3],c.x+=this.data[4],c.y+=this.data[5])}else if(this.type=="S"){c.x=this.data[2];c.y=this.data[3];var f=c.x-c.x2,g=c.y-c.y2;if(d)d.bezierCurveTo(c.x1=c.x+f,c.y1=c.y+g,c.x2=this.data[0],c.y2=this.data[1],c.x,c.y)}else if(this.type=="s"){f=c.x-c.x2;g=c.y-
c.y2;if(d)d.bezierCurveTo(c.x1=c.x+f,c.y1=c.y+g,c.x2=c.x+this.data[0],c.y2=c.y+this.data[1],c.x+=this.data[2],c.y+=this.data[3])}else if(this.type=="L"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="l"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=this.data[0],c.y+=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="H"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="h"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=
this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="V"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x,c.y=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="v"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x,c.y+=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="z")d.closePath();else console&&console.log("unrecognized command "+this.type);if(d){d.strokeStyle="#000000";d.lineWidth=1;if(this.debug){d.strokeRect(c.x-1.5,c.y-1.5,3,3);d.beginPath();d.moveTo(c.px,c.py);d.lineTo(c.x1,c.y1);d.closePath();d.stroke()}}}},
commands=function(b){if(b.nodeName.toLowerCase()=="path")return commandsFromD(b.getAttribute("d"));if(b.nodeName.toLowerCase()=="polygon")return commandsFromPoints(b.getAttribute("points"));if(b.nodeName.toLowerCase()=="line")return commandsFromLine(b);if(b.nodeName.toLowerCase()=="rect")return commandsFromRect(b);return[]},commandsFromD=function(b){var e=[];b=b.match(/[a-zA-Z][0-9\.\-\,]+/g);for(var c=0;c<b.length;c++){var d=b[c].charAt(0),f=b[c].substr(1);f=f.replace(/\-/g,",-");f.charAt(0)==","&&
(f=f.substr(1));f=f.split(",");for(var g=0;g<f.length;g++)f[g]=parseFloat(f[g]);e.push(new Command(d,f))}return e},commandsFromLine=function(b){var e=[],c=parseFloat(b.getAttribute("x1")),d=parseFloat(b.getAttribute("x2")),f=parseFloat(b.getAttribute("y1"));b=parseFloat(b.getAttribute("y2"));e.push(new Command("M",[c,f]));e.push(new Command("L",[d,b]));return e},commandsFromPoints=function(b){var e=!0;if(b.indexOf(",")==-1)for(var c=0;c<b.length;c++)if(b.charAt(c)==" "){e&&(b=b.setCharAt(c,","));
e=!e}b=("M"+b).replace(/ /g,"L")+"z";return commandsFromD(b)};String.prototype.setCharAt=function(b,e){if(b>this.length-1)return str;return this.substr(0,b)+e+this.substr(b+1)};
var commandsFromRect=function(b){var e=[],c=parseFloat(b.getAttribute("x")),d=parseFloat(b.getAttribute("y")),f=parseFloat(b.getAttribute("width"));b=parseFloat(b.getAttribute("height"));e.push(new Command("M",[c,d]));e.push(new Command("h",[f]));e.push(new Command("v",[b]));e.push(new Command("h",[-f]));e.push(new Command("v",[-b]));return e},WonderWall=WonderWall||{};
WonderWall.Point=function(b,e,c){var d=e,f=c,g=0;this.x=e;this.y=c;this.r=0.15;this.threshold=0.1;this.easing=0.125;this.updating=!1;this.angle=0;this.update=function(){if(this.updating){var h=b.mouseY-f;e=d+(b.mouseX-d)*this.r;c=f+h*this.r;this.easing=0.0625}else{e=d;c=f;g=0;this.easing=0.125}this.x=this.ease(this.x,e,this.easing);this.y=this.ease(this.y,c,this.easing);this.angle=this.ease(this.angle,g,this.easing)};this.setPosition=function(h,j){d=h;f=j};this.getOriginPosition=function(){return{x:d,
y:f}};this.getPoint=function(){return{x:this.x,y:this.y}}};WonderWall.Point.prototype.ease=function(b,e,c){var d=e-b;if(Math.abs(d)<c/100)b=e;else b+=d*c;return b};
WonderWall.Pentagon=function(b,e,c,d){var f=b.ctx;this.separate=!1;this.showFill=!0;this.showStroke=!0;this.insides=!1;this.x=e;this.y=c;if(this.x==undefined||this.x==null||this.x==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y==NaN)this.y=b.height/2;e=this.generatePoints(this.x,this.y,d,5);var g=[];for(c=0;c<e.length;c++){var h=e[c];g.push(new WonderWall.Point(b,h.x,h.y))}this.update=function(){this.x=b.width/2;this.y=b.height/2;var j=this.generatePoints(this.x,this.y,d,5);if(!this.separate)this.separate=
!0;for(var m=0;m<g.length;m++){var n=g[m],p=j[m];n.update();var t=n.getOriginPosition();(p.x!=t.x||p.y!=t.y)&&n.setPosition(p.x,p.y)}return this};this.render=function(){if(this.insides&&this.showStroke)for(var j=0;j<g.length;j++){var m=g[j];this.separate||m.update();f.beginPath();f.moveTo(this.x,this.y);f.lineTo(m.x,m.y);f.stroke()}f.beginPath();for(j=0;j<g.length;j++){m=g[j];this.separate||m.update();j<1?f.moveTo(m.x,m.y):f.lineTo(m.x,m.y)}f.closePath();this.showFill&&f.fill();this.showStroke&&f.stroke()};
this.setUpdate=function(j){for(var m=0;m<g.length;m++)g[m].updating=j};this.setUpdatePoint=function(j,m){g[m].updating=j};this.setRadius=function(j){for(var m=0;m<g.length;m++)g[m].r=j};this.getPoints=function(){return g}};WonderWall.Pentagon.prototype.generatePoints=function(b,e,c,d){for(var f=[],g=0;g<d;g++)f.push({x:c*Math.sin(g/d*2*Math.PI)+b,y:-c*Math.cos(g/d*2*Math.PI)+e});return f};
function Heart(b,e,c,d){var f=this,g=b.ctx;this.x=c;this.y=d;if(this.x==undefined||this.x==null||this.x||this==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y||this==NaN)this.y=b.height/2;var h,j=!1;this.update=function(){return this};this.render=function(){if(j){g.save();g.translate(this.x,this.y);g.save();g.translate(-this.width/2,-this.height/2);h.draw(g);g.restore();g.restore()}};loadSVG(e,function(m,n){h=m;f.source=n;f.width=h.width;f.height=h.height;j=!0},function(){})}
var ClearEffect=function(b){SequencerItem.call(this);var e,c=b.renderer,d=b.renderTarget;this.init=function(){e=new THREE.Camera(60,1,1,1E4);e.position.z=2;new THREE.Scene};this.update=function(){c.clear();var f=c.getContext();f.bindFramebuffer(f.FRAMEBUFFER,d.__webglFramebuffer);f.viewport(0,0,d.width,d.height);f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,h=e.renderer,j=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(g)};this.update=function(m){f.opacity=1-m;h.render(d,c,j)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,h=e.renderer,j=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(g)};this.update=function(m){f.opacity=m;h.render(d,c,j)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.position.z=200;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var h=new THREE.MeshBasicMaterial({map:g,depthTest:!1});d=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),h);d.scale.y=-1;d.doubleSided=!0;c.addObject(d)};this.update=function(){f.render(c,e)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,e,c,d){SequencerItem.call(this);var f,g,h,j,m,n=b.renderer,p=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;g=new THREE.Scene;j=THREE.ShaderUtils.lib.film;m=THREE.UniformsUtils.clone(j.uniforms);m.tDiffuse.texture=p;h=new THREE.MeshShaderMaterial({uniforms:m,vertexShader:j.vertexShader,fragmentShader:j.fragmentShader});m.grayscale.value=
0;if(e!==undefined)m.nIntensity.value=e;if(c!==undefined)m.sIntensity.value=c;if(d!==undefined)m.sCount.value=d;var t=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),h);t.position.z=-500;g.addObject(t)};this.update=function(t,v,u){m.time.value=u*0.01%1E4;n.render(g,f,p,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,h,j,m,n,p,t,v,u=b.renderer,w=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;d=new THREE.Scene;var y={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};m=new THREE.WebGLRenderTarget(256,512,y);n=new THREE.WebGLRenderTarget(512,256,y);y=THREE.ShaderUtils.lib.screen;
g=THREE.UniformsUtils.clone(y.uniforms);g.tDiffuse.texture=w;g.opacity.value=e!==undefined?e:1;f=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});y=THREE.ShaderUtils.lib.convolution;h=THREE.UniformsUtils.clone(y.uniforms);t=new THREE.Vector2(0.001953125,0);v=new THREE.Vector2(0,0.001953125);h.tDiffuse.texture=w;h.uImageIncrement.value=t;h.cKernel.value=THREE.ShaderUtils.buildKernel(4);j=new THREE.MeshShaderMaterial({uniforms:h,
vertexShader:"#define KERNEL_SIZE 25.0\n"+y.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+y.fragmentShader});p=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),j);p.position.z=-500;d.addObject(p)};this.update=function(){p.materials[0]=j;h.tDiffuse.texture=w;h.uImageIncrement.value=t;u.render(d,c,m,!0);h.tDiffuse.texture=m;h.uImageIncrement.value=v;u.render(d,c,n,!0);p.materials[0]=f;f.blending=THREE.AdditiveBlending;g.tDiffuse.texture=n;u.render(d,c,w,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var e,c,d,f,g=b.renderer,h=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={time:{type:"f",value:0},map:{type:"t",value:0,texture:h},sampleDistance:{type:"f",value:1/b.baseWidth}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);j.position.z=-500;c.addObject(j)};this.update=function(j,m,n){f.time.value=n*0.01;g.render(c,e,h,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.54},waveFactor:{type:"f",value:0.00127},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,e)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.49},waveFactor:{type:"f",value:0.00161},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.55 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,e)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.64},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.00756},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (1.86 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,e)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintEffectVideo=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.5},
colorOffset:{type:"f",value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0},waveFactor:{type:"f",value:0},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,e)}};PaintEffectVideo.prototype=new SequencerItem;PaintEffectVideo.prototype.constructor=PaintEffectVideo;
var PaintDarkEffect=function(b){SequencerItem.call(this);var e,c,d,f,g=b.renderer,h=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={map:{type:"t",value:0,texture:h}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);j.position.z=-500;c.addObject(j)};this.update=function(){g.render(c,e,h,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,e){SequencerItem.call(this);var c,d,f,g=b.renderer,h=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:e,transparent:!0});f=new THREE.Mesh(new THREE.Plane(3,3),this.material);d.addObject(f)};this.update=function(){this.material.opacity=0.25;g.render(d,c,h)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,e){SequencerItem.call(this);this.show=function(){document.body.style.cursor=e?'url("files/pointer.png"), auto':"none"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var CityWorld=function(b){function e(j){var m=j.scene;hideColliders(m);makeSceneStatic(m);preInitScene(j,b.renderer);m.scale.set(d,d,d);m.updateMatrix();c.scene.addChild(m);m.collisions&&c.scene.collisions.merge(m.collisions);TriggerUtils.setupCityTriggers(j);j.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;j.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;c.portals.push({object:j.objects.Portal,radius:100,currentDistance:9999999});c.portals.push({object:j.objects["Portal.001"],
radius:100,currentDistance:9999999});c.portals.push({object:j.objects["Portal.002"],radius:100,currentDistance:9999999});c.portals.push({object:j.objects["Portal.003"],radius:100,currentDistance:9999999});applyCityShader(j,["Backdrop_City"]);c.scene.update(undefined,!0)}var c=this,d=0.1;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;c.portals=[];this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var f=new THREE.DirectionalLight(16777215);
f.castShadow=!1;this.scene.addLight(f);var g=new THREE.DirectionalLight(16777215);g.castShadow=!1;this.scene.addLight(g);var h={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,s:0.494,v:0},directionalLight1:{h:0.565,s:0.329,v:0.841,x:0.5176767580772196,y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,
theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,flarey:358,flyCamera:{position:{x:16.574202591686277,y:462.26953453589,z:-10184.707948888321},target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(h.fogColor.h,h.fogColor.s,h.fogColor.v);this.scene.fog.density=h.fogDensity;f.color.setHSV(h.directionalLight1.h,
h.directionalLight1.s,h.directionalLight1.v);g.color.setHSV(h.directionalLight2.h,h.directionalLight2.s,h.directionalLight2.v);f.position.set(h.directionalLight1.x,h.directionalLight1.y,h.directionalLight1.z);g.position.set(h.directionalLight2.x,h.directionalLight2.y,h.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;f=new THREE.Vector3(0,0,-5E3);initLensFlares(c,f,20,358);f=new THREE.SceneLoader;f.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};
b.debug||f.load("files/models/city/City.js",e);this.update=function(j,m,n){m.matrixWorld.getPosition();TriggerUtils.effectorRadius=3E5;TriggerUtils.update();updateCityShader(j);if(n){j=m.matrixWorld.getPosition();for(m=0;m<c.portals.length;m++){c.portals[m].currentDistance=c.portals[m].object.matrixWorld.getPosition().distanceTo(j);c.portals[m].currentDistance<c.portals[m].radius&&b.signals.startexploration.dispatch("dunes")}}}},PrairieWorld=function(b){var e=this;this.scene=new THREE.Scene;this.scene.collisions=
new THREE.CollisionSystem;this.portals=[];this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.19587102348124588,0.9325398992514422,-0.30332141115410777);this.directionalLight1.color.setHSV(0,0,0.8764705882352941);this.scene.addLight(this.directionalLight1);
this.directionalLight2=new THREE.DirectionalLight(16772829);this.directionalLight2.position.set(0.19122302057716462,-0.30810803127799236,-0.9319351895187481);this.directionalLight2.color.setHSV(0.34705882352941175,0.5058823529411764,0.13529411764705881);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.058823529411765E-5,fogColor:{h:0.5235294117647059,s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,
z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,y:0.8775825618903728,z:-0.1553545034191468,phi:-1.588470588235294,theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,
y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,this.settings.directionalLight1.s,this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,
this.settings.directionalLight2.y,this.settings.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;var c=new THREE.Vector3(0,0,-3E3);initLensFlares(e,c,14,311);var d=THREE.ImageUtils.loadTexture("files/textures/trailMarkTexture.jpg");c=new THREE.SceneLoader;c.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};c.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};c.load("files/models/prairie/Prairie.js",function(f){var g=f.scene;hideColliders(g);makeSceneStatic(g);
ROME.TrailShaderUtils.setMaterials([f.objects.Ground],2500,d,b.renderer);TriggerUtils.setupPrairieTriggers(f);e.scene.addChild(g);f.objects.Backdrop.materials[0].map.wrapS=THREE.RepeatWrapping;f.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;e.portals.push({object:f.objects.Portal,radius:120,currentDistance:9999999});e.portals.push({object:f.objects["Portal.001"],radius:120,currentDistance:9999999});e.portals[0].object.visible=!1;e.portals[1].object.visible=!1;preInitScene(f,b.renderer);
g.collisions&&e.scene.collisions.merge(g.collisions);f=new THREE.JSONLoader;f.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};e.scene.update(undefined,!0)});this.update=function(f,g,h){ROME.TrailShaderUtils.updateLava(f*1.0E-4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=50;TriggerUtils.update();if(h){f=g.matrixWorld.getPosition();for(g=
0;g<e.portals.length;g++){e.portals[g].currentDistance=e.portals[g].object.matrixWorld.getPosition().distanceTo(f);e.portals[g].currentDistance<e.portals[g].radius&&b.signals.startexploration.dispatch("dunes")}}}},DunesWorld=function(b){function e(J){var K=J.scene;applyDunesShader(J);h(K);g(K,!0);E[B]=K.collisions.colliders[0].mesh;E[B].rotation.x=-90*Math.PI/180;E[B].scale.set(n,n,n);m.scene.addChild(E[B]);m.scene.collisions.merge(K.collisions);for(J=0;J<C[B];J++)A[B].push(c(K));B++}function c(J){for(var K=
0;K<J.children.length;K++)if(!J.children[K].__isCollider){J=J.children[K];J=new THREE.Mesh(J.geometry,J.materials);J.rotation.x=-90*Math.PI/180;J.scale.set(n,n,n);m.scene.addChild(J);return J}}function d(J){var K=J.scene;K.scale.set(n,n,n);K.matrixAutoUpdate=!0;h(K);g(K,!0);preInitScene(J,b.renderer);m.scene.addChild(K);K.collisions&&m.scene.collisions.merge(K.collisions);for(var L in J.objects)L.toLowerCase().indexOf("cloud")>=0&&applyCloudsShader(J.objects[L],CloudsShader,v,u,t);return K}function f(J,
K){return Math.round(Math.sin(J*0.0010)*Math.cos(K*0.0050)*4)*(Math.PI/2)}function g(J,K){THREE.SceneUtils.traverseHierarchy(J,function(L){if(!L.__isCollider)L.visible=K})}function h(J){THREE.SceneUtils.traverseHierarchy(J,function(K){for(var L=J.collisions.colliders,aa=0;aa<L.length;aa++)if(L[aa].mesh==K)K.__isCollider=!0})}function j(J){J.state=0;J.radius*=n;b.influenceSpheres.push(J);J.type===0&&m.portals.push(J)}var m=this,n=0.2,p=29990*n;m.portals=[];b.influenceSpheres=[];b.cameraSlowDown=!1;
var t=[],v=new THREE.Vector3,u=new THREE.Vector3;m.scene=new THREE.Scene;m.scene.collisions=new THREE.CollisionSystem;m.scene.fog=new THREE.FogExp2(16777215,2.75E-6);m.scene.fog.color.setHSV(0.576,0.382,0.9);var w=new THREE.AmbientLight(2232576),y=new THREE.DirectionalLight(16772829),z=new THREE.DirectionalLight(16772829);w.color.setHSV(0,0,0.1);y.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);y.color.setHSV(0.08823529411764706,0,1);z.position.set(0.09386404300915006,0.9829903100365339,
0.15785940518149455);z.color.setHSV(0,0,0.8647058823529412);m.scene.addLight(w);m.scene.addLight(y);m.scene.addLight(z);m.lensFlare=null;m.lensFlareRotate=null;initLensFlares(m,new THREE.Vector3(0,0,-1E4),70,292);var A=[[],[],[],[],[],[],[]],E=[],C=[0,0,0,0,1,1,1],D=[],B=0,I;for(w=0;w<5;w++){z=[];D.push(z);for(y=0;y<5;y++)if(y===0&&w===0)z.push(4);else if(y===0&&w===4)z.push(5);else if(y===1&&w===3)z.push(6);else{I=Math.floor(Math.random()*3.99999);z.push(I);C[I]++}}var N=new THREE.Mesh(new THREE.Cube(5E4,
5E4,5E4),undefined);N.flipSided=!0;applyDunesShader({objects:{skydome:N}});m.scene.addChild(N);w=new THREE.SceneLoader;w.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};w.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};w.load("files/models/dunes/D_tile_walk.js",function(J){applyDunesShader(J);A[4][0]=d(J)});w.load("files/models/dunes/D_tile_prairie.js",function(J){applyDunesShader(J,{D_tile_Prairie_Collis:!0,D_tile_Prairie_Island:!0},{"D_tile_Prairie_Is.000":-0.5},{D_tile_Prairie_Water:0.65});
A[5][0]=d(J);j({name:"prairiePortal",object:J.empties.Prairie_Portal,radius:2E3,type:0,destination:"prairie"});j({name:"prairieSlowDown",object:J.empties.Prairie_Center,radius:8E3,type:1})});w.load("files/models/dunes/D_tile_city.js",function(J){applyDunesShader(J,{D_tile_City_Collision:!0,D_tile_City_Island_Co:!0},{D_tile_City_Island:-1},{D_tile_City_Water:0.65});A[6][0]=d(J);j({name:"cityPortal",object:J.empties.City_Portal,radius:2500,type:0,destination:"city"});j({name:"citySlowDown",object:J.empties.City_Center,
radius:1E4,type:1})});w.load("files/models/dunes/D_tile_1.js",e);w.load("files/models/dunes/D_tile_2.js",e);w.load("files/models/dunes/D_tile_3.js",e);w.load("files/models/dunes/D_tile_4.js",e);(new UgcHandler).getLatestUGOs(function(J){for(var K=0,L=J.length;K<L;K++){var aa=new UgcObject(J[K]);if(!aa.isEmpty()){aa=aa.getMesh();aa.position.x=Math.random()*1E4-5E3;aa.position.z=Math.random()*1E4-5E3;m.scene.addObject(aa)}}});m.update=function(J,K,L){m.checkInfluenceSpheres(K,L);m.updateTiles(K);updateDunesShader(J);
N.position.copy(K.matrixWorld.getPosition());N.updateMatrix()};m.checkInfluenceSpheres=function(J,K){var L,aa,o,ja,ga=J.matrixWorld.getPosition();L=0;for(aa=b.influenceSpheres.length;L<aa;L++){ja=b.influenceSpheres[L];o=ja.object.matrixWorld.getPosition().distanceTo(ga);ja.currentDistance=o;if(o<ja.radius)if(ja.type===0&&ja.state===0){console.log("entered portal ["+ja.name+"]");ja.state=1;K&&b.signals.startexploration.dispatch(ja.destination)}else{if(ja.type==1)b.cameraSlowDown=!0}else{ja.state=0;
b.cameraSlowDown=!1}}};m.updateTiles=function(J){var K=Math.floor(2.5),L=J.matrixWorld.getPosition(),aa=L.x,o=L.z;L.addSelf(J.matrixWorld.getColumnZ().multiplyScalar(-p*1.5));J=Math.floor(L.x/p)%5;for(var ja=Math.floor(L.z/p)%5;J<0;)J+=5;for(;ja<0;)ja+=5;var ga,qa,U,Y,$,na,ma,ra=[0,0,0,0,0,0,0],xa=[-1,-1,-1,-1];for(qa=-K;qa<K+1;qa++)for(ga=-K;ga<K+1;ga++){$=(Math.floor(L.x/p)+ga)*p;na=(Math.floor(L.z/p)+qa)*p;U=(J+ga)%5;for(Y=(ja+qa)%5;U<0;)U+=5;for(;Y<0;)Y+=5;ma=D[Y][U];if(U=A[ma][ra[ma]++]){U.position.x=
$;U.position.z=na;U.rotation.z=f($,na)}if(ma<4){U=$-aa;Y=na-o;U=U*U+Y*Y;if(xa[ma]===-1||U<xa[ma]){xa[ma]=U;if(U=E[ma]){U.position.x=$;U.position.z=na;U.rotation.z=f($,na)}}}}}},CityShaderEffectors=[new THREE.Vector4(0,0,-1E3,50),new THREE.Vector4(-100,0,-1500,150),new THREE.Vector4(100,0,-2E3,150),new THREE.Vector4(0,0,-2500,100)],CityShader={uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},
time:{type:"f",value:0},targets:{type:"fv",value:[]},radiuses:{type:"fv1",value:[]}},vertexShader:"varying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;",
"const \t int  \tNUMTARGETS = "+CityShaderEffectors.length+";","uniform vec3 \ttargets[ NUMTARGETS ];\nuniform float \tradiuses[ NUMTARGETS ];\nuniform float time;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvoid main() {\nfloat distance = -9999999.0;\nfor( int i = 0; i < NUMTARGETS; i++ ) {\ndistance = max( distance, length( vWorldPosition - targets[ i ].xyz ) * -1.0 / radiuses[ i ] );\n}\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec4 grass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += ( 0.5 + grass.g ) * texture2D( surfaceImage, worldPosition.zx * vec2( 3.0 )).g;\nvec3 surface = vec3( 0.15 * 2.0, 0.18 * 2.0, 0.2 * 2.0 );\nif( distance > 0.0 )\nsurface = grass.rgb;\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 0.0001;\ngl_FragColor = vec4( surface * vColor * 2.0, 1.0 );\ngl_FragColor = vec4( mix( gl_FragColor.rgb, vec3( 0.64, 0.88, 1 ), depth ), 1.0 );\n}"].join("\n")};
function applyCityShader(b,e){var c,d,f,g,h,j={};for(c=0;c<e.length;c++)j[e[c]]=!0;updateCityShader(0);c={uniforms:CityShader.uniforms,vertexShader:CityShader.vertexShader,fragmentShader:CityShader.fragmentShader,shading:THREE.FlatShading,vertexColors:THREE.VertexColors};c.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;c.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;c.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;c.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;
h=new THREE.MeshShaderMaterial(c);for(d in b.objects){g=b.objects[d];if(!j[d]&&g.geometry&&g.geometry.morphTargets.length===0){f=g.geometry;for(c=0;c<f.materials.length;c++)g.materials[0]=h}}return h}function updateCityShader(b){var e,c,d=CityShaderEffectors.length,f,g=CityShader.uniforms.targets.value,h,j=CityShader.uniforms.radiuses.value;for(c=h=f=0;c<d;c++){e=CityShaderEffectors[c];g[f++]=e.x;g[f++]=e.y;g[f++]=e.z;j[h++]=e.w}CityShader.uniforms.time.value+=b/1E4}
var DunesShaderEffectors={position:[new THREE.Vector3(0,0,-1E3),new THREE.Vector3(-100,0,-4500),new THREE.Vector3(100,0,-8E3),new THREE.Vector3(2E3,0,-2500)],radius:[500,500,500,500],darkness:[1,0.5,0,0],positionFlat:[],materials:[]},DunesShader={uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},time:{type:"f",value:0},target:{type:"fv",
value:[]},radius:{type:"fv1",value:[]},darkness:{type:"fv1",value:[]},dunesOpacity:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );","const \t int  \tNUMTARGETS = "+DunesShaderEffectors.position.length+";","uniform vec3 \ttarget[ NUMTARGETS ];\nuniform float \tradius[ NUMTARGETS ];\nuniform float \tdarkness[ NUMTARGETS ];\nuniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform float time;\nuniform float dunesOpacity;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vNormalsquare;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nfloat distance = -9999999.0;\nfloat fragmentDarkness = 1.0;\nfor( int i = 0; i < NUMTARGETS; i++ ) {\ndistance = max( distance, length( vWorldPosition - target[ i ].xyz ) * -1.0 / radius[ i ] );\nfragmentDarkness = min( fragmentDarkness, 1.0 - darkness[ i ] );\n}\nvec3 worldPosition = vWorldPosition * 0.0005;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.x + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.y + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.z;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4( vColor, 1.0 );\nif(distance > 0.0)\nsurface = vec4( grass.rgb * fragmentDarkness, grass.w );\ngl_FragColor = mix( surface * texture2D( surfaceImage, worldPosition.zx * vec2( 0.4 ) + vec2(time)), surface, vec4( cloudMix, 0.1 ));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float LOG2 = 1.442695;\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 50.0;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.255 );\nsky_color = mix( vec3( 1.0 ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\ngl_FragColor.a = dunesOpacity;\n}"].join("\n")};
function applyDunesShader(b,e,c,d){function f(t,v){j=new THREE.MeshShaderMaterial(m);j.uniforms=THREE.UniformsUtils.clone(m.uniforms);j.uniforms.target.value=DunesShaderEffectors.positionFlat;j.uniforms.radius.value=DunesShaderEffectors.radius;j.uniforms.darkness.value=DunesShaderEffectors.darkness;j.uniforms.grassImage.texture=m.uniforms.grassImage.texture;j.uniforms.surfaceImage.texture=m.uniforms.surfaceImage.texture;j.uniforms.invertLightY.value=t;j.uniforms.dunesOpacity.value=v;h.materials=[j];
DunesShaderEffectors.materials.push(j)}var g,h,j;c=c!==undefined?c:{};e=e!==undefined?e:{};d=d!==undefined?d:{};var m={uniforms:DunesShader.uniforms,vertexShader:DunesShader.vertexShader,fragmentShader:DunesShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};m.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;m.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;m.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;m.uniforms.surfaceImage.texture.wrapT=
THREE.RepeatWrapping;var n=1,p=1;for(g in b.objects)if(!e[g]){h=b.objects[g];n=c[g]?c[g]:1;p=d[g]?d[g]:1;h.geometry&&h.geometry.morphTargets.length===0&&f(n,p)}}
function updateDunesShader(b){var e,c,d=DunesShaderEffectors.position.length,f,g=DunesShaderEffectors.positionFlat;for(c=f=0;c<d;c++){e=DunesShaderEffectors.position[c];g[f++]=e.x;g[f++]=e.y;g[f++]=e.z}b=DunesShader.uniforms.time.value+=b*1.0E-5;c=0;for(d=DunesShaderEffectors.materials.length;c<d;c++)DunesShaderEffectors.materials[c].uniforms.time.value=b}
var CloudsShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",value:0},targetStart:{type:"v3",
value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},
colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 worldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nworldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 worldVector;\nvoid main() {\nfloat distance, f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nf = normalize(worldVector).y;\nf = max(f, 0.0);\nsky_color = mix(vectorA, vectorB, f);\nvec3 worldPosition = vWorldPosition * 0.0005;\nsurface = vec4( vec3( 0.5 ), 1.0 );\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0001;\ngl_FragColor = vec4( vColor, 1.0 ) + vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(vectorC.rgb, 0.1));\ngl_FragColor = gl_FragColor + vec4( vLightWeighting, 1.0 );\ndepth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 50.0;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor/*min(length(worldVector) * 0.02, 1.0) */);\ngl_FragColor = vec4(vec3(vLightWeighting) * vec3(0.9, 0.5, 0.3) + vec3(0.7, 0.6, 0.6), vLightWeighting * 0.9 + 0.1);\n}"};
function applyCloudsShader(b,e,c,d,f){var g={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},h=new THREE.MeshShaderMaterial(g);h.uniforms=THREE.UniformsUtils.clone(g.uniforms);h.uniforms.targetStart.value=c;h.uniforms.targetEnd.value=d;h.uniforms.grassImage.texture=g.uniforms.grassImage.texture;h.uniforms.surfaceImage.texture=g.uniforms.surfaceImage.texture;h.uniforms.colorA.value=e.colors.colorA;
h.uniforms.colorB.value=e.colors.colorB;h.uniforms.colorC.value=e.colors.colorC;b.materials[0]=h;f.push(h);g.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;g.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;g.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;g.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping}
DunesCamera=function(b){var e=new THREE.Ray,c,d,f=new THREE.Vector3,g={forward:1,left:1,right:1,up:1,down:1},h=0,j,m;j=b.worlds.dunes;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);j.scene.addChild(m);j.scene.addChild(m.target);j.scene.addChild(c);j.scene.addChild(d);var n={};n.camera=m;n.resetCamera=function(){c.position.set(0,50,800);d.position.set(0,50,300);d.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
m.position.copy(c.position);m.target.position.copy(d.position)};n.updateCamera=function(p,t){t=t*(1E3/30)/1E3;var v,u,w;switch(h){case 0:w="forward";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnZ().negate());v=200;u=50;break;case 1:w="left";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnX().negate());v=40;u=50;break;case 2:w="right";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnX());v=40;
u=50;break;case 3:w="down";e.origin.copy(c.matrixWorld.getPosition()).y+=100;e.direction.copy(m.matrixWorld.getColumnY().negate());u=v=50;break;case 4:w="up";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnY());v=40;u=50}h++;h>4&&(h=0);g[w]=1;var y=j.scene.collisions.rayCastNearest(e),z=-1;if(y&&y.distance!==-1){z=y.distance*0.1;w!=="down"&&z<v+u&&(g[w]=z<v?0:1-(z-v)/u)}v=b.mouse.x/b.screenWidth-0.5;u=b.mouse.y/b.screenHeight-0.5;if(w!=="forward"&&g[w]<1){y=new THREE.Vector3;
y.copy(e.direction).negate().multiplyScalar((1-g[w])*15);if(w==="left"||w==="right")y.y=0;else{y.x=0;y.z=0}d.position.addSelf(y);g[w]=Math.max(g[w],0.3);v*=0.1;u*=0.1}if(w==="down"&&z<50){w=c.position.y;c.position.y=e.origin.addSelf(e.direction.multiplyScalar(z)).y+10;d.position.y+=c.position.y-w}else e.origin.addSelf(e.direction.multiplyScalar(z)).y<200&&(g[w]=1);z=g.forward*g.up*g.down*g.right*g.left;Math.abs(d.position.y-c.position.y)<50&&(d.position.y-=u*15);d.position.y=Math.max(d.position.y,
10);d.position.y=Math.min(d.position.y,4500);f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*200-f.z*12*v*t;d.position.z=c.position.z+f.z*200+f.x*12*v*t;if(p<0.29){cameraSpeed=3;b.cameraSlowDown=!0;f.y=0;f.normalize();d.position.y=c.position.y}else cameraSpeed=10;b.cameraSlowDown||(cameraSpeed+=5*((Math.min(Math.max(c.position.y,10),3E3)-10)/2990));c.position.addSelf(f.multiplyScalar(cameraSpeed*z*t));if(p>0.29&&p<0.375){c.position.y+=4.5*t;d.position.y+=t*4.05}c.position.y=
Math.max(c.position.y,10);c.position.y=Math.min(c.position.y,4500);m.position.x+=(c.position.x-m.position.x)*0.02*t;m.position.y+=(c.position.y-m.position.y)*0.02*t;m.position.z+=(c.position.z-m.position.z)*0.02*t;m.target.position.x+=(d.position.x-m.target.position.x)*0.02*t;m.target.position.y+=(d.position.y-m.target.position.y)*0.02*t;m.target.position.z+=(d.position.z-m.target.position.z)*0.02*t;z=m.matrixWorld.getColumnZ();f.normalize();f.y=z.y;f.subSelf(z).normalize();f.multiplyScalar(0.3*t);
c.up.set(0,1,0);c.up.subSelf(f).normalize();m.up.x+=(c.up.x-m.up.x)*0.02;m.up.y+=(c.up.y-m.up.y)*0.02;m.up.z+=(c.up.z-m.up.z)*0.02};return n};
DunesCameraFreeExplore=function(b){var e=new THREE.Ray,c,d,f=new THREE.Vector3,g={forward:1,left:1,right:1,up:1,down:1},h=0,j,m;j=b.worlds.dunes;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);j.scene.addChild(m);j.scene.addChild(m.target);j.scene.addChild(c);j.scene.addChild(d);var n={};n.camera=m;n.resetCamera=function(){c.position.set(0,300,0);d.position.set(0,300,-500);d.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
m.position.copy(c.position);m.target.position.copy(d.position)};n.updateCamera=function(p,t){t=1;var v,u,w;switch(h){case 0:w="forward";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnZ().negate());v=200;u=60;break;case 1:w="left";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnX().negate());v=40;u=60;break;case 2:w="right";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnX());v=40;u=60;break;case 3:w=
"down";e.origin.copy(c.matrixWorld.getPosition()).y+=100;e.direction.copy(m.matrixWorld.getColumnY().negate());v=50;u=60;break;case 4:w="up";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(m.matrixWorld.getColumnY());v=40;u=60}h++;h>4&&(h=0);g[w]=1;var y=j.scene.collisions.rayCastNearest(e),z=-1;if(y&&y.distance!==-1){z=y.distance*0.1;w!=="down"&&z<v+u&&(g[w]=z<v?0:1-(z-v)/u)}v=b.mouse.x/b.screenWidth-0.5;u=b.mouse.y/b.screenHeight-0.5;if(w!=="forward"&&g[w]<1){y=new THREE.Vector3;y.copy(e.direction).negate().multiplyScalar((1-
g[w])*15);if(w==="left"||w==="right")y.y=0;else{y.x=0;y.z=0}d.position.addSelf(y);g[w]=Math.max(g[w],0.3);v*=0.1;u*=0.1}if(w==="down"&&z<50){w=c.position.y;c.position.y=e.origin.addSelf(e.direction.multiplyScalar(z)).y+150;d.position.y+=c.position.y-w}else e.origin.addSelf(e.direction.multiplyScalar(z)).y<200&&(g[w]=1);z=g.forward*g.up*g.down*g.right*g.left;Math.abs(d.position.y-c.position.y)<60&&(d.position.y-=u*20);d.position.y=Math.max(d.position.y,150);d.position.y=Math.min(d.position.y,4500);
f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*200-f.z*15*v*t;d.position.z=c.position.z+f.z*200+f.x*15*v*t;cameraSpeed=12;b.cameraSlowDown||(cameraSpeed+=13*((Math.min(Math.max(c.position.y,150),3E3)-150)/2850));c.position.addSelf(f.multiplyScalar(cameraSpeed*z*t));c.position.y=Math.max(c.position.y,150);c.position.y=Math.min(c.position.y,4500);m.position.x+=(c.position.x-m.position.x)*0.02*t;m.position.y+=(c.position.y-m.position.y)*0.02*t;m.position.z+=(c.position.z-m.position.z)*
0.02*t;m.target.position.x+=(d.position.x-m.target.position.x)*0.02*t;m.target.position.y+=(d.position.y-m.target.position.y)*0.02*t;m.target.position.z+=(d.position.z-m.target.position.z)*0.02*t;z=m.matrixWorld.getColumnZ();f.normalize();f.y=z.y;f.subSelf(z).normalize();f.multiplyScalar(0.4*t);c.up.set(0,1,0);c.up.subSelf(f).normalize();m.up.x+=(c.up.x-m.up.x)*0.02;m.up.y+=(c.up.y-m.up.y)*0.02;m.up.z+=(c.up.z-m.up.z)*0.02};return n};
PrairieCameraFreeExplore=function(b){var e,c,d=new THREE.Vector3,f,g,h,j,m=new THREE.Vector3;f=b.worlds.prairie;g=f.portals;j=new THREE.Vector3(350,0,-300);h=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);h.target.position.set(0,0,-100);e=new THREE.Object3D;c=new THREE.Object3D;c.position.set(0,0,-100);f.scene.addChild(h);f.scene.addChild(h.target);f.scene.addChild(e);f.scene.addChild(c);f={};f.camera=h;f.resetCamera=function(){e.position.set(j.x-200,25,j.z);c.position.set(j.x+300,25,
j.z);h.position.copy(e.position);h.target.position.copy(c.position)};f.updateCamera=function(n,p){p=1;var t=b.mouse.x/b.screenWidth-0.5,v=b.mouse.y/b.screenHeight-0.5;if(Math.abs(c.position.y-e.position.y)<200)c.position.y-=v*20;else{c.position.y>e.position.y&&(c.position.y-=20);c.position.y<e.position.y&&(c.position.y+=20)}d.sub(c.position,e.position).normalize();c.position.x=e.position.x+d.x*350-d.z*15*t*p;c.position.z=e.position.z+d.z*350+d.x*15*t*p;var u;v=9999999999;for(var w=0;w<g.length;w++){var y=
g[w];t=m.sub(y.object.matrixWorld.getPosition(),e.position).normalize().dot(d);if(t>0.7&&y.currentDistance<v){v=y.currentDistance;u=y}}if(u&&v<u.radius*2){m.sub(u.object.matrixWorld.getPosition(),e.position).length();e.position.addSelf(m.normalize().multiplyScalar(2*p))}else{u=d.multiplyScalar(2*p);u.y=(25-e.position.y)*0.03;e.position.addSelf(u);v=e.position.x-j.x;w=e.position.z-j.z;t=m.sub(j,e.position).normalize().dot(d);Math.sqrt(v*v+w*w)>795&&t<0&&e.position.subSelf(u)}h.position.x+=(e.position.x-
h.position.x)*0.02*p;h.position.y+=(e.position.y-h.position.y)*0.02*p;h.position.z+=(e.position.z-h.position.z)*0.02*p;h.target.position.x+=(c.position.x-h.target.position.x)*0.02*p;h.target.position.y+=(c.position.y-h.target.position.y)*0.02*p;h.target.position.z+=(c.position.z-h.target.position.z)*0.02*p;t=h.matrixWorld.getColumnZ();d.normalize();d.y=t.y;d.subSelf(t).normalize();d.multiplyScalar(0.4*p);e.up.set(0,1,0);e.up.subSelf(d).normalize();h.up.x+=(e.up.x-h.up.x)*0.02;h.up.y+=(e.up.y-h.up.y)*
0.02;h.up.z+=(e.up.z-h.up.z)*0.02};return f};
CityCameraFreeExplore=function(b){var e={start:new THREE.Vector3(-3E3,10,-1500),end:new THREE.Vector3(3E3,200,-1500)},c={start:new THREE.Vector3(0,10,-300),end:new THREE.Vector3(0,250,-3200)},d,f,g=new THREE.Vector3,h,j;h=b.worlds.city;j=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);j.target.position.set(0,0,-100);d=new THREE.Object3D;f=new THREE.Object3D;f.position.set(0,0,-100);h.scene.addChild(j);h.scene.addChild(j.target);h.scene.addChild(d);h.scene.addChild(f);h={};h.camera=j;h.resetCamera=
function(){d.position.set(c.start.x,c.start.y,(c.end.z+c.start.z)*0.5);f.position.set(e.start.x,c.start.y,d.position.z);j.position.copy(d.position);j.target.position.copy(f.position)};h.updateCamera=function(m,n){n=1;var p=b.mouse.x/b.screenWidth-0.5,t=b.mouse.y/b.screenHeight-0.5;Math.abs(f.position.y-d.position.y)<50&&(f.position.y-=t*20);f.position.y=Math.max(f.position.y,c.start.y);f.position.y=Math.min(f.position.y,c.end.y);g.sub(f.position,d.position).normalize();f.position.x=d.position.x+g.x*
500-g.z*25*p*n;f.position.z=d.position.z+g.z*500+g.x*25*p*n;cameraSpeed=10;cameraSpeed+=2*((Math.min(Math.max(d.position.y,c.start.y),c.end.y)-c.start.y)/(c.end.y-c.start.y));d.position.addSelf(g.multiplyScalar(cameraSpeed*n));d.position.x=c.start.x;d.position.y=Math.max(Math.min(d.position.y,c.end.y),c.start.y);d.position.z=Math.min(Math.max(d.position.z,c.end.z),c.start.z);j.position.x+=(d.position.x-j.position.x)*0.05*n;j.position.y+=(d.position.y-j.position.y)*0.05*n;j.position.z+=(d.position.z-
j.position.z)*0.05*n;j.target.position.x+=(f.position.x-j.target.position.x)*0.2*n;j.target.position.y+=(f.position.y-j.target.position.y)*0.2*n;j.target.position.z+=(f.position.z-j.target.position.z)*0.2*n;p=j.matrixWorld.getColumnZ();g.normalize();g.y=p.y;g.subSelf(p).normalize();g.multiplyScalar(0.4*n);d.up.set(0,1,0);d.up.subSelf(g).normalize();j.up.x+=(d.up.x-j.up.x)*0.05;j.up.y+=(d.up.y-j.up.y)*0.05;j.up.z+=(d.up.z-j.up.z)*0.05};return h};
Trigger=function(b,e){var c={},d=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,d);var f=1,g=0;e=e!==undefined?e:0;var h=c.mesh.morphTargetForcedOrder,j=(b.morphTargets.length-1)*1E3;h[0]=0;h[1]=1;c.play=function(m){f=m||1;g=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);
c.update(0)};c.update=function(m){g+=m*f;if(g>=j){h[0]=0;h[1]=c.mesh.geometry.morphTargets.length-1;d.uniforms.morph.value=1;d.uniforms.darkness.value=e;THREE.AnimationHandler.removeFromUpdate(c)}else{m=g/j;var n,p=0.1,t=0.7;if(m==0)m=0;else if(m==1)m=1;else{t||(t=0.3);if(!p||p<1){p=1;n=t/4}else n=t/(2*Math.PI)*Math.asin(1/p);m=p*Math.pow(2,-10*m)*Math.sin((m-n)*2*Math.PI/t)+1}m*=j;if(m<j){h[0]=Math.floor(m/1E3);h[1]=Math.ceil(m/1E3)}else{h[0]=c.mesh.geometry.morphTargets.length-2;h[1]=c.mesh.geometry.morphTargets.length-
1}d.uniforms.morph.value=m/j;d.uniforms.darkness.value=e*g/j}};return c};
var TriggerBig=function(b){var e={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});e.mesh=new THREE.Mesh(b,c);e.mesh.doubleSided=!0;var d=0.1,f=0,g=(b.morphTargets.length-1)*1E3,h=e.mesh.morphTargetForcedOrder;h[0]=0;h[1]=1;e.play=function(j){d=j||1;f=0;THREE.AnimationHandler.addToUpdate(e);e.update(0)};e.update=
function(j){f+=j*d;if(f>=g){h[0]=0;h[1]=e.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(e)}else{j=f/g*g;if(j<g){h[0]=Math.floor(j/1E3);h[1]=Math.ceil(j/1E3)}else{h[0]=e.mesh.geometry.morphTargets.length-2;h[1]=e.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=j/g}};return e},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var e=[],c=[],d=[];b.setupCityTriggers=function(f){if(f.triggers){var g,h,j,m,n=f.triggers,
p=[];for(j in n)if(j.indexOf("TriggerMesh")!==-1){m=n[j];m.name=j.slice(j.indexOf("_")+1);m.geometry=f.geometries[m.object.geometry];p.push(m);f.objects[j].parent.removeChild(f.objects[j]);f.objects[j].visible=!1;delete n[j]}e=[];c=[];for(j in n){g=0;for(h=p.length;g<h;g++)if(j.indexOf(p[g].name)!==-1&&p[g].geometry.morphTargets.length){if(n[j].type==="Small"){m=new Trigger(p[g].geometry);f.objects[j].addChild(m.mesh);m.mesh.visible=!1;e.push(m)}else{m=new TriggerBig(p[g].geometry);f.objects[j].addChild(m.mesh);
c.push(m)}m.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(f){var g,h,j=f.geometries,m,n,p,t,v,u,w;for(g in j){h=j[g];if(h.morphTargets.length){m=0;for(n=h.morphTargets.length;m<n;m++){v=h.morphTargets[m].vertices;p=0;for(t=v.length;p<t;p++){u=v[p].position;w=u.y;u.y=-u.z;u.z=w}}}}h=f.objects;d=[];for(g in h)if(h[g].geometry&&h[g].geometry.morphTargets.length){f=new Trigger(h[g].geometry,Math.random()*0.25+0.5);h[g].addChild(f.mesh);h[g].visible=!1;d.push(f)}};b.update=function(){var f,
g,h,j,m,n=b.effectors,p,t,v,u=b.effectorRadius*1.5;f=0;for(g=e.length;f<g;f++){h=e[f].mesh.matrixWorld.getPosition();j=0;for(m=n.length;j<m;j+=3){p=Math.abs(n[j+0]-h.x);t=Math.abs(n[j+1]-h.y);v=Math.abs(n[j+2]-h.z);if(p+t+v<u){e[f].play(0.1+Math.random()*0.05);e.splice(f,1);f--;g--;break}}}f=0;for(g=c.length;f<g;f++){h=c[f].mesh.matrixWorld.getPosition();j=0;for(m=n.length;j<m;j+=3){p=Math.abs(n[j+0]-h.x);t=Math.abs(n[j+1]-h.y);v=Math.abs(n[j+2]-h.z);if(p+t+v<u){c[f].play(0.2+Math.random()*0.1);c.splice(f,
1);f--;g--;break}}}f=0;for(g=d.length;f<g;f++){h=d[f].mesh.matrixWorld.getPosition();j=0;for(m=n.length;j<m;j+=3){p=Math.abs(n[j+0]-h.x);t=Math.abs(n[j+1]-h.y);v=Math.abs(n[j+2]-h.z);if(p+t+v<u){d[f].play(0.1+Math.random()*0.05);d.splice(f,1);f--;g--;break}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,e,c){var d=this;d.camera=b;renderer=c.renderer;c.camPos=new THREE.Vector3(0,0,-300);var f=new THREE.JSONLoader;f.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};c.trigger=new THREE.Vector3(0,0,0);var g=0,h=new CollisionScene(d.camera,e,0.1,c,500,!0);h.settings.maxSpeedDivider=2;h.settings.capBottom=3;h.settings.capTop=1E3;h.settings.shootRayDown=!1;h.settings.allowFlying=!1;h.settings.emitterDivider=8;
h.settings.normalOffsetAmount=8;h.settings.minDistance=100;h.settings.keepEmitterFollowDown=!0;h.emitter.position.z=-100;h.emitterFollow.position.z=-100;h.cameraTarget.position.z=-100;f.load({model:"files/models/city/collision/City.Collision_Big.js",callback:function(B){var I=new THREE.Vector3(-1.570796,0,3.141591),N=new THREE.Vector3;h.addLoaded(B,0.1,I,N,e)}});f.load({model:"files/models/city/collision/City.Collision_Big.001.js",callback:function(B){var I=new THREE.Vector3(-1.570796,0,0),N=new THREE.Vector3;
h.addLoaded(B,0.1,I,N,e)}});f.load({model:"files/models/city/collision/City.Collision_Big.002.js",callback:function(B){var I=new THREE.Vector3(-1.570796,0,0),N=new THREE.Vector3;h.addLoaded(B,0.1,I,N,e)}});f.load({model:"files/models/city/collision/City.Collision_Big.003.js",callback:function(B){var I=new THREE.Vector3(-1.570796,0,1.570797),N=new THREE.Vector3;h.addLoaded(B,0.1,I,N,e)}});b.target=h.cameraTarget;b=new THREE.Vector3(0,0,100);var j=new Vectors(50,2,2,b),m=[new THREE.MeshLambertMaterial({color:5997888,
opacity:1}),new THREE.MeshLambertMaterial({color:4285993,opacity:1}),new THREE.MeshLambertMaterial({color:3103761,opacity:1}),new THREE.MeshLambertMaterial({color:6525252,opacity:1})],n=new Ribbons(4,j.array,e,m);n.settings.ribbonPulseMultiplier_1=15;n.settings.ribbonPulseMultiplier_2=0;n.settings.ribbonMin=0.1;n.settings.ribbonMax=0.2;m=THREE.ImageUtils.loadTexture("files/textures/particle_0.png");var p=THREE.ImageUtils.loadTexture("files/textures/particle_1.png"),t=THREE.ImageUtils.loadTexture("files/textures/particle_2.png"),
v=THREE.ImageUtils.loadTexture("files/textures/particle_3.png"),u=THREE.ImageUtils.loadTexture("files/textures/particle_4.png"),w=new Particles(22,e,5,[m,p,t,v,u],20,70,THREE.AdditiveBlending);w.settings.gravitateTowardsCamera=!0;var y=new Stragglers(5,e,j.array);y.settings.capy=0;var z=new AnimalSwarm(30,e,j.array);z.settings.addaptiveSpeed=!0;z.settings.capy=0;z.settings.startPosition=b;z.settings.constantSpeed=0.75;z.array[0]="moose";z.array[22]="moose";z.array[2]="elk";z.array[10]="elk";z.array[1]=
"elk";z.array[25]="elk";z.array[8]="fish";z.array[16]="fish";z.array[5]="sockjump";z.array[26]="sockjump";z.array[13]="sockpopup";z.array[29]="sockjump";f.load({model:"files/models/soup/animals_A_life.js",callback:function(B){var I=[1,0,4,3,2,1,0,5,2,7,8,9,10,1,0,3,3,9,2,3],N=[6.5,13.12,9.76,7.47,4.74,4.94,0.777,6.252,3.412,5.52,5.576];z.addAnimal(B,null,1.5,I,N);I=[8,9,7,9,10];B=y.addAnimal(B,null,1.8,I,N);preinitAnimal(B,renderer,e)}});f.load({model:"files/models/soup/elk_life.js",callback:function(B){B=
z.addAnimal(B,"elk",2.2,null,[6]);preinitAnimal(B,renderer,e)}});f.load({model:"files/models/soup/moose_life.js",callback:function(B){B=z.addAnimal(B,"moose",1.1,null,[13.964]);preinitAnimal(B,renderer,e)}});f.load({model:"files/models/soup/fish_life.js",callback:function(B){B=z.addAnimal(B,"fish",1.6,[0,1,2,3],[2]);preinitAnimal(B,renderer,e);z.array[8].isFish=!0;z.array[16].isFish=!0}});f.load({model:"files/models/soup/sockpuppet_jump.js",callback:function(B){B=z.addAnimal(B,"sockjump",1.8,null,
[3],!0);preinitAnimal(B,c.renderer,e)}});f.load({model:"files/models/soup/sockpuppet_popup.js",callback:function(B){B=z.addAnimal(B,"sockpopup",2,null,[0.1],!0);preinitAnimal(B,c.renderer,e)}});var A=new AnimalSwarm(10,e,j.array);A.settings.flying=!0;A.settings.flyingDistance=45;for(b=0;b<10;++b)b%2==0&&(A.array[b]="b");f.load({model:"files/models/soup/birds_A_life.js",callback:function(B){B=A.addAnimal(B,null,1.3,[0,1,2,3,0,1,2,3,0,1],[4.848,7,7.5,3.5]);preinitAnimal(B,renderer,e)}});f.load({model:"files/models/soup/birds_B_life.js",
callback:function(B){B=A.addAnimal(B,"b",1.3,[1,1,0,0,1,0,0,1,0,0],[8.5,8.623]);preinitAnimal(B,renderer,e)}});var E=new AnimalInFrontOfCamera(15,e);f.load({model:"files/models/soup/butterfly_hiD.js",callback:E.addAnimal});var C=new AnimalInFrontOfCamera(15,e);f.load({model:"files/models/soup/butterfly_hiC.js",callback:C.addAnimal});var D=new Trail(80,e);D.settings.freeRotation=!1;D.settings.tweenTime=2500;D.settings.aliveDivider=30;D.settings.offsetAmount=10;for(b=0;b<80;++b)D.array[b]="0"+(b%4+
1);D.array[10]="tree1";D.array[30]="tree2";D.array[45]="tree3";D.array[60]="tree4";D.array[75]="tree5";D.array[70]="light";f.load({model:"files/models/soup/grass01.js",callback:function(B){D.addInstance(B,"01",!1)}});f.load({model:"files/models/soup/grass02.js",callback:function(B){var I=D.addInstance(B,"02",!1);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/grass03.js",callback:function(B){var I=D.addInstance(B,"03",!1);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/grassFlower.js",
callback:function(B){var I=D.addInstance(B,"04",!1);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/evergreen_low.js",callback:function(B){var I=D.addInstance(B,"tree1",!0);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/evergreen_high.js",callback:function(B){var I=D.addInstance(B,"tree2",!0);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/treeGeneric.js",callback:function(B){var I=D.addInstance(B,"tree3",!0);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/treeGenericLower.js",
callback:function(B){var I=D.addInstance(B,"tree4",!0);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/treeOrange.js",callback:function(B){var I=D.addInstance(B,"tree5",!0);preInitModel(B,renderer,e,I)}});f.load({model:"files/models/soup/lighthouse.js",callback:function(B){var I=D.addInstance(B,"light",!1,!0);preInitModel(B,renderer,e,I);D.array[4].maxHeight=12}});this.update=function(B){if(!isNaN(B)&&!(B>1E3||B==0)){c.camPos.x=d.camera.matrixWorld.n14;c.camPos.y=d.camera.matrixWorld.n24;
c.camPos.z=d.camera.matrixWorld.n34;if(c.camPos.z<=-3290||c.camPos.x>1640||c.camPos.x<-1640){c.camPos=new THREE.Vector3(0,0,-300);h.reset(c.camPos.x,c.camPos.y,c.camPos.z);j.reset(c.camPos.x,c.camPos.y,c.camPos.z);z.reset(c.camPos.x,c.camPos.y,c.camPos.z);A.reset(c.camPos.x,c.camPos.y,c.camPos.z);w.reset(c.camPos.x,c.camPos.y,c.camPos.z);y.reset(c.camPos.x,c.camPos.y,c.camPos.z)}g%8==7&&y.create(h.emitterFollow.position,h.currentNormal,h.emitter.position);++g;var I=0;g%4==0&&(I=(Math.random()-0.5)*
1.2);if(g%2==0)d.camera.animationParent.position.y=18+(Math.random()-0.5)*1.2;d.camera.position.x=0+I;if(g%15==14){z.create(j.array[1].position,h.currentNormal);A.create(j.array[1].position,h.currentNormal)}h.update(c.camPos,B);j.update(h.emitterFollow.position,h.currentNormal);n.update(h.emitterFollow.position);w.update(B,j.array[0].position,c.camPos);y.update(B,c.camPos);C.update(c.camPos,d.camera.theta,B);E.update(c.camPos,d.camera.theta,B,!0);D.update(h.emitter.position,h.emitterNormal,c.camPos,
B);TWEEN.update();TriggerUtils.effectors[0]=h.emitter.position.x;TriggerUtils.effectors[1]=h.emitter.position.y;TriggerUtils.effectors[2]=h.emitter.position.z}};this.changeCamera=function(B){d.camera=B;h.settings.camera=B};this.destruct=function(){}},PrairieSoup=function(b,e,c){c.camPos=new THREE.Vector3(302.182,-9.045,-105.662);var d=new THREE.JSONLoader;d.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=0,g=0,h=
[],j,m,n,p,t,v=new CollisionScene(b,e,1,c,1100);v.settings.maxSpeedDivider=1;v.settings.allowFlying=!1;v.settings.emitterDivider=2;v.settings.shootRayDown=!1;v.settings.keepEmitterFollowDown=!0;v.settings.normalOffsetAmount=7;v.settings.minDistance=0;v.emitter.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);v.emitterFollow.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);var u=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30);j=new Vectors(30,10,10,u);var w=THREE.ImageUtils.loadTexture("files/textures/dark_0.png"),
y=THREE.ImageUtils.loadTexture("files/textures/dark_1.png"),z=THREE.ImageUtils.loadTexture("files/textures/dark_2.png"),A=THREE.ImageUtils.loadTexture("files/textures/dark_3.png"),E=THREE.ImageUtils.loadTexture("files/textures/dark_4.png");t=new Particles(20,e,1.5,[w,y,z,A,E],70,60);t.settings.zeroAlphaStart=!1;t.settings.aliveDivider=2;n=new AnimalSwarm(40,e,j.array);n.settings.xPositionMultiplier=22;n.settings.zPositionMultiplier=18;n.settings.shootRayDown=!0;n.settings.adaptiveSpeed=!0;n.settings.divider=
1;n.settings.startPosition=u;n.array[7]="gator";n.array[8]="gator";n.array[9]="animal";n.array[11]="goat";n.array[13]="gator";n.array[14]="arm";n.array[15]="gator";n.array[16]="goat";n.array[18]="goat";n.array[19]="animal";n.array[20]="animal";n.array[21]="animal";n.array[22]="animal";n.array[23]="animal";n.array[24]="animal";n.array[25]="animal";n.array[26]="animal";n.array[27]="animal";n.array[28]="animal";n.array[29]="animal";n.array[30]="octo";n.array[31]="octo";n.array[32]="octo";n.array[33]=
"octo";n.array[34]="centipede";n.array[35]="goat";n.array[36]="octo";d.load({model:"files/models/soup/taruffalo_black.js",callback:function(D){D=n.addAnimal(D,null,0.25,[0,1,0,1],[9.2,9.2]);preinitAnimal(D,c.renderer,e)}});d.load({model:"files/models/soup/animals_A_black.js",callback:function(D){D=n.addAnimal(D,"animal",0.35,[3,1,2,0,1,0,2,0,2,3,0],[11.12,9.73,6.7,3.06]);preinitAnimal(D,c.renderer,e)}});d.load({model:"files/models/soup/gator_black.js",callback:function(D){D=n.addAnimal(D,"gator",
0.35,null,[4.5]);preinitAnimal(D,c.renderer,e)}});d.load({model:"files/models/soup/goat_black.js",callback:function(D){D=n.addAnimal(D,"goat",0.45,null,[5.2]);preinitAnimal(D,c.renderer,e)}});d.load({model:"files/models/soup/arm_black.js",callback:function(D){D=n.addAnimal(D,"arm",3,null,[1]);preinitAnimal(D,c.renderer,e);n.array[14].generalSpecialCase=!0}});d.load({model:"files/models/soup/octo_black.js",callback:function(D){D=n.addAnimal(D,"octo",0.25,[0,0,1,2],[1.629,3,1.7]);preinitAnimal(D,c.renderer,
e)}});d.load({model:"files/models/soup/sickle.js",callback:function(D){D=n.addAnimal(D,"sickle",1.5,null,[0.5]);preinitAnimal(D,c.renderer,e)}});d.load({model:"files/models/soup/centipede.js",callback:function(D){D=n.addAnimal(D,"centipede",0.5,null,[1]);preinitAnimal(D,c.renderer,e)}});p=new AnimalSwarm(10,e,j.array);p.settings.flying=!0;p.settings.xPositionMultiplier=24;p.settings.zPositionMultiplier=12;p.settings.constantSpeed=2;p.settings.divider=4;p.settings.flyingDistance=-15;d.load({model:"files/models/soup/birds_A_black.js",
callback:function(D){D=p.addAnimal(D,null,0.4,[0,0,0,0,1,0,0,1,0,1],[12,14]);preinitAnimal(D,c.renderer,e)}});var C=[new THREE.MeshLambertMaterial({color:65793})];m=new Trail(80,e);for(i=0;i<80;++i)m.array[i]="01";m.settings.spread=10;m.settings.aliveDivider=40;m.settings.tweenTime=800;m.settings.scale=0.3;m.settings.offsetAmount=10;d.load({model:"files/models/soup/darkblob01.js",callback:function(D){var B=m.addInstance(D,"01",!1,!1);preInitModel(D,renderer,e,B)}});d.load({model:"files/models/soup/darkblob02.js",
callback:function(D){var B=m.addInstance(D,"02",!1,!1);preInitModel(D,renderer,e,B)}});d.load({model:"files/models/soup/grass03.js",callback:function(D){var B=m.addInstance(D,"03",!1,!1,C);preInitModel(D,renderer,e,B)}});d.load({model:"files/models/soup/grass04.js",callback:function(D){var B=m.addInstance(D,"04",!1,!1,C);preInitModel(D,renderer,e,B)}});d.load({model:"files/models/soup/grass05.js",callback:function(D){var B=m.addInstance(D,"05",!1,!1);preInitModel(D,renderer,e,B)}});this.update=function(D){c.camPos.x=
b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;if(c.camPos.x>1090){c.camPos.set(302.182,-9.045,-105.662);v.reset(c.camPos.x,c.camPos.y,c.camPos.z);j.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);p.reset(c.camPos.x,c.camPos.y,c.camPos.z);t.reset(c.camPos.x,c.camPos.y,c.camPos.z)}f+=D;g+=D;v.update(c.camPos,D);j.update(v.emitterFollow.position,v.currentNormal);t.update(D,j.array[0].position);n.update(D,c.camPos);p.update(D,c.camPos);m.update(v.emitter.position,
v.emitterNormal,c.camPos,D);if(f>=100){D=Math.random()*20-10;var B=Math.random()*20-10,I=new THREE.Vector3,N=new THREE.Vector3;I.copy(v.emitterFollow.position);N.copy(v.emitter.position);I.x+=D;N.x+=D;I.z+=B;N.z+=B;n.create(I,v.currentNormal,N);f=0}if(g>=500){p.create(v.emitterFollow.position,v.currentNormal,v.emitter.position);g=0}TWEEN.update();D=new THREE.Vector3(v.emitter.position.x,v.emitter.position.y,v.emitter.position.z);h.unshift(D);if(h.length>50){D=h[50];c.lavatrailx=D.x;c.lavatrailz=D.z}if(h.length>
40){D=h[40];ROME.TrailShader.uniforms.lavaHeadPosition.value.set(D.x,0,-D.z)}TriggerUtils.effectors[0]=v.emitter.position.x;TriggerUtils.effectors[1]=v.emitter.position.y;TriggerUtils.effectors[2]=v.emitter.position.z};this.destruct=function(){}},DunesSoup=function(b,e,c){c.camPos=new THREE.Vector3(0,150,0);var d=new THREE.JSONLoader;d.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=new CollisionScene(b,e,0.15,c,
3E3);f.settings.emitterDivider=4;f.settings.maxSpeedDivider=0.5;f.settings.allowFlying=!0;var g=new Vectors;g.settings.divider=3;var h=[new THREE.MeshBasicMaterial({color:14283771,opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,opacity:0.25})],j=new Ribbons(6,
g.array,e,h);j.settings.ribbonPulseMultiplier_1=20;j.settings.ribbonPulseMultiplier_2=0.01;j.settings.ribbonMin=0.05;j.settings.ribbonMax=0.1;var m=new AnimalSwarm(20,e,g.array);m.settings.flying=!0;m.settings.flyingDistance=10;m.settings.divider=10;m.settings.constantSpeed=0.8;m.settings.respawn=!1;for(h=0;h<20;++h)h%2==0&&(m.array[h]="b");d.load({model:"files/models/soup/birds_A_life.js",callback:function(n){n=m.addAnimal(n,null,2.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,e)}});d.load({model:"files/models/soup/birds_B_life.js",
callback:function(n){n=m.addAnimal(n,"b",2.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,e)}});this.update=function(n){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;m.create(g.array[1].position,f.currentNormal);f.update(c.camPos,n);g.update(f.emitterFollow.position,f.currentNormal);j.update(f.emitterFollow.position);m.update(n,c.camPos)};this.destruct=function(){}},Ribbon=function(b,e,c){b=b||100;e=e||10;c=c||10;THREE.Geometry.call(this);e/=2;b/=
c;for(var d=[],f=0;f<c+2;++f){var g=f*b,h=-e;d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,e,0)))-1);d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,h,0)))-1)}for(f=0;f<c*2;f+=2){this.faces.push(new THREE.Face3(d[f],d[f+2],d[f+1]));this.faces.push(new THREE.Face3(d[f+2],d[f+3],d[f+1]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,e){var c=ROME.AnimalAnimationData.init(b,e),d={};d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.availableAnimals=c.availableAnimals;d.mesh=new THREE.Mesh(b,c.material);var f=!1,g=d.mesh.morphTargetForcedOrder,h=c.material;d.play=function(m,n,p,t,v){if(!f){f=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}n=
n!==undefined?n:m;j(m,d.animalA);j(n,d.animalB);d.animalA.currentTime=t?t:0;d.animalB.currentTime=v?v:0;d.update(0)};d.update=function(m){if(d.mesh._modelViewMatrix){var n,p=["animalA","animalB"],t,v,u,w,y,z;t=0;v=p.length;for(z=0;t<v;t++){n=d[p[t]];y=n.currentTime;n.currentTime=(n.currentTime+m*n.timeScale)%n.lengthInMS;if(y>n.currentTime)n.currentFrame=0;y=0;u=n.currentFrame;for(w=n.lengthInFrames-1;u<w;u++)if(n.currentTime>=n.frames[u].time&&n.currentTime<n.frames[u+1].time){y=u;break}n.currentFrame=
y;u=y+1<w?y+1:0;g[z++]=n.frames[y].index;g[z++]=n.frames[u].index;y=n.frames[y].time;u=n.frames[u].time>y?n.frames[u].time:n.frames[u].time+n.lengthInMS;n=(n.currentTime-y)/(u-y);h.uniforms[p[t]+"Interpolation"].value=n}h.uniforms.animalMorphValue.value=d.morph;if(h.attributes[d.animalA.name]!==undefined)h.attributes.colorAnimalA.buffer=h.attributes[d.animalA.name].buffer;if(h.attributes[d.animalB.name]!==undefined)h.attributes.colorAnimalB.buffer=h.attributes[d.animalB.name].buffer}};d.setNewTargetAnimal=
function(m,n){if(d.morph===1){for(var p in d.animalA)d.animalA[p]=d.animalB[p];d.animalB.currentTime=n?n:0;j(m,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var j=function(m,n){if(ROME.AnimalAnimationData[m]!==undefined){n.frames=ROME.AnimalAnimationData[m];n.lengthInFrames=n.frames.length;n.lengthInMS=n.frames[n.lengthInFrames-1].time;n.name=m.toLowerCase();n.normalsOffset=Math.floor(n.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
m)};return d};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 1.0 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 ) * vec4( 0.9, 0.85, 0.8, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["tarbuffalo","bearbrown","horse","deer","mountainlion","goldenRetreiver","fox","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","blackWidow","crab","scorp","goat","gator","tarbuffalo_runB","tarbuffalo","wolf","panther","bearblack","toad","eagle","owl","parrot","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD","raven",
"vulture","bison","sickle","armHand","sickle","centipede","shdw2","shdw5","drownArm_A","drownArm_C"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.15,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},blackWidow:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,
vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.45},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:-0.1},cow:{hRange:0,sRange:0,
vRange:0.2,hOffset:0,sOffset:0.05,vOffset:-0.25},cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,sRange:0,vRange:0.15,hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},
flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},frog:{hRange:0.05,sRange:0.1,vRange:0.25,hOffset:0.01,sOffset:0.05,vOffset:-0.1},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.26},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,
sRange:0.1,vRange:0.25,hOffset:-0.0050,sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},moose:{hRange:0.07,sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.0050,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.16},parrot:{hRange:0.05,sRange:0.1,
vRange:0.3,hOffset:-0.025,sOffset:0.1,vOffset:-0.1},raccoon:{hRange:0,sRange:0.1,vRange:0.25,hOffset:0.6,sOffset:-0.1,vOffset:-0.2},raven:{hRange:0.02,sRange:0.1,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.15},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:-0.1},shdw2:{hRange:0,sRange:0.1,vRange:0.06,hOffset:0,sOffset:-0.05,vOffset:-0.15},sickle:{hRange:0.04,sRange:0,vRange:0.1,hOffset:0,sOffset:-0.2,vOffset:-0.3},
stork:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.175},toad:{hRange:0.07,sRange:0,vRange:0.1,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.08,hOffset:0,sOffset:-0.1,vOffset:-0.16},wolf:{hRange:0,sRange:0.2,vRange:0.06,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",
bearbrown:"bearBrown",bearblack:"bearBlack",blackwidow:"blackWidow",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",
mountainlion:"mountainlion",mountainlionblack:"panther",owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,e){if(b.initialized){p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,
morphTargets:!0});for(h in b.customAttributes){var c=b.customAttributes[h];p.attributes[h]=h==="colorAnimalA"||h==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var d,f,g;p=b.morphTargets;var h,j,m,n;if(e){j=0;for(m=p.length;j<m;j++){h=0;for(g=this.animalNames.length;h<g;h++){f=this.animalNames[h];if(p[j].name.indexOf(f)!==-1)break}if(h===g){f=p[j].name;for(h=0;h<f.length;h++){g=
f.charCodeAt(h);if(!(g>=65&&g<=90||g>=97&&g<=122))break}this.animalNames.push(f.slice(0,h))}}}h=0;for(g=this.animalNames.length;h<g;h++){f=this.animalNames[h];d=this[f];n=0;if(d===undefined||d.length===0){d=this[f]=[];j=0;for(m=p.length;j<m;j++)if(p[j].name.indexOf(f)!==-1){d.push({index:j,time:n});n+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{j=0;for(m=p.length;j<m;j++)c.indexOf(f)===-1&&p[j].name.indexOf(f)!==-1&&c.push(f)}}var p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),
attributes:ROME.AnimalShader.attributes(),vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors});n=b.morphColors;var t=p.attributes;if(b.morphColors&&b.morphColors.length){j=0;for(m=n.length;j<m;j++){d=n[j];f=d.name;for(h=0;h<f.length;h++){g=f.charCodeAt(h);if(!(g>=65&&g<=90||g>=97&&g<=122))break}f=f.slice(0,h).toLowerCase();t[f]={type:"c",boundTo:"faces",value:d.colors};h=this.colorVariations.zero;if(this.animalVariationMap[f]!==
undefined){h=this.colorVariations[this.animalVariationMap[f]];console.log(d.name,f)}p.uniforms.lightScale.value=h.lScale?h.lScale:0.5;h.lOffset?p.uniforms.lightOffset.value.set(h.lOffset[0],h.lOffset[1],h.lOffset[2]):p.uniforms.lightOffset.value.set(0.6,0.6,0.6);console.log(f);randomizeColors(t[f].value,h)}t.colorAnimalA.value=n[0].colors;t.colorAnimalB.value=n[0].colors;h=0;for(g=c.length;h<g;h++){f=c[h].toLowerCase();j=0;for(m=n.length;j<m;j++){d=n[j].name.toLowerCase();if(d.indexOf(f)!==-1)break}if(j===
m){console.error("Animal.constructor: Morph Color missing for animal "+f+". Deploying backup plan.");t[f]={type:"c",boundTo:"faces",value:[]};j=0;for(m=b.faces.length;j<m;j++)t[f].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");j=0;for(m=b.faces.length;j<m;j++)t.colorAnimalA.value.push(new THREE.Color(16711935));t.colorAnimalB.value=t.colorAnimalA.value;h=0;for(g=c;h<g;h++)t[c[h]]={type:"c",boundTo:"faces",value:t.colorAnimalA.value}}b.availableAnimals=
c;b.customAttributes=p.attributes}return{availableAnimals:b.availableAnimals,material:p}}};function randomizeColors(b,e){var c,d,f,g,h,j;c=0;for(d=b.length;c<d;c++){f=b[c];g=e.hRange*Math.random()+e.hOffset;h=e.sRange*Math.random()+e.sOffset;j=e.vRange*Math.random()+e.vOffset;THREE.ColorUtils.adjustHSV(f,g,h,j)}}
ROME.Animal_old=function(b,e){var c=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader_old.uniforms,vertexShader:ROME.AnimalShader_old.vertex,fragmentShader:ROME.AnimalShader_old.fragment,morphTargets:!0,vertexColors:b.materials[0][0].vertexColors,lights:!0}),d={};d.mesh=new THREE.Mesh(b,c);d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};
d.availableAnimals=ROME.AnimalAnimationData_old.init(b,e);for(var f=!1,g=d.mesh.morphTargetForcedOrder,h,j,m,n,p=0;p<b.faces.length;p++){h=b.faces[p].color;j=0*Math.random()+0;m=0*Math.random()+0;n=0.4*Math.random()+-0.3;THREE.ColorUtils.adjustHSV(h,j,m,n)}d.play=function(v,u,w,y,z){if(!f){f=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}t(v,d.animalA);t(u,d.animalB);d.animalA.currentTime=y?y:0;d.animalB.currentTime=z?z:0;d.update(0)};d.update=function(v){var u,w=["animalA","animalB"],y,z,A,E,
C,D;y=0;z=w.length;for(D=0;y<z;y++){u=d[w[y]];C=u.currentTime;u.currentTime=(u.currentTime+v*u.timeScale)%u.lengthInMS;if(C>u.currentTime)u.currentFrame=0;C=0;A=u.currentFrame;for(E=u.lengthInFrames-1;A<E;A++)if(u.currentTime>=u.frames[A].time&&u.currentTime<u.frames[A+1].time){C=A;break}u.currentFrame=C;A=C+1<E?C+1:0;g[D++]=u.frames[C].index;g[D++]=u.frames[A].index;C=u.frames[C].time;A=u.frames[A].time>C?u.frames[A].time:u.frames[A].time+u.lengthInMS;u=(u.currentTime-C)/(A-C);c.uniforms[w[y]+"Interpolation"].value=
u}c.uniforms.animalMorphValue.value=d.morph};d.setNewTargetAnimal=function(v,u){if(d.morph===1){for(var w in d.animalA)d.animalA[w]=d.animalB[w];d.animalB.currentTime=u?u:0;t(v,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var t=function(v,u){if(ROME.AnimalAnimationData_old[v]!==undefined){u.frames=ROME.AnimalAnimationData_old[v];u.lengthInFrames=u.frames.length;u.lengthInMS=u.frames[u.lengthInFrames-1].time}else console.log("Error: Couldn't find data for animal "+
v)};return d};
ROME.AnimalShader_old={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0}}]),vertex:["uniform float\tanimalAInterpolation;\nuniform float\tanimalBInterpolation;\nuniform float\tanimalMorphValue;\nvarying vec3 \tvLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,
THREE.ShaderChunk.color_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"vec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragment:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,
THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData_old={animalNames:["sockPuppet_jump","sockPuppet_popUp"],init:function(b,e){var c=[],d,f,g=b.morphTargets,h,j,m,n,p;if(e){m=0;for(n=g.length;m<n;m++){h=0;for(j=this.animalNames.length;h<j;h++){f=this.animalNames[h];if(g[m].name.indexOf(f)!==-1)break}if(h===j){f=g[m].name;for(h=0;j<f.length;h++){d=f.charCodeAt(h);if(!(d>=65&&d<=90||d>=97&&d<=122))break}this.animalNames.push(f.slice(0,h))}}}h=0;for(j=this.animalNames.length;h<j;h++){f=this.animalNames[h];d=this[f];p=0;if(d===
undefined||d.length===0){d=this[f]=[];m=0;for(n=g.length;m<n;m++)if(g[m].name.indexOf(f)!==-1){d.push({index:m,time:p});p+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{m=0;for(n=g.length;m<n;m++)c.indexOf(f)===-1&&g[m].name.indexOf(f)!==-1&&c.push(f)}}return c}};
var Ribbons=function(b,e,c,d){var f=this,g=[],h=[];f.initSettings={numOfRibbons:b||6};f.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var j=0,m;for(m=0;m<f.initSettings.numOfRibbons;++m){var n=new Ribbon(15,6,e.length-20),p=new THREE.Mesh(n,d[m%d.length]);p.doubleSided=!0;c.addObject(p);g.push({r:n,rm:p,offset:3+Math.floor(Math.random()*10)});h.push(p)}this.update=function(t){j+=0.1;for(m=0;m<e.length;++m)for(var v=e[m].position.x,u=e[m].position.y,
w=e[m].position.z,y=0;y<b;++y){var z=g[y].r,A=g[y].offset;if(!(m<A)){var E=Math.cos((m-j*10)/10)*f.settings.ribbonPulseMultiplier_1,C=Math.cos((m-j*10)/8)*f.settings.ribbonPulseMultiplier_2,D=y*(Math.PI*2/g.length),B=Math.cos(D+(m-j*10)/8)*E;E*=Math.sin(D+(m-j*10)/8);for(D=0;D<2;++D){var I=(m-A)*2+D;if(z.vertices[I]!=undefined){var N=m-j*2,J=Math.max(f.settings.ribbonMin,m/(10+C));J=Math.min(J,f.settings.ribbonMax);var K=Math.cos(N/3)*J;N=Math.sin(N/3)*J;z.vertices[I].position.x=v-t.x+K+B;if(D==0){z.vertices[I].position.y=
u+N+E-t.y;z.vertices[I].position.z=w+K+B-t.z}else{z.vertices[I].position.y=u-N+E-t.y;z.vertices[I].position.z=w-K+B-t.z}}}}}for(m=0;m<g.length;++m){v=g[m].rm;v.position=t;z=g[m].r;z.__dirtyVertices=!0;v.visible=f.settings.visible}}},Vectors=function(b,e,c,d){var f=this;f.array=[];var g;f.initSettings={length:b||50};f.settings={divider:e||4,normaldivider:c||10,absoluteTrail:!1,startPosition:d||new THREE.Vector3(0,0,0)};for(g=0;g<f.initSettings.length;++g){b=new THREE.Vector3(0,0,0);b.copy(f.settings.startPosition);
b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};f.array.push(b)}this.update=function(h,j){for(g=0;g<f.initSettings.length;++g){var m=f.array[g];if(g==0)var n=h.x,p=h.y,t=h.z,v=j.x,u=j.y,w=j.z;else{n=f.array[g-1].lastposition.x;p=f.array[g-1].lastposition.y;t=f.array[g-1].lastposition.z;v=f.array[g-1].normal.x;u=f.array[g-1].normal.y;w=f.array[g-1].normal.z}f.array[g].lastposition.x=m.position.x;f.array[g].lastposition.y=m.position.y;f.array[g].lastposition.z=
m.position.z;if(f.settings.absoluteTrail){m.position.x=n;m.position.y=p;m.position.z=t;m.normal.x=v;m.normal.y=u;m.normal.z=w}else{p=(p-m.position.y)/f.settings.divider;t=(t-m.position.z)/f.settings.divider;m.position.x+=(n-m.position.x)/f.settings.divider;m.position.y+=p;m.position.z+=t;n=(u-m.normal.y)/f.settings.normaldivider;w=(w-m.normal.z)/f.settings.normaldivider;m.normal.x+=(v-m.normal.x)/f.settings.normaldivider;m.normal.y+=n;m.normal.z+=w}}};this.reset=function(h,j,m){for(var n=0;n<f.array.length;++n){var p=
f.array[n];p.position.x=h;p.position.y=j;p.position.z=m}}},Particles=function(b,e,c,d,f,g,h){var j=this,m=[];h=h||THREE.NormalBlending;j.initSettings={numOfParticleSystems:b||25,numInSystem:f||60,spread:g||50,particleSize:c||8};j.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var n;c=new THREE.Geometry;for(n=0;n<j.initSettings.numInSystem;n++){f=new THREE.Vector3(Math.random()*j.initSettings.spread-j.initSettings.spread/2,Math.random()*j.initSettings.spread-j.initSettings.spread/
2,Math.random()*j.initSettings.spread-j.initSettings.spread/2);c.vertices.push(new THREE.Vertex(f))}for(n=0;n<j.initSettings.numOfParticleSystems;n++){f=new THREE.ParticleBasicMaterial({size:j.initSettings.particleSize,map:d[n%d.length],transparent:!0,depthTest:!0,blending:h});f=new THREE.ParticleSystem(c,f);f.rotation.x=Math.random()*Math.PI;f.rotation.y=Math.random()*Math.PI;f.rotation.z=Math.random()*Math.PI;m.push({c:f,alivetime:n});e.addObject(f)}this.update=function(p,t,v){if(isNaN(p)||p>1E3)p=
1E3/60;p/=60;for(n=0;n<b;++n){var u=m[n].c;m[n].alivetime+=p/j.settings.aliveDivider;if(m[n].alivetime>=b){m[n].alivetime=0;u.scale.x=u.scale.y=u.scale.z=0.5;u.position.x=t.x;u.position.y=t.y;u.position.z=t.z;if(j.settings.gravitateTowardsCamera){var w=-100;t.x>v.x&&(w=100);m[n].c.tox=t.x-w;m[n].c.toy=0;m[n].c.toz=t.z-100;w=u.position.x-m[n].c.tox;var y=u.position.y-m[n].c.toy,z=u.position.z-m[n].c.toz;w=1E3+Math.abs(w*w+y*y+z*z)/25;u.position.y=t.y+50;u.rotation.x=Math.random()*Math.PI+Math.PI/2;
u.rotation.y=Math.random()*Math.PI;u.rotation.z=Math.random()*Math.PI+Math.PI/2;u.scale.x=u.scale.y=u.scale.z=1.25;(new TWEEN.Tween(u.position)).to({x:m[n].c.tox,y:m[n].c.toy,z:m[n].c.toz},w).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(u.rotation)).to({x:0,z:0},w).easing(TWEEN.Easing.Quadratic.EaseIn).start();(new TWEEN.Tween(u.scale)).to({x:5,y:0.05,z:5},w).easing(TWEEN.Easing.Linear.EaseNone).start()}u.materials[0].opacity=j.settings.zeroAlphaStart?0:1}else{w=m[n].alivetime;if(!j.settings.gravitateTowardsCamera){u.position.y+=
0.1;u.rotation.y+=0.015;u.rotation.z+=0.01;u.scale.x=u.scale.y=u.scale.z=0.5+Math.max(w/15,1)}w=j.settings.zeroAlphaStart?w/4:1-w/(m.length*2);w=Math.min(w,1);u.materials[0].opacity=w}}};this.reset=function(p,t,v){for(var u=0;u<m.length;++u){var w=m[u].c;w.position.x=p;w.position.y=t;w.position.z=v}}},AnimalSwarm=function(b,e,c){var d=this;d.array=[];new THREE.Vector3;var f=0;d.initSettings={numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,
constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1,respawn:!0,gravity:!1};var g=0,h;this.addAnimal=function(j,m,n,p,t,v){m=m||null;var u=n||1.2;p=p||null;for(h=0;h<d.initSettings.numOfAnimals;++h)if(!(m==null&&d.array[h]!=undefined||m!=d.array[h])){t==null&&(t=[1]);var w=v?ROME.Animal_old(j,!1):ROME.Animal(j,!1),y=w.mesh;y.position.copy(d.settings.startPosition);n=0.02+Math.random()/8;h<2&&(n=0.15);n=Math.max(n,0.1);y.matrixAutoUpdate=
!1;y.visible=!1;e.addChild(y);var z=0,A=0;if(p!=null){z=p[h%p.length]%w.availableAnimals.length;A=z+1;if(Math.round(Math.random())==1&&z>0||A>w.availableAnimals.length-1)A=z-1}var E=t[z],C=t[A];w.play(w.availableAnimals[z],w.availableAnimals[A],0,Math.random(),Math.random());var D=Math.random();h<2&&(D=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);n={c:y,a:w,f:h,keepRunning:!1,time:0,lifetime:0,dead:!1,startMorph:z,endMorph:A,speeda:E,speedb:C,toPosition:new THREE.Vector3(0,0,0),active:!1,
normal:new THREE.Vector3(0,1,0),count:D,scale:n*u,origscale:n*u,ray:ray,rayIndex:h%4,lastToy:0,sockPuppetSpecialCase:v,generalSpecialCase:!1};d.array[h]=n}return w};this.removeAnimal=function(j,m){for(h=0;h<d.initSettings.numOfAnimals;++h){var n=d.array[h].a;if(n!=undefined){var p=d.array[h].startMorph,t=d.array[h].endMorph;if(n.mesh.geometry==j&&(m==p||m==t)){e.removeChild(d.array[h].c);delete d.array[h].a;d.array[h].active=!1;break}}}};this.switchAnimal=function(j,m,n,p,t){var v=m||1.2;for(h=0;h<
d.initSettings.numOfAnimals;++h){t!=undefined&&(h=t);m=d.array[h].a;var u=d.array[h].startMorph,w=d.array[h].endMorph;if(!(m!=undefined&&m.mesh.geometry==j&&t==undefined&&(u==p||w==p))){console.log("adding on "+h);t=d.array[h].c.position;j=ROME.Animal(j,!1);u=j.mesh;m=0.02+Math.random()/8;h<2&&(m=0.15);m=Math.max(m,0.1);u.position=t;u.visible=!1;u.scale.set(1.0E-5,1.0E-5,1.0E-5);u.updateMatrix();u.matrixAutoUpdate=!1;e.removeChild(d.array[h].c);e.addChild(u);j.play(j.availableAnimals[p],j.availableAnimals[p],
0,Math.random(),Math.random());d.array[h].c=u;d.array[h].a=j;d.array[h].scale=m*v;d.array[h].origscale=m*v;d.array[h].speeda=n;d.array[h].speedb=n;d.array[h].active=!1;d.array[h].startMorph=p;d.array[h].endMorph=p;break}}};this.create=function(j,m,n){for(h=0;h<d.initSettings.numOfAnimals;++h)if(!(d.array[h].active||d.array[h].a==undefined)){d.array[h].active=!0;d.array[h].c.position.copy(j);d.array[h].normal.copy(m);d.array[h].c.visible=!0;d.array[h].f=0;d.array[h].time=0;d.array[h].lifetime=0;d.array[h].dead=
!1;d.array[h].scale=d.array[h].origscale;d.array[h].keepRunning=!1;d.array[h].gravity=0;if(d.settings.gravity){d.array[h].c.matrixAutoUpdate=!0;d.array[h].c.scale.set(d.array[h].scale,d.array[h].scale,d.array[h].scale);d.array[h].c.rotation.x=0;d.array[h].c.rotation.y=Math.random()*Math.PI}if(!d.settings.respawn)d.array[h].f=h;if(n!=undefined){var p=new THREE.Vector3,t=new THREE.Vector3;p.copy(j);t.copy(n);d.array[h].keepRunning=!0;d.array[h].toPosition=t.subSelf(p).normalize();d.array[h].toPosition.x<
0&&(d.array[h].toPosition.x*=-1);d.array[h].toPosition.x<0.5&&(d.array[h].toPosition.x+=0.5);d.array[h].toPosition.z<0&&(d.array[h].toPosition.z+=0.5)}if(n==undefined){d.array[h].scale*=0.25;(new TWEEN.Tween(d.array[h])).to({scale:d.array[h].origscale},2E3).easing(TWEEN.Easing.Elastic.EaseOut).delay(200).start()}j=d.array[h].scale;d.array[h].c.position.x-=m.x*j*300;d.array[h].c.position.y-=m.y*j*300;d.array[h].c.position.z-=m.z*j*300;d.array[h].lastToy=d.array[h].c.position.y;break}};this.update=
function(j){if(isNaN(j)||j>1E3||j==0)j=1E3/60;++f;for(h=0;h<d.initSettings.numOfAnimals;++h){var m=d.array[h];if(m.active){var n=m.c,p=m.scale,t=m.normal,v=m.f,u=d.array[h].dead;d.array[h].time+=j;d.array[h].lifetime+=j;if(d.array[h].lifetime>2500&&d.settings.respawn)d.array[h].dead=!0;d.array[h].count+=0.03;var w=Math.max(Math.cos(d.array[h].count),0);w=Math.min(w,1);d.array[h].a.morph=w;var y=m.speeda;if(Math.round(w)==1)y=m.speedb;if(d.array[h].keepRunning){w=n.position.x+d.array[h].toPosition.x*
100;z=n.position.y+d.array[h].toPosition.y*100;A=n.position.z+d.array[h].toPosition.z*100}else{if(d.array[h].time>Math.max(y*20,40)&&d.settings.respawn){++d.array[h].f;if(d.array[h].f>=40){d.array[h].f=40;d.array[h].dead=!0}v=d.array[h].f;d.array[h].time=0}t=h*(Math.PI*2/6);w=Math.cos(t+(h-g*2)/8)*d.settings.xPositionMultiplier;z=A=Math.sin(t+(h-g*2)/8)*d.settings.zPositionMultiplier;t=c[v].normal;w=c[v].position.x+w*(1-Math.abs(t.x));var z=c[v].position.y+z*(1-Math.abs(t.y)),A=c[v].position.z+A*
(1-Math.abs(t.z))}d.array[h].keepRunning||t.y>0.5&&(z=c[v].position.y-10);if(d.settings.capy!=null&&z<d.settings.capy)z=d.settings.capy;if(d.settings.flying)if(d.array[h].keepRunning){d.array[h].toPosition.y+=0.12;z=d.array[h].toPosition.y+d.settings.flyingDistance}else{var E=d.settings.flyingDistance;t.x<-0.8&&(w-=E);t.x>0.8&&(w+=E);if(t.y<-0.8||t.y>0.8)z+=E;t.z<-0.8&&(A-=E);t.z>0.8&&(A+=E)}if(d.settings.constantSpeed!=null){d.array[h].a.animalA.timeScale=d.settings.constantSpeed;d.array[h].a.animalB.timeScale=
d.settings.constantSpeed}if(d.settings.shootRayDown)if(d.array[h].rayIndex==f%4){m=m.ray;m.origin.copy(n.position);m.origin.y+=500;if(E=e.collisions.rayCastNearest(m)){z=m.origin.y-(E.distance*1+3);t=E.mesh.matrixRotationWorld.multiplyVector3(E.normal).normalize();d.array[h].lastToy=z;d.array[h].normal.copy(t)}}else z=d.array[h].lastToy;if(d.settings.gravity){d.array[h].gravity+=0.3;z=n.position.y-=d.array[h].gravity;A=n.position.z;w=n.position.x;n.rotation.x+=0.04;n.rotation.y+=0.02}E=m=17;if(d.array[h].keepRunning){m=
4;E=Math.abs(z-n.position.y)>10?m/2:m*2}d.settings.flying&&(E=8);d.array[h].sockPuppetSpecialCase&&(m=100);if(d.array[h].dead&&!d.array[h].generalSpecialCase){z-=t.y*13;w-=t.x*13;A-=t.z*13;d.settings.flying&&(z+=10);E=20}if(d.array[h].isFish){g+=0.06;z=n.position.y*Math.sin(g)*50}w=(w-n.position.x)/m;z=(z-n.position.y)/E;A=(A-n.position.z)/m;if(d.array[h].dead&&!u){(new TWEEN.Tween(d.array[h])).to({scale:d.array[h].scale*0.0010},1E3).easing(TWEEN.Easing.Quartic.EaseIn).start();d.array[h].startMorph==
1&&d.array[h].a.morph==0&&(new TWEEN.Tween(d.array[h].a)).to({morph:1},500).easing(TWEEN.Easing.Quartic.EaseIn).start()}u=0.1;d.array[h].keepRunning&&(u=0.01);if(d.array[h].dead&&p<=u){d.array[h].active=!1;d.array[h].c.visible=!1}else{v=d.array[h].keepRunning?y/32:y/(2+v/10);isNaN(v)&&(v=1);if(!d.array[h].keepRunning){z>v&&(z=v);z<-v&&(z=-v)}w>v&&(w=v);w<-v&&(w=-v);A>v&&(A=v);A<-v&&(A=-v);if(!d.settings.gravity){v=new THREE.Vector3(n.position.x+w,n.position.y+z,n.position.z+A);v.subSelf(n.position).normalize();
y=new THREE.Vector3;t=new THREE.Vector3(t.x*-1,t.y*-1,t.z*-1);if(d.settings.flying||d.settings.gravity)t=new THREE.Vector3(0,-1,0);y.cross(v,t);t.cross(v,y);n.matrixWorld.n11=y.x*p;n.matrixWorld.n12=t.x*p;n.matrixWorld.n13=v.x*p;n.matrixWorld.n14=n.position.x;n.matrixWorld.n21=y.y*p;n.matrixWorld.n22=t.y*p;n.matrixWorld.n23=v.y*p;n.matrixWorld.n24=n.position.y;n.matrixWorld.n31=y.z*p;n.matrixWorld.n32=t.z*p;n.matrixWorld.n33=v.z*p;n.matrixWorld.n34=n.position.z}n.position.x+=w;n.position.y+=z;n.position.z+=
A}}}};this.reset=function(j,m,n){for(var p=0;p<d.initSettings.numOfAnimals;++p){var t=d.array[p].c;t.position.x=j;t.position.y=m;t.position.z=n;d.array[p].active=!1}}},AnimalInFrontOfCamera=function(b,e){var c=this,d=[];c.initSettings={numOfAnimals:b||30};c.settings={};var f=0,g,h=new THREE.Cube(10,10,10),j=new THREE.Mesh(h);e.addChild(j);this.addAnimal=function(m){for(var n=0;n<c.initSettings.numOfAnimals;++n){var p=ROME.Animal(m,!1),t=p.mesh,v=0.02+Math.random()/8,u=Math.random()*120-60,w=n*10-
10,y=Math.random()*120-60;t.position.x=u;t.position.y=w;t.position.z=y;j.addChild(t);p.animalA.timeScale=0.8;p.animalB.timeScale=0.8;p.play(p.availableAnimals[0],p.availableAnimals[0],0,Math.random());d.push({c:t,x:u,y:w,z:y,a:p,scale:v*1.5})}};this.update=function(m,n,p,t){f+=0.1;j.position=m;if(!t){j.position.x-=Math.cos(n)*110;j.position.z-=Math.sin(n)*110}if(isNaN(p)||p>1E3)p=1E3/60;for(g=0;g<c.initSettings.numOfAnimals;++g){var v=d[g];m=v.c;n=v.x;t=v.y;v=v.z;var u=Math.sin(g-f);n+=Math.cos(g-
f);t+=0.5*(p/20);v+=u;t>140&&(t=-10);m.lookAt(new THREE.Vector3(n,t,v));m.position.x=n;m.position.y=t;m.position.z=v;d[g].x=n;d[g].y=t;d[g].z=v}}},Trail=function(b,e){var c=this;c.array=[];c.initSettings={numOfInstances:b||100};c.settings={spread:70,visible:!0,aliveDivider:c.initSettings.numOfInstances,tweenTime:2500,scale:1,offsetAmount:6,freeRotation:!0};var d;this.addInstance=function(f,g,h,j,m){g=g||null;h=h||!1;j=j||!1;for(d=0;d<c.initSettings.numOfInstances;++d)if(!(g==null&&c.array[d]!=undefined||
g!=c.array[d])){var n=m==undefined?new THREE.Mesh(f,new THREE.MeshFaceMaterial):new THREE.Mesh(f,m[d%m.length]);n.scale.x=n.scale.y=n.scale.z=1.0E-8;var p={c:n,alivetime:d,normal:new THREE.Vector3,tree:h,lightHouse:j};e.addObject(n);c.array[d]=p}return n};this.update=function(f,g,h,j){if(isNaN(j)||j>1E3)j=1E3/60;j/=c.settings.aliveDivider;for(d=0;d<c.array.length;++d){var m=c.array[d],n=m.c,p=m.alivetime,t=m.tree;m=m.lightHouse;p+=j;if(p>c.initSettings.numOfInstances){n.position.x=f.x;n.position.y=
f.y;n.position.z=f.z;n.rotation.x=0;n.rotation.z=0;n.rotation.y=0;p=c.settings.offsetAmount;t&&(p=c.settings.offsetAmount+2);var v=0,u=0,w=0;if(c.settings.freeRotation){n.position.x=f.x-g.x*p;n.position.y=f.y-g.y*p;n.position.z=f.z-g.z*p;n.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(g.x));n.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(g.z));n.rotation.x=0;n.rotation.z=0;n.rotation.y=Math.random()*Math.PI;n.up.copy(g);n.lookAt(n.position)}else{if(g.x<
-0.5){n.position.x=f.x+p/2;n.rotation.z=1.57;n.rotation.x=Math.random()*Math.PI;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=0;v=n.rotation.x;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.x>0.5){n.position.x=f.x-p/2;n.rotation.z=-1.57;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=0;v=n.rotation.x;u=n.rotation.y}n.rotation.x=Math.random()*Math.PI;n.position.y+=Math.random()*c.settings.spread-
c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.y<-0.9){n.position.y=f.y+p;n.rotation.y=Math.random()*Math.PI;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=1.57;v=n.rotation.x;u=n.rotation.y}n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.y>0.9){n.position.y=f.y-p;n.rotation.y=Math.random()*Math.PI;if(t){w+=n.rotation.z+(Math.random()-0.5);n.rotation.z=1.57;v=
n.rotation.x;u=n.rotation.y}n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.z<-0.5){n.position.z=f.z+p/2;n.rotation.x=-1.57;n.rotation.y=Math.random()*Math.PI;if(t){v=n.rotation.x+(Math.random()-0.5);n.rotation.x=0;w=n.rotation.z;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.z>0.5){n.position.z=f.z-p/2;n.rotation.x=
1.57;n.rotation.y=Math.random()*Math.PI;if(t){v=n.rotation.x+(Math.random()-0.5);n.rotation.x=0;w=n.rotation.z;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}}t&&(new TWEEN.Tween(n.rotation)).to({x:v,y:u,z:w},c.settings.tweenTime*2).easing(TWEEN.Easing.Elastic.EaseOut).start();if(t&&n.position.x<h.x+60&&n.position.x>h.x-60){n.position.x=h.x+60;if(n.position.x<h.x)n.position.x=h.x-60}n.scale.x=n.scale.y=
n.scale.z=0.0010*c.settings.scale;p=zscale=yscale=0.1*c.settings.scale;if(m){p=zscale=yscale=0.4*c.settings.scale;if(Math.abs(g.y)<0.9)continue;n.visible=!1}if(!t&&!m){yscale=0.12*c.settings.scale;p=zscale=0.4*c.settings.scale}v=TWEEN.Easing.Quintic.EaseOut;if(t||m)v=TWEEN.Easing.Elastic.EaseOut;(new TWEEN.Tween(n.scale)).to({x:p,y:yscale,z:zscale},c.settings.tweenTime).easing(v).start();p=0}c.array[d].alivetime=p}}},CollisionScene=function(b,e,c,d,f,g){function h(B,I,N,J,K,L,aa,o,ja){B=new THREE.Mesh(B,
ja);B.scale.set(I,I,I);B.position.set(N,J,K);B.rotation.set(L,aa,o);B.updateMatrix();j.settings.useOldRay?w.addObject(B):e.addObject(B);return B}var j=this;j.currentNormal=new THREE.Vector3(0,1,0);j.emitterNormal=new THREE.Vector3(0,1,0);j.distance=0;j.initSettings={};j.settings={useOldRay:g||!1,maxSpeedDivider:2,emitterDivider:5,cameraTargetDivider:10,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:f||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,minDistance:10,
camera:b};var m=new THREE.Vector3(0,0,1),n=new THREE.Ray,p=new THREE.Matrix4,t=new THREE.Matrix4,v=new THREE.Vector3,u=new THREE.Projector,w=new THREE.Scene;b=new THREE.Cube(5,5,5);j.emitter=h(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));j.emitterFollow=h(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,opacity:0.4}));if(j.settings.useOldRay)j.cameraTarget=h(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407667,
opacity:0.4}));j.emitter.visible=!1;j.emitterFollow.visible=!1;b=new THREE.Cube(5E4,5E4,10,1,1,1);c=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var y=new THREE.Mesh(b,c),z=new THREE.Mesh(b,c);b=new THREE.Cube(10,5E4,5E4,1,1,1);var A=new THREE.Mesh(b,c),E=new THREE.Mesh(b,c);b=new THREE.Cube(5E4,10,5E4,1,1,1);var C=new THREE.Mesh(b,c),D=new THREE.Mesh(b,c);if(j.settings.useOldRay){w.addObject(y);w.addObject(z);w.addObject(A);w.addObject(E);w.addObject(C);w.addObject(D)}else{e.addObject(y);
e.addObject(z);e.addObject(A);e.addObject(E);e.addObject(C);e.addObject(D);y.visible=!1;z.visible=!1;A.visible=!1;E.visible=!1;C.visible=!1;D.visible=!1}this.addLoaded=function(B,I,N,J){var K=new THREE.MeshLambertMaterial({color:16711680,opacity:0.5});B=new THREE.Mesh(B,K);B.scale.x=B.scale.y=B.scale.z=I;B.rotation=N||new THREE.Vector3;B.position=J||new THREE.Vector3;w.addObject(B)};this.update=function(B,I){E.position.x=B.x+j.settings.collisionDistance;A.position.x=B.x-j.settings.collisionDistance;
E.position.z=B.z;E.position.y=B.y;A.position.z=B.z;A.position.y=B.y;y.position.z=B.z-j.settings.collisionDistance;z.position.z=B.z+j.settings.collisionDistance;y.position.x=B.x;y.position.y=B.y;z.position.x=B.x;z.position.y=B.y;D.position.y=B.y-j.settings.collisionDistance;C.position.y=B.y+j.settings.collisionDistance;D.position.x=B.x;D.position.z=B.z;C.position.x=B.x;C.position.z=B.z;if(j.settings.capBottom!=null&&D.position.y<j.settings.capBottom)D.position.y=j.settings.capBottom;if(j.settings.capTop!=
null&&C.position.y<j.settings.capTop)C.position.y=j.settings.capTop;if(j.settings.useOldRay){var N=new THREE.Vector3(d.mouse.x/d.screenWidth*2-1,-(d.mouse.y/d.screenHeight)*2+1,0.5);u.unprojectVector(N,j.settings.camera);var J=new THREE.Ray(B,N.subSelf(B).normalize()),K=J.intersectScene(w);if(K.length>0)for(var L=0;L<K.length;++L)if((N.z<0?K[L].point.z<B.z:K[L].point.z>B.z)&&K[L].object!=j.emitter&&K[L].object!=j.emitterFollow){j.emitter.position=K[L].point;J=Math.atan2(B.z-j.emitter.position.z,B.x-
j.emitter.position.x);j.emitter.position.x-=Math.cos(J)*j.settings.minDistance/10;j.emitter.position.z-=Math.sin(J)*j.settings.minDistance;if(j.emitter.position.z>B.z-20)j.emitter.position.z=B.z-20;J=K[L].object.matrixRotationWorld.multiplyVector3(K[L].face.normal.clone());j.emitterNormal=J;if(K[L].object==E||K[L].object==y||K[L].object==z||K[L].object==A||K[L].object==C){j.emitterNormal.x=0;j.emitterNormal.y=1;j.emitterNormal.z=0;if(!j.settings.allowFlying)j.emitter.position.y=D.position.y+5}break}}else{m.x=
d.mouse.x/d.screenWidth*2-1;m.y=-(d.mouse.y/d.screenHeight)*2+1;m.z=1;n.origin.copy(m);p.copy(j.settings.camera.matrixWorld);p.multiplySelf(THREE.Matrix4.makeInvert(j.settings.camera.projectionMatrix,t));p.multiplyVector3(n.origin);n.direction.copy(n.origin);n.direction.subSelf(B);if((K=e.collisions.rayCastNearest(n))&&K.distance>j.settings.minDistance){L=K.distance*j.settings.scale;if(L>j.settings.collisionDistance)L=j.settings.collisionDistance}else{K={mesh:E};L=j.settings.collisionDistance}j.distance=
L;v.copy(n.origin);v.addSelf(n.direction.multiplyScalar(L));j.emitter.position=v;if(K.normal!=undefined){J=K.mesh.matrixRotationWorld.multiplyVector3(K.normal).normalize();j.currentNormal=J;j.emitterNormal=J}if(K.mesh==E||K.mesh==y||K.mesh==z||K.mesh==A||K.mesh==C||K.mesh==D){j.currentNormal.set(0,1,0);if(!j.settings.allowFlying&&!j.settings.shootRayDown)j.emitter.position.y=D.position.y;if(j.settings.shootRayDown){n.origin.copy(j.emitter.position);n.direction.set(0,-1,0);if((K=e.collisions.rayCastNearest(n))&&
K.distance!==-1){j.emitter.position.y-=K.distance*j.settings.scale;J=K.mesh.matrixRotationWorld.multiplyVector3(K.normal).normalize();j.currentNormal=J}else{j.emitter.position.y=-j.settings.collisionDistance;j.currentNormal.set(0,1,0)}}}j.emitter.position.x+=j.currentNormal.x*j.settings.normalOffsetAmount;j.emitter.position.y+=j.currentNormal.y*j.settings.normalOffsetAmount;j.emitter.position.z+=j.currentNormal.z*j.settings.normalOffsetAmount}if(isNaN(I)||I>1E3||I==0)I=1E3/60;K=I/j.settings.maxSpeedDivider;
L=j.emitter.position.x;L=(L-j.emitterFollow.position.x)/j.settings.emitterDivider;J=j.emitter.position.y;J=(J-j.emitterFollow.position.y)/j.settings.emitterDivider;N=j.emitter.position.z;N=(N-j.emitterFollow.position.z)/j.settings.emitterDivider;J>K&&(J=K);J<-K&&(J=-K);L>K&&(L=K);L<-K&&(L=-K);N>K&&(N=K);N<-K&&(N=-K);j.emitterFollow.position.x+=L;j.emitterFollow.position.y+=J;j.emitterFollow.position.z+=N;if(j.settings.keepEmitterFollowDown&&!j.settings.useOldRay){j.emitterFollow.position.y=j.emitter.position.y+
j.settings.collisionDistance;n.origin.copy(j.emitterFollow.position);n.direction.set(0,-1,0);if(K=e.collisions.rayCastNearest(n)){j.emitterFollow.position.y-=K.distance*j.settings.scale-j.settings.normalOffsetAmount;J=K.mesh.matrixRotationWorld.multiplyVector3(K.normal).normalize();j.currentNormal=J}}if(j.settings.useOldRay){N=new THREE.Vector3;J=new THREE.Ray(j.emitterFollow.position,N);var aa=1E4,o=j.emitterFollow.position,ja,ga;N.set(-1,0,0);J.direction=N;K=J.intersectScene(w);if(K.length>0)for(L=
0;L<K.length;++L)if(K[L].object!=j.emitter&&K[L].object!=A&&K[L].object!=E){if(K[L].distance<aa){aa=K[L].distance;o=K[L].point;ga=K[L].face;ja=K[L].object}break}N.set(1,0,0);J.direction=N;K=J.intersectScene(w);if(K.length>0)for(L=0;L<K.length;++L)if(K[L].object!=j.emitter&&K[L].object!=A&&K[L].object!=E){if(K[L].distance<aa){aa=K[L].distance;o=K[L].point;ga=K[L].face;ja=K[L].object}break}N.set(0,-1,0);J.direction=N;K=J.intersectScene(w);if(K.length>0)for(L=0;L<K.length;++L)if(K[L].object!=j.emitter&&
K[L].object!=C){if(K[L].distance<aa){o=K[L].point;ga=K[L].face;ja=K[L].object}break}j.emitterFollow.position=o;if(ja!=undefined){J=ja.matrixRotationWorld.multiplyVector3(ga.normal.clone());j.currentNormal=J}J=j.emitterFollow.position.y;J=(J-j.cameraTarget.position.y)/j.settings.cameraTargetDivider;L=j.emitterFollow.position.x;L=(L-j.cameraTarget.position.x)/j.settings.cameraTargetDivider;N=j.emitterFollow.position.z;N=(N-j.cameraTarget.position.z)/j.settings.cameraTargetDivider;K=8;J>4&&(J=4);J<-4&&
(J=-4);L>K&&(L=K);L<-K&&(L=-K);N>K&&(N=K);N<-K&&(N=-K);j.cameraTarget.position.x+=L;j.cameraTarget.position.y+=J;j.cameraTarget.position.z+=N;if(j.cameraTarget.position.z>B.z-80)j.cameraTarget.position.z=B.z-80;d.renderer.render(w,j.settings.camera);d.renderer.clear()}};this.reset=function(B,I,N){j.emitter.position.set(B,I,N);j.emitterFollow.position.set(B,I,N);j.settings.useOldRay&&j.cameraTarget.position.set(B,I,N)}};
ROME.TrailShaderUtils=function(){var b={},e,c,d,f,g,h=-9999999,j=-9999999,m=9999999,n=9999999,p,t;b.setMaterials=function(v,u,w,y){d=u;c=w;g=y;f=g.getContext();e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);f.texImage2D(f.TEXTURE_2D,0,f.RGB,d,d,0,f.RGB,f.UNSIGNED_BYTE,null);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,
f.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=e;var z,A,E,C,D,B;u=0;for(w=v.length;u<w;u++){z=v[u];y=z.position.x;A=z.position.y;B=z.geometry.vertices;C=0;for(D=B.length;C<D;C++){E=B[C].position;z=E.x+y;E=E.y+A;h=Math.max(h,z);j=Math.max(j,E);m=Math.min(m,z);n=Math.min(n,E)}}p=h-m;t=j-n;var I,N;for(u=0;u<w;u++){z=v[u];y=z.position.x;A=z.position.y;B=z.geometry.vertices;I=ROME.TrailShader.attributes();
N=I.trailUV.value;C=0;for(D=B.length;C<D;C++){E=B[C].position;N.push(new THREE.Vector2((E.x+y-m)/p,(E.y+A-n)/t))}y=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:I,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});y.fog=!0;y.lights=!0;y.vertexColors=2;y.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;y.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;y.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
y.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;y.uniforms.lavaMap.texture.wrapS=y.uniforms.lavaMap.texture.wrapT=THREE.Repeat;y.uniforms.lavaNoiseMap.texture.wrapS=y.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;z.materials[0]=y}};b.updateLava=function(v,u,w){v=v!==undefined?v:1;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(u!==undefined?u:0,0,w!=undefined?w:0);ROME.TrailShader.uniforms.lavaTime.value+=v};b.setMarkAtWorldPosition=function(v,u){if(d){var w=(v-m)/p*
d,y=(u-n)/t*d;if(w>=0&&w<d-c.image.width&&y>=0&&y<d-c.image.height){f.bindTexture(f.TEXTURE_2D,e);f.texSubImage2D(f.TEXTURE_2D,0,w,y,f.RGB,f.UNSIGNED_BYTE,c.image)}}};return b}();
ROME.TrailShader={textures:{trailMap:undefined,faceMap:THREE.ImageUtils.loadTexture("files/textures/PaintDubs.jpg"),lavaMap:THREE.ImageUtils.loadTexture("files/textures/lava.jpg"),lavaNoiseMap:THREE.ImageUtils.loadTexture("files/textures/Color_noise.jpg")},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,
0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",
value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue, f;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0)).rg;\nf = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nmixValue = f + max(1.0 - length(vec2(0.030) * vec2(vPos.xy - lavaHeadPosition.xz) + lookup * vec2(0.4)), 0.0);\nif(mixValue > 0.5)\n{\nmixValue = abs((texture2D(lavaNoiseMap, vTrailUV.yx * vec2(40.0, -40.0)).r - 0.5));\nmixValue = max(max(1.0 - mixValue * 32.0, 0.0) * (lookup.r - 0.5) * 8.0, 0.0);\ngl_FragColor = vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0) - vec2( lavaTime * 2.5)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) - vec2( lavaTime * 2.5)).rrrr * vec4(2.0);\n}/* else {\n}*/\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,e){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var d;this.addAnimal=function(f,g,h,j,m){g=g||null;var n=h||1.2;j=j||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(g==null&&c.array[d]!=undefined||g!=c.array[d])){m==null&&(m=[1]);var p=ROME.Animal(f,!1),t=p.mesh;h=0.02+Math.random()/8;h=Math.max(h,0.1);t.matrixAutoUpdate=!1;t.visible=!1;e.addChild(t);var v=0,u=0;if(j!=null){v=j[d%j.length]%
p.availableAnimals.length;u=v+1;if(Math.round(Math.random())==1&&v>0||u>p.availableAnimals.length-1)u=v-1}var w=m[v],y=m[u];p.play(p.availableAnimals[v],p.availableAnimals[u],0,Math.random(),Math.random());u=Math.random();d<2&&(u=0);h={c:t,a:p,active:!1,startMorph:v,lifetime:0,speeda:w,speedb:y,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:u,scale:h*n,origscale:h*n};c.array[d]=h}};this.create=function(f,g,h){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=
!0;c.array[d].position.copy(f);c.array[d].normal.copy(g);c.array[d].c.position.copy(f);c.array[d].c.visible=!0;c.array[d].toVector=h.subSelf(f).normalize();c.array[d].lifetime=0;c.array[d].toVector.x*=1-Math.abs(g.x);c.array[d].toVector.y*=1-Math.abs(g.y);c.array[d].toVector.z*=1-Math.abs(g.z);c.array[d].toVector.z=Math.random();c.array[d].toVector.x=Math.random()-0.5;c.array[d].scale=0.01;(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();
f=c.array[d].scale;c.array[d].c.position.x-=g.x*f*150;c.array[d].c.position.y-=g.y*f*150;c.array[d].c.position.z-=g.z*f*150;break}};this.update=function(f){if(isNaN(f)||f>1E3||f==0)f=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var g=c.array[d];if(g.active){var h=g.c,j=g.scale,m=g.normal,n=g.position,p=g.toVector;c.array[d].lifetime+=f;if(c.array[d].lifetime>4E3){c.array[d].active=!1;c.array[d].c.visible=!1}else{var t=n.x+p.x*10,v=n.y+p.y*10,u=n.z+p.z*10;m.y>0.5&&(v-=10);if(c.settings.capy!=
null&&v<c.settings.capy){v=c.settings.capy;m.set(0,1,0)}c.array[d].count+=0.03;n=Math.max(Math.cos(c.array[d].count),0);n=Math.min(n,1);c.array[d].a.morph=n;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}var w=g.speeda;if(Math.round(n)==1)w=g.speedb;g=(t-h.position.x)/5;n=(v-h.position.y)/5;p=(u-h.position.z)/5;n>w&&(n=w);n<-w&&(n=-w);g>w&&(g=w);g<-w&&(g=-w);p>w&&(p=w);p<-w&&(p=-w);t=new THREE.Vector3(t,
v,u);t.subSelf(h.position).normalize();v=new THREE.Vector3;m=new THREE.Vector3(m.x*-1,m.y*-1,m.z*-1);v.cross(t,m);m.cross(t,v);h.matrixWorld.n11=v.x*j;h.matrixWorld.n12=m.x*j;h.matrixWorld.n13=t.x*j;h.matrixWorld.n14=h.position.x;h.matrixWorld.n21=v.y*j;h.matrixWorld.n22=m.y*j;h.matrixWorld.n23=t.y*j;h.matrixWorld.n24=h.position.y;h.matrixWorld.n31=v.z*j;h.matrixWorld.n32=m.z*j;h.matrixWorld.n33=t.z*j;h.matrixWorld.n34=h.position.z;h.position.x+=g;h.position.y+=n;h.position.z+=p;c.array[d].position.copy(h.position)}}}};
this.reset=function(f,g,h){for(var j=0;j<c.array.length;++j){var m=c.array[j].c;m.position.x=f;m.position.y=g;m.position.z=h;c.array[j].active=!1;c.array[j].c.visible=!1}}},VideoPlane=function(b,e,c){var d,f,g,h,j,m=!1,n=!1,p=e.path.match("png$")||e.path.match("jpg$"),t=new PolyTrail(b.mouse.x,b.mouse.y),v=e.fps||20;this.locked=e.locked;this.path=e.path;this.removed=!1;this.removeAt=e.removeAt||1;if(p)f=THREE.ImageUtils.loadTexture(e.path);else{VideoLoadRegister[e.path]=1;d=document.createElement("video");
d.src=e.path;d.preload=!0;d.load();b.signals.loadItemAdded.dispatch();d.addEventListener("canplaythrough",function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},!1);setTimeout(function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},1E4);f=new THREE.Texture(d);f.minFilter=THREE.LinearFilter;f.magFilter=THREE.LinearFilter}switch(e.shaderId){case VIDEO_OPAQUE:h=VideoShaderSource.opaque;
break;case VIDEO_OPAQUE_DISTORT:h=VideoShaderSource.distortOpaque;m=!0;break;case VIDEO_KEYED_DISTORT:h=VideoShaderSource.distortKeyed;m=!0;n=!0;break;case VIDEO_HALFALPHA:h=VideoShaderSource.halfAlpha;break;case VIDEO_SMARTALPHA:h=VideoShaderSource.smartAlpha;break;case VIDEO_SMARTALPHA_DISTORT:h=VideoShaderSource.distortSmartalpha;m=!0;break;case VIDEO_KEYED_INVERSE:h=VideoShaderSource.keyedInverse;n=!0;break;default:h=VideoShaderSource.keyed;n=!0}var u=THREE.UniformsUtils.clone(h.uniforms);u.map.texture=
f;if(m){u.mouseXY.value=new THREE.Vector2(0,0);u.aspect.value=c.aspect;u.mouseSpeed.value=0;u.mouseRad.value=0}if(n){u.colorScale.value=e.colorScale;u.threshold.value=e.threshold;u.alphaFadeout.value=e.alphaFadeout}j=new THREE.MeshShaderMaterial({uniforms:u,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,depthTest:!1});if(!e.width)e.width=m?1.104:1;if(!e.height)e.height=m?1.24:1;h=m?c.grid:new THREE.Plane(1,1,40,1);if(e.paralax)for(var w=0;w<h.vertices.length;++w)h.vertices[w].position.z=
(1-Math.sin((h.vertices[w].position.x+0.5)*Math.PI))*500;this.mesh=new THREE.Mesh(h,j);this.mesh.scale.x=e.width;this.mesh.scale.y=e.height;this.mesh.position.z=e.z;this.mesh.position.y=e.y||0;this.mesh.scale.x*=Math.abs(e.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(e.z)*c.adj;this.start=function(y){if(!p){try{d.currentTime=d.duration*y}catch(z){console.log(z);d.currentTime=0}d.play();f.needsUpdate=!0;g=setInterval(function(){if(d.readyState===d.HAVE_ENOUGH_DATA)f.needsUpdate=!0},1E3/v)}};this.stop=
function(){if(!p){d.pause();d.currentTime=0;clearInterval(g)}};this.update=function(y,z,A,E){if(m){t.target.x=-y*c.aspect;t.target.y=-z;t.update();for(w=0;w<=4;w++)j.uniforms["trail"+w].value=t.s[w];j.uniforms.mouseXY.value.x=-y*c.aspect;j.uniforms.mouseXY.value.y=-z;j.uniforms.mouseSpeed.value=A;j.uniforms.mouseRad.value=E}}};function PolyTrail(){this.target=new THREE.Vector2(0,0);this.s=[];for(var b=0;b<=4;b++)this.s[b]=new THREE.Vector2(0,0)}
PolyTrail.prototype.update=function(){for(var b=4;b>=1;b-=1){this.s[b].x+=(this.s[b-1].x-this.s[b].x)/10;this.s[b].y+=(this.s[b-1].y-this.s[b].y)/10}this.s[0].x+=(this.target.x-this.s[0].x)/10;this.s[0].y+=(this.target.y-this.s[0].y)/10};
var VideoLoadRegister={},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VIDEO_KEYED_INVERSE=6,VIDEO_SMARTALPHA=7,VIDEO_SMARTALPHA_DISTORT=8,VideoPlayer=function(b,e){var c=this,d=(new Date).getTime();SequencerItem.call(this);var f={},g=[],h=!1,j,m,n=b.renderer,p=b.renderTarget,t=0,v=0,u=0,w=0,y=0,z=0,A=0,E=new THREE.Vector2(0,0),C;this.duration=e[0].duration;this.init=function(){f.prx=e[0].paralaxHorizontal||0;f.pry=e[0].paralaxVertical||0;f.tgd=e[0].targetDistance||
1500;onGrid=function(D){f.grid=D;c.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){h=!0;b.signals.mousemoved.add(function(){t=b.mouse.x/b.screenWidth*-2+1;v=b.mouse.y/b.screenHeight*2-1});C=new THREE.Vector2(0,0);f.fov=54;f.aspect=2.35;f.adj=Math.tan(f.fov*Math.PI/360)*2;m=new THREE.Camera(f.fov,f.aspect,1,1E5);m.target.position=new THREE.Vector3(0,0,f.tgd*-1);m.updateMatrix();j=new THREE.Scene;j.addLight(new THREE.AmbientLight(0));
j.addObject(m);for(var D=0;D<e.length;D++){var B=new VideoPlane(b,e[D],f);g.push(B)}};this.show=function(D){for(var B=0;B<g.length;B++){var I=g[B];I.locked?m.addChild(I.mesh):j.addChild(I.mesh);I.start(D)}};this.hide=function(){for(var D=0;D<g.length;D++)g[D].stop()};this.update=function(D,B,I){I=(new Date).getTime();B=I-d;d=I;if(h){y=t;z=v;E.x+=(1E3*Math.max(Math.min(y-u,0.05),-0.05)/B-E.x)/12;E.y+=(1E3*Math.max(Math.min(z-w,0.05),-0.05)/B-E.y)/12;A+=(Math.max(Math.min(Math.abs(E.x)+Math.abs(E.y),
3),0.4)-A)/2;u=t;w=v;C.x=t*-2*f.prx;C.y=v*2*f.pry;C.x=Math.min(C.x,f.prx);C.x=Math.max(C.x,-f.prx);C.y=Math.min(C.y,f.pry);C.y=Math.max(C.y,-f.pry);m.target.position.x+=(C.x-m.target.position.x)/2;m.target.position.y+=(C.y-m.target.position.y)/2;for(B=0;B<g.length;B++){I=g[B];if(D>I.removeAt&&!I.removed){I.locked&&m.removeChild(I.mesh);j.removeChild(I.mesh);I.stop();I.removed=!0}else I.update(t,v,E,A)}n.render(j,m,p)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var DistortUniforms={aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5},mouseXY:{type:"v2",value:new THREE.Vector2},trail0:{type:"v2",value:new THREE.Vector2},trail1:{type:"v2",value:new THREE.Vector2},trail2:{type:"v2",value:new THREE.Vector2},trail3:{type:"v2",value:new THREE.Vector2},trail4:{type:"v2",value:new THREE.Vector2},mouseSpeed:{type:"v2",value:new THREE.Vector2},mouseRad:{type:"f",
value:1}},DistortShaderFragmentPars="uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distancePoly;\nvarying float distance;",DistortVertexShader="uniform vec2 mouseXY;\nuniform vec2 trail0;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform vec2 trail4;\nuniform float aspect;\nuniform vec2 mouseSpeed;\nuniform float mouseRad;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distance;\nvarying float distancePoly;\nfloat getDistance(vec2 p, vec2 l1, vec2 l2){\nfloat A = p.x - l1.x;\nfloat B = p.y - l1.y;\nfloat C = l2.x - l1.x;\nfloat D = l2.y - l1.y;\nfloat dot = A * C + B * D;\nfloat len_sq = C * C + D * D;\nfloat param = dot / len_sq;\nfloat xx,yy;\nif(param < 0.)\n{\n   xx = l1.x;\n   yy = l1.y;\n}\nelse if(param > 1.)\n{\n    xx = l2.x;\n    yy = l2.y;\n}\nelse\n{\n    xx = l1.x + param * C;\n    yy = l1.y + param * D;\n}\nreturn 1. - sqrt( ((p.x - xx) * (p.x - xx)) + ((p.y - yy) * (p.y - yy)) );\n}\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUvPoly = uv+vec2(normal.x,normal.y);\nvec4 glPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nvec2 projPos = vec2(aspect,1.)*vec2(gl_Position.x/gl_Position.z,gl_Position.y/gl_Position.z);\nvec2 projPosPoly = vec2(aspect,1.)*vec2(glPosPoly.x/glPosPoly.z,glPosPoly.y/glPosPoly.z);\ndistance = max(0.,1.-length(vec2(projPos)-vec2(mouseXY.x, mouseXY.y)));\ndistance *= mouseRad;\nfloat distFade = normal.z*0.9+0.4;\nfloat distanceTrail0 = distFade*getDistance(projPosPoly,mouseXY,trail0);\nfloat distanceTrail1 = -0.3+1.3*distFade*getDistance(projPosPoly,trail0,trail1);\nfloat distanceTrail2 = -0.5+1.5*distFade*getDistance(projPosPoly,trail1,trail2);\nfloat distanceTrail3 = -0.7+1.7*distFade*getDistance(projPosPoly,trail2,trail3);\nfloat distanceTrail4 = -0.9+1.9*distFade*getDistance(projPosPoly,trail3,trail4);\ndistancePoly = max(distanceTrail0,max(distanceTrail1,max(distanceTrail2,max(distanceTrail3,distanceTrail4))));\ngl_Position.xy = gl_Position.xy + normalize(projPos.xy-vec2(mouseXY.x, mouseXY.y))*vec2(distance*100.);\ngl_Position.xy = gl_Position.xy -mouseSpeed.xy*pow(distance,2.)*100.;\ngl_Position.z -= distance;\n}",
VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( map, vUv );\n}"},keyedInverse:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t > threshold )\nalpha = 0.0;//(1.0 - (t - 2.0)) * alphaFadeout;\ngl_FragColor = vec4( c.xyz * cs, alpha );\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},distortSmartalpha:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\nc.a = a.r;\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x * 0.6666, vUvPoly.y ) );\nvec4 aPoly = texture2D( map, vec2( 0.6666 + vUvPoly.x * 0.3333, vUvPoly.y ) );\ncPoly.a = aPoly.r;\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.2) discard;\nelse gl_FragColor = c;\n}"].join("\n")},
smartAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},keyed:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",
value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},
distortOpaque:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.1) discard;\nelse gl_FragColor = c;\n}"].join("\n")},distortKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.6) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"].join("\n")},
distortWire:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.3 && cPoly.a>0.05) cPoly = vec4(cPoly.rgb*2.,distancePoly/4.); \nelse cPoly = vec4(1.,1.,1.,0.); \ngl_FragColor = cPoly;\n}"].join("\n")},distortWireKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.8 && cPoly.a>0.) cPoly = vec4(1.,1.,1.,distancePoly/16.); \nelse cPoly = vec4(1.,1.,1.,0.); \ngl_FragColor = cPoly;\n}"].join("\n")}},
VideoShots={introLayers:[{path:"files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,fps:48,duration:22E3}],s01_01:[{path:"files/videos/city/s01_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:3120},{path:"files/videos/city/s01_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900},{path:"files/videos/city/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-800,fps:18}],s01_03:[{path:"files/videos/city/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1200,width:1.56,height:1.59,paralax:!0,duration:8120,
paralaxHorizontal:600,paralaxVertical:200},{path:"files/videos/city/s03_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1100,width:1.3,height:1.16,paralax:!0},{path:"files/videos/city/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0,removeAt:0.3,fps:18}],s01_06:[{path:"files/videos/city/s06_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:2030},{path:"files/videos/city/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900}],s01_09:[{path:"files/videos/city/s09_layer04.webm",
shaderId:VIDEO_KEYED,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,paralax:!0,width:1.5625,height:1.1627,duration:8230,paralaxHorizontal:600,paralaxVertical:100},{path:"files/videos/city/s09_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-800,paralax:!0,removeAt:0.8,width:1.5625,height:1.1627},{path:"files/videos/city/s09_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-500,locked:!0,removeAt:0.3}],s02_01:[{path:"files/videos/prairie/s01_layer04.webm",shaderId:VIDEO_OPAQUE,z:-1400,width:1,
height:1.83,paralax:!0,duration:9230,paralaxHorizontal:600,paralaxVertical:100},{path:"files/videos/prairie/s01_layer03.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1100,width:1.56,height:1.22,paralax:!0},{path:"files/videos/prairie/s01_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-700,paralax:!0,width:1.56,height:1.83},{path:"files/videos/prairie/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-30,locked:!0}],s02_02:[{path:"files/videos/prairie/s02_layer03.jpg",shaderId:VIDEO_OPAQUE,z:-1010,duration:2020},
{path:"files/videos/prairie/s02_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3},{path:"files/videos/prairie/s02_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-990}],s02_03:[{path:"files/videos/prairie/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1500,duration:2030},{path:"files/videos/prairie/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_04:[{path:"files/videos/prairie/s04_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:5E3},{path:"files/videos/prairie/s04_layer01.webm",
shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_06:[{path:"files/videos/prairie/s06_layer02.webm",shaderId:VIDEO_SMARTALPHA,colorScale:1,threshold:2.4,alphaFadeout:1,z:-1010,duration:6060},{path:"files/videos/prairie/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,removeAt:0.6,z:-1E3}],s03_01:[{path:"files/videos/dunes/s01_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1E3,width:1.56,height:1.22,paralax:!0,duration:8E3,paralaxHorizontal:600,paralaxVertical:100},{path:"files/videos/dunes/s01_layer02.webm",
shaderId:VIDEO_KEYED_DISTORT,z:-800,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,width:1.56,height:1.22,paralax:!0},{path:"files/videos/dunes/s01_layer01.webm",shaderId:VIDEO_KEYED,colorScale:0,threshold:0.5,alphaFadeout:0.5,z:-100,locked:!0}],s03_02:[{path:"files/videos/dunes/s02_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:3500},{path:"files/videos/dunes/s02_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,z:-1E3}],s03_03:[{path:"files/videos/dunes/s03_layer02.webm",
shaderId:VIDEO_SMARTALPHA,z:-400,paralax:!0,width:1.526,height:1.11,duration:11E3,paralaxHorizontal:600,paralaxVertical:100},{path:"files/videos/dunes/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0}]},City=function(b){var e=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("city initScene");e.update(0.0010,34.99,45199)});var c,d,f,g,h,j=b.renderer,m=b.renderTarget,n=[],p=[],t=!1;b.debug=!1;if(function(v){return(v=RegExp("[?&]"+v+"=([^&]*)").exec(window.location.search))&&
decodeURIComponent(v[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){n=[[0,18,-300],[0,18,-1210]];d=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:n,duration:7.8,useConstantSpeed:!0,resamplingCoef:30,createDebugPath:b.debug,createDebugDummy:b.debug,lookSpeed:0.0025,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2.8]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});d.position.set(0,
0,0);d.lon=90;c=d;g=new CityWorld(b);h=new CitySoup(c,g.scene,b);b.worlds.city=g;b.sequences.city=this;b.debug&&g.scene.addObject(c.debugPath);g.scene.addObject(c.animationParent);console.log("city init")};this.resetCamera=function(){c.animation.play(!1,0);j.setClearColor(g.scene.fog.color);j.setStencilShadowDarkness(0.7)};this.show=function(){this.resetCamera();b.started.city=!0;console.log("show city")};this.hide=function(){};this.update=function(v,u){if(isNaN(u)||u>1E3||u==0)u=1E3/60;var w=c.animationParent.position.z;
if(w<-1200&&!t){p=[[0,18,w],[0,18,-3350]];f=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:p,duration:14.3,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0025,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2.8]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});f.lat=d.lat;f.lon=d.lon;g.scene.addObject(f.animationParent);f.animation.play(!1,0);c=f;h.changeCamera(c);
d.animation.stop();t=!0}THREE.AnimationHandler.update(u);h.update(u);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/400;j.render(g.scene,c,m);g.update(u,c,!1);b.logger.log("vertices: "+j.data.vertices);b.logger.log("faces: "+j.data.faces);b.logger.log("draw calls: "+j.data.drawCalls)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){var e=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("prairie initScene");e.update(9.0E-4,49.99,90375)});var c,d,f,g=b.renderer,h=b.renderTarget,j,m=[],n=0;this.init=function(){m=[[302.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,
-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var p,t;for(p=0;p<m.length;p++){t=m[p][1];m[p][1]=m[p][2]+6;m[p][2]=-t}j=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E6,waypoints:m,duration:25,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,
lookSpeed:0.0028,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});j.position.set(0,0,0);j.lon=360;c=j;d=new PrairieWorld(b,c);f=new PrairieSoup(c,d.scene,b);b.worlds.prairie=d;b.sequences.prairie=this;d.scene.addObject(j.animationParent);console.log("prairie init")};this.show=function(){this.resetCamera();b.started.prairie=!0;console.log("show prairie")};this.hide=function(){};this.resetCamera=function(){n=
0;c.position.set(0,0,0);c.lon=360;c.animation.play(!0,0)};this.update=function(p,t){if(isNaN(t)||t>1E3||t==0)t=1E3/60;n+=t;if(n<2500)c.lon=360;THREE.AnimationHandler.update(t);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/300;c.animationParent.position.y+=(Math.random()-0.5)*0.3;d.update(t,c,!1);f.update(t);g.render(d.scene,c,h);b.logger.log("vertices: "+g.data.vertices);b.logger.log("faces: "+g.data.faces);b.logger.log("draw calls: "+g.data.drawCalls)}};
Prairie.prototype=new SequencerItem;Prairie.prototype.constructor=Prairie;
var Dunes=function(b){SequencerItem.call(this);var e=this,c,d,f,g=b.renderer,h=b.renderTarget;b.signals.initscenes.add(function(){console.log("dunes initScene");e.update(9.0E-4,49.99,90375)});this.init=function(){d=new DunesWorld(b);b.worlds.dunes=d;b.sequences.dunes=this;c=DunesCamera(b);f=new DunesSoup(c.camera,d.scene,b);console.log("dunes init")};this.show=function(){c.resetCamera();b.started.dunes=!0;console.log("show dunes")};this.hide=function(){};this.resetCamera=function(){c.resetCamera();
g.setClearColor(d.scene.fog.color)};this.update=function(j,m,n){c.updateCamera(j,m,n);THREE.AnimationHandler.update(m);d.update(m,c.camera,!1);f.update(m);g.render(d.scene,c.camera,h)}};Dunes.prototype=new SequencerItem;Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var e,c,d,f,g,h,j,m,n,p;e=document.createElement("div");e.style.width=window.innerWidth+"px";e.style.height=window.innerHeight+"px";e.style.backgroundColor="#4584b4";e.style.textAlign="center";var t=!1;this.load=function(){function v(u,w,y){var z=document.createElement("div");z.style.position="absolute";z.style.cursor="pointer";z.style.margin=u;var A=document.createElement("img");A.src=w;z.appendChild(A);z.addEventListener("mouseout",function(){A.src=
w},!1);z.addEventListener("mouseover",function(){A.src=y},!1);return z}c=document.createElement("canvas");c.width=32;c.height=window.innerHeight;d=c.getContext("2d");f=d.createLinearGradient(0,0,0,c.height);f.addColorStop(0,"#0e223a");f.addColorStop(0.5,"#4584b4");d.fillStyle=f;d.fillRect(0,0,c.width,c.height);e.style.backgroundImage="url("+c.toDataURL("image/png")+")";e.style.backgroundRepeat="repeat-x";g=new Clouds(b);g.getDomElement().style.position="absolute";g.getDomElement().style.left="0px";
g.getDomElement().style.top="0px";g.getDomElement().style.width=window.innerWidth+"px";g.getDomElement().style.height=window.innerHeight+"px";e.appendChild(g.getDomElement());h=document.createElement("div");h.style.position="absolute";h.innerHTML='<img src="files/logo_heart.png">';e.appendChild(h);j=v("10px 0 0 85px","files/enter_idle.png","files/enter_rollover.png");j.addEventListener("click",function(){n.getDomElement().style.display="block";j.style.display="none";t=!0;b.signals.load.dispatch()},
!1);e.appendChild(j);m=v("10px 0 0 85px","files/start_idle.png","files/start_rollover.png");m.style.display="none";m.addEventListener("click",function(){b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1)},1E3)},!1);e.appendChild(m);n=new LoadingBar(function(){n.getDomElement().style.display="none";m.style.display="block";t=!1;b.signals.initscenes.dispatch()});n.getDomElement().style.position="absolute";n.getDomElement().style.display="none";e.appendChild(n.getDomElement());
b.signals.loadItemAdded.add(n.addItem);b.signals.loadItemCompleted.add(n.completeItem);p=document.createElement("div");p.style.position="absolute";p.style.left="0";p.style.bottom="0";p.style.width="100%";new Footer(p);e.appendChild(p)};this.show=function(){g.show();e.style.display="block"};this.resize=function(v,u){g.resize(v,u);h.style.top="60px";h.style.left=(window.innerWidth-358)/2+"px";j.style.top=m.style.top="210px";j.style.left=m.style.left=(window.innerWidth-358)/2+"px";n.getDomElement().style.top=
"215px";n.getDomElement().style.left=(window.innerWidth-300)/2+"px";e.style.width=v+"px";e.style.height=u+"px"};this.hide=function(){g.hide();e.style.display="none"};this.update=function(){t||g.update()};this.getDomElement=function(){return e}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function e(){h=!1;f.pause()}function c(J){switch(J.keyCode){case 32:f.paused?f.play():f.pause();break;case 37:f.currentTime--;j.clear();break;case 39:f.currentTime++;j.clear();break;case 38:f.playbackRate+=0.1;break;case 40:f.playbackRate-=0.1;break;case 77:f.volume=f.volume?0:1}}Section.call(this);var d,f,g,h=!1,j,m,n;d=document.createElement("div");d.style.display="none";f=document.createElement("audio");f.preload=!0;d.appendChild(f);source=document.createElement("source");
source.src="files/Black.ogg";f.appendChild(source);g=new Tune(f);g.setBPM(85);g.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);m=new THREE.WebGLRenderer;m.domElement.style.position="absolute";m.setSize(b.viewportWidth,b.baseHeight);m.sortObjects=!1;m.autoClear=!1;n=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);n.minFilter=THREE.LinearFilter;n.magFilter=THREE.LinearFilter;
b.renderer=m;b.renderTarget=n;b.signals.startfilm.add(function(J,K){d.appendChild(m.domElement);h=!0;f.currentTime=g.getPatternMS(J)/1E3;f.play();f.volume=K});b.signals.stopfilm.add(e);THREE.ImageUtils.loadTexture("files/textures/fingerprints.png");var p=new VideoPlayer(b,VideoShots.introLayers),t=new VideoPlayer(b,VideoShots.s01_01),v=new VideoPlayer(b,VideoShots.s01_03),u=new VideoPlayer(b,VideoShots.s01_06),w=new VideoPlayer(b,VideoShots.s01_09),y=new VideoPlayer(b,VideoShots.s02_01),z=new VideoPlayer(b,
VideoShots.s02_02),A=new VideoPlayer(b,VideoShots.s02_03),E=new VideoPlayer(b,VideoShots.s02_04),C=new VideoPlayer(b,VideoShots.s02_06),D=new VideoPlayer(b,VideoShots.s03_01),B=new VideoPlayer(b,VideoShots.s03_02),I=new VideoPlayer(b,VideoShots.s03_03);j=new Sequencer;j.add(new ClearEffect(b),g.getPatternMS(0),g.getPatternMS(73.25),0);j.add(p,g.getPatternMS(0),g.getPatternMS(8),1);p=g.getPatternMS(8);var N=g.getPatternMS(16);j.add(t,p,p+t.duration,1);p+=t.duration;j.add(v,p,p+v.duration,1);p+=v.duration;
j.add(u,p,p+u.duration,1);p+=u.duration;j.add(w,p,N,4);t=g.getPatternMS(16)-2E3;j.add(new City(b),t,g.getPatternMS(24),1);j.add(new PaintEffect(b),t,g.getPatternMS(24),5);t=g.getPatternMS(24);g.getPatternMS(32);j.add(y,t,t+y.duration,1);t+=y.duration;j.add(z,t,t+z.duration,1);t+=z.duration;j.add(A,t,t+A.duration,1);t+=A.duration;j.add(E,t,t+E.duration,1);t+=E.duration;j.add(C,t,t+C.duration,4);y=g.getPatternMS(32)-3E3;j.add(new Prairie(b),y,g.getPatternMS(40),1);j.add(new PaintEffectPrairie(b),y,
g.getPatternMS(40),5);y=g.getPatternMS(40);g.getPatternMS(48);j.add(D,y,y+D.duration,1);y+=D.duration;j.add(B,y,y+B.duration,1);y+=B.duration;j.add(I,y,y+I.duration,4);y+=I.duration;D=g.getPatternMS(48)-11E3;j.add(new Dunes(b),D,g.getPatternMS(73.25),1);j.add(new PaintEffectDunes(b),D,g.getPatternMS(73.25),5);j.add(new FadeOutEffect(0,b),g.getPatternMS(23.5),g.getPatternMS(24),3);j.add(new FadeOutEffect(0,b),g.getPatternMS(39.5),g.getPatternMS(40),3);j.add(new FadeOutEffect(0,b),g.getPatternMS(72),
g.getPatternMS(73.25),5);j.add(new PointerEffect(b,!1),g.getPatternMS(0),g.getPatternMS(8),1);j.add(new PointerEffect(b,!0),g.getPatternMS(8),g.getPatternMS(73.25),1);j.add(new RenderEffect(b),g.getPatternMS(0),g.getPatternMS(8),6);j.add(new PaintEffectVideo(b),g.getPatternMS(8),g.getPatternMS(16)-2E3,6);j.add(new PaintEffectVideo(b),g.getPatternMS(24),g.getPatternMS(32)-3E3,6);j.add(new PaintEffectVideo(b),g.getPatternMS(40),g.getPatternMS(48)-11E3,6);this.getDomElement=function(){return d};this.show=
function(){d.style.display="block";b.signals.keydown.add(c)};this.hide=function(){d.style.display="none";b.signals.keydown.remove(c);e()};this.resize=function(J,K){b.viewportWidth=b.baseWidth*(J/b.baseWidth);b.viewportHeight=b.baseHeight*(J/b.baseWidth);m.setSize(b.viewportWidth,b.viewportHeight);n.width=b.viewportWidth;n.height=b.viewportHeight;delete n.__webglFramebuffer;m.domElement.style.left="0px";m.domElement.style.top=(K-b.viewportHeight)/2+"px"};this.update=function(){if(h)if(f.currentTime==
f.duration){b.signals.showrelauncher.dispatch();e()}else j.update(f.currentTime*1E3)}};FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function e(){for(var A=u.getPoints(),E=0;E<A.length;E++){var C=A[E].getOriginPosition(),D=f.list[E],B=C.x;C=C.y;if(E==0){B-=113;C-=162}else if(E==1){B+=137;C-=46}else if(E==2){B+=106;C+=78}else if(E==3){B-=312;C+=75}else{B-=344;C-=46}D.style.left=B+"px";D.style.top=C+"px"}}function c(A,E,C,D,B){E=document.createElement(E);E.setAttribute("id",C);E.setAttribute("class",D);E.innerHTML=B;A.appendChild(E);return E}Section.call(this);var d=document.createElement("div");
d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.display="none";d.style.backgroundColor="#ffffff";d.setAttribute("id","relauncher-section");var f={},g,h=document.createTextNode("#relauncher-section div.after-experience { position: absolute; height: 57px; overflow: hidden; cursor: pointer; } #relauncher-section div.after-experience img { display: block; } #relauncher-section div.after-experience:hover img { margin-top: -57px; }"),j=document.getElementsByTagName("head")[0],
m=document.createElement("style");m.type="text/css";if(m.styleSheet)m.styleSheet.cssText=h.nodeValue;else m.appendChild(h);j.appendChild(m);var n=new Clouds(b,!0);n.getDomElement().style.position="absolute";n.getDomElement().style.left="0px";n.getDomElement().style.top="0px";n.getDomElement().style.width=window.innerWidth+"px";n.getDomElement().style.height=window.innerHeight+"px";d.appendChild(n.getDomElement());h=document.createElement("div");h.setAttribute("id","container");h.setAttribute("style",
"position: absolute;");d.appendChild(h);var p=new GEE({fullscreen:!0,container:h,loop:!1}),t=p.ctx;g=document.createElement("div");g.style.position="absolute";g.style.width="100%";g.style.top=window.innerHeight-78+"px";g.style.left="0";new Footer(g);d.appendChild(g);var v=new WonderWall.Pentagon(p,p.width*0.5,p.height*0.5,80),u=new WonderWall.Pentagon(p,p.width*0.5,p.height*0.5,95),w=new WonderWall.Pentagon(p,p.width*0.5,p.height*0.5,130,0.25);w.showFill=!1;w.insides=!0;u.showFill=!1;w.setRadius(0.19);
v.setRadius(0.12);var y={svg:new Heart(p,"files/eminating-heart.svg",0,0),point:new WonderWall.Point(p,p.width*0.5,p.height*0.5+6)};y.point.r=0.0625;var z=z||{};z.color={red:"#f15d22",black:"#30302e",white:"#f4f4ea"};f=function(A){var E={},C=c(A,"div","start-over","after-experience","<img src = 'files/relaunch_section/start_over.png' alt = 'Start Over' />"),D=c(A,"div","technology","after-experience","<img src = 'files/relaunch_section/technology.png' alt = 'Technology' />"),B=c(A,"div","add-to-the-dream",
"after-experience","<img src = 'files/relaunch_section/add_dreams.png' alt = 'Add to the Dream' />"),I=c(A,"div","explore-other-dreams","after-experience","<img src = 'files/relaunch_section/explore_dreams.png' alt = 'Explore Other Dreams' />");A=c(A,"div","continue-to-explore","after-experience","<img src = 'files/relaunch_section/continue.png' alt = 'Continue To Explore' />");C.addEventListener("click",function(N){N.preventDefault();b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(0,1)},
!1);D.addEventListener("click",function(N){N.preventDefault();window.location="/tech"},!1);B.addEventListener("click",function(N){N.preventDefault();b.signals.showugc.dispatch()},!1);I.addEventListener("click",function(N){N.preventDefault();window.location="/gallery"},!1);A.addEventListener("click",function(N){N.preventDefault();b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes")},!1);E.start=C;E.technology=D;E.add=B;E.otherDreams=I;E.explore=A;E.list=[A,C,I,B,D];init=
!0;return E}(d);for(h=0;h<f.list.length;h++){j=f.list[h];j.addEventListener("mouseover",function(){var A=f.list.indexOf(this);v.setUpdatePoint(!0,A);u.setUpdatePoint(!0,A);w.setUpdatePoint(!0,A);y.point.updating=!0},!1);j.addEventListener("mouseout",function(){var A=f.list.indexOf(this);v.setUpdatePoint(!1,A);u.setUpdatePoint(!1,A);w.setUpdatePoint(!1,A);y.point.updating=!1},!1)}e();p.draw=function(){u.update();u.getPoints();t.clearRect(0,0,p.width,p.height);t.globalCompositeOperation="source-over";
t.strokeStyle=z.color.black;t.lineWidth=0.5;w.update().render();t.globalCompositeOperation="destination-out";v.update().render();t.globalCompositeOperation="xor";t.lineWidth=24;u.showStroke=!0;u.showFill=!1;u.render();t.globalCompositeOperation="source-over";t.save();t.translate(p.width/2,p.height/2);y.svg.render();t.restore()};this.show=function(){n.show();e();d.style.display="block"};this.resize=function(A,E){d.style.width=A+"px";d.style.height=E+"px";n.resize(A,E);g.style.top=window.innerHeight-
78+"px";e()};this.hide=function(){n.hide();d.style.display="none"};this.getDomElement=function(){return d};this.update=function(){n.update();p.draw()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){function e(){var E=window.innerWidth/b.baseWidth;b.viewportWidth=b.baseWidth*E;b.viewportHeight=b.baseHeight*E;g.setSize(b.viewportWidth,b.viewportHeight);h.width=b.viewportWidth;h.height=b.viewportHeight;delete h.__webglFramebuffer;g.domElement.style.left="0px";g.domElement.style.top=(window.innerHeight-b.viewportHeight)/2+"px"}Section.call(this);var c=document.createElement("div");c.style.display="none";var d=0,f=0,g=b.renderer,h=b.renderTarget,j,m,n,p,t,v,u,w,
y=0;p=new ClearEffect(b);p.init();w=new FadeOutEffect(0,b);w.init();t=new PaintEffect(b);t.init();v=new PaintEffectPrairie(b);v.init();u=new PaintEffectDunes(b);u.init();var z,A={};A.dunes=new DunesCameraFreeExplore(b);A.prairie=new PrairieCameraFreeExplore(b);A.city=new CityCameraFreeExplore(b);b.signals.startexploration.add(function(E){j=b.worlds[E];m=j.portals;z=A[E];z.resetCamera();y=0;n=E=="city"?t:E=="prairie"?v:u;e();d=f=(new Date).getTime()});b.signals.windowresized.add(e);this.getDomElement=
function(){return c};this.show=function(){c.style.display="block";c.appendChild(g.domElement)};this.hide=function(){c.style.display="none"};this.resize=function(){console.log("Exploration Resize")};this.update=function(){if(j&&j.scene){time=(new Date).getTime()-d;delta=time-f;f=time;delta=33;THREE.AnimationHandler.update(delta);z.updateCamera(0,delta,time);j.update(delta,z.camera,!0);p.update(0,delta,time);g.setClearColor(j.scene.fog?j.scene.fog.color:16777215);g.render(j.scene,z.camera,h);if(y<1E3){y+=
delta;w.update(1-y/1E3)}for(var E=0;E<m.length;E++)m[E].currentDistance<m[E].radius*1.5&&w.update(1-(m[E].currentDistance-m[E].radius)/(m[E].radius*0.5));n.update(0,delta,time)}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){var e,c,d=document.createElement("div");d.style.display="none";this.getDomElement=function(){return d};this.load=function(){var f=signals.Signal;b.ugcSignals={};b.ugcSignals.object_createmode=new f;b.ugcSignals.object_erasemode=new f;b.ugcSignals.object_changecolor=new f;b.ugcSignals.submit=new f;e=new UgcObjectCreator(b);d.appendChild(e.getDomElement());c=new UgcUI(b);c.getDomElement().style.position="absolute";c.getDomElement().style.left="20px";c.getDomElement().style.top=
"50%";d.appendChild(c.getDomElement());c.addListeners();c.HANDLERS.updateCapacity(0)};this.show=function(){d.style.display="block";e.show()};this.hide=function(){d.style.display="none";e.hide()};this.resize=function(f,g){c.scale(f/1342);c.getDomElement().style.marginTop=-255*f/1342+"px";e.resize(f,g)};this.update=function(){e.update()}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b,e){function c(){if(!e){n.x=b.mouse.x/b.screenWidth*100-50;n.y=b.mouse.y/b.screenHeight*100-50;p=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}}function d(qa){for(var U=0;U<2;U++){f=j[U]=new Boid;f.position.x=320;f.position.y=20+Math.random()*10;f.position.z=200+Math.random();f.velocity.x=Math.random()*2-1;f.velocity.y=Math.random()*2-1;f.velocity.z=Math.random()*2-1;f.setAvoidWalls(!0);f.setWorldSize(1E3,200,400);m[U]=new ROME.Animal(qa,!0);m[U].timeOffset=
Math.random()*100;g=h[U]=m[U].mesh;g.phase=Math.floor(Math.random()*62.8);g.rotation.set(0,-0.5,0);g.updateMatrix();g.update();window.morphObject=m[U];m[U].play(m[U].availableAnimals[0],m[U].availableAnimals[0]);g.position=j[U].position;g.doubleSided=!1;g.scale.x=g.scale.y=g.scale.z=0.03+0.05*Math.random();D.addChild(g)}B.position.z=-4E3;z.addObject(B);I.position.z=0;z.addObject(I);E.addObject(D)}var f,g,h=[],j=[],m=[],n={x:0,y:0},p={x:0,y:0,z:0},t,v,u=start_time=(new Date).getTime(),w,y,z,A,E,C,
D,B,I,N,J,K,L,aa,o,ja=0;J=new THREE.Fog(4555956,-100,3E3);w=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);w.position.z=6E3;z=new THREE.Scene;E=new THREE.Scene;D=new THREE.Object3D;N=new THREE.Geometry;var ga=THREE.ImageUtils.loadTexture("files/cloud256.png",null,function(){K=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:ga},fogColor:{type:"c",value:J.color},fogNear:{type:"f",value:J.near},fogFar:{type:"f",value:J.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var qa=new THREE.Mesh(new THREE.Plane(64,64)),U=0;U<4E3;U++){qa.position.x=
Math.random()*1E3-500;qa.position.y=e?-Math.random()*Math.random()*200+25:-Math.random()*Math.random()*200-15;qa.position.z=U;qa.rotation.z=Math.random()*Math.PI;qa.scale.x=qa.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(N,qa)}B=new THREE.Mesh(N,K);I=new THREE.Mesh(N,K);(new THREE.JSONLoader).load({model:"./files/models/soup/birds_B_life.js",callback:d})});ga.magFilter=THREE.LinearMipMapLinearFilter;ga.minFilter=THREE.LinearMipMapLinearFilter;C=new THREE.WebGLRenderer({antialias:!1,
clearColor:0,clearAlpha:0});C.domElement.style.position="absolute";C.domElement.style.left="0px";C.domElement.style.top="0px";C.sortObjects=!1;C.autoClear=!1;aa=new THREE.WebGLRenderTarget(window.innerWidth/2,window.innerHeight/2,{minFilter:THREE.NearestFilter,magFilter:THREE.LinearFilter});o=new THREE.WebGLRenderTarget(window.innerWidth*2,window.innerHeight*2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});window.renderTargetClouds=aa;y=new THREE.Camera;y.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);A=new THREE.Scene;L=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:aa},tFlamingos:{type:"t",value:1,texture:o},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:J.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos *= 1./4.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.15*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
A.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),L));this.getDomElement=function(){return C.domElement};this.show=function(){b.signals.mousemoved.add(c)};this.hide=function(){b.signals.mousemoved.remove(c)};this.resize=function(qa,U){w.aspect=qa/U;w.updateProjectionMatrix();C.setSize(qa,U);C.domElement.style.width=qa+"px";C.domElement.style.height=U+"px"};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;v=(new Date).getTime();t=v-u;u=v;w.position.x+=
(n.x-w.position.x)*0.0090;w.position.y+=(-n.y-w.position.y)*0.0090;w.position.z=-position+4E3;D.position.z=w.position.z-500;D.position.y=-50;ja=Math.min(Math.max(-0.3,(n.x-w.position.x)*0.0050),0.3);w.up.x+=(ja-w.up.x)*0.0050;w.up.normalize();w.target.position.x=w.position.x;w.target.position.y=w.position.y;w.target.position.z=w.position.z-1E3;C.clear();C.render(z,w,aa,!0);C.render(E,w,o,!0);C.render(A,y);for(var qa=0,U=h.length;qa<U;qa++){f=j[qa];p.z=f.position.z;f.run(j);g=h[qa];g.rotation.y=Math.atan2(-f.velocity.z,
f.velocity.x)+Math.PI/2;g.rotation.z=Math.asin(f.velocity.y/f.velocity.length());g.phase=(g.phase+(Math.max(0,g.rotation.z)+0.1))%62.83;m[qa].update(t*g.phase/100)}}},Boid=function(){var b=new THREE.Vector3,e,c=500,d=500,f=200,g,h=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;e=new THREE.Vector3;this.setGoal=function(j){g=j};this.setAvoidWalls=function(j){h=j};this.setWorldSize=function(j,m,n){c=j;d=m;f=n};this.run=function(j){if(h){b.set(-c*15,this.position.y,this.position.z);
b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(c,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,0,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,d,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,-f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b)}Math.random()>
0.5&&this.flock(j);this.move()};this.flock=function(j){g&&e.addSelf(this.reach(g,0.0050));e.addSelf(this.alignment(j));e.addSelf(this.cohesion(j));e.addSelf(this.separation(j))};this.move=function(){this.velocity.addSelf(e);var j=this.velocity.length();j>1&&this.velocity.divideScalar(j/1);this.position.addSelf(this.velocity);e.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>d)this.position.y=-d;if(this.position.y<
-d)this.position.y=d;if(this.position.z>f)this.position.z=-f;if(this.position.z<-f)this.position.z=f};this.avoid=function(j){var m=new THREE.Vector3;m.copy(this.position);m.subSelf(j);m.multiplyScalar(1/this.position.distanceToSquared(j));return m};this.repulse=function(j){var m=this.position.distanceTo(j);if(m<150){var n=new THREE.Vector3;n.sub(this.position,j);n.multiplyScalar(0.5/m);e.addSelf(n)}};this.reach=function(j,m){var n=new THREE.Vector3;n.sub(j,this.position);n.multiplyScalar(m);return n};
this.alignment=function(j){for(var m,n=new THREE.Vector3,p=0,t=0,v=j.length;t<v;t++)if(!(Math.random()>0.6)){m=j[t];distance=m.position.distanceTo(this.position);if(distance>0&&distance<=3E3){n.addSelf(m.velocity);p++}}if(p>0){n.divideScalar(p);j=n.length();j>0.03&&n.divideScalar(j/0.03)}return n};this.cohesion=function(j){for(var m,n,p=new THREE.Vector3,t=new THREE.Vector3,v=0,u=0,w=j.length;u<w;u++)if(!(Math.random()>0.6)){m=j[u];n=m.position.distanceTo(this.position);if(n>0&&n<=3E3){p.addSelf(m.position);
v++}}v>0&&p.divideScalar(v);t.sub(p,this.position);j=t.length();j>0.03&&t.divideScalar(j/0.03);return t};this.separation=function(j){for(var m,n,p=new THREE.Vector3,t=new THREE.Vector3,v=0,u=j.length;v<u;v++)if(!(Math.random()>0.6)){m=j[v];n=m.position.distanceTo(this.position);if(n>0&&n<=3E3){t.sub(this.position,m.position);t.normalize();t.divideScalar(n);p.addSelf(t)}}return p}},UgcUI=function(b){var e=document.createElement("style");e.setAttribute("type","text/css");e.innerHTML="#ugcui g {\n  cursor: pointer;\n}\n#ugcui g.menu polygon.hitbox {\n  display: none;\n}\n#ugcui g.menu:hover polygon.hitbox {\n  display: inherit;\n}\n#ugcui g.folder polygon.folder-hitbox {\n  display: none;\n}\n#ugcui g.folder:hover polygon.folder-hitbox {\n  display: inherit;\n}\n#ugcui g.menu g.menu-buttons {\n  display: none;\n}\n#ugcui g.menu:hover g.menu-buttons {\n  display: block;\n}\n#ugcui g.active polygon.hex {\n  fill: #f65824;\n}\n#ugcui g#color g.options polygon.selected {\n  stroke: #fff;\n  stroke-width: 3.5;\n}\n#ugcui g#color g.options polygon#white.selected {\n  stroke: #000;\n}\n#ugcui g#color g.options polygon:not(.selected):hover {\n  stroke: #fff;\n  stroke-width: 3.5;\n}\n#ugcui g#color g.options polygon#white:not(.selected):hover {\n  stroke: #000;\n}\n#ugcui g.menu-buttons g:hover:not(.active) .hex {\n  fill: #fff;\n}\n#ugcui g.folder g.options {\n  display: none;\n}\n#ugcui g.folder:hover g.options {\n  display: block;\n}\n#ugcui g#size g g:hover polygon.bg {\n  fill: #fff;\n}\n#ugcui g#size:hover g g polygon.bg.active {\n  fill: #f65824;\n}\n#ugcui g#smoother g.options g:hover polygon.bg {\n  fill: #fff;\n}";
document.getElementsByTagName("head")[0].appendChild(e);var c=document.createElement("div");c.innerHTML='<svg id="ugcui" \n\t\tversion="1.1"\n     xmlns="http://www.w3.org/2000/svg"\n     xmlns:xlink="http://www.w3.org/1999/xlink"\n     xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n  \t width="1200px" \n  \t height="1200px"><g>\n<g class="menu">\n\n<polygon class="hex main" fill="#282828"\n         points="13.128,45.47 0.002,22.735 13.128,0 39.379,0 52.505,22.735 39.379,45.47 "></polygon>\n\n<polygon fill="#ED957A"\n         points="26.747,35.233 15.912,28.403 15.912,15.66 26.747,22.488 \t"></polygon>\n<polygon fill="#EA7B59"\n         points="37.583,15.66 26.747,22.49 26.747,35.233 37.583,28.405 \t"></polygon>\n<polygon fill="#F15C22"\n         points="15.912,15.66 26.75,22.49 37.583,15.66 26.75,9.119 \t"></polygon>\n\n<polygon opacity="0" class="hitbox" points="140.184,\n    72.916 126.007,48.362 98.374,48.362 84.558,24.432 56.924,24.432\n\t43.107,0.5 14.756,0.5 0.58,25.054 14.397,48.985 0.58,72.917 14.397,96.847 0.58,120.779 14.756,145.332 42.389,145.332\n\t56.206,169.263 84.556,169.263 98.373,145.332 126.007,145.332 140.184,120.778 126.366,96.847 "></polygon>\n\n<g class="menu-buttons">\n\n<g id="reflect" class="toggle">\n\n  <polygon class="hex" fill="rgba(255, 255, 255,\n      0.4)" points="13.128,\n      93.332 0.002,70.598 13.128,47.862 39.379,47.862 52.505,70.598\n39.379,93.332 "></polygon>\n\n\n  <rect x="16.502" y="58.113" fill="none" width="20.022" height="25.86"></rect>\n  <path fill="#30302E" d="M33.981,70.986c0,3.275-2.654,5.931-5.929,5.931v2.542c4.679,0,8.472-3.791,8.472-8.473\n\t\tc0-4.679-3.793-8.47-8.472-8.47v2.539C31.327,65.055,33.981,67.711,33.981,70.986"></path>\n  <path fill="#30302E" d="M19.047,71.023c0,3.277,2.653,5.934,5.928,5.934v2.539c-4.679,0-8.473-3.792-8.473-8.473\n\t\tc0-4.679,3.794-8.47,8.473-8.47v2.539C21.7,65.092,19.047,67.749,19.047,71.023"></path>\n  <rect x="26.256" y="58.113" fill="#30302E" width="0.409" height="25.86"></rect>\n</g>\n\n<g id="create" class="active">\n  <polygon class="hex" fill="rgba(255, 255, 255,\n      0.4)" points="54.578,\n      69.401 41.452,46.666 54.578,23.932 80.83,23.932 93.956,46.666\n\t80.829,69.401 "></polygon>\n\n  <polygon fill="#575759"\n           points="68.083,46.957 57.056,40.275 57.056,53.489 68.083,60.169 \t"></polygon>\n  <polyline fill="#3A3A3A"\n            points="68.083,46.957 79.109,40.275 79.109,53.489 68.083,60.169 \t"></polyline>\n  <polygon fill="#282828"\n           points="57.055,40.276 68.083,47.078 79.111,40.276 68.083,33.906 \t"></polygon>\n</g>\n\n<g id="erase">\n\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="96.028,\n  93.332 82.902,\n  70.598 96.028,47.862 122.279,47.862 135.406,70.597\n\t122.279,93.332 "></polygon>\n\n  <path d="M108.854,78.1l9.885-9.884c0.91-0.911,0.911-2.392,0-3.303l-5.394-5.393c-0.91-0.911-2.393-0.912-3.303-0.001l-9.885,9.884\n\t\tc-0.911,0.91-0.909,2.393,0.001,3.303l5.393,5.393C106.463,79.01,107.944,79.01,108.854,78.1z M101.053,70.298l4.929-4.929\n\t\tl6.906,6.905l-4.929,4.93c-0.417,0.417-1.096,0.418-1.513,0.001l-5.394-5.393C100.636,71.396,100.636,70.716,101.053,70.298z"></path>\n  <path d="M118.765,69.096l-0.894,0.894c0.417,0.417,0.416,1.095-0.001,1.513l-9.885,9.884c-0.417,0.417-1.095,0.418-1.512,0.001\n\t\tl-5.396-5.396c-0.416-0.416-0.415-1.094,0.003-1.512l-0.896-0.896c-0.91,0.911-0.91,2.392-0.001,3.301l5.396,5.396\n\t\tc0.91,0.91,2.392,0.911,3.302,0l9.884-9.884C119.676,71.487,119.675,70.006,118.765,69.096z"></path>\n</g>\n\n<g id="undo">\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n  117.263 41.452,\n  94.528 54.578,71.794 80.829,71.794 93.955,94.528\n\t80.829,117.263 "></polygon>\n\n  <path d="M66.275,85.886l-7.204,4.949l6.685,6.087l0.173-3.677c0,0,4.647-0.105,6.306,3.98c1.648,4.086,0.378,7.234,0.378,7.234\n\t\ts4.24-1.563,2.989-8.994c0,0-1.088-5.905-9.485-6.221L66.275,85.886z"></path>\n</g>\n\n<g class="folder" id="size">\n\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="126.366,\n144.709 140.184,120.778 126.007,96.225 97.656,96.225 83.48,120.779\n\t97.297,144.71 83.48,168.642 97.297,192.572 83.479,216.504 97.655,241.057 126.006,241.057 140.182,216.504 126.366,192.573\n\t140.183,168.642 "></polygon>\n\n  <g class="size" id="icon-size-small">\n    <g>\n      <polygon class="active bg" fill="rgba(255, 255, 255, 0.4)" points="96.028,\n  141.194 82.902,\n  118.46 96.028,95.725 122.279,95.725 135.406,118.459\n\t122.279,141.194 "></polygon>\n\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="98.111" y1="118.646" x2="114.651"\n            y2="128.775"></line>\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="103.624" y1="115.244" x2="120.165"\n            y2="125.374"></line>\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="114.651" y1="115.172" x2="98.11"\n            y2="125.375"></line>\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10" x1="120.165" y1="118.646" x2="103.624"\n            y2="128.776"></line>\n      <polygon fill="none" stroke="#3D3D3D" stroke-width="0.5"\n               stroke-miterlimit="10" points="92.598,121.974 109.138,132.25\n\t\t125.679,121.974 109.138,112.161 \t"></polygon>\n      <polygon fill="#575759"\n               points="109.138,118.646 103.624,115.171 103.624,108.687 109.138,112.161 \t"></polygon>\n      <polygon fill="#3A3A3A"\n               points="114.651,108.687 109.138,112.161 109.138,118.646 114.651,115.171 \t"></polygon>\n      <polygon fill="#282828"\n               points="103.624,108.687 109.139,112.161 114.651,108.687 109.139,105.358 \t"></polygon>\n    </g>\n  </g>\n\n  <g class="options">\n\n    <g class="size" id="icon-size-med">\n      <\!-- Hex --\>\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="96.028,189.057 82.902,166.323 96.028,143.588 122.28,143.588 135.405,166.323 122.279,189.057 "></polygon>\n\n      <\!-- Med icon --\>\n      <polygon fill="#E0E0E0"\n               points="98.111,169.571 103.625,173.047 109.138,169.571 103.625,166.243 \t"></polygon>\n      <polygon fill="#E0E0E0"\n               points="109.138,169.572 114.652,173.048 120.165,169.572 114.652,166.244 \t"></polygon>\n      <polygon fill="#E0E0E0"\n               points="103.624,172.974 109.139,176.448 114.651,172.974 109.139,169.646 \t"></polygon>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="98.111" y1="169.646" x2="114.651" y2="179.775"></line>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="103.624" y1="166.244" x2="120.165" y2="176.374"></line>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="114.651" y1="166.172" x2="98.11" y2="176.375"></line>\n\n      <line fill="none" stroke="#3D3D3D" stroke-width="0.5"\n            stroke-miterlimit="10"\n            x1="120.165" y1="169.646" x2="103.624" y2="179.776"></line>\n      <polygon fill="none" stroke="#3D3D3D" stroke-width="0.5"\n               stroke-miterlimit="10" points="92.598,172.974 109.138,183.25\n\t\t125.679,172.974 109.138,163.161 \t"></polygon>\n      <polygon fill="#575759"\n               points="109.084,162.956 98.057,156.275 98.057,169.489 109.084,176.169 \t"></polygon>\n      <polyline fill="#3A3A3A"\n                points="109.084,162.956 120.109,156.275 120.109,169.489 109.084,176.169 \t"></polyline>\n      <polygon fill="#282828"\n               points="98.055,156.276 109.082,163.077 120.111,156.276 109.082,149.905 \t"></polygon>\n    </g>\n\n    <g class="size" id="icon-size-large">\n      <\!-- Hex --\>\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="96.027,236.919 82.901,214.186 96.027,191.451 122.279,191.451 135.404,214.186 122.278,236.919 "></polygon>\n      <\!-- Big icon --\>\n      <polygon fill="#575759"\n               points="108.709,215.198 91.668,204.448 91.668,224.007 108.709,234.359 \t"></polygon>\n      <polygon fill="#3A3A3A"\n               points="125.75,224.024 108.709,234.358 108.709,215.217 125.75,204.864 \t"></polygon>\n      <polygon fill="#282828"\n               points="125.75,204.864 108.584,215.198 91.668,204.448 108.709,195.198 \t"></polygon>\n    </g>\n\n  </g>\n\n</g>\n\n<g class="folder" id="smoother">\n\n  <\!--hex --\>\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n  165.125 41.452,\n  142.391 54.578,119.657 80.829,119.657 93.955,142.391\n\t80.829,165.125 "></polygon>\n\n  <\!--icon--\>\n  <polygon fill="#575759"\n           points="68.279,159.028 62.1,155.134 62.1,147.868 68.279,151.761 \t"></polygon>\n  <polygon fill="#3A3A3A"\n           points="74.458,147.868 68.279,151.762 68.279,159.028 74.458,155.135 \t"></polygon>\n  <polygon fill="#282828"\n           points="62.1,147.868 68.28,151.762 74.458,147.868 68.28,144.138 \t"></polygon>\n  <circle fill="#575759" cx="68.167" cy="134.167" r="5"></circle>\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="84.916,\n168.64 98.732,\n144.71 84.556,120.157 56.206,120.157 42.029,144.71\n\t55.847,168.641 42.029,192.573 55.846,216.503 42.029,240.435 56.206,264.988 84.556,264.988 98.732,240.435 84.916,216.503\n\t98.732,192.573 "></polygon>\n\n  <g class="options">\n\n    <g id="smoother-up">\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="54.578,212.988 41.452,190.254 54.578,167.519 80.829,167.519 93.955,190.254 80.829,212.988 "></polygon>\n    </g>\n\n    <g id="smoother-down">\n      <polygon class="bg" fill="rgba(255, 255, 255, 0.4)"\n               points="54.578,260.85 41.452,238.116 54.578,215.381 80.829,215.381 93.955,238.116 80.829,260.85 "></polygon>\n    </g>\n  </g>\n\n</g>\n\n<g class="folder" id="color">\n\n  <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="13.128,\n  141.194 0.002,\n  118.46 13.128,95.725 39.379,95.725 52.505,118.46\n\t39.379,141.194 "></polygon>\n\n  <\!-- Paint Bucket --\>\n  <path d="M36.365,110.268c0-1.864-4.349-3.374-9.715-3.374c-5.369,0-9.718,1.511-9.718,3.371c0,0.145,0.035,0.287,0.087,0.427\n\t\tv16.067l0.327,0.196c0.153,0.092,3.805,2.25,9.184,2.25c5.368,0,9.243-2.148,9.405-2.24l0.343-0.193v-16.079\n\t\tC36.331,110.555,36.365,110.413,36.365,110.268z M26.65,108.149c4.15,0,7.517,1.067,7.517,2.382c0,1.315-3.366,2.387-7.517,2.387\n\t\tc-4.155,0-7.518-1.072-7.518-2.387C19.132,109.216,22.495,108.149,26.65,108.149z M26.53,127.859c-4.109,0-7.188-1.383-8.164-1.881\n\t\tV112.01c0.157,0.088,0.321,0.175,0.499,0.257v0.206c0,0,1.344,0.289,1.405,1.64c0.054,1.345-0.235,3.629,0.762,3.629\n\t\tc0.991,0,0.521-3.629,0.521-3.629s0.614-0.529,2.051,0c1.116,0.412,2.811,0.999,3.046,2.28c-0.059,1.53,0,2.813,0,2.813\n\t\ts0.032,1.114,0.495,1.114c0.464,0,0.554,0.062,0.732-0.406c0.175-0.468,0.35-4.159,0.35-4.159s-0.021-0.681,0.354-1.053\n\t\tc0.375-0.379,1.149-0.443,1.112,0.643c-0.059,1.582,0,5.558,0,5.558s-0.233,1.055,0.645,1.118c0.878,0.054,0.762-1.29,0.762-1.29\n\t\tl0.004-5.208c0,0-0.29-1.503,3.827-3.015v13.458C33.901,126.466,30.655,127.859,26.53,127.859z"></path>\n\n  <polygon opacity="0" class="folder-hitbox" fill="#FFFFFF"\n           stroke="#000000"\n           points="140.182,\n        216.504 126.007,\n191.951 98.373,191.951 84.557,168.019 56.923,168.019\n\t43.466,144.709 57.283,120.779 43.107,96.225 14.756,96.225 0.58,120.779 14.396,144.709 0.579,168.642 14.396,192.572\n\t0.579,216.505 14.396,240.435 0.578,264.368 14.395,288.298 0.578,312.232 14.754,336.784 43.104,336.784 56.924,312.85\n\t84.557,312.85 98.373,288.919 126.006,288.919 140.182,264.367 126.365,240.434 "></polygon>\n  <g class="options">\n    <polygon fill="#80C5D8"\n             points="54.578,212.988 41.452,190.254 54.578,167.519 80.829,167.519 93.955,190.254 80.829,212.988 \t"></polygon>\n\n    <polygon fill="#2EA8CE" points="96.027,236.919 82.901,214.186 96.027,191.451 122.279,191.451 135.404,214.186 122.278,236.919\n\t\t"></polygon>\n\n    <polygon fill="#3F2249" points="96.027,284.782 82.901,262.048 96.027,239.313 122.279,239.313 135.404,262.048 122.278,284.782\n\t\t"></polygon>\n\n    <polygon fill="#EF7B1B"\n             points="54.578,260.85 41.452,238.116 54.578,215.381 80.829,215.381 93.955,238.116 80.829,260.85 \t"></polygon>\n\n    <polygon fill="#FF066C"\n             points="54.578,308.713 41.452,285.979 54.578,263.244 80.829,263.244 93.954,285.979 80.829,308.713 \t"></polygon>\n\n    <polygon fill="#FFF200"\n             points="13.126,332.646 0,309.913 13.126,287.176 39.377,287.176 52.503,309.913 39.377,332.646 \t"></polygon>\n\n    <polygon id="white" class="selected" fill="#FFFFFF"\n             points="13.127,189.057 0.001,166.323 13.127,143.588 39.379,143.588 52.504,166.323 39.378,189.057 \t"></polygon>\n\n    <polygon fill="#DBCE9A"\n             points="13.127,236.92 0.001,214.186 13.127,191.451 39.378,191.451 52.504,214.186 39.378,236.92 \t"></polygon>\n\n    <polygon fill="#458C65"\n             points="13.126,284.783 0,262.049 13.126,239.313 39.378,239.313 52.503,262.049 39.377,284.783 \t"></polygon>\n  </g>\n</g>\n\n</g>\n\n</g>\n\n\n<g class="menu">\n  <polygon fill="#282828" points="13.128,508.477 0.002,485.742 13.128,\n  463.007 39.379,463.007 52.505,485.742\n  39.379,508.477 "></polygon>\n  <polygon opacity="0" class="hitbox" fill="#FFFFFF" stroke="#000000"\n           points="98.732,\n    464.13 84.556,\n  439.577 56.924,439.577 43.106,415.645 14.756,415.645\n  0.58,440.199 14.396,464.129 0.58,488.061 14.756,512.614 42.388,512.614 56.206,536.545 84.556,536.545 98.732,511.993\n  84.916,488.061 "></polygon>\n\n  <g class="menu-buttons">\n\n    <g class="active" id="life">\n\n      <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n    484.546 41.452,461.812 54.578,439.076 80.829,439.076 93.955,461.812\n  80.829,484.546 "></polygon>\n\n    </g>\n\n    <g id="dark">\n\n      <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="54.578,\n    532.408 41.452,509.674 54.578,486.938 80.829,486.938 93.955,509.674\n  80.829,532.408 "></polygon>\n\n    </g>\n\n    <polygon class="hex" fill="rgba(255, 255, 255, 0.4)" points="13.128,\n    460.614 0.002,\n    437.88 13.128,415.145 39.379,415.145 52.505,437.88\n  39.379,460.614 "></polygon>\n\n\n    <text id="capacity" x="27" y="438" text-anchor="middle"\n          font-family="Gotham Bold"\n          font-size="11" dominant-baseline="middle"\n          fill="#000">\n    </text>\n  </g>\n</g>\n</g>\n\n</svg>';
var d={updateCapacity:function(h){document.getElementById("capacity").textContent=Math.round(h*100)+"%"},oncreatemode:function(){},onerasemode:function(){},onreflectmode:function(){},onundo:function(){alert("saved");b.ugcSignals.submit.dispatch()},oncolorchange:function(h){b.ugcSignals.object_changecolor.dispatch(h)},onsmoothup:function(){},onsmoothdown:function(){},onsize:function(){},onlife:function(){},ondark:function(){}};this.__defineGetter__("HANDLERS",function(){return d});var f=function(h,
j){(typeof h=="string"?document.getElementById(h):h).addEventListener("mouseup",j,!1)},g=function(h){return document.getElementById(h).getElementsByClassName("bg")[0]};this.addListeners=function(){f("create",function(){this.setAttribute("class","active");document.getElementById("erase").setAttribute("class","");d.oncreatemode()});f("erase",function(){this.setAttribute("class","active");document.getElementById("create").setAttribute("class","");d.onerasemode()});f("life",function(){this.setAttribute("class",
"active");document.getElementById("dark").setAttribute("class","");d.onlife()});f("dark",function(){this.setAttribute("class","active");document.getElementById("life").setAttribute("class","");d.ondark()});f("reflect",function(){if(this.getAttribute("class")=="toggle"){this.setAttribute("class","toggle active");console.log(this);d.onreflectmode(!0)}else{this.setAttribute("class","toggle");d.onreflectmode(!1)}});f("undo",d.onundo);for(var h=document.getElementById("color").getElementsByClassName("options")[0].getElementsByTagName("polygon"),
j=0;j<h.length;j++)f(h[j],function(){for(var n=parseInt(this.getAttribute("fill").substr(1),16),p=0;p<h.length;p++)h[p].setAttribute("class","");this.setAttribute("class","selected");d.oncolorchange(n)});f("smoother-up",d.onsmoothup);f("smoother-down",d.onsmoothdown);var m=function(){g("icon-size-small").setAttribute("class","bg");g("icon-size-med").setAttribute("class","bg");g("icon-size-large").setAttribute("class","bg")};f("icon-size-small",function(){m();g("icon-size-small").setAttribute("class",
"active bg");d.onsize(0)});f("icon-size-med",function(){m();g("icon-size-med").setAttribute("class","active bg");d.onsize(1)});f("icon-size-large",function(){m();g("icon-size-large").setAttribute("class","active bg");d.onsize(2)})};this.scale=function(h){c.firstChild.firstChild.setAttribute("transform","scale("+h+")")};this.getDomElement=function(){return c}},UgcObjectCreator=function(b){function e(){J.setMode(!u?VoxelPainter.MODE_CREATE:VoxelPainter.MODE_ERASE);j()}function c(){J.setMode(VoxelPainter.MODE_IDLE);
j()}function d(){p?J.moveMouse(b.mouse.x/b.viewportWidth,(b.mouse.y-I)/b.viewportHeight):J.moveMouse(b.mouse.x/b.screenWidth,b.mouse.y/b.screenHeight);j()}function f(L){y-=L.wheelDeltaY;j()}function g(L){switch(L.keyCode){case 16:w=!0;break;case 17:u=!0}}function h(L){switch(L.keyCode){case 16:w=!1;break;case 17:u=!1}}function j(){if(w){z+=b.mouse.x/b.screenWidth*2-1;A-=b.mouse.y/b.screenHeight*2-1;A=A>90?90:A<0?0:A}v.position.x=y*Math.sin(z*t)*Math.cos(A*t);v.position.y=y*Math.sin(A*t);v.position.z=
y*Math.cos(z*t)*Math.cos(A*t);J.update();b.renderer.clear();if(p){b.renderer.render(m.scene,v,b.renderTarget,!0);b.renderer.render(J.getScene(),v,b.renderTarget);N.update(0,0,0)}else{b.renderer.render(m.scene,v);b.renderer.render(J.getScene(),v)}}var m=this,n=document.createElement("div"),p=!0,t=Math.PI/180,v,u=!1,w=!1,y=1500,z=45,A=15;v=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,2E4);v.target.position.y=200;m.scene=new THREE.Scene;m.scene.fog=new THREE.FogExp2(16777215,1.75E-4);m.scene.fog.color.setHSV(0.576,
0.382,0.9);var E=new THREE.AmbientLight(2232576),C=new THREE.DirectionalLight(16772829),D=new THREE.DirectionalLight(16772829);E.color.setHSV(0,0,0.1);C.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);C.color.setHSV(0.08823529411764706,0,1);D.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);D.color.setHSV(0,0,0.8647058823529412);m.scene.addLight(E);m.scene.addLight(C);m.scene.addLight(D);m.lensFlare=null;m.lensFlareRotate=null;E=new THREE.Vector3(0,
0,-7500);initLensFlares(m,E,60,292);(new THREE.SceneLoader).load("files/models/dunes/D_tile_1.js",function(L){for(var aa=0,o=L.scene.objects.length;aa<o;aa++){var ja=L.scene.objects[aa];if(ja.visible){ja.rotation.x=-90*Math.PI/180;ja.position.y=-100;ja.position.x=1750;ja.scale.x=ja.scale.y=ja.scale.z=0.5;m.scene.addObject(ja)}}j()});if(!b.renderer){var B=new THREE.WebGLRenderer;B.domElement.style.position="absolute";B.setSize(window.innerWidth,window.innerHeight);B.setClearColor(m.scene.fog.color);
B.sortObjects=!1;B.autoClear=!1;b.renderer=B}if(p){var I=0;b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.baseHeight);if(!b.renderTarget){E=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);E.minFilter=THREE.LinearFilter;E.magFilter=THREE.LinearFilter;b.renderTarget=E}var N=new PaintEffectDunes(b);N.init()}var J=new VoxelPainter(v),K=new UgcHandler;
b.ugcSignals.object_changecolor.add(function(L){J.setColor(L)});b.ugcSignals.submit.add(function(){var L=B.domElement.toDataURL("image/png");K.submitUGO("this is a test","test@tes.com",1,J.getObject().getJSON(),L,function(aa){console.log(aa)})});this.getDomElement=function(){return n};this.show=function(){b.signals.mousedown.add(e);b.signals.mouseup.add(c);b.signals.mousemoved.add(d);b.signals.mousewheel.add(f);b.signals.keydown.add(g);b.signals.keyup.add(h);n.appendChild(b.renderer.domElement);b.renderer.setClearColor(m.scene.fog.color)};
this.hide=function(){b.signals.mousedown.remove(e);b.signals.mouseup.remove(c);b.signals.mousemoved.remove(d);b.signals.mousewheel.remove(f);b.signals.keydown.remove(g);b.signals.keyup.remove(h)};this.resize=function(L,aa){if(p){v.aspect=b.viewportWidth/b.viewportHeight;v.updateProjectionMatrix();b.viewportWidth=b.baseWidth*(L/b.baseWidth);b.viewportHeight=b.baseHeight*(L/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.viewportHeight);b.renderTarget.width=b.viewportWidth;b.renderTarget.height=b.viewportHeight;
delete b.renderTarget.__webglFramebuffer;I=(aa-b.viewportHeight)/2;b.renderer.domElement.style.left="0px";b.renderer.domElement.style.top=I+"px"}else{v.aspect=L/aa;v.updateProjectionMatrix();b.renderer.setSize(L,aa)}};this.update=function(){}},UgcSoupCreator=function(){var b;domElement=document.createElement("div");b=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);b.position.z=6E3;this.getDomElement=function(){return(void 0).domElement};this.show=function(){};this.hide=function(){};
this.resize=function(e,c){b.aspect=e/c;b.updateProjectionMatrix();(void 0).setSize(e,c)};this.update=function(){(void 0).clear();(void 0).render(void 0,b)}},VoxelPainter=function(b){function e(N){return Math.round(N/d)}function c(N){var J=e(N.x),K=e(N.y);N=e(N.z);if(!h.checkVoxel(J,K,N)){h.addVoxel(J,K,N,f);var L=new THREE.Mesh(y,new THREE.MeshLambertMaterial({color:f}));L.position.x=J*d;L.position.y=K*d;L.position.z=N*d;L.matrixAutoUpdate=!1;L.updateMatrix();L.update();D.addObject(L)}}var d=50,f=
16777215,g=VoxelPainter.MODE_IDLE,h=new UgcObject,j,m,n=new THREE.Scene,p=new THREE.AmbientLight(2232576),t=new THREE.DirectionalLight(16772829),v=new THREE.DirectionalLight(16772829);p.color.setHSV(0,0,0.1);t.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);t.color.setHSV(0.08823529411764706,0,1);v.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);v.color.setHSV(0,0,0.8647058823529412);n.addLight(p);n.addLight(t);n.addLight(v);var u=new THREE.Scene;n.addObject(u);
var w=new THREE.Object3D;w.visible=!1;var y=new THREE.Plane(2E3,2E3,16,16);p=new THREE.MeshBasicMaterial({color:0,opacity:0.2,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(y,p);_plane.doubleSided=!0;_plane.visible=w.visible;w.addChild(_plane);_plane=new THREE.Mesh(y,p);_plane.rotation.y=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=w.visible;w.addChild(_plane);w.matrixAutoUpdate=!1;u.addObject(w);var z,A,E,C;z=new THREE.Projector;A=new THREE.Vector3(0,0,0.5);C=new THREE.Ray(b.position,
null);var D=new THREE.Scene;n.addObject(D);var B=new THREE.Mesh(new THREE.Plane(2E3,2E3,40,40),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparency:!0,wireframe:!0}));B.position.x=-25;B.position.y=-25;B.position.z=-25;B.rotation.x=-90*Math.PI/180;D.addObject(B);y=new THREE.Cube(d,d,d);var I=new THREE.Mesh(y,new THREE.MeshLambertMaterial({color:f,opacity:0,transparent:!0}));I.matrixAutoUpdate=!1;n.addObject(I);c(new THREE.Vector3);this.setColor=function(N){f=N;I.materials[0].color.setHex(f)};
this.setMode=function(N){g=N};this.moveMouse=function(N,J){A.x=N*2-1;A.y=-J*2+1;E=z.unprojectVector(A.clone(),b);C.direction=E.subSelf(b.position).normalize()};this.update=function(){var N;switch(g){case VoxelPainter.MODE_IDLE:N=C.intersectScene(D);if(N.length>0){m=N[0].object;j=N[0].face;I.materials[0].opacity=0.5;w.position.copy(m.matrixRotationWorld.multiplyVector3(j.centroid.clone()).addSelf(m.position));w.position.addSelf(m.matrixRotationWorld.multiplyVector3(j.normal.clone()));w.updateMatrix();
w.update();I.position.copy(w.position);I.position.x=e(I.position.x)*d;I.position.y=e(I.position.y)*d;I.position.z=e(I.position.z)*d;I.updateMatrix();I.update()}else{I.materials[0].opacity=0;j=m=null}break;case VoxelPainter.MODE_CREATE:I.materials[0].opacity=0;N=C.intersectScene(u);if(j&&N.length>0){var J=N[0].point;N=m.matrixRotationWorld.multiplyVector3(j.centroid.clone()).addSelf(m.position);J=N.distanceTo(J);N=N.addSelf(m.matrixRotationWorld.multiplyVector3(j.normal.clone()).multiplyScalar(J));
c(N)}break;case VoxelPainter.MODE_ERASE:N=C.intersectScene(D);if(N.length>0&&N[0].object!=B){N=N[0].object;J=e(N.position.x);var K=e(N.position.y),L=e(N.position.z);h.removeVoxel(J,K,L);D.removeObject(N);n.removeObject(N)}}};this.getScene=function(){return n};this.getObject=function(){return h}};VoxelPainter.MODE_IDLE="VoxelPainter.MODE_IDLE";VoxelPainter.MODE_CREATE="VoxelPainter.MODE_CREATE";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var emiBuyButtonUrl="http://widgets.platform.emi.com/widget/1.0/",emiBuyButtonUuids=["c9e456919b824bdeb2e3a326b122db43"],gaJsHost="https:"==document.location.protocol?"https://ssl.":"http://www.";document.write(unescape("%3Cscript src='"+gaJsHost+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));document.writeln(unescape("%3Cscript src='"+emiBuyButtonUrl+"js/emi_buy_button.js' type='text/javascript'%3E%3C/script%3E"));
function Footer(b,e){var c=e||"files/footer";this.id=Footer.multipleInstances;var d="rome_footer_buy_album-"+this.id;this.getDomElement=function(){return b};window.addEventListener("load",function(){EMIBuyButton&&(new EMIBuyButton({buttonID:"c9e456919b824bdeb2e3a326b122db43",buttonImageUrl:c+"/buy_button-trans.png",useVendorImages:!0})).replaceDiv(d);return this},!1);var f="";f+='<div class = "rome-footer">';f+='<div class = "shout-out">';f+="  <ul>";f+='    <li><a href = "http://chromeexperiments.com/"><img src = "'+
c+'/chrome-trans.png" alt = "This is a Chrome Experiment" border = "0" /></a></li>';f+='    <li class = "divider">&nbsp;</li>';f+='    <li><a href = "http://google.com/"><img src = "'+c+'/google-trans.png" alt = "Made With Friends From Google" border = "0" /></a></li>';f+='    <li class = "clear">&nbsp;</li>';f+="  </ul>";f+="</div>";f+="";f+='<div class = "navigation">';f+='  <ul class = "primary">';f+='    <li class = "first"><a href = "http://ro.me/tech">Technology</a></li>';f+='    <li><a href = "http://ro.me/credits">Credits</a></li>';
f+='    <li><a href = "http://ro.me/album">Rome Album</a></li>';f+='    <li id = "'+d+'" class = "rome_footer_buy_album">';f+="    </li>";f+='    <li class = "last">Share</li>';f+='    <li class = "last icons"><a href="http://www.facebook.com/sharer.php?u=http://ro.me" target="_blank"><img src = "'+c+'/fb-trans.png" alt = "facebook" border = "0"  /></a></li>';f+='    <li class = "last icons"><a href="http://twitter.com/share?text=\u201cROME\u201d&amp;url=http://ro.me" target="_blank"><img src = "'+
c+'/twitter-trans.png" alt = "twitter" border = "0" /></a></li>';f+='    <li class = "clear last">&nbsp;</li>';f+="  </ul>";f+='  <ul class = "secondary">';f+='    <li class = "first"><a href = "http://ro.me/terms">Terms</a></li>';f+='    <li class = "last"><a href = "http://ro.me/privacy">Privacy</a></li>';f+='    <li class = "clear last">&nbsp;</li>';f+="  </ul>";f+="</div>";f+='<div class = "clear">&nbsp;</div>';f+="</div>";f+="</div>";var g="";g+=".rome-footer * {";g+="  margin: 0;";g+="  padding: 0;";
g+="}";g+=".rome-footer {";g+='  font: 500 10px/18px "Futura", Arial, sans-serif;';g+="  color: #434343;";g+="  text-transform: uppercase;";g+="  letter-spacing: 1px;";g+="}";g+=".rome-footer .shout-out {";g+="  float: left;";g+="  margin: 0 0 0 18px;";g+="}";g+=".rome-footer .navigation {";g+="  float: right;";g+="  margin: 20px 26px 0 0;";g+="  vertical-align: middle;";g+="}";g+=".rome-footer ul li {";g+="  height: 16px;";g+="  border-right: 1px solid #a0a0a0;";g+="  padding: 0 10px 0 10px;";g+=
"  width: auto;";g+="  float: left;";g+="  list-style: none;";g+="}";g+=".rome-footer ul li.last,";g+=".rome-footer ul li.last li {";g+="  border: none;";g+="  padding: 0 0 0 10px;";g+="}";g+=".rome-footer .shout-out ul li {";g+="  margin: 0;";g+="  border: 0;";g+="}";g+=".rome-footer .shout-out li.divider {";g+="  margin: 15px 0 15px 15px;";g+="  height: 24px;";g+="  border-left: 1px solid #a0a0a0;";g+="}";g+=".rome-footer a img {";g+="  border: 0;";g+="}";g+=".rome-footer .secondary a:link, .rome-footer .secondary a:visited {";
g+="  color: #777;";g+="}";g+=".rome-footer a:link, .rome-footer a:visited,";g+=".rome-footer .secondary a:hover, .rome-footer .secondary a:active {";g+="  color: #434343;";g+="  text-decoration: none;";g+="}";g+=".rome-footer a:hover, .rome-footer a:active {";g+="  color: #000;";g+="}";g+=".emi_buy_button_link {";g+="  margin-top: 2px;";g+="  height: 8px;";g+="  line-height: 8px;";g+="  overflow: hidden;";g+="}";g+=".rome-footer .rome_footer_buy_album img {";g+="  display: block;";g+="  margin-top: 0;";
g+="}";g+=".rome-footer .rome_footer_buy_album a:hover img {";g+="  margin-top: -8px;";g+="}";g+=".emi_vendor_menu.using_image a:hover img {";g+="  margin-top: 0;";g+="}";g+=".emi_vendor_menu.using_image {";g+="  margin-top: -145px;";g+="  margin-left: -11px;";g+="  padding: 10px;";g+="}";g+=".emi_vendor_menu.using_image * {";g+="  text-transform: none;";g+="}";g+=".emi_vendor_menu.using_image .emi_vendor_link {";g+="  margin-top: 5px;";g+="}";g+=".rome-footer .secondary {";g+="  margin: 10px 0 0 0;";
g+="  float: right;";g+="}";g+=".clear {";g+="  clear: both;";g+="  display: block;";g+="  overflow: hidden;";g+="  visibility: hidden;";g+="  width: 0;";g+="  height: 0;";g+="}";b.innerHTML=f;if(Footer.multipleInstances<1){f=document.createTextNode(g);g=document.getElementsByTagName("head")[0];var h=document.createElement("style");if(h.stylesheet)h.styleSheet.cssText=f.nodeValue;else h.appendChild(f);g.appendChild(h)}Footer.multipleInstances++}Footer.multipleInstances=0;
var Shortcuts=function(b){function e(){var h=document.createElement("span");h.innerHTML=" ";g.appendChild(h)}function c(h,j){var m=document.createElement("span");m.style.cursor="pointer";m.style.padding="0.5em";m.style.marginRight="4px";m.style.background="rgba(255,255,255,0.15)";m.innerHTML=h;m.addEventListener("click",j,!1);g.appendChild(m)}function d(h,j){c(h,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(j,1)})}function f(h,j){c(h,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(j)})}var g=document.createElement("div");g.style.position="absolute";g.style.left="0px";g.style.top="0px";g.style.padding="0.5em";g.style.fontSize="10px";(function(h){c(h,function(){b.signals.showlauncher.dispatch()})})("Launcher");e();d("Intro",0);e();d("Transition to City",8);d("City",16);e();d("Transition to Prairie",24);d("Prairie",32);e();d("Transition to Dunes",40);d("Dunes",48);e();(function(h){c(h,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
e();f("Explore City","city");f("Explore Prairie","prairie");f("Explore Dunes","dunes");e();(function(h){c(h,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return g}};
(function(){function b(y){j&&j.hide();if(!y.__loaded){y.load();y.__loaded=!0}y.resize(window.innerWidth,window.innerHeight);y.show();j=y}function e(y){if(!y.gamma&&!y.beta){y.gamma=-(y.x*(180/Math.PI));y.beta=-(y.y*(180/Math.PI))}else if(y.alpha==null&&y.beta==null&&y.gamma==null){window.removeEventListener("deviceorientation",e,!1);window.removeEventListener("MozOrientation",e,!1)}var z=Math.abs(y.gamma)>4||Math.abs(y.beta)>4,A=z?y.gamma:0;z=z?y.beta:0;if(w!=A||u!=z){var E=Math.round(1.5*A)+g.mouse.x,
C=-Math.round(1.5*z)+g.mouse.y;Math.abs(E)>window.innerWidth&&(E=E<0?-window.innerWidth:window.innerWidth);Math.abs(C)>window.innerHeight&&(C=C<0?-window.innerHeight:window.innerHeight);g.mouse.x=E;g.mouse.y=C;w=A;u=z;g.signals.mousemoved.dispatch(y)}}function c(){requestAnimationFrame(c);d.clear();j.update();f.update()}var d,f,g,h=signals.Signal,j,m,n,p,t,v,u=0,w=0;d=new Logger;d.domElement.style.position="fixed";d.domElement.style.right="100px";d.domElement.style.top="0px";document.body.appendChild(d.domElement);
f=new Stats;f.domElement.style.position="fixed";f.domElement.style.right="0px";f.domElement.style.top="0px";document.body.appendChild(f.domElement);g={logger:d,mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,signals:{mousedown:new h,mouseup:new h,mousemoved:new h,mousewheel:new h,keydown:new h,keyup:new h,windowresized:new h,load:new h,showlauncher:new h,showfilm:new h,showrelauncher:new h,showexploration:new h,showugc:new h,loadBegin:new h,loadItemAdded:new h,loadItemCompleted:new h,
startfilm:new h,stopfilm:new h,startexploration:new h,initscenes:new h},worlds:{},sequences:{},started:{city:!1,prairie:!1,dunes:!1}};m=new LauncherSection(g);document.body.appendChild(m.getDomElement());p=new RelauncherSection(g);document.body.appendChild(p.getDomElement());v=new UgcSection(g);document.body.appendChild(v.getDomElement());h=new Shortcuts(g);document.body.appendChild(h.getDomElement());g.signals.load.add(function(){g.signals.loadBegin.dispatch();n=new FilmSection(g);document.body.appendChild(n.getDomElement());
t=new ExplorationSection(g);document.body.appendChild(t.getDomElement());g.signals.showfilm.add(function(){b(n)});g.signals.showexploration.add(function(){b(t)})});g.signals.showlauncher.add(function(){b(m)});g.signals.showrelauncher.add(function(){b(p)});g.signals.showugc.add(function(){b(v)});document.addEventListener("mousedown",function(y){g.signals.mousedown.dispatch(y);y.preventDefault();y.stopPropagation()},!1);document.addEventListener("mouseup",function(y){g.signals.mouseup.dispatch(y);y.preventDefault();
y.stopPropagation()},!1);document.addEventListener("mousemove",function(y){g.mouse.x=y.clientX;g.mouse.y=y.clientY;g.signals.mousemoved.dispatch(y)},!1);document.addEventListener("mousewheel",function(y){g.signals.mousewheel.dispatch(y)},!1);document.addEventListener("keydown",function(y){g.signals.keydown.dispatch(y)},!1);document.addEventListener("keyup",function(y){g.signals.keyup.dispatch(y)},!1);window.addEventListener("deviceorientation",e,!1);window.addEventListener("MozOrientation",e,!1);
window.addEventListener("resize",function(){j.resize(window.innerWidth,window.innerHeight);g.screenWidth=window.innerWidth;g.screenHeight=window.innerHeight;g.signals.windowresized.dispatch()},!1);b(m);c()})();
