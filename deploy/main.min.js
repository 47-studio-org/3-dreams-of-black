var console=console||function(){};
function HandleErrors(b){function e(m){return navigator.userAgent.match(m)}function c(m){var n=navigator.userAgent.match(/[Cc]hrome\/([0-9]{1,2})/);if(n){n=parseInt(n[1]);return n<=m}else return!1}var d=this,f=b||"/alternate",g=!1;Trailer="<ul id = 'trailer'><li class = 'first'><a href = 'http://www.youtube.com/watch?v=ReH7zzj5GPc'>Watch the Trailer</a></li><li><a href = 'http://romealbum.com/'>Rome Album</a></li><li class = 'last'><a href = '/tech'>The Technology</a></li><li class = 'clear'></li></ul>";this.MagicVariable=
"case";this.Errors=["We are very sorry, but &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears that your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards."+Trailer,"Apologies for the tech trouble. &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears your computer&#39;s graphics card doesn&#39;t support WebGL in Mozilla Firefox. We recommend you try it in <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>Google Chrome</a>. You can also find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards."+
Trailer,"We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again. If you are unable to install a new web browser, you can try downloading the <a href = 'http://www.google.com/chromeframe'>Google Chrome Frame plugin</a> instead.","We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again.",
"We are sorry, but it appears that your browser does not support WebGL. &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>Google Chrome</a> in mind. Please try launching this site again on a computer with up-to-date graphics drivers. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site, and learn more about WebGL technology."+
Trailer,"This project is very experimental. With your current configuration, you may experience problems such as video flickering, so you may want to try this in Chrome Canary, the cutting-edge experimental version of Google Chrome. Download Google Chrome Canary <a href = 'http://tools.google.com/dlpage/chromesxs?platform=win'>here</a>, or <a id = 'escape-from-warning' href = '#'>try the experience anyway</a>.","We&#39;re sorry, but &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. As a result, it may not work perfectly in your current browser. For the best viewing experience, you can <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and launch this site again, or go ahead and <a id = 'escape-from-warning' href = '#'>try it anyway</a>.",
"You appear to be running an older version of Chrome. Please click on the wrench icon on the browser toolbar, and select 'Update Google Chrome' before viewing ROME."];this.getUrlVars=function(){for(var m=null,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),h=0;h<n.length;h++){var o=n[h].split("=");if(o.length==2){var t=o[0];o=o[1];if(t&&o){m==null&&(m={});m[t]=o}}}return m};this.checkForErrors=function(){var m;try{m=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(n){m=
!1}m={webgl:m,conditions:[e(/[cC]hrome/),e(/[Ff]ire[Ff]ox\/[4-9]/),e(/[Mm][Ss][Ii][Ee] [789]/)&&e(/[Ww]indows [Nn][Tt] [6789]/),e(/[Ss]afari/)&&e(/[Mm]ac [Oo][Ss] [Xx] 10\_[6789]/),e(/i[Pp]hone/)||e(/i[Pp]ad/)||e(/[Aa]ndroid/)],message:""};if(m.webgl)if(m.conditions[1]){window.addEventListener("load",function(){var o=document.getElementById("ui-container");if(o)o.style.display="none";var t=document.createElement("div"),u=document.createElement("div");o=document.createElement("div");o.setAttribute("id",
"rome-error");var v=document.createElement("style");v.innerHTML="a { color: #fff; }";document.getElementsByTagName("head")[0].appendChild(v);t.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");u.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");o.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; color: #fff; line-height: 18px !important; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");
o.innerHTML=d.Errors[6];var w=function(){u.style.left=(window.innerWidth-400)/2+"px";u.style.top=window.innerHeight/2+"px"},x=function(){document.body.removeChild(t);document.body.removeChild(u);window.removeEventListener("resize",w,!1);LauncherSection.showUI();localStorage.setItem("RomeError",!0)};t.addEventListener("click",function(){x()},!1);window.addEventListener("resize",w,!1);u.appendChild(o);document.body.appendChild(t);document.body.appendChild(u);document.getElementById("escape-from-warning").addEventListener("click",
function(y){y.preventDefault();x()},!1)},!1);HandleErrors.isWebGLAndBeta=!0}else{if(e(/[Ww]indows/)&&c(11))if(c(10))window.location=f+"?"+this.MagicVariable+"=7";else{window.addEventListener("load",function(){var o=document.getElementById("ui-container");if(o)o.style.display="none";var t=document.createElement("div"),u=document.createElement("div");o=document.createElement("div");o.setAttribute("id","rome-error");var v=document.createElement("style");v.innerHTML="a { color: #fff; }";document.getElementsByTagName("head")[0].appendChild(v);
t.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");u.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");o.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; color: #fff; line-height: 18px; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");o.innerHTML=d.Errors[5];
var w=function(){u.style.left=(window.innerWidth-400)/2+"px";u.style.top=window.innerHeight/2+"px"},x=function(){document.body.removeChild(t);document.body.removeChild(u);window.removeEventListener("resize",w,!1);LauncherSection.showUI();localStorage.setItem("RomeError",!0)};t.addEventListener("click",function(){x()},!1);window.addEventListener("resize",w,!1);u.appendChild(o);document.body.appendChild(t);document.body.appendChild(u);document.getElementById("escape-from-warning").addEventListener("click",
function(y){y.preventDefault();x()},!1)},!1);HandleErrors.isWebGLAndBeta=!0}}else{for(var h=0;h<m.conditions.length;h++)if(m.conditions[h]){window.location=f+"?"+this.MagicVariable+"="+h;g=!0;break}if(!g)window.location=f+"?"+this.MagicVariable+"="+(m.conditions.length-1)}}}HandleErrors.isWebGLAndBeta=!1;var romeErrors=new HandleErrors,variables=romeErrors.getUrlVars();
if(variables)variables[romeErrors.MagicVariable]&&(window.addEventListener?window.addEventListener("load",function(){var b=variables[romeErrors.MagicVariable],e=document.getElementById("error");b>romeErrors.Errors.length&&(b=4);e.innerHTML='<p style="line-height: 18px !important;">'+romeErrors.Errors[b]+"</p>"},!1):window.attachEvent("load",function(){var b=variables[romeErrors.MagicVariable],e=document.getElementById("error");b>romeErrors.Errors.length&&(b=4);e.innerHTML='<p style="line-height: 18px !important;">'+
romeErrors.Errors[b]+"</p>";return!1}));else romeErrors.checkForErrors();
var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b(Q,M,da){var ka,$,ha;for($=0;$<30;$++)for(ka=0;ka<73;ka++){ha=(ka+$*74)*4;Q[ha]=Q[ha+4];Q[ha+1]=Q[ha+5];Q[ha+2]=Q[ha+6]}for($=0;$<30;$++){ha=(73+$*74)*4;if($<M){Q[ha]=G[da].bg.r;Q[ha+1]=G[da].bg.g;Q[ha+2]=G[da].bg.b}else{Q[ha]=G[da].fg.r;Q[ha+1]=G[da].fg.g;Q[ha+2]=G[da].fg.b}}}var e=0,c=2,d,f=0,g=(new Date).getTime(),m=g,n=g,h=0,o=1E3,t=0,u,v,w,x,y,C=0,B=1E3,H=0,z,E,F,D,T=0,W=1E3,U=0,Y,N,p,O,G={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,
g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};d=document.createElement("div");d.style.cursor="pointer";d.style.width="80px";d.style.opacity="0.9";d.style.zIndex="10001";d.addEventListener("click",function(){e++;e==c&&(e=0);u.style.display="none";z.style.display="none";Y.style.display="none";switch(e){case 0:u.style.display="block";break;case 1:z.style.display="block";break;case 2:Y.style.display="block"}},!1);u=document.createElement("div");u.style.backgroundColor="rgb("+Math.floor(G.fps.bg.r/
2)+","+Math.floor(G.fps.bg.g/2)+","+Math.floor(G.fps.bg.b/2)+")";u.style.padding="2px 0px 3px 0px";d.appendChild(u);v=document.createElement("div");v.style.fontFamily="Helvetica, Arial, sans-serif";v.style.textAlign="left";v.style.fontSize="9px";v.style.color="rgb("+G.fps.fg.r+","+G.fps.fg.g+","+G.fps.fg.b+")";v.style.margin="0px 0px 1px 3px";v.innerHTML='<span style="font-weight:bold">FPS</span>';u.appendChild(v);w=document.createElement("canvas");w.width=74;w.height=30;w.style.display="block";w.style.marginLeft=
"3px";u.appendChild(w);x=w.getContext("2d");x.fillStyle="rgb("+G.fps.bg.r+","+G.fps.bg.g+","+G.fps.bg.b+")";x.fillRect(0,0,w.width,w.height);y=x.getImageData(0,0,w.width,w.height);z=document.createElement("div");z.style.backgroundColor="rgb("+Math.floor(G.ms.bg.r/2)+","+Math.floor(G.ms.bg.g/2)+","+Math.floor(G.ms.bg.b/2)+")";z.style.padding="2px 0px 3px 0px";z.style.display="none";d.appendChild(z);E=document.createElement("div");E.style.fontFamily="Helvetica, Arial, sans-serif";E.style.textAlign=
"left";E.style.fontSize="9px";E.style.color="rgb("+G.ms.fg.r+","+G.ms.fg.g+","+G.ms.fg.b+")";E.style.margin="0px 0px 1px 3px";E.innerHTML='<span style="font-weight:bold">MS</span>';z.appendChild(E);w=document.createElement("canvas");w.width=74;w.height=30;w.style.display="block";w.style.marginLeft="3px";z.appendChild(w);F=w.getContext("2d");F.fillStyle="rgb("+G.ms.bg.r+","+G.ms.bg.g+","+G.ms.bg.b+")";F.fillRect(0,0,w.width,w.height);D=F.getImageData(0,0,w.width,w.height);try{webkitPerformance&&webkitPerformance.memory.totalJSHeapSize&&
(c=3)}catch(L){}Y=document.createElement("div");Y.style.backgroundColor="rgb("+Math.floor(G.mem.bg.r/2)+","+Math.floor(G.mem.bg.g/2)+","+Math.floor(G.mem.bg.b/2)+")";Y.style.padding="2px 0px 3px 0px";Y.style.display="none";d.appendChild(Y);N=document.createElement("div");N.style.fontFamily="Helvetica, Arial, sans-serif";N.style.textAlign="left";N.style.fontSize="9px";N.style.color="rgb("+G.mem.fg.r+","+G.mem.fg.g+","+G.mem.fg.b+")";N.style.margin="0px 0px 1px 3px";N.innerHTML='<span style="font-weight:bold">MEM</span>';
Y.appendChild(N);w=document.createElement("canvas");w.width=74;w.height=30;w.style.display="block";w.style.marginLeft="3px";Y.appendChild(w);p=w.getContext("2d");p.fillStyle="#301010";p.fillRect(0,0,w.width,w.height);O=p.getImageData(0,0,w.width,w.height);return{domElement:d,update:function(){f++;g=(new Date).getTime();C=g-m;B=Math.min(B,C);H=Math.max(H,C);b(D.data,Math.min(30,30-C/200*30),"ms");E.innerHTML='<span style="font-weight:bold">'+C+" MS</span> ("+B+"-"+H+")";F.putImageData(D,0,0);m=g;if(g>
n+1E3){h=Math.round(f*1E3/(g-n));o=Math.min(o,h);t=Math.max(t,h);b(y.data,Math.min(30,30-h/100*30),"fps");v.innerHTML='<span style="font-weight:bold">'+h+" FPS</span> ("+o+"-"+t+")";x.putImageData(y,0,0);if(c==3){T=webkitPerformance.memory.usedJSHeapSize*9.54E-7;W=Math.min(W,T);U=Math.max(U,T);b(O.data,Math.min(30,30-T/2),"mem");N.innerHTML='<span style="font-weight:bold">'+Math.round(T)+" MEM</span> ("+Math.round(W)+"-"+Math.round(U)+")";p.putImageData(O,0,0)}n=g;f=0}}}},GUI=function(){var b=this,
e=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
e.appendChild(c);var d=[],f=[],g=!0,m,n,h=0;b=this;var o=!1,t=280,u=!1,v,w,x=0,y;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=t+"px";var C=document.createElement("div");C.setAttribute("class","guidat-controllers");C.addEventListener("DOMMouseScroll",function(M){var da=this.scrollTop;if(M.wheelDelta)da+=M.wheelDelta;else M.detail&&(da+=M.detail);M.preventDefault&&M.preventDefault();M.returnValue=!1;C.scrollTop=da},!1);C.style.height=
"0px";var B=document.createElement("a");B.setAttribute("class","guidat-toggle");B.setAttribute("href","#");B.innerHTML="Show Controls";var H=!1,z=0,E=!1,F,D,T,W,U=function(M){D=F;W=T;F=M.pageY;T=M.pageX;M=F-D;if(!o)if(M>0){o=!0;h=v=1;B.innerHTML=w||"Hide Controls"}else return;var da=W-T;if(M>0&&h>n){var ka=GUI.map(h,n,n+100,1,0);M*=ka}H=!0;z+=M;dragDisplacementX+=da;v+=M;t+=da;h+=M;C.style.height=v+"px";t=GUI.constrain(t,240,500);b.domElement.style.width=t+"px";O()};B.addEventListener("mousedown",
function(M){D=F=M.pageY;W=T=M.pageX;E=!0;M.preventDefault();dragDisplacementX=z=0;document.addEventListener("mousemove",U,!1);return!1},!1);B.addEventListener("click",function(M){M.preventDefault();return!1},!1);document.addEventListener("mouseup",function(M){if(E&&!H){b.toggle();b.domElement.style.width=t+1+"px";setTimeout(function(){b.domElement.style.width=t+"px"},1)}if(E&&H){if(dragDisplacementX==0){b.domElement.style.width=t+1+"px";setTimeout(function(){b.domElement.style.width=t+"px"},1)}if(v>
n){clearTimeout(y);v=x=n;L()}else if(C.children.length>=1){var da=C.children[0].offsetHeight;clearTimeout(y);x=Math.round(h/da)*da-1;if(x<=0){b.hide();v=da*2}else{v=x;L()}}}document.removeEventListener("mousemove",U,!1);M.preventDefault();H=!1;E=!1;return!1},!1);this.domElement.appendChild(C);this.domElement.appendChild(B);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var Y=function(){m=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(M){if(g=M)f.length>0&&Y();else clearInterval(m)});this.__defineGetter__("autoListen",function(){return g});this.listenTo=function(M){f.length==0&&Y();f.push(M)};this.unlistenTo=function(M){for(var da=0;da<f.length;da++)f[da]==M&&f.splice(da,1);f.length<=0&&clearInterval(m)};this.listen=function(M){M=M||f;for(var da in M)M[da].updateDisplay()};this.listenAll=function(){this.listen(d)};
this.autoListen=!0;var N=function(M,da){for(var ka in d)if(d[ka].object==M&&d[ka].propertyName==da)return!0;return!1},p=function(M,da){function ka(){return M.apply(this,da)}ka.prototype=M.prototype;return new ka};this.add=function(){var M=arguments[0],da=arguments[1];N(M,da);var ka=M[da];if(ka==undefined)GUI.error(M+' either has no property "'+da+'", or the property is inaccessible.');else{M=typeof ka;ka=G[M];if(ka==undefined)GUI.error('Cannot create controller for data type "'+M+'"');else{for(var $=
[this],ha=0;ha<arguments.length;ha++)$.push(arguments[ha]);if(ka=p(ka,$)){C.appendChild(ka.domElement);d.push(ka);GUI.allControllers.push(ka);if(M!="function"&&GUI.saveIndex<GUI.savedValues.length){ka.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}O();u||(v=n);return ka}else GUI.error('Error creating controller for "'+da+'".')}}};var O=function(){n=0;for(var M in d)n+=d[M].domElement.offsetHeight;C.style.overflowY=n-1>v?"auto":"hidden"},G={number:GUI.NumberController,string:GUI.StringController,
"boolean":GUI.BooleanController,"function":GUI.FunctionController};N=function(M,da){for(var ka in d)if(d[ka].object==M&&d[ka].propertyName==da)return!0;return!1};p=function(M,da){function ka(){return M.apply(this,da)}ka.prototype=M.prototype;return new ka};this.reset=function(){};this.toggle=function(){o?this.hide():this.show()};this.show=function(){B.innerHTML=w||"Hide Controls";x=v;clearTimeout(y);L();o=!0};this.hide=function(){B.innerHTML=w||"Show Controls";x=0;clearTimeout(y);L();o=!1};this.name=
function(M){w=M;B.innerHTML=M};this.appearanceVars=function(){return[o,t,v,C.scrollTop]};var L=function(){h+=(x-h)*0.6;if(Math.abs(h-x)<1)h=x;else y=setTimeout(L,1E3/30);C.style.height=Math.round(h)+"px";O()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){t=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=t+"px";v=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);u=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){h=v;var Q=GUI.savedAppearanceVars[GUI.guiIndex][3];
setTimeout(function(){C.scrollTop=Q},0);if(GUI.scrollTop>-1)document.body.scrollTop=GUI.scrollTop;x=v;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var e=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<e;c++){var d=b.splice(2,4);GUI.savedAppearanceVars.push(d)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var e in GUI.allGuis)for(var c=GUI.allGuis[e].appearanceVars(),d=0;d<c.length;d++)b.push(c[d]);for(e in GUI.allControllers)if(GUI.allControllers[e].type!="function"){c=GUI.allControllers[e].getValue();GUI.allControllers[e].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var e,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){e=c[d].split("=");if(e!=undefined&&e[0]==b)return e[1]}return null};
GUI.replaceGetVar=function(b,e){for(var c,d=window.location.href,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<f.length;g++){c=f[g].split("=");if(c!=undefined&&c[0]==b)return d.replace(c[1],e)}if(window.location.href.indexOf("?")!=-1)return d+"&"+b+"="+e;return d+"?"+b+"="+e};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,e,c,d,f){return d+(f-d)*((b-e)/(c-e))};GUI.constrain=function(b,e,c){if(b<e)b=e;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,e){var c=Math.pow(10,e);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,e,c,d,f){var g=!1,m=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(h){this.fg.style.width=GUI.map(h,e,c,0,100)+"%"});var n=function(h){if(g){var o;o=m.domElement;var t=curtop=0;if(o.offsetParent){do{t+=o.offsetLeft;curtop+=o.offsetTop}while(o=o.offsetParent);
o=[t,curtop]}else o=void 0;h=GUI.map(h.pageX,o[0],o[0]+m.domElement.offsetWidth,e,c);h=Math.round(h/d)*d;b.setValue(h)}};this.domElement.addEventListener("mousedown",function(h){g=!0;m.domElement.setAttribute("class","guidat-slider-bg active");m.fg.setAttribute("class","guidat-slider-fg active");n(h)},!1);document.addEventListener("mouseup",function(){m.domElement.setAttribute("class","guidat-slider-bg");m.fg.setAttribute("class","guidat-slider-fg");g=!1},!1);document.addEventListener("mousemove",
n,!1);this.value=f};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var e=document.createElement("input"),c=this.getValue();e.setAttribute("value",c);e.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){e.focus();e.select()},!1);e.addEventListener("keyup",function(){b.setValue(e.value)},!1);this.updateDisplay=function(){e.value=b.getValue()};this.domElement.appendChild(e)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,e=!1,c=!1,d=py=0,f=arguments[3],g=arguments[4],m=arguments[5];m||(m=f!=undefined&&g!=undefined?(g-f)*0.01:1);var n=document.createElement("input");n.setAttribute("id",this.propertyName);n.setAttribute("type","text");n.setAttribute("value",this.getValue());m&&n.setAttribute("step",m);this.domElement.appendChild(n);var h;if(f!=undefined&&g!=undefined){h=new GUI.Slider(this,f,g,m,this.getValue());this.domElement.appendChild(h.domElement)}n.addEventListener("blur",
function(){var t=parseFloat(this.value);if(isNaN(t))this.value=b.getValue();else b.updateDisplay()},!1);n.addEventListener("mousewheel",function(t){t.preventDefault();b.setValue(b.getValue()+Math.abs(t.wheelDeltaY)/t.wheelDeltaY*m);return!1},!1);n.addEventListener("mousedown",function(t){py=d=t.pageY;c=!0;document.addEventListener("mousemove",o,!1)},!1);n.addEventListener("keydown",function(t){switch(t.keyCode){case 38:t=b.getValue()+m;b.setValue(t);break;case 40:t=b.getValue()-m;b.setValue(t)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",o,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(n);if(c&&!e){n.focus();n.select()}e=!1;c=!1},!1);var o=function(t){e=!0;t.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(n);py=d;d=t.pageY;t=py-d;t=b.getValue()+t*m;b.setValue(t);return!1};this.setValue=function(t){t=parseFloat(t);if(f!=undefined&&t<=f)t=f;else g!=undefined&&t>=g&&(t=g);return GUI.Controller.prototype.setValue.call(this,
t)};this.updateDisplay=function(){n.value=GUI.roundToDecimal(b.getValue(),4);if(h)h.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,e=document.createElement("input");e.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){e.checked=!e.checked;c.preventDefault();b.setValue(e.checked)},!1);e.addEventListener("mouseup",function(){e.checked=!e.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(e);this.updateDisplay=function(){e.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(d){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);var DAT=DAT||{};
DAT.Color=function(){function b(){var h=DAT.color.rgba_to_hsva(g.r,g.g,g.b,g.a),o;for(o in h)isNaN(h[o])||(m[o]=h[o])}function e(h){var o=DAT.color["hex"+DAT.color.prefix_substitute+h];d.__defineGetter__(h,function(){return g[h]});d.__defineSetter__(h,function(t){if(typeof t!="number")throw DAT.color.InvalidArgumentException;g[h]=t;g.hex!=undefined&&console.log("wtf");f=o.call(d,f,t);b()})}function c(h){d.__defineSetter__(h,function(o){if(typeof o!="number")throw DAT.color.InvalidArgumentException;
isNaN(o)||(m[h]=o);g=DAT.color.hsva_to_rgba(m.h,m.s,m.v,g.a);g.hex!=undefined&&console.log("wtf");f=DAT.color.rgba_to_hex(g.r,g.g,g.b,g.a)});d.__defineGetter__(h,function(){return m[h]})}var d=this,f=DAT.color.args_to_hex(arguments),g={},m={};if(arguments.length==1&&DAT.color.has_rgba_props(arguments[0])){g.r=arguments[0].r;g.g=arguments[0].g;g.b=arguments[0].b;g.a=arguments[0].a}else if(arguments.length==1&&DAT.color.has_rgb_props(arguments[0])){g.r=arguments[0].r;g.g=arguments[0].g;g.b=arguments[0].b;
g.a=DAT.color.bounds.a}else g=DAT.color.hex_to_rgba(f);if(arguments.length==1&&arguments[0]instanceof DAT.Color){m.h=arguments[0].h;m.s=arguments[0].s;m.v=arguments[0].v}else b();this.__defineSetter__("hex",function(h){f=h;g=DAT.color.hex_to_rgba(f);b()});this.__defineGetter__("hex",function(){return f});this.toString=function(){return DAT.color.hex_to_string(f)};for(var n=0;n<4;n++)e("argb"[n]);for(n=0;n<3;n++)c("hsv"[n])};DAT.color={};
(function(b){function e(f){var g="bgra"[f],m=f*8;b["hex"+b.prefix_component+g]=function(n){return(n>>m&255)/255*b.bounds[g]};b["hex"+b.prefix_substitute+g]=function(n,h){h=h/b.bounds[g]*255;return h<<m|n&~(255<<m)}}function c(f){b["hex"+b.prefix_component+f]=function(g){g=b.hex_to_rgba(g);return b.rgba_to_hsva(g.r,g.g,g.b,g.a)[f]};b["hex"+b.prefix_substitute+f]=function(g,m){var n=b.hex_to_rgba(g);n=b.rgba_to_hsva(n.r,n.g,n.b,n.a);n[f]=m;n=b.hsva_to_rgba(n.h,n.s,n.v,n.a);return b.rgba_to_hex(n.r,
n.g,n.b,n.a)}}b.prefix_component="_to_";b.prefix_substitute="_with_";b.InvalidArgumentException="Invalid argument.";b.bounds={a:1,r:255,g:255,b:255,h:360,s:100,v:100};b.rgb=function(f,g,m,n){return b.rgba(f,g,m,n||b.bounds.a)};b.rgba=function(f,g,m,n){return new DAT.Color(f,g,m,n||b.bounds.a)};b.hsv=function(f,g,m,n){return b.hsva(f,g,m,n||b.bounds.a)};b.hsva=function(f,g,m,n){f=b.hsva_to_rgba(f,g,m,n||b.bounds.a);return new DAT.Color(f.r,f.g,f.b,f.a)};b.args_to_hex=function(f){return f.length==0?
0:f.length==1?typeof f[0]=="number"?f[0]:typeof f[0]=="array"?b.rgba_to_hex(f[0][0],f[0][1],f[0][2],f[0][3]):typeof f[0]=="object"&&b.has_rgba_props(f[0])?b.rgba_to_hex(f[0].r,f[0].g,f[0].b,f[0].a):typeof f[0]=="object"&&b.has_rgb_props(f[0])?b.rgba_to_hex(f[0].r,f[0].g,f[0].b):0:f.length==3?b.rgb_to_hex(f[0],f[1],f[2]):f.length==4?b.rgba_to_hex(f[0],f[1],f[2],f[3]):0};b.hsva_to_rgba=function(f,g,m,n){f=isNaN(f)?0:f;f=f/b.bounds.h*360;g/=b.bounds.s;m/=b.bounds.v;n=n||b.bounds.a;var h=f/60-Math.floor(f/
60),o=m*(1-g),t=m*(1-h*g);g=m*(1-(1-h)*g);f=[[m,g,o],[t,m,o],[o,m,g],[o,t,m],[g,o,m],[m,o,t]][Math.floor(f/60)%6];return{r:f[0]*b.bounds.r,g:f[1]*b.bounds.g,b:f[2]*b.bounds.b,a:n||b.bounds.a}};b.hsv_to_rgb=b.hsva_to_rgba;b.rgba_to_hsva=function(f,g,m,n){f/=b.bounds.r;g/=b.bounds.g;m/=b.bounds.b;var h=Math.max(f,g,m),o=h-Math.min(f,g,m),t=h;if(h==0)return{h:0,s:0,v:0,a:n||b.bounds.a};f=f==h?(g-m)/o:g==h?2+(m-f)/o:4+(f-g)/o;f/=6;f<0&&(f+=1);return{h:f*b.bounds.h,s:o/h*b.bounds.s,v:h*b.bounds.v,a:n||
b.bounds.a}};b.rgb_to_hsv=b.rgba_to_hsva;b.rgba_to_hex=function(f,g,m,n){n=b["hex"+b.prefix_substitute+"a"](0,n||b.bounds.a);n=b["hex"+b.prefix_substitute+"r"](n,f);n=b["hex"+b.prefix_substitute+"g"](n,g);return b["hex"+b.prefix_substitute+"b"](n,m)};b.rgb_to_hex=b.rgba_to_hex;b.hex_to_rgba=function(f){return{a:b["hex"+b.prefix_component+"a"](f),r:b["hex"+b.prefix_component+"r"](f),g:b["hex"+b.prefix_component+"g"](f),b:b["hex"+b.prefix_component+"b"](f)}};b.hex_to_rgb=b.hex_to_rgba;b.hex_to_string=
function(f){var g=b["hex"+b.prefix_component+"a"](f)/b.bounds.a,m=Math.round(b["hex"+b.prefix_component+"r"](f)/b.bounds.r*255),n=Math.round(b["hex"+b.prefix_component+"g"](f)/b.bounds.g*255);f=Math.round(b["hex"+b.prefix_component+"b"](f)/b.bounds.b*255);return"rgba("+m+","+n+","+f+","+g+")"};b.has_rgba_props=function(f){return f.r!=undefined&&f.g!=undefined&&f.b!=undefined&&f.a!=undefined};b.has_rgb_props=function(f){return f.r!=undefined&&f.g!=undefined&&f.b!=undefined};for(var d=0;d<4;d++)e(d);
for(d=0;d<3;d++)c("hsv"[d])})(DAT.color);
var signals=function(){function b(c,d,f,g,m){this._listener=d;this._isOnce=f;this.context=g;this._signal=c;this._priority=m||0}var e={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var d;if(this._isEnabled){d=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return d},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};e.Signal=function(){this._bindings=[]};e.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,d,f,g){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var m=this._indexOfListener(c);if(m!==-1){c=this._bindings[m];if(c.isOnce()!==d)throw Error("You cannot add"+(d?"":"Once")+"() then add"+(!d?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,d,f,g);this._addBinding(c)}return c},_addBinding:function(c){var d=this._bindings.length;do--d;while(this._bindings[d]&&c._priority<=this._bindings[d]._priority);this._bindings.splice(d+1,0,c)},_indexOfListener:function(c){for(var d=this._bindings.length;d--;)if(this._bindings[d]._listener===
c)return d;return-1},add:function(c,d,f){return this._registerListener(c,!1,d,f)},addOnce:function(c,d,f){return this._registerListener(c,!0,d,f)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var d=this._indexOfListener(c);if(d!==-1){this._bindings[d]._destroy();this._bindings.splice(d,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),d=this._bindings.slice(),f=this._bindings.length;this._shouldPropagate=!0;do f--;while(d[f]&&this._shouldPropagate&&d[f].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return e}(),TWEEN=TWEEN||function(){var b,e,c,d=[];this.add=function(f){d.push(f)};this.remove=function(f){b=d.indexOf(f);b!==-1&&d.splice(b,1)};this.update=function(){b=0;e=d.length;for(c=(new Date).getTime();b<e;)if(d[b].update(c))b++;else{d.splice(b,1);e--}};return this}();
TWEEN.Tween=function(b){var e={},c={},d={},f=1E3,g=0,m=null,n=TWEEN.Easing.Linear.EaseNone,h=null,o=null,t=null;this.to=function(u,v){v!==null&&(f=v);for(var w in u)b[w]!==null&&(d[w]=u[w]);return this};this.start=function(){TWEEN.add(this);m=(new Date).getTime()+g;for(var u in d)if(b[u]!==null){e[u]=b[u];c[u]=d[u]-b[u]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(u){g=u;return this};this.easing=function(u){n=u;return this};this.chain=function(u){h=u};this.onUpdate=
function(u){o=u;return this};this.onComplete=function(u){t=u;return this};this.update=function(u){var v,w;if(u<m)return!0;u=(u-m)/f;u=u>1?1:u;w=n(u);for(v in c)b[v]=e[v]+c[v]*w;o!==null&&o.call(b,w);if(u==1){t!==null&&t.call(b);h!==null&&h.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d))};
TWEEN.Easing.Elastic.EaseOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-e)*2*Math.PI/d)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-e)*2*Math.PI/d)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,e,c){this.r=b;this.g=e;this.b=c;this.updateHex()},setHSV:function(b,e,c){var d,f,g,m,n,h;if(c==0)d=f=g=0;else{m=Math.floor(b*6);n=b*6-m;b=c*(1-e);h=c*(1-e*n);e=c*(1-e*(1-n));switch(m){case 1:d=h;f=c;g=b;break;case 2:d=b;f=c;g=e;break;case 3:d=b;f=h;g=c;break;case 4:d=e;f=b;g=c;break;case 5:d=c;f=b;g=h;break;case 6:case 0:d=c;f=e;g=b}}this.setRGB(d,
f,g)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,e){this.set(b||0,e||0)};
THREE.Vector2.prototype={set:function(b,e){this.x=b;this.y=e;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,e,c){this.set(b||0,e||0,c||0)};
THREE.Vector3.prototype={set:function(b,e,c){this.x=b;this.y=e;this.z=c;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
e){this.set(b.y*e.z-b.z*e.y,b.z*e.x-b.x*e.z,b.x*e.y-b.y*e.x);return this},crossSelf:function(b){var e=this.x,c=this.y,d=this.z;this.set(c*b.z-d*b.y,d*b.x-e*b.z,e*b.y-c*b.x);return this},multiply:function(b,e){this.set(b.x*e.x,b.y*e.y,b.z*e.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var e=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return e*e+c*c+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var e=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(e)>1.0E-5){this.x=Math.atan2(-b.n23/e,b.n33/e);this.z=Math.atan2(-b.n12/e,b.n11/e)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,e,c,d){this.set(b||0,e||0,c||0,d||1)};
THREE.Vector4.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z,b.w+e.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z,b.w-e.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,e){this.set(this.x+(b.x-this.x)*e,this.y+(b.y-this.y)*e,this.z+(b.z-this.z)*e,this.w+(b.w-this.w)*e)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,e){this.origin=b||new THREE.Vector3;this.direction=e||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){return this.intersectObjects(b.objects)},intersectObjects:function(b){var e,c,d,f=[];e=0;for(c=b.length;e<c;e++){d=b[e];d instanceof THREE.Mesh&&(f=f.concat(this.intersectObject(d)))}f.sort(function(g,m){return g.distance-m.distance});return f},intersectObject:function(b){function e(C,B,H,z){z=z.clone().subSelf(B);H=H.clone().subSelf(B);var E=C.clone().subSelf(B);C=z.dot(z);B=z.dot(H);z=z.dot(E);var F=H.dot(H);H=H.dot(E);E=1/(C*F-B*B);F=(F*z-B*H)*E;
C=(C*H-B*z)*E;return F>0&&C>0&&F+C<1}var c,d,f,g,m,n,h,o,t,u,v,w=b.geometry,x=w.vertices,y=[];c=0;for(d=w.faces.length;c<d;c++){f=w.faces[c];u=this.origin.clone();v=this.direction.clone();h=b.matrixWorld;g=h.multiplyVector3(x[f.a].position.clone());m=h.multiplyVector3(x[f.b].position.clone());n=h.multiplyVector3(x[f.c].position.clone());h=f instanceof THREE.Face4?h.multiplyVector3(x[f.d].position.clone()):null;o=b.matrixRotationWorld.multiplyVector3(f.normal.clone());t=v.dot(o);if(b.doubleSided||
(b.flipSided?t>0:t<0)){o=o.dot((new THREE.Vector3).sub(g,u))/t;u=u.addSelf(v.multiplyScalar(o));if(f instanceof THREE.Face3){if(e(u,g,m,n)){f={distance:this.origin.distanceTo(u),point:u,face:f,object:b};y.push(f)}}else if(f instanceof THREE.Face4&&(e(u,g,m,h)||e(u,m,n,h))){f={distance:this.origin.distanceTo(u),point:u,face:f,object:b};y.push(f)}}}return y}};
THREE.Rectangle=function(){function b(){g=d-e;m=f-c}var e,c,d,f,g,m,n=!0;this.getX=function(){return e};this.getY=function(){return c};this.getWidth=function(){return g};this.getHeight=function(){return m};this.getLeft=function(){return e};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return f};this.set=function(h,o,t,u){n=!1;e=h;c=o;d=t;f=u;b()};this.addPoint=function(h,o){if(n){n=!1;e=h;c=o;d=h;f=o}else{e=e<h?e:h;c=c<o?c:o;d=d>h?d:h;f=f>o?f:o}b()};
this.add3Points=function(h,o,t,u,v,w){if(n){n=!1;e=h<t?h<v?h:v:t<v?t:v;c=o<u?o<w?o:w:u<w?u:w;d=h>t?h>v?h:v:t>v?t:v;f=o>u?o>w?o:w:u>w?u:w}else{e=h<t?h<v?h<e?h:e:v<e?v:e:t<v?t<e?t:e:v<e?v:e;c=o<u?o<w?o<c?o:c:w<c?w:c:u<w?u<c?u:c:w<c?w:c;d=h>t?h>v?h>d?h:d:v>d?v:d:t>v?t>d?t:d:v>d?v:d;f=o>u?o>w?o>f?o:f:w>f?w:f:u>w?u>f?u:f:w>f?w:f}b()};this.addRectangle=function(h){if(n){n=!1;e=h.getLeft();c=h.getTop();d=h.getRight();f=h.getBottom()}else{e=e<h.getLeft()?e:h.getLeft();c=c<h.getTop()?c:h.getTop();d=d>h.getRight()?
d:h.getRight();f=f>h.getBottom()?f:h.getBottom()}b()};this.inflate=function(h){e-=h;c-=h;d+=h;f+=h;b()};this.minSelf=function(h){e=e>h.getLeft()?e:h.getLeft();c=c>h.getTop()?c:h.getTop();d=d<h.getRight()?d:h.getRight();f=f<h.getBottom()?f:h.getBottom();b()};this.instersects=function(h){return Math.min(d,h.getRight())-Math.max(e,h.getLeft())>=0&&Math.min(f,h.getBottom())-Math.max(c,h.getTop())>=0};this.empty=function(){n=!0;f=d=c=e=0;b()};this.isEmpty=function(){return n}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,e=this.m;b=e[1];e[1]=e[3];e[3]=b;b=e[2];e[2]=e[6];e[6]=b;b=e[5];e[5]=e[7];e[7]=b;return this},transposeIntoArray:function(b){var e=this.m;b[0]=e[0];b[1]=e[3];b[2]=e[6];b[3]=e[1];b[4]=e[4];b[5]=e[7];b[6]=e[2];b[7]=e[5];b[8]=e[8];return this}};
THREE.Matrix4=function(b,e,c,d,f,g,m,n,h,o,t,u,v,w,x,y){this.set(b||1,e||0,c||0,d||0,f||0,g||1,m||0,n||0,h||0,o||0,t||1,u||0,v||0,w||0,x||0,y||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,e,c,d,f,g,m,n,h,o,t,u,v,w,x,y){this.n11=b;this.n12=e;this.n13=c;this.n14=d;this.n21=f;this.n22=g;this.n23=m;this.n24=n;this.n31=h;this.n32=o;this.n33=t;this.n34=u;this.n41=v;this.n42=w;this.n43=x;this.n44=y;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,e,c){var d=THREE.Matrix4.__v1,
f=THREE.Matrix4.__v2,g=THREE.Matrix4.__v3;g.sub(b,e).normalize();if(g.length()===0)g.z=1;d.cross(c,g).normalize();if(d.length()===0){g.x+=1.0E-4;d.cross(c,g).normalize()}f.cross(g,d).normalize();this.n11=d.x;this.n12=f.x;this.n13=g.x;this.n21=d.y;this.n22=f.y;this.n23=g.y;this.n31=d.z;this.n32=f.z;this.n33=g.z;return this},multiplyVector3:function(b){var e=b.x,c=b.y,d=b.z,f=1/(this.n41*e+this.n42*c+this.n43*d+this.n44);b.x=(this.n11*e+this.n12*c+this.n13*d+this.n14)*f;b.y=(this.n21*e+this.n22*c+this.n23*
d+this.n24)*f;b.z=(this.n31*e+this.n32*c+this.n33*d+this.n34)*f;return b},multiplyVector4:function(b){var e=b.x,c=b.y,d=b.z,f=b.w;b.x=this.n11*e+this.n12*c+this.n13*d+this.n14*f;b.y=this.n21*e+this.n22*c+this.n23*d+this.n24*f;b.z=this.n31*e+this.n32*c+this.n33*d+this.n34*f;b.w=this.n41*e+this.n42*c+this.n43*d+this.n44*f;return b},rotateAxis:function(b){var e=b.x,c=b.y,d=b.z;b.x=e*this.n11+c*this.n12+d*this.n13;b.y=e*this.n21+c*this.n22+d*this.n23;b.z=e*this.n31+c*this.n32+d*this.n33;b.normalize();
return b},crossVector:function(b){var e=new THREE.Vector4;e.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;e.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;e.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;e.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return e},multiply:function(b,e){var c=b.n11,d=b.n12,f=b.n13,g=b.n14,m=b.n21,n=b.n22,h=b.n23,o=b.n24,t=b.n31,u=b.n32,v=b.n33,w=b.n34,x=b.n41,y=b.n42,C=b.n43,B=b.n44,H=e.n11,z=e.n12,E=e.n13,F=e.n14,D=e.n21,T=e.n22,
W=e.n23,U=e.n24,Y=e.n31,N=e.n32,p=e.n33,O=e.n34;this.n11=c*H+d*D+f*Y;this.n12=c*z+d*T+f*N;this.n13=c*E+d*W+f*p;this.n14=c*F+d*U+f*O+g;this.n21=m*H+n*D+h*Y;this.n22=m*z+n*T+h*N;this.n23=m*E+n*W+h*p;this.n24=m*F+n*U+h*O+o;this.n31=t*H+u*D+v*Y;this.n32=t*z+u*T+v*N;this.n33=t*E+u*W+v*p;this.n34=t*F+u*U+v*O+w;this.n41=x*H+y*D+C*Y;this.n42=x*z+y*T+C*N;this.n43=x*E+y*W+C*p;this.n44=x*F+y*U+C*O+B;return this},multiplyToArray:function(b,e,c){this.multiply(b,e);c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=
this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=
this.n11,e=this.n12,c=this.n13,d=this.n14,f=this.n21,g=this.n22,m=this.n23,n=this.n24,h=this.n31,o=this.n32,t=this.n33,u=this.n34,v=this.n41,w=this.n42,x=this.n43,y=this.n44;return d*m*o*v-c*n*o*v-d*g*t*v+e*n*t*v+c*g*u*v-e*m*u*v-d*m*h*w+c*n*h*w+d*f*t*w-b*n*t*w-c*f*u*w+b*m*u*w+d*g*h*x-e*n*h*x-d*f*o*x+b*n*o*x+e*f*u*x-b*g*u*x-c*g*h*y+e*m*h*y+c*f*o*y-b*m*o*y-e*f*t*y+b*g*t*y},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=
this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;
this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=
this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,e){b[e]=this.n11;b[e+1]=this.n21;b[e+2]=this.n31;b[e+3]=this.n41;b[e+4]=this.n12;b[e+5]=this.n22;b[e+6]=this.n32;b[e+7]=this.n42;b[e+8]=this.n13;b[e+9]=this.n23;b[e+10]=this.n33;b[e+11]=this.n43;b[e+12]=this.n14;b[e+13]=this.n24;b[e+14]=this.n34;b[e+15]=this.n44;return b},setTranslation:function(b,e,c){this.set(1,0,0,b,0,1,0,e,0,0,1,c,0,0,0,1);return this},setScale:function(b,
e,c){this.set(b,0,0,0,0,e,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,e,-b,0,0,b,e,0,0,0,0,1);return this},setRotationY:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,0,b,0,0,1,0,0,-b,0,e,0,0,0,0,1);return this},setRotationZ:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,-b,0,0,b,e,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,e){var c=Math.cos(e),d=Math.sin(e),f=1-c,g=b.x,m=b.y,n=b.z,h=f*g,o=f*m;this.set(h*
g+c,h*m-d*n,h*n+d*m,0,h*m+d*n,o*m+c,o*n-d*g,0,h*n-d*m,o*n+d*g,f*n*n+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;
this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var e=b.x,c=b.y,d=b.z;b=Math.cos(e);e=Math.sin(e);var f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var m=b*c,n=e*c;this.n11=f*g;this.n12=-f*d;this.n13=c;this.n21=n*g+b*d;this.n22=-n*d+b*g;this.n23=-e*f;this.n31=-m*g+e*d;this.n32=m*d+e*g;this.n33=b*f;return this},
setRotationFromQuaternion:function(b){var e=b.x,c=b.y,d=b.z,f=b.w,g=e+e,m=c+c,n=d+d;b=e*g;var h=e*m;e*=n;var o=c*m;c*=n;d*=n;g*=f;m*=f;f*=n;this.n11=1-(o+d);this.n12=h-f;this.n13=e+m;this.n21=h+f;this.n22=1-(b+d);this.n23=c-g;this.n31=e-m;this.n32=c+g;this.n33=1-(b+o);return this},scale:function(b){var e=b.x,c=b.y;b=b.z;this.n11*=e;this.n12*=c;this.n13*=b;this.n21*=e;this.n22*=c;this.n23*=b;this.n31*=e;this.n32*=c;this.n33*=b;this.n41*=e;this.n42*=c;this.n43*=b;return this},extractPosition:function(b){this.n14=
b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,e){var c=1/e.x,d=1/e.y,f=1/e.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*d;this.n22=b.n22*d;this.n32=b.n32*d;this.n13=b.n13*f;this.n23=b.n23*f;this.n33=b.n33*f}};
THREE.Matrix4.makeInvert=function(b,e){var c=b.n11,d=b.n12,f=b.n13,g=b.n14,m=b.n21,n=b.n22,h=b.n23,o=b.n24,t=b.n31,u=b.n32,v=b.n33,w=b.n34,x=b.n41,y=b.n42,C=b.n43,B=b.n44;e===undefined&&(e=new THREE.Matrix4);e.n11=h*w*y-o*v*y+o*u*C-n*w*C-h*u*B+n*v*B;e.n12=g*v*y-f*w*y-g*u*C+d*w*C+f*u*B-d*v*B;e.n13=f*o*y-g*h*y+g*n*C-d*o*C-f*n*B+d*h*B;e.n14=g*h*u-f*o*u-g*n*v+d*o*v+f*n*w-d*h*w;e.n21=o*v*x-h*w*x-o*t*C+m*w*C+h*t*B-m*v*B;e.n22=f*w*x-g*v*x+g*t*C-c*w*C-f*t*B+c*v*B;e.n23=g*h*x-f*o*x-g*m*C+c*o*C+f*m*B-c*h*B;
e.n24=f*o*t-g*h*t+g*m*v-c*o*v-f*m*w+c*h*w;e.n31=n*w*x-o*u*x+o*t*y-m*w*y-n*t*B+m*u*B;e.n32=g*u*x-d*w*x-g*t*y+c*w*y+d*t*B-c*u*B;e.n33=f*o*x-g*n*x+g*m*y-c*o*y-d*m*B+c*n*B;e.n34=g*n*t-d*o*t-g*m*u+c*o*u+d*m*w-c*n*w;e.n41=h*u*x-n*v*x-h*t*y+m*v*y+n*t*C-m*u*C;e.n42=d*v*x-f*u*x+f*t*y-c*v*y-d*t*C+c*u*C;e.n43=f*n*x-d*h*x-f*m*y+c*h*y+d*m*C-c*n*C;e.n44=d*h*t-f*n*t+f*m*u-c*h*u-d*m*v+c*n*v;e.multiplyScalar(1/b.determinant());return e};
THREE.Matrix4.makeInvert3x3=function(b){var e=b.m33,c=e.m,d=b.n33*b.n22-b.n32*b.n23,f=-b.n33*b.n21+b.n31*b.n23,g=b.n32*b.n21-b.n31*b.n22,m=-b.n33*b.n12+b.n32*b.n13,n=b.n33*b.n11-b.n31*b.n13,h=-b.n32*b.n11+b.n31*b.n12,o=b.n23*b.n12-b.n22*b.n13,t=-b.n23*b.n11+b.n21*b.n13,u=b.n22*b.n11-b.n21*b.n12;b=b.n11*d+b.n21*m+b.n31*o;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*d;c[1]=b*f;c[2]=b*g;c[3]=b*m;c[4]=b*n;c[5]=b*h;c[6]=b*o;c[7]=b*t;c[8]=b*u;return e};
THREE.Matrix4.makeFrustum=function(b,e,c,d,f,g){var m;m=new THREE.Matrix4;m.n11=2*f/(e-b);m.n12=0;m.n13=(e+b)/(e-b);m.n14=0;m.n21=0;m.n22=2*f/(d-c);m.n23=(d+c)/(d-c);m.n24=0;m.n31=0;m.n32=0;m.n33=-(g+f)/(g-f);m.n34=-2*g*f/(g-f);m.n41=0;m.n42=0;m.n43=-1;m.n44=0;return m};THREE.Matrix4.makePerspective=function(b,e,c,d){var f;b=c*Math.tan(b*Math.PI/360);f=-b;return THREE.Matrix4.makeFrustum(f*e,b*e,f,b,c,d)};
THREE.Matrix4.makeOrtho=function(b,e,c,d,f,g){var m,n,h,o;m=new THREE.Matrix4;n=e-b;h=c-d;o=g-f;m.n11=2/n;m.n12=0;m.n13=0;m.n14=-((e+b)/n);m.n21=0;m.n22=2/h;m.n23=0;m.n24=-((c+d)/h);m.n31=0;m.n32=0;m.n33=-2/o;m.n34=-((g+f)/o);m.n41=0;m.n42=0;m.n43=0;m.n44=1;return m};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.dynamic=!1;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=
1;this.visible=!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var e=this;e.parent!==undefined;)e=e.parent;e!==undefined&&e instanceof THREE.Scene&&e.addChildRecurse(b)}},removeChild:function(b){var e=this.children.indexOf(b);if(e!==-1){b.parent=undefined;this.children.splice(e,1)}},getChildByName:function(b,e){var c,d,f;c=0;for(d=this.children.length;c<d;c++){f=this.children[c];if(f.name===b)return f;if(e){f=f.getChildByName(b,e);if(f!==undefined)return f}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,e,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;e=!0}b=0;for(var d=this.children.length;b<d;b++)this.children[b].update(this.matrixWorld,e,c)}};THREE.Quaternion=function(b,e,c,d){this.set(b||0,e||0,c||0,d!==undefined?d:1)};
THREE.Quaternion.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var e=0.5*Math.PI/360,c=b.x*e,d=b.y*e,f=b.z*e;b=Math.cos(d);d=Math.sin(d);e=Math.cos(-f);f=Math.sin(-f);var g=Math.cos(c);c=Math.sin(c);var m=b*e,n=d*f;this.w=m*g-n*c;this.x=m*c+n*g;this.y=d*e*g+b*f*c;this.z=b*f*g-d*e*c;return this},setFromAxisAngle:function(b,e){var c=e/2,d=Math.sin(c);this.x=b.x*d;this.y=
b.y*d;this.z=b.z*d;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var e=this.x,c=this.y,d=this.z,f=this.w,g=b.x,m=b.y,n=b.z;b=b.w;this.x=e*b+f*g+c*n-d*m;this.y=c*b+f*m+d*g-e*n;this.z=d*b+f*n+e*m-c*g;this.w=f*b-e*g-c*m-d*n;return this},multiply:function(b,e){this.x=b.x*e.w+b.y*e.z-b.z*e.y+b.w*e.x;this.y=-b.x*e.z+b.y*e.w+b.z*e.x+b.w*e.y;this.z=b.x*e.y-b.y*e.x+b.z*e.w+b.w*e.z;this.w=-b.x*e.x-b.y*e.y-b.z*e.z+b.w*e.w;return this},multiplyVector3:function(b,e){e||(e=b);var c=b.x,d=b.y,f=b.z,g=this.x,m=this.y,n=this.z,h=this.w,o=h*c+m*f-n*d,t=
h*d+n*c-g*f,u=h*f+g*d-m*c;c=-g*c-m*d-n*f;e.x=o*h+c*-g+t*-n-u*-m;e.y=t*h+c*-m+u*-g-o*-n;e.z=u*h+c*-n+o*-m-t*-g;return e}};
THREE.Quaternion.slerp=function(b,e,c,d){var f=b.w*e.w+b.x*e.x+b.y*e.y+b.z*e.z;if(Math.abs(f)>=1){c.w=b.w;c.x=b.x;c.y=b.y;c.z=b.z;return c}var g=Math.acos(f),m=Math.sqrt(1-f*f);if(Math.abs(m)<0.0010){c.w=0.5*(b.w+e.w);c.x=0.5*(b.x+e.x);c.y=0.5*(b.y+e.y);c.z=0.5*(b.z+e.z);return c}f=Math.sin((1-d)*g)/m;d=Math.sin(d*g)/m;c.w=b.w*f+e.w*d;c.x=b.x*f+e.x*d;c.y=b.y*f+e.y*d;c.z=b.z*f+e.z*d;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,e,c,d,f,g){this.a=b;this.b=e;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=g instanceof Array?g:[g];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,e,c,d,f,g,m){this.a=b;this.b=e;this.c=c;this.d=d;this.normal=f instanceof THREE.Vector3?f:new THREE.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=m instanceof Array?m:[m];this.centroid=new THREE.Vector3};THREE.UV=function(b,e){this.set(b||0,e||0)};
THREE.UV.prototype={set:function(b,e){this.u=b;this.v=e;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,e,c;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var e,c,d,f,g,m,n=new THREE.Vector3,h=new THREE.Vector3;d=0;for(f=this.faces.length;d<f;d++){g=this.faces[d];if(b&&g.vertexNormals.length){n.set(0,0,0);e=0;for(c=g.vertexNormals.length;e<c;e++)n.addSelf(g.vertexNormals[e]);n.divideScalar(3)}else{e=this.vertices[g.a];c=this.vertices[g.b];m=this.vertices[g.c];n.sub(m.position,c.position);h.sub(e.position,c.position);n.crossSelf(h)}n.isZero()||
n.normalize();g.normal.copy(n)}},computeVertexNormals:function(){var b,e,c,d;if(this.__tmpVertices==undefined){d=this.__tmpVertices=Array(this.vertices.length);b=0;for(e=this.vertices.length;b<e;b++)d[b]=new THREE.Vector3;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{d=
this.__tmpVertices;b=0;for(e=this.vertices.length;b<e;b++)d[b].set(0,0,0)}b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal);d[c.d].addSelf(c.normal)}}b=0;for(e=this.vertices.length;b<e;b++)d[b].normalize();b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(d[c.a]);
c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c])}else if(c instanceof THREE.Face4){c.vertexNormals[0].copy(d[c.a]);c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c]);c.vertexNormals[3].copy(d[c.d])}}},computeTangents:function(){function b(M,da,ka,$,ha,qa,sa){n=M.vertices[da].position;h=M.vertices[ka].position;o=M.vertices[$].position;t=m[ha];u=m[qa];v=m[sa];w=h.x-n.x;x=o.x-n.x;y=h.y-n.y;C=o.y-n.y;B=h.z-n.z;H=o.z-n.z;z=u.u-t.u;E=v.u-t.u;F=u.v-t.v;D=v.v-t.v;T=1/(z*D-E*F);
N.set((D*w-F*x)*T,(D*y-F*C)*T,(D*B-F*H)*T);p.set((z*x-E*w)*T,(z*C-E*y)*T,(z*H-E*B)*T);U[da].addSelf(N);U[ka].addSelf(N);U[$].addSelf(N);Y[da].addSelf(p);Y[ka].addSelf(p);Y[$].addSelf(p)}var e,c,d,f,g,m,n,h,o,t,u,v,w,x,y,C,B,H,z,E,F,D,T,W,U=[],Y=[],N=new THREE.Vector3,p=new THREE.Vector3,O=new THREE.Vector3,G=new THREE.Vector3,L=new THREE.Vector3;e=0;for(c=this.vertices.length;e<c;e++){U[e]=new THREE.Vector3;Y[e]=new THREE.Vector3}e=0;for(c=this.faces.length;e<c;e++){g=this.faces[e];m=this.faceVertexUvs[0][e];
if(g instanceof THREE.Face3)b(this,g.a,g.b,g.c,0,1,2);else if(g instanceof THREE.Face4){b(this,g.a,g.b,g.c,0,1,2);b(this,g.a,g.b,g.d,0,1,3)}}var Q=["a","b","c","d"];e=0;for(c=this.faces.length;e<c;e++){g=this.faces[e];for(d=0;d<g.vertexNormals.length;d++){L.copy(g.vertexNormals[d]);f=g[Q[d]];W=U[f];O.copy(W);O.subSelf(L.multiplyScalar(L.dot(W))).normalize();G.cross(g.vertexNormals[d],W);f=G.dot(Y[f]);f=f<0?-1:1;g.vertexTangents[d]=new THREE.Vector4(O.x,O.y,O.z,f)}}this.hasTangents=!0},computeBoundingBox:function(){var b;
if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var e=1,c=this.vertices.length;e<c;e++){b=this.vertices[e];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;
else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,e=0,c=this.vertices.length;e<c;e++)b=Math.max(b,this.vertices[e].position.length());this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(h,o){return Math.min(h,
o)+"_"+Math.max(h,o)}function e(h,o,t){if(h[o]===undefined){h[o]={set:{},array:[]};h[o].set[t]=1;h[o].array.push(t)}else if(h[o].set[t]===undefined){h[o].set[t]=1;h[o].array.push(t)}}var c,d,f,g,m,n={};c=0;for(d=this.faces.length;c<d;c++){m=this.faces[c];if(m instanceof THREE.Face3){f=b(m.a,m.b);e(n,f,c);f=b(m.b,m.c);e(n,f,c);f=b(m.a,m.c);e(n,f,c)}else if(m instanceof THREE.Face4){f=b(m.b,m.d);e(n,f,c);f=b(m.a,m.b);e(n,f,c);f=b(m.a,m.d);e(n,f,c);f=b(m.b,m.c);e(n,f,c);f=b(m.c,m.d);e(n,f,c)}}c=0;for(d=
this.edges.length;c<d;c++){m=this.edges[c];f=m.vertexIndices[0];g=m.vertexIndices[1];m.faceIndices=n[b(f,g)].array;for(f=0;f<m.faceIndices.length;f++){g=m.faceIndices[f];m.faces.push(this.faces[g])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function e(w,x,y,C,B,H,z){w=(y-w)*0.5;C=(C-x)*0.5;return(2*(x-y)+w+C)*z+(-3*(x-y)-2*w-C)*H+w*B+x}this.points=b;var c=[],d={x:0,y:0,z:0},f,g,m,n,h,o,t,u,v;this.initFromArray=function(w){this.points=[];for(var x=0;x<w.length;x++)this.points[x]={x:w[x][0],y:w[x][1],z:w[x][2]}};this.getPoint=function(w){f=(this.points.length-1)*w;g=Math.floor(f);m=f-g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>this.points.length-2?g:g+1;c[3]=g>this.points.length-3?g:g+2;o=this.points[c[0]];t=this.points[c[1]];
u=this.points[c[2]];v=this.points[c[3]];n=m*m;h=m*n;d.x=e(o.x,t.x,u.x,v.x,m,n,h);d.y=e(o.y,t.y,u.y,v.y,m,n,h);d.z=e(o.z,t.z,u.z,v.z,m,n,h);return d};this.getControlPointsArray=function(){var w,x,y=this.points.length,C=[];for(w=0;w<y;w++){x=this.points[w];C[w]=[x.x,x.y,x.z]}return C};this.getLength=function(w){var x,y,C=0,B=new THREE.Vector3,H=new THREE.Vector3,z=[],E=0;z[0]=0;w||(w=100);y=this.points.length*w;B.copy(this.points[0]);for(w=1;w<y;w++){x=w/y;position=this.getPoint(x);H.copy(position);
E+=H.distanceTo(B);B.copy(position);x*=this.points.length-1;x=Math.floor(x);if(x!=C){z[x]=E;C=x}}z[z.length]=E;return{chunks:z,total:E}};this.reparametrizeByArcLength=function(w){var x,y,C,B,H,z,E=[],F=new THREE.Vector3,D=this.getLength();E.push(F.copy(this.points[0]).clone());for(x=1;x<this.points.length;x++){y=D.chunks[x]-D.chunks[x-1];z=Math.ceil(w*y/D.total);B=(x-1)/(this.points.length-1);H=x/(this.points.length-1);for(y=1;y<z-1;y++){C=B+y*(1/z)*(H-B);position=this.getPoint(C);E.push(F.copy(position).clone())}E.push(F.copy(this.points[x]).clone())}this.points=
E}};THREE.Edge=function(b,e,c,d){this.vertices=[b,e];this.vertexIndices=[c,d];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,e,c,d,f){THREE.Object3D.call(this);this.fov=b||50;this.aspect=e||1;this.near=c||0.1;this.far=d||2E3;this.target=f||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,e,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);e=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;e=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,e,c,d){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=e||1;this.distance=c||0;this.castShadow=d!==undefined?d:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,e,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=e||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,e,c,d){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,e,c,d)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,e,c,d){e===undefined&&(e=-1);c===undefined&&(c=0);if(d===undefined)d=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:e,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,e=this.lensFlares.length,c,d=-this.positionScreen.x*2,f=-this.positionScreen.y*2;for(b=0;b<e;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+f*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.Texture=function(b,e,c,d,f,g){this.image=b;this.mapping=e!==undefined?e:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==undefined?d:THREE.ClampToEdgeWrapping;this.magFilter=f!==undefined?f:THREE.LinearFilter;this.minFilter=g!==undefined?g:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.ParticleSystem=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(b,e,c){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;
THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e&&e.length?e:[e];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[c].name]=c}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.skinMatrix,e,c):b.update(this.matrixWorld,!0,c)}}else for(d=0;d<f;d++)this.children[d].update(this.skinMatrix,
e,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,e){THREE.Mesh.call(this,b,e);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,d,f,g,m,n;if(this.geometry.bones!==undefined){for(c=0;c<this.geometry.bones.length;c++){f=this.geometry.bones[c];g=f.pos;m=f.rotq;n=f.scl;d=this.addBone();d.name=f.name;d.position.set(g[0],g[1],g[2]);d.quaternion.set(m[0],m[1],m[2],m[3]);d.useQuaternion=!0;n!==undefined?d.scale.set(n[0],n[1],n[2]):d.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){f=this.geometry.bones[c];
d=this.bones[c];f.parent===-1?this.addChild(d):this.bones[f.parent].addChild(d)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,e,c){if(this.visible){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,e,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(e=0;e<c;e++)ba[e].skinMatrix.flattenToArrayOffset(bm,
e*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,e=[],c=0;c<this.bones.length;c++){b=this.bones[c];e.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var d;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var f=this.geometry.skinIndices[b].x,g=this.geometry.skinIndices[b].y;
d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(e[f].multiplyVector3(d));d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(e[g].multiplyVector3(d));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=c;this.geometry.skinWeights[b].y+=c}}}};
THREE.Ribbon=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,e,c,d){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=e!==undefined?Math.abs(e):100;this.volume=Math.min(1,Math.max(0,c!==undefined?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=d!==undefined?d:!0;this.sources=b instanceof Array?b:[b];var f;c=this.sources.length;for(b=0;b<c;b++){e=this.sources[b];e.toLowerCase();if(e.indexOf(".mp3")!==-1)f=
"audio/mpeg";else if(e.indexOf(".ogg")!==-1)f="audio/ogg";else e.indexOf(".wav")!==-1&&(f="audio/wav");if(this.domElement.canPlayType(f)){f=document.createElement("source");f.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(f);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,e,c){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);e=!0}if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d=this.children.length;for(b=0;b<d;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,e){e===undefined&&(e=0);e=Math.abs(e);for(var c=0;c<this.LODs.length;c++)if(e<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:e,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length;d++)if(b>=this.LODs[d].visibleAtDistance){this.LODs[d-1].object3D.visible=
!1;this.LODs[d].object3D.visible=!0}else break;for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.ShadowVolume=function(b,e){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,e,c,d,f,g,m,n,h,o,t,u,v,w,x=new THREE.Geometry;x.vertices=this.geometry.vertices;d=x.faces=this.geometry.faces;var y=x.egdes=this.geometry.edges,C=x.edgeFaces=[];f=0;var B=[];b=0;for(e=d.length;b<e;b++){c=d[b];B.push(f);f+=c instanceof THREE.Face3?3:4;c.vertexNormals[0]=c.normal;c.vertexNormals[1]=c.normal;c.vertexNormals[2]=c.normal;if(c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal}b=0;for(e=y.length;b<e;b++){n=y[b];c=n.faces[0];d=n.faces[1];f=n.faceIndices[0];g=n.faceIndices[1];m=n.vertexIndices[0];n=n.vertexIndices[1];if(c.a===m){h="a";t=B[f]+0}else if(c.b===m){h="b";t=B[f]+1}else if(c.c===m){h="c";t=B[f]+2}else if(c.d===m){h="d";t=B[f]+3}if(c.a===n){h+="a";u=B[f]+0}else if(c.b===n){h+="b";u=B[f]+1}else if(c.c===n){h+="c";u=B[f]+2}else if(c.d===n){h+="d";u=B[f]+3}if(d.a===m){o="a";v=B[g]+0}else if(d.b===m){o="b";v=B[g]+1}else if(d.c===m){o="c";v=B[g]+2}else if(d.d===
m){o="d";v=B[g]+3}if(d.a===n){o+="a";w=B[g]+0}else if(d.b===n){o+="b";w=B[g]+1}else if(d.c===n){o+="c";w=B[g]+2}else if(d.d===n){o+="d";w=B[g]+3}if(h==="ac"||h==="ad"||h==="ca"||h==="da"){if(t>u){c=t;t=u;u=c}}else if(t<u){c=t;t=u;u=c}if(o==="ac"||o==="ad"||o==="ca"||o==="da"){if(v>w){c=v;v=w;w=c}}else if(v<w){c=v;v=w;w=c}c=new THREE.Face4(t,u,v,w);c.normal.set(1,0,0);C.push(c)}this.geometry=x}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var e=this.geometry.vertices,c=this.geometry.faces,d=this.geometry.edgeFaces,f=b.faces;b=b.vertices;var g=f.length,m,n,h,o,t,u=["a","b","c","d"];for(h=0;h<g;h++){n=e.length;m=f[h];if(m instanceof THREE.Face4){o=4;n=new THREE.Face4(n,n+1,n+2,n+3)}else{o=3;n=new THREE.Face3(n,n+1,n+2)}n.normal.copy(m.normal);c.push(n);
for(n=0;n<o;n++){t=b[m[u[n]]];e.push(new THREE.Vertex(t.position.clone()))}}for(g=0;g<f.length-1;g++){b=c[g];for(m=g+1;m<f.length;m++){n=c[m];n=this.facesShareEdge(e,b,n);if(n!==undefined){n=new THREE.Face4(n.indices[0],n.indices[3],n.indices[2],n.indices[1]);n.normal.set(1,0,0);d.push(n)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,e,c){var d,f,g,m,n,h,o,t,u,v,w,x,y,C=0,B=["a","b","c","d"];d=e instanceof THREE.Face4?4:3;f=c instanceof THREE.Face4?4:3;for(x=0;x<d;x++){g=e[B[x]];n=b[g];for(y=0;y<f;y++){m=c[B[y]];h=b[m];if(Math.abs(n.position.x-h.position.x)<1.0E-4&&Math.abs(n.position.y-h.position.y)<1.0E-4&&Math.abs(n.position.z-h.position.z)<1.0E-4){C++;if(C===1){o=n;t=h;u=g;v=m;w=B[x]}if(C===2){w+=B[x];return w==="ad"||w==="ac"?{faces:[e,c],vertices:[o,t,h,n],indices:[u,
v,m,g],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[e,c],vertices:[o,n,h,t],indices:[u,g,m,v],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var e=0;e<b.children.length;e++)this.addChildRecurse(b.children[e])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var e=this.lights.indexOf(b);e!==-1&&this.lights.splice(e,1)}else if(b instanceof THREE.Sound){e=this.sounds.indexOf(b);e!==-1&&this.sounds.splice(e,1)}else if(!(b instanceof THREE.Camera)){e=this.objects.indexOf(b);if(e!==-1){this.objects.splice(e,1);this.__objectsRemoved.push(b)}}for(e=0;e<b.children.length;e++)this.removeChildRecurse(b.children[e])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,e,c){this.color=new THREE.Color(b);this.near=e||1;this.far=c||1E3};THREE.FogExp2=function(b,e){this.color=new THREE.Color(b);this.density=e!==undefined?e:2.5E-4};
THREE.Projector=function(){function b(){var N=h[n]=h[n]||new THREE.RenderableVertex;n++;return N}function e(N,p){return p.z-N.z}function c(N,p){var O=0,G=1,L=N.z+N.w,Q=p.z+p.w,M=-N.z+N.w,da=-p.z+p.w;if(L>=0&&Q>=0&&M>=0&&da>=0)return!0;else if(L<0&&Q<0||M<0&&da<0)return!1;else{if(L<0)O=Math.max(O,L/(L-Q));else Q<0&&(G=Math.min(G,L/(L-Q)));if(M<0)O=Math.max(O,M/(M-da));else da<0&&(G=Math.min(G,M/(M-da)));if(G<O)return!1;else{N.lerpSelf(p,O);p.lerpSelf(N,1-G);return!0}}}var d,f,g=[],m,n,h=[],o,t,u=[],
v,w=[],x,y,C=[],B,H,z=[],E=new THREE.Vector4,F=new THREE.Vector4,D=new THREE.Matrix4,T=new THREE.Matrix4,W=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],U=new THREE.Vector4,Y=new THREE.Vector4;this.projectVector=function(N,p){D.multiply(p.projectionMatrix,p.matrixWorldInverse);D.multiplyVector3(N);return N};this.unprojectVector=function(N,p){D.multiply(p.matrixWorld,THREE.Matrix4.makeInvert(p.projectionMatrix));D.multiplyVector3(N);return N};
this.projectObjects=function(N,p,O){p=[];var G,L,Q;f=0;L=N.objects;N=0;for(G=L.length;N<G;N++){Q=L[N];var M;if(!(M=!Q.visible))if(M=Q instanceof THREE.Mesh){a:{for(var da=Q.matrixWorld,ka=-Q.geometry.boundingSphere.radius*Math.max(Q.scale.x,Math.max(Q.scale.y,Q.scale.z)),$=0;$<6;$++){M=W[$].x*da.n14+W[$].y*da.n24+W[$].z*da.n34+W[$].w;if(M<=ka){M=!1;break a}}M=!0}M=!M}if(!M){M=g[f]=g[f]||new THREE.RenderableObject;f++;d=M;E.copy(Q.position);D.multiplyVector3(E);d.object=Q;d.z=E.z;p.push(d)}}O&&p.sort(e);
return p};this.projectScene=function(N,p,O){var G=[],L=p.near,Q=p.far,M,da,ka,$,ha,qa,sa,va,ua,ta,Da,Ba,Fa,ya,V,ia,fa;H=y=v=t=0;p.matrixAutoUpdate&&p.update(undefined,!0);N.update(undefined,!1,p);D.multiply(p.projectionMatrix,p.matrixWorldInverse);W[0].set(D.n41-D.n11,D.n42-D.n12,D.n43-D.n13,D.n44-D.n14);W[1].set(D.n41+D.n11,D.n42+D.n12,D.n43+D.n13,D.n44+D.n14);W[2].set(D.n41+D.n21,D.n42+D.n22,D.n43+D.n23,D.n44+D.n24);W[3].set(D.n41-D.n21,D.n42-D.n22,D.n43-D.n23,D.n44-D.n24);W[4].set(D.n41-D.n31,
D.n42-D.n32,D.n43-D.n33,D.n44-D.n34);W[5].set(D.n41+D.n31,D.n42+D.n32,D.n43+D.n33,D.n44+D.n34);for(M=0;M<6;M++){ua=W[M];ua.divideScalar(Math.sqrt(ua.x*ua.x+ua.y*ua.y+ua.z*ua.z))}ua=this.projectObjects(N,p,!0);N=0;for(M=ua.length;N<M;N++){ta=ua[N].object;if(ta.visible){Da=ta.matrixWorld;Ba=ta.matrixRotationWorld;Fa=ta.materials;ya=ta.overdraw;n=0;if(ta instanceof THREE.Mesh){V=ta.geometry;$=V.vertices;ia=V.faces;V=V.faceVertexUvs;da=0;for(ka=$.length;da<ka;da++){m=b();m.positionWorld.copy($[da].position);
Da.multiplyVector3(m.positionWorld);m.positionScreen.copy(m.positionWorld);D.multiplyVector4(m.positionScreen);m.positionScreen.x/=m.positionScreen.w;m.positionScreen.y/=m.positionScreen.w;m.visible=m.positionScreen.z>L&&m.positionScreen.z<Q}$=0;for(da=ia.length;$<da;$++){ka=ia[$];if(ka instanceof THREE.Face3){ha=h[ka.a];qa=h[ka.b];sa=h[ka.c];if(ha.visible&&qa.visible&&sa.visible&&(ta.doubleSided||ta.flipSided!=(sa.positionScreen.x-ha.positionScreen.x)*(qa.positionScreen.y-ha.positionScreen.y)-(sa.positionScreen.y-
ha.positionScreen.y)*(qa.positionScreen.x-ha.positionScreen.x)<0)){va=u[t]=u[t]||new THREE.RenderableFace3;t++;o=va;o.v1.copy(ha);o.v2.copy(qa);o.v3.copy(sa)}else continue}else if(ka instanceof THREE.Face4){ha=h[ka.a];qa=h[ka.b];sa=h[ka.c];va=h[ka.d];if(ha.visible&&qa.visible&&sa.visible&&va.visible&&(ta.doubleSided||ta.flipSided!=((va.positionScreen.x-ha.positionScreen.x)*(qa.positionScreen.y-ha.positionScreen.y)-(va.positionScreen.y-ha.positionScreen.y)*(qa.positionScreen.x-ha.positionScreen.x)<
0||(qa.positionScreen.x-sa.positionScreen.x)*(va.positionScreen.y-sa.positionScreen.y)-(qa.positionScreen.y-sa.positionScreen.y)*(va.positionScreen.x-sa.positionScreen.x)<0))){fa=w[v]=w[v]||new THREE.RenderableFace4;v++;o=fa;o.v1.copy(ha);o.v2.copy(qa);o.v3.copy(sa);o.v4.copy(va)}else continue}o.normalWorld.copy(ka.normal);Ba.multiplyVector3(o.normalWorld);o.centroidWorld.copy(ka.centroid);Da.multiplyVector3(o.centroidWorld);o.centroidScreen.copy(o.centroidWorld);D.multiplyVector3(o.centroidScreen);
sa=ka.vertexNormals;ha=0;for(qa=sa.length;ha<qa;ha++){va=o.vertexNormalsWorld[ha];va.copy(sa[ha]);Ba.multiplyVector3(va)}ha=0;for(qa=V.length;ha<qa;ha++)if(fa=V[ha][$]){sa=0;for(va=fa.length;sa<va;sa++)o.uvs[ha][sa]=fa[sa]}o.meshMaterials=Fa;o.faceMaterials=ka.materials;o.overdraw=ya;o.z=o.centroidScreen.z;G.push(o)}}else if(ta instanceof THREE.Line){T.multiply(D,Da);$=ta.geometry.vertices;ha=b();ha.positionScreen.copy($[0].position);T.multiplyVector4(ha.positionScreen);da=1;for(ka=$.length;da<ka;da++){ha=
b();ha.positionScreen.copy($[da].position);T.multiplyVector4(ha.positionScreen);qa=h[n-2];U.copy(ha.positionScreen);Y.copy(qa.positionScreen);if(c(U,Y)){U.multiplyScalar(1/U.w);Y.multiplyScalar(1/Y.w);Da=C[y]=C[y]||new THREE.RenderableLine;y++;x=Da;x.v1.positionScreen.copy(U);x.v2.positionScreen.copy(Y);x.z=Math.max(U.z,Y.z);x.materials=ta.materials;G.push(x)}}}else if(ta instanceof THREE.Particle){F.set(ta.matrixWorld.n14,ta.matrixWorld.n24,ta.matrixWorld.n34,1);D.multiplyVector4(F);F.z/=F.w;if(F.z>
0&&F.z<1){Da=z[H]=z[H]||new THREE.RenderableParticle;H++;B=Da;B.x=F.x/F.w;B.y=F.y/F.w;B.z=F.z;B.rotation=ta.rotation.z;B.scale.x=ta.scale.x*Math.abs(B.x-(F.x+p.projectionMatrix.n11)/(F.w+p.projectionMatrix.n14));B.scale.y=ta.scale.y*Math.abs(B.y-(F.y+p.projectionMatrix.n22)/(F.w+p.projectionMatrix.n24));B.materials=ta.materials;G.push(B)}}}}O&&G.sort(e);return G}};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,e,c){c&&b.update(undefined,!1,e);c=b.sounds;var d,f=c.length;for(d=0;d<f;d++){b=c[d];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(e.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var e,c,d,f={};for(e=0;e<b.length;e++){d=this.clone(b[e]);for(c in d)f[c]=d[c]}return f},clone:function(b){var e,c,d,f={};for(e in b){f[e]={};for(c in b[e]){d=b[e][c];f[e][c]=d instanceof THREE.Color||d instanceof THREE.Vector3||d instanceof THREE.Texture?d.clone():d}}return f}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function e(A,S,J){var I,P,ea,aa=A.vertices,Z=aa.length,ja=A.colors,na=ja.length,R=A.__vertexArray,ga=A.__colorArray,ma=A.__sortArray,ra=A.__dirtyVertices,oa=A.__dirtyColors;if(J.sortParticles){Da.multiplySelf(J.matrixWorld);for(I=0;I<Z;I++){P=aa[I].position;ya.copy(P);Da.multiplyVector3(ya);ma[I]=[ya.z,I]}ma.sort(function(Ea,wa){return wa[0]-Ea[0]});for(I=0;I<Z;I++){P=aa[ma[I][1]].position;ea=I*3;R[ea]=P.x;R[ea+1]=P.y;R[ea+2]=P.z}for(I=0;I<na;I++){ea=I*3;color=ja[ma[I][1]];
ga[ea]=color.r;ga[ea+1]=color.g;ga[ea+2]=color.b}}else{if(ra)for(I=0;I<Z;I++){P=aa[I].position;ea=I*3;R[ea]=P.x;R[ea+1]=P.y;R[ea+2]=P.z}if(oa)for(I=0;I<na;I++){color=ja[I];ea=I*3;ga[ea]=color.r;ga[ea+1]=color.g;ga[ea+2]=color.b}}if(ra||J.sortParticles){p.bindBuffer(p.ARRAY_BUFFER,A.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,R,S)}if(oa||J.sortParticles){p.bindBuffer(p.ARRAY_BUFFER,A.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,ga,S)}}function c(A,S,J,I,P){I.program||N.initMaterial(I,S,J,P);
var ea=I.program,aa=ea.uniforms,Z=I.uniforms;if(ea!=L){p.useProgram(ea);L=ea}p.uniformMatrix4fv(aa.projectionMatrix,!1,Ba);if(J&&(I instanceof THREE.MeshBasicMaterial||I instanceof THREE.MeshLambertMaterial||I instanceof THREE.MeshPhongMaterial||I instanceof THREE.LineBasicMaterial||I instanceof THREE.ParticleBasicMaterial||I.fog)){Z.fogColor.value=J.color;if(J instanceof THREE.Fog){Z.fogNear.value=J.near;Z.fogFar.value=J.far}else if(J instanceof THREE.FogExp2)Z.fogDensity.value=J.density}if(I instanceof
THREE.MeshPhongMaterial||I instanceof THREE.MeshLambertMaterial||I.lights){var ja,na,R=0,ga=0,ma=0,ra,oa,Ea,wa,Ga=V,Ua=Ga.directional.colors,eb=Ga.directional.positions,xa=Ga.point.colors,za=Ga.point.positions,Aa=Ga.point.distances,Na=0,X=0;J=0;for(ja=S.length;J<ja;J++){na=S[J];ra=na.color;oa=na.position;Ea=na.intensity;wa=na.distance;if(na instanceof THREE.AmbientLight){R+=ra.r;ga+=ra.g;ma+=ra.b}else if(na instanceof THREE.DirectionalLight){wa=Na*3;Ua[wa]=ra.r*Ea;Ua[wa+1]=ra.g*Ea;Ua[wa+2]=ra.b*Ea;
eb[wa]=oa.x;eb[wa+1]=oa.y;eb[wa+2]=oa.z;Na+=1}else if(na instanceof THREE.PointLight){na=X*3;xa[na]=ra.r*Ea;xa[na+1]=ra.g*Ea;xa[na+2]=ra.b*Ea;za[na]=oa.x;za[na+1]=oa.y;za[na+2]=oa.z;Aa[X]=wa;X+=1}}for(J=Na*3;J<Ua.length;J++)Ua[J]=0;for(J=X*3;J<xa.length;J++)xa[J]=0;Ga.point.length=X;Ga.directional.length=Na;Ga.ambient[0]=R;Ga.ambient[1]=ga;Ga.ambient[2]=ma;J=V;Z.enableLighting.value=J.directional.length+J.point.length;Z.ambientLightColor.value=J.ambient;Z.directionalLightColor.value=J.directional.colors;
Z.directionalLightDirection.value=J.directional.positions;Z.pointLightColor.value=J.point.colors;Z.pointLightPosition.value=J.point.positions;Z.pointLightDistance.value=J.point.distances}if(I instanceof THREE.MeshBasicMaterial||I instanceof THREE.MeshLambertMaterial||I instanceof THREE.MeshPhongMaterial){Z.diffuse.value=I.color;Z.opacity.value=I.opacity;Z.map.texture=I.map;Z.lightMap.texture=I.lightMap;Z.envMap.texture=I.envMap;Z.reflectivity.value=I.reflectivity;Z.refractionRatio.value=I.refractionRatio;
Z.combine.value=I.combine;Z.useRefract.value=I.envMap&&I.envMap.mapping instanceof THREE.CubeRefractionMapping}if(I instanceof THREE.LineBasicMaterial){Z.diffuse.value=I.color;Z.opacity.value=I.opacity}else if(I instanceof THREE.ParticleBasicMaterial){Z.psColor.value=I.color;Z.opacity.value=I.opacity;Z.size.value=I.size;Z.scale.value=O.height/2;Z.map.texture=I.map}else if(I instanceof THREE.MeshPhongMaterial){Z.ambient.value=I.ambient;Z.specular.value=I.specular;Z.shininess.value=I.shininess}else if(I instanceof
THREE.MeshDepthMaterial){Z.mNear.value=A.near;Z.mFar.value=A.far;Z.opacity.value=I.opacity}else if(I instanceof THREE.MeshNormalMaterial)Z.opacity.value=I.opacity;for(var pa in Z)if(ga=ea.uniforms[pa]){ja=Z[pa];R=ja.type;J=ja.value;if(R=="i")p.uniform1i(ga,J);else if(R=="f")p.uniform1f(ga,J);else if(R=="fv1")p.uniform1fv(ga,J);else if(R=="fv")p.uniform3fv(ga,J);else if(R=="v2")p.uniform2f(ga,J.x,J.y);else if(R=="v3")p.uniform3f(ga,J.x,J.y,J.z);else if(R=="v4")p.uniform4f(ga,J.x,J.y,J.z,J.w);else if(R==
"c")p.uniform3f(ga,J.r,J.g,J.b);else if(R=="t"){p.uniform1i(ga,J);if(ja=ja.texture)if(ja.image instanceof Array&&ja.image.length==6){if(ja.image.length==6){if(ja.needsUpdate){if(ja.__webglInit){p.bindTexture(p.TEXTURE_CUBE_MAP,ja.image.__webglTextureCube);for(R=0;R<6;++R)p.texSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,0,0,p.RGBA,p.UNSIGNED_BYTE,ja.image[R])}else{ja.image.__webglTextureCube=p.createTexture();p.bindTexture(p.TEXTURE_CUBE_MAP,ja.image.__webglTextureCube);for(R=0;R<6;++R)p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+
R,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,ja.image[R]);ja.__webglInit=!0}F(p.TEXTURE_CUBE_MAP,ja,ja.image[0]);p.bindTexture(p.TEXTURE_CUBE_MAP,null);ja.needsUpdate=!1}p.activeTexture(p.TEXTURE0+J);p.bindTexture(p.TEXTURE_CUBE_MAP,ja.image.__webglTextureCube)}}else D(ja,J)}}p.uniformMatrix4fv(aa.modelViewMatrix,!1,P._modelViewMatrixArray);p.uniformMatrix3fv(aa.normalMatrix,!1,P._normalMatrixArray);(I instanceof THREE.MeshShaderMaterial||I instanceof THREE.MeshPhongMaterial||I.envMap)&&aa.cameraPosition!==
null&&p.uniform3f(aa.cameraPosition,A.position.x,A.position.y,A.position.z);(I instanceof THREE.MeshShaderMaterial||I.envMap||I.skinning)&&aa.objectMatrix!==null&&p.uniformMatrix4fv(aa.objectMatrix,!1,P._objectMatrixArray);(I instanceof THREE.MeshPhongMaterial||I instanceof THREE.MeshLambertMaterial||I instanceof THREE.MeshShaderMaterial||I.skinning)&&aa.viewMatrix!==null&&p.uniformMatrix4fv(aa.viewMatrix,!1,Fa);if(I instanceof THREE.ShadowVolumeDynamicMaterial){A=Z.directionalLightDirection.value;
A[0]=-S[1].position.x;A[1]=-S[1].position.y;A[2]=-S[1].position.z;p.uniform3fv(aa.directionalLightDirection,A);p.uniformMatrix4fv(aa.objectMatrix,!1,P._objectMatrixArray);p.uniformMatrix4fv(aa.viewMatrix,!1,Fa)}if(I.skinning){p.uniformMatrix4fv(aa.cameraInverseMatrix,!1,Fa);p.uniformMatrix4fv(aa.boneGlobalMatrices,!1,P.boneMatrices)}return ea}function d(A,S,J,I,P,ea){if(I.opacity!=0){var aa;A=c(A,S,J,I,ea).attributes;if(!I.morphTargets&&A.position>=0){p.bindBuffer(p.ARRAY_BUFFER,P.__webglVertexBuffer);
p.vertexAttribPointer(A.position,3,p.FLOAT,!1,0,0)}else{S=I.program.attributes;if(ea.morphTargetBase!==-1){p.bindBuffer(p.ARRAY_BUFFER,P.__webglMorphTargetsBuffers[ea.morphTargetBase]);p.vertexAttribPointer(S.position,3,p.FLOAT,!1,0,0)}else if(S.position>=0){p.bindBuffer(p.ARRAY_BUFFER,P.__webglVertexBuffer);p.vertexAttribPointer(S.position,3,p.FLOAT,!1,0,0)}if(ea.morphTargetForcedOrder.length){J=0;for(var Z=ea.morphTargetForcedOrder,ja=ea.morphTargetInfluences;J<I.numSupportedMorphTargets&&J<Z.length;){p.bindBuffer(p.ARRAY_BUFFER,
P.__webglMorphTargetsBuffers[Z[J]]);p.vertexAttribPointer(S["morphTarget"+J],3,p.FLOAT,!1,0,0);ea.__webglMorphTargetInfluences[J]=ja[Z[J]];J++}}else{Z=[];var na=-1,R=0;ja=ea.morphTargetInfluences;var ga,ma=ja.length;J=0;for(ea.morphTargetBase!==-1&&(Z[ea.morphTargetBase]=!0);J<I.numSupportedMorphTargets;){for(ga=0;ga<ma;ga++)if(!Z[ga]&&ja[ga]>na){R=ga;na=ja[R]}p.bindBuffer(p.ARRAY_BUFFER,P.__webglMorphTargetsBuffers[R]);p.vertexAttribPointer(S["morphTarget"+J],3,p.FLOAT,!1,0,0);ea.__webglMorphTargetInfluences[J]=
na;Z[R]=1;na=-1;J++}}I.program.uniforms.morphTargetInfluences!==null&&p.uniform1fv(I.program.uniforms.morphTargetInfluences,ea.__webglMorphTargetInfluences)}if(I.attributes)for(aa in I.attributes)if(A[aa]!==undefined&&A[aa]>=0){S=I.attributes[aa];if(S.buffer){p.bindBuffer(p.ARRAY_BUFFER,S.buffer);p.vertexAttribPointer(A[aa],S.size,p.FLOAT,!1,0,0)}}if(A.color>=0){p.bindBuffer(p.ARRAY_BUFFER,P.__webglColorBuffer);p.vertexAttribPointer(A.color,3,p.FLOAT,!1,0,0)}if(A.normal>=0){p.bindBuffer(p.ARRAY_BUFFER,
P.__webglNormalBuffer);p.vertexAttribPointer(A.normal,3,p.FLOAT,!1,0,0)}if(A.tangent>=0){p.bindBuffer(p.ARRAY_BUFFER,P.__webglTangentBuffer);p.vertexAttribPointer(A.tangent,4,p.FLOAT,!1,0,0)}if(A.uv>=0)if(P.__webglUVBuffer){p.bindBuffer(p.ARRAY_BUFFER,P.__webglUVBuffer);p.vertexAttribPointer(A.uv,2,p.FLOAT,!1,0,0);p.enableVertexAttribArray(A.uv)}else p.disableVertexAttribArray(A.uv);if(A.uv2>=0)if(P.__webglUV2Buffer){p.bindBuffer(p.ARRAY_BUFFER,P.__webglUV2Buffer);p.vertexAttribPointer(A.uv2,2,p.FLOAT,
!1,0,0);p.enableVertexAttribArray(A.uv2)}else p.disableVertexAttribArray(A.uv2);if(I.skinning&&A.skinVertexA>=0&&A.skinVertexB>=0&&A.skinIndex>=0&&A.skinWeight>=0){p.bindBuffer(p.ARRAY_BUFFER,P.__webglSkinVertexABuffer);p.vertexAttribPointer(A.skinVertexA,4,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,P.__webglSkinVertexBBuffer);p.vertexAttribPointer(A.skinVertexB,4,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,P.__webglSkinIndicesBuffer);p.vertexAttribPointer(A.skinIndex,4,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,
P.__webglSkinWeightsBuffer);p.vertexAttribPointer(A.skinWeight,4,p.FLOAT,!1,0,0)}if(ea instanceof THREE.Mesh){if(I.wireframe){p.lineWidth(I.wireframeLinewidth);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,P.__webglLineBuffer);p.drawElements(p.LINES,P.__webglLineCount,p.UNSIGNED_SHORT,0)}else{p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,P.__webglFaceBuffer);p.drawElements(p.TRIANGLES,P.__webglFaceCount,p.UNSIGNED_SHORT,0)}N.data.vertices+=P.__webglFaceCount;N.data.faces+=P.__webglFaceCount/3;N.data.drawCalls++}else if(ea instanceof
THREE.Line){ea=ea.type==THREE.LineStrip?p.LINE_STRIP:p.LINES;p.lineWidth(I.linewidth);p.drawArrays(ea,0,P.__webglLineCount);N.data.drawCalls++}else if(ea instanceof THREE.ParticleSystem){p.drawArrays(p.POINTS,0,P.__webglParticleCount);N.data.drawCalls++}else if(ea instanceof THREE.Ribbon){p.drawArrays(p.TRIANGLE_STRIP,0,P.__webglVertexCount);N.data.drawCalls++}}}function f(A,S,J){if(!A.__webglVertexBuffer)A.__webglVertexBuffer=p.createBuffer();if(!A.__webglNormalBuffer)A.__webglNormalBuffer=p.createBuffer();
if(A.hasPos){p.bindBuffer(p.ARRAY_BUFFER,A.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,A.positionArray,p.DYNAMIC_DRAW);p.enableVertexAttribArray(S.attributes.position);p.vertexAttribPointer(S.attributes.position,3,p.FLOAT,!1,0,0)}if(A.hasNormal){p.bindBuffer(p.ARRAY_BUFFER,A.__webglNormalBuffer);if(J==THREE.FlatShading){var I,P,ea,aa,Z,ja,na,R,ga,ma,ra=A.count*3;for(ma=0;ma<ra;ma+=9){J=A.normalArray;I=J[ma];P=J[ma+1];ea=J[ma+2];aa=J[ma+3];ja=J[ma+4];R=J[ma+5];Z=J[ma+6];na=J[ma+7];ga=J[ma+8];
I=(I+aa+Z)/3;P=(P+ja+na)/3;ea=(ea+R+ga)/3;J[ma]=I;J[ma+1]=P;J[ma+2]=ea;J[ma+3]=I;J[ma+4]=P;J[ma+5]=ea;J[ma+6]=I;J[ma+7]=P;J[ma+8]=ea}}p.bufferData(p.ARRAY_BUFFER,A.normalArray,p.DYNAMIC_DRAW);p.enableVertexAttribArray(S.attributes.normal);p.vertexAttribPointer(S.attributes.normal,3,p.FLOAT,!1,0,0)}p.drawArrays(p.TRIANGLES,0,A.count);A.count=0}function g(A){if(da!=A.doubleSided){A.doubleSided?p.disable(p.CULL_FACE):p.enable(p.CULL_FACE);da=A.doubleSided}if(ka!=A.flipSided){A.flipSided?p.frontFace(p.CW):
p.frontFace(p.CCW);ka=A.flipSided}}function m(A){if(ha!=A){A?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST);ha=A}}function n(A){ta[0].set(A.n41-A.n11,A.n42-A.n12,A.n43-A.n13,A.n44-A.n14);ta[1].set(A.n41+A.n11,A.n42+A.n12,A.n43+A.n13,A.n44+A.n14);ta[2].set(A.n41+A.n21,A.n42+A.n22,A.n43+A.n23,A.n44+A.n24);ta[3].set(A.n41-A.n21,A.n42-A.n22,A.n43-A.n23,A.n44-A.n24);ta[4].set(A.n41-A.n31,A.n42-A.n32,A.n43-A.n33,A.n44-A.n34);ta[5].set(A.n41+A.n31,A.n42+A.n32,A.n43+A.n33,A.n44+A.n34);var S;for(A=0;A<6;A++){S=
ta[A];S.divideScalar(Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z))}}function h(A){for(var S=A.matrixWorld,J=-A.geometry.boundingSphere.radius*Math.max(A.scale.x,Math.max(A.scale.y,A.scale.z)),I=0;I<6;I++){A=ta[I].x*S.n14+ta[I].y*S.n24+ta[I].z*S.n34+ta[I].w;if(A<=J)return!1}return!0}function o(A,S){A.list[A.count]=S;A.count+=1}function t(A){var S,J,I=A.object,P=A.opaque,ea=A.transparent;ea.count=0;A=P.count=0;for(S=I.materials.length;A<S;A++){J=I.materials[A];J.transparent?o(ea,J):o(P,J)}}function u(A){var S,
J,I,P,ea=A.object,aa=A.buffer,Z=A.opaque,ja=A.transparent;ja.count=0;A=Z.count=0;for(I=ea.materials.length;A<I;A++){S=ea.materials[A];if(S instanceof THREE.MeshFaceMaterial){S=0;for(J=aa.materials.length;S<J;S++)(P=aa.materials[S])&&(P.transparent?o(ja,P):o(Z,P))}else(P=S)&&(P.transparent?o(ja,P):o(Z,P))}}function v(A,S){return S.z-A.z}function w(A){p.enable(p.POLYGON_OFFSET_FILL);p.polygonOffset(0.1,1);p.enable(p.STENCIL_TEST);p.enable(p.DEPTH_TEST);p.depthMask(!1);p.colorMask(!1,!1,!1,!1);p.stencilFunc(p.ALWAYS,
1,255);p.stencilOpSeparate(p.BACK,p.KEEP,p.INCR,p.KEEP);p.stencilOpSeparate(p.FRONT,p.KEEP,p.DECR,p.KEEP);var S,J=A.lights.length,I,P=A.lights,ea=[],aa,Z,ja,na,R,ga=A.__webglShadowVolumes.length;for(S=0;S<J;S++){I=A.lights[S];if(I instanceof THREE.DirectionalLight&&I.castShadow){ea[0]=-I.position.x;ea[1]=-I.position.y;ea[2]=-I.position.z;for(R=0;R<ga;R++){I=A.__webglShadowVolumes[R].object;aa=A.__webglShadowVolumes[R].buffer;Z=I.materials[0];Z.program||N.initMaterial(Z,P,undefined,I);Z=Z.program;
ja=Z.uniforms;na=Z.attributes;if(L!==Z){p.useProgram(Z);L=Z;p.uniformMatrix4fv(ja.projectionMatrix,!1,Ba);p.uniformMatrix4fv(ja.viewMatrix,!1,Fa);p.uniform3fv(ja.directionalLightDirection,ea)}I.matrixWorld.flattenToArray(I._objectMatrixArray);p.uniformMatrix4fv(ja.objectMatrix,!1,I._objectMatrixArray);p.bindBuffer(p.ARRAY_BUFFER,aa.__webglVertexBuffer);p.vertexAttribPointer(na.position,3,p.FLOAT,!1,0,0);p.bindBuffer(p.ARRAY_BUFFER,aa.__webglNormalBuffer);p.vertexAttribPointer(na.normal,3,p.FLOAT,
!1,0,0);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,aa.__webglFaceBuffer);p.cullFace(p.FRONT);p.drawElements(p.TRIANGLES,aa.__webglFaceCount,p.UNSIGNED_SHORT,0);p.cullFace(p.BACK);p.drawElements(p.TRIANGLES,aa.__webglFaceCount,p.UNSIGNED_SHORT,0)}}}p.disable(p.POLYGON_OFFSET_FILL);p.colorMask(!0,!0,!0,!0);p.stencilFunc(p.NOTEQUAL,0,255);p.stencilOp(p.KEEP,p.KEEP,p.KEEP);p.disable(p.DEPTH_TEST);$=-1;L=fa.program;p.useProgram(fa.program);p.uniformMatrix4fv(fa.projectionLocation,!1,Ba);p.uniform1f(fa.darknessLocation,
fa.darkness);p.bindBuffer(p.ARRAY_BUFFER,fa.vertexBuffer);p.vertexAttribPointer(fa.vertexLocation,3,p.FLOAT,!1,0,0);p.enableVertexAttribArray(fa.vertexLocation);p.blendFunc(p.ONE,p.ONE_MINUS_SRC_ALPHA);p.blendEquation(p.FUNC_ADD);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,fa.elementBuffer);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);p.disable(p.STENCIL_TEST);p.enable(p.DEPTH_TEST);p.depthMask(M)}function x(A,S){var J,I,P;J=_sprite.attributes;var ea=_sprite.uniforms,aa=ua/va,Z,ja=[],na=va*0.5,R=ua*0.5,
ga=!0;p.useProgram(_sprite.program);L=_sprite.program;$=-1;if(!Va){p.enableVertexAttribArray(_sprite.attributes.position);p.enableVertexAttribArray(_sprite.attributes.uv);Va=!0}p.disable(p.CULL_FACE);p.enable(p.BLEND);p.depthMask(!0);p.bindBuffer(p.ARRAY_BUFFER,_sprite.vertexBuffer);p.vertexAttribPointer(J.position,2,p.FLOAT,!1,16,0);p.vertexAttribPointer(J.uv,2,p.FLOAT,!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);p.uniformMatrix4fv(ea.projectionMatrix,!1,Ba);p.activeTexture(p.TEXTURE0);
p.uniform1i(ea.map,0);J=0;for(I=A.__webglSprites.length;J<I;J++){P=A.__webglSprites[J];if(P.useScreenCoordinates)P.z=-P.position.z;else{P._modelViewMatrix.multiplyToArray(S.matrixWorldInverse,P.matrixWorld,P._modelViewMatrixArray);P.z=-P._modelViewMatrix.n34}}A.__webglSprites.sort(v);J=0;for(I=A.__webglSprites.length;J<I;J++){P=A.__webglSprites[J];if(P.material===undefined&&P.map&&P.map.image&&P.map.image.width){if(P.useScreenCoordinates){p.uniform1i(ea.useScreenCoordinates,1);p.uniform3f(ea.screenPosition,
(P.position.x-na)/na,(R-P.position.y)/R,Math.max(0,Math.min(1,P.position.z)))}else{p.uniform1i(ea.useScreenCoordinates,0);p.uniform1i(ea.affectedByDistance,P.affectedByDistance?1:0);p.uniformMatrix4fv(ea.modelViewMatrix,!1,P._modelViewMatrixArray)}Z=P.map.image.width/(P.affectedByDistance?1:ua);ja[0]=Z*aa*P.scale.x;ja[1]=Z*P.scale.y;p.uniform2f(ea.uvScale,P.uvScale.x,P.uvScale.y);p.uniform2f(ea.uvOffset,P.uvOffset.x,P.uvOffset.y);p.uniform2f(ea.alignment,P.alignment.x,P.alignment.y);p.uniform1f(ea.opacity,
P.opacity);p.uniform1f(ea.rotation,P.rotation);p.uniform2fv(ea.scale,ja);if(P.mergeWith3D&&!ga){p.enable(p.DEPTH_TEST);ga=!0}else if(!P.mergeWith3D&&ga){p.disable(p.DEPTH_TEST);ga=!1}E(P.blending);D(P.map,0);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0)}}p.enable(p.CULL_FACE);p.enable(p.DEPTH_TEST);p.depthMask(M)}function y(A,S){var J,I,P=A.__webglLensFlares.length,ea,aa,Z,ja=new THREE.Vector3,na=ua/va,R=va*0.5,ga=ua*0.5,ma=16/ua,ra=[ma*na,ma],oa=[1,1,0],Ea=[1,1],wa=ca.uniforms;J=ca.attributes;
p.useProgram(ca.program);L=ca.program;$=-1;if(!Ca){p.enableVertexAttribArray(ca.attributes.vertex);p.enableVertexAttribArray(ca.attributes.uv);Ca=!0}p.uniform1i(wa.occlusionMap,0);p.uniform1i(wa.map,1);p.bindBuffer(p.ARRAY_BUFFER,ca.vertexBuffer);p.vertexAttribPointer(J.vertex,2,p.FLOAT,!1,16,0);p.vertexAttribPointer(J.uv,2,p.FLOAT,!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);p.disable(p.CULL_FACE);p.depthMask(!1);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,ca.occlusionTexture);
p.activeTexture(p.TEXTURE1);for(I=0;I<P;I++){J=A.__webglLensFlares[I].object;ja.set(J.matrixWorld.n14,J.matrixWorld.n24,J.matrixWorld.n34);S.matrixWorldInverse.multiplyVector3(ja);S.projectionMatrix.multiplyVector3(ja);oa[0]=ja.x;oa[1]=ja.y;oa[2]=ja.z;Ea[0]=oa[0]*R+R;Ea[1]=oa[1]*ga+ga;if(ca.hasVertexTexture||Ea[0]>0&&Ea[0]<va&&Ea[1]>0&&Ea[1]<ua){p.bindTexture(p.TEXTURE_2D,ca.tempTexture);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,Ea[0]-8,Ea[1]-8,16,16,0);p.uniform1i(wa.renderType,0);p.uniform2fv(wa.scale,
ra);p.uniform3fv(wa.screenPosition,oa);p.disable(p.BLEND);p.enable(p.DEPTH_TEST);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);p.bindTexture(p.TEXTURE_2D,ca.occlusionTexture);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,Ea[0]-8,Ea[1]-8,16,16,0);p.uniform1i(wa.renderType,1);p.disable(p.DEPTH_TEST);p.bindTexture(p.TEXTURE_2D,ca.tempTexture);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);J.positionScreen.x=oa[0];J.positionScreen.y=oa[1];J.positionScreen.z=oa[2];J.customUpdateCallback?J.customUpdateCallback(J):
J.updateLensFlares();p.uniform1i(wa.renderType,2);p.enable(p.BLEND);ea=0;for(aa=J.lensFlares.length;ea<aa;ea++){Z=J.lensFlares[ea];if(Z.opacity>0.0010&&Z.scale>0.0010){oa[0]=Z.x;oa[1]=Z.y;oa[2]=Z.z;ma=Z.size*Z.scale/ua;ra[0]=ma*na;ra[1]=ma;p.uniform3fv(wa.screenPosition,oa);p.uniform2fv(wa.scale,ra);p.uniform1f(wa.rotation,Z.rotation);p.uniform1f(wa.opacity,Z.opacity);E(Z.blending);D(Z.texture,1);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0)}}}}p.enable(p.CULL_FACE);p.enable(p.DEPTH_TEST);p.depthMask(M)}
function C(A,S){A._modelViewMatrix.multiplyToArray(S.matrixWorldInverse,A.matrixWorld,A._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(A._modelViewMatrix).transposeIntoArray(A._normalMatrixArray)}function B(A){var S,J,I,P,ea;if(A instanceof THREE.Mesh){J=A.geometry;for(S in J.geometryGroups){I=J.geometryGroups[S];ea=!1;for(P in I.__webglCustomAttributes)if(I.__webglCustomAttributes[P].needsUpdate){ea=!0;break}if(J.__dirtyVertices||J.__dirtyMorphTargets||J.__dirtyElements||J.__dirtyUvs||J.__dirtyNormals||
J.__dirtyColors||J.__dirtyTangents||ea){ea=A;var aa=p.DYNAMIC_DRAW;if(I.__inittedArrays){var Z=void 0,ja=void 0,na=void 0,R=void 0,ga=void 0,ma=void 0,ra=void 0,oa=void 0,Ea=void 0,wa=void 0,Ga=void 0,Ua=void 0,eb=void 0,xa=void 0,za=void 0,Aa=void 0,Na=void 0,X=void 0,pa=void 0,K=void 0,bb=void 0,fb=void 0,Oa=0,Qa=0,ib=0,jb=0,Xa=0,Ya=0,Ha=0,Za=0,Pa=0,la=0,Ra=0,Sa=I.__vertexArray,pb=I.__uvArray,qb=I.__uv2Array,cb=I.__normalArray,Ia=I.__tangentArray,Ta=I.__colorArray,Ja=I.__skinVertexAArray,Ka=I.__skinVertexBArray,
La=I.__skinIndexArray,Ma=I.__skinWeightArray,rb=I.__morphTargetsArrays,db=I.__webglCustomAttributes,$a=I.__faceArray,ab=I.__lineArray,yb=I.__needsSmoothNormals;wa=I.__vertexColorType;Ea=I.__uvType;Ga=I.__normalType;var Wa=ea.geometry,sb=Wa.__dirtyVertices,tb=Wa.__dirtyElements,ob=Wa.__dirtyUvs,ub=Wa.__dirtyNormals,vb=Wa.__dirtyTangents,wb=Wa.__dirtyColors,xb=Wa.__dirtyMorphTargets,kb=Wa.vertices,zb=I.faces,Cb=Wa.faces,Ab=Wa.faceVertexUvs[0],Bb=Wa.faceVertexUvs[1],lb=Wa.skinVerticesA,mb=Wa.skinVerticesB,
nb=Wa.skinIndices,gb=Wa.skinWeights,hb=ea instanceof THREE.ShadowVolume?Wa.edgeFaces:undefined;morphTargets=Wa.morphTargets;if(db)for(fb in db){db[fb].offset=0;db[fb].offsetSrc=0}Z=0;for(ja=zb.length;Z<ja;Z++){na=zb[Z];R=Cb[na];Ab&&(Ua=Ab[na]);Bb&&(eb=Bb[na]);na=R.vertexNormals;ga=R.normal;ma=R.vertexColors;ra=R.color;oa=R.vertexTangents;if(R instanceof THREE.Face3){if(sb){xa=kb[R.a].position;za=kb[R.b].position;Aa=kb[R.c].position;Sa[Qa]=xa.x;Sa[Qa+1]=xa.y;Sa[Qa+2]=xa.z;Sa[Qa+3]=za.x;Sa[Qa+4]=za.y;
Sa[Qa+5]=za.z;Sa[Qa+6]=Aa.x;Sa[Qa+7]=Aa.y;Sa[Qa+8]=Aa.z;Qa+=9}if(db)for(fb in db){K=db[fb];if(K.needsUpdate){X=K.offset;pa=K.offsetSrc;if(K.size===1){if(K.boundTo===undefined||K.boundTo==="vertices"){K.array[X+0]=K.value[R.a];K.array[X+1]=K.value[R.b];K.array[X+2]=K.value[R.c]}else if(K.boundTo==="faces"){K.array[X+0]=K.value[pa];K.array[X+1]=K.value[pa];K.array[X+2]=K.value[pa];K.offsetSrc++}else if(K.boundTo==="faceVertices"){K.array[X+0]=K.value[pa+0];K.array[X+1]=K.value[pa+1];K.array[X+2]=K.value[pa+
2];K.offsetSrc+=3}K.offset+=3}else{if(K.boundTo===undefined||K.boundTo==="vertices"){xa=K.value[R.a];za=K.value[R.b];Aa=K.value[R.c]}else if(K.boundTo==="faces"){xa=K.value[pa];za=K.value[pa];Aa=K.value[pa];K.offsetSrc++}else if(K.boundTo==="faceVertices"){xa=K.value[pa+0];za=K.value[pa+1];Aa=K.value[pa+2];K.offsetSrc+=3}if(K.size===2){K.array[X+0]=xa.x;K.array[X+1]=xa.y;K.array[X+2]=za.x;K.array[X+3]=za.y;K.array[X+4]=Aa.x;K.array[X+5]=Aa.y;K.offset+=6}else if(K.size===3){if(K.type==="c"){K.array[X+
0]=xa.r;K.array[X+1]=xa.g;K.array[X+2]=xa.b;K.array[X+3]=za.r;K.array[X+4]=za.g;K.array[X+5]=za.b;K.array[X+6]=Aa.r;K.array[X+7]=Aa.g;K.array[X+8]=Aa.b}else{K.array[X+0]=xa.x;K.array[X+1]=xa.y;K.array[X+2]=xa.z;K.array[X+3]=za.x;K.array[X+4]=za.y;K.array[X+5]=za.z;K.array[X+6]=Aa.x;K.array[X+7]=Aa.y;K.array[X+8]=Aa.z}K.offset+=9}else{K.array[X+0]=xa.x;K.array[X+1]=xa.y;K.array[X+2]=xa.z;K.array[X+3]=xa.w;K.array[X+4]=za.x;K.array[X+5]=za.y;K.array[X+6]=za.z;K.array[X+7]=za.w;K.array[X+8]=Aa.x;K.array[X+
9]=Aa.y;K.array[X+10]=Aa.z;K.array[X+11]=Aa.w;K.offset+=12}}}}if(xb){X=0;for(pa=morphTargets.length;X<pa;X++){xa=morphTargets[X].vertices[R.a].position;za=morphTargets[X].vertices[R.b].position;Aa=morphTargets[X].vertices[R.c].position;K=rb[X];K[Ra+0]=xa.x;K[Ra+1]=xa.y;K[Ra+2]=xa.z;K[Ra+3]=za.x;K[Ra+4]=za.y;K[Ra+5]=za.z;K[Ra+6]=Aa.x;K[Ra+7]=Aa.y;K[Ra+8]=Aa.z}Ra+=9}if(gb.length){X=gb[R.a];pa=gb[R.b];K=gb[R.c];Ma[la]=X.x;Ma[la+1]=X.y;Ma[la+2]=X.z;Ma[la+3]=X.w;Ma[la+4]=pa.x;Ma[la+5]=pa.y;Ma[la+6]=pa.z;
Ma[la+7]=pa.w;Ma[la+8]=K.x;Ma[la+9]=K.y;Ma[la+10]=K.z;Ma[la+11]=K.w;X=nb[R.a];pa=nb[R.b];K=nb[R.c];La[la]=X.x;La[la+1]=X.y;La[la+2]=X.z;La[la+3]=X.w;La[la+4]=pa.x;La[la+5]=pa.y;La[la+6]=pa.z;La[la+7]=pa.w;La[la+8]=K.x;La[la+9]=K.y;La[la+10]=K.z;La[la+11]=K.w;X=lb[R.a];pa=lb[R.b];K=lb[R.c];Ja[la]=X.x;Ja[la+1]=X.y;Ja[la+2]=X.z;Ja[la+3]=1;Ja[la+4]=pa.x;Ja[la+5]=pa.y;Ja[la+6]=pa.z;Ja[la+7]=1;Ja[la+8]=K.x;Ja[la+9]=K.y;Ja[la+10]=K.z;Ja[la+11]=1;X=mb[R.a];pa=mb[R.b];K=mb[R.c];Ka[la]=X.x;Ka[la+1]=X.y;Ka[la+
2]=X.z;Ka[la+3]=1;Ka[la+4]=pa.x;Ka[la+5]=pa.y;Ka[la+6]=pa.z;Ka[la+7]=1;Ka[la+8]=K.x;Ka[la+9]=K.y;Ka[la+10]=K.z;Ka[la+11]=1;la+=12}if(wb&&wa){if(ma.length==3&&wa==THREE.VertexColors){R=ma[0];X=ma[1];pa=ma[2]}else pa=X=R=ra;Ta[Pa]=R.r;Ta[Pa+1]=R.g;Ta[Pa+2]=R.b;Ta[Pa+3]=X.r;Ta[Pa+4]=X.g;Ta[Pa+5]=X.b;Ta[Pa+6]=pa.r;Ta[Pa+7]=pa.g;Ta[Pa+8]=pa.b;Pa+=9}if(vb&&Wa.hasTangents){ma=oa[0];ra=oa[1];R=oa[2];Ia[Ha]=ma.x;Ia[Ha+1]=ma.y;Ia[Ha+2]=ma.z;Ia[Ha+3]=ma.w;Ia[Ha+4]=ra.x;Ia[Ha+5]=ra.y;Ia[Ha+6]=ra.z;Ia[Ha+7]=ra.w;
Ia[Ha+8]=R.x;Ia[Ha+9]=R.y;Ia[Ha+10]=R.z;Ia[Ha+11]=R.w;Ha+=12}if(ub&&Ga)if(na.length==3&&yb)for(oa=0;oa<3;oa++){ga=na[oa];cb[Ya]=ga.x;cb[Ya+1]=ga.y;cb[Ya+2]=ga.z;Ya+=3}else for(oa=0;oa<3;oa++){cb[Ya]=ga.x;cb[Ya+1]=ga.y;cb[Ya+2]=ga.z;Ya+=3}if(ob&&Ua!==undefined&&Ea)for(oa=0;oa<3;oa++){na=Ua[oa];pb[ib]=na.u;pb[ib+1]=na.v;ib+=2}if(ob&&eb!==undefined&&Ea)for(oa=0;oa<3;oa++){na=eb[oa];qb[jb]=na.u;qb[jb+1]=na.v;jb+=2}if(tb){$a[Xa]=Oa;$a[Xa+1]=Oa+1;$a[Xa+2]=Oa+2;Xa+=3;ab[Za]=Oa;ab[Za+1]=Oa+1;ab[Za+2]=Oa;
ab[Za+3]=Oa+2;ab[Za+4]=Oa+1;ab[Za+5]=Oa+2;Za+=6;Oa+=3}}else if(R instanceof THREE.Face4){if(sb){xa=kb[R.a].position;za=kb[R.b].position;Aa=kb[R.c].position;Na=kb[R.d].position;Sa[Qa]=xa.x;Sa[Qa+1]=xa.y;Sa[Qa+2]=xa.z;Sa[Qa+3]=za.x;Sa[Qa+4]=za.y;Sa[Qa+5]=za.z;Sa[Qa+6]=Aa.x;Sa[Qa+7]=Aa.y;Sa[Qa+8]=Aa.z;Sa[Qa+9]=Na.x;Sa[Qa+10]=Na.y;Sa[Qa+11]=Na.z;Qa+=12}if(db)for(fb in db){K=db[fb];if(K.needsUpdate){X=K.offset;pa=K.offsetSrc;if(K.size===1){if(K.boundTo===undefined||K.boundTo==="vertices"){K.array[X+0]=
K.value[R.a];K.array[X+1]=K.value[R.b];K.array[X+2]=K.value[R.c];K.array[X+3]=K.value[R.d]}else if(K.boundTo==="faces"){K.array[X+0]=K.value[pa];K.array[X+1]=K.value[pa];K.array[X+2]=K.value[pa];K.array[X+3]=K.value[pa];K.offsetSrc++}else if(K.boundTo==="faceVertices"){K.array[X+0]=K.value[pa+0];K.array[X+1]=K.value[pa+1];K.array[X+2]=K.value[pa+2];K.array[X+3]=K.value[pa+3];K.offsetSrc+=4}K.offset+=4}else{if(K.boundTo===undefined||K.boundTo==="vertices"){xa=K.value[R.a];za=K.value[R.b];Aa=K.value[R.c];
Na=K.value[R.d]}else if(K.boundTo==="faces"){xa=K.value[pa];za=K.value[pa];Aa=K.value[pa];Na=K.value[pa];K.offsetSrc++}else if(K.boundTo==="faceVertices"){xa=K.value[pa+0];za=K.value[pa+1];Aa=K.value[pa+2];Na=K.value[pa+3];K.offsetSrc+=4}if(K.size===2){K.array[X+0]=xa.x;K.array[X+1]=xa.y;K.array[X+2]=za.x;K.array[X+3]=za.y;K.array[X+4]=Aa.x;K.array[X+5]=Aa.y;K.array[X+6]=Na.x;K.array[X+7]=Na.y;K.offset+=8}else if(K.size===3){if(K.type==="c"){K.array[X+0]=xa.r;K.array[X+1]=xa.g;K.array[X+2]=xa.b;K.array[X+
3]=za.r;K.array[X+4]=za.g;K.array[X+5]=za.b;K.array[X+6]=Aa.r;K.array[X+7]=Aa.g;K.array[X+8]=Aa.b;K.array[X+9]=Na.r;K.array[X+10]=Na.g;K.array[X+11]=Na.b}else{K.array[X+0]=xa.x;K.array[X+1]=xa.y;K.array[X+2]=xa.z;K.array[X+3]=za.x;K.array[X+4]=za.y;K.array[X+5]=za.z;K.array[X+6]=Aa.x;K.array[X+7]=Aa.y;K.array[X+8]=Aa.z;K.array[X+9]=Na.x;K.array[X+10]=Na.y;K.array[X+11]=Na.z}K.offset+=12}else{K.array[X+0]=xa.x;K.array[X+1]=xa.y;K.array[X+2]=xa.z;K.array[X+3]=xa.w;K.array[X+4]=za.x;K.array[X+5]=za.y;
K.array[X+6]=za.z;K.array[X+7]=za.w;K.array[X+8]=Aa.x;K.array[X+9]=Aa.y;K.array[X+10]=Aa.z;K.array[X+11]=Aa.w;K.array[X+12]=Na.x;K.array[X+13]=Na.y;K.array[X+14]=Na.z;K.array[X+15]=Na.w;K.offset+=16}}}}if(xb){X=0;for(pa=morphTargets.length;X<pa;X++){xa=morphTargets[X].vertices[R.a].position;za=morphTargets[X].vertices[R.b].position;Aa=morphTargets[X].vertices[R.c].position;Na=morphTargets[X].vertices[R.d].position;K=rb[X];K[Ra+0]=xa.x;K[Ra+1]=xa.y;K[Ra+2]=xa.z;K[Ra+3]=za.x;K[Ra+4]=za.y;K[Ra+5]=za.z;
K[Ra+6]=Aa.x;K[Ra+7]=Aa.y;K[Ra+8]=Aa.z;K[Ra+9]=Na.x;K[Ra+10]=Na.y;K[Ra+11]=Na.z}Ra+=12}if(gb.length){X=gb[R.a];pa=gb[R.b];K=gb[R.c];bb=gb[R.d];Ma[la]=X.x;Ma[la+1]=X.y;Ma[la+2]=X.z;Ma[la+3]=X.w;Ma[la+4]=pa.x;Ma[la+5]=pa.y;Ma[la+6]=pa.z;Ma[la+7]=pa.w;Ma[la+8]=K.x;Ma[la+9]=K.y;Ma[la+10]=K.z;Ma[la+11]=K.w;Ma[la+12]=bb.x;Ma[la+13]=bb.y;Ma[la+14]=bb.z;Ma[la+15]=bb.w;X=nb[R.a];pa=nb[R.b];K=nb[R.c];bb=nb[R.d];La[la]=X.x;La[la+1]=X.y;La[la+2]=X.z;La[la+3]=X.w;La[la+4]=pa.x;La[la+5]=pa.y;La[la+6]=pa.z;La[la+
7]=pa.w;La[la+8]=K.x;La[la+9]=K.y;La[la+10]=K.z;La[la+11]=K.w;La[la+12]=bb.x;La[la+13]=bb.y;La[la+14]=bb.z;La[la+15]=bb.w;X=lb[R.a];pa=lb[R.b];K=lb[R.c];bb=lb[R.d];Ja[la]=X.x;Ja[la+1]=X.y;Ja[la+2]=X.z;Ja[la+3]=1;Ja[la+4]=pa.x;Ja[la+5]=pa.y;Ja[la+6]=pa.z;Ja[la+7]=1;Ja[la+8]=K.x;Ja[la+9]=K.y;Ja[la+10]=K.z;Ja[la+11]=1;Ja[la+12]=bb.x;Ja[la+13]=bb.y;Ja[la+14]=bb.z;Ja[la+15]=1;X=mb[R.a];pa=mb[R.b];K=mb[R.c];R=mb[R.d];Ka[la]=X.x;Ka[la+1]=X.y;Ka[la+2]=X.z;Ka[la+3]=1;Ka[la+4]=pa.x;Ka[la+5]=pa.y;Ka[la+6]=pa.z;
Ka[la+7]=1;Ka[la+8]=K.x;Ka[la+9]=K.y;Ka[la+10]=K.z;Ka[la+11]=1;Ka[la+12]=R.x;Ka[la+13]=R.y;Ka[la+14]=R.z;Ka[la+15]=1;la+=16}if(wb&&wa){if(ma.length==4&&wa==THREE.VertexColors){R=ma[0];X=ma[1];pa=ma[2];ma=ma[3]}else ma=pa=X=R=ra;Ta[Pa]=R.r;Ta[Pa+1]=R.g;Ta[Pa+2]=R.b;Ta[Pa+3]=X.r;Ta[Pa+4]=X.g;Ta[Pa+5]=X.b;Ta[Pa+6]=pa.r;Ta[Pa+7]=pa.g;Ta[Pa+8]=pa.b;Ta[Pa+9]=ma.r;Ta[Pa+10]=ma.g;Ta[Pa+11]=ma.b;Pa+=12}if(vb&&Wa.hasTangents){ma=oa[0];ra=oa[1];R=oa[2];oa=oa[3];Ia[Ha]=ma.x;Ia[Ha+1]=ma.y;Ia[Ha+2]=ma.z;Ia[Ha+
3]=ma.w;Ia[Ha+4]=ra.x;Ia[Ha+5]=ra.y;Ia[Ha+6]=ra.z;Ia[Ha+7]=ra.w;Ia[Ha+8]=R.x;Ia[Ha+9]=R.y;Ia[Ha+10]=R.z;Ia[Ha+11]=R.w;Ia[Ha+12]=oa.x;Ia[Ha+13]=oa.y;Ia[Ha+14]=oa.z;Ia[Ha+15]=oa.w;Ha+=16}if(ub&&Ga)if(na.length==4&&yb)for(oa=0;oa<4;oa++){ga=na[oa];cb[Ya]=ga.x;cb[Ya+1]=ga.y;cb[Ya+2]=ga.z;Ya+=3}else for(oa=0;oa<4;oa++){cb[Ya]=ga.x;cb[Ya+1]=ga.y;cb[Ya+2]=ga.z;Ya+=3}if(ob&&Ua!==undefined&&Ea)for(oa=0;oa<4;oa++){na=Ua[oa];pb[ib]=na.u;pb[ib+1]=na.v;ib+=2}if(ob&&eb!==undefined&&Ea)for(oa=0;oa<4;oa++){na=eb[oa];
qb[jb]=na.u;qb[jb+1]=na.v;jb+=2}if(tb){$a[Xa]=Oa;$a[Xa+1]=Oa+1;$a[Xa+2]=Oa+3;$a[Xa+3]=Oa+1;$a[Xa+4]=Oa+2;$a[Xa+5]=Oa+3;Xa+=6;ab[Za]=Oa;ab[Za+1]=Oa+1;ab[Za+2]=Oa;ab[Za+3]=Oa+3;ab[Za+4]=Oa+1;ab[Za+5]=Oa+2;ab[Za+6]=Oa+2;ab[Za+7]=Oa+3;Za+=8;Oa+=4}}}if(hb){Z=0;for(ja=hb.length;Z<ja;Z++){$a[Xa]=hb[Z].a;$a[Xa+1]=hb[Z].b;$a[Xa+2]=hb[Z].c;$a[Xa+3]=hb[Z].a;$a[Xa+4]=hb[Z].c;$a[Xa+5]=hb[Z].d;Xa+=6}}if(sb){p.bindBuffer(p.ARRAY_BUFFER,I.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,Sa,aa)}if(db)for(fb in db){K=
db[fb];if(K.needsUpdate){p.bindBuffer(p.ARRAY_BUFFER,K.buffer);p.bufferData(p.ARRAY_BUFFER,K.array,aa);K.needsUpdate=!1}}if(xb){X=0;for(pa=morphTargets.length;X<pa;X++){p.bindBuffer(p.ARRAY_BUFFER,I.__webglMorphTargetsBuffers[X]);p.bufferData(p.ARRAY_BUFFER,rb[X],aa)}}if(wb&&Pa>0){p.bindBuffer(p.ARRAY_BUFFER,I.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,Ta,aa)}if(ub){p.bindBuffer(p.ARRAY_BUFFER,I.__webglNormalBuffer);p.bufferData(p.ARRAY_BUFFER,cb,aa)}if(vb&&Wa.hasTangents){p.bindBuffer(p.ARRAY_BUFFER,
I.__webglTangentBuffer);p.bufferData(p.ARRAY_BUFFER,Ia,aa)}if(ob&&ib>0){p.bindBuffer(p.ARRAY_BUFFER,I.__webglUVBuffer);p.bufferData(p.ARRAY_BUFFER,pb,aa)}if(ob&&jb>0){p.bindBuffer(p.ARRAY_BUFFER,I.__webglUV2Buffer);p.bufferData(p.ARRAY_BUFFER,qb,aa)}if(tb){p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,I.__webglFaceBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,$a,aa);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,I.__webglLineBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,ab,aa)}if(la>0){p.bindBuffer(p.ARRAY_BUFFER,I.__webglSkinVertexABuffer);
p.bufferData(p.ARRAY_BUFFER,Ja,aa);p.bindBuffer(p.ARRAY_BUFFER,I.__webglSkinVertexBBuffer);p.bufferData(p.ARRAY_BUFFER,Ka,aa);p.bindBuffer(p.ARRAY_BUFFER,I.__webglSkinIndicesBuffer);p.bufferData(p.ARRAY_BUFFER,La,aa);p.bindBuffer(p.ARRAY_BUFFER,I.__webglSkinWeightsBuffer);p.bufferData(p.ARRAY_BUFFER,Ma,aa)}if(!ea.dynamic){delete I.__inittedArrays;delete I.__colorArray;delete I.__normalArray;delete I.__tangentArray;delete I.__uvArray;delete I.__uv2Array;delete I.__faceArray;delete I.__vertexArray;
delete I.__lineArray;delete I.__skinVertexAArray;delete I.__skinVertexBArray;delete I.__skinIndexArray;delete I.__skinWeightArray}}}}J.__dirtyVertices=!1;J.__dirtyMorphTargets=!1;J.__dirtyElements=!1;J.__dirtyUvs=!1;J.__dirtyNormals=!1;J.__dirtyTangents=!1;J.__dirtyColors=!1}else if(A instanceof THREE.Ribbon){J=A.geometry;if(J.__dirtyVertices||J.__dirtyColors){A=J;S=p.DYNAMIC_DRAW;Ea=A.vertices;I=A.colors;wa=Ea.length;ea=I.length;Ga=A.__vertexArray;aa=A.__colorArray;Ua=A.__dirtyColors;if(A.__dirtyVertices){for(Z=
0;Z<wa;Z++){ja=Ea[Z].position;P=Z*3;Ga[P]=ja.x;Ga[P+1]=ja.y;Ga[P+2]=ja.z}p.bindBuffer(p.ARRAY_BUFFER,A.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,Ga,S)}if(Ua){for(Z=0;Z<ea;Z++){color=I[Z];P=Z*3;aa[P]=color.r;aa[P+1]=color.g;aa[P+2]=color.b}p.bindBuffer(p.ARRAY_BUFFER,A.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,aa,S)}}J.__dirtyVertices=!1;J.__dirtyColors=!1}else if(A instanceof THREE.Line){J=A.geometry;if(J.__dirtyVertices||J.__dirtyColors){A=J;S=p.DYNAMIC_DRAW;Ea=A.vertices;I=A.colors;
wa=Ea.length;ea=I.length;Ga=A.__vertexArray;aa=A.__colorArray;Ua=A.__dirtyColors;if(A.__dirtyVertices){for(Z=0;Z<wa;Z++){ja=Ea[Z].position;P=Z*3;Ga[P]=ja.x;Ga[P+1]=ja.y;Ga[P+2]=ja.z}p.bindBuffer(p.ARRAY_BUFFER,A.__webglVertexBuffer);p.bufferData(p.ARRAY_BUFFER,Ga,S)}if(Ua){for(Z=0;Z<ea;Z++){color=I[Z];P=Z*3;aa[P]=color.r;aa[P+1]=color.g;aa[P+2]=color.b}p.bindBuffer(p.ARRAY_BUFFER,A.__webglColorBuffer);p.bufferData(p.ARRAY_BUFFER,aa,S)}}J.__dirtyVertices=!1;J.__dirtyColors=!1}else if(A instanceof THREE.ParticleSystem){J=
A.geometry;(J.__dirtyVertices||J.__dirtyColors||A.sortParticles)&&e(J,p.DYNAMIC_DRAW,A);J.__dirtyVertices=!1;J.__dirtyColors=!1}}function H(A){function S(ma){var ra=[];J=0;for(I=ma.length;J<I;J++)ma[J]==undefined?ra.push("undefined"):ra.push(ma[J].id);return ra.join("_")}var J,I,P,ea,aa,Z,ja,na,R={},ga=A.morphTargets!==undefined?A.morphTargets.length:0;A.geometryGroups={};P=0;for(ea=A.faces.length;P<ea;P++){aa=A.faces[P];Z=aa.materials;ja=S(Z);R[ja]==undefined&&(R[ja]={hash:ja,counter:0});na=R[ja].hash+
"_"+R[ja].counter;A.geometryGroups[na]==undefined&&(A.geometryGroups[na]={faces:[],materials:Z,vertices:0,numMorphTargets:ga});aa=aa instanceof THREE.Face3?3:4;if(A.geometryGroups[na].vertices+aa>65535){R[ja].counter+=1;na=R[ja].hash+"_"+R[ja].counter;A.geometryGroups[na]==undefined&&(A.geometryGroups[na]={faces:[],materials:Z,vertices:0,numMorphTargets:ga})}A.geometryGroups[na].faces.push(P);A.geometryGroups[na].vertices+=aa}}function z(A,S,J){A.push({buffer:S,object:J,opaque:{list:[],count:0},transparent:{list:[],
count:0}})}function E(A){if(A!=$){switch(A){case THREE.AdditiveBlending:p.blendEquation(p.FUNC_ADD);p.blendFunc(p.SRC_ALPHA,p.ONE);break;case THREE.SubtractiveBlending:p.blendEquation(p.FUNC_ADD);p.blendFunc(p.ZERO,p.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:p.blendEquation(p.FUNC_ADD);p.blendFunc(p.ZERO,p.SRC_COLOR);break;default:p.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD);p.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA)}$=A}}function F(A,S,J){if((J.width&
J.width-1)==0&&(J.height&J.height-1)==0){p.texParameteri(A,p.TEXTURE_WRAP_S,Y(S.wrapS));p.texParameteri(A,p.TEXTURE_WRAP_T,Y(S.wrapT));p.texParameteri(A,p.TEXTURE_MAG_FILTER,Y(S.magFilter));p.texParameteri(A,p.TEXTURE_MIN_FILTER,Y(S.minFilter));p.generateMipmap(A)}else{p.texParameteri(A,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(A,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(A,p.TEXTURE_MAG_FILTER,U(S.magFilter));p.texParameteri(A,p.TEXTURE_MIN_FILTER,U(S.minFilter))}}function D(A,S){if(A.needsUpdate){if(A.__webglInit){p.bindTexture(p.TEXTURE_2D,
A.__webglTexture);p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,A.image)}else{A.__webglTexture=p.createTexture();p.bindTexture(p.TEXTURE_2D,A.__webglTexture);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,A.image);A.__webglInit=!0}F(p.TEXTURE_2D,A,A.image);p.bindTexture(p.TEXTURE_2D,null);A.needsUpdate=!1}p.activeTexture(p.TEXTURE0+S);p.bindTexture(p.TEXTURE_2D,A.__webglTexture)}function T(A){if(A&&!A.__webglFramebuffer){if(A.depthBuffer===undefined)A.depthBuffer=!0;if(A.stencilBuffer===
undefined)A.stencilBuffer=!0;A.__webglFramebuffer=p.createFramebuffer();A.__webglRenderbuffer=p.createRenderbuffer();A.__webglTexture=p.createTexture();p.bindTexture(p.TEXTURE_2D,A.__webglTexture);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,Y(A.wrapS));p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,Y(A.wrapT));p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,Y(A.magFilter));p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,Y(A.minFilter));p.texImage2D(p.TEXTURE_2D,0,Y(A.format),A.width,A.height,
0,Y(A.format),Y(A.type),null);p.bindRenderbuffer(p.RENDERBUFFER,A.__webglRenderbuffer);p.bindFramebuffer(p.FRAMEBUFFER,A.__webglFramebuffer);p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,A.__webglTexture,0);if(A.depthBuffer&&!A.stencilBuffer){p.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_COMPONENT16,A.width,A.height);p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,A.__webglRenderbuffer)}else if(A.depthBuffer&&A.stencilBuffer){p.renderbufferStorage(p.RENDERBUFFER,
p.DEPTH_STENCIL,A.width,A.height);p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,A.__webglRenderbuffer)}else p.renderbufferStorage(p.RENDERBUFFER,p.RGBA4,A.width,A.height);p.bindTexture(p.TEXTURE_2D,null);p.bindRenderbuffer(p.RENDERBUFFER,null);p.bindFramebuffer(p.FRAMEBUFFER,null)}var S,J;if(A){S=A.__webglFramebuffer;J=A.width;A=A.height}else{S=null;J=va;A=ua}if(S!=Q){p.bindFramebuffer(p.FRAMEBUFFER,S);p.viewport(qa,sa,J,A);Q=S}}function W(A,S){var J;if(A=="fragment")J=
p.createShader(p.FRAGMENT_SHADER);else A=="vertex"&&(J=p.createShader(p.VERTEX_SHADER));p.shaderSource(J,S);p.compileShader(J);if(!p.getShaderParameter(J,p.COMPILE_STATUS)){console.error(p.getShaderInfoLog(J));console.error(S);return null}return J}function U(A){switch(A){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return p.NEAREST;default:return p.LINEAR}}function Y(A){switch(A){case THREE.RepeatWrapping:return p.REPEAT;case THREE.ClampToEdgeWrapping:return p.CLAMP_TO_EDGE;
case THREE.MirroredRepeatWrapping:return p.MIRRORED_REPEAT;case THREE.NearestFilter:return p.NEAREST;case THREE.NearestMipMapNearestFilter:return p.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return p.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return p.LINEAR;case THREE.LinearMipMapNearestFilter:return p.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return p.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return p.BYTE;case THREE.UnsignedByteType:return p.UNSIGNED_BYTE;case THREE.ShortType:return p.SHORT;
case THREE.UnsignedShortType:return p.UNSIGNED_SHORT;case THREE.IntType:return p.INT;case THREE.UnsignedShortType:return p.UNSIGNED_INT;case THREE.FloatType:return p.FLOAT;case THREE.AlphaFormat:return p.ALPHA;case THREE.RGBFormat:return p.RGB;case THREE.RGBAFormat:return p.RGBA;case THREE.LuminanceFormat:return p.LUMINANCE;case THREE.LuminanceAlphaFormat:return p.LUMINANCE_ALPHA}return 0}var N=this,p,O=document.createElement("canvas"),G=[],L=null,Q=null,M=!0,da=null,ka=null,$=null,ha=null,qa=0,sa=
0,va=0,ua=0,ta=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Da=new THREE.Matrix4,Ba=new Float32Array(16),Fa=new Float32Array(16),ya=new THREE.Vector4,V={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};stencil=b.stencil!==undefined?b.stencil:!0;antialias=b.antialias!==undefined?b.antialias:!1;clearColor=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0);
clearAlpha=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=O;this.autoClear=!0;this.sortObjects=!0;(function(A,S,J,I){try{if(!(p=O.getContext("experimental-webgl",{antialias:A,stencil:I})))throw"Error creating WebGL context.";}catch(P){console.error(P)}console.log(navigator.userAgent+" | "+p.getParameter(p.VERSION)+" | "+p.getParameter(p.VENDOR)+" | "+p.getParameter(p.RENDERER)+" | "+p.getParameter(p.SHADING_LANGUAGE_VERSION));
p.clearColor(0,0,0,1);p.clearDepth(1);p.enable(p.DEPTH_TEST);p.depthFunc(p.LEQUAL);p.frontFace(p.CCW);p.cullFace(p.BACK);p.enable(p.CULL_FACE);p.enable(p.BLEND);p.blendEquation(p.FUNC_ADD);p.blendFunc(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA);p.clearColor(S.r,S.g,S.b,J)})(antialias,clearColor,clearAlpha,stencil);this.context=p;var ia=p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(stencil){var fa={};fa.vertices=new Float32Array(12);fa.faces=new Uint16Array(6);fa.darkness=0.5;fa.vertices[0]=-20;fa.vertices[1]=
-20;fa.vertices[2]=-1;fa.vertices[3]=20;fa.vertices[4]=-20;fa.vertices[5]=-1;fa.vertices[6]=20;fa.vertices[7]=20;fa.vertices[8]=-1;fa.vertices[9]=-20;fa.vertices[10]=20;fa.vertices[11]=-1;fa.faces[0]=0;fa.faces[1]=1;fa.faces[2]=2;fa.faces[3]=0;fa.faces[4]=2;fa.faces[5]=3;fa.vertexBuffer=p.createBuffer();fa.elementBuffer=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,fa.vertexBuffer);p.bufferData(p.ARRAY_BUFFER,fa.vertices,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,fa.elementBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,
fa.faces,p.STATIC_DRAW);fa.program=p.createProgram();p.attachShader(fa.program,W("fragment",THREE.ShaderLib.shadowPost.fragmentShader));p.attachShader(fa.program,W("vertex",THREE.ShaderLib.shadowPost.vertexShader));p.linkProgram(fa.program);fa.vertexLocation=p.getAttribLocation(fa.program,"position");fa.projectionLocation=p.getUniformLocation(fa.program,"projectionMatrix");fa.darknessLocation=p.getUniformLocation(fa.program,"darkness")}var ca={};ca.vertices=new Float32Array(16);ca.faces=new Uint16Array(6);
b=0;ca.vertices[b++]=-1;ca.vertices[b++]=-1;ca.vertices[b++]=0;ca.vertices[b++]=0;ca.vertices[b++]=1;ca.vertices[b++]=-1;ca.vertices[b++]=1;ca.vertices[b++]=0;ca.vertices[b++]=1;ca.vertices[b++]=1;ca.vertices[b++]=1;ca.vertices[b++]=1;ca.vertices[b++]=-1;ca.vertices[b++]=1;ca.vertices[b++]=0;ca.vertices[b++]=1;b=0;ca.faces[b++]=0;ca.faces[b++]=1;ca.faces[b++]=2;ca.faces[b++]=0;ca.faces[b++]=2;ca.faces[b++]=3;ca.vertexBuffer=p.createBuffer();ca.elementBuffer=p.createBuffer();ca.tempTexture=p.createTexture();
ca.occlusionTexture=p.createTexture();p.bindBuffer(p.ARRAY_BUFFER,ca.vertexBuffer);p.bufferData(p.ARRAY_BUFFER,ca.vertices,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,ca.elementBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,ca.faces,p.STATIC_DRAW);p.bindTexture(p.TEXTURE_2D,ca.tempTexture);p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,
p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);p.bindTexture(p.TEXTURE_2D,ca.occlusionTexture);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);if(p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=
0){ca.hasVertexTexture=!1;ca.program=p.createProgram();p.attachShader(ca.program,W("fragment",THREE.ShaderLib.lensFlare.fragmentShader));p.attachShader(ca.program,W("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{ca.hasVertexTexture=!0;ca.program=p.createProgram();p.attachShader(ca.program,W("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));p.attachShader(ca.program,W("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}p.linkProgram(ca.program);ca.attributes={};
ca.uniforms={};ca.attributes.vertex=p.getAttribLocation(ca.program,"position");ca.attributes.uv=p.getAttribLocation(ca.program,"UV");ca.uniforms.renderType=p.getUniformLocation(ca.program,"renderType");ca.uniforms.map=p.getUniformLocation(ca.program,"map");ca.uniforms.occlusionMap=p.getUniformLocation(ca.program,"occlusionMap");ca.uniforms.opacity=p.getUniformLocation(ca.program,"opacity");ca.uniforms.scale=p.getUniformLocation(ca.program,"scale");ca.uniforms.rotation=p.getUniformLocation(ca.program,
"rotation");ca.uniforms.screenPosition=p.getUniformLocation(ca.program,"screenPosition");var Ca=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;
_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=p.createBuffer();_sprite.elementBuffer=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,_sprite.vertexBuffer);p.bufferData(p.ARRAY_BUFFER,_sprite.vertices,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,_sprite.faces,p.STATIC_DRAW);
_sprite.program=p.createProgram();p.attachShader(_sprite.program,W("fragment",THREE.ShaderLib.sprite.fragmentShader));p.attachShader(_sprite.program,W("vertex",THREE.ShaderLib.sprite.vertexShader));p.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=p.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=p.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=p.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=
p.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=p.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=p.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=p.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=p.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=p.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=p.getUniformLocation(_sprite.program,"useScreenCoordinates");
_sprite.uniforms.affectedByDistance=p.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=p.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=p.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=p.getUniformLocation(_sprite.program,"projectionMatrix");var Va=!1;this.setSize=function(A,S){O.width=A;O.height=S;this.setViewport(0,0,O.width,O.height)};this.setViewport=function(A,S,J,I){qa=A;sa=
S;va=J;ua=I;p.viewport(qa,sa,va,ua)};this.setScissor=function(A,S,J,I){p.scissor(A,S,J,I)};this.enableScissorTest=function(A){A?p.enable(p.SCISSOR_TEST):p.disable(p.SCISSOR_TEST)};this.enableDepthBufferWrite=function(A){M=A;p.depthMask(A)};this.setClearColorHex=function(A,S){var J=new THREE.Color(A);p.clearColor(J.r,J.g,J.b,S)};this.setClearColor=function(A,S){p.clearColor(A.r,A.g,A.b,S)};this.clear=function(){p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT|p.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=
function(A){fa.darkness=A};this.getContext=function(){return p};this.initMaterial=function(A,S,J,I){var P,ea,aa;if(A instanceof THREE.MeshDepthMaterial)aa="depth";else if(A instanceof THREE.ShadowVolumeDynamicMaterial)aa="shadowVolumeDynamic";else if(A instanceof THREE.MeshNormalMaterial)aa="normal";else if(A instanceof THREE.MeshBasicMaterial)aa="basic";else if(A instanceof THREE.MeshLambertMaterial)aa="lambert";else if(A instanceof THREE.MeshPhongMaterial)aa="phong";else if(A instanceof THREE.LineBasicMaterial)aa=
"basic";else A instanceof THREE.ParticleBasicMaterial&&(aa="particle_basic");if(aa){var Z=THREE.ShaderLib[aa];A.uniforms=THREE.UniformsUtils.clone(Z.uniforms);A.vertexShader=Z.vertexShader;A.fragmentShader=Z.fragmentShader}var ja,na,R;ja=R=Z=0;for(na=S.length;ja<na;ja++){ea=S[ja];ea instanceof THREE.DirectionalLight&&R++;ea instanceof THREE.PointLight&&Z++}if(Z+R<=4)S=R;else{S=Math.ceil(4*R/(Z+R));Z=4-S}ea={directional:S,point:Z};R=50;if(I!==undefined&&I instanceof THREE.SkinnedMesh)R=I.bones.length;
var ga;a:{ja=A.fragmentShader;na=A.vertexShader;Z=A.uniforms;S=A.attributes;J={map:!!A.map,envMap:!!A.envMap,lightMap:!!A.lightMap,vertexColors:A.vertexColors,fog:J,sizeAttenuation:A.sizeAttenuation,skinning:A.skinning,morphTargets:A.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:ea.directional,maxPointLights:ea.point,maxBones:R};var ma;ea=[];if(aa)ea.push(aa);else{ea.push(ja);ea.push(na)}for(ma in J){ea.push(ma);ea.push(J[ma])}aa=ea.join();ma=0;for(ea=G.length;ma<ea;ma++)if(G[ma].code==
aa){ga=G[ma].program;break a}ma=p.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+J.maxDirLights,"#define MAX_POINT_LIGHTS "+J.maxPointLights,J.fog?"#define USE_FOG":"",J.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",J.map?"#define USE_MAP":"",J.envMap?"#define USE_ENVMAP":"",J.lightMap?"#define USE_LIGHTMAP":"",J.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");prefix_vertex=[ia?
"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+J.maxDirLights,"#define MAX_POINT_LIGHTS "+J.maxPointLights,"#define MAX_BONES "+J.maxBones,J.map?"#define USE_MAP":"",J.envMap?"#define USE_ENVMAP":"",J.lightMap?"#define USE_LIGHTMAP":"",J.vertexColors?"#define USE_COLOR":"",J.skinning?"#define USE_SKINNING":"",J.morphTargets?"#define USE_MORPHTARGETS":"",J.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
p.attachShader(ma,W("fragment",prefix_fragment+ja));p.attachShader(ma,W("vertex",prefix_vertex+na));p.linkProgram(ma);p.getProgramParameter(ma,p.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+p.getProgramParameter(ma,p.VALIDATE_STATUS)+", gl error ["+p.getError()+"]");ma.uniforms={};ma.attributes={};var ra;ja=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(ra in Z)ja.push(ra);ra=ja;Z=0;for(ja=ra.length;Z<ja;Z++){na=ra[Z];ma.uniforms[na]=p.getUniformLocation(ma,na)}ja=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(ra=0;ra<J.maxMorphTargets;ra++)ja.push("morphTarget"+ra);for(ga in S)ja.push(ga);ga=ja;ra=0;for(S=ga.length;ra<S;ra++){J=ga[ra];ma.attributes[J]=p.getAttribLocation(ma,J)}G.push({program:ma,code:aa});ga=ma}A.program=ga;ga=A.program.attributes;ga.position>=0&&p.enableVertexAttribArray(ga.position);
ga.color>=0&&p.enableVertexAttribArray(ga.color);ga.normal>=0&&p.enableVertexAttribArray(ga.normal);ga.tangent>=0&&p.enableVertexAttribArray(ga.tangent);if(A.skinning&&ga.skinVertexA>=0&&ga.skinVertexB>=0&&ga.skinIndex>=0&&ga.skinWeight>=0){p.enableVertexAttribArray(ga.skinVertexA);p.enableVertexAttribArray(ga.skinVertexB);p.enableVertexAttribArray(ga.skinIndex);p.enableVertexAttribArray(ga.skinWeight)}if(A.attributes)for(P in A.attributes)ga[P]!==undefined&&ga[P]>=0&&p.enableVertexAttribArray(ga[P]);
if(A.morphTargets){A.numSupportedMorphTargets=0;if(ga.morphTarget0>=0){p.enableVertexAttribArray(ga.morphTarget0);A.numSupportedMorphTargets++}if(ga.morphTarget1>=0){p.enableVertexAttribArray(ga.morphTarget1);A.numSupportedMorphTargets++}if(ga.morphTarget2>=0){p.enableVertexAttribArray(ga.morphTarget2);A.numSupportedMorphTargets++}if(ga.morphTarget3>=0){p.enableVertexAttribArray(ga.morphTarget3);A.numSupportedMorphTargets++}if(ga.morphTarget4>=0){p.enableVertexAttribArray(ga.morphTarget4);A.numSupportedMorphTargets++}if(ga.morphTarget5>=
0){p.enableVertexAttribArray(ga.morphTarget5);A.numSupportedMorphTargets++}if(ga.morphTarget6>=0){p.enableVertexAttribArray(ga.morphTarget6);A.numSupportedMorphTargets++}if(ga.morphTarget7>=0){p.enableVertexAttribArray(ga.morphTarget7);A.numSupportedMorphTargets++}I.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);A=0;for(P=this.maxMorphTargets;A<P;A++)I.__webglMorphTargetInfluences[A]=0}};this.render=function(A,S,J,I){var P,ea,aa,Z,ja,na,R,ga,ma=A.lights,ra=A.fog;N.data.vertices=
0;N.data.faces=0;N.data.drawCalls=0;S.matrixAutoUpdate&&S.update(undefined,!0);A.update(undefined,!1,S);S.matrixWorldInverse.flattenToArray(Fa);S.projectionMatrix.flattenToArray(Ba);Da.multiply(S.projectionMatrix,S.matrixWorldInverse);n(Da);this.initWebGLObjects(A);T(J);(this.autoClear||I)&&this.clear();ja=A.__webglObjects.length;for(I=0;I<ja;I++){P=A.__webglObjects[I];R=P.object;if(R.visible)if(!(R instanceof THREE.Mesh)||h(R)){R.matrixWorld.flattenToArray(R._objectMatrixArray);C(R,S);u(P);P.render=
!0;if(this.sortObjects){ya.copy(R.position);Da.multiplyVector3(ya);P.z=ya.z}}else P.render=!1;else P.render=!1}this.sortObjects&&A.__webglObjects.sort(v);na=A.__webglObjectsImmediate.length;for(I=0;I<na;I++){P=A.__webglObjectsImmediate[I];R=P.object;if(R.visible){R.matrixAutoUpdate&&R.matrixWorld.flattenToArray(R._objectMatrixArray);C(R,S);t(P)}}E(THREE.NormalBlending);for(I=0;I<ja;I++){P=A.__webglObjects[I];if(P.render){R=P.object;ga=P.buffer;aa=P.opaque;g(R);for(P=0;P<aa.count;P++){Z=aa.list[P];
m(Z.depthTest);d(S,ma,ra,Z,ga,R)}}}for(I=0;I<na;I++){P=A.__webglObjectsImmediate[I];R=P.object;if(R.visible){aa=P.opaque;g(R);for(P=0;P<aa.count;P++){Z=aa.list[P];m(Z.depthTest);ea=c(S,ma,ra,Z,R);R.render(function(oa){f(oa,ea,Z.shading)})}}}for(I=0;I<ja;I++){P=A.__webglObjects[I];if(P.render){R=P.object;ga=P.buffer;aa=P.transparent;g(R);for(P=0;P<aa.count;P++){Z=aa.list[P];E(Z.blending);m(Z.depthTest);d(S,ma,ra,Z,ga,R)}}}for(I=0;I<na;I++){P=A.__webglObjectsImmediate[I];R=P.object;if(R.visible){aa=
P.transparent;g(R);for(P=0;P<aa.count;P++){Z=aa.list[P];E(Z.blending);m(Z.depthTest);ea=c(S,ma,ra,Z,R);R.render(function(oa){f(oa,ea,Z.shading)})}}}A.__webglSprites.length&&x(A,S);stencil&&A.__webglShadowVolumes.length&&A.lights.length&&w(A);A.__webglLensFlares.length&&y(A,S);if(J&&J.minFilter!==THREE.NearestFilter&&J.minFilter!==THREE.LinearFilter){p.bindTexture(p.TEXTURE_2D,J.__webglTexture);p.generateMipmap(p.TEXTURE_2D);p.bindTexture(p.TEXTURE_2D,null)}};this.initWebGLObjects=function(A){if(!A.__webglObjects){A.__webglObjects=
[];A.__webglObjectsImmediate=[];A.__webglShadowVolumes=[];A.__webglLensFlares=[];A.__webglSprites=[]}for(;A.__objectsAdded.length;){var S=A.__objectsAdded[0],J=A,I=void 0,P=void 0,ea=void 0;if(S._modelViewMatrix==undefined){S._modelViewMatrix=new THREE.Matrix4;S._normalMatrixArray=new Float32Array(9);S._modelViewMatrixArray=new Float32Array(16);S._objectMatrixArray=new Float32Array(16);S.matrixWorld.flattenToArray(S._objectMatrixArray)}if(S instanceof THREE.Mesh){P=S.geometry;P.geometryGroups==undefined&&
H(P);for(I in P.geometryGroups){ea=P.geometryGroups[I];if(!ea.__webglVertexBuffer){var aa=ea;aa.__webglVertexBuffer=p.createBuffer();aa.__webglNormalBuffer=p.createBuffer();aa.__webglTangentBuffer=p.createBuffer();aa.__webglColorBuffer=p.createBuffer();aa.__webglUVBuffer=p.createBuffer();aa.__webglUV2Buffer=p.createBuffer();aa.__webglSkinVertexABuffer=p.createBuffer();aa.__webglSkinVertexBBuffer=p.createBuffer();aa.__webglSkinIndicesBuffer=p.createBuffer();aa.__webglSkinWeightsBuffer=p.createBuffer();
aa.__webglFaceBuffer=p.createBuffer();aa.__webglLineBuffer=p.createBuffer();if(aa.numMorphTargets){var Z=void 0,ja=void 0;aa.__webglMorphTargetsBuffers=[];Z=0;for(ja=aa.numMorphTargets;Z<ja;Z++)aa.__webglMorphTargetsBuffers.push(p.createBuffer())}aa=ea;Z=S;var na=void 0,R=void 0,ga=void 0,ma=void 0,ra=void 0,oa=void 0,Ea=oa=ja=0,wa=void 0;ma=Z.geometry;wa=ma.faces;ra=aa.faces;na=0;for(R=ra.length;na<R;na++){ga=ra[na];ga=wa[ga];if(ga instanceof THREE.Face3){ja+=3;oa+=1;Ea+=3}else if(ga instanceof THREE.Face4){ja+=
4;oa+=2;Ea+=4}}na=aa;R=Z;var Ga=void 0,Ua=void 0;ga=[];wa=0;for(ra=R.materials.length;wa<ra;wa++){Ga=R.materials[wa];if(Ga instanceof THREE.MeshFaceMaterial){Ga=0;for(l=na.materials.length;Ga<l;Ga++)(Ua=na.materials[Ga])&&ga.push(Ua)}else(Ua=Ga)&&ga.push(Ua)}na=ga;a:{ra=na.length;for(R=0;R<ra;R++){wa=na[R];if(wa.map||wa.lightMap||wa instanceof THREE.MeshShaderMaterial){R=!0;break a}}R=!1}a:{ga=na.length;for(wa=0;wa<ga;wa++){ra=na[wa];if(!(ra instanceof THREE.MeshBasicMaterial&&!ra.envMap||ra instanceof
THREE.MeshDepthMaterial)){wa=ra&&ra.shading!=undefined&&ra.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}wa=!1}a:{Ga=na.length;for(ra=0;ra<Ga;ra++){ga=na[ra];if(ga.vertexColors){ga=ga.vertexColors;break a}}ga=!1}aa.__vertexArray=new Float32Array(ja*3);if(wa)aa.__normalArray=new Float32Array(ja*3);if(ma.hasTangents)aa.__tangentArray=new Float32Array(ja*4);if(ga)aa.__colorArray=new Float32Array(ja*3);if(R){if(ma.faceUvs.length>0||ma.faceVertexUvs.length>0)aa.__uvArray=
new Float32Array(ja*2);if(ma.faceUvs.length>1||ma.faceVertexUvs.length>1)aa.__uv2Array=new Float32Array(ja*2)}if(Z.geometry.skinWeights.length&&Z.geometry.skinIndices.length){aa.__skinVertexAArray=new Float32Array(ja*4);aa.__skinVertexBArray=new Float32Array(ja*4);aa.__skinIndexArray=new Float32Array(ja*4);aa.__skinWeightArray=new Float32Array(ja*4)}aa.__faceArray=new Uint16Array(oa*3+(Z.geometry.edgeFaces?Z.geometry.edgeFaces.length*6:0));aa.__lineArray=new Uint16Array(Ea*2);if(aa.numMorphTargets){aa.__morphTargetsArrays=
[];ma=0;for(ra=aa.numMorphTargets;ma<ra;ma++)aa.__morphTargetsArrays.push(new Float32Array(ja*3))}aa.__needsSmoothNormals=wa==THREE.SmoothShading;aa.__uvType=R;aa.__vertexColorType=ga;aa.__normalType=wa;aa.__webglFaceCount=oa*3+(Z.geometry.edgeFaces?Z.geometry.edgeFaces.length*6:0);aa.__webglLineCount=Ea*2;ma=0;for(ra=na.length;ma<ra;ma++)if(na[ma].attributes){aa.__webglCustomAttributes={};for(a in na[ma].attributes){R=na[ma].attributes[a];if(!R.__webglInitialized||R.createUniqueBuffers){R.__webglInitialized=
!0;oa=1;if(R.type==="v2")oa=2;else if(R.type==="v3")oa=3;else if(R.type==="v4")oa=4;else R.type==="c"&&(oa=3);R.size=oa;R.needsUpdate=!0;R.array=new Float32Array(ja*oa);R.buffer=p.createBuffer();R.buffer.belongsToAttribute=a}aa.__webglCustomAttributes[a]=R}}aa.__inittedArrays=!0;P.__dirtyVertices=!0;P.__dirtyMorphTargets=!0;P.__dirtyElements=!0;P.__dirtyUvs=!0;P.__dirtyNormals=!0;P.__dirtyTangents=!0;P.__dirtyColors=!0}S instanceof THREE.ShadowVolume?z(J.__webglShadowVolumes,ea,S):z(J.__webglObjects,
ea,S)}}else if(S instanceof THREE.LensFlare)z(J.__webglLensFlares,undefined,S);else if(S instanceof THREE.Ribbon){P=S.geometry;if(!P.__webglVertexBuffer){I=P;I.__webglVertexBuffer=p.createBuffer();I.__webglColorBuffer=p.createBuffer();I=P;ea=I.vertices.length;I.__vertexArray=new Float32Array(ea*3);I.__colorArray=new Float32Array(ea*3);I.__webglVertexCount=ea;P.__dirtyVertices=!0;P.__dirtyColors=!0}z(J.__webglObjects,P,S)}else if(S instanceof THREE.Line){P=S.geometry;if(!P.__webglVertexBuffer){I=P;
I.__webglVertexBuffer=p.createBuffer();I.__webglColorBuffer=p.createBuffer();I=P;ea=I.vertices.length;I.__vertexArray=new Float32Array(ea*3);I.__colorArray=new Float32Array(ea*3);I.__webglLineCount=ea;P.__dirtyVertices=!0;P.__dirtyColors=!0}z(J.__webglObjects,P,S)}else if(S instanceof THREE.ParticleSystem){P=S.geometry;if(!P.__webglVertexBuffer){I=P;I.__webglVertexBuffer=p.createBuffer();I.__webglColorBuffer=p.createBuffer();I=P;ea=I.vertices.length;I.__vertexArray=new Float32Array(ea*3);I.__colorArray=
new Float32Array(ea*3);I.__sortArray=[];I.__webglParticleCount=ea;P.__dirtyVertices=!0;P.__dirtyColors=!0}z(J.__webglObjects,P,S)}else if(THREE.MarchingCubes!==undefined&&S instanceof THREE.MarchingCubes)J.__webglObjectsImmediate.push({object:S,opaque:{list:[],count:0},transparent:{list:[],count:0}});else S instanceof THREE.Sprite&&J.__webglSprites.push(S);A.__objectsAdded.splice(0,1)}for(;A.__objectsRemoved.length;){S=A.__objectsRemoved[0];J=A;if(S instanceof THREE.Mesh)for(P=J.__webglObjects.length-
1;P>=0;P--){I=J.__webglObjects[P].object;if(S==I){J.__webglObjects.splice(P,1);break}}else if(S instanceof THREE.Sprite)for(P=J.__webglSprites.length-1;P>=0;P--){I=J.__webglSprites[P];if(S==I){J.__webglSprites.splice(P,1);break}}A.__objectsRemoved.splice(0,1)}S=0;for(J=A.__webglObjects.length;S<J;S++)B(A.__webglObjects[S].object,A);S=0;for(J=A.__webglShadowVolumes.length;S<J;S++)B(A.__webglShadowVolumes[S].object,A);S=0;for(J=A.__webglLensFlares.length;S<J;S++)B(A.__webglLensFlares[S].object,A)};
this.setFaceCulling=function(A,S){if(A){!S||S=="ccw"?p.frontFace(p.CCW):p.frontFace(p.CW);if(A=="back")p.cullFace(p.BACK);else A=="front"?p.cullFace(p.FRONT):p.cullFace(p.FRONT_AND_BACK);p.enable(p.CULL_FACE)}else p.disable(p.CULL_FACE)};this.supportsVertexTextures=function(){return ia}};
THREE.WebGLRenderTarget=function(b,e,c){this.width=b;this.height=e;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==
undefined?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:!0};
THREE.ColorUtils={adjustHSV:function(b,e,c,d){var f=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,f);f.h=THREE.ColorUtils.clamp(f.h+e,0,1);f.s=THREE.ColorUtils.clamp(f.s+c,0,1);f.v=THREE.ColorUtils.clamp(f.v+d,0,1);b.setHSV(f.h,f.s,f.v)},rgbToHsv:function(b,e){var c=b.r,d=b.g,f=b.b,g=Math.max(Math.max(c,d),f),m=Math.min(Math.min(c,d),f);if(m==g)m=c=0;else{var n=g-m;m=n/g;c=c==g?(d-f)/n:d==g?2+(f-c)/n:4+(c-d)/n;c/=6;c<0&&(c+=1);c>1&&(c-=1)}e===undefined&&(e={h:0,s:0,v:0});e.h=c;e.s=m;e.v=g;return e},
clamp:function(b,e,c){return b<e?e:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,e){var c=e instanceof THREE.Mesh,d=b.vertices.length,f=c?e.geometry:e,g=b.vertices,m=f.vertices,n=b.faces,h=f.faces,o=b.faceVertexUvs[0];f=f.faceVertexUvs[0];c&&e.matrixAutoUpdate&&e.updateMatrix();for(var t=0,u=m.length;t<u;t++){var v=new THREE.Vertex(m[t].position.clone());c&&e.matrix.multiplyVector3(v.position);g.push(v)}t=0;for(u=h.length;t<u;t++){m=h[t];var w,x,y=m.vertexNormals;v=m.vertexColors;if(m instanceof THREE.Face3)w=new THREE.Face3(m.a+d,m.b+d,m.c+
d);else m instanceof THREE.Face4&&(w=new THREE.Face4(m.a+d,m.b+d,m.c+d,m.d+d));w.normal.copy(m.normal);c=0;for(g=y.length;c<g;c++){x=y[c];w.vertexNormals.push(x.clone())}w.color.copy(m.color);c=0;for(g=v.length;c<g;c++){x=v[c];w.vertexColors.push(x.clone())}w.materials=m.materials.slice();w.centroid.copy(m.centroid);n.push(w)}t=0;for(u=f.length;t<u;t++){d=f[t];n=[];c=0;for(g=d.length;c<g;c++)n.push(new THREE.UV(d[c].u,d[c].v));o.push(n)}}};
THREE.ImageUtils={loadTexture:function(b,e,c){var d=new Image,f=new THREE.Texture(d,e);d.onload=function(){f.needsUpdate=!0;c&&c(this)};d.src=b;return f},loadTextureCube:function(b,e,c){var d,f=[],g=new THREE.Texture(f,e);e=f.loadCount=0;for(d=b.length;e<d;++e){f[e]=new Image;f[e].onload=function(){f.loadCount+=1;if(f.loadCount==6)g.needsUpdate=!0;c&&c(this)};f[e].src=b[e]}return g}};
THREE.SceneUtils={addMesh:function(b,e,c,d,f,g,m,n,h,o){e=new THREE.Mesh(e,o);e.scale.x=e.scale.y=e.scale.z=c;e.position.x=d;e.position.y=f;e.position.z=g;e.rotation.x=m;e.rotation.y=n;e.rotation.z=h;b.addObject(e);return e},addPanoramaCubeWebGL:function(b,e,c){var d=THREE.ShaderUtils.lib.cube;d.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms});e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,1,null,!0),c);b.addObject(e);
return e},addPanoramaCube:function(b,e,c){var d=[];d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,d,!0),
new THREE.MeshFaceMaterial);b.addObject(e);return e},addPanoramaCubePlanes:function(b,e,c){var d=e/2;e=new THREE.Plane(e,e);var f=Math.PI,g=Math.PI/2;THREE.SceneUtils.addMesh(b,e,1,0,0,-d,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,e,1,-d,0,0,0,g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,e,1,d,0,0,0,-g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,e,1,0,d,0,g,
0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,e,1,0,-d,0,-g,0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,e){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=e})},traverseHierarchy:function(b,e){var c,d,f=b.children.length;for(d=0;d<f;d++){c=b.children[d];e(c);THREE.SceneUtils.traverseHierarchy(c,e)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var e,c,d,f,g=2*Math.ceil(b*3)+1;g>25&&(g=25);f=(g-1)*0.5;c=Array(g);for(e=d=0;e<g;++e){c[e]=Math.exp(-((e-f)*(e-f))/(2*b*b));d+=c[e]}for(e=0;e<g;++e)c[e]/=d;return c}};
THREE.AnimationHandler=function(){var b=[],e={},c={};c.update=function(f){for(var g=0;g<b.length;g++)b[g].update(f)};c.addToUpdate=function(f){b.indexOf(f)===-1&&b.push(f)};c.removeFromUpdate=function(f){f=b.indexOf(f);f!==-1&&b.splice(f,1)};c.add=function(f){e[f.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.");e[f.name]=f;if(f.initialized!==!0){for(var g=0;g<f.hierarchy.length;g++){for(var m=0;m<f.hierarchy[g].keys.length;m++){if(f.hierarchy[g].keys[m].time<
0)f.hierarchy[g].keys[m].time=0;if(f.hierarchy[g].keys[m].rot!==undefined&&!(f.hierarchy[g].keys[m].rot instanceof THREE.Quaternion)){var n=f.hierarchy[g].keys[m].rot;f.hierarchy[g].keys[m].rot=new THREE.Quaternion(n[0],n[1],n[2],n[3])}}if(f.hierarchy[g].keys[0].morphTargets!==undefined){n={};for(m=0;m<f.hierarchy[g].keys.length;m++)for(var h=0;h<f.hierarchy[g].keys[m].morphTargets.length;h++){var o=f.hierarchy[g].keys[m].morphTargets[h];n[o]=-1}f.hierarchy[g].usedMorphTargets=n;for(m=0;m<f.hierarchy[g].keys.length;m++){var t=
{};for(o in n){for(h=0;h<f.hierarchy[g].keys[m].morphTargets.length;h++)if(f.hierarchy[g].keys[m].morphTargets[h]===o){t[o]=f.hierarchy[g].keys[m].morphTargetsInfluences[h];break}h===f.hierarchy[g].keys[m].morphTargets.length&&(t[o]=0)}f.hierarchy[g].keys[m].morphTargetsInfluences=t}}for(m=1;m<f.hierarchy[g].keys.length;m++)if(f.hierarchy[g].keys[m].time===f.hierarchy[g].keys[m-1].time){f.hierarchy[g].keys.splice(m,1);m--}for(m=1;m<f.hierarchy[g].keys.length;m++)f.hierarchy[g].keys[m].index=m}m=parseInt(f.length*
f.fps,10);f.JIT={};f.JIT.hierarchy=[];for(g=0;g<f.hierarchy.length;g++)f.JIT.hierarchy.push(Array(m));f.initialized=!0}};c.get=function(f){if(typeof f==="string")if(e[f])return e[f];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}};c.parse=function(f){var g=[];if(f instanceof THREE.SkinnedMesh)for(var m=0;m<f.bones.length;m++)g.push(f.bones[m]);else d(f,g);return g};var d=function(f,g){g.push(f);for(var m=0;m<f.children.length;m++)d(f.children[m],g)};c.LINEAR=
0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,e,c,d){this.root=b;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.JITCompile=d!==undefined?d:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,e){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==undefined?b:!0;this.currentTime=e!==undefined?e:0;var c,d=this.hierarchy.length,f;for(c=0;c<d;c++){f=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=!0;f.matrixAutoUpdate=!0;if(f.animationCache===undefined){f.animationCache={};f.animationCache.prevKey={pos:0,rot:0,scl:0};f.animationCache.nextKey={pos:0,rot:0,scl:0};f.animationCache.originalMatrix=
f instanceof THREE.Bone?f.skinMatrix:f.matrix}var g=f.animationCache.prevKey;f=f.animationCache.nextKey;g.pos=this.data.hierarchy[c].keys[0];g.rot=this.data.hierarchy[c].keys[0];g.scl=this.data.hierarchy[c].keys[0];f.pos=this.getNextKeyWith("pos",c,1);f.rot=this.getNextKeyWith("rot",c,1);f.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==undefined){if(this.hierarchy[b]instanceof THREE.Bone)this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix;else this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var e=["pos","rot","scl"],c,d,f,g,m,n,h,o,t=this.data.JIT.hierarchy,u,v;this.currentTime+=b*this.timeScale;v=this.currentTime;u=this.currentTime%=this.data.length;o=parseInt(Math.min(u*this.data.fps,this.data.length*this.data.fps),10);for(var w=0,x=this.hierarchy.length;w<x;w++){b=this.hierarchy[w];h=b.animationCache;if(this.JITCompile&&t[w][o]!==undefined)if(b instanceof THREE.Bone){b.skinMatrix=t[w][o];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=
!1}else{b.matrix=t[w][o];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(b instanceof THREE.Bone)b.skinMatrix=b.animationCache.originalMatrix;else b.matrix=b.animationCache.originalMatrix;for(var y=0;y<3;y++){c=e[y];m=h.prevKey[c];n=h.nextKey[c];if(n.time<=v){if(u<v)if(this.loop){m=this.data.hierarchy[w].keys[0];for(n=this.getNextKeyWith(c,w,1);n.time<u;){m=n;n=this.getNextKeyWith(c,w,n.index+1)}}else{this.stop();return}else{do{m=n;n=this.getNextKeyWith(c,w,n.index+1)}while(n.time<
u)}h.prevKey[c]=m;h.nextKey[c]=n}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;d=(u-m.time)/(n.time-m.time);f=m[c];g=n[c];if(d<0||d>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+w);d=d<0?0:1}if(c==="pos"){c=b.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=f[0]+(g[0]-f[0])*d;c.y=f[1]+(g[1]-f[1])*d;c.z=f[2]+(g[2]-f[2])*d}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",w,m.index-1).pos;this.points[1]=f;this.points[2]=g;this.points[3]=this.getNextKeyWith("pos",w,n.index+1).pos;d=d*0.33+0.33;f=this.interpolateCatmullRom(this.points,d);c.x=f[0];c.y=f[1];c.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){d=this.interpolateCatmullRom(this.points,d*1.01);this.target.set(d[0],d[1],d[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();d=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,d,0)}}}else if(c===
"rot")THREE.Quaternion.slerp(f,g,b.quaternion,d);else if(c==="scl"){c=b.scale;c.x=f[0]+(g[0]-f[0])*d;c.y=f[1]+(g[1]-f[1])*d;c.z=f[2]+(g[2]-f[2])*d}}}}if(this.JITCompile&&t[0][o]===undefined){this.hierarchy[0].update(undefined,!0);for(w=0;w<this.hierarchy.length;w++)t[w][o]=this.hierarchy[w]instanceof THREE.Bone?this.hierarchy[w].skinMatrix.clone():this.hierarchy[w].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,e){var c=[],d=[],f,g,m,n,h,o;f=(b.length-1)*e;g=Math.floor(f);f-=g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>b.length-2?g:g+1;c[3]=g>b.length-3?g:g+2;g=b[c[0]];n=b[c[1]];h=b[c[2]];o=b[c[3]];c=f*f;m=f*c;d[0]=this.interpolate(g[0],n[0],h[0],o[0],f,c,m);d[1]=this.interpolate(g[1],n[1],h[1],o[1],f,c,m);d[2]=this.interpolate(g[2],n[2],h[2],o[2],f,c,m);return d};
THREE.Animation.prototype.interpolate=function(b,e,c,d,f,g,m){b=(c-b)*0.5;d=(d-e)*0.5;return(2*(e-c)+b+d)*m+(-3*(e-c)-2*b-d)*g+b*f+e};THREE.Animation.prototype.getNextKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<d.length-1?c:d.length-1;else c%=d.length;for(;c<d.length;c++)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[d.length-1]};
THREE.QuakeCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.noFly!==undefined)this.noFly=b.noFly;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.autoForward!==undefined)this.autoForward=b.autoForward;if(b.activeLook!==undefined)this.activeLook=b.activeLook;if(b.heightSpeed!==undefined)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==undefined)this.heightCoef=b.heightCoef;if(b.heightMin!==undefined)this.heightMin=b.heightMin;if(b.heightMax!==undefined)this.heightMax=
b.heightMax;if(b.constrainVertical!==undefined)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==undefined)this.verticalMin=b.verticalMin;if(b.verticalMax!==undefined)this.verticalMax=b.verticalMax;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.moveForward=!1;this.moveBackward=!1;this.moveLeft=!1;this.moveRight=!1;this.freeze=!1;this.mouseDragOn=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=
window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=
function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/
1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var d=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(d+this.autoSpeedFactor));this.moveBackward&&this.translateZ(d);this.moveLeft&&this.translateX(-d);this.moveRight&&this.translateX(d);d=this.tdiff*this.lookSpeed;
this.activeLook||(d=0);this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=
(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",e(this,
this.onMouseMove),!1);this.domElement.addEventListener("mousedown",e(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",e(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",e(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",e(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);if(this.noFly)e.y=0;this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};
THREE.PathCamera=function(b){function e(o,t,u,v){var w={name:u,fps:0.6,length:v,hierarchy:[]},x,y=t.getControlPointsArray(),C=t.getLength(),B=y.length,H=0;x=B-1;t={parent:-1,keys:[]};t.keys[0]={time:0,pos:y[0],rot:[0,0,0,1],scl:[1,1,1]};t.keys[x]={time:v,pos:y[x],rot:[0,0,0,1],scl:[1,1,1]};for(x=1;x<B-1;x++){H=v*C.chunks[x]/C.total;t.keys[x]={time:H,pos:y[x]}}w.hierarchy[0]=t;THREE.AnimationHandler.add(w);return new THREE.Animation(o,u,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(o,t){var u,
v,w=new THREE.Geometry;for(u=0;u<o.points.length*t;u++){v=u/(o.points.length*t);v=o.getPoint(v);w.vertices[u]=new THREE.Vertex(new THREE.Vector3(v.x,v.y,v.z))}return w}function d(o,t){var u=c(t,10),v=c(t,10),w=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(u,w);particleObj=new THREE.ParticleSystem(v,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);o.addChild(lineObj);particleObj.scale.set(1,1,1);o.addChild(particleObj);v=new THREE.Sphere(1,
16,8);w=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<t.points.length;i++){u=new THREE.Mesh(v,w);u.position.copy(t.points[i]);u.updateMatrix();o.addChild(u)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.0050;this.lookVertical=
!0;this.lookHorizontal=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==undefined)this.duration=b.duration*1E3;if(b.waypoints!==undefined)this.waypoints=b.waypoints;if(b.useConstantSpeed!==undefined)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==undefined)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==undefined)this.createDebugPath=b.createDebugPath;
if(b.createDebugDummy!==undefined)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==undefined)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==undefined)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==undefined)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var f=Math.PI*2,g=Math.PI/180;this.update=function(o,t,u){var v,w;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*g;this.theta=this.lon*g;v=this.phi%f;this.phi=v>=0?v:v+f;v=this.verticalAngleMap.srcRange;w=this.verticalAngleMap.dstRange;
var x=w[1]-w[0];this.phi=TWEEN.Easing.Quadratic.EaseInOut(((this.phi-v[0])*(w[1]-w[0])/(v[1]-v[0])+w[0]-w[0])/x)*x+w[0];v=this.horizontalAngleMap.srcRange;w=this.horizontalAngleMap.dstRange;x=w[1]-w[0];this.theta=TWEEN.Easing.Quadratic.EaseInOut(((this.theta-v[0])*(w[1]-w[0])/(v[1]-v[0])+w[0]-w[0])/x)*x+w[0];v=this.target.position;v.x=100*Math.sin(this.phi)*Math.cos(this.theta);v.y=100*Math.cos(this.phi);v.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,o,t,u)};this.onMouseMove=
function(o){this.mouseX=o.clientX-this.windowHalfX;this.mouseY=o.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var m=new THREE.MeshLambertMaterial({color:65280}),n=new THREE.Cube(10,10,20),h=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(n,b);b=new THREE.Mesh(h,m);b.position.set(0,10,
0);this.animation=e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&d(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(o,t){return function(){t.apply(o,arguments)}}(this,
this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.0050;this.dragToLook=!1;this.autoForward=!1;this.domElement=document;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==undefined)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==undefined)this.dragToLook=b.dragToLook;if(b.autoForward!==undefined)this.autoForward=
b.autoForward;if(b.domElement!==undefined)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var d=this.getContainerDimensions(),f=d.size[0]/2,g=d.size[1]/2;this.moveState.yawLeft=-(c.clientX-d.offset[0]-f)/f;this.moveState.pitchDown=(c.clientY-
d.offset[1]-g)/g;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var d=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*d,this.rotationVector.y*d,this.rotationVector.z*d,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",e(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",e(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",e(this,this.mouseup),!1);window.addEventListener("keydown",e(this,this.keydown),!1);window.addEventListener("keyup",e(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,e,c,d){THREE.Camera.call(this,b,e,c,d);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.useTarget=!1;this.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var f=new THREE.Vector3,g=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Matrix4,h=!1,o=1,t=0,u=0,v=0,w=0,x=0,y=window.innerWidth/2,C=window.innerHeight/2;this.update=
function(){var B=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=B;this.delta=(B-this.lastUpdate)/1E3;this.lastUpdate=B;if(this.mouseLook){B=this.delta*this.lookSpeed;this.rotateHorizontally(B*w);this.rotateVertically(B*x)}B=this.delta*this.movementSpeed;this.translateZ(B*(t>0||this.autoForward&&!(t<0)?1:t));this.translateX(B*u);this.translateY(B*v);h&&(this.roll+=this.rollSpeed*this.delta*o);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}m.copy(this.forward);g.set(0,1,0);f.cross(g,m).normalize();g.cross(m,f).normalize();this.matrix.n11=f.x;this.matrix.n12=g.x;this.matrix.n13=m.x;this.matrix.n21=f.y;this.matrix.n22=g.y;this.matrix.n23=m.y;this.matrix.n31=f.z;this.matrix.n32=g.z;this.matrix.n33=m.z;n.identity();n.n11=Math.cos(this.roll);n.n12=-Math.sin(this.roll);n.n21=Math.sin(this.roll);n.n22=Math.cos(this.roll);this.matrix.multiplySelf(n);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(B){this.position.x+=this.matrix.n11*B;this.position.y+=this.matrix.n21*B;this.position.z+=this.matrix.n31*B};this.translateY=function(B){this.position.x+=this.matrix.n12*B;this.position.y+=this.matrix.n22*B;this.position.z+=this.matrix.n32*B};this.translateZ=function(B){this.position.x-=this.matrix.n13*B;this.position.y-=
this.matrix.n23*B;this.position.z-=this.matrix.n33*B};this.rotateHorizontally=function(B){f.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);f.multiplyScalar(B);this.forward.subSelf(f);this.forward.normalize()};this.rotateVertically=function(B){g.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);g.multiplyScalar(B);this.forward.addSelf(g);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(B){B.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(B){w=(B.clientX-y)/window.innerWidth;x=(B.clientY-C)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(B){B.preventDefault();B.stopPropagation();switch(B.button){case 0:t=1;break;case 2:t=-1}},!1);this.domElement.addEventListener("mouseup",function(B){B.preventDefault();B.stopPropagation();switch(B.button){case 0:t=0;break;case 2:t=0}},!1);this.domElement.addEventListener("keydown",function(B){switch(B.keyCode){case 38:case 87:t=1;break;case 37:case 65:u=-1;break;
case 40:case 83:t=-1;break;case 39:case 68:u=1;break;case 81:h=!0;o=1;break;case 69:h=!0;o=-1;break;case 82:v=1;break;case 70:v=-1}},!1);this.domElement.addEventListener("keyup",function(B){switch(B.keyCode){case 38:case 87:t=0;break;case 37:case 65:u=0;break;case 40:case 83:t=0;break;case 39:case 68:u=0;break;case 81:h=!1;break;case 69:h=!1;break;case 82:v=0;break;case 70:v=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.Cube=function(b,e,c,d,f,g,m,n,h){function o(C,B,H,z,E,F,D,T){var W,U,Y=d||1,N=f||1,p=E/2,O=F/2,G=t.vertices.length;if(C=="x"&&B=="y"||C=="y"&&B=="x")W="z";else if(C=="x"&&B=="z"||C=="z"&&B=="x"){W="y";N=g||1}else if(C=="z"&&B=="y"||C=="y"&&B=="z"){W="x";Y=g||1}var L=Y+1,Q=N+1;E/=Y;var M=F/N;for(U=0;U<Q;U++)for(F=0;F<L;F++){var da=new THREE.Vector3;da[C]=(F*E-p)*H;da[B]=(U*M-O)*z;da[W]=D;t.vertices.push(new THREE.Vertex(da))}for(U=0;U<N;U++)for(F=0;F<Y;F++){t.faces.push(new THREE.Face4(F+L*U+
G,F+L*(U+1)+G,F+1+L*(U+1)+G,F+1+L*U+G,null,null,T));t.faceVertexUvs[0].push([new THREE.UV(F/Y,U/N),new THREE.UV(F/Y,(U+1)/N),new THREE.UV((F+1)/Y,(U+1)/N),new THREE.UV((F+1)/Y,U/N)])}}THREE.Geometry.call(this);var t=this,u=b/2,v=e/2,w=c/2;n=n?-1:1;if(m!==undefined)if(m instanceof Array)this.materials=m;else{this.materials=[];for(var x=0;x<6;x++)this.materials.push([m])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(h!=undefined)for(var y in h)this.sides[y]!=undefined&&
(this.sides[y]=h[y]);this.sides.px&&o("z","y",1*n,-1,c,e,-u,this.materials[0]);this.sides.nx&&o("z","y",-1*n,-1,c,e,u,this.materials[1]);this.sides.py&&o("x","z",1*n,1,b,c,v,this.materials[2]);this.sides.ny&&o("x","z",1*n,-1,b,c,-v,this.materials[3]);this.sides.pz&&o("x","y",1*n,-1,b,e,w,this.materials[4]);this.sides.nz&&o("x","y",-1*n,-1,b,e,-w,this.materials[5]);(function(){for(var C=[],B=[],H=0,z=t.vertices.length;H<z;H++){for(var E=t.vertices[H],F=!1,D=0,T=C.length;D<T;D++){var W=C[D];if(E.position.x==
W.position.x&&E.position.y==W.position.y&&E.position.z==W.position.z){B[H]=D;F=!0;break}}if(!F){B[H]=C.length;C.push(new THREE.Vertex(E.position.clone()))}}H=0;for(z=t.faces.length;H<z;H++){E=t.faces[H];E.a=B[E.a];E.b=B[E.b];E.c=B[E.c];E.d=B[E.d]}t.vertices=C})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,e,c,d,f,g){function m(v,w,x){n.vertices.push(new THREE.Vertex(new THREE.Vector3(v,w,x)))}THREE.Geometry.call(this);var n=this,h,o=Math.PI*2,t=d/2;for(h=0;h<b;h++)m(Math.sin(o*h/b)*e,Math.cos(o*h/b)*e,-t);for(h=0;h<b;h++)m(Math.sin(o*h/b)*c,Math.cos(o*h/b)*c,t);for(h=0;h<b;h++)n.faces.push(new THREE.Face4(h,h+b,b+(h+1)%b,(h+1)%b));if(c>0){m(0,0,-t-(g||0));for(h=b;h<b+b/2;h++)n.faces.push(new THREE.Face4(2*b,(2*h-2*b)%b,(2*h-2*b+1)%b,(2*h-2*b+2)%b))}if(e>0){m(0,0,t+(f||0));
for(h=b+b/2;h<2*b;h++)n.faces.push(new THREE.Face4(2*b+1,(2*h-2*b+2)%b+b,(2*h-2*b+1)%b+b,(2*h-2*b)%b+b))}h=0;for(b=this.faces.length;h<b;h++){e=[];c=this.faces[h];f=this.vertices[c.a];g=this.vertices[c.b];t=this.vertices[c.c];var u=this.vertices[c.d];e.push(new THREE.UV(0.5+Math.atan2(f.position.x,f.position.y)/o,0.5+f.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/o,0.5+g.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(t.position.x,t.position.y)/o,0.5+t.position.z/
d));c instanceof THREE.Face4&&e.push(new THREE.UV(0.5+Math.atan2(u.position.x,u.position.y)/o,0.5+u.position.z/d));this.faceVertexUvs[0].push(e)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function e(u,v,w){var x=Math.sqrt(u*u+v*v+w*w);return f.vertices.push(new THREE.Vertex(new THREE.Vector3(u/x,v/x,w/x)))-1}function c(u,v,w,x){x.faces.push(new THREE.Face3(u,v,w))}function d(u,v){var w=f.vertices[u].position,x=f.vertices[v].position;return e((w.x+x.x)/2,(w.y+x.y)/2,(w.z+x.z)/2)}var f=this,g=new THREE.Geometry,m;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;e(-1,b,0);e(1,b,0);e(-1,-b,0);e(1,-b,0);e(0,-1,b);e(0,1,b);e(0,-1,-b);e(0,
1,-b);e(b,0,-1);e(b,0,1);e(-b,0,-1);e(-b,0,1);c(0,11,5,g);c(0,5,1,g);c(0,1,7,g);c(0,7,10,g);c(0,10,11,g);c(1,5,9,g);c(5,11,4,g);c(11,10,2,g);c(10,7,6,g);c(7,1,8,g);c(3,9,4,g);c(3,4,2,g);c(3,2,6,g);c(3,6,8,g);c(3,8,9,g);c(4,9,5,g);c(2,4,11,g);c(6,2,10,g);c(8,6,7,g);c(9,8,1,g);for(b=0;b<this.subdivisions;b++){m=new THREE.Geometry;for(var n in g.faces){var h=d(g.faces[n].a,g.faces[n].b),o=d(g.faces[n].b,g.faces[n].c),t=d(g.faces[n].c,g.faces[n].a);c(g.faces[n].a,h,t,m);c(g.faces[n].b,o,h,m);c(g.faces[n].c,
t,o,m);c(h,o,t,m)}g.faces=m.faces}f.faces=g.faces;delete g;delete m;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,e,c){THREE.Geometry.call(this);this.steps=e||12;this.angle=c||2*Math.PI;e=this.angle/this.steps;c=[];for(var d=[],f=[],g=[],m=(new THREE.Matrix4).setRotationZ(e),n=0;n<b.length;n++){this.vertices.push(new THREE.Vertex(b[n]));c[n]=b[n].clone();d[n]=this.vertices.length-1}for(var h=0;h<=this.angle+0.0010;h+=e){for(n=0;n<c.length;n++)if(h<this.angle){c[n]=m.multiplyVector3(c[n].clone());this.vertices.push(new THREE.Vertex(c[n]));f[n]=this.vertices.length-1}else f=g;h==0&&(g=d);
for(n=0;n<d.length-1;n++){this.faces.push(new THREE.Face4(f[n],f[n+1],d[n+1],d[n]));this.faceVertexUvs[0].push([new THREE.UV(1-h/this.angle,n/b.length),new THREE.UV(1-h/this.angle,(n+1)/b.length),new THREE.UV(1-(h-e)/this.angle,(n+1)/b.length),new THREE.UV(1-(h-e)/this.angle,n/b.length)])}d=f;f=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,e,c,d){THREE.Geometry.call(this);var f,g=b/2,m=e/2;c=c||1;d=d||1;var n=c+1,h=d+1;b/=c;var o=e/d;for(f=0;f<h;f++)for(e=0;e<n;e++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(e*b-g,-(f*o-m),0)));for(f=0;f<d;f++)for(e=0;e<c;e++){this.faces.push(new THREE.Face4(e+n*f,e+n*(f+1),e+1+n*(f+1),e+1+n*f));this.faceVertexUvs[0].push([new THREE.UV(e/c,f/d),new THREE.UV(e/c,(f+1)/d),new THREE.UV((e+1)/c,(f+1)/d),new THREE.UV((e+1)/c,f/d)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,e,c){THREE.Geometry.call(this);var d,f=Math.PI,g=Math.max(3,e||8),m=Math.max(2,c||6);e=[];for(c=0;c<m+1;c++){d=c/m;var n=b*Math.cos(d*f),h=b*Math.sin(d*f),o=[],t=0;for(d=0;d<g;d++){var u=2*d/g,v=h*Math.sin(u*f);u=h*Math.cos(u*f);(c==0||c==m)&&d>0||(t=this.vertices.push(new THREE.Vertex(new THREE.Vector3(u,n,v)))-1);o.push(t)}e.push(o)}var w,x,y;f=e.length;for(c=0;c<f;c++){g=e[c].length;if(c>0)for(d=0;d<g;d++){o=d==g-1;m=e[c][o?0:d+1];n=e[c][o?g-1:d];h=e[c-1][o?g-1:d];o=e[c-
1][o?0:d+1];v=c/(f-1);w=(c-1)/(f-1);x=(d+1)/g;u=d/g;t=new THREE.UV(1-x,v);v=new THREE.UV(1-u,v);u=new THREE.UV(1-u,w);var C=new THREE.UV(1-x,w);if(c<e.length-1){w=this.vertices[m].position.clone();x=this.vertices[n].position.clone();y=this.vertices[h].position.clone();w.normalize();x.normalize();y.normalize();this.faces.push(new THREE.Face3(m,n,h,[new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([t,v,u])}if(c>1){w=this.vertices[m].position.clone();
x=this.vertices[h].position.clone();y=this.vertices[o].position.clone();w.normalize();x.normalize();y.normalize();this.faces.push(new THREE.Face3(m,h,o,[new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([t,u,C])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,e,c,d){THREE.Geometry.call(this);this.radius=b||100;this.tube=e||40;this.segmentsR=c||8;this.segmentsT=d||6;b=[];for(e=0;e<=this.segmentsR;++e)for(c=0;c<=this.segmentsT;++c){d=c/this.segmentsT*2*Math.PI;var f=e/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(f))*Math.cos(d),(this.radius+this.tube*Math.cos(f))*Math.sin(d),this.tube*Math.sin(f))));b.push([c/this.segmentsT,1-e/this.segmentsR])}for(e=1;e<=this.segmentsR;++e)for(c=
1;c<=this.segmentsT;++c){d=(this.segmentsT+1)*e+c;f=(this.segmentsT+1)*e+c-1;var g=(this.segmentsT+1)*(e-1)+c-1,m=(this.segmentsT+1)*(e-1)+c;this.faces.push(new THREE.Face4(d,f,g,m));this.faceVertexUvs[0].push([new THREE.UV(b[d][0],b[d][1]),new THREE.UV(b[f][0],b[f][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[m][0],b[m][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,e,c,d,f,g,m){function n(u,v,w,x,y,C){v=w/x*u;w=Math.cos(v);return new THREE.Vector3(y*(2+w)*0.5*Math.cos(u),y*(2+w)*Math.sin(u)*0.5,C*y*Math.sin(v)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=e||40;this.segmentsR=c||64;this.segmentsT=d||8;this.p=f||2;this.q=g||3;this.heightScale=m||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;d=new THREE.Vector3;g=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(e=0;e<this.segmentsT;++e){var h=
b/this.segmentsR*2*this.p*Math.PI;m=e/this.segmentsT*2*Math.PI;f=n(h,m,this.q,this.p,this.radius,this.heightScale);h=n(h+0.01,m,this.q,this.p,this.radius,this.heightScale);c.x=h.x-f.x;c.y=h.y-f.y;c.z=h.z-f.z;d.x=h.x+f.x;d.y=h.y+f.y;d.z=h.z+f.z;g.cross(c,d);d.cross(g,c);g.normalize();d.normalize();h=-this.tube*Math.cos(m);m=this.tube*Math.sin(m);f.x+=h*d.x+m*g.x;f.y+=h*d.y+m*g.y;f.z+=h*d.z+m*g.z;this.grid[b][e]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(f.x,f.y,f.z)))-1}}for(b=0;b<this.segmentsR;++b)for(e=
0;e<this.segmentsT;++e){d=(b+1)%this.segmentsR;g=(e+1)%this.segmentsT;f=this.grid[b][e];c=this.grid[d][e];d=this.grid[d][g];g=this.grid[b][g];m=new THREE.UV(b/this.segmentsR,e/this.segmentsT);h=new THREE.UV((b+1)/this.segmentsR,e/this.segmentsT);var o=new THREE.UV((b+1)/this.segmentsR,(e+1)/this.segmentsT),t=new THREE.UV(b/this.segmentsR,(e+1)/this.segmentsT);this.faces.push(new THREE.Face4(f,c,d,g));this.faceVertexUvs[0].push([m,h,o,t])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var e="Loaded ";e+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=e},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,e,c){b.materials=[];for(var d=0;d<e.length;++d)b.materials[d]=[THREE.Loader.prototype.createMaterial(e[d],c)]},createMaterial:function(b,e){function c(n){n=Math.log(n)/Math.LN2;return Math.floor(n)==n}function d(n,h){var o=new Image;o.onload=function(){if(!c(this.width)||!c(this.height)){var t=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),u=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));n.image.width=t;n.image.height=u;n.image.getContext("2d").drawImage(this,0,0,t,u)}else n.image=this;n.needsUpdate=!0};o.src=h}var f,g,m;f="MeshLambertMaterial";g={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};if(b.shading)if(b.shading=="Phong")f="MeshPhongMaterial";else b.shading=="Basic"&&(f="MeshBasicMaterial");if(b.blending)if(b.blending=="Additive")g.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")g.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")g.blending=THREE.MultiplyBlending;if(b.transparent!==undefined||b.opacity<1)g.transparent=b.transparent;if(b.depthTest!==undefined)g.depthTest=b.depthTest;if(b.vertexColors!==undefined)if(b.vertexColors=="face")g.vertexColors=THREE.FaceColors;else if(b.vertexColors)g.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&e){m=document.createElement("canvas");g.map=new THREE.Texture(m);g.map.sourceFile=b.mapDiffuse;d(g.map,e+"/"+b.mapDiffuse)}else if(b.colorDiffuse){m=(b.colorDiffuse[0]*255<<
16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255;g.color=m;g.opacity=b.transparency}else if(b.DbgColor)g.color=b.DbgColor;if(b.mapLightmap&&e){m=document.createElement("canvas");g.lightMap=new THREE.Texture(m);g.lightMap.sourceFile=b.mapLightmap;d(g.lightMap,e+"/"+b.mapLightmap)}return new THREE[f](g)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var e=this,c=b.model,d=b.callback,f=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(g){e.createModel(g.data,d,f);e.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,e,c){var d=new THREE.Geometry,f=b.scale!==undefined?1/b.scale:1;this.init_materials(d,b.materials,c);(function(g){if(b.version===undefined||b.version!=2)console.error("Deprecated file format.");else{var m,n,h,o,t,u,v,w,x,y,C,B,H,z,E=b.faces;u=b.vertices;var F=b.normals,D=b.colors,T=0;for(m=0;m<b.uvs.length;m++)b.uvs[m].length&&T++;for(m=0;m<T;m++){d.faceUvs[m]=[];d.faceVertexUvs[m]=[]}o=0;for(t=u.length;o<t;){v=new THREE.Vertex;v.position.x=u[o++]*
g;v.position.y=u[o++]*g;v.position.z=u[o++]*g;d.vertices.push(v)}o=0;for(t=E.length;o<t;){g=E[o++];u=g&1;h=g&2;m=g&4;n=g&8;w=g&16;v=g&32;y=g&64;g&=128;if(u){C=new THREE.Face4;C.a=E[o++];C.b=E[o++];C.c=E[o++];C.d=E[o++];u=4}else{C=new THREE.Face3;C.a=E[o++];C.b=E[o++];C.c=E[o++];u=3}if(h){h=E[o++];C.materials=d.materials[h]}h=d.faces.length;if(m)for(m=0;m<T;m++){B=b.uvs[m];x=E[o++];z=B[x*2];x=B[x*2+1];d.faceUvs[m][h]=new THREE.UV(z,x)}if(n)for(m=0;m<T;m++){B=b.uvs[m];H=[];for(n=0;n<u;n++){x=E[o++];
z=B[x*2];x=B[x*2+1];H[n]=new THREE.UV(z,x)}d.faceVertexUvs[m][h]=H}if(w){w=E[o++]*3;n=new THREE.Vector3;n.x=F[w++];n.y=F[w++];n.z=F[w];C.normal=n}if(v)for(m=0;m<u;m++){w=E[o++]*3;n=new THREE.Vector3;n.x=F[w++];n.y=F[w++];n.z=F[w];C.vertexNormals.push(n)}if(y){v=E[o++];v=new THREE.Color(D[v]);C.color=v}if(g)for(m=0;m<u;m++){v=E[o++];v=new THREE.Color(D[v]);C.vertexColors.push(v)}d.faces.push(C)}}})(f);(function(){var g,m,n,h;if(b.skinWeights){g=0;for(m=b.skinWeights.length;g<m;g+=2){n=b.skinWeights[g];
h=b.skinWeights[g+1];d.skinWeights.push(new THREE.Vector4(n,h,0,0))}}if(b.skinIndices){g=0;for(m=b.skinIndices.length;g<m;g+=2){n=b.skinIndices[g];h=b.skinIndices[g+1];d.skinIndices.push(new THREE.Vector4(n,h,0,0))}}d.bones=b.bones;d.animation=b.animation})();(function(g){if(b.morphTargets!==undefined){var m,n,h,o,t,u,v,w,x;m=0;for(n=b.morphTargets.length;m<n;m++){d.morphTargets[m]={};d.morphTargets[m].name=b.morphTargets[m].name;d.morphTargets[m].vertices=[];w=d.morphTargets[m].vertices;x=b.morphTargets[m].vertices;
h=0;for(o=x.length;h<o;h+=3){t=x[h]*g;u=x[h+1]*g;v=x[h+2]*g;w.push(new THREE.Vertex(new THREE.Vector3(t,u,v)))}}}if(b.morphColors!==undefined){m=0;for(n=b.morphColors.length;m<n;m++){d.morphColors[m]={};d.morphColors[m].name=b.morphColors[m].name;d.morphColors[m].colors=[];o=d.morphColors[m].colors;t=b.morphColors[m].colors;g=0;for(h=t.length;g<h;g+=3){u=new THREE.Color(16755200);u.setRGB(t[g],t[g+1],t[g+2]);o.push(u)}}}})(f);(function(){if(b.edges!==undefined){var g,m,n;for(g=0;g<b.edges.length;g+=
2){m=b.edges[g];n=b.edges[g+1];d.edges.push(new THREE.Edge(d.vertices[m],d.vertices[n],m,n))}}})();d.computeFaceNormals();e(d)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var e=b.model,c=b.callback,d=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(e),f=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(e);b=(new Date).getTime();e=new Worker(e);var g=this.showProgress?THREE.Loader.prototype.updateProgress:null;e.onmessage=function(m){THREE.BinaryLoader.prototype.loadAjaxBuffers(m.data.buffers,m.data.materials,c,f,d,g)};e.onerror=function(m){alert("worker.onerror: "+m.message+"\n"+m.data);m.preventDefault()};
e.postMessage(b)},loadAjaxBuffers:function(b,e,c,d,f,g){var m=new XMLHttpRequest,n=d+"/"+b,h=0;m.onreadystatechange=function(){if(m.readyState==4)m.status==200||m.status==0?THREE.BinaryLoader.prototype.createBinModel(m.responseText,c,f,e):alert("Couldn't load ["+n+"] ["+m.status+"]");else if(m.readyState==3){if(g){h==0&&(h=m.getResponseHeader("Content-Length"));g({total:h,loaded:m.responseText.length})}}else m.readyState==2&&(h=m.getResponseHeader("Content-Length"))};m.open("GET",n,!0);m.overrideMimeType("text/plain; charset=x-user-defined");
m.setRequestHeader("Content-Type","text/plain");m.send(null)},createBinModel:function(b,e,c,d){var f=function(g){function m(V,ia){var fa=t(V,ia),ca=t(V,ia+1),Ca=t(V,ia+2),Va=t(V,ia+3),A=(Va<<1&255|Ca>>7)-127;fa|=(Ca&127)<<16|ca<<8;if(fa==0&&A==-127)return 0;return(1-2*(Va>>7))*(1+fa*Math.pow(2,-23))*Math.pow(2,A)}function n(V,ia){var fa=t(V,ia),ca=t(V,ia+1),Ca=t(V,ia+2);return(t(V,ia+3)<<24)+(Ca<<16)+(ca<<8)+fa}function h(V,ia){var fa=t(V,ia);return(t(V,ia+1)<<8)+fa}function o(V,ia){var fa=t(V,ia);
return fa>127?fa-256:fa}function t(V,ia){return V.charCodeAt(ia)&255}function u(V){var ia,fa,ca;ia=n(b,V);fa=n(b,V+D);ca=n(b,V+T);V=h(b,V+W);THREE.BinaryLoader.prototype.f3(B,ia,fa,ca,V)}function v(V){var ia,fa,ca,Ca,Va,A;ia=n(b,V);fa=n(b,V+D);ca=n(b,V+T);Ca=h(b,V+W);Va=n(b,V+U);A=n(b,V+Y);V=n(b,V+N);THREE.BinaryLoader.prototype.f3n(B,E,ia,fa,ca,Ca,Va,A,V)}function w(V){var ia,fa,ca,Ca;ia=n(b,V);fa=n(b,V+p);ca=n(b,V+O);Ca=n(b,V+G);V=h(b,V+L);THREE.BinaryLoader.prototype.f4(B,ia,fa,ca,Ca,V)}function x(V){var ia,
fa,ca,Ca,Va,A,S,J;ia=n(b,V);fa=n(b,V+p);ca=n(b,V+O);Ca=n(b,V+G);Va=h(b,V+L);A=n(b,V+Q);S=n(b,V+M);J=n(b,V+da);V=n(b,V+ka);THREE.BinaryLoader.prototype.f4n(B,E,ia,fa,ca,Ca,Va,A,S,J,V)}function y(V){var ia,fa;ia=n(b,V);fa=n(b,V+$);V=n(b,V+ha);THREE.BinaryLoader.prototype.uv3(B.faceVertexUvs[0],F[ia*2],F[ia*2+1],F[fa*2],F[fa*2+1],F[V*2],F[V*2+1])}function C(V){var ia,fa,ca;ia=n(b,V);fa=n(b,V+qa);ca=n(b,V+sa);V=n(b,V+va);THREE.BinaryLoader.prototype.uv4(B.faceVertexUvs[0],F[ia*2],F[ia*2+1],F[fa*2],F[fa*
2+1],F[ca*2],F[ca*2+1],F[V*2],F[V*2+1])}var B=this,H=0,z,E=[],F=[],D,T,W,U,Y,N,p,O,G,L,Q,M,da,ka,$,ha,qa,sa,va,ua,ta,Da,Ba,Fa,ya;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(B,d,g);z={signature:b.substr(H,8),header_bytes:t(b,H+8),vertex_coordinate_bytes:t(b,H+9),normal_coordinate_bytes:t(b,H+10),uv_coordinate_bytes:t(b,H+11),vertex_index_bytes:t(b,H+12),normal_index_bytes:t(b,H+13),uv_index_bytes:t(b,H+14),material_index_bytes:t(b,H+15),nvertices:n(b,H+16),nnormals:n(b,H+16+4),
nuvs:n(b,H+16+8),ntri_flat:n(b,H+16+12),ntri_smooth:n(b,H+16+16),ntri_flat_uv:n(b,H+16+20),ntri_smooth_uv:n(b,H+16+24),nquad_flat:n(b,H+16+28),nquad_smooth:n(b,H+16+32),nquad_flat_uv:n(b,H+16+36),nquad_smooth_uv:n(b,H+16+40)};H+=z.header_bytes;D=z.vertex_index_bytes;T=z.vertex_index_bytes*2;W=z.vertex_index_bytes*3;U=z.vertex_index_bytes*3+z.material_index_bytes;Y=z.vertex_index_bytes*3+z.material_index_bytes+z.normal_index_bytes;N=z.vertex_index_bytes*3+z.material_index_bytes+z.normal_index_bytes*
2;p=z.vertex_index_bytes;O=z.vertex_index_bytes*2;G=z.vertex_index_bytes*3;L=z.vertex_index_bytes*4;Q=z.vertex_index_bytes*4+z.material_index_bytes;M=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes;da=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*2;ka=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*3;$=z.uv_index_bytes;ha=z.uv_index_bytes*2;qa=z.uv_index_bytes;sa=z.uv_index_bytes*2;va=z.uv_index_bytes*3;g=z.vertex_index_bytes*3+z.material_index_bytes;
ya=z.vertex_index_bytes*4+z.material_index_bytes;ua=z.ntri_flat*g;ta=z.ntri_smooth*(g+z.normal_index_bytes*3);Da=z.ntri_flat_uv*(g+z.uv_index_bytes*3);Ba=z.ntri_smooth_uv*(g+z.normal_index_bytes*3+z.uv_index_bytes*3);Fa=z.nquad_flat*ya;g=z.nquad_smooth*(ya+z.normal_index_bytes*4);ya=z.nquad_flat_uv*(ya+z.uv_index_bytes*4);H+=function(V){for(var ia,fa,ca,Ca=z.vertex_coordinate_bytes*3,Va=V+z.nvertices*Ca;V<Va;V+=Ca){ia=m(b,V);fa=m(b,V+z.vertex_coordinate_bytes);ca=m(b,V+z.vertex_coordinate_bytes*2);
THREE.BinaryLoader.prototype.v(B,ia,fa,ca)}return z.nvertices*Ca}(H);H+=function(V){for(var ia,fa,ca,Ca=z.normal_coordinate_bytes*3,Va=V+z.nnormals*Ca;V<Va;V+=Ca){ia=o(b,V);fa=o(b,V+z.normal_coordinate_bytes);ca=o(b,V+z.normal_coordinate_bytes*2);E.push(ia/127,fa/127,ca/127)}return z.nnormals*Ca}(H);H+=function(V){for(var ia,fa,ca=z.uv_coordinate_bytes*2,Ca=V+z.nuvs*ca;V<Ca;V+=ca){ia=m(b,V);fa=m(b,V+z.uv_coordinate_bytes);F.push(ia,fa)}return z.nuvs*ca}(H);ua=H+ua;ta=ua+ta;Da=ta+Da;Ba=Da+Ba;Fa=Ba+
Fa;g=Fa+g;ya=g+ya;(function(V){var ia,fa=z.vertex_index_bytes*3+z.material_index_bytes,ca=fa+z.uv_index_bytes*3,Ca=V+z.ntri_flat_uv*ca;for(ia=V;ia<Ca;ia+=ca){u(ia);y(ia+fa)}return Ca-V})(ta);(function(V){var ia,fa=z.vertex_index_bytes*3+z.material_index_bytes+z.normal_index_bytes*3,ca=fa+z.uv_index_bytes*3,Ca=V+z.ntri_smooth_uv*ca;for(ia=V;ia<Ca;ia+=ca){v(ia);y(ia+fa)}return Ca-V})(Da);(function(V){var ia,fa=z.vertex_index_bytes*4+z.material_index_bytes,ca=fa+z.uv_index_bytes*4,Ca=V+z.nquad_flat_uv*
ca;for(ia=V;ia<Ca;ia+=ca){w(ia);C(ia+fa)}return Ca-V})(g);(function(V){var ia,fa=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*4,ca=fa+z.uv_index_bytes*4,Ca=V+z.nquad_smooth_uv*ca;for(ia=V;ia<Ca;ia+=ca){x(ia);C(ia+fa)}return Ca-V})(ya);(function(V){var ia,fa=z.vertex_index_bytes*3+z.material_index_bytes,ca=V+z.ntri_flat*fa;for(ia=V;ia<ca;ia+=fa)u(ia);return ca-V})(H);(function(V){var ia,fa=z.vertex_index_bytes*3+z.material_index_bytes+z.normal_index_bytes*3,ca=V+z.ntri_smooth*
fa;for(ia=V;ia<ca;ia+=fa)v(ia);return ca-V})(ua);(function(V){var ia,fa=z.vertex_index_bytes*4+z.material_index_bytes,ca=V+z.nquad_flat*fa;for(ia=V;ia<ca;ia+=fa)w(ia);return ca-V})(Ba);(function(V){var ia,fa=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*4,ca=V+z.nquad_smooth*fa;for(ia=V;ia<ca;ia+=fa)x(ia);return ca-V})(Fa);this.computeCentroids();this.computeFaceNormals()};f.prototype=new THREE.Geometry;f.prototype.constructor=f;e(new f(c))},v:function(b,e,c,d){b.vertices.push(new THREE.Vertex(new THREE.Vector3(e,
c,d)))},f3:function(b,e,c,d,f){b.faces.push(new THREE.Face3(e,c,d,null,null,b.materials[f]))},f4:function(b,e,c,d,f,g){b.faces.push(new THREE.Face4(e,c,d,f,null,null,b.materials[g]))},f3n:function(b,e,c,d,f,g,m,n,h){g=b.materials[g];var o=e[n*3],t=e[n*3+1];n=e[n*3+2];var u=e[h*3],v=e[h*3+1];h=e[h*3+2];b.faces.push(new THREE.Face3(c,d,f,[new THREE.Vector3(e[m*3],e[m*3+1],e[m*3+2]),new THREE.Vector3(o,t,n),new THREE.Vector3(u,v,h)],null,g))},f4n:function(b,e,c,d,f,g,m,n,h,o,t){m=b.materials[m];var u=
e[h*3],v=e[h*3+1];h=e[h*3+2];var w=e[o*3],x=e[o*3+1];o=e[o*3+2];var y=e[t*3],C=e[t*3+1];t=e[t*3+2];b.faces.push(new THREE.Face4(c,d,f,g,[new THREE.Vector3(e[n*3],e[n*3+1],e[n*3+2]),new THREE.Vector3(u,v,h),new THREE.Vector3(w,x,o),new THREE.Vector3(y,C,t)],null,m))},uv3:function(b,e,c,d,f,g,m){var n=[];n.push(new THREE.UV(e,c));n.push(new THREE.UV(d,f));n.push(new THREE.UV(g,m));b.push(n)},uv4:function(b,e,c,d,f,g,m,n,h){var o=[];o.push(new THREE.UV(e,c));o.push(new THREE.UV(d,f));o.push(new THREE.UV(g,
m));o.push(new THREE.UV(n,h));b.push(o)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,e){var c=this,d=new Worker(b);d.postMessage(0);var f=THREE.Loader.prototype.extractUrlbase(b);d.onmessage=function(g){function m($,ha){return ha=="relativeToHTML"?$:f+"/"+$}function n(){for(w in Y.objects)if(!Q.objects[w]){H=Y.objects[w];if(H.geometry!==undefined){if(D=Q.geometries[H.geometry]){U=[];for(ka=0;ka<H.materials.length;ka++)U[ka]=Q.materials[H.materials[ka]];z=H.position;r=H.rotation;q=H.quaternion;s=H.scale;q=0;U.length==0&&(U[0]=new THREE.MeshFaceMaterial);
U.length>1&&(U=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(D,U);object.name=w;object.position.set(z[0],z[1],z[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=H.visible;Q.scene.addObject(object);Q.objects[w]=object;if(H.meshCollider){var $=THREE.CollisionUtils.MeshColliderWBox(object);Q.scene.collisions.colliders.push($)}if(H.castsShadow){$=new THREE.ShadowVolume(D);Q.scene.addChild($);
$.position=object.position;$.rotation=object.rotation;$.scale=object.scale}if(H.trigger&&H.trigger.toLowerCase()!="none"){$={type:H.trigger,object:H};Q.triggers[object.name]=$}}}else{z=H.position;r=H.rotation;q=H.quaternion;s=H.scale;q=0;object=new THREE.Object3D;object.name=w;object.position.set(z[0],z[1],z[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=H.visible!==undefined?H.visible:
!1;Q.scene.addObject(object);Q.objects[w]=object;Q.empties[w]=object;if(H.trigger&&H.trigger.toLowerCase()!="none"){$={type:H.trigger,object:H};Q.triggers[object.name]=$}}}}function h($){return function(ha){Q.geometries[$]=ha;n();p-=1;c.onLoadComplete();t()}}function o($){return function(ha){Q.geometries[$]=ha}}function t(){c.callbackProgress({totalModels:G,totalTextures:L,loadedModels:G-p,loadedTextures:L-O},Q);c.onLoadProgress();p==0&&O==0&&e(Q)}var u,v,w,x,y,C,B,H,z,E,F,D,T,W,U,Y,N,p,O,G,L,Q;Y=
g.data;g=new THREE.BinaryLoader;N=new THREE.JSONLoader;O=p=0;Q={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var M=!1;for(w in Y.objects){H=Y.objects[w];if(H.meshCollider){M=!0;break}}if(M)Q.scene.collisions=new THREE.CollisionSystem;if(Y.transform){M=Y.transform.position;E=Y.transform.rotation;var da=Y.transform.scale;M&&Q.scene.position.set(M[0],M[1],M[2]);E&&Q.scene.rotation.set(E[0],E[1],E[2]);da&&Q.scene.scale.set(da[0],
da[1],da[2]);(M||E||da)&&Q.scene.updateMatrix()}M=function(){O-=1;t();c.onLoadComplete()};for(y in Y.cameras){E=Y.cameras[y];if(E.type=="perspective")T=new THREE.Camera(E.fov,E.aspect,E.near,E.far);else if(E.type=="ortho"){T=new THREE.Camera;T.projectionMatrix=THREE.Matrix4.makeOrtho(E.left,E.right,E.top,E.bottom,E.near,E.far)}z=E.position;E=E.target;T.position.set(z[0],z[1],z[2]);T.target.position.set(E[0],E[1],E[2]);Q.cameras[y]=T}for(x in Y.lights){y=Y.lights[x];T=y.color!==undefined?y.color:16777215;
E=y.intensity!==undefined?y.intensity:1;if(y.type=="directional"){z=y.direction;light=new THREE.DirectionalLight(T,E);light.position.set(z[0],z[1],z[2]);light.position.normalize()}else if(y.type=="point"){z=y.position;light=new THREE.PointLight(T,E);light.position.set(z[0],z[1],z[2])}Q.scene.addLight(light);Q.lights[x]=light}for(C in Y.fogs){x=Y.fogs[C];if(x.type=="linear")W=new THREE.Fog(0,x.near,x.far);else x.type=="exp2"&&(W=new THREE.FogExp2(0,x.density));E=x.color;W.color.setRGB(E[0],E[1],E[2]);
Q.fogs[C]=W}if(Q.cameras&&Y.defaults.camera)Q.currentCamera=Q.cameras[Y.defaults.camera];if(Q.fogs&&Y.defaults.fog)Q.scene.fog=Q.fogs[Y.defaults.fog];E=Y.defaults.bgcolor;Q.bgColor=new THREE.Color;Q.bgColor.setRGB(E[0],E[1],E[2]);Q.bgColorAlpha=Y.defaults.bgalpha;for(u in Y.geometries){C=Y.geometries[u];if(C.type=="bin_mesh"||C.type=="ascii_mesh"){p+=1;c.onLoadStart()}}G=p;for(u in Y.geometries){C=Y.geometries[u];if(C.type=="cube"){D=new THREE.Cube(C.width,C.height,C.depth,C.segmentsWidth,C.segmentsHeight,
C.segmentsDepth,null,C.flipped,C.sides);Q.geometries[u]=D}else if(C.type=="plane"){D=new THREE.Plane(C.width,C.height,C.segmentsWidth,C.segmentsHeight);Q.geometries[u]=D}else if(C.type=="sphere"){D=new THREE.Sphere(C.radius,C.segmentsWidth,C.segmentsHeight);Q.geometries[u]=D}else if(C.type=="cylinder"){D=new THREE.Cylinder(C.numSegs,C.topRad,C.botRad,C.height,C.topOffset,C.botOffset);Q.geometries[u]=D}else if(C.type=="torus"){D=new THREE.Torus(C.radius,C.tube,C.segmentsR,C.segmentsT);Q.geometries[u]=
D}else if(C.type=="icosahedron"){D=new THREE.Icosahedron(C.subdivisions);Q.geometries[u]=D}else if(C.type=="bin_mesh")g.load({model:m(C.url,Y.urlBaseType),callback:h(u)});else if(C.type=="ascii_mesh")N.load({model:m(C.url,Y.urlBaseType),callback:h(u)});else C.type=="embedded_mesh"&&(C=Y.embeds[C.id])&&N.createModel(C,o(u),"")}for(B in Y.textures){u=Y.textures[B];if(u.url instanceof Array){O+=u.url.length;for(g=0;g<u.url.length;g++)c.onLoadStart()}else{O+=1;c.onLoadStart()}}L=O;for(B in Y.textures){u=
Y.textures[B];if(u.mapping!=undefined&&THREE[u.mapping]!=undefined)u.mapping=new THREE[u.mapping];if(u.url instanceof Array){g=[];for(var ka=0;ka<u.url.length;ka++)g[ka]=m(u.url[ka],Y.urlBaseType);g=THREE.ImageUtils.loadTextureCube(g,u.mapping,M)}else{g=THREE.ImageUtils.loadTexture(m(u.url,Y.urlBaseType),u.mapping,M);if(THREE[u.minFilter]!=undefined)g.minFilter=THREE[u.minFilter];if(THREE[u.magFilter]!=undefined)g.magFilter=THREE[u.magFilter]}Q.textures[B]=g}for(v in Y.materials){B=Y.materials[v];
for(F in B.parameters)if(F=="envMap"||F=="map"||F=="lightMap")B.parameters[F]=Q.textures[B.parameters[F]];else if(F=="shading")B.parameters[F]=B.parameters[F]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(F=="blending")B.parameters[F]=THREE[B.parameters[F]]?THREE[B.parameters[F]]:THREE.NormalBlending;else if(F=="combine")B.parameters[F]=B.parameters[F]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(F=="vertexColors")if(B.parameters[F]=="face")B.parameters[F]=THREE.FaceColors;
else if(B.parameters[F])B.parameters[F]=THREE.VertexColors;if(B.parameters.opacity!==undefined&&B.parameters.opacity<1)B.parameters.transparent=!0;B=new THREE[B.type](B.parameters);Q.materials[v]=B}n();c.callbackSync(Q)}}};
THREE.MarchingCubes=function(b,e){THREE.Object3D.call(this);this.materials=e instanceof Array?e:[e];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasPos=!1;this.hasNormal=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,d,f){return c+(d-c)*f};this.VIntX=function(c,d,f,g,m,n,h,o,t,u){m=(m-t)/(u-t);t=this.normal_cache;d[g]=n+m*this.delta;d[g+1]=h;d[g+2]=o;f[g]=this.lerp(t[c],t[c+3],m);f[g+1]=this.lerp(t[c+1],t[c+4],m);f[g+2]=this.lerp(t[c+2],t[c+5],m)};this.VIntY=function(c,d,f,g,m,n,h,o,t,u){m=(m-t)/(u-t);t=this.normal_cache;d[g]=n;d[g+1]=h+m*this.delta;d[g+
2]=o;d=c+this.yd*3;f[g]=this.lerp(t[c],t[d],m);f[g+1]=this.lerp(t[c+1],t[d+1],m);f[g+2]=this.lerp(t[c+2],t[d+2],m)};this.VIntZ=function(c,d,f,g,m,n,h,o,t,u){m=(m-t)/(u-t);t=this.normal_cache;d[g]=n;d[g+1]=h;d[g+2]=o+m*this.delta;d=c+this.zd*3;f[g]=this.lerp(t[c],t[d],m);f[g+1]=this.lerp(t[c+1],t[d+1],m);f[g+2]=this.lerp(t[c+2],t[d+2],m)};this.compNorm=function(c){var d=c*3;if(this.normal_cache[d]==0){this.normal_cache[d]=this.field[c-1]-this.field[c+1];this.normal_cache[d+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[d+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,d,f,g,m,n){var h=g+1,o=g+this.yd,t=g+this.zd,u=h+this.yd,v=h+this.zd,w=g+this.yd+this.zd,x=h+this.yd+this.zd,y=0,C=this.field[g],B=this.field[h],H=this.field[o],z=this.field[u],E=this.field[t],F=this.field[v],D=this.field[w],T=this.field[x];C<m&&(y|=1);B<m&&(y|=2);H<m&&(y|=8);z<m&&(y|=4);E<m&&(y|=16);F<m&&(y|=32);D<m&&(y|=128);T<m&&(y|=64);var W=THREE.edgeTable[y];if(W==0)return 0;
var U=this.delta,Y=c+U,N=d+U;U=f+U;if(W&1){this.compNorm(g);this.compNorm(h);this.VIntX(g*3,this.vlist,this.nlist,0,m,c,d,f,C,B)}if(W&2){this.compNorm(h);this.compNorm(u);this.VIntY(h*3,this.vlist,this.nlist,3,m,Y,d,f,B,z)}if(W&4){this.compNorm(o);this.compNorm(u);this.VIntX(o*3,this.vlist,this.nlist,6,m,c,N,f,H,z)}if(W&8){this.compNorm(g);this.compNorm(o);this.VIntY(g*3,this.vlist,this.nlist,9,m,c,d,f,C,H)}if(W&16){this.compNorm(t);this.compNorm(v);this.VIntX(t*3,this.vlist,this.nlist,12,m,c,d,U,
E,F)}if(W&32){this.compNorm(v);this.compNorm(x);this.VIntY(v*3,this.vlist,this.nlist,15,m,Y,d,U,F,T)}if(W&64){this.compNorm(w);this.compNorm(x);this.VIntX(w*3,this.vlist,this.nlist,18,m,c,N,U,D,T)}if(W&128){this.compNorm(t);this.compNorm(w);this.VIntY(t*3,this.vlist,this.nlist,21,m,c,d,U,E,D)}if(W&256){this.compNorm(g);this.compNorm(t);this.VIntZ(g*3,this.vlist,this.nlist,24,m,c,d,f,C,E)}if(W&512){this.compNorm(h);this.compNorm(v);this.VIntZ(h*3,this.vlist,this.nlist,27,m,Y,d,f,B,F)}if(W&1024){this.compNorm(u);
this.compNorm(x);this.VIntZ(u*3,this.vlist,this.nlist,30,m,Y,N,f,z,T)}if(W&2048){this.compNorm(o);this.compNorm(w);this.VIntZ(o*3,this.vlist,this.nlist,33,m,c,N,f,H,D)}y<<=4;for(m=g=0;THREE.triTable[y+m]!=-1;){c=y+m;d=c+1;f=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[d],3*THREE.triTable[f],n);m+=3;g++}return g};this.posnormtriv=function(c,d,f,g,m,n){var h=this.count*3;this.positionArray[h]=c[f];this.positionArray[h+1]=c[f+1];this.positionArray[h+2]=c[f+2];this.positionArray[h+
3]=c[g];this.positionArray[h+4]=c[g+1];this.positionArray[h+5]=c[g+2];this.positionArray[h+6]=c[m];this.positionArray[h+7]=c[m+1];this.positionArray[h+8]=c[m+2];this.normalArray[h]=d[f];this.normalArray[h+1]=d[f+1];this.normalArray[h+2]=d[f+2];this.normalArray[h+3]=d[g];this.normalArray[h+4]=d[g+1];this.normalArray[h+5]=d[g+2];this.normalArray[h+6]=d[m];this.normalArray[h+7]=d[m+1];this.normalArray[h+8]=d[m+2];this.hasPos=!0;this.hasNormal=!0;this.count+=3;this.count>=this.maxCount-3&&n(this)};this.begin=
function(){this.count=0;this.hasPos=!1;this.hasNormal=!1};this.end=function(c){if(this.count!=0){for(var d=this.count*3;d<this.positionArray.length;d++)this.positionArray[d]=0;c(this)}};this.addBall=function(c,d,f,g,m){var n=this.size*Math.sqrt(g/m),h=f*this.size,o=d*this.size,t=c*this.size,u=Math.floor(h-n);u<1&&(u=1);h=Math.floor(h+n);h>this.size-1&&(h=this.size-1);var v=Math.floor(o-n);v<1&&(v=1);o=Math.floor(o+n);o>this.size-1&&(o=this.size-1);var w=Math.floor(t-n);w<1&&(w=1);n=Math.floor(t+n);
n>this.size-1&&(n=this.size-1);for(var x,y,C,B,H,z;u<h;u++){t=this.size2*u;y=u/this.size-f;H=y*y;for(y=v;y<o;y++){C=t+this.size*y;x=y/this.size-d;z=x*x;for(x=w;x<n;x++){B=x/this.size-c;B=g/(1.0E-6+B*B+z+H)-m;B>0&&(this.field[C+x]+=B)}}}};this.addPlaneX=function(c,d){var f,g,m,n,h,o=this.size,t=this.yd,u=this.zd,v=this.field,w=o*Math.sqrt(c/d);w>o&&(w=o);for(f=0;f<w;f++){g=f/o;g*=g;n=c/(1.0E-4+g)-d;if(n>0)for(g=0;g<o;g++){h=f+g*t;for(m=0;m<o;m++)v[u*m+h]+=n}}};this.addPlaneY=function(c,d){var f,g,
m,n,h,o,t=this.size,u=this.yd,v=this.zd,w=this.field,x=t*Math.sqrt(c/d);x>t&&(x=t);for(g=0;g<x;g++){f=g/t;f*=f;n=c/(1.0E-4+f)-d;if(n>0){h=g*u;for(f=0;f<t;f++){o=h+f;for(m=0;m<t;m++)w[v*m+o]+=n}}}};this.addPlaneZ=function(c,d){var f,g,m,n,h,o;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/d);dist>size&&(dist=size);for(m=0;m<dist;m++){f=m/size;f*=f;n=c/(1.0E-4+f)-d;if(n>0){h=zd*m;for(g=0;g<size;g++){o=h+g*yd;for(f=0;f<size;f++)field[o+f]+=n}}}};this.reset=function(){var c;
for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var d,f,g,m,n,h,o,t,u,v=this.size-2;for(m=1;m<v;m++){u=this.size2*m;o=(m-this.halfsize)/this.halfsize;for(g=1;g<v;g++){t=u+this.size*g;h=(g-this.halfsize)/this.halfsize;for(f=1;f<v;f++){n=(f-this.halfsize)/this.halfsize;d=t+f;this.polygonize(n,h,o,d,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,d=new THREE.Geometry,f=[];this.render(function(g){var m,n,h,o,t,u,v,w;for(m=
0;m<g.count;m++){v=m*3;t=v+1;w=v+2;n=g.positionArray[v];h=g.positionArray[t];o=g.positionArray[w];u=new THREE.Vector3(n,h,o);n=g.normalArray[v];h=g.normalArray[t];o=g.normalArray[w];v=new THREE.Vector3(n,h,o);v.normalize();t=new THREE.Vertex(u);d.vertices.push(t);f.push(v)}nfaces=g.count/3;for(m=0;m<nfaces;m++){v=(c+m)*3;t=v+1;w=v+2;u=f[v];n=f[t];h=f[w];v=new THREE.Face3(v,t,w,[u,n,h]);d.faces.push(v)}c+=nfaces;g.count=0});return d};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;
THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function e(g){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:g}))}function c(g,m){var n=new THREE.Geometry;n.vertices=[new THREE.Vertex,new THREE.Vertex(g)];return new THREE.Line(n,new THREE.LineBasicMaterial({color:m}))}THREE.Object3D.call(this);var d=Math.PI/2,f;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(f in THREE.Trident.defaultParams)b.hasOwnProperty(f)||(b[f]=THREE.Trident.defaultParams[f]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){f=e(b.xAxisColor);f.rotation.y=-d;f.position.x=b.length;this.addChild(f);f=e(b.yAxisColor);f.rotation.x=d;f.position.y=b.length;this.addChild(f);f=e(b.zAxisColor);f.rotation.y=Math.PI;f.position.z=b.length;this.addChild(f)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,e){this.point=b;this.normal=e};THREE.SphereCollider=function(b,e){this.center=b;this.radius=e;this.radiusSq=e*e};THREE.BoxCollider=function(b,e){this.min=b;this.max=e;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,e,c,d){this.vertices=b;this.faces=e;this.normals=c;this.box=d;this.numFaces=this.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var e,c,d,f,g=0;e=0;for(c=this.colliders.length;e<c;e++){f=this.colliders[e];d=this.rayCast(b,f);if(d<Number.MAX_VALUE){f.distance=d;d>g?this.hits.push(f):this.hits.unshift(f);g=d}}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var e=this.rayCastAll(b);if(e.length==0)return null;for(var c=0;e[c]instanceof THREE.MeshCollider;){var d=this.rayMesh(b,e[c]);if(d<Number.MAX_VALUE){e[c].distance=d;break}c++}if(c>e.length)return null;return e[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,e){if(e instanceof THREE.PlaneCollider)return this.rayPlane(b,e);else if(e instanceof THREE.SphereCollider)return this.raySphere(b,e);else if(e instanceof THREE.BoxCollider)return this.rayBox(b,e);else if(e instanceof THREE.MeshCollider&&e.box)return this.rayBox(b,e.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,e){for(var c=this.makeRayLocal(b,e.mesh),d=Number.MAX_VALUE,f=0;f<e.numFaces/3;f++){var g=f*3;g=this.rayTriangle(c,e.vertices[e.faces[g+0]],e.vertices[e.faces[g+1]],e.vertices[e.faces[g+2]],d,this.collisionNormal);if(g<d){d=g;e.normal.copy(this.collisionNormal);e.normal.normalize()}}return d};
THREE.CollisionSystem.prototype.rayTriangle=function(b,e,c,d,f,g){var m=THREE.CollisionSystem.__v1,n=THREE.CollisionSystem.__v2;g.set(0,0,0);m.sub(c,e);n.sub(d,c);g.cross(m,n);n=g.dot(b.direction);if(!(n<0))return Number.MAX_VALUE;m=g.dot(e)-g.dot(b.origin);if(!(m<=0))return Number.MAX_VALUE;if(!(m>=n*f))return Number.MAX_VALUE;m/=n;n=THREE.CollisionSystem.__v3;n.copy(b.direction);n.multiplyScalar(m);n.addSelf(b.origin);if(Math.abs(g.x)>Math.abs(g.y))if(Math.abs(g.x)>Math.abs(g.z)){b=n.y-e.y;g=c.y-
e.y;f=d.y-e.y;n=n.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=n.x-e.x;g=c.x-e.x;f=d.x-e.x;n=n.y-e.y;c=c.y-e.y;d=d.y-e.y}else if(Math.abs(g.y)>Math.abs(g.z)){b=n.x-e.x;g=c.x-e.x;f=d.x-e.x;n=n.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=n.x-e.x;g=c.x-e.x;f=d.x-e.x;n=n.y-e.y;c=c.y-e.y;d=d.y-e.y}e=g*d-c*f;if(e==0)return Number.MAX_VALUE;e=1/e;d=(b*d-n*f)*e;if(!(d>=0))return Number.MAX_VALUE;e*=g*n-c*b;if(!(e>=0))return Number.MAX_VALUE;if(!(1-d-e>=0))return Number.MAX_VALUE;return m};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,e){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(e.matrixWorld,c);var d=THREE.CollisionSystem.__r;d.origin.copy(b.origin);d.direction.copy(b.direction);c.multiplyVector3(d.origin);c.rotateAxis(d.direction);d.direction.normalize();return d};
THREE.CollisionSystem.prototype.rayBox=function(b,e){var c;if(e.dynamic&&e.mesh&&e.mesh.matrixWorld)c=this.makeRayLocal(b,e.mesh);else{c=THREE.CollisionSystem.__r;c.origin.copy(b.origin);c.direction.copy(b.direction)}var d=0,f=0,g=0,m=0,n=0,h=0,o=!0;if(c.origin.x<e.min.x){d=e.min.x-c.origin.x;d/=c.direction.x;o=!1;m=-1}else if(c.origin.x>e.max.x){d=e.max.x-c.origin.x;d/=c.direction.x;o=!1;m=1}if(c.origin.y<e.min.y){f=e.min.y-c.origin.y;f/=c.direction.y;o=!1;n=-1}else if(c.origin.y>e.max.y){f=e.max.y-
c.origin.y;f/=c.direction.y;o=!1;n=1}if(c.origin.z<e.min.z){g=e.min.z-c.origin.z;g/=c.direction.z;o=!1;h=-1}else if(c.origin.z>e.max.z){g=e.max.z-c.origin.z;g/=c.direction.z;o=!1;h=1}if(o)return-1;o=0;if(f>d){o=1;d=f}if(g>d){o=2;d=g}switch(o){case 0:n=c.origin.y+c.direction.y*d;if(n<e.min.y||n>e.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(m,0,0);break;case 1:m=c.origin.x+c.direction.x*d;if(m<e.min.x||m>e.max.x)return Number.MAX_VALUE;
c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(0,n,0);break;case 2:m=c.origin.x+c.direction.x*d;if(m<e.min.x||m>e.max.x)return Number.MAX_VALUE;n=c.origin.y+c.direction.y*d;if(n<e.min.y||n>e.max.y)return Number.MAX_VALUE;e.normal.set(0,0,h)}return d};THREE.CollisionSystem.prototype.rayPlane=function(b,e){var c=b.direction.dot(e.normal),d=e.point.dot(e.normal);if(c<0)c=(d-b.origin.dot(e.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,e){var c=e.center.clone().subSelf(b.origin);if(c.lengthSq<e.radiusSq)return-1;var d=c.dot(b.direction.clone());if(d<=0)return Number.MAX_VALUE;c=e.radiusSq-(c.lengthSq()-d*d);if(c>=0)return Math.abs(d)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var e=b.geometry.boundingBox,c=new THREE.Vector3(e.x[0],e.y[0],e.z[0]);e=new THREE.Vector3(e.x[1],e.y[1],e.z[1]);c=new THREE.BoxCollider(c,e);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var e=THREE.CollisionUtils.MeshOBB(b);e.min.addSelf(b.position);e.max.addSelf(b.position);e.dynamic=!1;return e};
THREE.CollisionUtils.MeshColliderWBox=function(b){for(var e=b.geometry.vertices,c=e.length,d=b.geometry.faces,f=d.length,g=[],m=[],n=[],h=0;h<c;h++)g.push(new THREE.Vector3(e[h].position.x,e[h].position.y,e[h].position.z));for(h=0;h<f;h++){m.push(d[h].a,d[h].b,d[h].c);n.push(new THREE.Vector3(d[h].normal.x,d[h].normal.y,d[h].normal.z))}e=new THREE.MeshCollider(g,m,n,THREE.CollisionUtils.MeshOBB(b));e.mesh=b;return e};
var LoadingBar=function(b){function e(){var o=n/m;if(o>h){h=o;f.style.width=o*275+"px"}}var c,d,f,g,m=0,n=0,h=0;c=document.createElement("div");d=document.createElement("div");d.style.position="absolute";d.style.display="block";d.style.width="275px";d.style.height="8px";d.style.borderStyle="solid";d.style.borderColor="rgba(255,255,255,0.5)";d.style.borderWidth="1px";d.style.borderRadius="5px";d.style.marginLeft="12px";c.appendChild(d);f=document.createElement("div");f.style.position="absolute";f.style.height=
"8px";f.style.width="0";f.style.background="#fff";f.style.borderRadius="5px";f.style.margin="1px 0 0 13px";c.appendChild(f);g=document.createElement("div");g.setAttribute("style","margin: 30px auto 0 auto;");g.innerHTML="<img src = '/files/mouse_loading.png' alt = 'arrows' />";g.style.marginLeft="8px";c.appendChild(g);c.style.margin="-5px 0 0 0";this.addItem=function(){m++;e()};this.completeItem=function(){n++;e();if(m!=0&&m==n){if(m==n)f.style.background="#000";b()}};this.getMouseInfo=function(){return g};
this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,e=[],c=[],d=[],f=0,g=0,m=0,n=!1;this.add=function(h,o,t,u){h.__active=!1;h.__start=o;h.__duration=t-o;h.__end=t;h.__layer=u;h.init();e.push(h);e.sort(function(v,w){return v.__start-w.__start});d.push(h);d.sort(function(v,w){return v.__end-w.__end})};this.update=function(h){if(h<m){this.clear();m=h}for(;e[f];){b=e[f];if(b.__start>h)break;if(!b.__active&&b.__end>h){b.show((h-b.__start)/b.__duration);b.__active=!0;c.push(b);n=!0}f++}for(;d[g];){b=d[g];if(b.__end>h)break;
if(b.__active){b.hide();b.__active=!1;var o=c.indexOf(b);o!==-1&&c.splice(o,1)}g++}if(n){c.sort(function(u,v){return u.__layer-v.__layer});n=!1}o=0;for(var t=c.length;o<t;o++){b=c[o];b.update((h-b.__start)/b.__duration,h-m,h)}m=h};this.clear=function(){for(g=f=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var e,c,d;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(f){e=f;d=1/e*6E4};this.getBPM=function(){return e};this.setMS=function(f){d=f;e=1/d*6E4};this.getMS=function(){return d};this.setRows=function(f){c=f};this.getRows=function(){return c};this.getBeatMS=function(f){return d*f};this.getPatternMS=function(f){return d*c*f}};function preInitModel(b,e,c){e.initWebGLObjects(c);for(e=0;e<b.materials.length;e++);}
function preInitScene(b,e){e.initWebGLObjects(b.scene);var c,d;for(c in b.materials){d=b.materials[c];d instanceof THREE.MeshFaceMaterial||d.program||setTimeout(function(){e.initMaterial(d,b.scene.lights,b.scene.fog)},250)}}function preinitAnimal(b,e,c){e.initWebGLObjects(c)}LensFlareTextures={texture0:undefined,texture1:undefined,texture2:undefined};
function initLensFlares(b,e,c){if(LensFlareTextures.texture0===undefined){LensFlareTextures.texture0=THREE.ImageUtils.loadTexture("/files/textures/lensflare0.png");LensFlareTextures.texture1=THREE.ImageUtils.loadTexture("/files/textures/lensflare2.png");LensFlareTextures.texture2=THREE.ImageUtils.loadTexture("/files/textures/lensflare3.png")}var d=new THREE.LensFlare(LensFlareTextures.texture0,700,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,
512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,60,0.6,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,70,0.7,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,120,0.9,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,70,1,THREE.AdditiveBlending);d.customUpdateCallback=lensFlareUpdateCallback;d.position.copy(b);b=new THREE.Object3D;b.addChild(d);b.rotation.x=e*Math.PI/180;b.rotation.y=c*Math.PI/180;
return b}function lensFlareUpdateCallback(b){var e,c,d=b.lensFlares.length,f=-b.positionScreen.x*2,g=-b.positionScreen.y*2;for(c=0;c<d;c++){e=b.lensFlares[c];e.x=b.positionScreen.x+f*e.distance;e.y=b.positionScreen.y+g*e.distance;e.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var e,c,d;e=0;for(c=b.objects.length;e<c;e++){d=b.objects[e];d.matrixAutoUpdate=!1;d.updateMatrix()}}
function hideColliders(b){var e,c,d;e=0;for(c=b.collisions.colliders.length;e<c;e++){d=b.collisions.colliders[e].mesh;d.visible=!1}}function applyMaterial(b,e,c){var d,f,g,m=e.length;for(d=0;d<m;d++){f=e[d][0];g=e[d][1];b.objects[f]&&(b.objects[f].geometry.materials[g][0]=c)}}
var UgcObject=function(b){var e=UgcObject.TYPE_GROUND,c={},d=0;this.addVoxel=function(h,o,t,u,v){c[h+"."+o+"."+t]={x:h,y:o,z:t,color:u,object:v};d++};this.getType=function(){return e};this.setType=function(h){e=h};this.getVoxel=function(h,o,t){return c[h+"."+o+"."+t]};this.deleteVoxel=function(h,o,t){delete c[h+"."+o+"."+t];d--};this.isEmpty=function(){return d==0};this.getGrid=function(){return c};this.setGrid=function(h){c=h};this.clear=function(){delete c;c={};d=0};this.getJSON=function(){function h(){if(w.length){u.push(v);
u.push(x);u=u.concat(w)}}var o,t,u=[5],v=null,w=[],x=0;for(o in c){t=c[o];if(t.color!=v){h();v=t.color;x=0;w=[]}w.push(t.x,t.y,t.z);x++}h();return JSON.stringify(u)};this.getMesh=function(){var h,o,t=new THREE.Mesh(new THREE.Cube(50,50,50)),u=new THREE.Geometry;for(h in c){o=c[h];t.position.x=o.x*50;t.position.y=o.y*50;t.position.z=o.z*50;for(h=0;h<t.geometry.faces.length;h++)t.geometry.faces[h].color.setHex(o.color);GeometryUtils.merge(u,t)}h=new THREE.MeshShaderMaterial({uniforms:UgcShader.uniforms(),
vertexShader:UgcShader.vertexShader,fragmentShader:UgcShader.fragmentShader,shading:THREE.FlatShading,lights:!0,vertexColors:1});return new THREE.Mesh(u,h)};if(b&&b[0]==5)for(var f=1,g=b.length,m=0,n=0;f<g;){m=b[f++];n=b[f++];for(j=0;j<n;j++)this.addVoxel(b[f++],b[f++],b[f++],m)}};UgcObject.TYPE_GROUND="ground";UgcObject.TYPE_SKY="sky";
var UgcHandler=function(){function b(m){var n=window.location.search;if(n!==""){m=m.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");m=RegExp("[\\?&]"+m+"=([^&#]*)").exec(n);if(m!=null)return decodeURIComponent(m[1].replace(/\+/g," "))}}function e(m){var n,h,o,t,u,v;u=m.length;t=o=0;for(v=new Uint8Array(u/4*3);o<u;){do n=g[m.charCodeAt(o++)&255];while(o<u&&n==-1);if(n==-1)break;do h=g[m.charCodeAt(o++)&255];while(o<u&&h==-1);if(h==-1)break;v[t++]=n<<2|(h&48)>>4;do{n=m.charCodeAt(o++)&255;if(n==61)return v;
n=g[n]}while(o<u&&n==-1);if(n==-1)break;v[t++]=(h&15)<<4|(n&60)>>2;do{h=m.charCodeAt(o++)&255;if(h==61)return v;h=g[h]}while(o<u&&h==-1);if(h==-1)break;v[t++]=(n&3)<<6|h}return v}function c(m,n,h){function o(x){return x.charCodeAt(0)&255}h=h||{};h.type=h.type||"image/png";h.filename=h.filename||"file";var t=new XMLHttpRequest,u='--BEAUTIFUL----------------BOUNDRY\r\nContent-Disposition: form-data; name="file"; filename="'+h.filename+'"\r\nContent-Type: '+h.type+"\r\n\r\n";n=e(n.slice(h.type.length+
13));head=Array.prototype.map.call(u,o);tail=Array.prototype.map.call("\r\n--BEAUTIFUL----------------BOUNDRY--",o);var v=head.length,w=n.length;u=new Uint8Array(v+w+tail.length);u.set(head);u.set(n,v);u.set(tail,v+w);t.open("POST",m,!0);t.setRequestHeader("Content-Type","multipart/form-data; boundary=BEAUTIFUL----------------BOUNDRY");t.onreadystatechange=function(){t.readyState===4&&h.callback&&h.callback(t.responseText)};t.sendAsBinary?t.sendAsBinary(u.buffer):t.send(u.buffer);return t.responseText}
var d=this;this.getLatestUGOs=function(m,n){f(function(h){if(n===0){var o=b("id");o!==undefined?d.getUGO(o,function(t){m([t].concat(h))}):m(h)}else m(h)},n)};var f=function(m,n){var h=new XMLHttpRequest;h.open("GET","/ugc/objects?category=favorite&offset="+n*10+"&limit=10&property=data&property=category",!0);h.onreadystatechange=function(){if(h.readyState==4)if(h.status==200)if(h.responseText!=="")m(JSON.parse(h.responseText));else{console.warn("UGC response empty");m({})}else console.log("Unable to load latest User Generated Content")};
h.send(null)};this.getUGO=function(m,n){var h=new XMLHttpRequest;h.open("GET","/ugc/objects/"+m+"?property=data&property=category",!0);h.onreadystatechange=function(){if(h.readyState==4)if(h.status==200){var o=JSON.parse(h.responseText);n(o)}else console.log("Could not fetch "+m)};h.send(null)};var g=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,
2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];this.submitUGO=function(m,n,h){function o(){h({success:!1})}var t=new XMLHttpRequest;t.open("POST","/ugc/objects");t.onreadystatechange=function(){if(t.readyState==4)if(t.status==200)try{var u=JSON.parse(t.responseText);if(u.success){var v=u.upload_url;delete u.upload_url;c(v,n,{filename:m.title,callback:function(){h(u)}})}else o()}catch(w){console.log(w);
o()}else o()};t.send(JSON.stringify(m))}};
window.GEE=function(b){b||(b={});if(document.createElement("canvas").getContext){var e=this,c={},d={ctx:undefined,domElement:undefined,width:undefined,height:undefined,desiredFrameTime:1E3/60,frameCount:0,key:undefined,keyCode:undefined,mouseX:0,mouseY:0,pmouseX:undefined,pmouseY:undefined,mousePressed:!1},f,g=function(){for(var n=f,h=0,o=0;n;){o+=n.offsetTop;h+=n.offsetLeft;n=n.offsetParent}offset={x:h,y:o}};b.context||(b.context="2d");b.width||(b.width=500);b.height||(b.height=500);f=d.domElement=
document.createElement("canvas");d.ctx=f.getContext(b.context);if(d.ctx==null)b.fallback&&b.fallback();else{if(b.fullscreen){var m=function(){g();d.width=f.width=window.innerWidth;d.height=f.height=window.innerHeight-4};window.addEventListener("resize",m,!1);m();b.container||(b.container=document.body);document.body.style.margin="0px";document.body.style.padding="0px"}else{g();e.__defineSetter__("width",function(n){d.width=f.width=n});e.__defineSetter__("height",function(n){d.height=f.height=n});
e.width=b.width;e.height=b.height}if(b.container){b.container.appendChild(f);g()}b=function(n){e.__defineGetter__(n,function(){return d[n]})};b("ctx");b("width");b("height");b("frameCount");b("key");b("keyCode");b("mouseX");b("mouseY");b("pmouseX");b("pmouseY");b("mousePressed");b("domElement");b=function(){};e.loop=!0;e.keyup=b;e.keydown=b;e.draw=b;e.mousedown=b;e.mouseup=b;e.mousemove=b;e.mousedrag=b;e.__defineGetter__("frameRate",function(){return NaN});e.__defineGetter__("frameTime",function(){});
e.__defineGetter__("keyPressed",function(){for(var n in c)if(c[n])return!0;return!1});e.__defineSetter__("frameTime",function(n){d.desiredFrameTime=n});e.__defineSetter__("frameRate",function(n){d.desiredFrameTime=k/n});f.addEventListener("mouseenter",function(){g()},!1);window.addEventListener("mousemove",function(n){var h=n.pageX-offset.x;n=n.pageY-offset.y;if(d.pmouseX==undefined){d.pmouseX=h;d.pmouseY=n}else{d.pmouseX=d.mouseX;d.pmouseY=d.mouseY}d.mouseX=h;d.mouseY=n},!1);window.addEventListener("mousemove",
function(){e.mousemove()},!1)}}else b.fallback&&b.fallback()};function loadSVG(b,e,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200)if(d.responseXML==null)c!=undefined&&c.call(this,b);else{var f=d.responseXML.getElementsByTagName("svg").item(0);f=new SVG(f);f.filename=b;e.call(this,f,b)}else c!=undefined&&c.call(this,b)};d.open("GET",b,!0);d.send(null)}
var SVG=function(b){this.filename="";this.children=[];var e=b.getAttribute("width"),c=b.getAttribute("height");this.width=e==null?0:parseFloat(e.replace("px",""));this.height=c==null?0:parseFloat(c.replace("px",""));for(var d in b.childNodes)b.childNodes.item(d).getAttribute&&this.children.push(b.childNodes.item(d).nodeName=="g"?new SVG(b.childNodes.item(d)):new Path(b.childNodes.item(d)));this.draw=function(f){for(var g in this.children)this.children[g].draw(f)};this.__defineGetter__("path",function(){})},
Path=function(b){this.element=b;this.commands=commands(b);this.lineWidth=parseLineWidth(b);this.strokeStyle=parseStrokeStyle(b);this.fillStyle=parseFillStyle(b);this.totalLength=0;this.lengths=[];this.tlengths=[];var e=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0};this.reset()};this.draw=function(c){this.style(c);c.beginPath();this.shape(c);this.end(c)};this.getAnchorPoints=function(){var c=[],d;for(d in this.commands)c.push(this.commands[d].getAnchorPoints(e));
return c};this.shape=function(c){for(var d in this.commands)this.commands[d].shape(e,c)};this.lerp=function(c,d,f,g,m){var n=1-m;return c*n*n*n+3*d*m*n*n+3*f*m*m*n+g*m*m*m};this.at=function(c,d){var f,g;this.lengths.length==0&&this.calcLengths(d);g=this.tlengths[0];for(f=0;c>g;){f++;g+=this.tlengths[f]}pt=g-this.tlengths[f];g=this.map(c,pt,g,0,1);for(var m=0;m<=f;m++)this.commands[m].shape(e,d);var n=e.x;m=e.y;this.commands[f+1].shape(e,d);f=this.lerp(n,e.x1,e.x2,e.x,g);g=this.lerp(m,e.y1,e.y2,e.y,
g);return{x:f,y:g}};this.map=function(c,d,f,g,m){return g+(m-g)*((c-d)/(f-d))};this.calcLengths=function(c){var d,f,g,m,n=0;this.commands[0].shape(e,c);for(var h=g=e.x,o=m=e.y,t=1;t<this.commands.length;t++){n=0;h=e.x;o=e.y;this.commands[t].shape(e,c);for(var u=0;u<=1;u+=0.0010){d=this.lerp(h,e.x1,e.x2,e.x,u);f=this.lerp(o,e.y1,e.y2,e.y,u);n+=this.dist(d,f,g,m);g=d;m=f}this.lengths.push(n);this.totalLength+=n}for(c=0;c<this.lengths.length;c++)this.tlengths.push(this.lengths[c]/this.totalLength)};
this.dist=function(c,d,f,g){return Math.sqrt((c-f)*(c-f)+(d-g)*(d-g))};this.style=function(c){if(this.lineWidth!=null)c.lineWidth=this.lineWidth;if(this.strokeStyle!=null){c.strokeStyle=this.strokeStyle;if(this.lineWidth==undefined)c.lineWidth=1}if(this.fillStyle!=null)c.fillStyle=this.fillStyle};this.end=function(c){this.fillStyle!=null&&c.fill();this.strokeStyle!=null&&c.stroke()}},parseLineWidth=function(b){b=b.attributes.getNamedItem("stroke-width");return b==null?null:parseFloat(b.nodeValue)},
parseStrokeStyle=function(b){b=b.attributes.getNamedItem("stroke");return b==null?null:b.nodeValue},parseFillStyle=function(b){var e=b.attributes.getNamedItem("fill");if(e==null)return b.attributes.getNamedItem("stroke")!=null?null:"#000000";else{if(e.nodeValue=="none")return null;return e.nodeValue}},Command=function(b,e){this.type=b;this.data=e;this.debug=!1;this.shape=function(c,d){if(this.type=="M"){c.x=this.data[0];c.y=this.data[1];d&&d.moveTo(c.x,c.y)}else if(this.type=="C"){c.x=this.data[4];
c.y=this.data[5];if(d)d.bezierCurveTo(c.x1=this.data[0],c.y1=this.data[1],c.x2=this.data[2],c.y2=this.data[3],c.x,c.y)}else if(this.type=="c"){if(d)d.bezierCurveTo(c.x1=c.x+this.data[0],c.y1=c.y+this.data[1],c.x2=c.x+this.data[2],c.y2=c.y+this.data[3],c.x+=this.data[4],c.y+=this.data[5])}else if(this.type=="S"){c.x=this.data[2];c.y=this.data[3];var f=c.x-c.x2,g=c.y-c.y2;if(d)d.bezierCurveTo(c.x1=c.x+f,c.y1=c.y+g,c.x2=this.data[0],c.y2=this.data[1],c.x,c.y)}else if(this.type=="s"){f=c.x-c.x2;g=c.y-
c.y2;if(d)d.bezierCurveTo(c.x1=c.x+f,c.y1=c.y+g,c.x2=c.x+this.data[0],c.y2=c.y+this.data[1],c.x+=this.data[2],c.y+=this.data[3])}else if(this.type=="L"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="l"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=this.data[0],c.y+=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="H"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="h"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=
this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="V"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x,c.y=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="v"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x,c.y+=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="z")d.closePath();else console&&console.log("unrecognized command "+this.type);if(d){d.strokeStyle="#000000";d.lineWidth=1;if(this.debug){d.strokeRect(c.x-1.5,c.y-1.5,3,3);d.beginPath();d.moveTo(c.px,c.py);d.lineTo(c.x1,c.y1);d.closePath();d.stroke()}}}},
commands=function(b){if(b.nodeName.toLowerCase()=="path")return commandsFromD(b.getAttribute("d"));if(b.nodeName.toLowerCase()=="polygon")return commandsFromPoints(b.getAttribute("points"));if(b.nodeName.toLowerCase()=="line")return commandsFromLine(b);if(b.nodeName.toLowerCase()=="rect")return commandsFromRect(b);return[]},commandsFromD=function(b){var e=[];b=b.match(/[a-zA-Z][0-9\.\-\,]+/g);for(var c=0;c<b.length;c++){var d=b[c].charAt(0),f=b[c].substr(1);f=f.replace(/\-/g,",-");f.charAt(0)==","&&
(f=f.substr(1));f=f.split(",");for(var g=0;g<f.length;g++)f[g]=parseFloat(f[g]);e.push(new Command(d,f))}return e},commandsFromLine=function(b){var e=[],c=parseFloat(b.getAttribute("x1")),d=parseFloat(b.getAttribute("x2")),f=parseFloat(b.getAttribute("y1"));b=parseFloat(b.getAttribute("y2"));e.push(new Command("M",[c,f]));e.push(new Command("L",[d,b]));return e},commandsFromPoints=function(b){var e=!0;if(b.indexOf(",")==-1)for(var c=0;c<b.length;c++)if(b.charAt(c)==" "){e&&(b=b.setCharAt(c,","));
e=!e}b=("M"+b).replace(/ /g,"L")+"z";return commandsFromD(b)};String.prototype.setCharAt=function(b,e){if(b>this.length-1)return str;return this.substr(0,b)+e+this.substr(b+1)};
var commandsFromRect=function(b){var e=[],c=parseFloat(b.getAttribute("x")),d=parseFloat(b.getAttribute("y")),f=parseFloat(b.getAttribute("width"));b=parseFloat(b.getAttribute("height"));e.push(new Command("M",[c,d]));e.push(new Command("h",[f]));e.push(new Command("v",[b]));e.push(new Command("h",[-f]));e.push(new Command("v",[-b]));return e},WonderWall=WonderWall||{};
WonderWall.Point=function(b,e,c){var d=e,f=c,g=0;this.x=e;this.y=c;this.r=0.07;this.threshold=0.1;this.easing=0.125;this.updating=!1;this.angle=0;this.update=function(m){if(this.updating){var n=b.mouseY-f-m.y;e=d+(b.mouseX-d-m.x)*this.r;c=f+n*this.r;this.easing=0.0625}else{e=d;c=f;g=0;this.easing=0.125}this.x=this.ease(this.x,e,this.easing);this.y=this.ease(this.y,c,this.easing);this.angle=this.ease(this.angle,g,this.easing)};this.setPosition=function(m,n){d=m;f=n};this.getOriginPosition=function(){return{x:d,
y:f}};this.getPoint=function(){return{x:this.x,y:this.y}}};WonderWall.Point.prototype.ease=function(b,e,c){var d=e-b;if(Math.abs(d)<c/100)b=e;else b+=d*c;return b};
WonderWall.Pentagon=function(b,e,c,d){var f=b.ctx;this.separate=!1;this.showFill=!0;this.showStroke=!0;this.insides=!1;this.x=e;this.y=c;if(this.x==undefined||this.x==null||this.x==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y==NaN)this.y=b.height/2;e=this.generatePoints(this.x,this.y,d,5);var g=[];for(c=0;c<e.length;c++){var m=e[c];g.push(new WonderWall.Point(b,m.x,m.y))}this.update=function(n){this.x=b.width/2;this.y=b.height/2;var h=this.generatePoints(this.x,this.y,d,5);if(!this.separate)this.separate=
!0;for(var o=0;o<g.length;o++){var t=g[o],u=h[o];t.update(n);var v=t.getOriginPosition();(u.x!=v.x||u.y!=v.y)&&t.setPosition(u.x,u.y)}return this};this.render=function(){if(this.insides&&this.showStroke)for(var n=0;n<g.length;n++){var h=g[n];this.separate||h.update();f.beginPath();f.moveTo(this.x,this.y);f.lineTo(h.x,h.y);f.stroke()}f.beginPath();for(n=0;n<g.length;n++){h=g[n];this.separate||h.update();n<1?f.moveTo(h.x,h.y):f.lineTo(h.x,h.y)}f.closePath();this.showFill&&f.fill();this.showStroke&&
f.stroke()};this.setUpdate=function(n){for(var h=0;h<g.length;h++)g[h].updating=n};this.setUpdatePoint=function(n,h){g[h].updating=n};this.setRadius=function(n){for(var h=0;h<g.length;h++)g[h].r=n};this.getPoints=function(){return g}};WonderWall.Pentagon.prototype.generatePoints=function(b,e,c,d){for(var f=[],g=0;g<d;g++)f.push({x:c*Math.sin(g/d*2*Math.PI)+b,y:-c*Math.cos(g/d*2*Math.PI)+e});return f};
function Heart(b,e,c,d){var f=this,g=b.ctx;this.x=c;this.y=d;if(this.x==undefined||this.x==null||this.x||this==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y||this==NaN)this.y=b.height/2;var m,n=!1;this.update=function(){return this};this.render=function(){if(n){g.save();g.translate(this.x,this.y);g.save();g.translate(-this.width/2,-this.height/2);m.draw(g);g.restore();g.restore()}};loadSVG(e,function(h,o){m=h;f.source=o;f.width=m.width;f.height=m.height;n=!0},function(){})}
var ClearEffect=function(b){SequencerItem.call(this);var e,c=b.renderer,d=b.renderTarget;this.init=function(){e=new THREE.Camera(60,1,1,1E4);e.position.z=2;new THREE.Scene};this.update=function(){c.clear();var f=c.getContext();f.bindFramebuffer(f.FRAMEBUFFER,d.__webglFramebuffer);f.viewport(0,0,d.width,d.height);f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,m=e.renderer,n=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(g)};this.update=function(h){f.opacity=1-h;m.render(d,c,n)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,m=e.renderer,n=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(g)};this.update=function(h){f.opacity=h;m.render(d,c,n)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.position.z=200;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var m=new THREE.MeshBasicMaterial({map:g,depthTest:!1});d=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),m);d.scale.y=-1;d.doubleSided=!0;c.addObject(d)};this.update=function(){f.render(c,e)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,e,c,d){SequencerItem.call(this);var f,g,m,n,h,o=b.renderer,t=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;g=new THREE.Scene;n=THREE.ShaderUtils.lib.film;h=THREE.UniformsUtils.clone(n.uniforms);h.tDiffuse.texture=t;m=new THREE.MeshShaderMaterial({uniforms:h,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader});h.grayscale.value=
0;if(e!==undefined)h.nIntensity.value=e;if(c!==undefined)h.sIntensity.value=c;if(d!==undefined)h.sCount.value=d;var u=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),m);u.position.z=-500;g.addObject(u)};this.update=function(u,v,w){h.time.value=w*0.01%1E4;o.render(g,f,t,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,m,n,h,o,t,u,v,w=b.renderer,x=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;d=new THREE.Scene;var y={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};h=new THREE.WebGLRenderTarget(256,512,y);o=new THREE.WebGLRenderTarget(512,256,y);y=THREE.ShaderUtils.lib.screen;
g=THREE.UniformsUtils.clone(y.uniforms);g.tDiffuse.texture=x;g.opacity.value=e!==undefined?e:1;f=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});y=THREE.ShaderUtils.lib.convolution;m=THREE.UniformsUtils.clone(y.uniforms);u=new THREE.Vector2(0.001953125,0);v=new THREE.Vector2(0,0.001953125);m.tDiffuse.texture=x;m.uImageIncrement.value=u;m.cKernel.value=THREE.ShaderUtils.buildKernel(4);n=new THREE.MeshShaderMaterial({uniforms:m,
vertexShader:"#define KERNEL_SIZE 25.0\n"+y.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+y.fragmentShader});t=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),n);t.position.z=-500;d.addObject(t)};this.update=function(){t.materials[0]=n;m.tDiffuse.texture=x;m.uImageIncrement.value=u;w.render(d,c,h,!0);m.tDiffuse.texture=h;m.uImageIncrement.value=v;w.render(d,c,o,!0);t.materials[0]=f;f.blending=THREE.AdditiveBlending;g.tDiffuse.texture=o;w.render(d,c,x,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var e,c,d,f,g=b.renderer,m=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={time:{type:"f",value:0},map:{type:"t",value:0,texture:m},sampleDistance:{type:"f",value:1/b.baseWidth}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(n,h,o){f.time.value=o*0.01;g.render(c,e,m,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.54},waveFactor:{type:"f",value:0.00127},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var m=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);m.position.z=-500;c.addObject(m)};this.update=function(){f.render(c,e)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.49},waveFactor:{type:"f",value:0.00161},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.55 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var m=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);m.position.z=-500;c.addObject(m)};this.update=function(){f.render(c,e)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.64},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.00756},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (1.86 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor /* - vec3( vingenettingDarkening )*/, vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var m=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);m.position.z=-500;c.addObject(m)};this.update=function(){f.render(c,e)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintEffectVideo=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.5},
colorOffset:{type:"f",value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0},waveFactor:{type:"f",value:0},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var m=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);m.position.z=-500;c.addObject(m)};this.update=function(){f.render(c,e)}};PaintEffectVideo.prototype=new SequencerItem;PaintEffectVideo.prototype.constructor=PaintEffectVideo;
var PaintDarkEffect=function(b){SequencerItem.call(this);var e,c,d,f,g=b.renderer,m=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={map:{type:"t",value:0,texture:m}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,e,m,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,e){SequencerItem.call(this);var c,d,f,g=b.renderer,m=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:e,transparent:!0});f=new THREE.Mesh(new THREE.Plane(3,3),this.material);d.addObject(f)};this.update=function(){this.material.opacity=0.25;g.render(d,c,m)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,e){SequencerItem.call(this);this.show=function(){document.body.style.cursor=e?'url("/files/mouse_ring.png"), auto':"none"};this.hide=function(){document.body.style.cursor="auto"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var PointerImageEffect=function(b,e){SequencerItem.call(this);var c=0,d=0,f=14,g=document.createElement("div");g.setAttribute("style","width: 8px; height: 56px;");g.innerHTML="<img src = '"+e+"' alt = 'mouse' />";var m=document.createElement("div");m.setAttribute("style","width: 8px; height: 14px;");m.style.position="absolute";m.style.zIndex=1E3;m.style.display="none";m.style.cursor="none";m.style.overflow="hidden";m.appendChild(g);document.body.appendChild(m);this.show=function(){document.body.style.cursor=
"none !important";m.style.display="block"};b.signals.mousemoved.add(function(){var n=b.mouse.x-c,h=b.mouse.y-d;if(n>0)if(h>0)f=-28;else h<0&&(f=-14);else if(n<0)if(h>0)f=-42;else h<0&&(f=0)});this.hide=function(){m.style.display="none";document.body.style.cursor="auto !important"};this.update=function(){g.style.marginTop=f+"px";m.style.left=b.mouse.x-4+"px";m.style.top=b.mouse.y-7+"px";c=b.mouse.x;d=b.mouse.y}};PointerImageEffect.prototype=new SequencerItem;
PointerImageEffect.prototype.constructor=PointerImageEffect;
var CityWorld=function(b){var e=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;e.portals=[];this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var c=new THREE.DirectionalLight(16777215);c.castShadow=!1;this.scene.addLight(c);var d=new THREE.DirectionalLight(16777215);d.castShadow=!1;this.scene.addLight(d);var f={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,s:0.494,v:0},directionalLight1:{h:0.565,
s:0.329,v:0.841,x:0.5176767580772196,y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,flarey:358,flyCamera:{position:{x:16.574202591686277,
y:462.26953453589,z:-10184.707948888321},target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(f.fogColor.h,f.fogColor.s,f.fogColor.v);this.scene.fog.density=f.fogDensity;c.color.setHSV(f.directionalLight1.h,f.directionalLight1.s,f.directionalLight1.v);d.color.setHSV(f.directionalLight2.h,f.directionalLight2.s,f.directionalLight2.v);c.position.set(f.directionalLight1.x,f.directionalLight1.y,f.directionalLight1.z);d.position.set(f.directionalLight2.x,
f.directionalLight2.y,f.directionalLight2.z);e.scene.addChild(initLensFlares(new THREE.Vector3(0,0,-5E3),20,358));c=new THREE.SceneLoader;c.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};c.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};c.load("files/models/city/City.js",function(m){var n=m.scene;hideColliders(n);makeSceneStatic(n);preInitScene(m,b.renderer);n.scale.set(0.1,0.1,0.1);n.updateMatrix();e.scene.addChild(n);n.collisions&&e.scene.collisions.merge(n.collisions);
TriggerUtils.setupCityTriggers(m);m.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;m.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;e.portals.push({object:m.objects.Portal,radius:150,currentDistance:9999999});e.portals.push({object:m.objects["Portal.001"],radius:150,currentDistance:9999999});e.portals.push({object:m.objects["Portal.002"],radius:150,currentDistance:9999999});e.portals.push({object:m.objects["Portal.003"],radius:150,currentDistance:9999999});applyCityShader(m,
["Backdrop_City"]);e.scene.update(undefined,!0)});var g;this.update=function(m,n,h){g=n.matrixWorld.getPosition();TriggerUtils.effectorRadius=80;TriggerUtils.update("city");if(h)for(m=0;m<e.portals.length;m++){e.portals[m].currentDistance=e.portals[m].object.matrixWorld.getPosition().distanceTo(g);e.portals[m].currentDistance<e.portals[m].radius&&b.signals.startexploration.dispatch("dunes")}}},PrairieWorld=function(b,e,c){var d=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;
this.portals=[];this.cows={};this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.196,0.93,-0.3);this.directionalLight1.color.setHSV(0,0,0.876);this.scene.addLight(this.directionalLight1);this.directionalLight2=new THREE.DirectionalLight(16772829);
this.directionalLight2.position.set(0.19,-0.31,-0.93);this.directionalLight2.color.setHSV(0.347,0.51,0.135);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.0588E-5,fogColor:{h:0.5235,s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,y:0.8775825618903728,
z:-0.1553545034191468,phi:-1.588470588235294,theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,this.settings.directionalLight1.s,
this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,this.settings.directionalLight2.y,this.settings.directionalLight2.z);ROME.TrailShader.init();e=initLensFlares(new THREE.Vector3(0,
0,-3E3),14,311);d.scene.addChild(e);var f=THREE.ImageUtils.loadTexture("/files/textures/trailMarkTexture.jpg");e=new THREE.SceneLoader;e.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};e.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};e.load("/files/models/prairie/Prairie.js",function(g){var m=g.scene;hideColliders(m);makeSceneStatic(m);ROME.TrailShaderUtils.setMaterials([g.objects.Ground],2500,f,b.renderer);TriggerUtils.setupPrairieTriggers(g);d.scene.addChild(m);g.objects.Backdrop.materials[0].map.wrapS=
THREE.RepeatWrapping;g.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;d.portals.push({object:g.objects.Portal,radius:120,currentDistance:9999999});d.portals.push({object:g.objects["Portal.001"],radius:120,currentDistance:9999999});d.portals[0].object.visible=!1;d.portals[1].object.visible=!1;preInitScene(g,b.renderer);m.collisions&&d.scene.collisions.merge(m.collisions);(new THREE.JSONLoader).load({model:"/files/models/soup/cow.js",callback:function(n){for(var h in g.objects){var o=
g.objects[h];if(h.toLowerCase().indexOf("cow")>=0){o.visible=!1;var t=ROME.Animal(n,!0),u=t.mesh;u.rotation.set(-1.57,0,3.14);u.matrixAutoUpdate=!1;u.update();u.updateMatrix();o.addChild(u);t.play(t.availableAnimals[0],t.availableAnimals[0]);if(d.cows[h]===undefined)d.cows[h]={alive:t,dead:null,position:new THREE.Vector3};else d.cows[h].alive=t;d.cows[h].position.set(o.matrixWorld.n14,o.matrixWorld.n24,o.matrixWorld.n34)}else if(h.toLowerCase().indexOf("carcass")>=0){o.visible=!1;t=h.replace("Carcass",
"Cow");if(d.cows[t]===undefined)d.cows[t]={alive:null,dead:o,position:new THREE.Vector3};else d.cows[t].dead=o}}}});d.scene.update(undefined,!0);c()});this.update=function(g,m,n){ROME.TrailShaderUtils.updateLava(g*1.0E-4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=40;TriggerUtils.update("prairie");if(n){g=m.matrixWorld.getPosition();for(m=0;m<d.portals.length;m++){d.portals[m].currentDistance=d.portals[m].object.matrixWorld.getPosition().distanceTo(g);
d.portals[m].currentDistance<d.portals[m].radius&&b.signals.startexploration.dispatch("dunes")}}for(var h in d.cows){g=d.cows[h];if(g.position.distanceTo(b.prairieSoupHead)<15){g.alive.mesh.visible=!1;g.dead.visible=!0}}}},DunesWorld=function(b){function e($){O=!1;for(var ha=0,qa=$.length;ha<qa;ha++){var sa=new UgcObject(JSON.parse($[ha].data)),va=$[ha].category;if(!sa.isEmpty()){sa=sa.getMesh();sa.category=va;sa.visible=!1;N.push(sa);p=!0}}}function c($,ha){var qa=$.scene;applyDunesShader($);n(qa);
m(qa,!0);E[ha]=qa.collisions.colliders[0].mesh;E[ha].rotation.x=-90*Math.PI/180;E[ha].scale.set(t,t,t);o.scene.addChild(E[ha]);o.scene.collisions.merge(qa.collisions);for(var sa=0;sa<F[ha];sa++)z[ha].push(d(qa));o.scene.update(undefined,!0)}function d($){for(var ha=0;ha<$.children.length;ha++)if(!$.children[ha].__isCollider){$=$.children[ha];$=new THREE.Mesh($.geometry,$.materials);$.rotation.x=-90*Math.PI/180;$.scale.set(t,t,t);o.scene.addChild($);return $}}function f($){var ha=$.scene;ha.scale.set(t,
t,t);ha.matrixAutoUpdate=!0;n(ha);m(ha,!0);preInitScene($,b.renderer);o.scene.addChild(ha);ha.collisions&&o.scene.collisions.merge(ha.collisions);for(var qa in $.objects)if(qa.toLowerCase().indexOf("cloud")>=0){applyCloudsShader($.objects[qa],CloudsShader);$.objects[qa].position.z+=4E3;$.objects[qa].updateMatrix();$.objects[qa].matrixAutoUpdate=!1}return ha}function g($,ha){return Math.round(Math.sin($*0.0010)*Math.cos(ha*0.0050)*4)*(Math.PI/2)}function m($,ha){THREE.SceneUtils.traverseHierarchy($,
function(qa){if(!qa.__isCollider)qa.visible=ha})}function n($){THREE.SceneUtils.traverseHierarchy($,function(ha){for(var qa=$.collisions.colliders,sa=0;sa<qa.length;sa++)if(qa[sa].mesh==ha)ha.__isCollider=!0})}function h($){$.state=0;$.radius*=t;b.influenceSpheres.push($);$.type===0&&o.portals.push($)}var o=this,t=0.2,u=29990*t;o.scale=t;o.portals=[];b.influenceSpheres=[];b.cameraSlowDown=!1;o.scene=new THREE.Scene;o.scene.collisions=new THREE.CollisionSystem;o.scene.fog=new THREE.FogExp2(16777215,
2.75E-6);o.scene.fog.color.setHSV(0.576,0.382,0.9);var v=new THREE.AmbientLight(2232576),w=new THREE.DirectionalLight(16772829),x=new THREE.DirectionalLight(16772829);o.ambient=v;o.directionalLight1=w;o.directionalLight2=x;o.skyWhite=1;v.color.setHSV(0,0,0.1);w.position.set(0.81,0.31,-0.5);w.color.setHSV(0.088,0,1);x.position.set(0.094,0.98,0.158);x.color.setHSV(0,0,0.86);o.scene.addLight(v);o.scene.addLight(w);o.scene.addLight(x);o.lensFlare=null;o.lensFlareRotate=null;v=initLensFlares(new THREE.Vector3(-5500,
-2500,-1E4),0,0);o.scene.addChild(v);o.lensFlareRotate=v;o.lensFlare=v.children[0];DunesShader.init();var y=new THREE.Object3D,C=new THREE.Object3D,B=WaterfallShader.createWaterfall(0),H=WaterfallShader.createWaterfall(1);o.scene.addChild(B);o.scene.addChild(H);var z=[[],[],[],[],[],[],[]],E=[],F=[0,0,0,0,1,1,1],D=[],T;for(v=0;v<5;v++){x=[];D.push(x);for(w=0;w<5;w++)if(w===0&&v===0)x.push(4);else if(w===3&&v===4)x.push(5);else if(w===0&&v===3)x.push(6);else if(w===4&&v===4){x.push(0);F[0]++}else if(w===
0&&v===4){x.push(0);F[0]++}else if(w===1&&v===4){x.push(2);F[2]++}else{T=Math.floor(Math.random()*3.99999);x.push(T);F[T]++}}var W=new THREE.Mesh(new THREE.Cube(5E4,5E4,5E4),undefined);W.flipSided=!0;applyDunesShader({objects:{skydome:W}});o.scene.addChild(W);v=new THREE.SceneLoader;v.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};v.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};v.load("/files/models/dunes/D_tile_walk.js",function($){applyDunesShader($);z[4][0]=f($);
o.scene.update(undefined,!0)});v.load("/files/models/dunes/D_tile_prairie.js",function($){applyDunesShader($,{D_tile_Prairie_Collis:!0,D_tile_Prairie_Island:!0},{"D_tile_Prairie_Is.000":-0.05},{D_tile_Prairie_Water:0.65});z[5][0]=f($);y.position.set(-5165.693848,1024.796875,18247.871094);$.scene.addChild(y);h({name:"prairiePortal",object:$.empties.Prairie_Portal,radius:2E3,type:0,destination:"prairie"});h({name:"prairieSlowDown",object:$.empties.Prairie_Center,radius:1E4,type:1});o.scene.update(undefined,
!0)});v.load("/files/models/dunes/D_tile_city.js",function($){applyDunesShader($,{D_tile_City_Collision:!0,D_tile_City_Island_Co:!0},{D_tile_City_Island:-1},{D_tile_City_Water:0.65});z[6][0]=f($);C.position.set(750.267456,709.979614,29121.154297);$.scene.addChild(C);h({name:"cityPortal",object:$.empties.City_Portal,radius:3500,type:0,destination:"city"});h({name:"citySlowDown",object:$.empties.City_Center,radius:12E3,type:1});o.scene.update(undefined,!0)});v.load("/files/models/dunes/D_tile_1.js",
function($){c($,0)});v.load("/files/models/dunes/D_tile_2.js",function($){c($,1)});v.load("/files/models/dunes/D_tile_3.js",function($){c($,2)});v.load("/files/models/dunes/D_tile_4.js",function($){c($,3)});v=new THREE.JSONLoader;v.load({model:"/files/models/dunes/D_tile_1_clouds.js",callback:function($){for(var ha=new THREE.MeshFaceMaterial,qa,sa,va=0;va<100;va++){var ua=new THREE.Mesh($,ha);qa=15E4*(Math.random()-0.5);sa=15E4*(Math.random()-0.5);ua.scale.set(t,t,t);ua.position.set(qa,3E3,sa);ua.updateMatrix();
ua.matrixAutoUpdate=!1;applyCloudsShader(ua,CloudsShader);o.scene.addChild(ua)}}});var U=new UgcHandler,Y=0,N=[],p=!1,O=!1,G={},L={},Q=new THREE.SphereCollider(new THREE.Vector3(0,-5E3,0),1),M=[{x:-1,z:-1},{x:-1,z:0},{x:-1,z:1},{x:0,z:1},{x:1,z:1},{x:1,z:0},{x:1,z:-1},{x:0,z:-1}],da=[new THREE.Vector3(u*0.15,-1E3,-u*1.25),new THREE.Vector3(u,-1E3,-u)],ka=[new THREE.Vector3(u*0.15,2500,-u*1.25),new THREE.Vector3(u,3E3,-u)];o.scene.collisions.colliders.push(Q);o.update=function($,ha,qa){UgcShader.update(o.skyWhite);
var sa=99999999999,va,ua=undefined,ta=ha.matrixWorld.getPosition(),Da=ta.x,Ba=ta.z,Fa,ya=N.length,V,ia;for(Fa=0;Fa<ya;Fa++){V=N[Fa];if(V.visible===!0&&V.placedOnGrid&&V.category=="flythrougheverything"){ia=V.position;va=ia.x-Da;ia=ia.z-Ba;va=Math.min(sa,va*va+ia*ia);if(va<sa){sa=va;ua=V}V.category==="ground"&&(V.position.y+=(V.wantedY-V.position.y)*0.05)}}if(ua!==undefined){Q.center.copy(ua.matrixWorld.getPosition());Q.radius=ua.boundRadius;Q.radiusSq=Q.radius*Q.radius}sa=Math.floor(ta.x/u);ta=Math.floor(ta.z/
u);if(!L[sa+" "+ta]){L[sa+" "+ta]=!0;if(!O){O=!0;U.getLatestUGOs(e,Y);Y++}}if(p){p=!1;var fa,ca;ua=M.length;Fa=ha.matrixWorld.getColumnZ().negate();Da=3+Math.ceil(3*Math.atan2(Fa.x,Fa.z)/Math.PI);Da<0&&(Da=0);for(Fa=0;Fa<ya;Fa++){V=N[Fa];if(!V.placedOnGrid){Ba=da;V.category=="sky"&&(Ba=ka);if(Ba.length){V.position.copy(Ba.shift());V.position.x+=Math.random()*200-100;V.position.z+=Math.random()*200-100;V.rotation.set(Math.random()*0.03,Math.random()*Math.PI,Math.random()*0.03);V.visible=!0;V.placedOnGrid=
!0;V.wantedY=-5;o.scene.addChild(V);fa=Math.floor(V.position.x/u);ca=Math.floor(V.position.z/u);G[fa+" "+ca+" "+V.category]=!0}else{for(ia=0;ia<ua;ia++){fa=Ba=sa+M[Da].x;ca=va=ta+M[Da].z;Ba%=5;for(va%=5;Ba<0;)Ba+=5;for(;va<0;)va+=5;if(D[va][Ba]<4&&!G[fa+" "+ca+" "+V.category]){G[fa+" "+ca+" "+V.category]=!0;break}Da++;Da%=M.length}if(ia!==ua){V.position.set(fa*u,0,ca*u);if(V.category==="sky"){V.position.x+=Math.random()*200-100;V.position.z+=Math.random()*200-100;V.position.y=2500+Math.random()*1E3-
500}V.rotation.set(Math.random()*0.03,Math.random()*Math.PI,Math.random()*0.03);V.wantedY=-5;V.visible=!0;V.placedOnGrid=!0;V.updateMatrix();o.scene.addChild(V)}}}}}o.checkInfluenceSpheres(ha,qa);o.updateTiles(ha);updateDunesShader($,o.skyWhite);B.position.copy(y.matrixWorld.getPosition());H.position.copy(C.matrixWorld.getPosition());WaterfallShader.update($,o.skyWhite);W.position.copy(ha.matrixWorld.getPosition());W.updateMatrix();o.lensFlareRotate.position.copy(ha.matrixWorld.getPosition());o.lensFlareRotate.updateMatrix()};
o.checkInfluenceSpheres=function($,ha){var qa,sa,va,ua,ta=$.matrixWorld.getPosition();qa=0;for(sa=b.influenceSpheres.length;qa<sa;qa++){ua=b.influenceSpheres[qa];va=ua.object.matrixWorld.getPosition().distanceTo(ta);ua.currentDistance=va;if(va<ua.radius)if(ua.type===0&&ua.state===0){ua.state=1;ha&&b.signals.startexploration.dispatch(ua.destination)}else{if(ua.type==1)b.cameraSlowDown=!0}else{ua.state=0;b.cameraSlowDown=!1}}};o.updateTiles=function($){var ha=Math.floor(2.5),qa=$.matrixWorld.getPosition(),
sa=qa.x,va=qa.z;qa.addSelf($.matrixWorld.getColumnZ().multiplyScalar(-u*1.5));qa.x=Math.floor(qa.x/u);qa.z=Math.floor(qa.z/u);$=qa.x%5;for(var ua=qa.z%5;$<0;)$+=5;for(;ua<0;)ua+=5;var ta,Da,Ba,Fa,ya,V,ia,fa=[0,0,0,0,0,0,0],ca=[-1,-1,-1,-1];for(Da=-ha;Da<ha+1;Da++)for(ta=-ha;ta<ha+1;ta++){ya=(qa.x+ta)*u;V=(qa.z+Da)*u;Ba=($+ta)%5;for(Fa=(ua+Da)%5;Ba<0;)Ba+=5;for(;Fa<0;)Fa+=5;ia=D[Fa][Ba];if(Ba=z[ia][fa[ia]++]){Ba.position.x=ya;Ba.position.z=V;Ba.rotation.z=g(ya,V)}if(ia<4){Ba=ya-sa;Fa=V-va;Ba=Ba*Ba+
Fa*Fa;if(ca[ia]===-1||Ba<ca[ia]){ca[ia]=Ba;if(Ba=E[ia]){Ba.position.x=ya;Ba.position.z=V;Ba.rotation.z=g(ya,V)}}}}}},CityShaderEffectors=[new THREE.Vector4(0,0,-1E3,50),new THREE.Vector4(-100,0,-1500,150),new THREE.Vector4(100,0,-2E3,150),new THREE.Vector4(0,0,-2500,100)],CityShader={vertexShader:"varying vec3 vColor;\nvoid main() {\nvColor = color;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec3 vColor;\nvoid main() {\nvec3 surface = vec3( 0.15 * 2.0, 0.18 * 2.0, 0.2 * 2.0 );\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 0.0001;\ngl_FragColor = vec4( surface * vColor * 2.0, 1.0 );\ngl_FragColor = vec4( mix( gl_FragColor.rgb, vec3( 0.64, 0.88, 1 ), depth ), 1.0 );\n}"};
function applyCityShader(b,e){var c,d,f,g,m,n={};for(c=0;c<e.length;c++)n[e[c]]=!0;m=new THREE.MeshShaderMaterial({vertexShader:CityShader.vertexShader,fragmentShader:CityShader.fragmentShader,shading:THREE.FlatShading,vertexColors:THREE.VertexColors});for(d in b.objects){g=b.objects[d];if(!n[d]&&g.geometry&&g.geometry.morphTargets.length===0){f=g.geometry;for(c=0;c<f.materials.length;c++)g.materials[0]=m}}return m}
var DunesShaderEffectors={position:[new THREE.Vector3(0,-2E3,-1E3),new THREE.Vector3(-100,-2E3,-2500)],radius:[250,250],darkness:[0.4,0.4],positionFlat:[],materials:[]},DunesShader={init:function(){DunesShader.uniforms.grassImage.texture=THREE.ImageUtils.loadTexture("/files/textures/CityShader_Grass.jpg");DunesShader.uniforms.surfaceImage.texture=THREE.ImageUtils.loadTexture("/files/textures/CityShader_Clouds.jpg")},uniforms:{grassImage:{type:"t",value:0,texture:undefined},surfaceImage:{type:"t",
value:1,texture:undefined},time:{type:"f",value:0},target:{type:"fv",value:[]},radius:{type:"fv1",value:[]},darkness:{type:"fv1",value:[]},skyWhite:{type:"f",value:1},dunesOpacity:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},
pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );","const \t int  \tNUMTARGETS = "+DunesShaderEffectors.position.length+";","uniform vec3 \ttarget[ NUMTARGETS ];\nuniform float \tradius[ NUMTARGETS ];\nuniform float \tdarkness[ NUMTARGETS ];\nuniform float  skyWhite;\nuniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform float time;\nuniform float dunesOpacity;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vNormalsquare;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nfloat distance = -9999999.0;\nfloat fragmentDarkness = 1.0;\nfloat tempDistance;\nfor( int i = 0; i < NUMTARGETS; i++ ) {\ntempDistance = length( vWorldPosition - target[ i ].xyz ) * -1.0 / radius[ i ];\nif( tempDistance > distance ) {\ndistance = tempDistance;\nfragmentDarkness = 1.0 - darkness[ i ];\n}\n}\nvec3 worldPosition = vWorldPosition * 0.0005;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.x + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.y + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.z;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4( vColor, 1.0 );\nif(distance > 0.0)\nsurface = vec4( grass.rgb * fragmentDarkness, grass.w );\ngl_FragColor = mix( surface * texture2D( surfaceImage, worldPosition.zx * vec2( 0.4 ) + vec2(time)), surface, vec4( cloudMix, 0.1 ));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\ngl_FragColor.a = dunesOpacity;\n}"].join("\n")};
function applyDunesShader(b,e,c,d){function f(u,v){n=new THREE.MeshShaderMaterial(h);n.uniforms=THREE.UniformsUtils.clone(h.uniforms);n.uniforms.target.value=DunesShaderEffectors.positionFlat;n.uniforms.radius.value=DunesShaderEffectors.radius;n.uniforms.darkness.value=DunesShaderEffectors.darkness;n.uniforms.grassImage.texture=h.uniforms.grassImage.texture;n.uniforms.surfaceImage.texture=h.uniforms.surfaceImage.texture;n.uniforms.invertLightY.value=u;n.uniforms.dunesOpacity.value=v;m.materials=[n];
DunesShaderEffectors.materials.push(n)}var g,m,n;c=c!==undefined?c:{};e=e!==undefined?e:{};d=d!==undefined?d:{};var h={uniforms:DunesShader.uniforms,vertexShader:DunesShader.vertexShader,fragmentShader:DunesShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};h.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;h.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;h.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;h.uniforms.surfaceImage.texture.wrapT=
THREE.RepeatWrapping;var o=1,t=1;for(g in b.objects)if(!e[g]){m=b.objects[g];o=c[g]?c[g]:1;t=d[g]?d[g]:1;m.geometry&&m.geometry.morphTargets.length===0&&f(o,t)}}
function updateDunesShader(b,e){e=e!==undefined?e:1;var c,d,f=DunesShaderEffectors.position.length,g,m=DunesShaderEffectors.positionFlat;for(d=g=0;d<f;d++){c=DunesShaderEffectors.position[d];m[g++]=c.x;m[g++]=c.y;m[g++]=c.z}c=DunesShader.uniforms.time.value+=b*1.0E-5;d=0;for(f=DunesShaderEffectors.materials.length;d<f;d++){DunesShaderEffectors.materials[d].uniforms.time.value=c;DunesShaderEffectors.materials[d].uniforms.skyWhite.value=e}}
WaterfallShader={geometry:undefined,materials:[],createWaterfall:function(b){if(WaterfallShader.geometry===undefined){var e=new THREE.Geometry,c,d=e.faces,f=e.vertices,g,m=WaterfallShader.attributes.time.value,n=WaterfallShader.attributes.direction.value,h=WaterfallShader.attributes.darkness.value,o=WaterfallShader.attributes.size.value;for(c=0;c<1500;c++){d.push(new THREE.Face3(c*4+0,c*4+1,c*4+2));d.push(new THREE.Face3(c*4+0,c*4+2,c*4+3));d.push(new THREE.Face3(c*4+0,c*4+3,c*4+1));d.push(new THREE.Face3(c*
4+3,c*4+2,c*4+1));n.push(new THREE.Vector3(0+Math.random()*0.2,0.7+Math.random()*0.2,1.3+Math.random()*0.2));n.push(new THREE.Vector3(-1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));n.push(new THREE.Vector3(1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));n.push(new THREE.Vector3(0+Math.random()*0.2,-1.3+Math.random()*0.2,0+Math.random()*0.2));g=new THREE.Vertex;g.position.x=Math.random()*240-120;g.position.y=-5800;g.position.z=Math.random()*240-120;f.push(g);
f.push(g);f.push(g);f.push(g);g=Math.random();m.push(g);m.push(g);m.push(g);m.push(g);g=Math.random()*0.3+0.7;h.push(g*(Math.random()*0.4+0.6));h.push(g*(Math.random()*0.4+0.6));h.push(g*(Math.random()*0.4+0.6));h.push(g*(Math.random()*0.4+0.6));g=Math.random()*25+5;o.push(g);o.push(g);o.push(g);o.push(g)}e.computeFaceNormals();e.computeBoundingSphere();e.boundingSphere.radius=5E3;WaterfallShader.geometry=e}b=new THREE.MeshShaderMaterial({uniforms:WaterfallShader.uniforms(b),attributes:WaterfallShader.attributes,
vertexShader:WaterfallShader.vertexShader,fragmentShader:WaterfallShader.fragmentShader,lights:!1,fog:!1});e=new THREE.Mesh(WaterfallShader.geometry,b);e.doubleSided=!0;WaterfallShader.materials.push(b);return e},update:function(b,e){for(var c=0;c<WaterfallShader.materials.length;c++){WaterfallShader.materials[c].uniforms.globalTime.value+=b*1.2E-4;WaterfallShader.materials[c].uniforms.skyWhite.value=e!==undefined?e:1}},uniforms:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):0;return{globalTime:{type:"f",
value:0},skyWhite:{type:"f",value:1},shrinkTop:{type:"f",value:b}}},attributes:{time:{type:"f",boundTo:"vertices",value:[]},darkness:{type:"f",boundTo:"faces",value:[]},direction:{type:"v3",boundTo:"vertices",value:[]},size:{type:"f",boundTo:"vertices",value:[]}},vertexShader:"const float \tPI \t\t\t= 3.14159265;\nconst vec3 \tBASECOLOR \t= vec3(  16.0 / 255.0,  93.0 / 255.0, 118.0 / 255.0 );\nconst vec3     HIGHLIGHT   = vec3( 235.0 / 255.0, 237.0 / 255.0, 245.0 / 255.0 );\nconst vec3 \tENDCOLOR \t= vec3( 168.0 / 255.0, 231.0 / 255.0, 239.0 / 255.0 );\nuniform \tfloat\tglobalTime;\nuniform    float   shrinkTop;\nattribute \tfloat\ttime;\nattribute \tfloat\tdarkness;\nattribute \tfloat\tsize;\nattribute \tvec3\tdirection;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat localTime = time + globalTime;\nfloat modTime = mod( localTime, 1.0 );\nfloat accTime = modTime * modTime;\nvec2 pulse = vec2( sin( localTime * 2.0 ) * 20.0, cos( localTime * 2.0 ) * 20.0 );\nvColor = mix( BASECOLOR * darkness, ENDCOLOR * darkness, modTime );\nvColor = mix( vColor, HIGHLIGHT, 1.0 - smoothstep( 0.0, 0.25, abs( modTime - ( sin( globalTime ) * 0.2 * darkness + 0.5 ))));\nvec3 animated = vec3( position.x + pulse.x, position.y * accTime, position.z + pulse.y );\nanimated.x -= ( 1.0 - accTime ) * shrinkTop * animated.x;\nanimated.z -= ( 1.0 - accTime ) * shrinkTop * animated.z;\nvec3 rotatedDirection;\nfloat rotation = modTime * size;\nrotatedDirection.x = ( cos( rotation ) * direction.x - sin( rotation ) * direction.y );\nrotatedDirection.y = ( sin( rotation ) * direction.x + cos( rotation ) * direction.y );\nrotatedDirection.z = direction.z;\nanimated += rotatedDirection * size * ( sin( localTime * 150.0 ) * 0.1 + 1.1 );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( animated, 1.0 );\nvWorldVector = ( vec3( objectMatrix * vec4( animated, 1.0 )).xyz - cameraPosition) * vec3(0.01, 0.02, 0.01);\n}",
fragmentShader:"const   \tvec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t \tvec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform \tfloat \tskyWhite;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = vec4( vColor, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
var CloudsShader={uniforms:{fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvWorldVector = ( vWorldPosition - cameraPosition ) * vec3( 0.01, 0.02, 0.01 );\n}",
fragmentShader:"const vec3 skyBlue = vec3( -0.37, -0.05, 0.15 );\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\ngl_FragColor = vec4( vec3( vLightWeighting ) * vec3( 0.9, 0.5, 0.3 ) + vec3( 0.7, 0.6, 0.6 ), vLightWeighting * 0.95 + 0.05 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( 1.0 ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.a ), fogFactor );\n}"};
function applyCloudsShader(b,e){var c={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},d=new THREE.MeshShaderMaterial(c);d.uniforms=THREE.UniformsUtils.clone(c.uniforms);b.materials[0]=d}
var UgcShader={update:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):1;for(var e=0;e<UgcShader.savedUniforms.length;e++)UgcShader.savedUniforms[e].skyWhite.value=b},savedUniforms:[],uniforms:function(){var b={skyWhite:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",
value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}};UgcShader.savedUniforms.push(b);return b},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform float  skyWhite;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vNormalsquare;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\ngl_FragColor = vec4(vColor,1.);\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nfloat f = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nvec3 sky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
WaterfallShader={geometry:undefined,materials:[],createWaterfall:function(b){if(WaterfallShader.geometry===undefined){var e=new THREE.Geometry,c,d=e.faces,f=e.vertices,g,m=WaterfallShader.attributes.time.value,n=WaterfallShader.attributes.direction.value,h=WaterfallShader.attributes.darkness.value,o=WaterfallShader.attributes.size.value;for(c=0;c<1500;c++){d.push(new THREE.Face3(c*4+0,c*4+1,c*4+2));d.push(new THREE.Face3(c*4+0,c*4+2,c*4+3));d.push(new THREE.Face3(c*4+0,c*4+3,c*4+1));d.push(new THREE.Face3(c*
4+3,c*4+2,c*4+1));n.push(new THREE.Vector3(0+Math.random()*0.2,0.7+Math.random()*0.2,1.3+Math.random()*0.2));n.push(new THREE.Vector3(-1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));n.push(new THREE.Vector3(1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));n.push(new THREE.Vector3(0+Math.random()*0.2,-1.3+Math.random()*0.2,0+Math.random()*0.2));g=new THREE.Vertex;g.position.x=Math.random()*240-120;g.position.y=-5800;g.position.z=Math.random()*240-120;f.push(g);
f.push(g);f.push(g);f.push(g);g=Math.random();m.push(g);m.push(g);m.push(g);m.push(g);g=Math.random()*0.3+0.7;h.push(g*(Math.random()*0.4+0.6));h.push(g*(Math.random()*0.4+0.6));h.push(g*(Math.random()*0.4+0.6));h.push(g*(Math.random()*0.4+0.6));g=Math.random()*25+5;o.push(g);o.push(g);o.push(g);o.push(g)}e.computeFaceNormals();e.computeBoundingSphere();e.boundingSphere.radius=5E3;WaterfallShader.geometry=e}b=new THREE.MeshShaderMaterial({uniforms:WaterfallShader.uniforms(b),attributes:WaterfallShader.attributes,
vertexShader:WaterfallShader.vertexShader,fragmentShader:WaterfallShader.fragmentShader,lights:!1,fog:!1});e=new THREE.Mesh(WaterfallShader.geometry,b);e.doubleSided=!0;WaterfallShader.materials.push(b);return e},update:function(b,e){for(var c=0;c<WaterfallShader.materials.length;c++){WaterfallShader.materials[c].uniforms.globalTime.value+=b*1.2E-4;WaterfallShader.materials[c].uniforms.skyWhite.value=e!==undefined?e:1}},uniforms:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):0;return{globalTime:{type:"f",
value:0},skyWhite:{type:"f",value:1},shrinkTop:{type:"f",value:b}}},attributes:{time:{type:"f",boundTo:"vertices",value:[]},darkness:{type:"f",boundTo:"faces",value:[]},direction:{type:"v3",boundTo:"vertices",value:[]},size:{type:"f",boundTo:"vertices",value:[]}},vertexShader:"const float \tPI \t\t\t= 3.14159265;\nconst vec3 \tBASECOLOR \t= vec3(  16.0 / 255.0,  93.0 / 255.0, 118.0 / 255.0 );\nconst vec3     HIGHLIGHT   = vec3( 235.0 / 255.0, 237.0 / 255.0, 245.0 / 255.0 );\nconst vec3 \tENDCOLOR \t= vec3( 168.0 / 255.0, 231.0 / 255.0, 239.0 / 255.0 );\nuniform \tfloat\tglobalTime;\nuniform    float   shrinkTop;\nattribute \tfloat\ttime;\nattribute \tfloat\tdarkness;\nattribute \tfloat\tsize;\nattribute \tvec3\tdirection;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat localTime = time + globalTime;\nfloat modTime = mod( localTime, 1.0 );\nfloat accTime = modTime * modTime;\nvec2 pulse = vec2( sin( localTime * 2.0 ) * 20.0, cos( localTime * 2.0 ) * 20.0 );\nvColor = mix( BASECOLOR * darkness, ENDCOLOR * darkness, modTime );\nvColor = mix( vColor, HIGHLIGHT, 1.0 - smoothstep( 0.0, 0.25, abs( modTime - ( sin( globalTime ) * 0.2 * darkness + 0.5 ))));\nvec3 animated = vec3( position.x + pulse.x, position.y * accTime, position.z + pulse.y );\nanimated.x -= ( 1.0 - accTime ) * shrinkTop * animated.x;\nanimated.z -= ( 1.0 - accTime ) * shrinkTop * animated.z;\nvec3 rotatedDirection;\nfloat rotation = modTime * size;\nrotatedDirection.x = ( cos( rotation ) * direction.x - sin( rotation ) * direction.y );\nrotatedDirection.y = ( sin( rotation ) * direction.x + cos( rotation ) * direction.y );\nrotatedDirection.z = direction.z;\nanimated += rotatedDirection * size * ( sin( localTime * 150.0 ) * 0.1 + 1.1 );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( animated, 1.0 );\nvWorldVector = ( vec3( objectMatrix * vec4( animated, 1.0 )).xyz - cameraPosition) * vec3(0.01, 0.02, 0.01);\n}",
fragmentShader:"const   \tvec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t \tvec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform \tfloat \tskyWhite;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = vec4( vColor, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
DunesCamera=function(b){var e=10,c=new THREE.Ray,d,f,g=new THREE.Vector3,m={forward:1,left:1,right:1,up:1,down:1},n=0,h,o;h=b.worlds.dunes;o=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,20,1E5);o.target.position.set(0,0,-100);d=new THREE.Object3D;f=new THREE.Object3D;f.position.set(0,0,-100);h.scene.addChild(o);h.scene.addChild(o.target);h.scene.addChild(d);h.scene.addChild(f);var t={};t.camera=o;t.resetCamera=function(){window.wantedCamera=d;window.camera=o;e=10;d.position.set(0,350,600);
f.position.set(0,150,-300);f.position.subSelf(d.position).normalize().multiplyScalar(200).addSelf(d.position);o.position.copy(d.position);o.target.position.copy(f.position)};t.updateCamera=function(u,v){v=v>30||v<5?1:v/30;var w=b.mouse.x/b.screenWidth-0.5,x=b.mouse.y/b.screenHeight-0.5;if(u<0.03){c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.set(0,-1,0);var y=h.scene.collisions.rayCastNearest(c),C=-1;if(y&&y.distance!==-1){C=y.distance*0.1;d.position.y=c.origin.y-C+e*0.5}f.position.x=
d.position.x+12*w;f.position.x=Math.min(300,Math.max(-300,f.position.x));f.position.z=d.position.z-200;o.position.y=o.target.position.y=f.position.y=d.position.y;o.target.position.x+=(f.position.x-o.target.position.x)*0.35;o.target.position.z+=(f.position.z-o.target.position.z)*0.35}else if(u<0.39){c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.set(0,-1,0);if((y=h.scene.collisions.rayCastNearest(c))&&y.distance!==-1){C=y.distance*0.1;d.position.y=c.origin.y-C+e}x=-x*20;f.position.y+
x-d.position.y<=125&&(f.position.y+=x);f.position.y=Math.max(f.position.y,d.position.y);f.position.y=Math.min(f.position.y,d.position.y+125);g.sub(f.position,d.position).normalize();f.position.x=d.position.x+g.x*200-g.z*12*w*0.5;f.position.z=d.position.z+g.z*200+g.x*12*w*0.5;w=Math.sin(0.5*Math.PI*(u-0.03)/0.36);cameraSpeed=5*w*v;g.multiplyScalar(cameraSpeed);d.position.x+=g.x;d.position.y+=Math.sin((d.position.x+d.position.z)*0.1)*5*(1.5-w);d.position.z+=g.z;o.position.x+=(d.position.x-o.position.x)*
0.1;o.position.y+=(d.position.y-o.position.y)*0.1;o.position.z+=(d.position.z-o.position.z)*0.1;o.target.position.x+=(f.position.x-o.target.position.x)*0.1;o.target.position.y+=(f.position.y-o.target.position.y)*0.1;o.target.position.z+=(f.position.z-o.target.position.z)*0.1}else{var B,H,z;switch(n){case 0:z="forward";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(o.matrixWorld.getColumnZ().negate());B=200;H=60;break;case 1:z="left";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(o.matrixWorld.getColumnX().negate());
B=40;H=60;break;case 2:z="right";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(o.matrixWorld.getColumnX());B=40;H=60;break;case 3:z="down";c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.copy(o.matrixWorld.getColumnY().negate());B=50;H=60;break;case 4:z="up";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(o.matrixWorld.getColumnY());B=40;H=60}n++;n>4&&(n=0);m[z]=1;y=h.scene.collisions.rayCastNearest(c);C=NaN;if(y&&y.distance!==-1){C=y.distance*0.1;z!=="down"&&
C<B+H&&(m[z]=C<B?0:1-(C-B)/H)}if(z!=="forward"&&m[z]<1){y=new THREE.Vector3;y.copy(c.direction).negate().multiplyScalar((1-m[z])*15);if(z==="left"||z==="right")y.y=0;else{y.x=0;y.z=0}f.position.addSelf(y);m[z]=Math.max(m[z],0.3);w*=0.1;x*=0.1}if(z==="down"&&!isNaN(C)&&C<50){z=d.position.y;d.position.y=c.origin.addSelf(c.direction.multiplyScalar(C)).y+e;f.position.y+=d.position.y-z}else!isNaN(C)&&c.origin.addSelf(c.direction.multiplyScalar(C)).y<200&&(m[z]=1);C=m.forward*m.up*m.down*m.right*m.left;
x=-x*20;if(Math.abs(f.position.y+x-d.position.y)<=250)f.position.y+=x;else{if(f.position.y>d.position.y)f.position.y=d.position.y+250;if(f.position.y<d.position.y)f.position.y=d.position.y-250}f.position.y=Math.max(f.position.y,e);f.position.y=Math.min(f.position.y,4500);g.sub(f.position,d.position).normalize();f.position.x=d.position.x+g.x*200-g.z*12*w*v;f.position.z=d.position.z+g.z*200+g.x*12*w*v;cameraSpeed=25;b.cameraSlowDown||(cameraSpeed+=5*((Math.min(Math.max(d.position.y,e),3E3)-e)/(3E3-
e)));d.position.addSelf(g.multiplyScalar(cameraSpeed*C*v));if(u<0.475){d.position.y+=7.5*v;f.position.y+=6.75*v}e+=(75-e)*0.25;d.position.y=Math.max(d.position.y,e);d.position.y=Math.min(d.position.y,4500);o.position.x+=(d.position.x-o.position.x)*0.05;o.position.y+=(d.position.y-o.position.y)*0.05;o.position.z+=(d.position.z-o.position.z)*0.05;o.target.position.x+=(f.position.x-o.target.position.x)*0.05;o.target.position.y+=(f.position.y-o.target.position.y)*0.05;o.target.position.z+=(f.position.z-
o.target.position.z)*0.05;w=o.matrixWorld.getColumnZ();g.normalize();g.y=w.y;g.subSelf(w).normalize();g.multiplyScalar(0.4);d.up.set(0,1,0);d.up.subSelf(g).normalize();o.up.x+=(d.up.x-o.up.x)*0.05;o.up.y+=(d.up.y-o.up.y)*0.05;o.up.z+=(d.up.z-o.up.z)*0.05;g.sub(o.position,o.target.position).y=0;if(g.length()<1){d.position.y=f.position.y=o.target.position.y=o.position.y;f.position.z=o.target.position.z=-200}}};return t};
DunesCameraFreeExplore=function(b){var e=new THREE.Ray,c,d,f=new THREE.Vector3,g={forward:1,left:1,right:1,up:1,down:1},m=0,n,h;n=b.worlds.dunes;h=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);h.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);n.scene.addChild(h);n.scene.addChild(h.target);n.scene.addChild(c);n.scene.addChild(d);var o={};o.camera=h;o.resetCamera=function(){c.position.set(0,150,300);d.position.set(0,150,-300);d.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
h.position.copy(c.position);h.target.position.copy(d.position)};o.switchDirection=function(t){f.sub(h.position,h.target.position).normalize().multiplyScalar(t.radius*1.5).addSelf(t.object.matrixWorld.getPosition());c.position.copy(f);f.sub(h.position,h.target.position).normalize().multiplyScalar(t.radius*1.5+200).addSelf(t.object.matrixWorld.getPosition());d.position.copy(f);h.position.copy(c.position);h.target.position.copy(d.position)};o.updateCamera=function(t,u){u=u>30||u<5||isNaN(u)?1:u/30;var v,
w,x;switch(m){case 0:x="forward";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(h.matrixWorld.getColumnZ().negate());v=200;w=60;break;case 1:x="left";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(h.matrixWorld.getColumnX().negate());v=40;w=60;break;case 2:x="right";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(h.matrixWorld.getColumnX());v=40;w=60;break;case 3:x="down";e.origin.copy(c.matrixWorld.getPosition()).y+=100;e.direction.copy(h.matrixWorld.getColumnY().negate());
v=50;w=60;break;case 4:x="up";e.origin.copy(c.matrixWorld.getPosition());e.direction.copy(h.matrixWorld.getColumnY());v=40;w=60}m++;m>4&&(m=0);g[x]=1;var y=n.scene.collisions.rayCastNearest(e),C=NaN;if(y&&y.distance!==-1){C=y.distance*n.scale;x!=="down"&&C<v+w&&(g[x]=C<v?0:1-(C-v)/w)}v=b.mouse.x/b.screenWidth-0.5;w=b.mouse.y/b.screenHeight-0.5;if(x!=="forward"&&g[x]<1){y=new THREE.Vector3;y.copy(e.direction).negate().multiplyScalar((1-g[x])*15);if(x==="left"||x==="right")y.y=0;else{y.x=0;y.z=0}d.position.addSelf(y);
g[x]=Math.max(g[x],0.3);v*=0.1;w*=0.1}if(!isNaN(C)&&x==="down"&&C<50){x=c.position.y;c.position.y=e.origin.addSelf(e.direction.multiplyScalar(C)).y+75;d.position.y+=c.position.y-x}else!isNaN(C)&&e.origin.addSelf(e.direction.multiplyScalar(C)).y<200&&(g[x]=1);C=g.forward*g.up*g.down*g.right*g.left;x=-w*20;if(Math.abs(d.position.y+x-c.position.y)<=200)d.position.y+=x;else{if(d.position.y>c.position.y)d.position.y=c.position.y+200;if(d.position.y<c.position.y)d.position.y=c.position.y-200}d.position.y=
Math.max(d.position.y,75);d.position.y=Math.min(d.position.y,4500);f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*200-f.z*15*v*u;d.position.z=c.position.z+f.z*200+f.x*15*v*u;cameraSpeed=25;b.cameraSlowDown||(cameraSpeed+=10*((Math.min(Math.max(c.position.y,75),3E3)-75)/2925));c.position.addSelf(f.multiplyScalar(cameraSpeed*C*u));c.position.y=Math.max(c.position.y,75);c.position.y=Math.min(c.position.y,4500);h.position.x+=(c.position.x-h.position.x)*0.05;h.position.y+=(c.position.y-
h.position.y)*0.05;h.position.z+=(c.position.z-h.position.z)*0.05;h.target.position.x+=(d.position.x-h.target.position.x)*0.05;h.target.position.y+=(d.position.y-h.target.position.y)*0.05;h.target.position.z+=(d.position.z-h.target.position.z)*0.05;C=h.matrixWorld.getColumnZ();f.normalize();f.y=C.y;f.subSelf(C).normalize();f.multiplyScalar(0.4*u);c.up.set(0,1,0);c.up.subSelf(f).normalize();h.up.x+=(c.up.x-h.up.x)*0.05*u;h.up.y+=(c.up.y-h.up.y)*0.05*u;h.up.z+=(c.up.z-h.up.z)*0.05*u;f.sub(h.position,
h.target.position).y=0;if(f.length()<1){c.position.y=d.position.y=h.target.position.y=h.position.y;d.position.z=h.target.position.z=-200}};return o};
PrairieCameraFreeExplore=function(b){var e,c,d=new THREE.Vector3,f,g,m,n,h=new THREE.Vector3;f=b.worlds.prairie;g=f.portals;n=new THREE.Vector3(350,0,-300);m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);e=new THREE.Object3D;c=new THREE.Object3D;c.position.set(0,0,-100);f.scene.addChild(m);f.scene.addChild(m.target);f.scene.addChild(e);f.scene.addChild(c);f={};f.camera=m;f.resetCamera=function(){e.position.set(n.x-200,25,n.z);c.position.set(n.x+300,25,
n.z);m.position.copy(e.position);m.target.position.copy(c.position)};f.updateCamera=function(o,t){t=t*(1E3/30)/1E3;var u=b.mouse.x/b.screenWidth-0.5,v=b.mouse.y/b.screenHeight-0.5;if(Math.abs(c.position.y-e.position.y)<200)c.position.y-=v*20*t;else{c.position.y>e.position.y&&(c.position.y-=20);c.position.y<e.position.y&&(c.position.y+=20)}d.sub(c.position,e.position).normalize();c.position.x=e.position.x+d.x*350-d.z*15*u*t;c.position.z=e.position.z+d.z*350+d.x*15*u*t;var w;v=9999999999;for(var x=
0;x<g.length;x++){var y=g[x];u=h.sub(y.object.matrixWorld.getPosition(),e.position).normalize().dot(d);if(u>0.7&&y.currentDistance<v){v=y.currentDistance;w=y}}if(w&&v<w.radius*2){h.sub(w.object.matrixWorld.getPosition(),e.position);e.position.addSelf(h.normalize().multiplyScalar(2*t))}else{w=d.multiplyScalar(2*t);w.y=(25-e.position.y)*0.03;e.position.addSelf(w);v=e.position.x-n.x;x=e.position.z-n.z;u=h.sub(n,e.position).normalize().dot(d);Math.sqrt(v*v+x*x)>795&&u<0&&e.position.subSelf(w)}m.position.x+=
(e.position.x-m.position.x)*0.02*t;m.position.y+=(e.position.y-m.position.y)*0.02*t;m.position.z+=(e.position.z-m.position.z)*0.02*t;m.target.position.x+=(c.position.x-m.target.position.x)*0.02*t;m.target.position.y+=(c.position.y-m.target.position.y)*0.02*t;m.target.position.z+=(c.position.z-m.target.position.z)*0.02*t;u=m.matrixWorld.getColumnZ();d.normalize();d.y=u.y;d.subSelf(u).normalize();d.multiplyScalar(0.4*t);e.up.set(0,1,0);e.up.subSelf(d).normalize();m.up.x+=(e.up.x-m.up.x)*0.02*t;m.up.y+=
(e.up.y-m.up.y)*0.02*t;m.up.z+=(e.up.z-m.up.z)*0.02*t};return f};
CityCameraFreeExplore=function(b){var e={start:new THREE.Vector3(-3E3,10,-1500),end:new THREE.Vector3(3E3,200,-1500)},c={start:new THREE.Vector3(0,10,-300),end:new THREE.Vector3(0,250,-3200)},d,f,g=new THREE.Vector3,m=new THREE.Vector3,n,h,o;n=b.worlds.city;o=n.portals;h=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);h.target.position.set(0,0,-100);d=new THREE.Object3D;f=new THREE.Object3D;f.position.set(0,0,-100);n.scene.addChild(h);n.scene.addChild(h.target);n.scene.addChild(d);n.scene.addChild(f);
n={};n.camera=h;n.resetCamera=function(){d.position.set(c.start.x,c.start.y,(c.end.z+c.start.z)*0.5);f.position.set(e.start.x,c.start.y,d.position.z);h.position.copy(d.position);h.target.position.copy(f.position)};n.updateCamera=function(t,u){u=u*(1E3/30)/1E3;var v=b.mouse.x/b.screenWidth-0.5,w=b.mouse.y/b.screenHeight-0.5;Math.abs(f.position.y-d.position.y)<50&&(f.position.y-=w*20);f.position.y=Math.max(f.position.y,c.start.y);f.position.y=Math.min(f.position.y,c.end.y);g.sub(f.position,d.position).normalize();
f.position.x=d.position.x+g.x*500-g.z*25*v*u;f.position.z=d.position.z+g.z*500+g.x*25*v*u;var x;v=9999999999;for(w=0;w<o.length;w++){var y=o[w];if(m.sub(y.object.matrixWorld.getPosition(),d.position).normalize().dot(g)>0.7&&y.currentDistance<v){v=y.currentDistance;x=y}}if(x&&v<x.radius*4){m.sub(x.object.matrixWorld.getPosition(),d.position);d.position.addSelf(m.normalize().multiplyScalar(10*u))}else{cameraSpeed=10;cameraSpeed+=2*((Math.min(Math.max(d.position.y,c.start.y),c.end.y)-c.start.y)/(c.end.y-
c.start.y));d.position.addSelf(g.multiplyScalar(cameraSpeed*u));d.position.x=c.start.x;d.position.y=Math.max(Math.min(d.position.y,c.end.y),c.start.y);d.position.z=Math.min(Math.max(d.position.z,c.end.z),c.start.z)}h.position.x+=(d.position.x-h.position.x)*0.05*u;h.position.y+=(d.position.y-h.position.y)*0.05*u;h.position.z+=(d.position.z-h.position.z)*0.05*u;h.target.position.x+=(f.position.x-h.target.position.x)*0.2*u;h.target.position.y+=(f.position.y-h.target.position.y)*0.2*u;h.target.position.z+=
(f.position.z-h.target.position.z)*0.2*u;x=h.matrixWorld.getColumnZ();g.normalize();g.y=x.y;g.subSelf(x).normalize();g.multiplyScalar(0.4*u);d.up.set(0,1,0);d.up.subSelf(g).normalize();h.up.x+=(d.up.x-h.up.x)*0.05*u;h.up.y+=(d.up.y-h.up.y)*0.05*u;h.up.z+=(d.up.z-h.up.z)*0.05*u};return n};
Trigger=function(b,e){var c={},d=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,d);var f=1,g=0;e=e!==undefined?e:0;var m=c.mesh.morphTargetForcedOrder;m[0]=0;m[1]=1;c.play=function(n){f=n||1;g=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);c.update(0)};c.update=function(n){if(n<
5||n>66)n=33;g+=n*f;if(g>=1E3){m[0]=0;m[1]=c.mesh.geometry.morphTargets.length-1;d.uniforms.morph.value=1;d.uniforms.darkness.value=e;THREE.AnimationHandler.removeFromUpdate(c)}else{n=g/1E3;var h,o=0.1,t=0.7;if(n==0)n=0;else if(n==1)n=1;else{t||(t=0.3);if(!o||o<1){o=1;h=t/4}else h=t/(2*Math.PI)*Math.asin(1/o);n=o*Math.pow(2,-10*n)*Math.sin((n-h)*2*Math.PI/t)+1}n*=1E3;if(n<1E3){m[0]=Math.floor(n/1E3);m[1]=Math.ceil(n/1E3)}else{m[0]=c.mesh.geometry.morphTargets.length-2;m[1]=c.mesh.geometry.morphTargets.length-
1}d.uniforms.morph.value=n/1E3;d.uniforms.darkness.value=e*g/1E3}};return c};
var TriggerBig=function(b){var e={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});e.mesh=new THREE.Mesh(b,c);e.mesh.doubleSided=!0;var d=0.1,f=0,g=(b.morphTargets.length-1)*1E3,m=e.mesh.morphTargetForcedOrder;m[0]=0;m[1]=1;e.play=function(n){d=n||1;f=0;THREE.AnimationHandler.addToUpdate(e);e.update(0)};e.update=
function(n){f+=n*d;if(f>=g){m[0]=0;m[1]=e.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(e)}else{n=f/g*g;if(n<g){m[0]=Math.floor(n/1E3);m[1]=Math.ceil(n/1E3)}else{m[0]=e.mesh.geometry.morphTargets.length-2;m[1]=e.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=n/g}};return e},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var e=[],c=[],d=[];b.setupCityTriggers=function(f){if(f.triggers){var g,m,n,h,o=f.triggers,
t=[];for(n in o)if(n.indexOf("TriggerMesh")!==-1){h=o[n];h.name=n.slice(n.indexOf("_")+1);h.geometry=f.geometries[h.object.geometry];t.push(h);f.objects[n].parent.removeChild(f.objects[n]);f.objects[n].visible=!1;delete o[n]}e=[];c=[];for(n in o){g=0;for(m=t.length;g<m;g++)if(n.indexOf(t[g].name)!==-1&&t[g].geometry.morphTargets.length){h=new Trigger(t[g].geometry);f.objects[n].addChild(h.mesh);h.mesh.visible=!1;e.push(h);h.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(f){var g,
m,n=f.geometries,h,o,t,u,v,w,x;for(g in n){m=n[g];if(m.morphTargets.length){h=0;for(o=m.morphTargets.length;h<o;h++){v=m.morphTargets[h].vertices;t=0;for(u=v.length;t<u;t++){w=v[t].position;x=w.y;w.y=-w.z;w.z=x}}}}m=f.objects;d=[];for(g in m)if(m[g].geometry&&m[g].geometry.morphTargets.length){f=new Trigger(m[g].geometry,Math.random()*0.25+0.5);m[g].addChild(f.mesh);m[g].visible=!1;d.push(f)}};b.update=function(f){var g,m,n,h,o=b.effectors,t,u,v,w=b.effectorRadius*1.5;if(f==="city"){f=0;for(g=e.length;f<
g;f++){m=e[f].mesh.matrixWorld.getPosition();n=0;for(h=o.length;n<h;n+=3){t=Math.abs(o[n+0]-m.x);u=Math.abs(o[n+1]-m.y);v=Math.abs(o[n+2]-m.z);if(t+u+v<w){e[f].play(0.2+Math.random()*0.05);e.splice(f,1);f--;g--;break}}}f=0;for(g=c.length;f<g;f++){m=c[f].mesh.matrixWorld.getPosition();n=0;for(h=o.length;n<h;n+=3){t=Math.abs(o[n+0]-m.x);u=Math.abs(o[n+1]-m.y);v=Math.abs(o[n+2]-m.z);if(t+u+v<w){c[f].play(0.2+Math.random()*0.1);c.splice(f,1);f--;g--;break}}}}else{f=0;for(g=d.length;f<g;f++){m=d[f].mesh.matrixWorld.getPosition();
n=0;for(h=o.length;n<h;n+=3){t=Math.abs(o[n+0]-m.x);u=Math.abs(o[n+1]-m.y);v=Math.abs(o[n+2]-m.z);if(t+u+v<w){d[f].play(0.1+Math.random()*0.05);d.splice(f,1);f--;g--;break}}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,e,c){function d(D){var T,W,U,Y;T=0;for(W=D.faces.length;T<W;T++){Y=D.faces[T];for(j=0;j<Y.vertexColors.length;j++){U=Y.vertexColors[j];THREE.ColorUtils.adjustHSV(U,0.13,0.3,-0.05)}}}var f=this;f.camera=b;renderer=c.renderer;var g=0;c.camPos=new THREE.Vector3(0,0,-300);b=new THREE.JSONLoader;b.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};b.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var m=new CollisionScene(f.camera,e,0.1,c,500,!0,e);m.settings.maxSpeedDivider=
1;m.settings.capBottom=3;m.settings.capTop=1E3;m.settings.shootRayDown=!1;m.settings.allowFlying=!1;m.settings.emitterDivider=2;m.settings.normalOffsetAmount=8;m.settings.minDistance=100;m.settings.keepEmitterFollowDown=!0;m.emitter.position.z=-100;m.emitterFollow.position.z=-100;b.load({model:"/files/models/city/collision/City.Collision_Big.js",callback:function(D){var T=new THREE.Vector3(-1.570796,0,0),W=new THREE.Vector3(0,0,0);m.addLoaded(D,0.1,T,W,e)}});b.load({model:"/files/models/city/collision/City.Collision_Big.001.js",
callback:function(D){var T=new THREE.Vector3(-1.570796,0,0),W=new THREE.Vector3(0,0,0);m.addLoaded(D,0.1,T,W,e)}});b.load({model:"/files/models/city/collision/City.Collision_Big.002.js",callback:function(D){var T=new THREE.Vector3(-1.570796,0,0),W=new THREE.Vector3(0,0,0);m.addLoaded(D,0.1,T,W,e)}});b.load({model:"/files/models/city/collision/City.Collision_Big.003.js",callback:function(D){var T=new THREE.Vector3(-1.570796,0,0),W=new THREE.Vector3(0,0,0);m.addLoaded(D,0.1,T,W,e)}});var n=new THREE.Vector3(0,
0,-250),h=new Vectors(50,3,8,n),o=[new THREE.MeshLambertMaterial({color:5997888,opacity:1}),new THREE.MeshLambertMaterial({color:4285993,opacity:1}),new THREE.MeshLambertMaterial({color:3103761,opacity:1}),new THREE.MeshLambertMaterial({color:6525252,opacity:1})],t=new Ribbons(4,h.array,e,o);t.settings.ribbonPulseMultiplier_1=15;t.settings.ribbonPulseMultiplier_2=0;t.settings.ribbonMin=0.1;t.settings.ribbonMax=0.2;o=THREE.ImageUtils.loadTexture("/files/textures/particle_0.png");var u=THREE.ImageUtils.loadTexture("/files/textures/particle_1.png"),
v=THREE.ImageUtils.loadTexture("/files/textures/particle_2.png"),w=THREE.ImageUtils.loadTexture("/files/textures/particle_3.png"),x=THREE.ImageUtils.loadTexture("/files/textures/particle_4.png"),y=new Particles(22,e,5,[o,u,v,w,x],20,70,THREE.AdditiveBlending);y.settings.gravitateTowardsCamera=!0;var C=new Stragglers(5,e,h.array);C.settings.capy=0;var B=new AnimalSwarm2(30,e,h.array);B.settings.addaptiveSpeed=!0;B.settings.capy=0;B.settings.startPosition=n;B.settings.constantSpeed=0.75;B.settings.avoidCamera=
!0;B.settings.killAtDistance=!0;B.array[0]="moose";B.array[22]="moose";B.array[2]="elk";B.array[10]="elk";B.array[1]="elk";B.array[25]="elk";B.array[8]="fish";B.array[16]="fish";B.array[5]="sockjump";B.array[26]="sockjump";B.array[13]="sockpopup";B.array[29]="sockjump";b.load({model:"/files/models/soup/animals_A_life.js",callback:function(D){var T=[1,0,4,3,2,1,0,5,2,7,8,9,10,1,0,3,3,9,2,3],W=[6.5,13.12,9.76,7.47,4.74,4.94,0.777,6.252,3.412,5.52,5.576];B.addAnimal(D,null,1.5,T,W);T=[8,9,7,9,10];D=
C.addAnimal(D,null,1.8,T,W);preinitAnimal(D,renderer,e)}});b.load({model:"/files/models/soup/elk_life.js",callback:function(D){D=B.addAnimal(D,"elk",2.2,null,[6]);preinitAnimal(D,renderer,e)}});b.load({model:"/files/models/soup/moose_life.js",callback:function(D){D=B.addAnimal(D,"moose",1.1,null,[13.964]);preinitAnimal(D,renderer,e)}});b.load({model:"/files/models/soup/fish_life.js",callback:function(D){D=B.addAnimal(D,"fish",1.6,[0,1,2,3],[2]);preinitAnimal(D,renderer,e);B.array[8].isFish=!0;B.array[16].isFish=
!0}});b.load({model:"/files/models/soup/sockpuppet_jump.js",callback:function(D){D=B.addAnimal(D,"sockjump",1.8,null,[3],!0);preinitAnimal(D,c.renderer,e)}});b.load({model:"/files/models/soup/sockpuppet_popup.js",callback:function(D){D=B.addAnimal(D,"sockpopup",2,null,[0.1],!0);preinitAnimal(D,c.renderer,e)}});var H=new AnimalSwarm2(10,e,h.array);H.settings.flying=!0;H.settings.flyingDistance=60;for(n=0;n<10;++n)n%2==0&&(H.array[n]="b");b.load({model:"files/models/soup/birds_A_life.js",callback:function(D){D=
H.addAnimal(D,null,1.3,[0,1,2,3,0,1,2,3,0,1],[4.848,7,7.5,3.5]);preinitAnimal(D,renderer,e)}});b.load({model:"files/models/soup/birds_B_life.js",callback:function(D){D=H.addAnimal(D,"b",1.3,[1,1,0,0,1,0,0,1,0,0],[8.5,8.623]);preinitAnimal(D,renderer,e)}});var z=new AnimalInFrontOfCamera(15,e);b.load({model:"/files/models/soup/butterfly_hiD.js",callback:z.addAnimal});var E=new AnimalInFrontOfCamera(15,e);b.load({model:"/files/models/soup/butterfly_hiC.js",callback:E.addAnimal});var F=new Trail(80,
e);F.settings.freeRotation=!1;F.settings.tweenTime=2500;F.settings.aliveDivider=30;F.settings.offsetAmount=10;for(n=0;n<80;++n)F.array[n]="0"+(n%4+1);F.array[10]="tree1";F.array[30]="tree2";F.array[45]="tree3";F.array[60]="tree4";F.array[75]="tree5";F.array[70]="light";b.load({model:"/files/models/soup/grass01.js",callback:function(D){d(D);F.addInstance(D,"01",!1)}});b.load({model:"/files/models/soup/grass02.js",callback:function(D){d(D);var T=F.addInstance(D,"02",!1);preInitModel(D,renderer,e,T)}});
b.load({model:"/files/models/soup/grass03.js",callback:function(D){d(D);var T=F.addInstance(D,"03",!1);preInitModel(D,renderer,e,T)}});b.load({model:"/files/models/soup/grassFlower.js",callback:function(D){d(D);var T=F.addInstance(D,"04",!1);preInitModel(D,renderer,e,T)}});b.load({model:"/files/models/soup/evergreen_low.js",callback:function(D){d(D);var T=F.addInstance(D,"tree1",!0);preInitModel(D,renderer,e,T)}});b.load({model:"/files/models/soup/evergreen_high.js",callback:function(D){d(D);var T=
F.addInstance(D,"tree2",!0);preInitModel(D,renderer,e,T)}});b.load({model:"/files/models/soup/treeGeneric.js",callback:function(D){d(D);var T=F.addInstance(D,"tree3",!0);preInitModel(D,renderer,e,T)}});b.load({model:"/files/models/soup/treeGenericLower.js",callback:function(D){d(D);var T=F.addInstance(D,"tree4",!0);preInitModel(D,renderer,e,T)}});b.load({model:"/files/models/soup/treeOrange.js",callback:function(D){d(D);var T=F.addInstance(D,"tree5",!0);preInitModel(D,renderer,e,T)}});b.load({model:"/files/models/soup/lighthouse.js",
callback:function(D){var T=F.addInstance(D,"light",!1,!0);preInitModel(D,renderer,e,T);F.array[70].maxHeight=12}});this.update=function(D,T){if(!isNaN(D)&&!(D>1E3||D==0)){if(T){c.camPos.copy(T.matrixWorld.getPosition());m.settings.camera=T}else{c.camPos.x=f.camera.matrixWorld.n14;c.camPos.y=f.camera.matrixWorld.n24;c.camPos.z=f.camera.matrixWorld.n34;m.settings.camera=f.camera}g%8==7&&C.create(m.emitterFollow.position,m.currentNormal,m.emitter.position);++g;var W=0;g%4==0&&(W=(Math.random()-0.5)*
1.2);if(g%2==0&&!T)f.camera.animationParent.position.y=18+(Math.random()-0.5)*1.2;if(!T)f.camera.position.x=0+W;g%4==3&&B.create(m.emitterFollow.position,m.currentNormal,m.emitterFollow.position);g%8==7&&H.create(m.emitterFollow.position,m.currentNormal,m.emitterFollow.position);m.update(c.camPos,D);h.update(m.emitterFollow.position,m.currentNormal);t.update(m.emitterFollow.position);y.update(D,h.array[0].position,c.camPos);B.update(D,c.camPos,m.emitterFollow.position,m.currentNormal);C.update(D,
c.camPos);H.update(D,c.camPos,m.emitterFollow.position,m.currentNormal);E.update(c.camPos,f.camera.theta,D);z.update(c.camPos,f.camera.theta,D,!0);F.update(m.emitter.position,m.emitterNormal,c.camPos,D);TWEEN.update();TriggerUtils.effectors[0]=h.array[0].position.x;TriggerUtils.effectors[1]=h.array[0].position.y;TriggerUtils.effectors[2]=h.array[0].position.z}};this.changeCamera=function(D){f.camera=D;m.settings.camera=D};this.destruct=function(){}},PrairieSoup=function(b,e,c){c.camPos=new THREE.Vector3(302.182,
-9.045,-105.662);var d=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,m=new THREE.JSONLoader;m.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};m.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var n=0,h=0,o=[],t=new CollisionScene(b,e,1,c,1100);t.settings.maxSpeedDivider=1;t.settings.allowFlying=!1;t.settings.emitterDivider=1;t.settings.shootRayDown=!1;t.settings.keepEmitterFollowDown=!0;t.settings.normalOffsetAmount=7;t.settings.minDistance=0;t.emitter.position.set(c.camPos.x+
40,c.camPos.y,c.camPos.z+20);t.emitterFollow.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);var u=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30),v=new Vectors(30,10,10,u),w=THREE.ImageUtils.loadTexture("/files/textures/dark_0.png"),x=THREE.ImageUtils.loadTexture("/files/textures/dark_1.png"),y=THREE.ImageUtils.loadTexture("/files/textures/dark_2.png"),C=THREE.ImageUtils.loadTexture("/files/textures/dark_3.png"),B=THREE.ImageUtils.loadTexture("/files/textures/dark_4.png"),H=new Particles(20,
e,1.5,[w,x,y,C,B],70,60);H.settings.zeroAlphaStart=!1;H.settings.aliveDivider=2;var z=new AnimalSwarm(40,e,v.array);z.settings.xPositionMultiplier=22;z.settings.zPositionMultiplier=18;z.settings.shootRayDown=!0;z.settings.adaptiveSpeed=!0;z.settings.divider=1;z.settings.startPosition=u;z.array[7]="gator";z.array[8]="gator";z.array[9]="animal";z.array[11]="goat";z.array[13]="gator";z.array[14]="arm";z.array[15]="gator";z.array[16]="goat";z.array[18]="goat";z.array[19]="animal";z.array[20]="animal";
z.array[21]="animal";z.array[22]="animal";z.array[23]="animal";z.array[24]="animal";z.array[25]="animal";z.array[26]="animal";z.array[27]="animal";z.array[28]="animal";z.array[29]="animal";z.array[30]="octo";z.array[31]="octo";z.array[32]="octo";z.array[33]="octo";z.array[34]="centipede";z.array[35]="goat";z.array[36]="octo";m.load({model:"/files/models/soup/taruffalo_black.js",callback:function(D){D=z.addAnimal(D,null,0.25,[0,1,0,1],[9.2,9.2]);preinitAnimal(D,c.renderer,e)}});m.load({model:"/files/models/soup/animals_A_black.js",
callback:function(D){D=z.addAnimal(D,"animal",0.35,[3,1,2,0,1,0,2,0,2,3,0],[11.12,9.73,6.7,3.06]);preinitAnimal(D,c.renderer,e)}});m.load({model:"/files/models/soup/gator_black.js",callback:function(D){D=z.addAnimal(D,"gator",0.35,null,[4.5]);preinitAnimal(D,c.renderer,e)}});m.load({model:"/files/models/soup/goat_black.js",callback:function(D){D=z.addAnimal(D,"goat",0.45,null,[5.2]);preinitAnimal(D,c.renderer,e)}});m.load({model:"/files/models/soup/arm_black.js",callback:function(D){D=z.addAnimal(D,
"arm",3,null,[1]);preinitAnimal(D,c.renderer,e);z.array[14].generalSpecialCase=!0}});m.load({model:"/files/models/soup/octo_black.js",callback:function(D){D=z.addAnimal(D,"octo",0.25,[0,0,1,2],[1.629,3,1.7]);preinitAnimal(D,c.renderer,e)}});m.load({model:"/files/models/soup/sickle.js",callback:function(D){D=z.addAnimal(D,"sickle",1.5,null,[0.5]);preinitAnimal(D,c.renderer,e)}});m.load({model:"/files/models/soup/centipede.js",callback:function(D){D=z.addAnimal(D,"centipede",0.5,null,[1]);preinitAnimal(D,
c.renderer,e)}});var E=new AnimalSwarm(10,e,v.array);E.settings.flying=!0;E.settings.xPositionMultiplier=24;E.settings.zPositionMultiplier=12;E.settings.constantSpeed=2;E.settings.divider=4;E.settings.flyingDistance=-15;m.load({model:"/files/models/soup/birds_A_black.js",callback:function(D){D=E.addAnimal(D,null,0.4,[0,0,0,0,1,0,0,0,0,1],[12,14]);preinitAnimal(D,c.renderer,e)}});var F=new Trail(80,e);F.settings.spread=10;F.settings.aliveDivider=40;F.settings.tweenTime=800;F.settings.scale=0.3;F.settings.offsetAmount=
10;F.settings.yscale=0.15;m.load({model:"/files/models/soup/darkblob01.js",callback:function(D){var T=F.addInstance(D,null,!1,!1);preInitModel(D,renderer,e,T)}});this.update=function(D,T){if(!isNaN(D)&&!(D>1E3||D==0)){if(T){c.camPos.copy(T.matrixWorld.getPosition());t.settings.camera=T}else{c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;t.settings.camera=b}f.copy(c.camPos);g.copy(f.subSelf(d).normalize());d.copy(c.camPos);if(c.camPos.x>1090){c.camPos.set(302.182,
-9.045,-105.662);t.reset(c.camPos.x,c.camPos.y,c.camPos.z);v.reset(c.camPos.x,c.camPos.y,c.camPos.z);z.reset(c.camPos.x,c.camPos.y,c.camPos.z);E.reset(c.camPos.x,c.camPos.y,c.camPos.z);H.reset(c.camPos.x,c.camPos.y,c.camPos.z)}n+=D;h+=D;t.update(c.camPos,D);v.update(t.emitterFollow.position,t.currentNormal);H.update(D,v.array[0].position);z.update(D,c.camPos);E.update(D,c.camPos);F.update(t.emitterFollow.position,t.emitterNormal,c.camPos,D);if(n>=100){z.create(t.emitterFollow.position,t.currentNormal,
g);n=0}if(h>=500){E.create(t.emitterFollow.position,t.currentNormal,g);h=0}TWEEN.update();var W=new THREE.Vector3(t.emitter.position.x,t.emitter.position.y,t.emitter.position.z);o.unshift(W);if(o.length>10){W=o[10];ROME.TrailShaderUtils.updateLava(D*1.0E-4,W.x,-W.z);ROME.TrailShaderUtils.setMarkAtWorldPosition(W.x,-W.z)}TriggerUtils.effectors[0]=v.array[1].position.x;TriggerUtils.effectors[1]=v.array[1].position.y;TriggerUtils.effectors[2]=v.array[1].position.z;c.prairieSoupHead.copy(t.emitter.position)}};
this.destruct=function(){}},DunesSoup=function(b,e,c){c.camPos=new THREE.Vector3(0,0,0);var d=new THREE.JSONLoader;d.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=new CollisionScene(b,e,0.15,c,1E3);f.settings.emitterDivider=5;f.settings.maxSpeedDivider=0.1;f.settings.capBottom=-500;f.settings.allowFlying=!0;var g=new THREE.Vector3(c.camPos.x,c.camPos.y-1E3,c.camPos.z),m=new Vectors(50,3,10,g),n=[new THREE.MeshBasicMaterial({color:14283771,
opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,opacity:0.25})],h=new Ribbons(6,m.array,e,n);h.settings.ribbonPulseMultiplier_1=20;h.settings.ribbonPulseMultiplier_2=0.01;h.settings.ribbonMin=0.05;h.settings.ribbonMax=0.1;var o=new AnimalSwarm_dunes(11,e,
m.array);o.settings.flying=!0;o.settings.flyingDistance=0;o.settings.divider=1;o.settings.constantSpeed=0.8;o.settings.respawn=!1;o.settings.startPosition=g;o.settings.xPositionMultiplier=50;o.settings.zPositionMultiplier=30;for(g=0;g<12;++g)g%3==0&&(o.array[g]="b");d.load({model:"/files/models/soup/birds_A_life.js",callback:function(t){t=o.addAnimal(t,null,2.8,[0,1,2,3],1.2);preinitAnimal(t,c.renderer,e)}});d.load({model:"/files/models/soup/birds_B_life.js",callback:function(t){t=o.addAnimal(t,"b",
2.8,[1,0],1.2);preinitAnimal(t,c.renderer,e)}});this.update=function(t,u){if(!isNaN(t)&&!(t>1E3||t==0)){if(u){c.camPos.copy(u.matrixWorld.getPosition());f.settings.camera=u}else{c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;f.settings.camera=b}f.update(c.camPos,t);m.update(f.emitterFollow.position,f.currentNormal);h.update(f.emitterFollow.position);o.update(t,c.camPos)}};this.destruct=function(){}},Ribbon=function(b,e,c){b=b||100;e=e||10;c=c||10;THREE.Geometry.call(this);
e/=2;b/=c;for(var d=[],f=0;f<c+2;++f){var g=f*b,m=-e;d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,e,0)))-1);d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,m,0)))-1)}for(f=0;f<c*2;f+=2){this.faces.push(new THREE.Face3(d[f],d[f+2],d[f+1]));this.faces.push(new THREE.Face3(d[f+2],d[f+3],d[f+1]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,e){var c=ROME.AnimalAnimationData.init(b,e),d={};d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.availableAnimals=c.availableAnimals;d.mesh=new THREE.Mesh(b,c.material);var f=!1,g=d.mesh.morphTargetForcedOrder,m=c.material;d.play=function(h,o,t,u,v){if(!f){f=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}o=
o!==undefined?o:h;n(h,d.animalA);n(o,d.animalB);d.animalA.currentTime=u?u:0;d.animalB.currentTime=v?v:0;d.update(0)};d.update=function(h){if(d.mesh._modelViewMatrix){var o,t=["animalA","animalB"],u,v,w,x,y,C;u=0;v=t.length;for(C=0;u<v;u++){o=d[t[u]];y=o.currentTime;o.currentTime=(o.currentTime+h*o.timeScale)%o.lengthInMS;if(y>o.currentTime)o.currentFrame=0;y=0;w=o.currentFrame;for(x=o.lengthInFrames-1;w<x;w++)if(o.currentTime>=o.frames[w].time&&o.currentTime<o.frames[w+1].time){y=w;break}o.currentFrame=
y;w=y+1<x?y+1:0;g[C++]=o.frames[y].index;g[C++]=o.frames[w].index;y=o.frames[y].time;w=o.frames[w].time>y?o.frames[w].time:o.frames[w].time+o.lengthInMS;o=(o.currentTime-y)/(w-y);m.uniforms[t[u]+"Interpolation"].value=o}m.uniforms.animalMorphValue.value=d.morph;if(m.attributes[d.animalA.name]!==undefined)m.attributes.colorAnimalA.buffer=m.attributes[d.animalA.name].buffer;if(m.attributes[d.animalB.name]!==undefined)m.attributes.colorAnimalB.buffer=m.attributes[d.animalB.name].buffer}};d.setNewTargetAnimal=
function(h,o){if(d.morph===1){for(var t in d.animalA)d.animalA[t]=d.animalB[t];d.animalB.currentTime=o?o:0;n(h,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var n=function(h,o){if(ROME.AnimalAnimationData[h]!==undefined){o.frames=ROME.AnimalAnimationData[h];o.lengthInFrames=o.frames.length;o.lengthInMS=o.frames[o.lengthInFrames-1].time;o.name=h.toLowerCase();o.normalsOffset=Math.floor(o.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
h)};return d};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 1.0 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 ) * vec4( 0.9, 0.85, 0.8, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["tarbuffalo","bearbrown","horse","deer","mountainlion","goldenRetreiver","fox","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","blackWidow","crab","scorp","goat","gator","tarbuffalo_runB","tarbuffalo","wolf","panther","bearblack","toad","eagle","owl","parrot","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD","raven",
"vulture","bison","sickle","armHand","sickle","centipede","shdw2","shdw5","drownArm_A","drownArm_C"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.15,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},blackWidow:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,
vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.45},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:-0.1},cow:{hRange:0,sRange:0,
vRange:0.2,hOffset:0,sOffset:0.05,vOffset:-0.25},cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,sRange:0,vRange:0.15,hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},
flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},frog:{hRange:0.05,sRange:0.1,vRange:0.25,hOffset:0.01,sOffset:0.05,vOffset:-0.1},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.26},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,
sRange:0.1,vRange:0.25,hOffset:-0.0050,sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},moose:{hRange:0.07,sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.0050,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.16},parrot:{hRange:0.05,sRange:0.1,
vRange:0.3,hOffset:-0.025,sOffset:0.1,vOffset:-0.1},raccoon:{hRange:0,sRange:0.1,vRange:0.25,hOffset:0.6,sOffset:-0.1,vOffset:-0.2},raven:{hRange:0.02,sRange:0.1,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.15},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:-0.1},shdw2:{hRange:0,sRange:0.1,vRange:0.06,hOffset:0,sOffset:-0.05,vOffset:-0.15},sickle:{hRange:0.04,sRange:0,vRange:0.1,hOffset:0,sOffset:-0.2,vOffset:-0.3},
stork:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.175},toad:{hRange:0.07,sRange:0,vRange:0.1,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.08,hOffset:0,sOffset:-0.1,vOffset:-0.16},wolf:{hRange:0,sRange:0.2,vRange:0.06,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",
bearbrown:"bearBrown",bearblack:"bearBlack",blackwidow:"blackWidow",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",
mountainlion:"mountainlion",panther:"panther",owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,e){if(b.initialized){t=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,morphTargets:!0});
for(m in b.customAttributes){var c=b.customAttributes[m];t.attributes[m]=m==="colorAnimalA"||m==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var d,f,g;t=b.morphTargets;var m,n,h,o;if(e){n=0;for(h=t.length;n<h;n++){m=0;for(g=this.animalNames.length;m<g;m++){f=this.animalNames[m];if(t[n].name.indexOf(f)!==-1)break}if(m===g){f=t[n].name;for(m=0;m<f.length;m++){g=f.charCodeAt(m);if(!(g>=
65&&g<=90||g>=97&&g<=122))break}this.animalNames.push(f.slice(0,m))}}}m=0;for(g=this.animalNames.length;m<g;m++){f=this.animalNames[m];d=this[f];o=0;if(d===undefined||d.length===0){d=this[f]=[];n=0;for(h=t.length;n<h;n++)if(t[n].name.indexOf(f)!==-1){d.push({index:n,time:o});o+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{n=0;for(h=t.length;n<h;n++)c.indexOf(f)===-1&&t[n].name.indexOf(f)!==-1&&c.push(f)}}var t=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:ROME.AnimalShader.attributes(),
vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors}),u;d=b.morphColors;o=t.attributes;if(b.morphColors&&b.morphColors.length){n=0;for(h=d.length;n<h;n++){u=d[n];f=u.name;for(m=0;m<f.length;m++){g=f.charCodeAt(m);if(!(g>=65&&g<=90||g>=97&&g<=122))break}f=f.slice(0,m).toLowerCase();o[f]={type:"c",boundTo:"faces",value:u.colors};m=this.colorVariations.zero;this.animalVariationMap[f]!==undefined&&(m=this.colorVariations[this.animalVariationMap[f]]);
t.uniforms.lightScale.value=m.lScale?m.lScale:0.5;m.lOffset?t.uniforms.lightOffset.value.set(m.lOffset[0],m.lOffset[1],m.lOffset[2]):t.uniforms.lightOffset.value.set(0.6,0.6,0.6);randomizeColors(o[f].value,m)}o.colorAnimalA.value=d[0].colors;o.colorAnimalB.value=d[0].colors;m=0;for(g=c.length;m<g;m++){f=c[m].toLowerCase();n=0;for(h=d.length;n<h;n++){u=d[n].name.toLowerCase();if(u.indexOf(f)!==-1)break}if(n===h){console.error("Animal.constructor: Morph Color missing for animal "+f+". Deploying backup plan.");
o[f]={type:"c",boundTo:"faces",value:[]};n=0;for(h=b.faces.length;n<h;n++)o[f].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");n=0;for(h=b.faces.length;n<h;n++)o.colorAnimalA.value.push(new THREE.Color(16711935));o.colorAnimalB.value=o.colorAnimalA.value;m=0;for(g=c;m<g;m++)o[c[m]]={type:"c",boundTo:"faces",value:o.colorAnimalA.value}}b.availableAnimals=c;b.customAttributes=t.attributes}return{availableAnimals:b.availableAnimals,
material:t}}};function randomizeColors(b,e){var c,d,f,g,m,n;c=0;for(d=b.length;c<d;c++){f=b[c];g=e.hRange*Math.random()+e.hOffset;m=e.sRange*Math.random()+e.sOffset;n=e.vRange*Math.random()+e.vOffset;THREE.ColorUtils.adjustHSV(f,g,m,n)}}
ROME.Animal_old=function(b,e){var c=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader_old.uniforms,vertexShader:ROME.AnimalShader_old.vertex,fragmentShader:ROME.AnimalShader_old.fragment,morphTargets:!0,vertexColors:b.materials[0][0].vertexColors,lights:!0}),d={};d.mesh=new THREE.Mesh(b,c);d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};
d.availableAnimals=ROME.AnimalAnimationData_old.init(b,e);for(var f=!1,g=d.mesh.morphTargetForcedOrder,m,n,h,o,t=0;t<b.faces.length;t++){m=b.faces[t].color;n=0*Math.random()+0;h=0*Math.random()+0;o=0.4*Math.random()+-0.1;THREE.ColorUtils.adjustHSV(m,n,h,o)}d.play=function(v,w,x,y,C){if(!f){f=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}u(v,d.animalA);u(w,d.animalB);d.animalA.currentTime=y?y:0;d.animalB.currentTime=C?C:0;d.update(0)};d.update=function(v){var w,x=["animalA","animalB"],y,C,B,H,
z,E;y=0;C=x.length;for(E=0;y<C;y++){w=d[x[y]];z=w.currentTime;w.currentTime=(w.currentTime+v*w.timeScale)%w.lengthInMS;if(z>w.currentTime)w.currentFrame=0;z=0;B=w.currentFrame;for(H=w.lengthInFrames-1;B<H;B++)if(w.currentTime>=w.frames[B].time&&w.currentTime<w.frames[B+1].time){z=B;break}w.currentFrame=z;B=z+1<H?z+1:0;g[E++]=w.frames[z].index;g[E++]=w.frames[B].index;z=w.frames[z].time;B=w.frames[B].time>z?w.frames[B].time:w.frames[B].time+w.lengthInMS;w=(w.currentTime-z)/(B-z);c.uniforms[x[y]+"Interpolation"].value=
w}c.uniforms.animalMorphValue.value=d.morph};d.setNewTargetAnimal=function(v,w){if(d.morph===1){for(var x in d.animalA)d.animalA[x]=d.animalB[x];d.animalB.currentTime=w?w:0;u(v,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var u=function(v,w){if(ROME.AnimalAnimationData_old[v]!==undefined){w.frames=ROME.AnimalAnimationData_old[v];w.lengthInFrames=w.frames.length;w.lengthInMS=w.frames[w.lengthInFrames-1].time}else console.log("Error: Couldn't find data for animal "+
v)};return d};
ROME.AnimalShader_old={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0}}]),vertex:["uniform float\tanimalAInterpolation;\nuniform float\tanimalBInterpolation;\nuniform float\tanimalMorphValue;\nvarying vec3 \tvLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,
THREE.ShaderChunk.color_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"vec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragment:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,
THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData_old={animalNames:["sockPuppet_jump","sockPuppet_popUp"],init:function(b,e){var c=[],d,f,g=b.morphTargets,m,n,h,o,t;if(e){h=0;for(o=g.length;h<o;h++){m=0;for(n=this.animalNames.length;m<n;m++){f=this.animalNames[m];if(g[h].name.indexOf(f)!==-1)break}if(m===n){f=g[h].name;for(m=0;n<f.length;m++){d=f.charCodeAt(m);if(!(d>=65&&d<=90||d>=97&&d<=122))break}this.animalNames.push(f.slice(0,m))}}}m=0;for(n=this.animalNames.length;m<n;m++){f=this.animalNames[m];d=this[f];t=0;if(d===
undefined||d.length===0){d=this[f]=[];h=0;for(o=g.length;h<o;h++)if(g[h].name.indexOf(f)!==-1){d.push({index:h,time:t});t+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{h=0;for(o=g.length;h<o;h++)c.indexOf(f)===-1&&g[h].name.indexOf(f)!==-1&&c.push(f)}}return c}};
var Ribbons=function(b,e,c,d){var f=this,g=[],m=[];f.initSettings={numOfRibbons:b||6};f.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var n=0,h;for(h=0;h<f.initSettings.numOfRibbons;++h){var o=new Ribbon(15,6,e.length-20),t=new THREE.Mesh(o,d[h%d.length]);t.dynamic=!0;t.doubleSided=!0;t.position.set(0,-500,0);c.addObject(t);g.push({r:o,rm:t,offset:3+Math.floor(Math.random()*10)});m.push(t)}this.update=function(u){n+=0.1;for(h=0;h<e.length;++h)for(var v=
e[h].position.x,w=e[h].position.y,x=e[h].position.z,y=0;y<b;++y){var C=g[y].r,B=g[y].offset;if(!(h<B)){var H=Math.cos((h-n*10)/10)*f.settings.ribbonPulseMultiplier_1,z=Math.cos((h-n*10)/8)*f.settings.ribbonPulseMultiplier_2,E=y*(Math.PI*2/g.length),F=Math.cos(E+(h-n*10)/8)*H;H*=Math.sin(E+(h-n*10)/8);for(E=0;E<2;++E){var D=(h-B)*2+E;if(C.vertices[D]!=undefined){var T=h-n*2,W=Math.max(f.settings.ribbonMin,h/(10+z));W=Math.min(W,f.settings.ribbonMax);var U=Math.cos(T/3)*W;T=Math.sin(T/3)*W;C.vertices[D].position.x=
v-u.x+U+F;if(E==0){C.vertices[D].position.y=w+T+H-u.y;C.vertices[D].position.z=x+U+F-u.z}else{C.vertices[D].position.y=w-T+H-u.y;C.vertices[D].position.z=x-U+F-u.z}}}}}for(h=0;h<g.length;++h){v=g[h].rm;v.position=u;C=g[h].r;C.__dirtyVertices=!0;v.visible=f.settings.visible}}},Vectors=function(b,e,c,d){var f=this;f.array=[];var g;f.initSettings={length:b||50};f.settings={divider:e||4,normaldivider:c||10,absoluteTrail:!1,startPosition:d||new THREE.Vector3(0,0,0)};for(g=0;g<f.initSettings.length;++g){b=
new THREE.Vector3(0,0,0);b.copy(f.settings.startPosition);b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};f.array.push(b)}this.update=function(m,n){for(g=0;g<f.initSettings.length;++g){var h=f.array[g];if(g==0)var o=m.x,t=m.y,u=m.z,v=n.x,w=n.y,x=n.z;else{o=f.array[g-1].lastposition.x;t=f.array[g-1].lastposition.y;u=f.array[g-1].lastposition.z;v=f.array[g-1].normal.x;w=f.array[g-1].normal.y;x=f.array[g-1].normal.z}f.array[g].lastposition.x=h.position.x;
f.array[g].lastposition.y=h.position.y;f.array[g].lastposition.z=h.position.z;if(f.settings.absoluteTrail){h.position.x=o;h.position.y=t;h.position.z=u;h.normal.x=v;h.normal.y=w;h.normal.z=x}else{t=(t-h.position.y)/f.settings.divider;u=(u-h.position.z)/f.settings.divider;h.position.x+=(o-h.position.x)/f.settings.divider;h.position.y+=t;h.position.z+=u;o=(w-h.normal.y)/f.settings.normaldivider;x=(x-h.normal.z)/f.settings.normaldivider;h.normal.x+=(v-h.normal.x)/f.settings.normaldivider;h.normal.y+=
o;h.normal.z+=x}}};this.reset=function(m,n,h){for(var o=0;o<f.array.length;++o){var t=f.array[o];t.position.x=m;t.position.y=n;t.position.z=h}}},Particles=function(b,e,c,d,f,g,m){var n=this,h=[];m=m||THREE.NormalBlending;n.initSettings={numOfParticleSystems:b||25,numInSystem:f||60,spread:g||50,particleSize:c||8};n.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var o;c=new THREE.Geometry;for(o=0;o<n.initSettings.numInSystem;o++){f=new THREE.Vector3(Math.random()*n.initSettings.spread-
n.initSettings.spread/2,Math.random()*n.initSettings.spread-n.initSettings.spread/2,Math.random()*n.initSettings.spread-n.initSettings.spread/2);c.vertices.push(new THREE.Vertex(f))}for(o=0;o<n.initSettings.numOfParticleSystems;o++){f=new THREE.ParticleBasicMaterial({size:n.initSettings.particleSize,map:d[o%d.length],transparent:!0,depthTest:!0,blending:m});f=new THREE.ParticleSystem(c,f);f.rotation.x=Math.random()*Math.PI;f.rotation.y=Math.random()*Math.PI;f.rotation.z=Math.random()*Math.PI;h.push({c:f,
alivetime:o});e.addObject(f)}this.update=function(t,u,v){if(isNaN(t)||t>1E3)t=1E3/60;t/=60;for(o=0;o<b;++o){var w=h[o].c;h[o].alivetime+=t/n.settings.aliveDivider;if(h[o].alivetime>=b){h[o].alivetime=0;w.scale.x=w.scale.y=w.scale.z=0.5;w.position.x=u.x;w.position.y=u.y;w.position.z=u.z;if(n.settings.gravitateTowardsCamera){var x=-100;u.x>v.x&&(x=100);h[o].c.tox=u.x-x;h[o].c.toy=0;h[o].c.toz=u.z-100;x=w.position.x-h[o].c.tox;var y=w.position.y-h[o].c.toy,C=w.position.z-h[o].c.toz;x=1E3+Math.abs(x*
x+y*y+C*C)/25;w.position.y=u.y+50;w.rotation.x=Math.random()*Math.PI+Math.PI/2;w.rotation.y=Math.random()*Math.PI;w.rotation.z=Math.random()*Math.PI+Math.PI/2;w.scale.x=w.scale.y=w.scale.z=1.25;(new TWEEN.Tween(w.position)).to({x:h[o].c.tox,y:h[o].c.toy,z:h[o].c.toz},x).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(w.rotation)).to({x:0,z:0},x).easing(TWEEN.Easing.Quadratic.EaseIn).start();(new TWEEN.Tween(w.scale)).to({x:5,y:0.05,z:5},x).easing(TWEEN.Easing.Linear.EaseNone).start()}w.materials[0].opacity=
n.settings.zeroAlphaStart?0:1}else{x=h[o].alivetime;if(!n.settings.gravitateTowardsCamera){w.position.y+=0.1;w.rotation.y+=0.015;w.rotation.z+=0.01;w.scale.x=w.scale.y=w.scale.z=0.5+Math.max(x/15,1)}x=n.settings.zeroAlphaStart?x/4:1-x/(h.length*2);x=Math.min(x,1);w.materials[0].opacity=x}}};this.reset=function(t,u,v){for(var w=0;w<h.length;++w){var x=h[w].c;x.position.x=t;x.position.y=u;x.position.z=v}}},AnimalSwarm=function(b,e){var c=this;c.array=[];new THREE.Vector3;var d=0;c.initSettings={numOfAnimals:b||
30};c.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1,respawn:!0,avoidCamera:!1,killAtDistance:!1};var f;this.addAnimal=function(g,m,n,h,o,t){m=m||null;var u=n||1.2;h=h||null;for(f=0;f<c.initSettings.numOfAnimals;++f)if(!(m==null&&c.array[f]!=undefined||m!=c.array[f])){o==null&&(o=[1]);var v=t?ROME.Animal_old(g,!1):ROME.Animal(g,
!1),w=v.mesh;w.position.copy(c.settings.startPosition);n=0.02+Math.random()/8;f<2&&(n=0.15);n=Math.max(n,0.1);w.matrixAutoUpdate=!1;w.visible=!1;e.addChild(w);var x=0,y=0;if(h!=null){x=h[f%h.length]%v.availableAnimals.length;y=x+1;if(Math.round(Math.random())==1&&x>0||y>v.availableAnimals.length-1)y=x-1}var C=o[x],B=o[y];v.play(v.availableAnimals[x],v.availableAnimals[y],0,Math.random(),Math.random());var H=Math.random();f<2&&(H=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);n={c:w,
a:v,f:f,keepRunning:!1,time:0,lifetime:0,dead:!1,startMorph:x,endMorph:y,speeda:C,speedb:B,toPosition:new THREE.Vector3,active:!1,normal:new THREE.Vector3(0,1,0),count:H,scale:n*u,origscale:n*u,ray:ray,rayIndex:f%2,lastToy:0,sockPuppetSpecialCase:t,generalSpecialCase:!1};c.array[f]=n}return v};this.removeAnimal=function(g,m){for(f=0;f<c.initSettings.numOfAnimals;++f){var n=c.array[f].a;if(n!=undefined){var h=c.array[f].startMorph,o=c.array[f].endMorph;if(n.mesh.geometry==g&&(m==h||m==o)){e.removeChild(c.array[f].c);
delete c.array[f].a;c.array[f].active=!1;break}}}};this.switchAnimal=function(g,m,n,h,o){var t=m||1.2;for(f=0;f<c.initSettings.numOfAnimals;++f){o!=undefined&&(f=o);m=c.array[f].a;var u=c.array[f].startMorph,v=c.array[f].endMorph;if(!(m!=undefined&&m.mesh.geometry==g&&o==undefined&&(u==h||v==h))){console.log("adding on "+f);o=c.array[f].c.position;g=ROME.Animal(g,!1);u=g.mesh;m=0.02+Math.random()/8;f<2&&(m=0.15);m=Math.max(m,0.1);u.position=o;u.visible=!1;u.scale.set(1.0E-5,1.0E-5,1.0E-5);u.updateMatrix();
u.matrixAutoUpdate=!1;e.removeChild(c.array[f].c);e.addChild(u);g.play(g.availableAnimals[h],g.availableAnimals[h],0,Math.random(),Math.random());c.array[f].c=u;c.array[f].a=g;c.array[f].scale=m*t;c.array[f].origscale=m*t;c.array[f].speeda=n;c.array[f].speedb=n;c.array[f].active=!1;c.array[f].startMorph=h;c.array[f].endMorph=h;break}}};this.create=function(g,m,n){for(f=0;f<c.initSettings.numOfAnimals;++f)if(!(c.array[f].active||c.array[f].a==undefined)){c.array[f].active=!0;c.array[f].c.position.copy(g);
c.array[f].normal.copy(m);c.array[f].c.visible=!0;c.array[f].f=0;c.array[f].time=0;c.array[f].lifetime=0;c.array[f].dead=!1;c.array[f].scale=c.array[f].origscale;c.array[f].keepRunning=!1;c.array[f].gravity=0;c.array[f].count=1;if(!c.settings.respawn)c.array[f].f=f;if(n!=undefined){c.array[f].keepRunning=!0;c.array[f].toPosition.copy(n)}c.array[f].scale*=0.25;(new TWEEN.Tween(c.array[f])).to({scale:c.array[f].origscale},400).easing(TWEEN.Easing.Linear.EaseNone).start();g=180;n!=undefined&&(g=350);
n=c.array[f].origscale;c.array[f].c.position.x-=m.x*n*g;c.array[f].c.position.y-=m.y*n*g;c.array[f].c.position.z-=m.z*n*g;c.array[f].lastToy=c.array[f].c.position.y;break}};this.update=function(g,m,n){if(isNaN(g)||g>1E3||g==0)g=1E3/60;++d;for(f=0;f<c.initSettings.numOfAnimals;++f){var h=c.array[f];if(h.active){m=h.c;var o=h.scale,t=h.normal,u=c.array[f].dead;c.array[f].time+=g;c.array[f].lifetime+=g;if(c.array[f].lifetime>2500&&c.settings.respawn)c.array[f].dead=!0;c.array[f].count+=0.06;var v=Math.max(Math.cos(c.array[f].count)-
0.5,0);v=Math.min(v,1);c.array[f].a.morph=v;var w=h.speeda;if(Math.round(v)==1)w=h.speedb;v=m.position.x+c.array[f].toPosition.x*20;var x=m.position.y+c.array[f].toPosition.y*20,y=m.position.z+c.array[f].toPosition.z*20;if(c.settings.capy!=null&&x<c.settings.capy)x=c.settings.capy;if(c.settings.flying){c.array[f].toPosition.y+=0.12;x=c.array[f].toPosition.y+c.settings.flyingDistance}if(c.settings.constantSpeed!=null){c.array[f].a.animalA.timeScale=c.settings.constantSpeed;c.array[f].a.animalB.timeScale=
c.settings.constantSpeed}if(c.settings.shootRayDown)if(c.array[f].rayIndex==d%2){h=h.ray;h.origin.copy(m.position);h.origin.y+=500;var C=e.collisions.rayCastNearest(h);if(C){x=h.origin.y-(C.distance*1+3);t=C.mesh.matrixRotationWorld.multiplyVector3(C.normal).normalize();c.array[f].lastToy=x;c.array[f].normal.copy(t)}}else x=c.array[f].lastToy;C=h=17;if(c.array[f].keepRunning){h=4;C=Math.abs(x-m.position.y)>10?h/2:h*2}c.settings.flying&&(C=8);if(c.array[f].dead){if(c.settings.flying)x+=10;else{x-=
t.y*3;v-=t.x*3;y-=t.z*3}C=20}v=(v-m.position.x)/h;x=(x-m.position.y)/C;y=(y-m.position.z)/h;if(c.settings.killAtDistance){h=m.position.x-n.x;C=m.position.y-n.y;var B=m.position.z-n.z;if(Math.abs(h*h+C*C+B*B)>25E3)c.array[f].dead=!0}c.array[f].dead&&!u&&(new TWEEN.Tween(c.array[f])).to({scale:c.array[f].scale*0.01},600).easing(TWEEN.Easing.Quartic.EaseIn).start();if(c.array[f].dead&&o<=0.0050){c.array[f].active=!1;c.array[f].c.visible=!1}else{u=w/20;isNaN(u)&&(u=1);if(!c.array[f].keepRunning){x>u&&
(x=u);x<-u&&(x=-u)}v>u&&(v=u);v<-u&&(v=-u);y>u&&(y=u);y<-u&&(y=-u);u=new THREE.Vector3(m.position.x+v,m.position.y+x,m.position.z+y);u.subSelf(m.position).normalize();w=new THREE.Vector3;t=new THREE.Vector3(t.x*-1,t.y*-1,t.z*-1);if(c.settings.flying||c.settings.gravity)t=new THREE.Vector3(0,-1,0);w.cross(u,t);t.cross(u,w);m.matrixWorld.n11=w.x*o;m.matrixWorld.n12=t.x*o;m.matrixWorld.n13=u.x*o;m.matrixWorld.n14=m.position.x;m.matrixWorld.n21=w.y*o;m.matrixWorld.n22=t.y*o;m.matrixWorld.n23=u.y*o;m.matrixWorld.n24=
m.position.y;m.matrixWorld.n31=w.z*o;m.matrixWorld.n32=t.z*o;m.matrixWorld.n33=u.z*o;m.matrixWorld.n34=m.position.z;m.position.x+=v;m.position.y+=x;m.position.z+=y}}}};this.reset=function(g,m,n){for(var h=0;h<c.initSettings.numOfAnimals;++h){var o=c.array[h].c;o.position.x=g;o.position.y=m;o.position.z=n;c.array[h].active=!1}}},AnimalSwarm2=function(b,e){var c=this;c.array=[];new THREE.Vector3;c.initSettings={numOfAnimals:b||30};c.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:25,
zPositionMultiplier:25,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var d;this.addAnimal=function(f,g,m,n,h,o){g=g||null;var t=m||1.2;n=n||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(g==null&&c.array[d]!=undefined||g!=c.array[d])){h==null&&(h=[1]);var u=o?ROME.Animal_old(f,!1):ROME.Animal(f,!1),v=u.mesh;v.position.copy(c.settings.startPosition);m=0.02+Math.random()/8;d<2&&(m=0.15);m=Math.max(m,0.1);v.matrixAutoUpdate=
!1;v.visible=!1;e.addChild(v);var w=0,x=0;if(n!=null){w=n[d%n.length]%u.availableAnimals.length;x=Math.floor(Math.random()*u.availableAnimals.length)}var y=h[w],C=h[x];u.play(u.availableAnimals[w],u.availableAnimals[x],0,Math.random(),Math.random());w=Math.random();d<2&&(w=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);m={c:v,a:u,positionArray:[],normalArray:[],lifetime:0,dead:!1,speeda:y,speedb:C,active:!1,normal:new THREE.Vector3(0,1,0),toNormal:new THREE.Vector3(0,1,0),toPosition:new THREE.Vector3,
count:w,scale:m*t,origscale:m*t,ray:ray,sockPuppetSpecialCase:o};c.array[d]=m}};this.create=function(f,g,m){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=!0;c.array[d].c.position.copy(f);c.array[d].toNormal.copy(g);c.array[d].c.visible=!0;c.array[d].toPosition.copy(m);c.array[d].scale=0.01;c.array[d].positionArray=[];c.array[d].normalArray=[g];c.array[d].lifetime=0;c.array[d].dead=!1;if(c.settings.flying){c.array[d].toNormal.set(0,1,0);c.array[d].normal.set(0,
1,0)}(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},300).easing(TWEEN.Easing.Linear.EaseNone).start();f=c.array[d].origscale;c.array[d].c.position.x-=g.x*f*100;c.array[d].c.position.y-=g.y*f*100;c.array[d].c.position.z-=g.z*f*100;break}};this.update=function(f,g,m,n){if(isNaN(f)||f>1E3||f==0)f=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var h=c.array[d];if(h.active){c.array[d].positionArray.push(m);c.array[d].normalArray.push(n);var o=c.array[d].positionArray,t=h.c,u=h.scale,
v=h.toNormal,w=h.normal,x=h.toPosition,y=c.array[d].dead;c.array[d].lifetime+=f;if(c.array[d].lifetime>2500)c.array[d].dead=!0;var C=d*(Math.PI*2/6),B=Math.sin(C+(d-0)/8)*c.settings.zPositionMultiplier;C=x.x+Math.cos(C+(d-0)/8)*c.settings.xPositionMultiplier*(1-Math.abs(w.x));var H=x.y+B*(1-Math.abs(w.y));B=x.z+B*(1-Math.abs(w.z));w.y>0.5&&(H=x.y-10);if(c.settings.capy!=null&&H<c.settings.capy)H=c.settings.capy;if(c.settings.flying){x=c.settings.flyingDistance;w.x<-0.8&&(C-=x);w.x>0.8&&(C+=x);if(w.y<
-0.8||w.y>0.8)H+=x;w.z<-0.8&&(B-=x);w.z>0.8&&(B+=x)}c.array[d].count+=0.04;var z=Math.max(Math.cos(c.array[d].count),0);z=Math.min(z,1);c.array[d].a.morph=z;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}x=h.speeda;if(Math.round(z)==1)x=h.speedb;z=8;c.array[d].sockPuppetSpecialCase&&(z=100);C=(C-t.position.x)/z;H=(H-t.position.y)/z;B=(B-t.position.z)/z;var E=(v.y-w.y)/z,F=(v.z-w.z)/z;w.x+=(v.x-w.x)/
z;w.y+=E;w.z+=F;h.normal=w;v=x;H>v&&(H=v);H<-v&&(H=-v);C>v&&(C=v);C<-v&&(C=-v);B>v&&(B=v);B<-v&&(B=-v);if(c.array[d].dead)if(c.settings.flying)H+=2;else{H-=w.y*2;C-=w.x*2;B-=w.z*2}if(t.position.x+C<g.x+40&&t.position.x+C>g.x-40&&t.position.z+B<g.z+40&&t.position.z+B>g.z-40)c.array[d].dead=!0;c.array[d].dead&&!y&&(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].scale*0.1},400).easing(TWEEN.Easing.Linear.EaseNone).start();if(c.array[d].dead&&u<=0.1){c.array[d].active=!1;c.array[d].c.visible=!1}else{y=
new THREE.Vector3(t.position.x+C,t.position.y+H,t.position.z+B);y.subSelf(t.position).normalize();v=new THREE.Vector3;w=new THREE.Vector3(w.x*-1,w.y*-1,w.z*-1);c.settings.flying&&(w=new THREE.Vector3(0,-1,0));v.cross(y,w);w.cross(y,v);t.matrixWorld.n11=v.x*u;t.matrixWorld.n12=w.x*u;t.matrixWorld.n13=y.x*u;t.matrixWorld.n14=t.position.x;t.matrixWorld.n21=v.y*u;t.matrixWorld.n22=w.y*u;t.matrixWorld.n23=y.y*u;t.matrixWorld.n24=t.position.y;t.matrixWorld.n31=v.z*u;t.matrixWorld.n32=w.z*u;t.matrixWorld.n33=
y.z*u;t.matrixWorld.n34=t.position.z;u=t.position.x-(t.position.x+C);w=t.position.y-(t.position.y+H);y=t.position.z-(t.position.z+B);if(Math.abs(u*u+w*w+y*y)<f/4&&o!=null&&o.length>0){o=c.array[d].positionArray.shift();u=c.array[d].normalArray.shift();h.toPosition.copy(o);h.toNormal.copy(u)}t.position.x+=C;t.position.y+=H;t.position.z+=B}}}};this.reset=function(f,g,m){for(var n=0;n<c.array.length;++n){var h=c.array[n].c;h.position.x=f;h.position.y=g;h.position.z=m;c.array[n].active=!1}}},AnimalSwarm_dunes=
function(b,e,c){var d=this;d.array=[];var f=0,g=0,m=0;d.initSettings={numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var n=0,h;this.addAnimal=function(o,t,u,v,w,x,y){t=t||null;var C=u||1.2;v=v||null;w=w||4;y=y||!1;for(h=0;h<d.initSettings.numOfAnimals;++h)if(!(t==null&&d.array[h]!=undefined||t!=d.array[h])){u=
new THREE.Color(Math.random()*16777215);x!=undefined&&x!=null&&(u=x[h%x.length]);var B=ROME.Animal(o,!1,u),H=B.mesh;H.position.set(d.settings.startPosition.x,d.settings.startPosition.y,d.settings.startPosition.z);H.updateMatrix();H.doubleSided=y;var z=Math.floor(h/w);u=0.02+Math.random()/8;if(h<2){u=0.15;z=h}z>f&&(f=z);u=Math.max(u,0.1);H.matrixAutoUpdate=!1;e.addChild(H);var E=0,F=0;if(v!=null){E=v[h%v.length]%B.availableAnimals.length;F=Math.floor(Math.random()*B.availableAnimals.length)}B.play(B.availableAnimals[E],
B.availableAnimals[F],0,Math.random(),Math.random());E=Math.random();h<2&&(E=0);F=h%2==0;ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);d.array[h]={c:H,a:B,f:z,count:E,clockwise:F,scale:u*C,ray:ray}}return B};this.update=function(o){n+=0.1;isNaN(o);g=Math.round(n/4);for(h=0;h<d.initSettings.numOfAnimals;++h){var t=d.array[h];o=t.c;var u=t.f,v=t.scale;t=t.clockwise;if(g!=m&&d.settings.switchPosition){if(t)++d.array[h].f;else--d.array[h].f;if(d.array[h].f>f){d.array[h].clockwise=!1;d.array[h].f=
f}if(d.array[h].f<=0){d.array[h].clockwise=!0;d.array[h].f=0}u=d.array[h].f}t=h*(Math.PI*2/6);var w=Math.sin(t+(h-n*2)/5)*d.settings.zPositionMultiplier;t=c[u].position.x+Math.cos(t+(h-n*2)/5)*d.settings.xPositionMultiplier;var x=c[u].position.y+w;w=c[u].position.z+w;d.array[h].count+=0.03;var y=Math.max(Math.cos(d.array[h].count),0);y=Math.min(y,1);d.array[h].a.morph=y;if(d.settings.constantSpeed!=null){d.array[h].a.animalA.timeScale=d.settings.constantSpeed;d.array[h].a.animalB.timeScale=d.settings.constantSpeed}t=
(t-o.position.x)/10;x=(x-o.position.y)/10;w=(w-o.position.z)/10;y=new THREE.Vector3(o.position.x+t,o.position.y+x,o.position.z+w);y.subSelf(o.position).normalize();var C=new THREE.Vector3;u=new THREE.Vector3(c[u].normal.x*-1,c[u].normal.y*-1,c[u].normal.z*-1);d.settings.flying&&(u=new THREE.Vector3(0,-1,0));C.cross(y,u);u.cross(y,C);o.matrixWorld.n11=C.x*v;o.matrixWorld.n12=u.x*v;o.matrixWorld.n13=y.x*v;o.matrixWorld.n14=o.position.x;o.matrixWorld.n21=C.y*v;o.matrixWorld.n22=u.y*v;o.matrixWorld.n23=
y.y*v;o.matrixWorld.n24=o.position.y;o.matrixWorld.n31=C.z*v;o.matrixWorld.n32=u.z*v;o.matrixWorld.n33=y.z*v;o.matrixWorld.n34=o.position.z;o.position.x+=t;o.position.y+=x;o.position.z+=w;o.visible=d.settings.visible}m=g};this.reset=function(o,t,u){for(var v=0;v<d.array.length;++v){var w=d.array[v].c;w.position.x=o;w.position.y=t;w.position.z=u}}},AnimalInFrontOfCamera=function(b,e){var c=this,d=[];c.initSettings={numOfAnimals:b||30};c.settings={};var f=0,g,m=new THREE.Cube(10,10,10),n=new THREE.Mesh(m);
e.addChild(n);this.addAnimal=function(h){for(var o=0;o<c.initSettings.numOfAnimals;++o){var t=ROME.Animal(h,!1),u=t.mesh,v=0.02+Math.random()/8,w=Math.random()*120-60,x=o*10-10,y=Math.random()*120-60;u.position.x=w;u.position.y=x;u.position.z=y;n.addChild(u);t.animalA.timeScale=0.8;t.animalB.timeScale=0.8;t.play(t.availableAnimals[0],t.availableAnimals[0],0,Math.random());d.push({c:u,x:w,y:x,z:y,a:t,scale:v*1.5})}};this.update=function(h,o,t,u){f+=0.1;n.position=h;if(!u){n.position.x-=Math.cos(o)*
110;n.position.z-=Math.sin(o)*110}if(isNaN(t)||t>1E3)t=1E3/60;for(g=0;g<c.initSettings.numOfAnimals;++g){var v=d[g];h=v.c;o=v.x;u=v.y;v=v.z;var w=Math.sin(g-f);o+=Math.cos(g-f);u+=0.5*(t/20);v+=w;u>140&&(u=-10);h.lookAt(new THREE.Vector3(o,u,v));h.position.x=o;h.position.y=u;h.position.z=v;d[g].x=o;d[g].y=u;d[g].z=v}}},Trail=function(b,e){var c=this;c.array=[];var d=!1,f=0,g=new THREE.Ray;g.direction=new THREE.Vector3(0,-1,0);c.initSettings={numOfInstances:b||100};c.settings={spread:70,visible:!0,
aliveDivider:c.initSettings.numOfInstances,tweenTime:2500,scale:1,offsetAmount:6,freeRotation:!0,yscale:0.3,shootRayDown:!1};var m;this.addInstance=function(n,h,o,t,u){h=h||null;o=o||!1;t=t||!1;for(m=0;m<c.initSettings.numOfInstances;++m)if(!(h==null&&c.array[m]!=undefined||h!=c.array[m])){var v=u==undefined?new THREE.Mesh(n,new THREE.MeshFaceMaterial):new THREE.Mesh(n,u[m%u.length]);v.scale.x=v.scale.y=v.scale.z=1.0E-8;var w={c:v,alivetime:m,normal:new THREE.Vector3,tree:o,lightHouse:t};e.addObject(v);
c.array[m]=w}return v};this.update=function(n,h,o,t){if(isNaN(t)||t>1E3)t=1E3/60;f+=t;t/=c.settings.aliveDivider;for(m=0;m<c.array.length;++m){var u=c.array[m],v=u.c,w=u.alivetime,x=u.tree;u=u.lightHouse;w+=t;if(w>c.initSettings.numOfInstances){if(u&&(d||f<4E3))continue;v.position.x=n.x;v.position.y=n.y;v.position.z=n.z;v.rotation.x=0;v.rotation.z=0;v.rotation.y=0;w=c.settings.offsetAmount;x&&(w=c.settings.offsetAmount+2);var y=0,C=0,B=0;if(c.settings.freeRotation){if(c.settings.shootRayDown){g.origin.copy(n);
g.origin.y+=100;var H=e.collisions.rayCastNearest(g);if(H){v.position.y=g.origin.y-(H.distance*0.15+w);h.set(0,1,0)}}v.position.x=n.x-h.x*w;if(!c.settings.shootRayDown)v.position.y=n.y-h.y*w;v.position.z=n.z-h.z*w;v.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(h.x));v.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(h.z));v.rotation.x=0;v.rotation.z=0;v.rotation.y=Math.random()*Math.PI;v.up.copy(h);v.lookAt(v.position)}else{if(h.x<-0.5){v.position.x=
n.x+w/2;v.rotation.z=1.57;v.rotation.x=Math.random()*Math.PI;if(x){B=v.rotation.z+(Math.random()-0.5);v.rotation.z=0;y=v.rotation.x;C=v.rotation.y}v.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.x>0.5){v.position.x=n.x-w/2;v.rotation.z=-1.57;if(x){B=v.rotation.z+(Math.random()-0.5);v.rotation.z=0;y=v.rotation.x;C=v.rotation.y}v.rotation.x=Math.random()*Math.PI;v.position.y+=Math.random()*c.settings.spread-c.settings.spread/
2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.y<-0.9){v.position.y=n.y+w;v.rotation.y=Math.random()*Math.PI;if(x){B=v.rotation.z+(Math.random()-0.5);v.rotation.z=1.57;y=v.rotation.x;C=v.rotation.y}v.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.y>0.9){v.position.y=n.y-w;v.rotation.y=Math.random()*Math.PI;if(x){B+=v.rotation.z+(Math.random()-0.5);v.rotation.z=1.57;y=v.rotation.x;C=v.rotation.y}v.position.x+=
Math.random()*c.settings.spread-c.settings.spread/2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.z<-0.5){v.position.z=n.z+w/2;v.rotation.x=-1.57;v.rotation.y=Math.random()*Math.PI;if(x){y=v.rotation.x+(Math.random()-0.5);v.rotation.x=0;B=v.rotation.z;C=v.rotation.y}v.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}if(h.z>0.5){v.position.z=n.z-w/2;v.rotation.x=1.57;v.rotation.y=Math.random()*
Math.PI;if(x){y=v.rotation.x+(Math.random()-0.5);v.rotation.x=0;B=v.rotation.z;C=v.rotation.y}v.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}}x&&(new TWEEN.Tween(v.rotation)).to({x:y,y:C,z:B},c.settings.tweenTime*2).easing(TWEEN.Easing.Elastic.EaseOut).start();if((x||u)&&v.position.x<o.x+60&&v.position.x>o.x-60){v.position.x=o.x+60;if(v.position.x<o.x)v.position.x=o.x-60}if((x||u)&&v.position.z<o.z+60&&v.position.z>
o.z-60){v.position.z=o.z+60;if(v.position.z<o.z)v.position.z=o.z-60}v.scale.x=v.scale.y=v.scale.z=0.0010*c.settings.scale;w=zscale=yscale=0.1*c.settings.scale;if(u){w=zscale=yscale=0.4*c.settings.scale;if(Math.abs(h.y)<0.9)continue;else{v.visible=!0;d=!0}}if(!x&&!u){yscale=c.settings.yscale*c.settings.scale;w=zscale=0.4*c.settings.scale}y=TWEEN.Easing.Quintic.EaseOut;if(x||u)y=TWEEN.Easing.Elastic.EaseOut;(new TWEEN.Tween(v.scale)).to({x:w,y:yscale,z:zscale},c.settings.tweenTime).easing(y).start();
w=0}c.array[m].alivetime=w}}},CollisionScene=function(b,e,c,d,f,g){function m(U){U%=B;if(U>C)U-=B;else U<-C&&(U+=B);return U}function n(U,Y,N,p,O,G,L,Q,M){U=new THREE.Mesh(U,M);U.scale.set(Y,Y,Y);U.position.set(N,p,O);U.rotation.set(G,L,Q);U.updateMatrix();h.settings.useOldRay?y.addObject(U):e.addObject(U);return U}var h=this;h.currentNormal=new THREE.Vector3(0,1,0);h.emitterNormal=new THREE.Vector3(0,1,0);h.distance=0;h.initSettings={};h.settings={useOldRay:g||!1,maxSpeedDivider:2,emitterDivider:5,
cameraTargetDivider:10,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:f||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,minDistance:10,camera:b};var o=new THREE.Vector3(0,0,1),t=new THREE.Ray,u=new THREE.Matrix4,v=new THREE.Matrix4,w=new THREE.Vector3,x=new THREE.Projector,y=new THREE.Scene;b=new THREE.Cube(5,5,5);h.emitter=n(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));h.emitterFollow=n(b,1,d.camPos.x,
d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,opacity:0.4}));h.emitter.visible=!1;h.emitterFollow.visible=!1;var C=Math.PI,B=C*2,H=C/180;h.emitterFollow.rotationx=0;h.emitterFollow.rotationy=0;h.emitterFollow.rotationz=0;b=new THREE.Cube(5E4,5E4,10,1,1,1);c=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var z=new THREE.Mesh(b,c),E=new THREE.Mesh(b,c);b=new THREE.Cube(10,5E4,5E4,1,1,1);var F=new THREE.Mesh(b,c),D=new THREE.Mesh(b,c);b=new THREE.Cube(5E4,10,5E4,1,1,
1);var T=new THREE.Mesh(b,c),W=new THREE.Mesh(b,c);if(h.settings.useOldRay){y.addObject(z);y.addObject(E);y.addObject(F);y.addObject(D);y.addObject(T);y.addObject(W)}this.addLoaded=function(U,Y,N,p){var O=new THREE.MeshLambertMaterial({color:16711935,opacity:1});U=new THREE.Mesh(U,O);U.scale.x=U.scale.y=U.scale.z=Y;U.rotation=N||new THREE.Vector3;U.position=p||new THREE.Vector3;y.addObject(U)};this.update=function(U,Y){if(h.settings.useOldRay){D.position.x=U.x+h.settings.collisionDistance;F.position.x=
U.x-h.settings.collisionDistance;D.position.z=U.z;D.position.y=U.y;F.position.z=U.z;F.position.y=U.y;z.position.z=U.z-h.settings.collisionDistance;E.position.z=U.z+h.settings.collisionDistance;z.position.x=U.x;z.position.y=U.y;E.position.x=U.x;E.position.y=U.y;W.position.y=U.y-h.settings.collisionDistance;T.position.y=U.y+h.settings.collisionDistance;W.position.x=U.x;W.position.z=U.z;T.position.x=U.x;T.position.z=U.z;if(h.settings.capBottom!=null&&W.position.y<h.settings.capBottom)W.position.y=h.settings.capBottom;
if(h.settings.capTop!=null&&T.position.y<h.settings.capTop)T.position.y=h.settings.capTop}if(h.settings.useOldRay){var N=new THREE.Vector3(d.mouse.x/d.screenWidth*2-1,-(d.mouse.y/d.screenHeight)*2+1,0.5);x.unprojectVector(N,h.settings.camera);var p=new THREE.Ray(U,N.subSelf(U).normalize()),O=p.intersectScene(y);if(O.length>0)for(var G=0;G<O.length;++G)if((N.z<0?O[G].point.z<U.z:O[G].point.z>U.z)&&O[G].object!=h.emitter&&O[G].object!=h.emitterFollow){h.emitter.position=O[G].point;p=O[G].object.matrixRotationWorld.multiplyVector3(O[G].face.normal.clone());
h.emitterNormal=p;h.currentNormal=p;if(O[G].object==D||O[G].object==z||O[G].object==E||O[G].object==F||O[G].object==T){h.emitterNormal.x=0;h.emitterNormal.y=1;h.emitterNormal.z=0;h.currentNormal.x=0;h.currentNormal.y=1;h.currentNormal.z=0;if(!h.settings.allowFlying)h.emitter.position.y=W.position.y+5}break}}else{o.x=d.mouse.x/d.screenWidth*2-1;o.y=-(d.mouse.y/d.screenHeight)*2+1;o.z=1;t.origin.copy(o);u.copy(h.settings.camera.matrixWorld);u.multiplySelf(THREE.Matrix4.makeInvert(h.settings.camera.projectionMatrix,
v));u.multiplyVector3(t.origin);t.direction.copy(t.origin);t.direction.subSelf(U);if((O=e.collisions.rayCastNearest(t))&&O.distance>h.settings.minDistance){G=O.distance*h.settings.scale;if(G>h.settings.collisionDistance)G=h.settings.collisionDistance}else{O={mesh:D};G=h.settings.collisionDistance}h.distance=G;w.copy(t.origin);w.addSelf(t.direction.multiplyScalar(G));h.emitter.position=w;if(O.normal!=undefined){p=O.mesh.matrixRotationWorld.multiplyVector3(O.normal).normalize();h.currentNormal=p;h.emitterNormal=
p}if(O.mesh==D||O.mesh==z||O.mesh==E||O.mesh==F||O.mesh==T||O.mesh==W){h.currentNormal.set(0,1,0);if(!h.settings.allowFlying&&!h.settings.shootRayDown)h.emitter.position.y=W.position.y;if(h.settings.shootRayDown){t.origin.copy(h.emitter.position);t.direction.set(0,-1,0);if((O=e.collisions.rayCastNearest(t))&&O.distance!==-1){h.emitter.position.y-=O.distance*h.settings.scale;p=O.mesh.matrixRotationWorld.multiplyVector3(O.normal).normalize();h.currentNormal=p}else{h.emitter.position.y=-h.settings.collisionDistance;
h.currentNormal.set(0,1,0)}}}h.emitter.position.x+=h.currentNormal.x*h.settings.normalOffsetAmount;h.emitter.position.y+=h.currentNormal.y*h.settings.normalOffsetAmount;h.emitter.position.z+=h.currentNormal.z*h.settings.normalOffsetAmount}if(isNaN(Y)||Y>1E3||Y==0)Y=1E3/60;O=Y/h.settings.maxSpeedDivider;if(h.settings.useOldRay){if(h.currentNormal.y>0.5||h.currentNormal.y<-0.5){N=p=h.emitterFollow.rotationy/180*C;p+=C*0-C*0*Math.random();var L=h.emitter.position.x;G=h.emitter.position.z;L-=h.emitterFollow.position.x;
var Q=G-h.emitterFollow.position.z;G=Math.sqrt(L*L+Q*Q);L=Math.atan2(Q,L);var M=0;Q=(G-4)/4;Q>1&&(Q=1);Q>0&&(M+=(1-M)*Q*Q);p+=m(L-p)*M;L=p-N;Math.abs(L)>12*H&&(p=N+12*H*(L<0?-1:1));G/=4;G>O&&(G=O);h.emitterFollow.position.x+=Math.cos(p)*G;h.emitterFollow.position.z+=Math.sin(p)*G;h.emitterFollow.rotationy=p/H;p=h.emitter.position.y;p=(p-h.emitterFollow.position.y)/h.settings.emitterDivider;p>O&&(p=O);p<-O&&(p=-O);h.emitterFollow.position.y+=p}if(h.currentNormal.x>0.5||h.currentNormal.x<-0.5){N=p=
h.emitterFollow.rotationx/180*C;p+=C*0-C*0*Math.random();M=h.emitter.position.y;G=h.emitter.position.z;M-=h.emitterFollow.position.y;Q=G-h.emitterFollow.position.z;G=Math.sqrt(Q*Q+M*M);L=Math.atan2(Q,M);M=0;Q=(G-4)/4;Q>1&&(Q=1);Q>0&&(M+=(1-M)*Q*Q);p+=m(L-p)*M;L=p-N;Math.abs(L)>12*H&&(p=N+12*H*(L<0?-1:1));G/=4;G>O&&(G=O);h.emitterFollow.position.y+=Math.cos(p)*G;h.emitterFollow.position.z+=Math.sin(p)*G;h.emitterFollow.rotationx=p/H;G=h.emitter.position.x;G=(G-h.emitterFollow.position.x)/h.settings.emitterDivider;
G>O&&(G=O);G<-O&&(G=-O);h.emitterFollow.position.x+=G}if(h.currentNormal.z>0.5||h.currentNormal.z<-0.5){N=p=h.emitterFollow.rotationz/180*C;p+=C*0-C*0*Math.random();L=h.emitter.position.x;M=h.emitter.position.y;L-=h.emitterFollow.position.x;M-=h.emitterFollow.position.y;G=Math.sqrt(L*L+M*M);L=Math.atan2(L,M);M=0;Q=(G-4)/4;Q>1&&(Q=1);Q>0&&(M+=(1-M)*Q*Q);p+=m(L-p)*M;L=p-N;Math.abs(L)>12*H&&(p=N+12*H*(L<0?-1:1));G/=4;G>O&&(G=O);h.emitterFollow.position.y+=Math.cos(p)*G;h.emitterFollow.position.x+=Math.sin(p)*
G;h.emitterFollow.rotationz=p/H;N=h.emitter.position.z;N=(N-h.emitterFollow.position.z)/h.settings.emitterDivider;N>O&&(N=O);N<-O&&(N=-O);h.emitterFollow.position.z+=N}}else{G=h.emitter.position.x;G=(G-h.emitterFollow.position.x)/h.settings.emitterDivider;p=h.emitter.position.y;p=(p-h.emitterFollow.position.y)/h.settings.emitterDivider;N=h.emitter.position.z;N=(N-h.emitterFollow.position.z)/h.settings.emitterDivider;p>O&&(p=O);p<-O&&(p=-O);G>O&&(G=O);G<-O&&(G=-O);N>O&&(N=O);N<-O&&(N=-O);h.emitterFollow.position.x+=
G;h.emitterFollow.position.y+=p;h.emitterFollow.position.z+=N}if(h.settings.keepEmitterFollowDown&&!h.settings.useOldRay){h.emitterFollow.position.y=h.emitter.position.y+h.settings.collisionDistance;t.origin.copy(h.emitterFollow.position);t.direction.set(0,-1,0);if(O=e.collisions.rayCastNearest(t)){h.emitterFollow.position.y-=O.distance*h.settings.scale-h.settings.normalOffsetAmount;p=O.mesh.matrixRotationWorld.multiplyVector3(O.normal).normalize();h.currentNormal=p}}if(h.settings.useOldRay){N=new THREE.Vector3;
p=new THREE.Ray(h.emitterFollow.position,N);L=1E4;M=h.emitterFollow.position;var da,ka;N.set(-1,0,0);p.direction=N;O=p.intersectScene(y);if(O.length>0)for(G=0;G<O.length;++G)if(O[G].object!=h.emitter&&O[G].object!=F&&O[G].object!=D){if(O[G].distance<L){L=O[G].distance;M=O[G].point;ka=O[G].face;da=O[G].object}break}N.set(1,0,0);p.direction=N;O=p.intersectScene(y);if(O.length>0)for(G=0;G<O.length;++G)if(O[G].object!=h.emitter&&O[G].object!=F&&O[G].object!=D){if(O[G].distance<L){L=O[G].distance;M=O[G].point;
ka=O[G].face;da=O[G].object}break}N.set(0,-1,0);p.direction=N;O=p.intersectScene(y);if(O.length>0)for(G=0;G<O.length;++G)if(O[G].object!=h.emitter&&O[G].object!=T){if(O[G].distance<L){L=O[G].distance;M=O[G].point;ka=O[G].face;da=O[G].object}break}N.set(0,0,-1);p.direction=N;O=p.intersectScene(y);if(O.length>0)for(G=0;G<O.length;++G)if(O[G].object!=h.emitter&&O[G].object!=z&&O[G].object!=E){if(O[G].distance<L){L=O[G].distance;M=O[G].point;ka=O[G].face;da=O[G].object}break}N.set(0,0,1);p.direction=
N;O=p.intersectScene(y);if(O.length>0)for(G=0;G<O.length;++G)if(O[G].object!=h.emitter&&O[G].object!=z&&O[G].object!=E){if(O[G].distance<L){M=O[G].point;ka=O[G].face;da=O[G].object}break}h.emitterFollow.position=M;if(da!=undefined){p=da.matrixRotationWorld.multiplyVector3(ka.normal.clone());h.currentNormal=p}d.renderer.render(y,h.settings.camera);d.renderer.clear()}};this.reset=function(U,Y,N){h.emitter.position.set(U,Y,N);h.emitterFollow.position.set(U,Y,N)}};
ROME.TrailShaderUtils=function(){var b={},e,c,d,f,g,m=-9999999,n=-9999999,h=9999999,o=9999999,t,u;b.setMaterials=function(x,y,C,B){d=y;c=C;g=B;f=g.getContext();e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);f.texImage2D(f.TEXTURE_2D,0,f.RGB,d,d,0,f.RGB,f.UNSIGNED_BYTE,null);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,
f.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=e;var H,z,E,F,D,T;y=0;for(C=x.length;y<C;y++){H=x[y];B=H.position.x;z=H.position.y;T=H.geometry.vertices;F=0;for(D=T.length;F<D;F++){E=T[F].position;H=E.x+B;E=E.y+z;m=Math.max(m,H);n=Math.max(n,E);h=Math.min(h,H);o=Math.min(o,E)}}t=m-h;u=n-o;var W,U;for(y=0;y<C;y++){H=x[y];B=H.position.x;z=H.position.y;T=H.geometry.vertices;W=ROME.TrailShader.attributes();
U=W.trailUV.value;F=0;for(D=T.length;F<D;F++){E=T[F].position;U.push(new THREE.Vector2((E.x+B-h)/t,(E.y+z-o)/u))}B=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:W,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});B.fog=!0;B.lights=!0;B.vertexColors=2;B.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;B.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;B.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
B.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;B.uniforms.lavaMap.texture.wrapS=B.uniforms.lavaMap.texture.wrapT=THREE.Repeat;B.uniforms.lavaNoiseMap.texture.wrapS=B.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;H.materials[0]=B}};b.updateLava=function(x){ROME.TrailShader.uniforms.lavaTime.value+=x!==undefined?x:1};var v=NaN,w=NaN;b.setMarkAtWorldPosition=function(x,y){if(d&&x&&y){var C=(x-h)/t*d,B=(y-o)/u*d,H=c.image.width;if(C>=0&&C<d-H&&B>=0&&B<d-H){if(isNaN(v)){v=C;
w=B}var z=C-v,E=B-w,F=Math.sqrt(z*z+E*E)+1;z=H*z/F*0.8;E=H*E/F*0.8;f.bindTexture(f.TEXTURE_2D,e);var D=v,T=w;do{f.texSubImage2D(f.TEXTURE_2D,0,Math.floor(D),Math.floor(T),f.RGB,f.UNSIGNED_BYTE,c.image);D+=z;T+=E;F-=H*0.8}while(F>H);v=C;w=B}}};return b}();
ROME.TrailShader={init:function(){ROME.TrailShader.textures.faceMap=THREE.ImageUtils.loadTexture("/files/textures/PaintDubs.jpg");ROME.TrailShader.textures.lavaMap=THREE.ImageUtils.loadTexture("/files/textures/lava.jpg");ROME.TrailShader.textures.lavaNoiseMap=THREE.ImageUtils.loadTexture("/files/textures/Color_noise.jpg")},textures:{trailMap:undefined,faceMap:undefined,lavaMap:undefined,lavaNoiseMap:undefined},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},
lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},
pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue, f;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0)).rg;\nf = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nif( f > 0.5)\n{\nmixValue = abs((texture2D(lavaNoiseMap, vTrailUV.yx * vec2(40.0, -40.0)).r - 0.5));\nmixValue = max(max(1.0 - mixValue * 32.0, 0.0) * (lookup.r - 0.5) * 8.0, 0.0);\ngl_FragColor = vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0) - vec2( lavaTime * 2.5)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) - vec2( lavaTime * 2.5)).rrrr * vec4(2.0);\n}\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,e){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var d;this.addAnimal=function(f,g,m,n,h){g=g||null;var o=m||1.2;n=n||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(g==null&&c.array[d]!=undefined||g!=c.array[d])){h==null&&(h=[1]);var t=ROME.Animal(f,!1),u=t.mesh;m=0.02+Math.random()/8;m=Math.max(m,0.1);u.matrixAutoUpdate=!1;u.visible=!1;e.addChild(u);var v=0,w=0;if(n!=null){v=n[d%n.length]%
t.availableAnimals.length;w=v+1;if(Math.round(Math.random())==1&&v>0||w>t.availableAnimals.length-1)w=v-1}var x=h[v],y=h[w];t.play(t.availableAnimals[v],t.availableAnimals[w],0,Math.random(),Math.random());w=Math.random();d<2&&(w=0);m={c:u,a:t,active:!1,startMorph:v,lifetime:0,speeda:x,speedb:y,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:w,scale:m*o,origscale:m*o};c.array[d]=m}};this.create=function(f,g,m){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=
!0;c.array[d].position.copy(f);c.array[d].normal.copy(g);c.array[d].c.position.copy(f);c.array[d].c.visible=!0;c.array[d].toVector=m.subSelf(f).normalize();c.array[d].lifetime=0;c.array[d].toVector.x*=1-Math.abs(g.x);c.array[d].toVector.y*=1-Math.abs(g.y);c.array[d].toVector.z*=1-Math.abs(g.z);c.array[d].toVector.z=Math.random();c.array[d].toVector.x=Math.random()-0.5;c.array[d].scale=0.01;(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();
f=c.array[d].scale;c.array[d].c.position.x-=g.x*f*150;c.array[d].c.position.y-=g.y*f*150;c.array[d].c.position.z-=g.z*f*150;break}};this.update=function(f){if(isNaN(f)||f>1E3||f==0)f=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var g=c.array[d];if(g.active){var m=g.c,n=g.scale,h=g.normal,o=g.position,t=g.toVector;c.array[d].lifetime+=f;if(c.array[d].lifetime>4E3){c.array[d].active=!1;c.array[d].c.visible=!1}else{var u=o.x+t.x*10,v=o.y+t.y*10,w=o.z+t.z*10;h.y>0.5&&(v-=10);if(c.settings.capy!=
null&&v<c.settings.capy){v=c.settings.capy;h.set(0,1,0)}c.array[d].count+=0.03;o=Math.max(Math.cos(c.array[d].count),0);o=Math.min(o,1);c.array[d].a.morph=o;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}var x=g.speeda;if(Math.round(o)==1)x=g.speedb;g=(u-m.position.x)/5;o=(v-m.position.y)/5;t=(w-m.position.z)/5;o>x&&(o=x);o<-x&&(o=-x);g>x&&(g=x);g<-x&&(g=-x);t>x&&(t=x);t<-x&&(t=-x);u=new THREE.Vector3(u,
v,w);u.subSelf(m.position).normalize();v=new THREE.Vector3;h=new THREE.Vector3(h.x*-1,h.y*-1,h.z*-1);v.cross(u,h);h.cross(u,v);m.matrixWorld.n11=v.x*n;m.matrixWorld.n12=h.x*n;m.matrixWorld.n13=u.x*n;m.matrixWorld.n14=m.position.x;m.matrixWorld.n21=v.y*n;m.matrixWorld.n22=h.y*n;m.matrixWorld.n23=u.y*n;m.matrixWorld.n24=m.position.y;m.matrixWorld.n31=v.z*n;m.matrixWorld.n32=h.z*n;m.matrixWorld.n33=u.z*n;m.matrixWorld.n34=m.position.z;m.position.x+=g;m.position.y+=o;m.position.z+=t;c.array[d].position.copy(m.position)}}}};
this.reset=function(f,g,m){for(var n=0;n<c.array.length;++n){var h=c.array[n].c;h.position.x=f;h.position.y=g;h.position.z=m;c.array[n].active=!1;c.array[n].c.visible=!1}}},VideoPlane=function(b,e,c){var d,f,g,m,n,h=!1,o=!1,t=e.path.match("png$")||e.path.match("jpg$"),u=e.bendForce||400,v=new PolyTrail;this.params={radius:0.95,trail:5,random:0.23,bulge:0.7,polyDetail:0.55,softEdge:0.77,softTail:0};var w=e.fps||20;this.locked=e.locked;this.path=e.path;this.removed=!1;this.removeAt=e.removeAt||1;if(t)f=
THREE.ImageUtils.loadTexture(e.path);else{VideoLoadRegister[e.path]=1;d=document.createElement("video");d.src=e.path;d.preload="auto";d.load();b.signals.loadItemAdded.dispatch();d.addEventListener("canplaythrough",function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},!1);setTimeout(function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},1E4);f=new THREE.Texture(d);f.minFilter=THREE.LinearFilter;
f.magFilter=THREE.LinearFilter}switch(e.shaderId){case VIDEO_OPAQUE:m=VideoShaderSource.opaque;break;case VIDEO_OPAQUE_DISTORT:m=VideoShaderSource.distortOpaque;h=!0;break;case VIDEO_KEYED_DISTORT:m=VideoShaderSource.distortKeyed;h=!0;o=!0;break;case VIDEO_HALFALPHA:m=VideoShaderSource.halfAlpha;break;case VIDEO_SMARTALPHA:m=VideoShaderSource.smartAlpha;break;case VIDEO_SMARTALPHA_DISTORT:m=VideoShaderSource.distortSmartalpha;h=!0;break;case VIDEO_KEYED_INVERSE:m=VideoShaderSource.keyedInverse;o=
!0;break;default:m=VideoShaderSource.keyed;o=!0}var x=THREE.UniformsUtils.clone(m.uniforms);x.map.texture=f;if(h){x.mouseXY.value=new THREE.Vector2(0,0);x.aspect.value=c.aspect;x.mouseSpeed.value=1;x.mouseRad.value=1}if(o){x.colorScale.value=e.colorScale;x.threshold.value=e.threshold;x.alphaFadeout.value=e.alphaFadeout}n=new THREE.MeshShaderMaterial({uniforms:x,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,depthTest:!1});if(!e.width)e.width=h?1.104:1;if(!e.height)e.height=h?1.24:1;m=
h?c.grid:e.paralax?new THREE.Plane(1,1,50,10):new THREE.Plane(1,1,1,1);if(e.paralax)for(var y=0;y<m.vertices.length;++y){o=Math.sin((m.vertices[y].position.x+0.5)*Math.PI);m.vertices[y].position.z=(1-o)*u*e.width;m.vertices[y].position.y*=1+(1-o)*0.35*e.height}this.mesh=new THREE.Mesh(m,n);this.mesh.scale.x=e.width;this.mesh.scale.y=e.height;this.mesh.position.z=e.z;this.mesh.position.y=e.y||0;this.mesh.scale.x*=Math.abs(e.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(e.z)*c.adj;this.start=function(C,
B,H){v.set(-B*c.aspect,-H);if(!t){try{d.currentTime=d.duration*C}catch(z){console.log(z);d.currentTime=0}d.play();f.needsUpdate=!0;g=setInterval(function(){if(d.readyState===d.HAVE_ENOUGH_DATA)f.needsUpdate=!0},1E3/w)}};this.stop=function(){if(!t){d.pause();d.currentTime=0;clearInterval(g)}};this.update=function(C,B,H){if(h){v.target.x=-C*c.aspect;v.target.y=-B;v.update();for(y=0;y<=4;y++){n.uniforms["trail"+y].value.x=this.params.polyDetail*v.s[y*2*this.params.trail].x;n.uniforms["trail"+y].value.y=
this.params.polyDetail*v.s[y*2*this.params.trail].y+1.0E-4*y}n.uniforms.mouseXY.value.x=-C*c.aspect;n.uniforms.mouseXY.value.y=-B;n.uniforms.mouseSpeed.value=H;n.uniforms.mouseRad.value=this.params.radius;n.uniforms.polyRandom.value=this.params.random;n.uniforms.polyDetail.value=this.params.polyDetail;n.uniforms.bulge.value=this.params.bulge;n.uniforms.softEdge.value=this.params.softEdge}}};
function PolyTrail(){this.target=new THREE.Vector2;this.s=[];for(var b=0;b<=50;b++)this.s[b]=new THREE.Vector2}PolyTrail.prototype.set=function(b,e){for(var c=50;c>=0;c-=1)this.s[c]=new THREE.Vector3(b,e,0)};PolyTrail.prototype.update=function(){for(var b=50;b>0;b-=1){this.s[b].x=this.s[b-1].x;this.s[b].y=this.s[b-1].y}this.s[0].x=this.target.x;this.s[0].y=this.target.y};
var VideoLoadRegister={},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VIDEO_KEYED_INVERSE=6,VIDEO_SMARTALPHA=7,VIDEO_SMARTALPHA_DISTORT=8,VideoPlayer=function(b,e){var c=this,d=(new Date).getTime();SequencerItem.call(this);var f=new THREE.Color(0),g={},m=[],n=!1,h,o,t=b.renderer,u=b.renderTarget,v=0,w=0,x=0,y=0,C=0,B=0,H=1,z;this.duration=e[0].duration;this.init=function(){g.prx=e[0].paralaxHorizontal||0;g.pry=e[0].paralaxVertical||0;g.tgd=e[0].targetDistance||
1500;onGrid=function(E){g.grid=E;c.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"/files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){n=!0;b.signals.mousemoved.add(function(){v=b.mouse.x/b.screenWidth*-2+1;w=b.mouse.y/b.screenHeight*2-1});z=new THREE.Vector2(0,0);g.fov=54;g.aspect=2.35;g.adj=Math.tan(g.fov*Math.PI/360)*2;o=new THREE.Camera(g.fov,g.aspect,1,1E5);o.target.position=new THREE.Vector3(0,0,g.tgd*-1);o.updateMatrix();h=new THREE.Scene;h.addLight(new THREE.AmbientLight(0));
h.addObject(o);for(var E=0;E<e.length;E++){var F=new VideoPlane(b,e[E],g);m.push(F)}};this.show=function(E){for(var F=0;F<m.length;F++){var D=m[F];D.locked?o.addChild(D.mesh):h.addChild(D.mesh);D.start(E,v,w)}t.setClearColor(f)};this.hide=function(){for(var E=0;E<m.length;E++)m[E].stop()};this.update=function(E,F,D){D=(new Date).getTime();F=D-d;d=D;if(n){C=v;B=w;H+=(700*(Math.abs(Math.max(Math.min(C-x,0.05),-0.05)/F)+Math.abs(Math.max(Math.min(B-y,0.05),-0.05)/F))-H)/20;x=v;y=w;z.x=v*-2*g.prx;z.y=
w*2*g.pry;z.x=Math.min(z.x,g.prx);z.x=Math.max(z.x,-g.prx);z.y=Math.min(z.y,g.pry);z.y=Math.max(z.y,-g.pry);o.target.position.x+=(z.x-o.target.position.x)/2;o.target.position.y+=(z.y-o.target.position.y)/2;for(F=0;F<m.length;F++){D=m[F];if(E>D.removeAt&&!D.removed){D.locked&&o.removeChild(D.mesh);h.removeChild(D.mesh);D.stop();D.removed=!0}else D.update(v,w,H,1)}t.render(h,o,u)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var DistortUniforms={aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5},mouseXY:{type:"v2",value:new THREE.Vector2},trail0:{type:"v2",value:new THREE.Vector2},trail1:{type:"v2",value:new THREE.Vector2},trail2:{type:"v2",value:new THREE.Vector2},trail3:{type:"v2",value:new THREE.Vector2},trail4:{type:"v2",value:new THREE.Vector2},mouseSpeed:{type:"f",value:1},mouseRad:{type:"f",value:1},polyRandom:{type:"f",
value:1},polyDetail:{type:"f",value:1},bulge:{type:"f",value:1},softEdge:{type:"f",value:0}},DistortShaderFragmentPars="uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nuniform float softEdge;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distancePoly;\nvarying float distance;\nvarying vec2 closest;",DistortVertexShader="uniform vec2 mouseXY;\nuniform vec2 trail0;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform vec2 trail4;\nuniform float aspect;\nuniform float mouseSpeed;\nuniform float mouseRad;\nuniform float polyRandom;\nuniform float polyDetail;\nuniform float bulge;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distance;\nvarying float distancePoly;\nvarying vec2 closest;\nvec2 getClosest(vec2 p, vec2 l1, vec2 l2){\nvec2 pl1 = p - l1;\nvec2 l2l1 = l2 - l1;\nfloat dot = pl1.x * l2l1.x + pl1.y * l2l1.y;\nfloat len_sq = pow(length(l2l1),2.);\nfloat param = dot / len_sq;\nif(param < 0.) return l1;\nelse if(param > 1.) return l2;\nelse return (l1 + l2l1 * param);\n}\nfloat getDistance(vec2 p, vec2 li){\nreturn 1. - sqrt( (p.x-li.x)*(p.x-li.x) + (p.y-li.y)*(p.y-li.y) );\n}\nvoid main() {\nvUvPoly = uv+vec2(normal.x,normal.y);\nvUv = (uv-vec2(.5))/polyDetail+vec2(.5);\nvUvPoly = (vUvPoly-vec2(.5))/polyDetail+vec2(.5);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position*(1./polyDetail), 1.0 );\nvec4 glPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nvec2 projPos = vec2(aspect,1.)*vec2(gl_Position.x/gl_Position.z,gl_Position.y/gl_Position.z);\nvec2 projPosPoly = vec2(aspect,1.)*vec2(glPosPoly.x/glPosPoly.z,glPosPoly.y/glPosPoly.z);\nfloat dist = (normal.z*2.)*polyRandom + 1.-polyRandom;\nvec2 closestTrailPoly0 = getClosest(projPosPoly,trail0,trail1);\nvec2 closestTrailPoly1 = getClosest(projPosPoly,trail1,trail2);\nvec2 closestTrailPoly2 = getClosest(projPosPoly,trail2,trail3);\nvec2 closestTrailPoly3 = getClosest(projPosPoly,trail3,trail4);\nfloat distanceTrailPoly0 = 1.0*dist * getDistance(projPosPoly,closestTrailPoly0);\nfloat distanceTrailPoly1 = 0.8*dist * getDistance(projPosPoly,closestTrailPoly1);\nfloat distanceTrailPoly2 = 0.6*dist * getDistance(projPosPoly,closestTrailPoly2);\nfloat distanceTrailPoly3 = 0.4*dist * getDistance(projPosPoly,closestTrailPoly3);\ndistancePoly = mouseRad*max(0.,max(distanceTrailPoly0,max(distanceTrailPoly1,max(distanceTrailPoly2,distanceTrailPoly3))));\ndistance = mouseRad*max(0.,1.-length(projPos-trail0  ));\ngl_Position.xy = gl_Position.xy + normalize(projPos.xy-trail0)*vec2(bulge*distance*mouseSpeed*50.);\n}";
debug="//gl_FragColor = vec4(vec3(closest,1.),1.);";
var VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( map, vUv );\n}"},keyedInverse:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t > threshold )\nalpha = 0.0;//(1.0 - (t - 2.0)) * alphaFadeout;\ngl_FragColor = vec4( c.xyz * cs, alpha );\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},distortSmartalpha:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\nc.a = a.r;\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x * 0.6666, vUvPoly.y ) );\nvec4 aPoly = texture2D( map, vec2( 0.6666 + vUvPoly.x * 0.3333, vUvPoly.y ) );\ncPoly.a = aPoly.r;\nif ((distancePoly)>0.5) c = cPoly; \ngl_FragColor = mix(c,cPoly,max(0.,distancePoly*softEdge));",
debug,"}"].join("\n")},smartAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},keyed:{uniforms:{map:{type:"t",value:0,texture:null},
colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},
distortOpaque:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \ngl_FragColor = mix(c,cPoly,max(0.,distancePoly*softEdge));",debug,"}"].join("\n")},distortKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"].join("\n")}},
VideoShots={introLayers:[{path:"/files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,fps:48,width:1.01,height:1.01,duration:22E3}],s01_01:[{path:"/files/videos/city/s01.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:3120}],s01_03:[{path:"/files/videos/city/s03_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1100,width:1.56,height:1.59,paralax:!0,duration:8120,paralaxHorizontal:600,paralaxVertical:200},{path:"/files/videos/city/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0,removeAt:0.3}],s01_06:[{path:"/files/videos/city/s06_layer02.webm",
shaderId:VIDEO_OPAQUE,z:-1E3,duration:2030},{path:"/files/videos/city/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900}],s01_09:[{path:"/files/videos/city/s09_layer02.webm",shaderId:VIDEO_KEYED,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,paralax:!0,width:1.5625,height:1.1627,duration:8230,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/city/s09_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-500,locked:!0,removeAt:0.3}],s02_01:[{path:"/files/videos/prairie/s01_layer02.webm",
shaderId:VIDEO_OPAQUE,width:1.5625,height:1,paralax:!0,paralaxHorizontal:600,paralaxVertical:0,bendForce:73,z:-200,duration:9800},{path:"/files/videos/prairie/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,width:1.05,height:1.05,locked:!0,z:-100}],s02_02:[{path:"/files/videos/prairie/s02_layer03.jpg",shaderId:VIDEO_OPAQUE,z:-1010,duration:2E3},{path:"/files/videos/prairie/s02_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3},{path:"/files/videos/prairie/s02_layer01.webm",shaderId:VIDEO_SMARTALPHA,
z:-990}],s02_03:[{path:"/files/videos/prairie/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1500,duration:2125},{path:"/files/videos/prairie/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_04:[{path:"/files/videos/prairie/s04_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:5E3},{path:"/files/videos/prairie/s04_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_06:[{path:"/files/videos/prairie/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA,colorScale:1,threshold:2.4,alphaFadeout:1,
z:-1010,duration:6E3}],s03_01:[{path:"/files/videos/dunes/s01_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1E3,width:1.56,height:1.22,paralax:!0,duration:8E3,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/dunes/s01_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-800,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,width:1.56,height:1.22,paralax:!0},{path:"/files/videos/dunes/s01_layer01.webm",shaderId:VIDEO_KEYED,colorScale:0,threshold:0.5,alphaFadeout:0.5,z:-100,locked:!0}],s03_02:[{path:"/files/videos/dunes/s02_layer02.webm",
shaderId:VIDEO_OPAQUE,z:-1010,duration:3500},{path:"/files/videos/dunes/s02_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,z:-1E3}],s03_03:[{path:"/files/videos/dunes/s03_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-400,paralax:!0,width:1.526,height:1.11,duration:11E3,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/dunes/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,removeAt:0.3,locked:!0}]},City=function(b){var e=this;SequencerItem.call(this);
b.signals.initscenes.add(function(){e.update(0.0010,34.99,45199)});var c,d,f,g,m,n=b.renderer,h=b.renderTarget,o=[],t=[],u=!1,v=0;b.debug=!1;if(function(w){return(w=RegExp("[?&]"+w+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(w[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){o=[[0,18,-300],[0,18,-1430]];d=new THREE.PathCamera({fov:65,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:o,duration:9.7,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,
createDebugDummy:!1,lookSpeed:0.0010,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});d.position.set(0,0,0);d.lon=180;d.lat=-20;c=d;if(b.debug){gui=new GUI;gui.add(c,"fov",50,120).name("Lens")}g=new CityWorld(b);m=new CitySoup(c,g.scene,b);b.worlds.city=g;b.soups.city=m;b.sequences.city=this;g.scene.addObject(c.animationParent)};this.resetCamera=function(){c.position.set(0,0,0);c.animation.play(!1,
0);n.setClearColor(g.scene.fog.color)};this.show=function(){this.resetCamera();b.started.city=!0;console.log("show city")};this.hide=function(){};this.update=function(w,x){if(isNaN(x)||x>1E3||x==0)x=1E3/60;v+=x;if(v<2E3){c.lon=180;c.lat=-20}b.debug&&c.updateProjectionMatrix();var y=c.animationParent.position.z;if(y<-1400&&!u){t=[[0,18,y],[0,18,-3400]];c.theta<1.2&&(t=[[0,18,y],[0,18,-1650],[-110,18,-1740],[-1670,18,-1740]]);c.theta>1.8&&(t=[[0,18,y],[0,18,-1650],[110,18,-1740],[1670,18,-1740]]);y=
65;if(b.debug)y=d.fov;f=new THREE.PathCamera({fov:y,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:t,duration:15.6,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0010,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});f.lat=d.lat;f.lon=d.lon;g.scene.addObject(f.animationParent);f.animation.play(!1,0);c=f;m.changeCamera(c);d.animation.stop();
b.debug&&gui.add(c,"fov",50,120).name("Lens");u=!0}THREE.AnimationHandler.update(x);m.update(x);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/400;n.render(g.scene,c,h);g.update(x,c,!1);b.logger.log("vertices: "+n.data.vertices);b.logger.log("faces: "+n.data.faces);b.logger.log("draw calls: "+n.data.drawCalls)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){var e=this;SequencerItem.call(this);b.signals.initscenes.add(function(){e.update(9.0E-4,49.99,90375)});var c,d,f,g=b.renderer,m=b.renderTarget,n,h=[],o=0;b.debug=!1;if(function(t){return(t=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(t[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){h=[[332.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,
113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var t,u;for(t=0;t<h.length;t++){u=h[t][1];h[t][1]=h[t][2]+6;h[t][2]=-u}n=new THREE.PathCamera({fov:73,aspect:b.viewportWidth/
b.viewportHeight,near:1,far:1E6,waypoints:h,duration:26.2,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0028,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});n.position.set(0,0,0);n.lon=360;c=n;if(b.debug){gui=new GUI;gui.add(c,"fov",50,120).name("Lens")}d=new PrairieWorld(b,c,function(){f=new PrairieSoup(c,d.scene,b);b.soups.prairie=f;b.prairieSoupHead=new THREE.Vector3});
b.worlds.prairie=d;b.sequences.prairie=this;d.scene.addObject(n.animationParent)};this.show=function(){this.resetCamera();b.started.prairie=!0};this.hide=function(){};this.resetCamera=function(){o=0;c.position.set(0,0,0);c.lon=360;c.animation.play(!0,0)};this.update=function(t,u){if(isNaN(u)||u>1E3||u==0)u=1E3/60;o+=u;if(o<2500)c.lon=360;b.debug&&c.updateProjectionMatrix();THREE.AnimationHandler.update(u);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/300;c.animationParent.position.y+=
(Math.random()-0.5)*0.3;d.update(u,c,!1);f&&f.update(u);g.render(d.scene,c,m);b.logger.log("vertices: "+g.data.vertices);b.logger.log("faces: "+g.data.faces);b.logger.log("draw calls: "+g.data.drawCalls)}};Prairie.prototype=new SequencerItem;Prairie.prototype.constructor=Prairie;
var Dunes=function(b){SequencerItem.call(this);var e=this,c,d,f,g=b.renderer,m=b.renderTarget;new THREE.Vector3;b.signals.initscenes.add(function(){e.update(9.0E-4,49.99,90375)});this.init=function(){d=new DunesWorld(b);b.worlds.dunes=d;b.sequences.dunes=this;c=DunesCamera(b);f=new DunesSoup(c.camera,d.scene,b);b.soups.dunes=f};this.show=function(){c.resetCamera();b.started.dunes=!0;d.ambient.color.setHSV(0,0,0);d.directionalLight1.color.setHSV(0.08823529411764706,0,0);d.directionalLight2.color.setHSV(0,
0,0);d.lensFlare.position.y=-2500;d.skyWhite=0.02;console.log("show dunes")};this.hide=function(){};this.resetCamera=function(){c.resetCamera();g.setClearColor(d.scene.fog.color)};this.update=function(n,h,o){if(n>0.05&&n<0.15){var t=Math.sin((n-0.05)/(0.15-0.05)*Math.PI*0.5);d.lensFlare.position.y=-2500+6E3*t;d.skyWhite=0.02+0.98*t;d.ambient.color.setHSV(0,0,0.1*t);d.directionalLight1.color.setHSV(0.08823529411764706,0,t);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*t)}else if(n>0.9){t=
Math.sin((1-(n-0.9)/0.1)*Math.PI*0.5);t*=t;d.lensFlare.position.y=-1E3+4500*t;d.skyWhite=t;d.ambient.color.setHSV(0,0,0.1*t);d.directionalLight1.color.setHSV(0.08823529411764706,0,t);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*t)}else if(n>0.05){d.skyWhite=1;d.ambient.color.setHSV(0,0,0.1);d.directionalLight1.color.setHSV(0.08823529411764706,0,1);d.directionalLight2.color.setHSV(0,0,0.8647058823529412);d.lensFlare.position.y=3500}n>0.38&&f.update(h);c.updateCamera(n,h,o);THREE.AnimationHandler.update(h);
d.update(h,c.camera,!1);g.render(d.scene,c.camera,m)}};Dunes.prototype=new SequencerItem;Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var e,c,d,f,g,m,n,h,o,t,u,v,w,x=start_time=(new Date).getTime(),y,C,B=1;e=document.createElement("div");e.style.background="-moz-linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";e.style.background="-webkit-linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";e.style.background="linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";e.style.textAlign="center";var H=!1,z=!1;this.load=
function(){function E(W,U,Y){var N=document.createElement("div");N.style.position="absolute";N.style.cursor="pointer";N.style.margin=W;var p=document.createElement("img");p.src=U;N.appendChild(p);N.addEventListener("mouseout",function(){p.src=U},!1);N.addEventListener("mouseover",function(){p.src=Y},!1);return N}c=new Clouds(b);c.getDomElement().style.position="absolute";c.getDomElement().style.left="0px";c.getDomElement().style.top="0px";c.getDomElement().style.width=window.innerWidth+"px";c.getDomElement().style.height=
window.innerHeight+"px";e.appendChild(c.getDomElement());y=document.createElement("div");y.style.background="rgba(255,255,255,1)";y.style.width="100%";y.style.height="100%";y.style.position="absolute";y.style.zIndex=1E3;e.appendChild(y);m=document.createElement("div");m.style.position="absolute";m.setAttribute("id","ui-container");d=document.createElement("div");d.style.position="absolute";d.innerHTML='<img src="/files/logo_heart.png">';m.appendChild(d);f=E("10px 0 0 85px","/files/enter_idle.png",
"/files/enter_rollover.png");f.addEventListener("click",function(){t.getDomElement().style.display="block";f.style.display="none";H=!0;if(o!=undefined&&h!=undefined){o.style.display="none";h.style.display="none"}b.signals.load.dispatch()},!1);m.appendChild(f);g=E("30px 0 0 85px","/files/start_idle.png","/files/start_rollover.png");g.style.display="none";g.addEventListener("click",function(){if(b.originLink=="/explore"&&b.shouldSkip){b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes");
_gaq.push(["_trackPageview","/explore"]);b.hasExplored=!0;b.shouldSkip=!1}else{b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1);_gaq.push(["_trackPageview","/launcher_start_film"])},1E3)}},!1);m.appendChild(g);t=new LoadingBar(function(){t.getMouseInfo().style.display="none";g.style.display="block";b.loadedContent=!0;H=!1;b.signals.initscenes.dispatch()});t.getDomElement().style.position="absolute";t.getDomElement().style.display="none";m.appendChild(t.getDomElement());
b.signals.loadItemAdded.add(t.addItem);b.signals.loadItemCompleted.add(t.completeItem);if(HandleErrors.isWebGLAndBeta){n=document.createElement("div");n.style.paddingTop="60px";n.style.marginLeft="-2px";n.innerHTML="<img src = '/files/footer/header-trans.png' alt = 'ROME' />";e.appendChild(n)}else e.appendChild(m);if(localStorage.getItem("RomeSeen")=="true"){if(!z){var F=document.createTextNode(".seen-before {\n\topacity: .35;\n\tcursor: pointer;\n}\n.seen-before:hover {\n\topacity: 1.0;\n}"),D=document.getElementsByTagName("head")[0],
T=document.createElement("style");if(T.stylesheet)T.styleSheet.cssText=F.nodeValue;else T.appendChild(F);D.appendChild(T);z=!0}o=document.createElement("div");o.setAttribute("class","seen-before");o.setAttribute("style","background: url('files/launcher/add-trans.png') 0 0 no-repeat; width: 145px; height: 10px;");o.style.position="absolute";o.style.top="248px";o.style.left=window.innerWidth/2-354+"px";o.addEventListener("click",function(W){W.preventDefault();b.signals.showugc.dispatch();_gaq.push(["_trackPageview",
"/launcher_add_to_dream"])},!1);h=document.createElement("div");h.setAttribute("class","seen-before");h.setAttribute("style","background: url('files/launcher/explore-trans.png') 0 0 no-repeat; width: 199px; height: 10px;");h.style.position="absolute";h.style.top="248px";h.style.left=window.innerWidth/2+168+"px";h.addEventListener("click",function(W){W.preventDefault();window.open("/gallery","Gallery");_gaq.push(["_trackPageview","/launcher_gallery"])},!1);m.appendChild(o);m.appendChild(h)}else localStorage.setItem("RomeSeen",
!0);u=document.createElement("div");u.style.position="absolute";u.style.left="0";u.style.bottom="0";u.style.width="100%";new Footer(u);e.appendChild(u)};this.show=function(){c.show();e.style.display="block";if(!b.loadedContent)g.style.display="none"};this.resize=function(E,F){c.resize(E,F);if(d){d.style.top="60px";d.style.left=(window.innerWidth-358)/2+"px"}if(f){f.style.top=g.style.top="210px";f.style.left=g.style.left=(window.innerWidth-358)/2+"px"}if(t){t.getDomElement().style.top="215px";t.getDomElement().style.left=
(window.innerWidth-300)/2+"px"}if(h&&o){h.style.left=window.innerWidth/2+168+"px";o.style.left=window.innerWidth/2-354+"px"}e.style.width=E+"px";e.style.height=F+"px"};this.hide=function(){c.hide();e.style.display="none"};this.update=function(){w=(new Date).getTime();v=w-x;x=w;H||c.update();if(B>0){B-=4.0E-4*v;C=TWEEN.Easing.Exponential.EaseOut(B);y.style.background="rgba(255,255,255,"+C+")"}else{y.style.display="none";y.style.zIndex=0}};LauncherSection.showUI=function(){if(n)n.style.display="none";
e.appendChild(m)};this.getDomElement=function(){return e}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function e(){m=!1;f.pause()}function c(W){switch(W.keyCode){case 32:f.paused?f.play():f.pause();break;case 37:f.currentTime--;n.clear();break;case 39:f.currentTime++;n.clear();break;case 38:f.playbackRate+=0.1;break;case 40:f.playbackRate-=0.1;break;case 77:f.volume=f.volume?0:1}}Section.call(this);var d,f,g,m=!1,n,h,o;d=document.createElement("div");d.style.display="none";f=document.createElement("audio");f.preload="auto";d.appendChild(f);source=document.createElement("source");
source.src="/files/Black.ogg";f.appendChild(source);g=new Tune(f);g.setBPM(85);g.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);h=new THREE.WebGLRenderer({stencil:!1});h.domElement.style.position="absolute";h.setSize(b.viewportWidth,b.baseHeight);h.sortObjects=!1;h.autoClear=!1;o=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight,{stencilBuffer:!1});o.minFilter=THREE.LinearFilter;
o.magFilter=THREE.LinearFilter;b.renderer=h;b.renderTarget=o;b.signals.startfilm.add(function(W,U){d.appendChild(h.domElement);m=!0;f.currentTime=g.getPatternMS(W)/1E3;f.play();f.volume=U});b.signals.stopfilm.add(e);var t=new VideoPlayer(b,VideoShots.s01_01),u=new VideoPlayer(b,VideoShots.s01_03),v=new VideoPlayer(b,VideoShots.s01_06),w=new VideoPlayer(b,VideoShots.s01_09),x=new VideoPlayer(b,VideoShots.s02_01),y=new VideoPlayer(b,VideoShots.s02_02),C=new VideoPlayer(b,VideoShots.s02_03),B=new VideoPlayer(b,
VideoShots.s02_04),H=new VideoPlayer(b,VideoShots.s02_06),z=new VideoPlayer(b,VideoShots.s03_01),E=new VideoPlayer(b,VideoShots.s03_02),F=new VideoPlayer(b,VideoShots.s03_03);n=new Sequencer;n.add(new ClearEffect(b),g.getPatternMS(0),g.getPatternMS(73.25),0);n.add(new VideoPlayer(b,VideoShots.introLayers),g.getPatternMS(0),g.getPatternMS(7.9),1);var D=g.getPatternMS(7.9),T=g.getPatternMS(16);n.add(t,D,D+t.duration,1);D+=t.duration;n.add(u,D,D+u.duration,1);D+=u.duration;n.add(v,D,D+v.duration,1);
D+=v.duration;n.add(w,D,T,4);t=g.getPatternMS(16)-2E3;n.add(new City(b),t,g.getPatternMS(23.9),1);n.add(new PaintEffect(b),t,g.getPatternMS(23.9),5);t=g.getPatternMS(23.9);g.getPatternMS(32);n.add(x,t,t+x.duration,1);t+=x.duration;n.add(y,t,t+y.duration,1);t+=y.duration;n.add(C,t,t+C.duration,1);t+=C.duration;n.add(B,t,t+B.duration,1);t+=B.duration;n.add(H,t,t+H.duration,4);x=g.getPatternMS(32)-3E3;n.add(new Prairie(b),x,g.getPatternMS(40),1);n.add(new PaintEffectPrairie(b),x,g.getPatternMS(40),5);
x=g.getPatternMS(40);g.getPatternMS(48);n.add(z,x,x+z.duration,1);x+=z.duration;n.add(E,x,x+E.duration,1);x+=E.duration;n.add(F,x,x+F.duration,4);x+=F.duration;z=g.getPatternMS(48)-11E3;n.add(new Dunes(b),z,g.getPatternMS(73.25),1);n.add(new PaintEffectDunes(b),z,g.getPatternMS(73.25),5);n.add(new FadeOutEffect(0,b),g.getPatternMS(23.5),g.getPatternMS(24),3);n.add(new FadeOutEffect(0,b),g.getPatternMS(39.5),g.getPatternMS(40),3);n.add(new FadeOutEffect(0,b),g.getPatternMS(72.2),g.getPatternMS(73.25),
3);n.add(new PointerEffect(b,!0),g.getPatternMS(8),g.getPatternMS(73.25),1E3);n.add(new RenderEffect(b),g.getPatternMS(0),g.getPatternMS(8),6);n.add(new PaintEffect(b),g.getPatternMS(8),g.getPatternMS(16)-2E3,6);n.add(new PaintEffectPrairie(b),g.getPatternMS(24),g.getPatternMS(32)-3E3,6);n.add(new RenderEffect(b),g.getPatternMS(40),g.getPatternMS(48)-11E3,6);this.getDomElement=function(){return d};this.show=function(){d.style.display="block";b.signals.keydown.add(c)};this.hide=function(){d.style.display=
"none";b.signals.keydown.remove(c);e()};this.resize=function(W,U){b.viewportWidth=b.baseWidth*(W/b.baseWidth);b.viewportHeight=b.baseHeight*(W/b.baseWidth);h.setSize(b.viewportWidth,b.viewportHeight);o.width=b.viewportWidth;o.height=b.viewportHeight;delete o.__webglFramebuffer;h.domElement.style.left="0px";h.domElement.style.top=(U-b.viewportHeight)/2+"px"};this.update=function(){if(m)if(f.currentTime>209){b.signals.showrelauncher.dispatch();e()}else n.update(f.currentTime*1E3)}};
FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function e(){for(var E=C.getPoints(),F=0;F<E.length;F++){var D=E[F].getOriginPosition(),T=f.list[F],W=D.x+o.x;D=D.y+o.y;if(F==0){W-=113;D-=162}else if(F==1){W+=137;D-=46}else if(F==2){W+=106;D+=78}else if(F==3){W-=312;D+=75}else{W-=344;D-=46}T.style.left=W+"px";T.style.top=D+"px"}}function c(E,F,D,T,W){F=document.createElement(F);F.setAttribute("id",D);F.setAttribute("class",T);F.innerHTML=W;E.appendChild(F);return F}Section.call(this);var d=document.createElement("div");
d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.display="none";d.style.backgroundColor="#ffffff";d.setAttribute("id","relauncher-section");var f={},g,m=document.createTextNode("#relauncher-section div.after-experience { position: absolute; height: 57px; overflow: hidden; cursor: pointer; } #relauncher-section div.after-experience img { display: block; } #relauncher-section div.after-experience:hover img { margin-top: -57px; }"),n=document.getElementsByTagName("head")[0],
h=document.createElement("style");h.type="text/css";if(h.styleSheet)h.styleSheet.cssText=m.nodeValue;else h.appendChild(m);n.appendChild(h);var o={x:window.innerWidth/2-225,y:window.innerHeight/2-175},t=new Clouds(b,!0);t.getDomElement().style.position="absolute";t.getDomElement().style.left="0px";t.getDomElement().style.top="0px";t.getDomElement().style.width=window.innerWidth+"px";t.getDomElement().style.height=window.innerHeight+"px";d.appendChild(t.getDomElement());var u=document.createElement("div");
u.setAttribute("id","container");u.setAttribute("style","position: absolute; top: "+o.y+"px; left: "+o.x+"px;");d.appendChild(u);var v=document.createElement("div");v.setAttribute("style","-webkit-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -moz-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -o-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750);");v.style.position="absolute";v.style.width=
"100%";v.style.height="100%";v.style.backgroundColor="#000";d.appendChild(v);var w=new GEE({fullscreen:!1,container:u,width:450,height:350,loop:!1}),x=w.ctx;g=document.createElement("div");g.style.position="absolute";g.style.width="100%";g.style.top=window.innerHeight-78+"px";g.style.left="0";new Footer(g);d.appendChild(g);var y=new WonderWall.Pentagon(w,w.width*0.5,w.height*0.5,80),C=new WonderWall.Pentagon(w,w.width*0.5,w.height*0.5,95),B=new WonderWall.Pentagon(w,w.width*0.5,w.height*0.5,130,0.25);
B.showFill=!1;B.insides=!0;C.showFill=!1;B.setRadius(0.09);y.setRadius(0.06);var H={svg:new Heart(w,"files/eminating-heart.svg",0,0),point:new WonderWall.Point(w,w.width*0.5,w.height*0.5+6)};H.point.r=0.0625;var z=z||{};z.color={red:"#f15d22",black:"#30302e",white:"#f4f4ea"};f=function(E){var F={},D=c(E,"div","start-over","after-experience","<img src = '/files/relaunch_section/start_over.png' alt = 'Start Over' />"),T=c(E,"div","technology","after-experience","<img src = '/files/relaunch_section/technology.png' alt = 'Technology' />"),
W=c(E,"div","add-to-the-dream","after-experience","<img src = '/files/relaunch_section/add_dreams.png' alt = 'Add to the Dream' />"),U=c(E,"div","explore-other-dreams","after-experience","<img src = '/files/relaunch_section/explore_dreams.png' alt = 'Explore Other Dreams' />");E=c(E,"div","continue-to-explore","after-experience","<img src = '/files/relaunch_section/continue.png' alt = 'Continue To Explore' />");D.addEventListener("click",function(Y){Y.preventDefault();b.signals.showfilm.dispatch();
b.signals.startfilm.dispatch(0,1);_gaq.push(["_trackPageview","/relauncher_start_over"])},!1);T.addEventListener("click",function(Y){Y.preventDefault();window.open("/tech","Technology");_gaq.push(["_trackPageview","/relauncher_tech"])},!1);W.addEventListener("click",function(Y){Y.preventDefault();b.signals.showugc.dispatch();_gaq.push(["_trackPageview","/relauncher_add_to_dream"])},!1);U.addEventListener("click",function(Y){Y.preventDefault();window.open("/gallery","Gallery");_gaq.push(["_trackPageview",
"/relauncher_gallery"])},!1);E.addEventListener("click",function(Y){Y.preventDefault();b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes");_gaq.push(["_trackPageview","/relauncher_continue_explore"])},!1);F.start=D;F.technology=T;F.add=W;F.otherDreams=U;F.explore=E;F.list=[E,D,U,W,T];init=!0;return F}(d);for(m=0;m<f.list.length;m++){n=f.list[m];n.addEventListener("mouseover",function(){var E=f.list.indexOf(this);y.setUpdatePoint(!0,E);C.setUpdatePoint(!0,E);B.setUpdatePoint(!0,
E);H.point.updating=!0},!1);n.addEventListener("mouseout",function(){var E=f.list.indexOf(this);y.setUpdatePoint(!1,E);C.setUpdatePoint(!1,E);B.setUpdatePoint(!1,E);H.point.updating=!1},!1)}e();w.draw=function(){C.update(o);C.getPoints();x.clearRect(0,0,w.width,w.height);x.globalCompositeOperation="source-over";x.strokeStyle=z.color.black;x.lineWidth=0.5;B.update(o).render();x.globalCompositeOperation="destination-out";y.update(o).render();x.globalCompositeOperation="xor";x.lineWidth=24;C.showStroke=
!0;C.showFill=!1;C.render();x.globalCompositeOperation="source-over";x.save();x.translate(w.width/2,w.height/2);H.svg.render();x.restore()};this.show=function(){t.show();e();d.style.display="block";setTimeout(function(){v.style.opacity=0},1);for(var E=u.getElementsByTagName("div"),F=0;F<E.length;F++)E[F].style.display="block"};this.resize=function(E,F){var D=window.innerWidth/2,T=window.innerHeight/2;d.style.width=E+"px";d.style.height=F+"px";t.resize(E,F);g.style.top=window.innerHeight-78+"px";o=
{x:D-225,y:T-175};u.setAttribute("style","position: absolute; top: "+o.y+"px; left: "+o.x+"px;");e()};this.hide=function(){t.hide();d.style.display="none";v.style.opacity=1};this.getDomElement=function(){return d};this.update=function(){t.update();w.draw()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){function e(){c()}function c(){if(U=!U){h.style.display="block";o.style.display="block"}else{h.style.display="none";o.style.display="none"}}function d(){Y=window.innerWidth/b.baseWidth;b.viewportWidth=b.baseWidth*Y;b.viewportHeight=b.baseHeight*Y;v.setSize(b.viewportWidth,b.viewportHeight);w.width=b.viewportWidth;w.height=b.viewportHeight;delete w.__webglFramebuffer;v.domElement.style.left="0px";v.domElement.style.top=(window.innerHeight-b.viewportHeight)/2+"px"}
Section.call(this);var f=document.createElement("div");f.style.display="none";var g=document.createTextNode("#rome-explore-hex-audio:hover polygon,\n\t#rome-explore-hex-poly-top:hover polygon,\n\t#rome-explore-hex-poly-bottom:hover polygon {\n\t\topacity: 1.0;\n\t}\n#rome-explore-hex-poly-middle,\n#rome-explore-hex-audio,\n\t#rome-explore-hex-poly-top,\n\t#rome-explore-hex-poly-bottom {\n\t\tcursor: pointer;\n\t}"),m=document.getElementsByTagName("head")[0],n=document.createElement("style");if(n.stylesheet)n.styleSheet.cssText=
g.nodeValue;else n.appendChild(g);m.appendChild(n);var h=document.createElement("div"),o=document.createElement("div"),t=0,u=0,v=b.renderer,w=b.renderTarget,x,y,C,B,H,z,E,F,D,T=0,W="",U=!1,Y,N;H=new ClearEffect(b);H.init();D=new FadeOutEffect(0,b);D.init();z=new PaintEffect(b);z.init();E=new PaintEffectPrairie(b);E.init();F=new PaintEffectDunes(b);F.init();var p=!0;N=document.createElement("audio");N.volume=0;N.loop=!0;N.src="files/nature.mp3";N.autoplay=!1;document.body.appendChild(N);var O,G={};
G.dunes=new DunesCameraFreeExplore(b);G.prairie=new PrairieCameraFreeExplore(b);G.city=new CityCameraFreeExplore(b);b.signals.startexploration.add(function(L){o.style.position="absolute";o.style.zIndex=1E3;o.innerHTML='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" x="0px" y="0px" width="184px" height="47px" viewBox="0 0 184 47" overflow="visible" enable-background="new 0 0 184 47" xml:space="preserve">\n\t<g id = "rome-explore-hex-audio" onClick="ExplorationSection.handleHexClick(2)">\n\t\t<polygon opacity="0.5" points="0,0 27.237,47.176 156.857,47.176 184.095,0 "/>\n\t\t<path id="rome-explore-hex-audio-play" display="none" fill="#FFFFFF" d="M118.749,14.089c-5.246,0-9.499,4.253-9.499,9.499s4.253,9.499,9.499,9.499s9.499-4.253,9.499-9.499 S123.995,14.089,118.749,14.089z M116.27,27.811v-7.75l6.875,3.527L116.27,27.811z"/>\n\t\t<path id="rome-explore-hex-audio-pause" fill="#FFFFFF" d="M118.75,14.089c-5.246,0-9.5,4.253-9.5,9.499s4.254,9.499,9.5,9.499s9.498-4.253,9.498-9.499 S123.996,14.089,118.75,14.089z M118.031,27.463h-2v-7.75h2V27.463z M121.469,27.463h-2v-7.75h2V27.463z"/>\n\t\t<text x="50" y="28" font-size="12" font-family="Futura-Std-Bold, Futura, sans-serif" fill="#fff" letter-spacing="1">AUDIO</text>\n\t</g>\n</svg>';
o.style.display="none";f.appendChild(o);h.style.position="absolute";h.style.zIndex=1E3;h.innerHTML='<g id = "svgHex-container">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" x="-184px" y="-159px" width="368px" height="318px" viewBox="0 0.972 368 318" overflow="visible" enable-background="new 0 0.972 368 318" xml:space="preserve">\n\t<polygon opacity="0.5" points="298.816,133.629 353.291,133.629 276.7,0.972 249.464,48.149 "/>\n\t<polygon opacity="0.5" points="119.064,47.554 91.827,0.377 14.897,133.629 69.37,133.629 "/>\n\t<g id="rome-explore-hex-poly-top" onClick="ExplorationSection.handleHexClick(1)">\n\t\t<polygon opacity="0.5" points="120.01,47.177 248.861,47.177 276.098,0 92.773,0 92.825,0.089 "/>\n\t\t<text x="168" y="28" font-size="14" font-family="Futura-Std-Bold, Futura, sans-serif" fill="#fff" letter-spacing="1">EXIT</text>\n\t</g>\n\t<polygon opacity="0.5" points="353.868,134.629 299.394,134.629 313.714,159.433 298.996,184.925 353.471,184.925 368.188,159.433 "/>\n\t<polygon opacity="0.5" points="298.419,185.925 249.267,271.062 276.503,318.239 352.894,185.925 "/>\n\t<g id="rome-explore-hex-poly-bottom" onClick="ExplorationSection.handleHexClick(0)">\n\t\t<polygon opacity="0.5" points="120.405,271.692 93.168,318.869 275.702,318.869 248.466,271.692 "/>\n\t\t<text x="156" y="300" font-size="14" font-family="Futura-Std-Bold, Futura, sans-serif" fill="#fff" letter-spacing="1">RESUME</text>\n\t</g>\n\t<polygon opacity="0.5" points="69.767,185.925 15.294,185.925 92.024,318.833 119.262,271.656 "/>\n\t<polygon opacity="0.5" points="54.473,159.433 68.793,134.629 14.728,134.629 14.728,133.922 0,159.433 14.728,184.944 14.728,184.925 69.19,184.925 "/>\n\t<g id="rome-explore-hex-poly-middle" onClick="ExplorationSection.handleHexClick(3)">\n\t\t<polygon opacity="0.5" fill="#F6F4EC" points="119.282,271.692 54.473,159.433 119.282,47.177 248.902,47.177 313.714,159.433 248.902,271.692 "/>\n\t</g>\n</svg>\n</g>';
h.style.display="none";f.appendChild(h);x=b.worlds[L];C=x.portals;O=G[L];if(L==="dunes"&&W!==""&&W!=="dunes"&&C){for(var Q=99999999999,M,da=0;da<C.length;da++)if(C[da].currentDistance<Q){Q=C[da].currentDistance;M=C[da]}O.switchDirection(M)}else O.resetCamera();W=L;y=b.soups[L];T=0;if(p){N.play();N.volume=1}if(L=="city")B=z;else if(L=="prairie")B=E;else{B=F;x.skyWhite=1;x.ambient.color.setHSV(0,0,0.1);x.directionalLight1.color.setHSV(0.08823529411764706,0,1);x.directionalLight2.color.setHSV(0,0,0.8647058823529412);
x.lensFlare.position.y=3500}d();t=u=(new Date).getTime()});b.signals.windowresized.add(d);this.getDomElement=function(){return f};this.show=function(){if(!b.hasExplored)b.hasExplored=!0;f.style.display="block";f.appendChild(v.domElement);b.signals.keyup.add(e);h.style.display="none";h.style.top=window.innerHeight/2-184+"px";h.style.left=window.innerWidth/2-159+"px";o.style.display="none";o.style.top=(window.innerHeight-b.viewportHeight)/2+"px";o.style.left=window.innerWidth/2-66+"px";U=!1};this.hide=
function(){f.style.display="none";b.signals.keyup.remove(e);p&&N.pause()};this.resize=function(){h.style.top=window.innerHeight/2-184+"px";h.style.left=window.innerWidth/2-159+"px";o.style.top=(window.innerHeight-b.viewportHeight)/2+"px";o.style.left=window.innerWidth/2-66+"px"};this.update=function(){time=(new Date).getTime()-t;delta=time-u;u=time;delta=Math.min(1E3,Math.max(0,delta));if(!U&&x&&x.scene){y&&y.update(delta,O.camera);THREE.AnimationHandler.update(delta);O.updateCamera(0,delta,time);
x.update(delta,O.camera,!0);H.update(0,delta,time);v.setClearColor(x.scene.fog?x.scene.fog.color:16777215);v.render(x.scene,O.camera,w);if(T<1E3){T+=delta;D.update(1-T/1E3)}else for(var L=0;L<C.length;L++)C[L].currentDistance<C[L].radius*1.25&&D.update(1-(C[L].currentDistance-C[L].radius)/(C[L].radius*0.25));B.update(0,delta,time)}};ExplorationSection.handleHexClick=function(L){switch(L){case 0:c();break;case 1:b.signals.showrelauncher.dispatch();break;case 2:if(p){N.pause();document.getElementById("rome-explore-hex-audio-pause").setAttribute("display",
"none");document.getElementById("rome-explore-hex-audio-play").setAttribute("display","svg-path");p=!1}else{N.play();document.getElementById("rome-explore-hex-audio-play").setAttribute("display","none");document.getElementById("rome-explore-hex-audio-pause").setAttribute("display","svg-path");p=!0}break;case 3:window.open(v.domElement.toDataURL("image/png"),"Make ro.me your wallpaper!");break;default:c()}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){function e(Q){T+=Q;T=T<100?100:T>5E3?5E3:T}function c(Q){if(Q.button==2){x=!0;W=t.getPainter().getMode();t.getPainter().setMode(VoxelPainter.MODE_IDLE)}y=!0;if(x){C=E;B=F;H=Q.clientX;z=Q.clientY}}function d(Q){if(Q.button==2){x=!1;t.getPainter().setMode(W)}y=!1}function f(Q){if(x&&y){E=C-(Q.clientX-H)*0.1;F=B+(Q.clientY-z)*0.1;switch(h){case 0:F=F>90?90:F<0?0:F;break;case 1:F=F>90?90:F<-90?-90:F}}}function g(Q){e(-Q.wheelDeltaY*0.5)}function m(Q){Q.preventDefault()}var n=
this,h,o,t,u,v=document.createElement("div");v.style.display="none";var w=Math.PI/180,x=!1,y=!1,C,B,H,z,E=45,F=15,D=3E3,T=3E3,W,U=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,2E4);U.target.position.y=20;n.scene=new THREE.Scene;n.scene.fog=new THREE.FogExp2(16777215,1.5E-4);n.scene.fog.color.setHSV(0.576,0.382,0.9);var Y=new THREE.AmbientLight(4465152),N=new THREE.DirectionalLight(16772829),p=new THREE.DirectionalLight(16772829);Y.color.setHSV(0,0,0.1);N.color.setHSV(0.088,0,1);N.position.set(0.8,
0.3,-0.5);N.position.normalize();p.color.setHSV(0,0,0.564);p.position.set(0.1,0.5,0.2);p.position.normalize();n.scene.addLight(Y);n.scene.addLight(N);n.scene.addLight(p);Y=initLensFlares(new THREE.Vector3(0,0,-7500),60,292);n.scene.addChild(Y);var O=new THREE.Object3D;n.scene.addChild(O);(new THREE.SceneLoader).load("/files/models/dunes/D_tile_1.js",function(Q){for(var M=0,da=Q.scene.objects.length;M<da;M++){var ka=Q.scene.objects[M];if(ka.visible){ka.rotation.x=-90*Math.PI/180;ka.position.y=-100;
ka.position.x=1E3;ka.scale.x=ka.scale.y=ka.scale.z=0.75;O.addChild(ka)}}Q=new THREE.Plane(1E3,1E3);for(M=0;M<100;M++){da=new THREE.Mesh(Q,new THREE.MeshLambertMaterial({color:16777215,opacity:0.5,blending:THREE.AdditiveBlending}));da.position.x=Math.random()-0.5;da.position.y=Math.random();da.position.z=Math.random()-0.5;da.position.normalize();da.position.x*=Math.random()*5E3+2500;da.position.y=da.position.y*(Math.random()*2500+5E3)+2500;da.position.z*=Math.random()*5E3+2500;da.rotation.x=-90*Math.PI/
180;da.scale.x=Math.random()*2+1;da.scale.y=Math.random()*2+1;da.doubleSided=!0;O.addChild(da)}});var G=new THREE.Mesh(new THREE.Plane(4050,4050,81,81),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0}));G.position.y=-25;G.rotation.x=-90*Math.PI/180;O.addChild(G);var L=new THREE.WebGLRenderer({stencil:!1});L.domElement.style.position="absolute";L.setSize(window.innerWidth,window.innerHeight);L.setClearColor(n.scene.fog.color);L.sortObjects=!1;L.autoClear=!1;v.appendChild(L.domElement);
this.getDomElement=function(){return v};this.load=function(){function Q(ka,$,ha){ka=ka||300;$=$||180;ha=ha||7;var qa=document.createElement("canvas"),sa=U.position.clone(),va=45,ua=360/ha;qa.width=ka;qa.height=$*ha;var ta=L.domElement,Da=ta.width,Ba=ta.height,Fa=qa.getContext("2d");n.resize(ka,$);t.getPainter().hideBrush();G.visible=!1;var ya=t.getPainter().getObject().getMesh().geometry.vertices,V=ya[0].position.x,ia=ya[0].position.y,fa=ya[0].position.z,ca=ya[0].position.x,Ca=ya[0].position.y,Va=
ya[0].position.z,A,S;for(S in ya){ya[S].position.x>V&&(V=ya[S].position.x);ya[S].position.y>ia&&(ia=ya[S].position.y);ya[S].position.z>fa&&(fa=ya[S].position.z);ya[S].position.x<ca&&(ca=ya[S].position.x);ya[S].position.y<Ca&&(Ca=ya[S].position.y);ya[S].position.z<Va&&(Va=ya[S].position.z)}ya=(ca+V)/2;A=(Va+fa)/2;D=2*Math.max(V-ca,Math.max(ia-Ca,fa-Va));U.target.position.set(ya,(Ca+ia)/2,A);for(S=0;S<ha;S++){U.position.x=D*Math.sin(va*w)*Math.cos(35*w)+ya;U.position.y=D*Math.sin(35*w);U.position.z=
D*Math.cos(va*w)*Math.cos(35*w)+A;L.clear();L.render(n.scene,U);Fa.drawImage(ta,0,0,ka,$,0,$*S,ka,$);va+=ua}U.target.position.set(0,0,0);n.resize(Da,Ba);ka=qa.toDataURL("image/png");delete qa;U.position.copy(sa);G.visible=!0;L.clear();L.render(n.scene,U);return ka}var M=signals.Signal;b.ugcSignals={};b.ugcSignals.showintro=new M;b.ugcSignals.showobjectcreator=new M;b.ugcSignals.showsoupcreator=new M;b.ugcSignals.object_mode=new M;b.ugcSignals.soup_mode=new M;b.ugcSignals.object_createmode=new M;b.ugcSignals.object_erasemode=
new M;b.ugcSignals.object_symmetrymode=new M;b.ugcSignals.object_rotatemode=new M;b.ugcSignals.object_changecolor=new M;b.ugcSignals.object_colormode=new M;b.ugcSignals.object_changesize=new M;b.ugcSignals.object_zoomin=new M;b.ugcSignals.object_zoomout=new M;b.ugcSignals.submit_dialogue=new M;b.ugcSignals.submit=new M;b.ugcSignals.object_smoothup=new M;b.ugcSignals.object_smoothdown=new M;b.ugcSignals.object_undo=new M;b.ugcSignals.object_requestsnapshot=new M;b.ugcSignals.object_receivesnapshot=
new M;o=new UgcIntro(b);v.appendChild(o.getDomElement());t=new UgcObjectCreator(b,U,n.scene);u=new UgcUI(b);u.getDomElement().style.position="absolute";u.getDomElement().style.left="0px";u.getDomElement().style.top="0px";u.getDomElement().style.display="none";v.appendChild(u.getDomElement());u.addListeners();b.ugcSignals.showintro.add(function(){h=null;t.disable();o.getDomElement().style.display="block";u.getDomElement().style.display="none";t.getPainter().clear()});b.ugcSignals.showobjectcreator.add(function(ka){h=
ka;o.getDomElement().style.display="none";t.enable();u.setType(ka);u.getDomElement().style.display="block";switch(h){case 0:t.getPainter().getObject().setType(UgcObject.TYPE_GROUND);var $={theta:E,phi:F};(new TWEEN.Tween($)).to({theta:45,phi:15},2E3).easing(TWEEN.Easing.Exponential.EaseOut).onUpdate(function(){E=$.theta;F=$.phi}).start();(new TWEEN.Tween(O.position)).to({y:0},3E3).easing(TWEEN.Easing.Exponential.EaseOut).start();break;case 1:t.getPainter().getObject().setType(UgcObject.TYPE_SKY);
$={theta:E,phi:F};(new TWEEN.Tween($)).to({theta:45,phi:15},2E3).easing(TWEEN.Easing.Exponential.EaseOut).onUpdate(function(){E=$.theta;F=$.phi}).start();(new TWEEN.Tween(O.position)).to({y:-5E3},3E3).easing(TWEEN.Easing.Exponential.EaseOut).start()}(new TWEEN.Tween(U.target.position)).to({y:20},1E3).easing(TWEEN.Easing.Exponential.EaseOut).start()});b.ugcSignals.object_createmode.add(function(){x=!1});b.ugcSignals.object_erasemode.add(function(){x=!1});b.ugcSignals.object_rotatemode.add(function(){x=
!0});b.ugcSignals.object_zoomin.add(function(){e(-200)});b.ugcSignals.object_zoomout.add(function(){e(200)});b.ugcSignals.object_requestsnapshot.add(function(){var ka=Q(735,465);b.ugcSignals.object_receivesnapshot.dispatch(ka)});var da=new UgcHandler;b.ugcSignals.submit.add(function(ka,$){var ha=Q(),qa=t.getPainter().getObject();qa={title:ka,email:$,category:qa.getType(),data:qa.getJSON()};da.submitUGO(qa,ha,function(sa){if(sa.success)window.location="/gallery";else alert("There was an error submitting your model. Please try again in a moment.")})})};
this.show=function(){b.signals.mousedown.add(c);b.signals.mouseup.add(d);b.signals.mousemoved.add(f);b.signals.mousewheel.add(g);v.style.display="block";t.show();b.ugcSignals.showintro.dispatch();v.addEventListener("contextmenu",m,!1)};this.hide=function(){b.signals.mousedown.remove(c);b.signals.mouseup.remove(d);b.signals.mousemoved.remove(f);b.signals.mousewheel.remove(g);v.style.display="none";t.hide();v.removeEventListener("contextmenu",m,!1)};this.resize=function(Q,M){o.resize(Q,M);U.aspect=
Q/M;U.updateProjectionMatrix();b.viewportWidth=Q;b.viewportHeight=M;L.setSize(Q,M);L.domElement.style.left="0px";L.domElement.style.top="0px"};this.update=function(){TWEEN.update();h==null&&(E=(E+=0.1)%360);u.update();D+=(T-D)/20;U.position.x=D*Math.sin(E*w)*Math.cos(F*w);U.position.y=D*Math.sin(F*w);U.position.z=D*Math.cos(E*w)*Math.cos(F*w);L.clear();L.render(n.scene,U)}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b,e){function c(){if(!e){o.x=b.mouse.x/b.screenWidth*100-50;o.y=b.mouse.y/b.screenHeight*60-30;t=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}}function d(G){for(var L=0;L<2;L++){f=n[L]=new Boid;f.position.x=320;f.position.y=20+Math.random()*10;f.position.z=200+Math.random();f.velocity.x=Math.random()*2-1;f.velocity.y=Math.random()*2-1;f.velocity.z=Math.random()*2-1;f.setAvoidWalls(!0);f.setWorldSize(1E3,200,400);h[L]=new ROME.Animal(G,!0);h[L].timeOffset=
Math.random()*100;g=m[L]=h[L].mesh;g.phase=Math.floor(Math.random()*62.8);g.rotation.set(0,-0.5,0);g.updateMatrix();g.update();window.morphObject=h[L];h[L].play(h[L].availableAnimals[0],h[L].availableAnimals[0]);g.position=n[L].position;g.doubleSided=!1;g.scale.x=g.scale.y=g.scale.z=0.03+0.05*Math.random();E.addChild(g)}F.position.z=-4E3;C.addObject(F);D.position.z=0;C.addObject(D);H.addObject(E)}var f,g,m=[],n=[],h=[],o={x:0,y:0},t={x:0,y:0,z:0},u,v,w=start_time=(new Date).getTime(),x,y,C,B,H,z,
E,F,D,T,W,U,Y,N,p;W=new THREE.Fog(5413329,-100,3E3);x=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);x.position.z=6E3;C=new THREE.Scene;H=new THREE.Scene;E=new THREE.Object3D;T=new THREE.Geometry;var O=THREE.ImageUtils.loadTexture("/files/cloud256.png",null,function(){U=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:O},fogColor:{type:"c",value:W.color},fogNear:{type:"f",value:W.near},fogFar:{type:"f",value:W.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var G=new THREE.Mesh(new THREE.Plane(64,64)),L=0;L<4E3;L++){G.position.x=
Math.random()*1E3-500;G.position.y=e?-Math.random()*Math.random()*200+25:-Math.random()*Math.random()*200-15;G.position.z=L;G.rotation.z=Math.random()*Math.PI;G.scale.x=G.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(T,G)}F=new THREE.Mesh(T,U);D=new THREE.Mesh(T,U);(new THREE.JSONLoader).load({model:"/files/models/soup/birds_B_life.js",callback:d})});O.magFilter=THREE.LinearMipMapLinearFilter;O.minFilter=THREE.LinearMipMapLinearFilter;z=new THREE.WebGLRenderer({antialias:!1,clearColor:0,
clearAlpha:0});z.domElement.style.position="absolute";z.domElement.style.left="0px";z.domElement.style.top="0px";z.getContext();z.sortObjects=!1;z.autoClear=!1;N=new THREE.WebGLRenderTarget(512,512,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});p=new THREE.WebGLRenderTarget(1024,512,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});N.depthBuffer=!1;N.stencilBuffer=!1;p.depthBuffer=!1;p.stencilBuffer=!1;window.renderTargetClouds=N;y=new THREE.Camera;y.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);B=new THREE.Scene;Y=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:N},tFlamingos:{type:"t",value:1,texture:p},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:W.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos *= 1./4.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.15*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
B.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),Y));this.getDomElement=function(){return z.domElement};this.show=function(){b.signals.mousemoved.add(c)};this.hide=function(){b.signals.mousemoved.remove(c)};this.resize=function(G,L){x.aspect=G/L;x.updateProjectionMatrix();z.setSize(G,L);z.domElement.style.width=G+"px";z.domElement.style.height=L+"px"};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;v=(new Date).getTime();u=v-w;w=v;x.position.x+=
(o.x-x.position.x)*0.0090;x.position.y+=(-o.y-x.position.y)*0.0090;x.position.z=-position+4E3;E.position.z=x.position.z-500;E.position.y=-50;x.target.position.x=x.position.x;x.target.position.y=x.position.y;x.target.position.z=x.position.z-1E3;z.clear();z.render(C,x,N,!0);z.render(H,x,p,!0);z.render(B,y);for(var G=0,L=m.length;G<L;G++){f=n[G];t.z=f.position.z;f.run(n);g=m[G];g.rotation.y=Math.atan2(-f.velocity.z,f.velocity.x)+Math.PI/2;g.rotation.z=Math.asin(f.velocity.y/f.velocity.length());g.phase=
(g.phase+(Math.max(0,g.rotation.z)+0.1))%62.83;h[G].update(u*g.phase/100)}}},Boid=function(){var b=new THREE.Vector3,e,c=500,d=500,f=200,g,m=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;e=new THREE.Vector3;this.setGoal=function(n){g=n};this.setAvoidWalls=function(n){m=n};this.setWorldSize=function(n,h,o){c=n;d=h;f=o};this.run=function(n){if(m){b.set(-c*15,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(c,this.position.y,this.position.z);
b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,0,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,d,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,-f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b)}Math.random()>0.5&&this.flock(n);this.move()};this.flock=function(n){g&&e.addSelf(this.reach(g,
0.0050));e.addSelf(this.alignment(n));e.addSelf(this.cohesion(n));e.addSelf(this.separation(n))};this.move=function(){this.velocity.addSelf(e);var n=this.velocity.length();n>0.6&&this.velocity.divideScalar(n/0.6);this.position.addSelf(this.velocity);e.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>d)this.position.y=-d;if(this.position.y<-d)this.position.y=d;if(this.position.z>f)this.position.z=-f;if(this.position.z<
-f)this.position.z=f};this.avoid=function(n){var h=new THREE.Vector3;h.copy(this.position);h.subSelf(n);h.multiplyScalar(1/this.position.distanceToSquared(n));return h};this.repulse=function(n){var h=this.position.distanceTo(n);if(h<150){var o=new THREE.Vector3;o.sub(this.position,n);o.multiplyScalar(0.5/h);e.addSelf(o)}};this.reach=function(n,h){var o=new THREE.Vector3;o.sub(n,this.position);o.multiplyScalar(h);return o};this.alignment=function(n){for(var h,o=new THREE.Vector3,t=0,u=0,v=n.length;u<
v;u++)if(!(Math.random()>0.6)){h=n[u];distance=h.position.distanceTo(this.position);if(distance>0&&distance<=3E3){o.addSelf(h.velocity);t++}}if(t>0){o.divideScalar(t);n=o.length();n>0.03&&o.divideScalar(n/0.03)}return o};this.cohesion=function(n){for(var h,o,t=new THREE.Vector3,u=new THREE.Vector3,v=0,w=0,x=n.length;w<x;w++)if(!(Math.random()>0.6)){h=n[w];o=h.position.distanceTo(this.position);if(o>0&&o<=3E3){t.addSelf(h.position);v++}}v>0&&t.divideScalar(v);u.sub(t,this.position);n=u.length();n>
0.03&&u.divideScalar(n/0.03);return u};this.separation=function(n){for(var h,o,t=new THREE.Vector3,u=new THREE.Vector3,v=0,w=n.length;v<w;v++)if(!(Math.random()>0.6)){h=n[v];o=h.position.distanceTo(this.position);if(o>0&&o<=3E3){u.sub(this.position,h.position);u.normalize();u.divideScalar(o);t.addSelf(u)}}return t}},UgcIntro=function(b){var e=document.createElement("div");e.style.position="absolute";e.style.width=window.innerWidth+"px";e.style.height=window.innerHeight+"px";e.style.background="rgba(0,0,0,0.75)";
var c=document.createElement("div");c.style.position="absolute";c.style.left=window.innerWidth/2-384+"px";c.style.top=window.innerHeight/2-97+"px";c.style.width="272px";c.style.height="137px";c.style.background="url(/files/ugcIntro/instructions.png) 0 0 no-repeat";e.appendChild(c);var d=document.createElement("div");d.style.position="absolute";d.style.left=window.innerWidth/2+38+"px";d.style.top=window.innerHeight/2-197+"px";d.style.width="234px";d.style.height="71px";d.style.overflow="hidden";d.style.cursor=
"pointer";var f=document.createElement("img");f.setAttribute("src","/files/ugcIntro/sky.png");f.setAttribute("alt","SKY");f.style.display="block";d.appendChild(f);var g=document.createElement("div");g.style.position="absolute";g.style.left=window.innerWidth/2+54+"px";g.style.top=window.innerHeight/2+62+"px";g.style.width="197px";g.style.height="71px";g.style.overflow="hidden";g.style.cursor="pointer";var m=document.createElement("img");m.setAttribute("src","/files/ugcIntro/ground.png");m.setAttribute("alt",
"GROUND");m.style.display="block";g.appendChild(m);e.appendChild(d);e.appendChild(g);d.addEventListener("mouseover",function(){f.style.marginTop="-71px"},!1);d.addEventListener("mouseout",function(){f.style.marginTop="0px"},!1);d.addEventListener("click",function(){b.ugcSignals.showobjectcreator.dispatch(1)},!1);g.addEventListener("mouseover",function(){m.style.marginTop="-71px"},!1);g.addEventListener("mouseout",function(){m.style.marginTop="0px"},!1);g.addEventListener("click",function(){b.ugcSignals.showobjectcreator.dispatch(0)},
!1);this.show=function(){};this.resize=function(n,h){e.style.width=n+"px";e.style.height=h+"px";c.style.left=n/2-384+"px";c.style.top=h/2-97+"px";d.style.left=n/2+38+"px";d.style.top=h/2-197+"px";g.style.left=n/2+54+"px";g.style.top=h/2+62+"px"};this.hide=function(){};this.getDomElement=function(){return e};this.update=function(){}};
function ColorPicker(b){function e(){C.clearRect(0,0,H,z);C.drawImage(U==0?T:W,t,t);C.fillStyle="rgba(0,0,0,"+(1-Y/100)+")";C.save();C.translate(H/2,z/2);C.rotate(Math.PI/2);c(177,0,0);C.fill();C.restore();var N=B.createLinearGradient(t,0,H-t,0),p=new DAT.Color(D);p.v=100;N.addColorStop(0,p.toString());N.addColorStop(1,"#000");B.strokeStyle="#fff";B.lineWidth=3;B.clearRect(0,0,H,z);B.fillStyle=N;B.fillRect(t,t,H-t*2,u);c(u/2+5.5,(1-Math.round(D.v)/100)*(H-t*2)+t,t+u/2,B);B.fill();B.stroke()}function c(N,
p,O,G){G=G||C;G.beginPath();G.moveTo(Math.cos(0)*N+p,Math.sin(0)*N+O);for(var L=0,Q=0;L<=6;L++,Q=L/6*Math.PI*2)G.lineTo(Math.cos(Q)*N+p,Math.sin(Q)*N+O)}function d(N,p){N=N||E;p=p||F;E=N;F=p;C.fillStyle=D.toString();C.strokeStyle="#fff";C.lineWidth=3;C.save();C.translate(N,p);C.rotate(Math.PI/2);c(20,0,0);C.restore();C.fill();C.stroke()}function f(N){N.stopImmediatePropagation();N.stopPropagation();document.removeEventListener("mousemove",n,!1);document.removeEventListener("mousemove",g,!1);document.removeEventListener("mouseup",
f,!1);o.onColorChange(D.hex)}function g(N){N.stopImmediatePropagation();N.stopPropagation();N=N.pageX-m(w).left;if(N>=t&&N<=H-t){Y=100-(N-t)/(H-t*2)*100;D.v=Y;e();d()}}function m(N){var p=0,O=0;if(N.offsetParent){do{p+=N.offsetLeft;O+=N.offsetTop}while(N=N.offsetParent)}return{left:p,top:O}}function n(N){N.stopImmediatePropagation();N.stopPropagation();var p=m(x),O=N.pageX-p.left;N=N.pageY-p.top;if(h(O,N)){e();d(O,N)}}function h(N,p){N=N||E;p=p||F;var O=y.getImageData(N,p,1,1).data;if(O[3]<255)return!1;
D.r=O[0];D.g=O[1];D.b=O[2];D.v=Y;return!0}var o=this,t=20,u=20,v=document.createElement("canvas"),w=document.createElement("canvas");w.style.position="relative";var x=document.createElement("canvas");x.style.position="relative";x.style.top=0;this.domElement=document.createElement("div");this.domElement.setAttribute("id","ugcui-color-picker");var y,C,B,H,z,E,F,D=new DAT.Color(255,255,255),T=document.createElement("img"),W=document.createElement("img");T.src="/files/wheel.png";W.src="/files/wheel-sky.png";
var U=0,Y=100;this.onColorChange=function(){};this.setType=function(N){U=N;if(N==1){w.style.display="none";y.drawImage(W,t,t)}else{w.style.display="block";y.drawImage(T,t,t)}h();o.onColorChange(D.hex);e();d()};T.onload=function(){H=w.width=v.width=x.width=T.width+t*2;z=v.height=x.height=T.height+t*2;w.height=u+t*2;B=w.getContext("2d");o.domElement.appendChild(x);o.domElement.appendChild(w);b.appendChild(o.domElement);y=v.getContext("2d");y.drawImage(T,t,t);C=x.getContext("2d");B.shadowBlur=C.shadowBlur=
4;B.shadowColor=C.shadowColor="rgba(0,0,0,0.3)";E=H/2;F=z/2;e();d()};x.addEventListener("mousedown",function(N){N.stopImmediatePropagation();N.stopPropagation();n(N);document.addEventListener("mousemove",n,!1);document.addEventListener("mouseup",f,!1)},!1);w.addEventListener("mousedown",function(N){N.stopImmediatePropagation();N.stopPropagation();g(N);document.addEventListener("mousemove",g,!1);document.addEventListener("mouseup",f,!1)},!1)}
var UgcUI=function(b){function e(G,L){var Q=document.createElement(G);Q.setAttribute("class",L);return Q}function c(G,L){var Q=document.createElement(G);Q.setAttribute("id",L);return Q}function d(G,L){var Q;Q=typeof G=="string"?document.getElementById(G):G;Q.addEventListener("mouseup",function(){L.call(Q)},!1)}function f(){H.style.zIndex="-20";z.style.top="200%";z.style.opacity=0;F.value=t;D.value="YOUR EMAIL ADDRESS";m(document.getElementById("agree-terms"),"error");document.getElementById("agree").checked=
!1;U=!1}function g(G,L){G.getAttribute("class").indexOf(L)==-1&&G.setAttribute("class",G.getAttribute("class")+" "+L)}function m(G,L){if(G.getAttribute("class").indexOf(L)!=-1){var Q;G.setAttribute("class",G.getAttribute("class").replace(RegExp(" "+L,"g"),""))}}function n(){var G=e("div","animal"),L=e("img","animal-thumb");L.src="/files/soupthumbs/test.png";L.style.position="absolute";var Q=e("div","animal-controls"),M=e("div","animal-count");M.style.font="12px/22px FuturaBT-Bold";M.innerHTML="0";
var da=e("div","animal-add");da.style.font="12px/22px FuturaBT-Bold";da.innerHTML="+";var ka=e("div","animal-remove");ka.style.font="12px/22px FuturaBT-Bold";ka.innerHTML="-";G.appendChild(L);Q.appendChild(ka);Q.appendChild(M);Q.appendChild(da);G.appendChild(Q);return G}function h(G){if(!(G==undefined||G.style==undefined)){G.onselectstart=function(){return!1};G.style.MozUserSelect="none";G.style.KhtmlUserSelect="none";G.unselectable="on";G=G.childNodes;for(var L=0;L<G.length;L++)h(G[L])}}var o=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,
t="GIVE YOUR DREAM A TITLE",u=0,v=0,w=document.createElement("div"),x=document.createElement("style");x.setAttribute("type","text/css");x.innerHTML='.ugcui { position: fixed;  } \n#ugcui-top-right { position: fixed; top: 40px; right: 40px; } \n#ugcui-bottom-right { position: fixed; bottom: 40px; right: 40px; z-index: 5 } \n#ugcui-top-left { position: fixed; top: 10px; left: 35px; } \n#ugcui-bottom-left { position: fixed; bottom: 120px; left: 35px; } \n.ugcui g.button {\n  cursor: pointer;\n}\n.ugcui g.button polygon.hex {\n  fill: rgba(255, 255, 255, 0.7);\n}\n.ugcui g.button:not(.disabled):hover polygon.hex {\n  fill: #fff;\n}\n.ugcui g.button.active polygon.hex {\n  fill: #F15C22;\n}\n.ugcui g.button.active:hover polygon.hex {\n  fill: #F77952;\n}\n.ugcui g.folder g.options, .ugcui g.folder polygon.hitbox {\n  display: none;\n}\n.ugcui g.disabled { opacity: 0.1; cursor: auto; }\n.ugcui g.folder:hover g.options {\n  display: block;\n}\n.ugcui g.folder:hover #ugcui-zoom-folder polygon.hex { fill: #fff; }\n.ugcui g.folder polygon.hitbox {\n  display: block; fill-opacity: 0;\n}\n#ugcui-size g.button.active polygon.hex { fill: rgba(255, 255, 255, 0.7); }\n#ugcui-size:hover g.button.active polygon.hex { fill: #F15C22; }\n#ugcui-size:hover g.button.active:hover polygon.hex { fill: #F77952; }\n#agree-terms.error { background-color: rgba(255, 0, 0, 0.3); }\n#voxel-submit-text { float: left; width: 300px; margin-right: 10px; }\n#voxel-submit-inputs { margin-right: 10px; margin-top: -4px; float: left; }\n#voxel-submit-submit { cursor: pointer; letter-spacing: 0.025em; font: 17px/65px FuturaBT-Bold, sans-serif; float: left; border: 1px solid #d6d1c2; width: 200px; text-align: center; margin-top: -2px;  }\n#voxel-submit-submit:hover { border-color: #404040; background-color: #404040; color: #f4f1e8; }\n#voxel-submit input[type="text"] { margin-bottom: 3px; color: #404040; font: 11px/22px FuturaBT-Bold, sans-serif; width: 200px; padding: 2px 4px  }\n#voxel-submit a { color: #000 } \n#voxel-submit-image { margin-bottom: 20px; width: 735px; height: 465px; background-color: #000; }\n#voxel-submit-shade { z-index: -12; opacity: 0.4; -webkit-transition: opacity 0.2s linear; background-color: #f4f1e8; position: fixed; top: 0; left: 0; width: 100%; height: 100% }\n#voxel-submit { font: 12px/18px FuturaBT-Medium; color: #404040; z-index: 21; opacity: 0; -webkit-transition: opacity 0.2s linear; width: 735px; height: 556px; padding: 13px; margin-left: -380px; margin-top: -291px; background-color: #f4f1e8; box-shadow: 0px 0px 10px rgba(0,0,0,0.3) }\n#voxel-submit small { line-height: 15px; display: block; margin-top: 7px }\n.animal-container { opacity: 1; -webkit-transition: opacity 0.3s linear; }\n.animal { text-align: center; -webkit-transition: all 0.1s linear; float: left; height: 92px; background: url(/files/soupthumbs/shadow.png); border: 1px solid rgba(0,0,0,0); width: 120px; margin-right: 10px; }\n.animal:hover { background-color: rgba(255, 255, 255, 0.4); border: 1px solid #fff; }\n.animal-controls { height: 21px; overflow:hidden; line-height: 0px; border-right: 1px solid #fff; opacity: 0; display: inline-block; position: relative; margin-top: 71px; }\n.animal:hover .animal-controls { opacity: 1; }\n.animal-controls div { display: none; text-align: center; border: 1px solid #fff; border-right: 0; border-bottom: 0; display: inline-block; width: 20px;}\n.animal-controls div.animal-add:hover, .animal-controls div.animal-remove:hover { cursor: pointer; background-color: #f65824; }\n.animal-controls div.animal-count { background-color: #fff; color: #777; width: 25px; }';
document.getElementsByTagName("head")[0].appendChild(x);w.innerHTML+='<svg class="ugcui" id="ugcui-top-left" version="1.1"\n     xmlns="http://www.w3.org/2000/svg"\n     xmlns:xlink="http://www.w3.org/1999/xlink"\n     xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n     x="0px" y="0px" width="800px" height="600px" viewBox="0 -1.338 800 600"\n     enable-background="new 0 -1.338 800 600"\n     xml:space="preserve" >\n    <g class="button" title="Symmetry Mode [s]" id="ugcui-reflect">\n      <polygon class="hex"\n               points="13.126,93.332 0,70.598 13.126,47.862 39.377,47.862 52.503,70.598 39.377,93.332 "/>\n      <path fill="#404040" d="M26.195,77.438c-0.428,0-0.771,0.345-0.771,0.771v1.158c0,0.428,0.343,0.772,0.771,0.772\n  s0.771-0.345,0.771-0.772v-1.158C26.966,77.783,26.623,77.438,26.195,77.438 M26.195,73.965c-0.428,0-0.771,0.344-0.771,0.771v1.158\n  c0,0.425,0.343,0.771,0.771,0.771s0.771-0.346,0.771-0.771v-1.158C26.966,74.309,26.623,73.965,26.195,73.965 M20.23,64.94\n  l-4.149-4.594c-0.238-0.262-0.61-0.351-0.939-0.224c-0.327,0.125-0.545,0.441-0.545,0.794v9.187v9.188\n  c0,0.351,0.218,0.667,0.545,0.793c0.1,0.039,0.203,0.057,0.306,0.057c0.235,0,0.467-0.098,0.633-0.28l4.149-4.594l4.149-4.593\n  c0.293-0.324,0.293-0.817,0-1.142L20.23,64.94z M18.968,74.126l-2.667,2.952v-6.976v-6.976l2.667,2.955l3.632,4.021L18.968,74.126z\n  M28.011,69.532c-0.292,0.324-0.292,0.817,0,1.142l4.149,4.593l4.149,4.594c0.165,0.183,0.397,0.28,0.633,0.28\n  c0.103,0,0.205-0.018,0.306-0.057c0.327-0.126,0.544-0.442,0.544-0.793v-9.188v-9.187c0-0.353-0.216-0.669-0.544-0.794\n  c-0.33-0.127-0.702-0.038-0.938,0.224L32.16,64.94L28.011,69.532z M29.79,70.103l3.634-4.021l2.667-2.955v6.976v6.976l-2.667-2.952\n  L29.79,70.103z M26.195,70.489c-0.428,0-0.771,0.345-0.771,0.772v1.159c0,0.427,0.343,0.772,0.771,0.772s0.771-0.345,0.771-0.772\n  v-1.159C26.966,70.834,26.623,70.489,26.195,70.489 M26.195,60.066c-0.428,0-0.771,0.346-0.771,0.772v1.158\n  c0,0.427,0.343,0.773,0.771,0.773s0.771-0.347,0.771-0.773v-1.158C26.966,60.412,26.623,60.066,26.195,60.066 M26.195,63.541\n  c-0.428,0-0.771,0.345-0.771,0.772v1.158c0,0.428,0.343,0.771,0.771,0.771s0.771-0.343,0.771-0.771v-1.158\n  C26.966,63.886,26.623,63.541,26.195,63.541 M26.195,67.014c-0.428,0-0.771,0.346-0.771,0.772v1.158\n  c0,0.426,0.343,0.772,0.771,0.772s0.771-0.346,0.771-0.772v-1.158C26.966,67.36,26.623,67.014,26.195,67.014"/>\n    </g>\n    <g class="button active" title="Draw [d]" id="ugcui-create">\n      <polygon class="hex" points="54.576,69.401 41.45,46.666 54.576,23.932 80.828,23.932 93.954,46.666\n  80.827,69.401 "/>\n      <path fill="#404040" d="M67.92,32.249l-12.121,7.29l-0.154-0.098v13.47l12.256,7.661l12.258-7.661V40.265L67.92,32.249z\n  M67.883,34.149l9.991,6.543l-9.978,6.405l-10.564-6.602L67.883,34.149z M57.255,42.346l9.842,6.151v9.673l-9.842-6.151V42.346z\n  M78.548,52.019l-9.842,6.15v-9.679l9.842-6.318V52.019z"/>\n    </g>\n    <g class="button" title="Erase [e]" id="ugcui-erase">\n      <polygon class="hex" points="96.026,93.332 82.9,70.598 96.026,47.862 122.277,47.862 135.404,70.597\n  122.277,93.332 "/>\n      <path fill="#404040" d="M111.728,61.285l-13.493,7.131v5.163l9.462,5.387l13.086-7.798v-4.968L111.728,61.285z M113.478,69.723\n  l-5.788,3.394l-7.658-4.416l6.083-3.215L113.478,69.723z M108.238,74.062l5.928-3.477v3.252l-5.928,3.534V74.062z M99.328,69.556\n  l7.817,4.509v3.328l-7.817-4.45V69.556z"/>\n    </g>\n    <g class="button" title="Fill Color [f]" id="ugcui-color">\n      <polygon class="hex" points="96.026,141.194 82.9,118.46 96.026,95.725 122.277,95.725 135.404,118.459\n  122.277,141.194 "/>\n      <path fill="#404040" d="M121.346,114.964c-2.85-3.684-8.097-1.808-8.097-1.808s3.946,3.913,5.455,5.42\n  c1.633,1.633,2.081,10.199,3.058,8.201C123.29,123.65,123.54,117.801,121.346,114.964 M110.458,110.993v2.259l6.309,6.309\n  l-10.072,10.071l-8.699-8.697l10.074-10.073l0.27,0.271v-2.149c-0.084-0.031-0.176-0.049-0.27-0.049\n  c-0.213,0-0.414,0.082-0.565,0.233l-11.202,11.204c-0.312,0.311-0.312,0.817,0,1.129l9.827,9.828\n  c0.152,0.151,0.352,0.235,0.565,0.235c0.211,0,0.413-0.084,0.565-0.235l11.202-11.203c0.151-0.152,0.235-0.353,0.235-0.565\n  c0-0.214-0.084-0.413-0.236-0.563L110.458,110.993z M101.645,108.202c0.001-0.733,0.593-1.325,1.324-1.326h4.543\n  c0.729,0.001,1.322,0.593,1.323,1.324v8.447c-0.212,0.081-0.41,0.205-0.579,0.374c-0.321,0.32-0.485,0.748-0.483,1.17\n  c-0.001,0.421,0.163,0.85,0.484,1.172c0.322,0.323,0.749,0.487,1.173,0.485h0.004c0.419,0,0.844-0.162,1.167-0.484l-0.396-0.397\n  l0.398,0.396c0.321-0.322,0.484-0.75,0.484-1.172s-0.163-0.85-0.485-1.171c-0.186-0.186-0.407-0.313-0.642-0.391v-8.429\n  c0-1.353-1.095-2.449-2.448-2.449h-4.543c-1.353,0-2.45,1.096-2.45,2.451v7.208l1.126-1.126V108.202z M109.053,117.816\n  c0.107-0.107,0.239-0.156,0.378-0.158c0.137,0.001,0.271,0.051,0.374,0.156c0.107,0.106,0.155,0.239,0.155,0.376\n  c0,0.136-0.049,0.271-0.155,0.378c-0.104,0.104-0.239,0.153-0.374,0.153c-0.139,0-0.272-0.051-0.377-0.154\n  c-0.104-0.105-0.155-0.24-0.155-0.377C108.9,118.053,108.95,117.92,109.053,117.816"/>\n    </g>\n        <g class="button" title="Large" transform="translate(41.5 ,-23)" id="ugcui-size-med">\n          <polygon class="hex" points="13.126,188.696 0,165.962 13.126,143.227 39.377,143.227 52.503,165.962\n    39.377,188.696 "/>\n          <path fill="#404040" d="M35.384,164.724v-9.757l-8.837-4.797l-9.248,4.927v9.452l-9.613,5.704l18.509,11.5l18.509-11.5\n    L35.384,164.724z M20.675,170.283l2.864-1.765l2.803,1.666l2.609-1.564l2.74,1.678l-5.496,3.367L20.675,170.283z M25.674,173.983\n    l-5.517,3.378l-5.459-3.391l5.458-3.367L25.674,173.983z M34.889,165.062l2.718,1.612l-5.395,3.305l-2.734-1.674L34.889,165.062z\n    M23.011,168.204l-2.856,1.761l-5.373-3.291l2.832-1.68L23.011,168.204z M32.212,170.616l5.478,3.354l-5.458,3.391l-5.517-3.378\n    L32.212,170.616z M32.732,170.297l5.404-3.31l5.52,3.276l-5.45,3.386L32.732,170.297z M14.253,166.988l5.383,3.297l-5.454,3.364\n    l-5.449-3.385L14.253,166.988z M20.675,177.683l5.52-3.381l5.519,3.381l-5.519,3.429L20.675,177.683z"/>\n        </g>\n      </g>\n      <g class="button active" title="Small" id="ugcui-size-small">\n        <polygon class="hex" points="13.126,141.194 0,118.46 13.126,95.725 39.377,95.725 52.503,118.46 39.377,141.194\n    "/>\n        <path fill="#404040" d="M32.34,113.829v-6.316l-6.006-3.258l-6.285,3.118v6.456l-12.364,7.334l18.509,11.5l18.509-11.5\n    L32.34,113.829z M20.676,121.195l5.477-3.378l5.539,3.391l-5.497,3.367L20.676,121.195z M25.674,124.894l-5.517,3.378l-5.457-3.391\n    l5.457-3.367L25.674,124.894z M29.156,115.964l2.936-1.65l5.515,3.272l-5.395,3.304l-5.541-3.393L29.156,115.964z M20.366,114.272\n    l5.266,3.226l-5.476,3.378l-5.374-3.29L20.366,114.272z M32.212,121.527l5.477,3.354l-5.457,3.39l-5.517-3.378L32.212,121.527z\n    M32.733,121.208l5.403-3.309l5.52,3.274l-5.45,3.386L32.733,121.208z M14.253,117.899l5.384,3.297l-5.454,3.364l-5.45-3.386\n    L14.253,117.899z M20.675,128.594l5.521-3.381l5.52,3.38l-5.52,3.43L20.675,128.594z"/>\n      </g>\n    </g>\n</svg>';
w.innerHTML+='<svg class="ugcui" id="ugcui-top-right" version="1.1"\n\t xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n\t x="0px" y="0px" width="70px" height="70px" viewBox="-2 -2 60 60"\n\t xml:space="preserve">\n<g transform="translate(-1, 0)" class="button" id="ugcui-quit">\n<polygon class="hex" points="13.126,45.469 0,22.735 13.126,0 39.377,0 52.504,22.735 39.377,45.469 "/>\n<path fill="#222222" d="M22.568,23.39c0-1.193-0.437-2.16-1.309-2.901c-0.726-0.617-1.547-0.925-2.462-0.925\n\tc-1.01,0-1.885,0.352-2.626,1.056c-0.764,0.726-1.145,1.632-1.145,2.719c0,1.109,0.403,2.02,1.21,2.733\n\tc0.741,0.648,1.59,0.972,2.546,0.972c0.738,0,1.408-0.193,2.01-0.58l0.564,0.58h1.369l-1.191-1.164\n\tC22.224,25.155,22.568,24.325,22.568,23.39z M20.778,25.096l-1.046-1.041h-1.407l1.696,1.644c-0.38,0.215-0.805,0.322-1.275,0.322\n\tc-0.691,0-1.307-0.255-1.846-0.766c-0.517-0.495-0.775-1.131-0.775-1.909c0-0.796,0.251-1.455,0.752-1.975\n\tc0.499-0.523,1.134-0.784,1.906-0.784c0.764,0,1.402,0.261,1.916,0.784s0.771,1.172,0.771,1.947\n\tC21.47,24.024,21.239,24.617,20.778,25.096z"/>\n<path fill="#222222" d="M28.188,24.041c0,0.629-0.102,1.082-0.304,1.359c-0.303,0.414-0.729,0.621-1.28,0.621\n\tc-0.548,0-0.974-0.207-1.275-0.621c-0.203-0.287-0.304-0.739-0.304-1.359v-4.342h-1.089v4.644c0,0.76,0.236,1.386,0.71,1.878\n\tc0.53,0.548,1.183,0.822,1.958,0.822s1.43-0.274,1.962-0.822c0.474-0.492,0.711-1.118,0.711-1.878v-4.644h-1.089V24.041z"/>\n<rect x="31.006" y="19.699" fill="#222222" width="1.089" height="7.214"/>\n<polygon fill="#222222" points="33.071,19.699 33.071,20.722 34.729,20.722 34.729,26.913 35.818,26.913 35.818,20.722 \n\t37.473,20.722 37.473,19.699 "/>\n</g>\n</svg>';
w.innerHTML+='<svg id="ugcui-bottom-right" class="ugcui" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t x="0px" y="0px" width="70px" height="70px" viewBox="-2 -2 60 60" xml:space="preserve">\n<g class="button" transform="translate(-1, 0)" id="ugcui-submit">\n<polygon class="hex" points="13.126,45.469 0,22.735 13.126,0 39.377,0 \n\t52.504,22.734 39.377,45.469 "/><g transform="translate(0,-1)">\n<path fill="#222222" d="M13.54,21.303l-0.883,0.523c-0.166-0.287-0.323-0.474-0.473-0.561c-0.155-0.1-0.356-0.15-0.603-0.15\n\tc-0.302,0-0.553,0.086-0.752,0.258c-0.199,0.168-0.299,0.381-0.299,0.636c0,0.353,0.262,0.636,0.784,0.851l0.72,0.295\n\tc0.586,0.237,1.014,0.526,1.285,0.867c0.271,0.342,0.406,0.76,0.406,1.256c0,0.664-0.221,1.213-0.663,1.646\n\tc-0.445,0.437-0.998,0.655-1.659,0.655c-0.626,0-1.143-0.187-1.551-0.559C9.451,26.647,9.2,26.125,9.1,25.452l1.103-0.242\n\tc0.05,0.424,0.137,0.717,0.262,0.878c0.224,0.312,0.551,0.468,0.98,0.468c0.34,0,0.622-0.113,0.846-0.342\n\tc0.225-0.227,0.337-0.515,0.337-0.863c0-0.14-0.02-0.268-0.059-0.385c-0.039-0.117-0.1-0.225-0.183-0.322\n\tc-0.082-0.098-0.188-0.189-0.319-0.275c-0.131-0.086-0.287-0.168-0.468-0.245l-0.696-0.29c-0.987-0.416-1.48-1.027-1.48-1.83\n\tc0-0.541,0.207-0.994,0.621-1.358c0.414-0.367,0.93-0.551,1.547-0.551C12.423,20.093,13.072,20.496,13.54,21.303z"/>\n<path fill="#222222" d="M16.128,20.232v4.342c0,0.62,0.101,1.072,0.304,1.359c0.302,0.414,0.728,0.621,1.275,0.621\n\tc0.552,0,0.978-0.207,1.28-0.621c0.202-0.277,0.304-0.73,0.304-1.359v-4.342h1.089v4.645c0,0.76-0.237,1.387-0.711,1.879\n\tc-0.532,0.548-1.187,0.822-1.962,0.822s-1.428-0.274-1.958-0.822c-0.474-0.492-0.71-1.119-0.71-1.879v-4.645H16.128z"/>\n<path fill="#222222" d="M22.108,27.447v-7.215h1.084c0.482,0,0.867,0.037,1.154,0.113c0.289,0.074,0.534,0.2,0.733,0.378\n\tc0.202,0.184,0.362,0.413,0.481,0.687c0.121,0.277,0.182,0.558,0.182,0.842c0,0.517-0.197,0.954-0.593,1.312\n\tc0.383,0.131,0.685,0.359,0.906,0.687c0.225,0.324,0.336,0.7,0.336,1.131c0,0.563-0.199,1.04-0.598,1.43\n\tc-0.24,0.239-0.51,0.406-0.809,0.5c-0.327,0.091-0.736,0.136-1.229,0.136h-1.647V27.447z M23.197,23.33h0.341\n\tc0.405,0,0.702-0.089,0.891-0.268c0.188-0.18,0.282-0.443,0.282-0.793c0-0.339-0.097-0.597-0.29-0.773\n\tc-0.192-0.176-0.474-0.264-0.841-0.264h-0.383V23.33z M23.197,26.424h0.673c0.492,0,0.854-0.097,1.084-0.29\n\tc0.243-0.208,0.364-0.474,0.364-0.794c0-0.312-0.117-0.573-0.351-0.785c-0.228-0.209-0.634-0.312-1.22-0.312h-0.551L23.197,26.424\n\tL23.197,26.424z"/>\n<path fill="#222222" d="M27.515,27.447l1.519-7.756l2.476,5.605l2.565-5.605l1.364,7.756h-1.116l-0.696-4.355l-2.136,4.687\n\tl-2.074-4.69l-0.775,4.359h-1.127V27.447z"/>\n<path fill="#222222" d="M38.055,20.232v7.215h-1.089v-7.215H38.055z"/>\n<path fill="#222222" d="M41.778,21.256v6.191h-1.089v-6.191h-1.658v-1.023h4.401v1.023H41.778z"/>\n</g></g>\n</svg>';
w.innerHTML+='<svg class="ugcui" id="ugcui-bottom-left" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="800px"\n\t height="200px" viewBox="-2 -100 800 200" enable-background="new 0 0 800 200" xml:space="preserve">\n<g class="button" id="ugcui-rotate" title="Rotate [R]">\n\t<polygon class="hex" points="13.127,21.759 0,-0.975 13.127,-23.71 39.377,-23.71 52.504,-0.975 39.377,21.759"/>\n\t<path fill="#404040" d="M38.91-5.208c-0.406-0.224-0.83-0.434-1.266-0.633v-4.373l-10.986-5.962L15.162-10.47v4.656\n\t\tc-0.391,0.179-0.771,0.365-1.135,0.563C10.816-3.495,8.951-1.157,8.67,1.388H6.924L9.41,4.831l2.486-3.443h-1.66\n\t\tc0.295-1.96,1.875-3.812,4.539-5.27c0.123-0.067,0.26-0.125,0.387-0.19v5.677l11.496,6.545l10.986-6.18v-6.064\n\t\tc0.17,0.086,0.348,0.166,0.512,0.257c2.959,1.63,4.586,3.742,4.582,5.946c-0.004,2.202-1.639,4.308-4.604,5.928\n\t\tc-3.1,1.695-7.23,2.625-11.639,2.625h-0.055v0.001c-0.188,0-0.371-0.002-0.555-0.006l-0.031,1.562\n\t\tc0.195,0.003,0.387,0.005,0.582,0.005l0,0h0.059c4.664,0,9.062-1,12.387-2.816c3.486-1.906,5.41-4.498,5.416-7.297\n\t\tC44.303-0.69,42.391-3.287,38.91-5.208z"/>\n\t<path fill="#404040" d="M13.49,9.064c0.598,0.359,1.246,0.696,1.932,0.999l0.635-1.426c-0.627-0.281-1.219-0.586-1.766-0.912\n\t\tL13.49,9.064z"/>\n\t<path fill="#404040" d="M16.422,10.478c0.65,0.25,1.338,0.479,2.043,0.679l0.424-1.503c-0.658-0.188-1.299-0.398-1.906-0.635\n\t\tL16.422,10.478z"/>\n\t<path fill="#404040" d="M22.662,11.991c0.699,0.087,1.414,0.15,2.129,0.188l0.082-1.56c-0.678-0.037-1.357-0.096-2.021-0.178\n\t\tL22.662,11.991z"/>\n\t<path fill="#404040" d="M19.504,11.427c0.682,0.162,1.389,0.305,2.1,0.417L21.85,10.3c-0.674-0.105-1.34-0.24-1.984-0.392\n\t\tL19.504,11.427z"/>\n</g>\n<g class="folder"  id="ugcui-zoom">\t\n\t<g class="options">\n\t<polygon class="hitbox" points="97.417,22.957 82.56,-2.779 52.844,-2.779 39.029,21.152 11.394,21.152 \n\t\t-3.464,46.888 11.394,72.622 39.027,72.622 52.844,96.553 82.559,96.553 97.417,70.818 83.601,46.887 \t"/>\n\t\t<g class="button" title="zoom in" id="ugcui-zoom-in">\n\t\t<polygon class="hex" points="54.576,45.69 41.451,22.957 54.576,0.221 80.828,0.221 93.953,22.957 80.828,45.69"/>\n\t\t<polygon fill="#404040" points="73.414,21.578 68.235,21.578 68.235,16.399 66.093,16.399 66.093,21.578 60.914,21.578 \n\t\t\t60.914,23.721 66.093,23.721 66.093,28.899 68.235,28.899 68.235,23.721 73.414,23.721 \t"/>\n\t\t</g>\n\t\t<g class="button" title="zoom out" id="ugcui-zoom-out">\n\t\t<polygon class="hex" points="54.576,93.553 41.45,70.818 54.576,48.084 80.828,48.084 93.953,70.818 80.827,93.553 "/>\n\t\t<rect x="60.914" y="68.899" fill="#404040" width="12.5" height="2.143"/>\n\t\t</g>\n\t</g><g class="button" title="zoom" id="ugcui-zoom-folder">\n\t<polygon class="hex" points="13.126,69.622 0,46.888 13.126,24.152 39.377,24.152 52.503,46.888 39.377,69.622"/>\n\t<path fill="#404040" d="M24.141,35.035c-4.986,0-9.029,4.043-9.029,9.029c0,4.988,4.043,9.03,9.029,9.03\n\t\tc4.988,0,9.031-4.042,9.031-9.03C33.172,39.078,29.129,35.035,24.141,35.035 M24.141,50.909c-3.779,0-6.844-3.065-6.844-6.845\n\t\tc0-3.778,3.064-6.843,6.844-6.843c3.781,0,6.844,3.064,6.844,6.843C30.984,47.844,27.922,50.909,24.141,50.909"/>\n\t<path fill="#404040" d="M37.717,55.305c0.264,0.275,0.213,0.758-0.109,1.065l-2.216,2.112c-0.323,0.312-0.804,0.343-1.069,0.063\n\t\tl-4.318-4.521c-0.266-0.276-0.215-0.756,0.111-1.065l2.212-2.114c0.326-0.311,0.808-0.341,1.073-0.062L37.717,55.305z"/>\n\t</g></g>\n</g>\n</svg>';
var y=document.createElement("div");y.style.position="fixed";y.style.font="12px/0px FuturaBT-Medium";y.style.padding="13px 7px 10px 7px";y.style.display="none";y.style.backgroundColor="#fff";y.style.boxShadow="-1px 1px 0px rgba(0,0,0,0.4)";y.style.textTransform="uppercase";y.style.color="#000";y.style.zIndex="15";y.innerHTML="CREATE";w.appendChild(y);x=e("div","animal-container");x.setAttribute("id","animal-container");x.style.display="none";x.style.overflow="hidden";x.style.backgroundColor="rgba(255, 255, 255, 0.4)";
x.style.width="100%";x.style.height="114px";x.style.position="fixed";x.style.top="100%";x.style.left=0;x.style.marginTop="-114px";var C=e("div","animal-inner");C.style.padding="10px";C.style.width="1400px";C.style.height="100%";C.style.position="absolute";x.appendChild(C);for(var B=0;B<10;B++)C.appendChild(n());w.appendChild(x);var H=document.createElement("div");H.setAttribute("id","voxel-submit-shade");w.appendChild(H);var z=document.createElement("div");z.addEventListener("mousemove",function(G){G.stopImmediatePropagation&&
G.stopImmediatePropagation();G.stopPropagation()},!1);z.addEventListener("mouseup",function(G){G.stopImmediatePropagation&&G.stopImmediatePropagation();G.stopPropagation()},!1);z.addEventListener("mousedown",function(G){G.stopImmediatePropagation&&G.stopImmediatePropagation();G.stopPropagation()},!1);H.addEventListener("mousemove",function(G){G.stopImmediatePropagation&&G.stopImmediatePropagation();G.stopPropagation()},!1);H.addEventListener("mouseup",function(G){G.stopImmediatePropagation&&G.stopImmediatePropagation();
G.stopPropagation()},!1);H.addEventListener("mousedown",function(G){f();G.stopImmediatePropagation&&G.stopImmediatePropagation();G.stopPropagation()},!1);C=c("div","voxel-submit-text");C.innerHTML='<span id="agree-terms" class="foo"><input id="agree" type="checkbox" /> &nbsp;I agree to the <a id="terms-link" href="/terms">terms and conditions</a>.</span><br/>';C.innerHTML+="<small>Thank you for contributing a model! We'll email you when <br/>your unique dream is approved for sharing.</small>";var E=
c("div","voxel-submit-image");x=c("div","voxel-submit-inputs");var F=c("input","voxel-submit-title");F.setAttribute("type","text");F.setAttribute("value",t);F.setAttribute("maxlength",35);F.addEventListener("focus",function(){this.value=""},!1);var D=c("input","voxel-submit-email");D.setAttribute("type","text");D.setAttribute("value","YOUR EMAIL ADDRESS");D.addEventListener("focus",function(){this.value=""},!1);B=c("div","voxel-submit-submit");B.innerHTML="SUBMIT";B.addEventListener("click",function(){var G=
document.getElementById("voxel-submit-email"),L=document.getElementById("voxel-submit-title").value;G=G.value;var Q;if(o.test(G))Q=!1;else{alert("Please enter a valid email address");Q=!0}if(!Q&&!function(M){if(M==t||M.replace(/^\s\s*/,"").replace(/\s\s*$/,"")==""){alert("Please enter a title.");return!0}if(M.length<3){alert("Please enter a title 3 characters or longer.");return!0}return!1}(L))if(document.getElementById("agree").checked){b.ugcSignals.submit.dispatch(L,G);f()}else{alert("You must agree to the terms and conditions.");
g(document.getElementById("agree-terms"),"error")}},!1);var T=!1,W=!1,U=!1;z.appendChild(E);z.appendChild(C);z.appendChild(x);z.appendChild(B);z.setAttribute("id","voxel-submit");z.style.position="fixed";z.style.top="200%";z.style.left="50%";w.appendChild(z);var Y=document.createElement("div"),N=new ColorPicker(Y);N.onColorChange=function(G){b.ugcSignals.object_changecolor.dispatch(G)};Y.style.position="fixed";Y.style.left="50%";Y.style.top="50%";Y.style.display="none";Y.style.marginTop="-230px";
Y.style.marginLeft="-175px";w.appendChild(Y);C=document.createElement("span");C.innerHTML+="<br/>";x.appendChild(D);x.appendChild(C);x.appendChild(F);h(Y);h(y);this.setType=function(G){v=G;if(G==1){Y.style.display="none";b.ugcSignals.object_changecolor.dispatch(16777215);g(document.getElementById("ugcui-color"),"disabled")}else m(document.getElementById("ugcui-color"),"disabled");N.setType(G)};this.updateCapacity=function(G){document.getElementById("capacity").textContent=Math.round(G*100)+"%"};this.addListeners=
function(){Footer.handleLinkListeners(document.getElementById("terms-link"),"terms");w.addEventListener("mousemove",function(M){y.style.top=M.pageY-40+"px";y.style.left=M.pageX+20+"px"},!0);b.ugcSignals.submit_dialogue.add(function(){U=!0;b.ugcSignals.object_requestsnapshot.dispatch()});b.ugcSignals.object_receivesnapshot.add(function(M){E.style.backgroundImage="url("+M+")";H.style.zIndex="20";z.style.top="50%";z.style.opacity=1});for(var G=document.getElementsByClassName("button"),L=0;L<G.length;L++)if(G[L].getAttribute("title")!=
undefined){G[L].addEventListener("mouseover",function(){if(this.getAttribute("class").indexOf("disabled")==-1){y.style.display="inline-block";y.innerHTML=this.getAttribute("title")}},!1);G[L].addEventListener("mouseout",function(){y.style.display="none"},!1)}window.addEventListener("keydown",function(M){if(!U)switch(M.keyCode){case 90:b.ugcSignals.object_undo.dispatch();break;case 68:b.ugcSignals.object_createmode.dispatch();break;case 70:T?b.ugcSignals.object_createmode.dispatch():b.ugcSignals.object_colormode.dispatch();
break;case 83:b.ugcSignals.object_symmetrymode.dispatch(!W);break;case 69:b.ugcSignals.object_erasemode.dispatch();break;case 82:b.ugcSignals.object_rotatemode.dispatch()}},!1);d("ugcui-color",function(){T?b.ugcSignals.object_createmode.dispatch():b.ugcSignals.object_colormode.dispatch()});d("ugcui-size-small",function(){b.ugcSignals.object_changesize.dispatch(1)});d("ugcui-size-med",function(){b.ugcSignals.object_changesize.dispatch(3)});d("ugcui-submit",function(){b.ugcSignals.submit_dialogue.dispatch()});
d("ugcui-quit",function(){confirm("Are you sure you want to quit?")&&b.signals.showrelauncher.dispatch()});d("ugcui-zoom-in",function(){b.ugcSignals.object_zoomin.dispatch()});d("ugcui-zoom-out",function(){b.ugcSignals.object_zoomout.dispatch()});d("ugcui-create",function(){b.ugcSignals.object_createmode.dispatch()});d("ugcui-erase",function(){b.ugcSignals.object_erasemode.dispatch()});d("ugcui-rotate",function(){b.ugcSignals.object_rotatemode.dispatch()});d("ugcui-reflect",function(){b.ugcSignals.object_symmetrymode.dispatch(!W)});
b.ugcSignals.object_symmetrymode.add(function(M){(W=M)?g(document.getElementById("ugcui-reflect"),"active"):m(document.getElementById("ugcui-reflect"),"active")});b.ugcSignals.object_rotatemode.add(function(){T=!1;g(document.getElementById("ugcui-rotate"),"active");m(document.getElementById("ugcui-create"),"active");m(document.getElementById("ugcui-erase"),"active");m(document.getElementById("ugcui-color"),"active");Y.style.display="none"});b.ugcSignals.object_erasemode.add(function(){T=!1;g(document.getElementById("ugcui-erase"),
"active");m(document.getElementById("ugcui-create"),"active");m(document.getElementById("ugcui-rotate"),"active");m(document.getElementById("ugcui-color"),"active");Y.style.display="none"});b.ugcSignals.object_createmode.add(function(){T=!1;g(document.getElementById("ugcui-create"),"active");m(document.getElementById("ugcui-erase"),"active");m(document.getElementById("ugcui-rotate"),"active");m(document.getElementById("ugcui-color"),"active");Y.style.display="none"});b.ugcSignals.object_colormode.add(function(){if(v!=
1){T=!0;m(document.getElementById("ugcui-create"),"active");m(document.getElementById("ugcui-erase"),"active");m(document.getElementById("ugcui-rotate"),"active");g(document.getElementById("ugcui-color"),"active");Y.style.display="block"}});G=document.getElementsByClassName("button");for(L=0;L<G.length;L++){var Q=G[L];Q.addEventListener("mousemove",function(M){M.stopImmediatePropagation&&M.stopImmediatePropagation();M.stopPropagation()},!1);Q.addEventListener("mouseup",function(M){M.stopImmediatePropagation&&
M.stopImmediatePropagation();M.stopPropagation()},!1);Q.addEventListener("mousedown",function(M){M.stopImmediatePropagation&&M.stopImmediatePropagation();M.stopPropagation()},!1)}b.ugcSignals.object_changesize.add(function(M){m(document.getElementById("ugcui-size-small"),"active");m(document.getElementById("ugcui-size-med"),"active");switch(M){case 1:g(document.getElementById("ugcui-size-small"),"active");break;case 3:g(document.getElementById("ugcui-size-med"),"active");break;case 5:g(document.getElementById("ugcui-size-large"),
"active")}})};var p=0,O=0;this.update=function(){u+=(0-u)*0.5;E.style.backgroundPosition="0px "+-(p*E.offsetHeight)+"px";O++;O%10==0&&(p+=1)};this.getDomElement=function(){return w}},UgcObjectCreator=function(b,e,c){function d(){n=!0;m&&h.update(n)}function f(){n=!1;m&&h.update(n)}function g(){h.moveMouse(b.mouse.x/b.viewportWidth,b.mouse.y/b.viewportHeight);m&&h.update(n)}var m=!1,n=!1,h=new VoxelPainter(e,c);b.ugcSignals.object_createmode.add(function(){h.setMode(VoxelPainter.MODE_CREATE)});b.ugcSignals.object_erasemode.add(function(){h.setMode(VoxelPainter.MODE_ERASE)});
b.ugcSignals.object_symmetrymode.add(function(o){h.setSymmetry(o)});b.ugcSignals.object_rotatemode.add(function(){h.setMode(VoxelPainter.MODE_IDLE)});b.ugcSignals.object_changecolor.add(function(o){h.setColor(o)});b.ugcSignals.object_changesize.add(function(o){h.setSize(o)});b.ugcSignals.object_changesize.add(function(o){h.setSize(o)});this.enable=function(){m=!0};this.disable=function(){m=!1};this.show=function(){b.signals.mousedown.add(d);b.signals.mouseup.add(f);b.signals.mousemoved.add(g)};this.hide=
function(){b.signals.mousedown.remove(d);b.signals.mouseup.remove(f);b.signals.mousemoved.remove(g)};this.getPainter=function(){return h}},UgcSoupCreator=function(b){var e;this.init=function(){b.ugc.scene.collisions=new THREE.CollisionSystem;new THREE.Object3D;e=new UgcSoup(b.ugc.camera,b.ugc.scene,b,!0)};this.getDomElement=function(){return b.renderer.domElement};this.show=function(){};this.hide=function(){};this.resize=function(){};this.update=function(){e.update(20);THREE.AnimationHandler.update(20)}},
VoxelPainter=function(b,e){function c(L){return Math.round(L/g)}function d(L,Q,M){if(!(L<-40||L>40))if(!(Q<0||Q>40))if(!(M<-40||M>40)){var da=u.getVoxel(L,Q,M);if(da)da.object.materials[0].color.setHex(h);else{da=new THREE.Mesh(N.geometry,new THREE.MeshLambertMaterial({color:h}));da.position.x=L*g;da.position.y=Q*g;da.position.z=M*g;da.matrixAutoUpdate=!1;da.updateMatrix();da.update();e.addObject(da);U.push(da);u.addVoxel(L,Q,M,h,da)}}}function f(L){u.deleteVoxel(c(L.position.x),c(L.position.y),c(L.position.z));
e.removeObject(L);var Q=U.indexOf(L);Q!==-1&&U.splice(Q,1);delete L}var g=50,m=1,n=0,h=16777215,o=VoxelPainter.MODE_CREATE,t=!1,u=new UgcObject,v,w,x,y=[],C=new THREE.Vector3,B=new THREE.Object3D;B.matrixAutoUpdate=!1;B.visible=!1;var H=[],z=new THREE.Plane(8100,8100,2,2),E=new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(z,E);_plane.doubleSided=!0;_plane.visible=B.visible;B.addChild(_plane);H.push(_plane);_plane=new THREE.Mesh(z,E);_plane.rotation.y=
-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=B.visible;B.addChild(_plane);H.push(_plane);_plane=new THREE.Mesh(z,E);_plane.rotation.x=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=B.visible;B.addChild(_plane);H.push(_plane);e.addObject(B);var F,D,T,W;F=new THREE.Projector;D=new THREE.Vector3(0,0,0.5);W=new THREE.Ray(b.position,null);var U=[],Y=new THREE.Mesh(new THREE.Plane(4050,4050),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0}));Y.position.y=-g/2;
Y.rotation.x=-90*Math.PI/180;Y.updateMatrix();Y.update();U.push(Y);var N=new THREE.Mesh(new THREE.Cube(g,g,g)),p=[],O=[],G=new THREE.MeshLambertMaterial({color:h,opacity:0.5,transparent:!0});O[0]=[];O[1]=[];for(z=1;z<=5;z+=2){O[0][z]=new THREE.Mesh(new THREE.Cube(z*g,z*g,z*g,z,z,z),G);O[0][z].visible=!1;O[1][z]=new THREE.Mesh(new THREE.Cube(z*g,z*g,z*g,z,z,z),G);O[1][z].visible=!1;e.addObject(O[0][z]);e.addObject(O[1][z])}p[0]=O[0][m];p[1]=O[1][m];this.getMode=function(){return o};this.setMode=function(L){o=
L};this.setColor=function(L){h=L;G.color.setHex(h)};this.setSize=function(L){m=L;n=Math.floor(m/2);p[0]=O[0][m];p[1]=O[1][m]};this.setSymmetry=function(L){t=L};this.hideBrush=function(){p[0].visible=!1;p[1].visible=!1};this.moveMouse=function(L,Q){D.x=L*2-1;D.y=-Q*2+1;T=F.unprojectVector(D.clone(),b);W.direction=T.subSelf(b.position).normalize()};this.clear=function(){for(;U.length>1;){var L=U[1];e.removeObject(L);U.splice(1,1);delete L}u.clear()};this.update=function(L){var Q;Q=0;for(var M=y.length;Q<
M;Q++)y[Q].materials[0].opacity=1;switch(o){case VoxelPainter.MODE_IDLE:p[0].visible=!1;p[1].visible=!1;break;case VoxelPainter.MODE_CREATE:Q=W.intersectObjects(U);if(L){p[0].visible=!1;p[1].visible=!1;Q=W.intersectObjects(H);if(w&&Q.length>0){var da,ka;L=Q[0].point.clone();L.addSelf(x.matrixRotationWorld.multiplyVector3(w.normal.clone()));Q=v.distanceTo(C.set(L.x,v.y,v.z));M=v.distanceTo(C.set(v.x,L.y,v.z));da=v.distanceTo(C.set(v.x,v.y,L.z));ka=Math.max(Q,Math.max(M,da));if(Q==ka)L.set(L.x,v.y,
v.z);else if(M==ka)L.set(v.x,L.y,v.z);else da==ka&&L.set(v.x,v.y,L.z);Q=c(L.x);M=c(L.y);L=c(L.z);for(da=-n;da<m-n;da++)for(ka=-n;ka<m-n;ka++)for(var $=-n;$<m-n;$++){d(Q+da,M+ka,L+$);t&&d(-Q+1+da,M+ka,L+$)}}}else if(Q.length>0){v=Q[0].point;w=Q[0].face;x=Q[0].object;B.position.copy(v);B.position.addSelf(x.matrixRotationWorld.multiplyVector3(w.normal.clone()));B.updateMatrix();B.update();v.addSelf(x.matrixRotationWorld.multiplyVector3(w.normal.clone()));v.x=c(v.x)*g;v.y=c(v.y)*g;v.z=c(v.z)*g;p[0].position.copy(v);
p[0].visible=!0;if(t){p[1].position.copy(p[0].position);p[1].position.x=-p[1].position.x+g;p[1].visible=!0}}else{w=x=null;p[0].visible=!1;p[1].visible=!1}break;case VoxelPainter.MODE_ERASE:Q=W.intersectObjects(U);if(Q.length>0&&Q[0].object!=Y){x=Q[0].object;if(L){f(x);if(t){L=u.getVoxel(-c(x.position.x)+1,c(x.position.y),c(x.position.z));L!==undefined&&f(L.object)}}else{x.materials[0].opacity=0.5;y=[];y.push(x);if(t){L=u.getVoxel(-c(x.position.x)+1,c(x.position.y),c(x.position.z));if(L!==undefined){L.object.materials[0].opacity=
0.5;y.push(L.object)}}}}}};this.getObject=function(){return u}};VoxelPainter.MODE_IDLE="VoxelPainter.MODE_IDLE";VoxelPainter.MODE_CREATE="VoxelPainter.MODE_CREATE";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var Footer=function(b,e){var c=e||"files/footer";this.id=Footer.multipleInstances;var d="rome_footer_buy_album-"+this.id,f="rome_terms-"+this.id,g="rome_privacy-"+this.id,m="rome_facebook-"+this.id,n="rome_twitter-"+this.id,h="rome_credits-"+this.id;if(!window.screenX&&!window.screenY){window.screenX=window.screenLeft;window.screenY=window.screenTop}var o={x:window.screenX+window.innerWidth/2,y:window.screenY+window.innerHeight/2},t="menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=1, titlebar=0, left="+
(o.x-150)+", top="+(o.y-300)+", width=330, height=600",u="menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=1, titlebar=0, left="+(o.x-225)+", top="+(o.y-250)+", width=550, height=500";this.getDomElement=function(){return b};this.load=function(){var x=x||null;x&&(new x({buttonID:"c9e456919b824bdeb2e3a326b122db43",buttonImageUrl:c+"/buy_button-trans.png",useVendorImages:!0})).replaceDiv(d);Footer.handleLinkListeners(document.getElementById(h),"Credits",t);Footer.handleLinkListeners(document.getElementById(g),
"Privacy",t);Footer.handleLinkListeners(document.getElementById(f),"Terms",t);Footer.handleLinkListeners(document.getElementById(n),"Twitter",u);Footer.handleLinkListeners(document.getElementById(m),"Facebook",u);return this};Footer.handleLinkListeners=function(x,y,C){function B(H,z){z.preventDefault();var E=H.getAttribute("href");window.open(E,y,C);return!1}C||(C=t);x.addEventListener?x.addEventListener("click",function(H){B(this,H)},!1):x.attachEvent("click",function(H){B(this,H)})};window.addEventListener?
window.addEventListener("load",this.load,!1):window.attachEvent("load",this.load);o=['<div class="rome-footer">\n<div class="shout-out">\n  <ul>','    <li class="last"><a href="http://www.chromeexperiments.com/webgl"><img src="'+c+'/chrome-trans.png" alt="This is a Chrome Experiment" border="0" /></a></li>','    <li class="divider">&nbsp;</li>','    <li class="last"><a href="http://google.com/"><img src="'+c+'/google-trans.png" alt="Made With Friends From Google" border="0" /></a></li>','    <li class="clear">&nbsp;</li>\n  </ul>\n</div>\n<div class="navigation">\n  <ul class="primary">\n    <li class="first"><a href="/tech" target="_blank">Technology</a></li>',
'    <li><a id = "'+h+'" href="/credits">Credits</a></li>','    <li><a href="http://romealbum.com/" target="_blank">Rome Album</a></li>','    <li id="'+d+'" class="rome_footer_buy_album">','      <a href = "http://widgets.platform.emi.com/landing/2520403d33984be0b70fca43945728e9.html" onClick="_gaq.push([\'_trackPageview\', \'/buy_album\'])" target="blank">Buy Album</a>\n    </li>\n    <li class="last">Share</li>','    <li class="last icons"><a id = "'+m+'" href="http://www.facebook.com/sharer.php?u=http://ro.me?fb=1" target="_blank"><img src="'+
c+'/fb-trans.png" alt="facebook" border="0"  /></a></li>','    <li class="last icons"><a id = "'+n+'" href="http://twitter.com/share?text=%E2%80%9C3%20Dreams%20of%20Black%E2%80%9D%20an%20interactive%20film%20by%20Chris%20Milk%20for%20Danger%20Mouse%20%26%20Daniele%20Luppi%E2%80%99s%20ROME%20album%20%E2%99%A5%20http%3A%2F%2Fro.me%20%23rome%20%23webgl&url=" target="_blank"><img src="'+c+'/twitter-trans.png" alt="twitter" border="0" /></a></li>','    <li class="clear last">&nbsp;</li>\n  </ul>\n  <ul class="secondary">',
'    <li class="first"><a id = "'+f+'" href="/terms">Terms</a></li>','    <li class="last"><a id = "'+g+'" href="/privacy">Privacy</a></li>','    <li class="clear last">&nbsp;</li>\n  </ul>\n</div>\n<div class="clear">&nbsp;</div>\n</div>\n</div>'].join("\n");b.innerHTML=o;if(Footer.multipleInstances<1){o=document.createTextNode('.rome-footer * {\n  margin: 0;\n  padding: 0;\n}\n.rome-footer {\n  font: 500 10px/18px "FuturaBT-Medium", Arial, sans-serif;\n  color: #434343;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n.rome-footer .shout-out {\n  float: left;\n  margin: 0 0 0 18px;\n}\n.rome-footer .navigation {\n  float: right;\n  margin: 20px 26px 0 0;\n  vertical-align: middle;\n}\n.rome-footer ul li {\n  height: 16px;\n  border-right: 1px solid #a0a0a0;\n  padding: 0 10px 0 10px;\n  width: auto;\n  float: left;\n  line-height: 18px;\n  list-style: none;\n}\n.rome-footer ul li.last,\n.rome-footer ul li.last li {\n  border: none;\n  padding: 0 0 0 10px;\n}\n.rome-footer .shout-out ul li {\n  margin: 0;\n  border: 0;\n}\n.rome-footer .shout-out li.divider {\n  margin: 15px -15px 15px 15px;\n  height: 24px;\n  border-left: 1px solid #a0a0a0;\n  border-right: 0 !important;\n}\n.rome-footer a img {\n  border: 0;\n}\n.rome-footer .secondary a:link, .rome-footer .secondary a:visited {\n  color: #777;\n}\n.rome-footer a:link, .rome-footer a:visited,\n.rome-footer .secondary a:hover, .rome-footer .secondary a:active {\n  color: #434343;\n  text-decoration: none;\n}\n.rome-footer a:hover, .rome-footer a:active {\n  color: #000;\n}\n.emi_buy_button_link {\n  margin-top: 2px;\n  height: 8px;\n  line-height: 8px;\n  overflow: hidden;\n}\n.rome-footer .rome_footer_buy_album img {\n  display: block;\n  margin-top: 0;\n}\n.rome-footer .rome_footer_buy_album a:hover img {\n  margin-top: -8px;\n}\n.emi_vendor_menu.using_image a:hover img {\n  margin-top: 0;\n}\n.emi_vendor_menu.using_image {\n  margin-top: -145px;\n  margin-left: -11px;\n  padding: 10px;\n}\n.emi_vendor_menu.using_image * {\n  text-transform: none;\n}\n.emi_vendor_menu.using_image .emi_vendor_link {\n  margin-top: 5px;\n}\n.rome-footer .secondary {\n  margin: 10px 0 0 0;\n  float: right;\n}\n.clear {\n  clear: both;\n  display: block;\n  overflow: hidden;\n  visibility: hidden;\n  width: 0;\n  height: 0;\n}');
var v=document.getElementsByTagName("head")[0],w=document.createElement("style");w.type="text/css";if(w.styleSheet)w.styleSheet.cssText=o.nodeValue;else w.appendChild(o);v.appendChild(w)}Footer.multipleInstances++};Footer.multipleInstances=0;
var Shortcuts=function(b){function e(){var m=document.createElement("span");m.innerHTML=" ";g.appendChild(m)}function c(m,n){var h=document.createElement("span");h.style.cursor="pointer";h.style.padding="0.5em";h.style.marginRight="4px";h.style.background="rgba(255,255,255,0.15)";h.innerHTML=m;h.addEventListener("click",n,!1);g.appendChild(h)}function d(m,n){c(m,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(n,1)})}function f(m,n){c(m,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(n)})}var g=document.createElement("div");g.style.position="absolute";g.style.left="0px";g.style.top="0px";g.style.padding="0.5em";g.style.fontSize="10px";(function(m){c(m,function(){b.signals.showlauncher.dispatch()})})("Launcher");e();d("Intro",0);e();d("Transition to City",8);d("City",16);e();d("Transition to Prairie",24);d("Prairie",32);e();d("Transition to Dunes",40);d("Dunes",48);e();(function(m){c(m,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
e();f("Explore City","city");f("Explore Prairie","prairie");f("Explore Dunes","dunes");e();(function(m){c(m,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return g}};
(function(){function b(){n.loadedContent||n.signals.showlauncher.dispatch()}function e(){var E=window.location.pathname.toString();if(E==="/")n.signals.showlauncher.dispatch();else for(var F=0;F<B.length;F++)if(E.match(B[F])){z[F].dispatch();if(F==0)n.signals.startfilm.dispatch(0,1);else F==1&&n.signals.startexploration.dispatch("dunes");break}}function c(E,F,D){o&&o.hide();if(!E.__loaded){E.load();E.__loaded=!0}E.resize(window.innerWidth,window.innerHeight);E.show();if(F&&D){for(var T=H.length;T--;)if(H[T]===
D){D+=window.location.search;break}history&&history.pushState({pState:window.location.pathname.toString()},F,D)}o=E}function d(E){if(!E.gamma&&!E.beta){E.gamma=-(E.x*(180/Math.PI));E.beta=-(E.y*(180/Math.PI))}else if(E.alpha==null&&E.beta==null&&E.gamma==null){window.removeEventListener("deviceorientation",d,!1);window.removeEventListener("MozOrientation",d,!1)}var F=Math.abs(E.gamma)>4||Math.abs(E.beta)>4,D=F?E.gamma:0;F=F?E.beta:0;if(C!=D||y!=F){var T=Math.round(1.5*D)+n.mouse.x,W=-Math.round(1.5*
F)+n.mouse.y;Math.abs(T)>window.innerWidth&&(T=T<0?-window.innerWidth:window.innerWidth);Math.abs(W)>window.innerHeight&&(W=W<0?-window.innerHeight:window.innerHeight);n.mouse.x=T;n.mouse.y=W;C=D;y=F;n.signals.mousemoved.dispatch(E)}}function f(){requestAnimationFrame(f);g.clear();o&&o.update();m.update()}var g,m,n,h=signals.Signal,o,t,u,v,w,x,y=0,C=0,B=["film","explore","relauncher","tool"],H=["/","/film","/explore"],z=[];g=new Logger;g.domElement.style.position="fixed";g.domElement.style.right=
"100px";g.domElement.style.top="0px";m=new Stats;m.domElement.style.position="fixed";m.domElement.style.right="0px";m.domElement.style.top="0px";n={logger:g,mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,loadedContent:!1,hasExplored:!1,originLink:window.location.pathname.toString(),shouldSkip:!1,signals:{mousedown:new h,mouseup:new h,mousemoved:new h,mousewheel:new h,keydown:new h,keyup:new h,windowresized:new h,load:new h,showlauncher:new h,showfilm:new h,showrelauncher:new h,
showexploration:new h,showugc:new h,loadBegin:new h,loadItemAdded:new h,loadItemCompleted:new h,startfilm:new h,stopfilm:new h,startexploration:new h,initscenes:new h},worlds:{},soups:{},sequences:{},started:{city:!1,prairie:!1,dunes:!1}};t=new LauncherSection(n);document.body.appendChild(t.getDomElement());v=new RelauncherSection(n);document.body.appendChild(v.getDomElement());x=new UgcSection(n);document.body.appendChild(x.getDomElement());h=(new Shortcuts(n)).getDomElement();h.style.display="none";
h.id="shortcuts";document.body.appendChild(h);n.signals.load.add(function(){n.signals.loadBegin.dispatch();u=new FilmSection(n);document.body.appendChild(u.getDomElement());w=new ExplorationSection(n);document.body.appendChild(w.getDomElement());n.signals.showfilm.add(function(){c(u,B[0],"/"+B[0])});n.signals.showexploration.add(function(){c(w,B[1],"/"+B[1])})});n.signals.showfilm.add(b);n.signals.showexploration.add(b);n.signals.showlauncher.add(function(){c(t,"/","/")});n.signals.showlauncher.add(function(){if(n.originLink.match("/explore")&&
!n.loadedContent)n.shouldSkip=!0});n.signals.showrelauncher.add(function(){c(v,B[2],"/"+B[2])});n.signals.showugc.add(function(){c(x,B[3],"/"+B[3])});z.push(n.signals.showfilm);z.push(n.signals.showexploration);z.push(n.signals.showrelauncher);z.push(n.signals.showugc);document.addEventListener("mousedown",function(E){n.signals.mousedown.dispatch(E);E.preventDefault();E.stopPropagation()},!1);document.addEventListener("mouseup",function(E){n.signals.mouseup.dispatch(E);E.preventDefault();E.stopPropagation()},
!1);document.addEventListener("mousemove",function(E){n.mouse.x=E.clientX;n.mouse.y=E.clientY;n.signals.mousemoved.dispatch(E)},!1);document.addEventListener("mousewheel",function(E){n.signals.mousewheel.dispatch(E)},!1);document.addEventListener("keydown",function(E){n.signals.keydown.dispatch(E)},!1);document.addEventListener("keyup",function(E){n.signals.keyup.dispatch(E)},!1);window.addEventListener("deviceorientation",d,!1);window.addEventListener("MozOrientation",d,!1);window.addEventListener("resize",
function(){o.resize(window.innerWidth,window.innerHeight);n.screenWidth=window.innerWidth;n.screenHeight=window.innerHeight;n.signals.windowresized.dispatch()},!1);e();f();window.onpopstate=function(){e()}})();
