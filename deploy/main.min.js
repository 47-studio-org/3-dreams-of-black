var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b(ka,U,ma){var qa,va,fa;for(va=0;va<30;va++)for(qa=0;qa<73;qa++){fa=(qa+va*74)*4;ka[fa]=ka[fa+4];ka[fa+1]=ka[fa+5];ka[fa+2]=ka[fa+6]}for(va=0;va<30;va++){fa=(73+va*74)*4;if(va<U){ka[fa]=ha[ma].bg.r;ka[fa+1]=ha[ma].bg.g;ka[fa+2]=ha[ma].bg.b}else{ka[fa]=ha[ma].fg.r;ka[fa+1]=ha[ma].fg.g;ka[fa+2]=ha[ma].fg.b}}}var e=0,c=2,d,f=0,g=(new Date).getTime(),j=g,h=g,m=0,n=1E3,p=0,t,v,u,w,z,y=0,A=1E3,E=0,B,I,D,C,K=0,N=1E3,L=0,Q,ea,o,oa,ha={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},
ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};d=document.createElement("div");d.style.cursor="pointer";d.style.width="80px";d.style.opacity="0.9";d.style.zIndex="10001";d.addEventListener("click",function(){e++;e==c&&(e=0);t.style.display="none";B.style.display="none";Q.style.display="none";switch(e){case 0:t.style.display="block";break;case 1:B.style.display="block";break;case 2:Q.style.display="block"}},!1);t=document.createElement("div");t.style.backgroundColor=
"rgb("+Math.floor(ha.fps.bg.r/2)+","+Math.floor(ha.fps.bg.g/2)+","+Math.floor(ha.fps.bg.b/2)+")";t.style.padding="2px 0px 3px 0px";d.appendChild(t);v=document.createElement("div");v.style.fontFamily="Helvetica, Arial, sans-serif";v.style.textAlign="left";v.style.fontSize="9px";v.style.color="rgb("+ha.fps.fg.r+","+ha.fps.fg.g+","+ha.fps.fg.b+")";v.style.margin="0px 0px 1px 3px";v.innerHTML='<span style="font-weight:bold">FPS</span>';t.appendChild(v);u=document.createElement("canvas");u.width=74;u.height=
30;u.style.display="block";u.style.marginLeft="3px";t.appendChild(u);w=u.getContext("2d");w.fillStyle="rgb("+ha.fps.bg.r+","+ha.fps.bg.g+","+ha.fps.bg.b+")";w.fillRect(0,0,u.width,u.height);z=w.getImageData(0,0,u.width,u.height);B=document.createElement("div");B.style.backgroundColor="rgb("+Math.floor(ha.ms.bg.r/2)+","+Math.floor(ha.ms.bg.g/2)+","+Math.floor(ha.ms.bg.b/2)+")";B.style.padding="2px 0px 3px 0px";B.style.display="none";d.appendChild(B);I=document.createElement("div");I.style.fontFamily=
"Helvetica, Arial, sans-serif";I.style.textAlign="left";I.style.fontSize="9px";I.style.color="rgb("+ha.ms.fg.r+","+ha.ms.fg.g+","+ha.ms.fg.b+")";I.style.margin="0px 0px 1px 3px";I.innerHTML='<span style="font-weight:bold">MS</span>';B.appendChild(I);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";B.appendChild(u);D=u.getContext("2d");D.fillStyle="rgb("+ha.ms.bg.r+","+ha.ms.bg.g+","+ha.ms.bg.b+")";D.fillRect(0,0,u.width,u.height);C=D.getImageData(0,
0,u.width,u.height);try{webkitPerformance&&webkitPerformance.memory.totalJSHeapSize&&(c=3)}catch(sa){}Q=document.createElement("div");Q.style.backgroundColor="rgb("+Math.floor(ha.mem.bg.r/2)+","+Math.floor(ha.mem.bg.g/2)+","+Math.floor(ha.mem.bg.b/2)+")";Q.style.padding="2px 0px 3px 0px";Q.style.display="none";d.appendChild(Q);ea=document.createElement("div");ea.style.fontFamily="Helvetica, Arial, sans-serif";ea.style.textAlign="left";ea.style.fontSize="9px";ea.style.color="rgb("+ha.mem.fg.r+","+
ha.mem.fg.g+","+ha.mem.fg.b+")";ea.style.margin="0px 0px 1px 3px";ea.innerHTML='<span style="font-weight:bold">MEM</span>';Q.appendChild(ea);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";Q.appendChild(u);o=u.getContext("2d");o.fillStyle="#301010";o.fillRect(0,0,u.width,u.height);oa=o.getImageData(0,0,u.width,u.height);return{domElement:d,update:function(){f++;g=(new Date).getTime();y=g-j;A=Math.min(A,y);E=Math.max(E,y);b(C.data,Math.min(30,
30-y/200*30),"ms");I.innerHTML='<span style="font-weight:bold">'+y+" MS</span> ("+A+"-"+E+")";D.putImageData(C,0,0);j=g;if(g>h+1E3){m=Math.round(f*1E3/(g-h));n=Math.min(n,m);p=Math.max(p,m);b(z.data,Math.min(30,30-m/100*30),"fps");v.innerHTML='<span style="font-weight:bold">'+m+" FPS</span> ("+n+"-"+p+")";w.putImageData(z,0,0);if(c==3){K=webkitPerformance.memory.usedJSHeapSize*9.54E-7;N=Math.min(N,K);L=Math.max(L,K);b(oa.data,Math.min(30,30-K/2),"mem");ea.innerHTML='<span style="font-weight:bold">'+
Math.round(K)+" MEM</span> ("+Math.round(N)+"-"+Math.round(L)+")";o.putImageData(oa,0,0)}h=g;f=0}}}},GUI=function(){var b=this,e=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
e.appendChild(c);var d=[],f=[],g=!0,j,h,m=0;b=this;var n=!1,p=280,t=!1,v,u,w=0,z;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=p+"px";var y=document.createElement("div");y.setAttribute("class","guidat-controllers");y.addEventListener("DOMMouseScroll",function(U){var ma=this.scrollTop;if(U.wheelDelta)ma+=U.wheelDelta;else U.detail&&(ma+=U.detail);U.preventDefault&&U.preventDefault();U.returnValue=!1;y.scrollTop=ma},!1);y.style.height=
"0px";var A=document.createElement("a");A.setAttribute("class","guidat-toggle");A.setAttribute("href","#");A.innerHTML="Show Controls";var E=!1,B=0,I=!1,D,C,K,N,L=function(U){C=D;N=K;D=U.pageY;K=U.pageX;U=D-C;if(!n)if(U>0){n=!0;m=v=1;A.innerHTML=u||"Hide Controls"}else return;var ma=N-K;if(U>0&&m>h){var qa=GUI.map(m,h,h+100,1,0);U*=qa}E=!0;B+=U;dragDisplacementX+=ma;v+=U;p+=ma;m+=U;y.style.height=v+"px";p=GUI.constrain(p,240,500);b.domElement.style.width=p+"px";oa()};A.addEventListener("mousedown",
function(U){C=D=U.pageY;N=K=U.pageX;I=!0;U.preventDefault();dragDisplacementX=B=0;document.addEventListener("mousemove",L,!1);return!1},!1);A.addEventListener("click",function(U){U.preventDefault();return!1},!1);document.addEventListener("mouseup",function(U){if(I&&!E){b.toggle();b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(I&&E){if(dragDisplacementX==0){b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(v>
h){clearTimeout(z);v=w=h;sa()}else if(y.children.length>=1){var ma=y.children[0].offsetHeight;clearTimeout(z);w=Math.round(m/ma)*ma-1;if(w<=0){b.hide();v=ma*2}else{v=w;sa()}}}document.removeEventListener("mousemove",L,!1);U.preventDefault();E=!1;I=!1;return!1},!1);this.domElement.appendChild(y);this.domElement.appendChild(A);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var Q=function(){j=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(U){if(g=U)f.length>0&&Q();else clearInterval(j)});this.__defineGetter__("autoListen",function(){return g});this.listenTo=function(U){f.length==0&&Q();f.push(U)};this.unlistenTo=function(U){for(var ma=0;ma<f.length;ma++)f[ma]==U&&f.splice(ma,1);f.length<=0&&clearInterval(j)};this.listen=function(U){U=U||f;for(var ma in U)U[ma].updateDisplay()};this.listenAll=function(){this.listen(d)};
this.autoListen=!0;var ea=function(U,ma){for(var qa in d)if(d[qa].object==U&&d[qa].propertyName==ma)return!0;return!1},o=function(U,ma){function qa(){return U.apply(this,ma)}qa.prototype=U.prototype;return new qa};this.add=function(){var U=arguments[0],ma=arguments[1];ea(U,ma);var qa=U[ma];if(qa==undefined)GUI.error(U+' either has no property "'+ma+'", or the property is inaccessible.');else{U=typeof qa;qa=ha[U];if(qa==undefined)GUI.error('Cannot create controller for data type "'+U+'"');else{for(var va=
[this],fa=0;fa<arguments.length;fa++)va.push(arguments[fa]);if(qa=o(qa,va)){y.appendChild(qa.domElement);d.push(qa);GUI.allControllers.push(qa);if(U!="function"&&GUI.saveIndex<GUI.savedValues.length){qa.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}oa();t||(v=h);return qa}else GUI.error('Error creating controller for "'+ma+'".')}}};var oa=function(){h=0;for(var U in d)h+=d[U].domElement.offsetHeight;y.style.overflowY=h-1>v?"auto":"hidden"},ha={number:GUI.NumberController,string:GUI.StringController,
"boolean":GUI.BooleanController,"function":GUI.FunctionController};ea=function(U,ma){for(var qa in d)if(d[qa].object==U&&d[qa].propertyName==ma)return!0;return!1};o=function(U,ma){function qa(){return U.apply(this,ma)}qa.prototype=U.prototype;return new qa};this.reset=function(){};this.toggle=function(){n?this.hide():this.show()};this.show=function(){A.innerHTML=u||"Hide Controls";w=v;clearTimeout(z);sa();n=!0};this.hide=function(){A.innerHTML=u||"Show Controls";w=0;clearTimeout(z);sa();n=!1};this.name=
function(U){u=U;A.innerHTML=U};this.appearanceVars=function(){return[n,p,v,y.scrollTop]};var sa=function(){m+=(w-m)*0.6;if(Math.abs(m-w)<1)m=w;else z=setTimeout(sa,1E3/30);y.style.height=Math.round(m)+"px";oa()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){p=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=p+"px";v=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);t=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){m=v;var ka=GUI.savedAppearanceVars[GUI.guiIndex][3];
setTimeout(function(){y.scrollTop=ka},0);if(GUI.scrollTop>-1)document.body.scrollTop=GUI.scrollTop;w=v;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var e=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<e;c++){var d=b.splice(2,4);GUI.savedAppearanceVars.push(d)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var e in GUI.allGuis)for(var c=GUI.allGuis[e].appearanceVars(),d=0;d<c.length;d++)b.push(c[d]);for(e in GUI.allControllers)if(GUI.allControllers[e].type!="function"){c=GUI.allControllers[e].getValue();GUI.allControllers[e].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var e,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){e=c[d].split("=");if(e!=undefined&&e[0]==b)return e[1]}return null};
GUI.replaceGetVar=function(b,e){for(var c,d=window.location.href,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<f.length;g++){c=f[g].split("=");if(c!=undefined&&c[0]==b)return d.replace(c[1],e)}if(window.location.href.indexOf("?")!=-1)return d+"&"+b+"="+e;return d+"?"+b+"="+e};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,e,c,d,f){return d+(f-d)*((b-e)/(c-e))};GUI.constrain=function(b,e,c){if(b<e)b=e;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,e){var c=Math.pow(10,e);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,e,c,d,f){var g=!1,j=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(m){this.fg.style.width=GUI.map(m,e,c,0,100)+"%"});var h=function(m){if(g){var n;n=j.domElement;var p=curtop=0;if(n.offsetParent){do{p+=n.offsetLeft;curtop+=n.offsetTop}while(n=n.offsetParent);
n=[p,curtop]}else n=void 0;m=GUI.map(m.pageX,n[0],n[0]+j.domElement.offsetWidth,e,c);m=Math.round(m/d)*d;b.setValue(m)}};this.domElement.addEventListener("mousedown",function(m){g=!0;j.domElement.setAttribute("class","guidat-slider-bg active");j.fg.setAttribute("class","guidat-slider-fg active");h(m)},!1);document.addEventListener("mouseup",function(){j.domElement.setAttribute("class","guidat-slider-bg");j.fg.setAttribute("class","guidat-slider-fg");g=!1},!1);document.addEventListener("mousemove",
h,!1);this.value=f};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var e=document.createElement("input"),c=this.getValue();e.setAttribute("value",c);e.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){e.focus();e.select()},!1);e.addEventListener("keyup",function(){b.setValue(e.value)},!1);this.updateDisplay=function(){e.value=b.getValue()};this.domElement.appendChild(e)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,e=!1,c=!1,d=py=0,f=arguments[3],g=arguments[4],j=arguments[5];j||(j=f!=undefined&&g!=undefined?(g-f)*0.01:1);var h=document.createElement("input");h.setAttribute("id",this.propertyName);h.setAttribute("type","text");h.setAttribute("value",this.getValue());j&&h.setAttribute("step",j);this.domElement.appendChild(h);var m;if(f!=undefined&&g!=undefined){m=new GUI.Slider(this,f,g,j,this.getValue());this.domElement.appendChild(m.domElement)}h.addEventListener("blur",
function(){var p=parseFloat(this.value);if(isNaN(p))this.value=b.getValue();else b.updateDisplay()},!1);h.addEventListener("mousewheel",function(p){p.preventDefault();b.setValue(b.getValue()+Math.abs(p.wheelDeltaY)/p.wheelDeltaY*j);return!1},!1);h.addEventListener("mousedown",function(p){py=d=p.pageY;c=!0;document.addEventListener("mousemove",n,!1)},!1);h.addEventListener("keydown",function(p){switch(p.keyCode){case 38:p=b.getValue()+j;b.setValue(p);break;case 40:p=b.getValue()-j;b.setValue(p)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",n,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(h);if(c&&!e){h.focus();h.select()}e=!1;c=!1},!1);var n=function(p){e=!0;p.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(h);py=d;d=p.pageY;p=py-d;p=b.getValue()+p*j;b.setValue(p);return!1};this.setValue=function(p){p=parseFloat(p);if(f!=undefined&&p<=f)p=f;else g!=undefined&&p>=g&&(p=g);return GUI.Controller.prototype.setValue.call(this,
p)};this.updateDisplay=function(){h.value=GUI.roundToDecimal(b.getValue(),4);if(m)m.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,e=document.createElement("input");e.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){e.checked=!e.checked;c.preventDefault();b.setValue(e.checked)},!1);e.addEventListener("mouseup",function(){e.checked=!e.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(e);this.updateDisplay=function(){e.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(d){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);
var signals=function(){function b(c,d,f,g,j){this._listener=d;this._isOnce=f;this.context=g;this._signal=c;this._priority=j||0}var e={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var d;if(this._isEnabled){d=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return d},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};e.Signal=function(){this._bindings=[]};e.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,d,f,g){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var j=this._indexOfListener(c);if(j!==-1){c=this._bindings[j];if(c.isOnce()!==d)throw Error("You cannot add"+(d?"":"Once")+"() then add"+(!d?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,d,f,g);this._addBinding(c)}return c},_addBinding:function(c){var d=this._bindings.length;do--d;while(this._bindings[d]&&c._priority<=this._bindings[d]._priority);this._bindings.splice(d+1,0,c)},_indexOfListener:function(c){for(var d=this._bindings.length;d--;)if(this._bindings[d]._listener===
c)return d;return-1},add:function(c,d,f){return this._registerListener(c,!1,d,f)},addOnce:function(c,d,f){return this._registerListener(c,!0,d,f)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var d=this._indexOfListener(c);if(d!==-1){this._bindings[d]._destroy();this._bindings.splice(d,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),d=this._bindings.slice(),f=this._bindings.length;this._shouldPropagate=!0;do f--;while(d[f]&&this._shouldPropagate&&d[f].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return e}(),TWEEN=TWEEN||function(){var b,e,c,d=[];this.add=function(f){d.push(f)};this.remove=function(f){b=d.indexOf(f);b!==-1&&d.splice(b,1)};this.update=function(){b=0;e=d.length;for(c=(new Date).getTime();b<e;)if(d[b].update(c))b++;else{d.splice(b,1);e--}};return this}();
TWEEN.Tween=function(b){var e={},c={},d={},f=1E3,g=0,j=null,h=TWEEN.Easing.Linear.EaseNone,m=null,n=null,p=null;this.to=function(t,v){v!==null&&(f=v);for(var u in t)b[u]!==null&&(d[u]=t[u]);return this};this.start=function(){TWEEN.add(this);j=(new Date).getTime()+g;for(var t in d)if(b[t]!==null){e[t]=b[t];c[t]=d[t]-b[t]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(t){g=t;return this};this.easing=function(t){h=t;return this};this.chain=function(t){m=t};this.onUpdate=
function(t){n=t;return this};this.onComplete=function(t){p=t;return this};this.update=function(t){var v,u;if(t<j)return!0;t=(t-j)/f;t=t>1?1:t;u=h(t);for(v in c)b[v]=e[v]+c[v]*u;n!==null&&n.call(b,u);if(t==1){p!==null&&p.call(b);m!==null&&m.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d))};
TWEEN.Easing.Elastic.EaseOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-e)*2*Math.PI/d)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var e,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;e=d/4}else e=d/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-e)*2*Math.PI/d);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-e)*2*Math.PI/d)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={autoUpdate:!0,copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex;this.__styleString=b.__styleString},setRGB:function(b,e,c){this.r=b;this.g=e;this.b=c;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHSV:function(b,e,c){var d,f,g,j,h,m;if(c==0)d=f=g=0;else{j=Math.floor(b*6);h=b*6-j;b=c*(1-e);m=c*(1-e*h);e=c*(1-e*(1-h));switch(j){case 1:d=m;f=c;g=b;break;case 2:d=b;f=c;g=e;break;case 3:d=b;f=m;g=c;break;case 4:d=e;f=b;g=c;break;case 5:d=c;f=b;
g=m;break;case 6:case 0:d=c;f=e;g=b}}this.r=d;this.g=f;this.b=g;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHex:function(b){this.hex=~~b&16777215;if(this.autoUpdate){this.updateRGB();this.updateStyleString()}},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},updateStyleString:function(){this.__styleString="rgb("+~~(this.r*255)+","+~~(this.g*
255)+","+~~(this.b*255)+")"},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,e){this.set(b||0,e||0)};
THREE.Vector2.prototype={set:function(b,e){this.x=b;this.y=e;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,e,c){this.set(b||0,e||0,c||0)};
THREE.Vector3.prototype={set:function(b,e,c){this.x=b;this.y=e;this.z=c;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
e){this.set(b.y*e.z-b.z*e.y,b.z*e.x-b.x*e.z,b.x*e.y-b.y*e.x);return this},crossSelf:function(b){var e=this.x,c=this.y,d=this.z;this.set(c*b.z-d*b.y,d*b.x-e*b.z,e*b.y-c*b.x);return this},multiply:function(b,e){this.set(b.x*e.x,b.y*e.y,b.z*e.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var e=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return e*e+c*c+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var e=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(e)>1.0E-5){this.x=Math.atan2(-b.n23/e,b.n33/e);this.z=Math.atan2(-b.n12/e,b.n11/e)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,e,c,d){this.set(b||0,e||0,c||0,d||1)};
THREE.Vector4.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z,b.w+e.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z,b.w-e.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,e){this.set(this.x+(b.x-this.x)*e,this.y+(b.y-this.y)*e,this.z+(b.z-this.z)*e,this.w+(b.w-this.w)*e)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,e){this.origin=b||new THREE.Vector3;this.direction=e||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){var e,c,d=b.objects,f=[];b=0;for(e=d.length;b<e;b++){c=d[b];c instanceof THREE.Mesh&&(f=f.concat(this.intersectObject(c)))}f.sort(function(g,j){return g.distance-j.distance});return f},intersectObject:function(b){function e(y,A,E,B){B=B.clone().subSelf(A);E=E.clone().subSelf(A);var I=y.clone().subSelf(A);y=B.dot(B);A=B.dot(E);B=B.dot(I);var D=E.dot(E);E=E.dot(I);I=1/(y*D-A*A);D=(D*B-A*E)*I;y=(y*E-A*B)*I;return D>0&&y>0&&D+y<1}var c,d,f,g,j,h,m,n,p,t,
v,u=b.geometry,w=u.vertices,z=[];c=0;for(d=u.faces.length;c<d;c++){f=u.faces[c];t=this.origin.clone();v=this.direction.clone();m=b.matrixWorld;g=m.multiplyVector3(w[f.a].position.clone());j=m.multiplyVector3(w[f.b].position.clone());h=m.multiplyVector3(w[f.c].position.clone());m=f instanceof THREE.Face4?m.multiplyVector3(w[f.d].position.clone()):null;n=b.matrixRotationWorld.multiplyVector3(f.normal.clone());p=v.dot(n);if(b.doubleSided||(b.flipSided?p>0:p<0)){n=n.dot((new THREE.Vector3).sub(g,t))/
p;t=t.addSelf(v.multiplyScalar(n));if(f instanceof THREE.Face3){if(e(t,g,j,h)){f={distance:this.origin.distanceTo(t),point:t,face:f,object:b};z.push(f)}}else if(f instanceof THREE.Face4&&(e(t,g,j,m)||e(t,j,h,m))){f={distance:this.origin.distanceTo(t),point:t,face:f,object:b};z.push(f)}}}return z}};
THREE.Rectangle=function(){function b(){g=d-e;j=f-c}var e,c,d,f,g,j,h=!0;this.getX=function(){return e};this.getY=function(){return c};this.getWidth=function(){return g};this.getHeight=function(){return j};this.getLeft=function(){return e};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return f};this.set=function(m,n,p,t){h=!1;e=m;c=n;d=p;f=t;b()};this.addPoint=function(m,n){if(h){h=!1;e=m;c=n;d=m;f=n}else{e=e<m?e:m;c=c<n?c:n;d=d>m?d:m;f=f>n?f:n}b()};
this.add3Points=function(m,n,p,t,v,u){if(h){h=!1;e=m<p?m<v?m:v:p<v?p:v;c=n<t?n<u?n:u:t<u?t:u;d=m>p?m>v?m:v:p>v?p:v;f=n>t?n>u?n:u:t>u?t:u}else{e=m<p?m<v?m<e?m:e:v<e?v:e:p<v?p<e?p:e:v<e?v:e;c=n<t?n<u?n<c?n:c:u<c?u:c:t<u?t<c?t:c:u<c?u:c;d=m>p?m>v?m>d?m:d:v>d?v:d:p>v?p>d?p:d:v>d?v:d;f=n>t?n>u?n>f?n:f:u>f?u:f:t>u?t>f?t:f:u>f?u:f}b()};this.addRectangle=function(m){if(h){h=!1;e=m.getLeft();c=m.getTop();d=m.getRight();f=m.getBottom()}else{e=e<m.getLeft()?e:m.getLeft();c=c<m.getTop()?c:m.getTop();d=d>m.getRight()?
d:m.getRight();f=f>m.getBottom()?f:m.getBottom()}b()};this.inflate=function(m){e-=m;c-=m;d+=m;f+=m;b()};this.minSelf=function(m){e=e>m.getLeft()?e:m.getLeft();c=c>m.getTop()?c:m.getTop();d=d<m.getRight()?d:m.getRight();f=f<m.getBottom()?f:m.getBottom();b()};this.instersects=function(m){return Math.min(d,m.getRight())-Math.max(e,m.getLeft())>=0&&Math.min(f,m.getBottom())-Math.max(c,m.getTop())>=0};this.empty=function(){h=!0;f=d=c=e=0;b()};this.isEmpty=function(){return h}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,e=this.m;b=e[1];e[1]=e[3];e[3]=b;b=e[2];e[2]=e[6];e[6]=b;b=e[5];e[5]=e[7];e[7]=b;return this},transposeIntoArray:function(b){var e=this.m;b[0]=e[0];b[1]=e[3];b[2]=e[6];b[3]=e[1];b[4]=e[4];b[5]=e[7];b[6]=e[2];b[7]=e[5];b[8]=e[8];return this}};
THREE.Matrix4=function(b,e,c,d,f,g,j,h,m,n,p,t,v,u,w,z){this.set(b||1,e||0,c||0,d||0,f||0,g||1,j||0,h||0,m||0,n||0,p||1,t||0,v||0,u||0,w||0,z||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,e,c,d,f,g,j,h,m,n,p,t,v,u,w,z){this.n11=b;this.n12=e;this.n13=c;this.n14=d;this.n21=f;this.n22=g;this.n23=j;this.n24=h;this.n31=m;this.n32=n;this.n33=p;this.n34=t;this.n41=v;this.n42=u;this.n43=w;this.n44=z;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,e,c){var d=THREE.Matrix4.__v1,
f=THREE.Matrix4.__v2,g=THREE.Matrix4.__v3;g.sub(b,e).normalize();if(g.length()===0)g.z=1;d.cross(c,g).normalize();if(d.length()===0){g.x+=1.0E-4;d.cross(c,g).normalize()}f.cross(g,d).normalize();this.n11=d.x;this.n12=f.x;this.n13=g.x;this.n21=d.y;this.n22=f.y;this.n23=g.y;this.n31=d.z;this.n32=f.z;this.n33=g.z;return this},multiplyVector3:function(b){var e=b.x,c=b.y,d=b.z,f=1/(this.n41*e+this.n42*c+this.n43*d+this.n44);b.x=(this.n11*e+this.n12*c+this.n13*d+this.n14)*f;b.y=(this.n21*e+this.n22*c+this.n23*
d+this.n24)*f;b.z=(this.n31*e+this.n32*c+this.n33*d+this.n34)*f;return b},multiplyVector4:function(b){var e=b.x,c=b.y,d=b.z,f=b.w;b.x=this.n11*e+this.n12*c+this.n13*d+this.n14*f;b.y=this.n21*e+this.n22*c+this.n23*d+this.n24*f;b.z=this.n31*e+this.n32*c+this.n33*d+this.n34*f;b.w=this.n41*e+this.n42*c+this.n43*d+this.n44*f;return b},rotateAxis:function(b){var e=b.x,c=b.y,d=b.z;b.x=e*this.n11+c*this.n12+d*this.n13;b.y=e*this.n21+c*this.n22+d*this.n23;b.z=e*this.n31+c*this.n32+d*this.n33;b.normalize();
return b},crossVector:function(b){var e=new THREE.Vector4;e.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;e.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;e.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;e.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return e},multiply:function(b,e){var c=b.n11,d=b.n12,f=b.n13,g=b.n14,j=b.n21,h=b.n22,m=b.n23,n=b.n24,p=b.n31,t=b.n32,v=b.n33,u=b.n34,w=b.n41,z=b.n42,y=b.n43,A=b.n44,E=e.n11,B=e.n12,I=e.n13,D=e.n14,C=e.n21,K=e.n22,
N=e.n23,L=e.n24,Q=e.n31,ea=e.n32,o=e.n33,oa=e.n34;this.n11=c*E+d*C+f*Q;this.n12=c*B+d*K+f*ea;this.n13=c*I+d*N+f*o;this.n14=c*D+d*L+f*oa+g;this.n21=j*E+h*C+m*Q;this.n22=j*B+h*K+m*ea;this.n23=j*I+h*N+m*o;this.n24=j*D+h*L+m*oa+n;this.n31=p*E+t*C+v*Q;this.n32=p*B+t*K+v*ea;this.n33=p*I+t*N+v*o;this.n34=p*D+t*L+v*oa+u;this.n41=w*E+z*C+y*Q;this.n42=w*B+z*K+y*ea;this.n43=w*I+z*N+y*o;this.n44=w*D+z*L+y*oa+A;return this},multiplyToArray:function(b,e,c){this.multiply(b,e);c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;
c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=
this.n11,e=this.n12,c=this.n13,d=this.n14,f=this.n21,g=this.n22,j=this.n23,h=this.n24,m=this.n31,n=this.n32,p=this.n33,t=this.n34,v=this.n41,u=this.n42,w=this.n43,z=this.n44;return d*j*n*v-c*h*n*v-d*g*p*v+e*h*p*v+c*g*t*v-e*j*t*v-d*j*m*u+c*h*m*u+d*f*p*u-b*h*p*u-c*f*t*u+b*j*t*u+d*g*m*w-e*h*m*w-d*f*n*w+b*h*n*w+e*f*t*w-b*g*t*w-c*g*m*z+e*j*m*z+c*f*n*z-b*j*n*z-e*f*p*z+b*g*p*z},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=
this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;
this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=
this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,e){b[e]=this.n11;b[e+1]=this.n21;b[e+2]=this.n31;b[e+3]=this.n41;b[e+4]=this.n12;b[e+5]=this.n22;b[e+6]=this.n32;b[e+7]=this.n42;b[e+8]=this.n13;b[e+9]=this.n23;b[e+10]=this.n33;b[e+11]=this.n43;b[e+12]=this.n14;b[e+13]=this.n24;b[e+14]=this.n34;b[e+15]=this.n44;return b},setTranslation:function(b,e,c){this.set(1,0,0,b,0,1,0,e,0,0,1,c,0,0,0,1);return this},setScale:function(b,
e,c){this.set(b,0,0,0,0,e,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,e,-b,0,0,b,e,0,0,0,0,1);return this},setRotationY:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,0,b,0,0,1,0,0,-b,0,e,0,0,0,0,1);return this},setRotationZ:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,-b,0,0,b,e,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,e){var c=Math.cos(e),d=Math.sin(e),f=1-c,g=b.x,j=b.y,h=b.z,m=f*g,n=f*j;this.set(m*
g+c,m*j-d*h,m*h+d*j,0,m*j+d*h,n*j+c,n*h-d*g,0,m*h-d*j,n*h+d*g,f*h*h+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;
this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var e=b.x,c=b.y,d=b.z;b=Math.cos(e);e=Math.sin(e);var f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var j=b*c,h=e*c;this.n11=f*g;this.n12=-f*d;this.n13=c;this.n21=h*g+b*d;this.n22=-h*d+b*g;this.n23=-e*f;this.n31=-j*g+e*d;this.n32=j*d+e*g;this.n33=b*f;return this},
setRotationFromQuaternion:function(b){var e=b.x,c=b.y,d=b.z,f=b.w,g=e+e,j=c+c,h=d+d;b=e*g;var m=e*j;e*=h;var n=c*j;c*=h;d*=h;g*=f;j*=f;f*=h;this.n11=1-(n+d);this.n12=m-f;this.n13=e+j;this.n21=m+f;this.n22=1-(b+d);this.n23=c-g;this.n31=e-j;this.n32=c+g;this.n33=1-(b+n);return this},scale:function(b){var e=b.x,c=b.y;b=b.z;this.n11*=e;this.n12*=c;this.n13*=b;this.n21*=e;this.n22*=c;this.n23*=b;this.n31*=e;this.n32*=c;this.n33*=b;this.n41*=e;this.n42*=c;this.n43*=b;return this},extractPosition:function(b){this.n14=
b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,e){var c=1/e.x,d=1/e.y,f=1/e.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*d;this.n22=b.n22*d;this.n32=b.n32*d;this.n13=b.n13*f;this.n23=b.n23*f;this.n33=b.n33*f}};
THREE.Matrix4.makeInvert=function(b,e){var c=b.n11,d=b.n12,f=b.n13,g=b.n14,j=b.n21,h=b.n22,m=b.n23,n=b.n24,p=b.n31,t=b.n32,v=b.n33,u=b.n34,w=b.n41,z=b.n42,y=b.n43,A=b.n44;e===undefined&&(e=new THREE.Matrix4);e.n11=m*u*z-n*v*z+n*t*y-h*u*y-m*t*A+h*v*A;e.n12=g*v*z-f*u*z-g*t*y+d*u*y+f*t*A-d*v*A;e.n13=f*n*z-g*m*z+g*h*y-d*n*y-f*h*A+d*m*A;e.n14=g*m*t-f*n*t-g*h*v+d*n*v+f*h*u-d*m*u;e.n21=n*v*w-m*u*w-n*p*y+j*u*y+m*p*A-j*v*A;e.n22=f*u*w-g*v*w+g*p*y-c*u*y-f*p*A+c*v*A;e.n23=g*m*w-f*n*w-g*j*y+c*n*y+f*j*A-c*m*A;
e.n24=f*n*p-g*m*p+g*j*v-c*n*v-f*j*u+c*m*u;e.n31=h*u*w-n*t*w+n*p*z-j*u*z-h*p*A+j*t*A;e.n32=g*t*w-d*u*w-g*p*z+c*u*z+d*p*A-c*t*A;e.n33=f*n*w-g*h*w+g*j*z-c*n*z-d*j*A+c*h*A;e.n34=g*h*p-d*n*p-g*j*t+c*n*t+d*j*u-c*h*u;e.n41=m*t*w-h*v*w-m*p*z+j*v*z+h*p*y-j*t*y;e.n42=d*v*w-f*t*w+f*p*z-c*v*z-d*p*y+c*t*y;e.n43=f*h*w-d*m*w-f*j*z+c*m*z+d*j*y-c*h*y;e.n44=d*m*p-f*h*p+f*j*t-c*m*t-d*j*v+c*h*v;e.multiplyScalar(1/b.determinant());return e};
THREE.Matrix4.makeInvert3x3=function(b){var e=b.m33,c=e.m,d=b.n33*b.n22-b.n32*b.n23,f=-b.n33*b.n21+b.n31*b.n23,g=b.n32*b.n21-b.n31*b.n22,j=-b.n33*b.n12+b.n32*b.n13,h=b.n33*b.n11-b.n31*b.n13,m=-b.n32*b.n11+b.n31*b.n12,n=b.n23*b.n12-b.n22*b.n13,p=-b.n23*b.n11+b.n21*b.n13,t=b.n22*b.n11-b.n21*b.n12;b=b.n11*d+b.n21*j+b.n31*n;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*d;c[1]=b*f;c[2]=b*g;c[3]=b*j;c[4]=b*h;c[5]=b*m;c[6]=b*n;c[7]=b*p;c[8]=b*t;return e};
THREE.Matrix4.makeFrustum=function(b,e,c,d,f,g){var j;j=new THREE.Matrix4;j.n11=2*f/(e-b);j.n12=0;j.n13=(e+b)/(e-b);j.n14=0;j.n21=0;j.n22=2*f/(d-c);j.n23=(d+c)/(d-c);j.n24=0;j.n31=0;j.n32=0;j.n33=-(g+f)/(g-f);j.n34=-2*g*f/(g-f);j.n41=0;j.n42=0;j.n43=-1;j.n44=0;return j};THREE.Matrix4.makePerspective=function(b,e,c,d){var f;b=c*Math.tan(b*Math.PI/360);f=-b;return THREE.Matrix4.makeFrustum(f*e,b*e,f,b,c,d)};
THREE.Matrix4.makeOrtho=function(b,e,c,d,f,g){var j,h,m,n;j=new THREE.Matrix4;h=e-b;m=c-d;n=g-f;j.n11=2/h;j.n12=0;j.n13=0;j.n14=-((e+b)/h);j.n21=0;j.n22=2/m;j.n23=0;j.n24=-((c+d)/m);j.n31=0;j.n32=0;j.n33=-2/n;j.n34=-((g+f)/n);j.n41=0;j.n42=0;j.n43=0;j.n44=1;return j};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=
!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var e=this;e.parent!==undefined;)e=e.parent;e!==undefined&&e instanceof THREE.Scene&&e.addChildRecurse(b)}},removeChild:function(b){var e=this.children.indexOf(b);if(e!==-1){b.parent=undefined;this.children.splice(e,1)}},getChildByName:function(b,e){var c,d,f;c=0;for(d=this.children.length;c<d;c++){f=this.children[c];if(f.name===b)return f;if(e){f=f.getChildByName(b,e);if(f!==undefined)return f}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,e,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;e=!0}b=0;for(var d=this.children.length;b<d;b++)this.children[b].update(this.matrixWorld,e,c)}};THREE.Quaternion=function(b,e,c,d){this.set(b||0,e||0,c||0,d!==undefined?d:1)};
THREE.Quaternion.prototype={set:function(b,e,c,d){this.x=b;this.y=e;this.z=c;this.w=d;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var e=0.5*Math.PI/360,c=b.x*e,d=b.y*e,f=b.z*e;b=Math.cos(d);d=Math.sin(d);e=Math.cos(-f);f=Math.sin(-f);var g=Math.cos(c);c=Math.sin(c);var j=b*e,h=d*f;this.w=j*g-h*c;this.x=j*c+h*g;this.y=d*e*g+b*f*c;this.z=b*f*g-d*e*c;return this},setFromAxisAngle:function(b,e){var c=e/2,d=Math.sin(c);this.x=b.x*d;this.y=
b.y*d;this.z=b.z*d;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var e=this.x,c=this.y,d=this.z,f=this.w,g=b.x,j=b.y,h=b.z;b=b.w;this.x=e*b+f*g+c*h-d*j;this.y=c*b+f*j+d*g-e*h;this.z=d*b+f*h+e*j-c*g;this.w=f*b-e*g-c*j-d*h;return this},multiply:function(b,e){this.x=b.x*e.w+b.y*e.z-b.z*e.y+b.w*e.x;this.y=-b.x*e.z+b.y*e.w+b.z*e.x+b.w*e.y;this.z=b.x*e.y-b.y*e.x+b.z*e.w+b.w*e.z;this.w=-b.x*e.x-b.y*e.y-b.z*e.z+b.w*e.w;return this},multiplyVector3:function(b,e){e||(e=b);var c=b.x,d=b.y,f=b.z,g=this.x,j=this.y,h=this.z,m=this.w,n=m*c+j*f-h*d,p=
m*d+h*c-g*f,t=m*f+g*d-j*c;c=-g*c-j*d-h*f;e.x=n*m+c*-g+p*-h-t*-j;e.y=p*m+c*-j+t*-g-n*-h;e.z=t*m+c*-h+n*-j-p*-g;return e}};
THREE.Quaternion.slerp=function(b,e,c,d){var f=b.w*e.w+b.x*e.x+b.y*e.y+b.z*e.z;if(Math.abs(f)>=1){c.w=b.w;c.x=b.x;c.y=b.y;c.z=b.z;return c}var g=Math.acos(f),j=Math.sqrt(1-f*f);if(Math.abs(j)<0.001){c.w=0.5*(b.w+e.w);c.x=0.5*(b.x+e.x);c.y=0.5*(b.y+e.y);c.z=0.5*(b.z+e.z);return c}f=Math.sin((1-d)*g)/j;d=Math.sin(d*g)/j;c.w=b.w*f+e.w*d;c.x=b.x*f+e.x*d;c.y=b.y*f+e.y*d;c.z=b.z*f+e.z*d;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,e,c,d,f,g){this.a=b;this.b=e;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=g instanceof Array?g:[g];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,e,c,d,f,g,j){this.a=b;this.b=e;this.c=c;this.d=d;this.normal=f instanceof THREE.Vector3?f:new THREE.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=j instanceof Array?j:[j];this.centroid=new THREE.Vector3};THREE.UV=function(b,e){this.set(b||0,e||0)};
THREE.UV.prototype={set:function(b,e){this.u=b;this.v=e;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,e,c;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var e,c,d,f,g,j,h=new THREE.Vector3,m=new THREE.Vector3;d=0;for(f=this.faces.length;d<f;d++){g=this.faces[d];if(b&&g.vertexNormals.length){h.set(0,0,0);e=0;for(c=g.vertexNormals.length;e<c;e++)h.addSelf(g.vertexNormals[e]);h.divideScalar(3)}else{e=this.vertices[g.a];c=this.vertices[g.b];j=this.vertices[g.c];h.sub(j.position,c.position);m.sub(e.position,c.position);h.crossSelf(m)}h.isZero()||
h.normalize();g.normal.copy(h)}},computeVertexNormals:function(){var b,e,c,d;if(this.__tmpVertices==undefined){d=this.__tmpVertices=Array(this.vertices.length);b=0;for(e=this.vertices.length;b<e;b++)d[b]=new THREE.Vector3;b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{d=
this.__tmpVertices;b=0;for(e=this.vertices.length;b<e;b++)d[b].set(0,0,0)}b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal);d[c.d].addSelf(c.normal)}}b=0;for(e=this.vertices.length;b<e;b++)d[b].normalize();b=0;for(e=this.faces.length;b<e;b++){c=this.faces[b];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(d[c.a]);
c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c])}else if(c instanceof THREE.Face4){c.vertexNormals[0].copy(d[c.a]);c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c]);c.vertexNormals[3].copy(d[c.d])}}},computeTangents:function(){function b(U,ma,qa,va,fa,ta,za){h=U.vertices[ma].position;m=U.vertices[qa].position;n=U.vertices[va].position;p=j[fa];t=j[ta];v=j[za];u=m.x-h.x;w=n.x-h.x;z=m.y-h.y;y=n.y-h.y;A=m.z-h.z;E=n.z-h.z;B=t.u-p.u;I=v.u-p.u;D=t.v-p.v;C=v.v-p.v;K=1/(B*C-I*
D);ea.set((C*u-D*w)*K,(C*z-D*y)*K,(C*A-D*E)*K);o.set((B*w-I*u)*K,(B*y-I*z)*K,(B*E-I*A)*K);L[ma].addSelf(ea);L[qa].addSelf(ea);L[va].addSelf(ea);Q[ma].addSelf(o);Q[qa].addSelf(o);Q[va].addSelf(o)}var e,c,d,f,g,j,h,m,n,p,t,v,u,w,z,y,A,E,B,I,D,C,K,N,L=[],Q=[],ea=new THREE.Vector3,o=new THREE.Vector3,oa=new THREE.Vector3,ha=new THREE.Vector3,sa=new THREE.Vector3;e=0;for(c=this.vertices.length;e<c;e++){L[e]=new THREE.Vector3;Q[e]=new THREE.Vector3}e=0;for(c=this.faces.length;e<c;e++){g=this.faces[e];j=
this.faceVertexUvs[0][e];if(g instanceof THREE.Face3)b(this,g.a,g.b,g.c,0,1,2);else if(g instanceof THREE.Face4){b(this,g.a,g.b,g.c,0,1,2);b(this,g.a,g.b,g.d,0,1,3)}}var ka=["a","b","c","d"];e=0;for(c=this.faces.length;e<c;e++){g=this.faces[e];for(d=0;d<g.vertexNormals.length;d++){sa.copy(g.vertexNormals[d]);f=g[ka[d]];N=L[f];oa.copy(N);oa.subSelf(sa.multiplyScalar(sa.dot(N))).normalize();ha.cross(g.vertexNormals[d],N);f=ha.dot(Q[f]);f=f<0?-1:1;g.vertexTangents[d]=new THREE.Vector4(oa.x,oa.y,oa.z,
f)}}this.hasTangents=!0},computeBoundingBox:function(){var b;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var e=1,c=this.vertices.length;e<c;e++){b=this.vertices[e];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;
if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,e=0,c=this.vertices.length;e<c;e++)b=Math.max(b,this.vertices[e].position.length());this.boundingSphere=
{radius:b}},computeEdgeFaces:function(){function b(m,n){return Math.min(m,n)+"_"+Math.max(m,n)}function e(m,n,p){if(m[n]===undefined){m[n]={set:{},array:[]};m[n].set[p]=1;m[n].array.push(p)}else if(m[n].set[p]===undefined){m[n].set[p]=1;m[n].array.push(p)}}var c,d,f,g,j,h={};c=0;for(d=this.faces.length;c<d;c++){j=this.faces[c];if(j instanceof THREE.Face3){f=b(j.a,j.b);e(h,f,c);f=b(j.b,j.c);e(h,f,c);f=b(j.a,j.c);e(h,f,c)}else if(j instanceof THREE.Face4){f=b(j.b,j.d);e(h,f,c);f=b(j.a,j.b);e(h,f,c);
f=b(j.a,j.d);e(h,f,c);f=b(j.b,j.c);e(h,f,c);f=b(j.c,j.d);e(h,f,c)}}c=0;for(d=this.edges.length;c<d;c++){j=this.edges[c];f=j.vertexIndices[0];g=j.vertexIndices[1];j.faceIndices=h[b(f,g)].array;for(f=0;f<j.faceIndices.length;f++){g=j.faceIndices[f];j.faces.push(this.faces[g])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function e(u,w,z,y,A,E,B){u=(z-u)*0.5;y=(y-w)*0.5;return(2*(w-z)+u+y)*B+(-3*(w-z)-2*u-y)*E+u*A+w}this.points=b;var c=[],d={x:0,y:0,z:0},f,g,j,h,m,n,p,t,v;this.initFromArray=function(u){this.points=[];for(var w=0;w<u.length;w++)this.points[w]={x:u[w][0],y:u[w][1],z:u[w][2]}};this.getPoint=function(u){f=(this.points.length-1)*u;g=Math.floor(f);j=f-g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>this.points.length-2?g:g+1;c[3]=g>this.points.length-3?g:g+2;n=this.points[c[0]];p=this.points[c[1]];
t=this.points[c[2]];v=this.points[c[3]];h=j*j;m=j*h;d.x=e(n.x,p.x,t.x,v.x,j,h,m);d.y=e(n.y,p.y,t.y,v.y,j,h,m);d.z=e(n.z,p.z,t.z,v.z,j,h,m);return d};this.getControlPointsArray=function(){var u,w,z=this.points.length,y=[];for(u=0;u<z;u++){w=this.points[u];y[u]=[w.x,w.y,w.z]}return y};this.getLength=function(u){var w,z,y=0,A=new THREE.Vector3,E=new THREE.Vector3,B=[],I=0;B[0]=0;u||(u=100);z=this.points.length*u;A.copy(this.points[0]);for(u=1;u<z;u++){w=u/z;position=this.getPoint(w);E.copy(position);
I+=E.distanceTo(A);A.copy(position);w*=this.points.length-1;w=Math.floor(w);if(w!=y){B[w]=I;y=w}}B[B.length]=I;return{chunks:B,total:I}};this.reparametrizeByArcLength=function(u){var w,z,y,A,E,B,I=[],D=new THREE.Vector3,C=this.getLength();I.push(D.copy(this.points[0]).clone());for(w=1;w<this.points.length;w++){z=C.chunks[w]-C.chunks[w-1];B=Math.ceil(u*z/C.total);A=(w-1)/(this.points.length-1);E=w/(this.points.length-1);for(z=1;z<B-1;z++){y=A+z*(1/B)*(E-A);position=this.getPoint(y);I.push(D.copy(position).clone())}I.push(D.copy(this.points[w]).clone())}this.points=
I}};THREE.Edge=function(b,e,c,d){this.vertices=[b,e];this.vertexIndices=[c,d];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,e,c,d,f){THREE.Object3D.call(this);this.fov=b||50;this.aspect=e||1;this.near=c||0.1;this.far=d||2E3;this.target=f||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,e,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);e=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;e=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,e,c,d){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=e||1;this.distance=c||0;this.castShadow=d!==undefined?d:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,e,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=e||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,e,c,d){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,e,c,d)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,e,c,d){e===undefined&&(e=-1);c===undefined&&(c=0);if(d===undefined)d=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:e,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,e=this.lensFlares.length,c,d=-this.positionScreen.x*2,f=-this.positionScreen.y*2;for(b=0;b<e;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+f*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ParticleCanvasMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.program=b.program!==undefined?b.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(b){THREE.Material.call(this);this.domElement=b};
THREE.Texture=function(b,e,c,d,f,g){this.image=b;this.mapping=e!==undefined?e:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==undefined?d:THREE.ClampToEdgeWrapping;this.magFilter=f!==undefined?f:THREE.LinearFilter;this.minFilter=g!==undefined?g:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.materials=b instanceof Array?b:[b]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;
THREE.Line=function(b,e,c){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e&&e.length?e:[e];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[c].name]=c}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.skinMatrix,e,c):b.update(this.matrixWorld,!0,c)}}else for(d=0;d<f;d++)this.children[d].update(this.skinMatrix,
e,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,e){THREE.Mesh.call(this,b,e);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,d,f,g,j,h;if(this.geometry.bones!==undefined){for(c=0;c<this.geometry.bones.length;c++){f=this.geometry.bones[c];g=f.pos;j=f.rotq;h=f.scl;d=this.addBone();d.name=f.name;d.position.set(g[0],g[1],g[2]);d.quaternion.set(j[0],j[1],j[2],j[3]);d.useQuaternion=!0;h!==undefined?d.scale.set(h[0],h[1],h[2]):d.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){f=this.geometry.bones[c];
d=this.bones[c];f.parent===-1?this.addChild(d):this.bones[f.parent].addChild(d)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,e,c){if(this.visible){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d,f=this.children.length;for(d=0;d<f;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,e,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(e=0;e<c;e++)ba[e].skinMatrix.flattenToArrayOffset(bm,
e*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,e=[],c=0;c<this.bones.length;c++){b=this.bones[c];e.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var d;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var f=this.geometry.skinIndices[b].x,g=this.geometry.skinIndices[b].y;
d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(e[f].multiplyVector3(d));d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(e[g].multiplyVector3(d));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=c;this.geometry.skinWeights[b].y+=c}}}};
THREE.Ribbon=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,e,c,d){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=e!==undefined?Math.abs(e):100;this.volume=Math.min(1,Math.max(0,c!==undefined?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=d!==undefined?d:!0;this.sources=b instanceof Array?b:[b];var f;c=this.sources.length;for(b=0;b<c;b++){e=this.sources[b];e.toLowerCase();if(e.indexOf(".mp3")!==-1)f=
"audio/mpeg";else if(e.indexOf(".ogg")!==-1)f="audio/ogg";else e.indexOf(".wav")!==-1&&(f="audio/wav");if(this.domElement.canPlayType(f)){f=document.createElement("source");f.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(f);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,e,c){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);e=!0}if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var d=this.children.length;for(b=0;b<d;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,e){e===undefined&&(e=0);e=Math.abs(e);for(var c=0;c<this.LODs.length;c++)if(e<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:e,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,e,c){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length;d++)if(b>=this.LODs[d].visibleAtDistance){this.LODs[d-1].object3D.visible=
!1;this.LODs[d].object3D.visible=!0}else break;for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,c)};THREE.ShadowVolume=function(b,e){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,e,c,d,f,g,j,h,m,n,p,t,v,u,w=new THREE.Geometry;w.vertices=this.geometry.vertices;d=w.faces=this.geometry.faces;var z=w.egdes=this.geometry.edges,y=w.edgeFaces=[];f=0;var A=[];b=0;for(e=d.length;b<e;b++){c=d[b];A.push(f);f+=c instanceof THREE.Face3?3:4;c.vertexNormals[0]=c.normal;c.vertexNormals[1]=c.normal;c.vertexNormals[2]=c.normal;if(c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal}b=0;for(e=z.length;b<e;b++){h=z[b];c=h.faces[0];d=h.faces[1];f=h.faceIndices[0];g=h.faceIndices[1];j=h.vertexIndices[0];h=h.vertexIndices[1];if(c.a===j){m="a";p=A[f]+0}else if(c.b===j){m="b";p=A[f]+1}else if(c.c===j){m="c";p=A[f]+2}else if(c.d===j){m="d";p=A[f]+3}if(c.a===h){m+="a";t=A[f]+0}else if(c.b===h){m+="b";t=A[f]+1}else if(c.c===h){m+="c";t=A[f]+2}else if(c.d===h){m+="d";t=A[f]+3}if(d.a===j){n="a";v=A[g]+0}else if(d.b===j){n="b";v=A[g]+1}else if(d.c===j){n="c";v=A[g]+2}else if(d.d===
j){n="d";v=A[g]+3}if(d.a===h){n+="a";u=A[g]+0}else if(d.b===h){n+="b";u=A[g]+1}else if(d.c===h){n+="c";u=A[g]+2}else if(d.d===h){n+="d";u=A[g]+3}if(m==="ac"||m==="ad"||m==="ca"||m==="da"){if(p>t){c=p;p=t;t=c}}else if(p<t){c=p;p=t;t=c}if(n==="ac"||n==="ad"||n==="ca"||n==="da"){if(v>u){c=v;v=u;u=c}}else if(v<u){c=v;v=u;u=c}c=new THREE.Face4(p,t,v,u);c.normal.set(1,0,0);y.push(c)}this.geometry=w}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var e=this.geometry.vertices,c=this.geometry.faces,d=this.geometry.edgeFaces,f=b.faces;b=b.vertices;var g=f.length,j,h,m,n,p,t=["a","b","c","d"];for(m=0;m<g;m++){h=e.length;j=f[m];if(j instanceof THREE.Face4){n=4;h=new THREE.Face4(h,h+1,h+2,h+3)}else{n=3;h=new THREE.Face3(h,h+1,h+2)}h.normal.copy(j.normal);c.push(h);
for(h=0;h<n;h++){p=b[j[t[h]]];e.push(new THREE.Vertex(p.position.clone()))}}for(g=0;g<f.length-1;g++){b=c[g];for(j=g+1;j<f.length;j++){h=c[j];h=this.facesShareEdge(e,b,h);if(h!==undefined){h=new THREE.Face4(h.indices[0],h.indices[3],h.indices[2],h.indices[1]);h.normal.set(1,0,0);d.push(h)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,e,c){var d,f,g,j,h,m,n,p,t,v,u,w,z,y=0,A=["a","b","c","d"];d=e instanceof THREE.Face4?4:3;f=c instanceof THREE.Face4?4:3;for(w=0;w<d;w++){g=e[A[w]];h=b[g];for(z=0;z<f;z++){j=c[A[z]];m=b[j];if(Math.abs(h.position.x-m.position.x)<1.0E-4&&Math.abs(h.position.y-m.position.y)<1.0E-4&&Math.abs(h.position.z-m.position.z)<1.0E-4){y++;if(y===1){n=h;p=m;t=g;v=j;u=A[w]}if(y===2){u+=A[w];return u==="ad"||u==="ac"?{faces:[e,c],vertices:[n,p,m,h],indices:[t,
v,j,g],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[e,c],vertices:[n,h,m,p],indices:[t,g,j,v],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var e=0;e<b.children.length;e++)this.addChildRecurse(b.children[e])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var e=this.lights.indexOf(b);e!==-1&&this.lights.splice(e,1)}else if(b instanceof THREE.Sound){e=this.sounds.indexOf(b);e!==-1&&this.sounds.splice(e,1)}else if(!(b instanceof THREE.Camera)){e=this.objects.indexOf(b);if(e!==-1){this.objects.splice(e,1);this.__objectsRemoved.push(b)}}for(e=0;e<b.children.length;e++)this.removeChildRecurse(b.children[e])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,e,c){this.color=new THREE.Color(b);this.near=e||1;this.far=c||1E3};THREE.FogExp2=function(b,e){this.color=new THREE.Color(b);this.density=e!==undefined?e:2.5E-4};
THREE.Projector=function(){function b(){var ea=m[h]=m[h]||new THREE.RenderableVertex;h++;return ea}function e(ea,o){return o.z-ea.z}function c(ea,o){var oa=0,ha=1,sa=ea.z+ea.w,ka=o.z+o.w,U=-ea.z+ea.w,ma=-o.z+o.w;if(sa>=0&&ka>=0&&U>=0&&ma>=0)return!0;else if(sa<0&&ka<0||U<0&&ma<0)return!1;else{if(sa<0)oa=Math.max(oa,sa/(sa-ka));else ka<0&&(ha=Math.min(ha,sa/(sa-ka)));if(U<0)oa=Math.max(oa,U/(U-ma));else ma<0&&(ha=Math.min(ha,U/(U-ma)));if(ha<oa)return!1;else{ea.lerpSelf(o,oa);o.lerpSelf(ea,1-ha);return!0}}}
var d,f,g=[],j,h,m=[],n,p,t=[],v,u=[],w,z,y=[],A,E,B=[],I=new THREE.Vector4,D=new THREE.Vector4,C=new THREE.Matrix4,K=new THREE.Matrix4,N=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],L=new THREE.Vector4,Q=new THREE.Vector4;this.projectVector=function(ea,o){C.multiply(o.projectionMatrix,o.matrixWorldInverse);C.multiplyVector3(ea);return ea};this.unprojectVector=function(ea,o){C.multiply(o.matrixWorld,THREE.Matrix4.makeInvert(o.projectionMatrix));
C.multiplyVector3(ea);return ea};this.projectObjects=function(ea,o,oa){o=[];var ha,sa,ka;f=0;sa=ea.objects;ea=0;for(ha=sa.length;ea<ha;ea++){ka=sa[ea];var U;if(!(U=!ka.visible))if(U=ka instanceof THREE.Mesh){a:{for(var ma=ka.matrixWorld,qa=-ka.geometry.boundingSphere.radius*Math.max(ka.scale.x,Math.max(ka.scale.y,ka.scale.z)),va=0;va<6;va++){U=N[va].x*ma.n14+N[va].y*ma.n24+N[va].z*ma.n34+N[va].w;if(U<=qa){U=!1;break a}}U=!0}U=!U}if(!U){U=g[f]=g[f]||new THREE.RenderableObject;f++;d=U;I.copy(ka.position);
C.multiplyVector3(I);d.object=ka;d.z=I.z;o.push(d)}}oa&&o.sort(e);return o};this.projectScene=function(ea,o,oa){var ha=[],sa=o.near,ka=o.far,U,ma,qa,va,fa,ta,za,ca,$,ia,Aa,Ka,Ba,Ea,V,ra,aa;E=z=v=p=0;o.matrixAutoUpdate&&o.update(undefined,!0);ea.update(undefined,!1,o);C.multiply(o.projectionMatrix,o.matrixWorldInverse);N[0].set(C.n41-C.n11,C.n42-C.n12,C.n43-C.n13,C.n44-C.n14);N[1].set(C.n41+C.n11,C.n42+C.n12,C.n43+C.n13,C.n44+C.n14);N[2].set(C.n41+C.n21,C.n42+C.n22,C.n43+C.n23,C.n44+C.n24);N[3].set(C.n41-
C.n21,C.n42-C.n22,C.n43-C.n23,C.n44-C.n24);N[4].set(C.n41-C.n31,C.n42-C.n32,C.n43-C.n33,C.n44-C.n34);N[5].set(C.n41+C.n31,C.n42+C.n32,C.n43+C.n33,C.n44+C.n34);for(U=0;U<6;U++){$=N[U];$.divideScalar(Math.sqrt($.x*$.x+$.y*$.y+$.z*$.z))}$=this.projectObjects(ea,o,!0);ea=0;for(U=$.length;ea<U;ea++){ia=$[ea].object;if(ia.visible){Aa=ia.matrixWorld;Ka=ia.matrixRotationWorld;Ba=ia.materials;Ea=ia.overdraw;h=0;if(ia instanceof THREE.Mesh){V=ia.geometry;va=V.vertices;ra=V.faces;V=V.faceVertexUvs;ma=0;for(qa=
va.length;ma<qa;ma++){j=b();j.positionWorld.copy(va[ma].position);Aa.multiplyVector3(j.positionWorld);j.positionScreen.copy(j.positionWorld);C.multiplyVector4(j.positionScreen);j.positionScreen.x/=j.positionScreen.w;j.positionScreen.y/=j.positionScreen.w;j.visible=j.positionScreen.z>sa&&j.positionScreen.z<ka}va=0;for(ma=ra.length;va<ma;va++){qa=ra[va];if(qa instanceof THREE.Face3){fa=m[qa.a];ta=m[qa.b];za=m[qa.c];if(fa.visible&&ta.visible&&za.visible&&(ia.doubleSided||ia.flipSided!=(za.positionScreen.x-
fa.positionScreen.x)*(ta.positionScreen.y-fa.positionScreen.y)-(za.positionScreen.y-fa.positionScreen.y)*(ta.positionScreen.x-fa.positionScreen.x)<0)){ca=t[p]=t[p]||new THREE.RenderableFace3;p++;n=ca;n.v1.copy(fa);n.v2.copy(ta);n.v3.copy(za)}else continue}else if(qa instanceof THREE.Face4){fa=m[qa.a];ta=m[qa.b];za=m[qa.c];ca=m[qa.d];if(fa.visible&&ta.visible&&za.visible&&ca.visible&&(ia.doubleSided||ia.flipSided!=((ca.positionScreen.x-fa.positionScreen.x)*(ta.positionScreen.y-fa.positionScreen.y)-
(ca.positionScreen.y-fa.positionScreen.y)*(ta.positionScreen.x-fa.positionScreen.x)<0||(ta.positionScreen.x-za.positionScreen.x)*(ca.positionScreen.y-za.positionScreen.y)-(ta.positionScreen.y-za.positionScreen.y)*(ca.positionScreen.x-za.positionScreen.x)<0))){aa=u[v]=u[v]||new THREE.RenderableFace4;v++;n=aa;n.v1.copy(fa);n.v2.copy(ta);n.v3.copy(za);n.v4.copy(ca)}else continue}n.normalWorld.copy(qa.normal);Ka.multiplyVector3(n.normalWorld);n.centroidWorld.copy(qa.centroid);Aa.multiplyVector3(n.centroidWorld);
n.centroidScreen.copy(n.centroidWorld);C.multiplyVector3(n.centroidScreen);za=qa.vertexNormals;fa=0;for(ta=za.length;fa<ta;fa++){ca=n.vertexNormalsWorld[fa];ca.copy(za[fa]);Ka.multiplyVector3(ca)}fa=0;for(ta=V.length;fa<ta;fa++)if(aa=V[fa][va]){za=0;for(ca=aa.length;za<ca;za++)n.uvs[fa][za]=aa[za]}n.meshMaterials=Ba;n.faceMaterials=qa.materials;n.overdraw=Ea;n.z=n.centroidScreen.z;ha.push(n)}}else if(ia instanceof THREE.Line){K.multiply(C,Aa);va=ia.geometry.vertices;fa=b();fa.positionScreen.copy(va[0].position);
K.multiplyVector4(fa.positionScreen);ma=1;for(qa=va.length;ma<qa;ma++){fa=b();fa.positionScreen.copy(va[ma].position);K.multiplyVector4(fa.positionScreen);ta=m[h-2];L.copy(fa.positionScreen);Q.copy(ta.positionScreen);if(c(L,Q)){L.multiplyScalar(1/L.w);Q.multiplyScalar(1/Q.w);Aa=y[z]=y[z]||new THREE.RenderableLine;z++;w=Aa;w.v1.positionScreen.copy(L);w.v2.positionScreen.copy(Q);w.z=Math.max(L.z,Q.z);w.materials=ia.materials;ha.push(w)}}}else if(ia instanceof THREE.Particle){D.set(ia.matrixWorld.n14,
ia.matrixWorld.n24,ia.matrixWorld.n34,1);C.multiplyVector4(D);D.z/=D.w;if(D.z>0&&D.z<1){Aa=B[E]=B[E]||new THREE.RenderableParticle;E++;A=Aa;A.x=D.x/D.w;A.y=D.y/D.w;A.z=D.z;A.rotation=ia.rotation.z;A.scale.x=ia.scale.x*Math.abs(A.x-(D.x+o.projectionMatrix.n11)/(D.w+o.projectionMatrix.n14));A.scale.y=ia.scale.y*Math.abs(A.y-(D.y+o.projectionMatrix.n22)/(D.w+o.projectionMatrix.n24));A.materials=ia.materials;ha.push(A)}}}}oa&&ha.sort(e);return ha}};
THREE.DOMRenderer=function(){THREE.Renderer.call(this);var b=null,e=new THREE.Projector,c,d,f,g;this.domElement=document.createElement("div");this.setSize=function(j,h){c=j;d=h;f=c/2;g=d/2};this.render=function(j,h){var m,n,p,t,v,u,w,z;b=e.projectScene(j,h);m=0;for(n=b.length;m<n;m++){v=b[m];if(v instanceof THREE.RenderableParticle){w=v.x*f+f;z=v.y*g+g;p=0;for(t=v.material.length;p<t;p++){u=v.material[p];if(u instanceof THREE.ParticleDOMMaterial){u=u.domElement;u.style.left=w+"px";u.style.top=z+"px"}}}}}};
THREE.CanvasRenderer=function(){function b(Fa){if(w!=Fa)t.globalAlpha=w=Fa}function e(Fa){if(z!=Fa){switch(Fa){case THREE.NormalBlending:t.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:t.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:t.globalCompositeOperation="darker"}z=Fa}}function c(Fa){if(y!=Fa)t.strokeStyle=y=Fa}var d=this,f=null,g=new THREE.Projector,j=document.createElement("canvas"),h,m,n,p,t=j.getContext("2d"),v=new THREE.Color(0),u=0,w=
1,z=0,y=null,A=null,E=null,B=null,I=null,D,C,K,N,L=new THREE.RenderableVertex,Q=new THREE.RenderableVertex,ea,o,oa,ha,sa,ka,U,ma,qa,va,fa,ta,za=new THREE.Color,ca=new THREE.Color,$=new THREE.Color,ia=new THREE.Color,Aa=new THREE.Color,Ka,Ba,Ea,V,ra,aa,Z,Pa,eb,x,M=new THREE.Rectangle,F=new THREE.Rectangle,G=new THREE.Rectangle,J=!1,T=new THREE.Color,S=new THREE.Color,R=new THREE.Color,Y=new THREE.Color,O=new THREE.Vector3,W,X,na,ga,Ha,Oa,Ja=16;W=document.createElement("canvas");W.width=W.height=2;
X=W.getContext("2d");X.fillStyle="rgba(0,0,0,1)";X.fillRect(0,0,2,2);na=X.getImageData(0,0,2,2);ga=na.data;Ha=document.createElement("canvas");Ha.width=Ha.height=Ja;Oa=Ha.getContext("2d");Oa.translate(-Ja/2,-Ja/2);Oa.scale(Ja,Ja);Ja--;this.domElement=j;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,faces:0};this.setSize=function(Fa,Sa){h=Fa;m=Sa;n=h/2;p=m/2;j.width=h;j.height=m;M.set(-n,-p,n,p);w=1;z=0;I=B=E=A=y=null};this.setClearColor=function(Fa,Sa){v=Fa;u=Sa};
this.setClearColorHex=function(Fa,Sa){v.setHex(Fa);u=Sa};this.clear=function(){t.setTransform(1,0,0,-1,n,p);if(!F.isEmpty()){F.inflate(1);F.minSelf(M);if(v.hex==0&&u==0)t.clearRect(F.getX(),F.getY(),F.getWidth(),F.getHeight());else{e(THREE.NormalBlending);b(1);t.fillStyle="rgba("+Math.floor(v.r*255)+","+Math.floor(v.g*255)+","+Math.floor(v.b*255)+","+u+")";t.fillRect(F.getX(),F.getY(),F.getWidth(),F.getHeight())}F.empty()}};this.render=function(Fa,Sa){function La(ja){var xa,ya,pa,Da=ja.lights;S.setRGB(0,
0,0);R.setRGB(0,0,0);Y.setRGB(0,0,0);ja=0;for(xa=Da.length;ja<xa;ja++){ya=Da[ja];pa=ya.color;if(ya instanceof THREE.AmbientLight){S.r+=pa.r;S.g+=pa.g;S.b+=pa.b}else if(ya instanceof THREE.DirectionalLight){R.r+=pa.r;R.g+=pa.g;R.b+=pa.b}else if(ya instanceof THREE.PointLight){Y.r+=pa.r;Y.g+=pa.g;Y.b+=pa.b}}}function Ga(ja,xa,ya,pa){var Da,Ca,wa,la,Na=ja.lights;ja=0;for(Da=Na.length;ja<Da;ja++){Ca=Na[ja];wa=Ca.color;if(Ca instanceof THREE.DirectionalLight){la=ya.dot(Ca.position);if(!(la<=0)){la*=Ca.intensity;
pa.r+=wa.r*la;pa.g+=wa.g*la;pa.b+=wa.b*la}}else if(Ca instanceof THREE.PointLight){la=ya.dot(O.sub(Ca.position,xa).normalize());if(!(la<=0)){la*=Ca.distance==0?1:1-Math.min(xa.distanceTo(Ca.position)/Ca.distance,1);if(la!=0){la*=Ca.intensity;pa.r+=wa.r*la;pa.g+=wa.g*la;pa.b+=wa.b*la}}}}}function Ma(ja,xa,ya){b(ya.opacity);e(ya.blending);var pa,Da,Ca,wa,la,Na;if(ya instanceof THREE.ParticleBasicMaterial){if(ya.map){wa=ya.map.image;la=wa.width>>1;Na=wa.height>>1;ya=xa.scale.x*n;Ca=xa.scale.y*p;pa=ya*
la;Da=Ca*Na;G.set(ja.x-pa,ja.y-Da,ja.x+pa,ja.y+Da);if(M.instersects(G)){t.save();t.translate(ja.x,ja.y);t.rotate(-xa.rotation);t.scale(ya,-Ca);t.translate(-la,-Na);t.drawImage(wa,0,0);t.restore()}}}else if(ya instanceof THREE.ParticleCanvasMaterial){pa=xa.scale.x*n;Da=xa.scale.y*p;G.set(ja.x-pa,ja.y-Da,ja.x+pa,ja.y+Da);if(M.instersects(G)){c(ya.color.__styleString);Ca=ya.color.__styleString;if(A!=Ca)t.fillStyle=A=Ca;t.save();t.translate(ja.x,ja.y);t.rotate(-xa.rotation);t.scale(pa,Da);ya.program(t);
t.restore()}}}function Xa(ja,xa,ya,pa){b(pa.opacity);e(pa.blending);t.beginPath();t.moveTo(ja.positionScreen.x,ja.positionScreen.y);t.lineTo(xa.positionScreen.x,xa.positionScreen.y);t.closePath();if(pa instanceof THREE.LineBasicMaterial){za.__styleString=pa.color.__styleString;ja=pa.linewidth;if(E!=ja)t.lineWidth=E=ja;ja=pa.linecap;if(B!=ja)t.lineCap=B=ja;ja=pa.linejoin;if(I!=ja)t.lineJoin=I=ja;c(za.__styleString);t.stroke();G.inflate(pa.linewidth*2)}}function P(ja,xa,ya,pa,Da,Ca,wa,la,Na){d.data.vertices+=
3;d.data.faces++;b(la.opacity);e(la.blending);ea=ja.positionScreen.x;o=ja.positionScreen.y;oa=xa.positionScreen.x;ha=xa.positionScreen.y;sa=ya.positionScreen.x;ka=ya.positionScreen.y;H(ea,o,oa,ha,sa,ka);if(la instanceof THREE.MeshBasicMaterial)if(la.map){if(la.map.mapping instanceof THREE.UVMapping){V=wa.uvs[0];Ta(ea,o,oa,ha,sa,ka,la.map.image,V[pa].u,V[pa].v,V[Da].u,V[Da].v,V[Ca].u,V[Ca].v)}}else if(la.envMap){if(la.envMap.mapping instanceof THREE.SphericalReflectionMapping){ja=Sa.matrixWorldInverse;
O.copy(wa.vertexNormalsWorld[0]);ra=(O.x*ja.n11+O.y*ja.n12+O.z*ja.n13)*0.5+0.5;aa=-(O.x*ja.n21+O.y*ja.n22+O.z*ja.n23)*0.5+0.5;O.copy(wa.vertexNormalsWorld[1]);Z=(O.x*ja.n11+O.y*ja.n12+O.z*ja.n13)*0.5+0.5;Pa=-(O.x*ja.n21+O.y*ja.n22+O.z*ja.n23)*0.5+0.5;O.copy(wa.vertexNormalsWorld[2]);eb=(O.x*ja.n11+O.y*ja.n12+O.z*ja.n13)*0.5+0.5;x=-(O.x*ja.n21+O.y*ja.n22+O.z*ja.n23)*0.5+0.5;Ta(ea,o,oa,ha,sa,ka,la.envMap.image,ra,aa,Z,Pa,eb,x)}}else la.wireframe?fb(la.color.__styleString,la.wireframeLinewidth,la.wireframeLinecap,
la.wireframeLinejoin):Ra(la.color.__styleString);else if(la instanceof THREE.MeshLambertMaterial){if(la.map&&!la.wireframe){if(la.map.mapping instanceof THREE.UVMapping){V=wa.uvs[0];Ta(ea,o,oa,ha,sa,ka,la.map.image,V[pa].u,V[pa].v,V[Da].u,V[Da].v,V[Ca].u,V[Ca].v)}e(THREE.SubtractiveBlending)}if(J)if(!la.wireframe&&la.shading==THREE.SmoothShading&&wa.vertexNormalsWorld.length==3){ca.r=$.r=ia.r=S.r;ca.g=$.g=ia.g=S.g;ca.b=$.b=ia.b=S.b;Ga(Na,wa.v1.positionWorld,wa.vertexNormalsWorld[0],ca);Ga(Na,wa.v2.positionWorld,
wa.vertexNormalsWorld[1],$);Ga(Na,wa.v3.positionWorld,wa.vertexNormalsWorld[2],ia);Aa.r=($.r+ia.r)*0.5;Aa.g=($.g+ia.g)*0.5;Aa.b=($.b+ia.b)*0.5;Ea=jb(ca,$,ia,Aa);Ta(ea,o,oa,ha,sa,ka,Ea,0,0,1,0,0,1)}else{T.r=S.r;T.g=S.g;T.b=S.b;Ga(Na,wa.centroidWorld,wa.normalWorld,T);za.r=la.color.r*T.r;za.g=la.color.g*T.g;za.b=la.color.b*T.b;za.updateStyleString();la.wireframe?fb(za.__styleString,la.wireframeLinewidth,la.wireframeLinecap,la.wireframeLinejoin):Ra(za.__styleString)}else la.wireframe?fb(la.color.__styleString,
la.wireframeLinewidth,la.wireframeLinecap,la.wireframeLinejoin):Ra(la.color.__styleString)}else if(la instanceof THREE.MeshDepthMaterial){Ka=Sa.near;Ba=Sa.far;ca.r=ca.g=ca.b=1-gb(ja.positionScreen.z,Ka,Ba);$.r=$.g=$.b=1-gb(xa.positionScreen.z,Ka,Ba);ia.r=ia.g=ia.b=1-gb(ya.positionScreen.z,Ka,Ba);Aa.r=($.r+ia.r)*0.5;Aa.g=($.g+ia.g)*0.5;Aa.b=($.b+ia.b)*0.5;Ea=jb(ca,$,ia,Aa);Ta(ea,o,oa,ha,sa,ka,Ea,0,0,1,0,0,1)}else if(la instanceof THREE.MeshNormalMaterial){za.r=ab(wa.normalWorld.x);za.g=ab(wa.normalWorld.y);
za.b=ab(wa.normalWorld.z);za.updateStyleString();la.wireframe?fb(za.__styleString,la.wireframeLinewidth,la.wireframeLinecap,la.wireframeLinejoin):Ra(za.__styleString)}}function ua(ja,xa,ya,pa,Da,Ca,wa,la,Na){d.data.vertices+=4;d.data.faces++;b(la.opacity);e(la.blending);if(la.map||la.envMap){P(ja,xa,pa,0,1,3,wa,la,Na);P(Da,ya,Ca,1,2,3,wa,la,Na)}else{ea=ja.positionScreen.x;o=ja.positionScreen.y;oa=xa.positionScreen.x;ha=xa.positionScreen.y;sa=ya.positionScreen.x;ka=ya.positionScreen.y;U=pa.positionScreen.x;
ma=pa.positionScreen.y;qa=Da.positionScreen.x;va=Da.positionScreen.y;fa=Ca.positionScreen.x;ta=Ca.positionScreen.y;if(la instanceof THREE.MeshBasicMaterial){cb(ea,o,oa,ha,sa,ka,U,ma);la.wireframe?fb(la.color.__styleString,la.wireframeLinewidth,la.wireframeLinecap,la.wireframeLinejoin):Ra(la.color.__styleString)}else if(la instanceof THREE.MeshLambertMaterial)if(J)if(!la.wireframe&&la.shading==THREE.SmoothShading&&wa.vertexNormalsWorld.length==4){ca.r=$.r=ia.r=Aa.r=S.r;ca.g=$.g=ia.g=Aa.g=S.g;ca.b=
$.b=ia.b=Aa.b=S.b;Ga(Na,wa.v1.positionWorld,wa.vertexNormalsWorld[0],ca);Ga(Na,wa.v2.positionWorld,wa.vertexNormalsWorld[1],$);Ga(Na,wa.v4.positionWorld,wa.vertexNormalsWorld[3],ia);Ga(Na,wa.v3.positionWorld,wa.vertexNormalsWorld[2],Aa);Ea=jb(ca,$,ia,Aa);H(ea,o,oa,ha,U,ma);Ta(ea,o,oa,ha,U,ma,Ea,0,0,1,0,0,1);H(qa,va,sa,ka,fa,ta);Ta(qa,va,sa,ka,fa,ta,Ea,1,0,1,1,0,1)}else{T.r=S.r;T.g=S.g;T.b=S.b;Ga(Na,wa.centroidWorld,wa.normalWorld,T);za.r=la.color.r*T.r;za.g=la.color.g*T.g;za.b=la.color.b*T.b;za.updateStyleString();
cb(ea,o,oa,ha,sa,ka,U,ma);la.wireframe?fb(za.__styleString,la.wireframeLinewidth,la.wireframeLinecap,la.wireframeLinejoin):Ra(za.__styleString)}else{cb(ea,o,oa,ha,sa,ka,U,ma);la.wireframe?fb(la.color.__styleString,la.wireframeLinewidth,la.wireframeLinecap,la.wireframeLinejoin):Ra(la.color.__styleString)}else if(la instanceof THREE.MeshNormalMaterial){za.r=ab(wa.normalWorld.x);za.g=ab(wa.normalWorld.y);za.b=ab(wa.normalWorld.z);za.updateStyleString();cb(ea,o,oa,ha,sa,ka,U,ma);la.wireframe?fb(za.__styleString,
la.wireframeLinewidth,la.wireframeLinecap,la.wireframeLinejoin):Ra(za.__styleString)}else if(la instanceof THREE.MeshDepthMaterial){Ka=Sa.near;Ba=Sa.far;ca.r=ca.g=ca.b=1-gb(ja.positionScreen.z,Ka,Ba);$.r=$.g=$.b=1-gb(xa.positionScreen.z,Ka,Ba);ia.r=ia.g=ia.b=1-gb(pa.positionScreen.z,Ka,Ba);Aa.r=Aa.g=Aa.b=1-gb(ya.positionScreen.z,Ka,Ba);Ea=jb(ca,$,ia,Aa);H(ea,o,oa,ha,U,ma);Ta(ea,o,oa,ha,U,ma,Ea,0,0,1,0,0,1);H(qa,va,sa,ka,fa,ta);Ta(qa,va,sa,ka,fa,ta,Ea,1,0,1,1,0,1)}}}function H(ja,xa,ya,pa,Da,Ca){t.beginPath();
t.moveTo(ja,xa);t.lineTo(ya,pa);t.lineTo(Da,Ca);t.lineTo(ja,xa);t.closePath()}function cb(ja,xa,ya,pa,Da,Ca,wa,la){t.beginPath();t.moveTo(ja,xa);t.lineTo(ya,pa);t.lineTo(Da,Ca);t.lineTo(wa,la);t.lineTo(ja,xa);t.closePath()}function fb(ja,xa,ya,pa){if(E!=xa)t.lineWidth=E=xa;if(B!=ya)t.lineCap=B=ya;if(I!=pa)t.lineJoin=I=pa;c(ja);t.stroke();G.inflate(xa*2)}function Ra(ja){if(A!=ja)t.fillStyle=A=ja;t.fill()}function Ta(ja,xa,ya,pa,Da,Ca,wa,la,Na,Ya,Wa,kb,Za){var hb,ib;hb=wa.width-1;ib=wa.height-1;la*=
hb;Na*=ib;Ya*=hb;Wa*=ib;kb*=hb;Za*=ib;ya-=ja;pa-=xa;Da-=ja;Ca-=xa;Ya-=la;Wa-=Na;kb-=la;Za-=Na;hb=Ya*Za-kb*Wa;if(hb!=0){ib=1/hb;hb=(Za*ya-Wa*Da)*ib;Wa=(Za*pa-Wa*Ca)*ib;ya=(Ya*Da-kb*ya)*ib;pa=(Ya*Ca-kb*pa)*ib;ja=ja-hb*la-ya*Na;xa=xa-Wa*la-pa*Na;t.save();t.transform(hb,Wa,ya,pa,ja,xa);t.clip();t.drawImage(wa,0,0);t.restore()}}function jb(ja,xa,ya,pa){var Da=~~(ja.r*255),Ca=~~(ja.g*255);ja=~~(ja.b*255);var wa=~~(xa.r*255),la=~~(xa.g*255);xa=~~(xa.b*255);var Na=~~(ya.r*255),Ya=~~(ya.g*255);ya=~~(ya.b*
255);var Wa=~~(pa.r*255),kb=~~(pa.g*255);pa=~~(pa.b*255);ga[0]=Da<0?0:Da>255?255:Da;ga[1]=Ca<0?0:Ca>255?255:Ca;ga[2]=ja<0?0:ja>255?255:ja;ga[4]=wa<0?0:wa>255?255:wa;ga[5]=la<0?0:la>255?255:la;ga[6]=xa<0?0:xa>255?255:xa;ga[8]=Na<0?0:Na>255?255:Na;ga[9]=Ya<0?0:Ya>255?255:Ya;ga[10]=ya<0?0:ya>255?255:ya;ga[12]=Wa<0?0:Wa>255?255:Wa;ga[13]=kb<0?0:kb>255?255:kb;ga[14]=pa<0?0:pa>255?255:pa;X.putImageData(na,0,0);Oa.drawImage(W,0,0);return Ha}function gb(ja,xa,ya){ja=(ja-xa)/(ya-xa);return ja*ja*(3-2*ja)}
function ab(ja){ja=(ja+1)*0.5;return ja<0?0:ja>1?1:ja}function bb(ja,xa){var ya=xa.x-ja.x,pa=xa.y-ja.y,Da=1/Math.sqrt(ya*ya+pa*pa);ya*=Da;pa*=Da;xa.x+=ya;xa.y+=pa;ja.x-=ya;ja.y-=pa}var Qa,db,Ia,da,Ua,Va,lb,$a;this.autoClear?this.clear():t.setTransform(1,0,0,-1,n,p);d.data.vertices=0;d.data.faces=0;f=g.projectScene(Fa,Sa,this.sortElements);(J=Fa.lights.length>0)&&La(Fa);Qa=0;for(db=f.length;Qa<db;Qa++){Ia=f[Qa];G.empty();if(Ia instanceof THREE.RenderableParticle){D=Ia;D.x*=n;D.y*=p;da=0;for(Ua=Ia.materials.length;da<
Ua;){$a=Ia.materials[da++];$a.opacity!=0&&Ma(D,Ia,$a,Fa)}}else if(Ia instanceof THREE.RenderableLine){D=Ia.v1;C=Ia.v2;D.positionScreen.x*=n;D.positionScreen.y*=p;C.positionScreen.x*=n;C.positionScreen.y*=p;G.addPoint(D.positionScreen.x,D.positionScreen.y);G.addPoint(C.positionScreen.x,C.positionScreen.y);if(M.instersects(G)){da=0;for(Ua=Ia.materials.length;da<Ua;){$a=Ia.materials[da++];$a.opacity!=0&&Xa(D,C,Ia,$a,Fa)}}}else if(Ia instanceof THREE.RenderableFace3){D=Ia.v1;C=Ia.v2;K=Ia.v3;D.positionScreen.x*=
n;D.positionScreen.y*=p;C.positionScreen.x*=n;C.positionScreen.y*=p;K.positionScreen.x*=n;K.positionScreen.y*=p;if(Ia.overdraw){bb(D.positionScreen,C.positionScreen);bb(C.positionScreen,K.positionScreen);bb(K.positionScreen,D.positionScreen)}G.add3Points(D.positionScreen.x,D.positionScreen.y,C.positionScreen.x,C.positionScreen.y,K.positionScreen.x,K.positionScreen.y);if(M.instersects(G)){da=0;for(Ua=Ia.meshMaterials.length;da<Ua;){$a=Ia.meshMaterials[da++];if($a instanceof THREE.MeshFaceMaterial){Va=
0;for(lb=Ia.faceMaterials.length;Va<lb;)($a=Ia.faceMaterials[Va++])&&$a.opacity!=0&&P(D,C,K,0,1,2,Ia,$a,Fa)}else $a.opacity!=0&&P(D,C,K,0,1,2,Ia,$a,Fa)}}}else if(Ia instanceof THREE.RenderableFace4){D=Ia.v1;C=Ia.v2;K=Ia.v3;N=Ia.v4;D.positionScreen.x*=n;D.positionScreen.y*=p;C.positionScreen.x*=n;C.positionScreen.y*=p;K.positionScreen.x*=n;K.positionScreen.y*=p;N.positionScreen.x*=n;N.positionScreen.y*=p;L.positionScreen.copy(C.positionScreen);Q.positionScreen.copy(N.positionScreen);if(Ia.overdraw){bb(D.positionScreen,
C.positionScreen);bb(C.positionScreen,N.positionScreen);bb(N.positionScreen,D.positionScreen);bb(K.positionScreen,L.positionScreen);bb(K.positionScreen,Q.positionScreen)}G.addPoint(D.positionScreen.x,D.positionScreen.y);G.addPoint(C.positionScreen.x,C.positionScreen.y);G.addPoint(K.positionScreen.x,K.positionScreen.y);G.addPoint(N.positionScreen.x,N.positionScreen.y);if(M.instersects(G)){da=0;for(Ua=Ia.meshMaterials.length;da<Ua;){$a=Ia.meshMaterials[da++];if($a instanceof THREE.MeshFaceMaterial){Va=
0;for(lb=Ia.faceMaterials.length;Va<lb;)($a=Ia.faceMaterials[Va++])&&$a.opacity!=0&&ua(D,C,K,N,L,Q,Ia,$a,Fa)}else $a.opacity!=0&&ua(D,C,K,N,L,Q,Ia,$a,Fa)}}}F.addRectangle(G)}t.setTransform(1,0,0,1,0,0)}};
THREE.SVGRenderer=function(){function b(U,ma,qa){var va,fa,ta,za;va=0;for(fa=U.lights.length;va<fa;va++){ta=U.lights[va];if(ta instanceof THREE.DirectionalLight){za=ma.normalWorld.dot(ta.position)*ta.intensity;if(za>0){qa.r+=ta.color.r*za;qa.g+=ta.color.g*za;qa.b+=ta.color.b*za}}else if(ta instanceof THREE.PointLight){Q.sub(ta.position,ma.centroidWorld);Q.normalize();za=ma.normalWorld.dot(Q)*ta.intensity;if(za>0){qa.r+=ta.color.r*za;qa.g+=ta.color.g*za;qa.b+=ta.color.b*za}}}}function e(U,ma,qa,va,
fa,ta){g.data.vertices+=3;g.data.faces++;oa=d(ha++);oa.setAttribute("d","M "+U.positionScreen.x+" "+U.positionScreen.y+" L "+ma.positionScreen.x+" "+ma.positionScreen.y+" L "+qa.positionScreen.x+","+qa.positionScreen.y+"z");if(fa instanceof THREE.MeshBasicMaterial)I.__styleString=fa.color.__styleString;else if(fa instanceof THREE.MeshLambertMaterial)if(B){D.r=C.r;D.g=C.g;D.b=C.b;b(ta,va,D);I.r=fa.color.r*D.r;I.g=fa.color.g*D.g;I.b=fa.color.b*D.b;I.updateStyleString()}else I.__styleString=fa.color.__styleString;
else if(fa instanceof THREE.MeshDepthMaterial){L=1-fa.__2near/(fa.__farPlusNear-va.z*fa.__farMinusNear);I.setRGB(L,L,L)}else fa instanceof THREE.MeshNormalMaterial&&I.setRGB(f(va.normalWorld.x),f(va.normalWorld.y),f(va.normalWorld.z));fa.wireframe?oa.setAttribute("style","fill: none; stroke: "+I.__styleString+"; stroke-width: "+fa.wireframeLinewidth+"; stroke-opacity: "+fa.opacity+"; stroke-linecap: "+fa.wireframeLinecap+"; stroke-linejoin: "+fa.wireframeLinejoin):oa.setAttribute("style","fill: "+
I.__styleString+"; fill-opacity: "+fa.opacity);m.appendChild(oa)}function c(U,ma,qa,va,fa,ta,za){g.data.vertices+=4;g.data.faces++;oa=d(ha++);oa.setAttribute("d","M "+U.positionScreen.x+" "+U.positionScreen.y+" L "+ma.positionScreen.x+" "+ma.positionScreen.y+" L "+qa.positionScreen.x+","+qa.positionScreen.y+" L "+va.positionScreen.x+","+va.positionScreen.y+"z");if(ta instanceof THREE.MeshBasicMaterial)I.__styleString=ta.color.__styleString;else if(ta instanceof THREE.MeshLambertMaterial)if(B){D.r=
C.r;D.g=C.g;D.b=C.b;b(za,fa,D);I.r=ta.color.r*D.r;I.g=ta.color.g*D.g;I.b=ta.color.b*D.b;I.updateStyleString()}else I.__styleString=ta.color.__styleString;else if(ta instanceof THREE.MeshDepthMaterial){L=1-ta.__2near/(ta.__farPlusNear-fa.z*ta.__farMinusNear);I.setRGB(L,L,L)}else ta instanceof THREE.MeshNormalMaterial&&I.setRGB(f(fa.normalWorld.x),f(fa.normalWorld.y),f(fa.normalWorld.z));ta.wireframe?oa.setAttribute("style","fill: none; stroke: "+I.__styleString+"; stroke-width: "+ta.wireframeLinewidth+
"; stroke-opacity: "+ta.opacity+"; stroke-linecap: "+ta.wireframeLinecap+"; stroke-linejoin: "+ta.wireframeLinejoin):oa.setAttribute("style","fill: "+I.__styleString+"; fill-opacity: "+ta.opacity);m.appendChild(oa)}function d(U){if(ea[U]==null){ea[U]=document.createElementNS("http://www.w3.org/2000/svg","path");ka==0&&ea[U].setAttribute("shape-rendering","crispEdges")}return ea[U]}function f(U){return U<0?Math.min((1+U)*0.5,0.5):0.5+Math.min(U*0.5,0.5)}var g=this,j=null,h=new THREE.Projector,m=document.createElementNS("http://www.w3.org/2000/svg",
"svg"),n,p,t,v,u,w,z,y,A=new THREE.Rectangle,E=new THREE.Rectangle,B=!1,I=new THREE.Color(16777215),D=new THREE.Color(16777215),C=new THREE.Color(0),K=new THREE.Color(0),N=new THREE.Color(0),L,Q=new THREE.Vector3,ea=[],o=[],oa,ha,sa,ka=1;this.domElement=m;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,faces:0};this.setQuality=function(U){switch(U){case "high":ka=1;break;case "low":ka=0}};this.setSize=function(U,ma){n=U;p=ma;t=n/2;v=p/2;m.setAttribute("viewBox",-t+
" "+-v+" "+n+" "+p);m.setAttribute("width",n);m.setAttribute("height",p);A.set(-t,-v,t,v)};this.clear=function(){for(;m.childNodes.length>0;)m.removeChild(m.childNodes[0])};this.render=function(U,ma){var qa,va,fa,ta,za,ca,$,ia;this.autoClear&&this.clear();g.data.vertices=0;g.data.faces=0;j=h.projectScene(U,ma,this.sortElements);sa=ha=0;if(B=U.lights.length>0){$=U.lights;C.setRGB(0,0,0);K.setRGB(0,0,0);N.setRGB(0,0,0);qa=0;for(va=$.length;qa<va;qa++){fa=$[qa];ta=fa.color;if(fa instanceof THREE.AmbientLight){C.r+=
ta.r;C.g+=ta.g;C.b+=ta.b}else if(fa instanceof THREE.DirectionalLight){K.r+=ta.r;K.g+=ta.g;K.b+=ta.b}else if(fa instanceof THREE.PointLight){N.r+=ta.r;N.g+=ta.g;N.b+=ta.b}}}qa=0;for(va=j.length;qa<va;qa++){$=j[qa];E.empty();if($ instanceof THREE.RenderableParticle){u=$;u.x*=t;u.y*=-v;fa=0;for(ta=$.materials.length;fa<ta;)fa++}else if($ instanceof THREE.RenderableLine){u=$.v1;w=$.v2;u.positionScreen.x*=t;u.positionScreen.y*=-v;w.positionScreen.x*=t;w.positionScreen.y*=-v;E.addPoint(u.positionScreen.x,
u.positionScreen.y);E.addPoint(w.positionScreen.x,w.positionScreen.y);if(A.instersects(E)){fa=0;for(ta=$.materials.length;fa<ta;)if((ia=$.materials[fa++])&&ia.opacity!=0){za=u;ca=w;var Aa=sa++;if(o[Aa]==null){o[Aa]=document.createElementNS("http://www.w3.org/2000/svg","line");ka==0&&o[Aa].setAttribute("shape-rendering","crispEdges")}oa=o[Aa];oa.setAttribute("x1",za.positionScreen.x);oa.setAttribute("y1",za.positionScreen.y);oa.setAttribute("x2",ca.positionScreen.x);oa.setAttribute("y2",ca.positionScreen.y);
if(ia instanceof THREE.LineBasicMaterial){I.__styleString=ia.color.__styleString;oa.setAttribute("style","fill: none; stroke: "+I.__styleString+"; stroke-width: "+ia.linewidth+"; stroke-opacity: "+ia.opacity+"; stroke-linecap: "+ia.linecap+"; stroke-linejoin: "+ia.linejoin);m.appendChild(oa)}}}}else if($ instanceof THREE.RenderableFace3){u=$.v1;w=$.v2;z=$.v3;u.positionScreen.x*=t;u.positionScreen.y*=-v;w.positionScreen.x*=t;w.positionScreen.y*=-v;z.positionScreen.x*=t;z.positionScreen.y*=-v;E.addPoint(u.positionScreen.x,
u.positionScreen.y);E.addPoint(w.positionScreen.x,w.positionScreen.y);E.addPoint(z.positionScreen.x,z.positionScreen.y);if(A.instersects(E)){fa=0;for(ta=$.meshMaterials.length;fa<ta;){ia=$.meshMaterials[fa++];if(ia instanceof THREE.MeshFaceMaterial){za=0;for(ca=$.faceMaterials.length;za<ca;)(ia=$.faceMaterials[za++])&&ia.opacity!=0&&e(u,w,z,$,ia,U)}else ia&&ia.opacity!=0&&e(u,w,z,$,ia,U)}}}else if($ instanceof THREE.RenderableFace4){u=$.v1;w=$.v2;z=$.v3;y=$.v4;u.positionScreen.x*=t;u.positionScreen.y*=
-v;w.positionScreen.x*=t;w.positionScreen.y*=-v;z.positionScreen.x*=t;z.positionScreen.y*=-v;y.positionScreen.x*=t;y.positionScreen.y*=-v;E.addPoint(u.positionScreen.x,u.positionScreen.y);E.addPoint(w.positionScreen.x,w.positionScreen.y);E.addPoint(z.positionScreen.x,z.positionScreen.y);E.addPoint(y.positionScreen.x,y.positionScreen.y);if(A.instersects(E)){fa=0;for(ta=$.meshMaterials.length;fa<ta;){ia=$.meshMaterials[fa++];if(ia instanceof THREE.MeshFaceMaterial){za=0;for(ca=$.faceMaterials.length;za<
ca;)(ia=$.faceMaterials[za++])&&ia.opacity!=0&&c(u,w,z,y,$,ia,U)}else ia&&ia.opacity!=0&&c(u,w,z,y,$,ia,U)}}}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",
envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",
map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var e,c,d,f={};for(e=0;e<b.length;e++){d=this.clone(b[e]);for(c in d)f[c]=d[c]}return f},clone:function(b){var e,c,d,f={};for(e in b){f[e]={};for(c in b[e]){d=b[e][c];f[e][c]=d instanceof THREE.Color||d instanceof THREE.Vector3||d instanceof THREE.Texture?d.clone():d}}return f}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function e(x,M,F){var G,J,T,S=x.vertices,R=S.length,Y=x.colors,O=Y.length,W=x.__vertexArray,X=x.__colorArray,na=x.__sortArray,ga=x.__dirtyVertices,Ha=x.__dirtyColors;if(F.sortParticles){Aa.multiplySelf(F.matrixWorld);for(G=0;G<R;G++){J=S[G].position;Ea.copy(J);Aa.multiplyVector3(Ea);na[G]=[Ea.z,G]}na.sort(function(Oa,Ja){return Ja[0]-Oa[0]});for(G=0;G<R;G++){J=S[na[G][1]].position;T=G*3;W[T]=J.x;W[T+1]=J.y;W[T+2]=J.z}for(G=0;G<O;G++){T=G*3;color=Y[na[G][1]];X[T]=color.r;
X[T+1]=color.g;X[T+2]=color.b}}else{if(ga)for(G=0;G<R;G++){J=S[G].position;T=G*3;W[T]=J.x;W[T+1]=J.y;W[T+2]=J.z}if(Ha)for(G=0;G<O;G++){color=Y[G];T=G*3;X[T]=color.r;X[T+1]=color.g;X[T+2]=color.b}}if(ga||F.sortParticles){o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,W,M)}if(Ha||F.sortParticles){o.bindBuffer(o.ARRAY_BUFFER,x.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,X,M)}}function c(x,M,F,G,J){G.program||ea.initMaterial(G,M,F,J);var T=G.program,S=T.uniforms,R=
G.uniforms;if(T!=sa){o.useProgram(T);sa=T}o.uniformMatrix4fv(S.projectionMatrix,!1,Ka);if(F&&(G instanceof THREE.MeshBasicMaterial||G instanceof THREE.MeshLambertMaterial||G instanceof THREE.MeshPhongMaterial||G instanceof THREE.LineBasicMaterial||G instanceof THREE.ParticleBasicMaterial||G.fog)){R.fogColor.value=F.color;if(F instanceof THREE.Fog){R.fogNear.value=F.near;R.fogFar.value=F.far}else if(F instanceof THREE.FogExp2)R.fogDensity.value=F.density}if(G instanceof THREE.MeshPhongMaterial||G instanceof
THREE.MeshLambertMaterial||G.lights){var Y,O,W=0,X=0,na=0,ga,Ha,Oa,Ja,Fa=V,Sa=Fa.directional.colors,La=Fa.directional.positions,Ga=Fa.point.colors,Ma=Fa.point.positions,Xa=Fa.point.distances,P=0,ua=0;F=0;for(Y=M.length;F<Y;F++){O=M[F];ga=O.color;Ha=O.position;Oa=O.intensity;Ja=O.distance;if(O instanceof THREE.AmbientLight){W+=ga.r;X+=ga.g;na+=ga.b}else if(O instanceof THREE.DirectionalLight){Ja=P*3;Sa[Ja]=ga.r*Oa;Sa[Ja+1]=ga.g*Oa;Sa[Ja+2]=ga.b*Oa;La[Ja]=Ha.x;La[Ja+1]=Ha.y;La[Ja+2]=Ha.z;P+=1}else if(O instanceof
THREE.PointLight){O=ua*3;Ga[O]=ga.r*Oa;Ga[O+1]=ga.g*Oa;Ga[O+2]=ga.b*Oa;Ma[O]=Ha.x;Ma[O+1]=Ha.y;Ma[O+2]=Ha.z;Xa[ua]=Ja;ua+=1}}for(F=P*3;F<Sa.length;F++)Sa[F]=0;for(F=ua*3;F<Ga.length;F++)Ga[F]=0;Fa.point.length=ua;Fa.directional.length=P;Fa.ambient[0]=W;Fa.ambient[1]=X;Fa.ambient[2]=na;F=V;R.enableLighting.value=F.directional.length+F.point.length;R.ambientLightColor.value=F.ambient;R.directionalLightColor.value=F.directional.colors;R.directionalLightDirection.value=F.directional.positions;R.pointLightColor.value=
F.point.colors;R.pointLightPosition.value=F.point.positions;R.pointLightDistance.value=F.point.distances}if(G instanceof THREE.MeshBasicMaterial||G instanceof THREE.MeshLambertMaterial||G instanceof THREE.MeshPhongMaterial){R.diffuse.value=G.color;R.opacity.value=G.opacity;R.map.texture=G.map;R.lightMap.texture=G.lightMap;R.envMap.texture=G.envMap;R.reflectivity.value=G.reflectivity;R.refractionRatio.value=G.refractionRatio;R.combine.value=G.combine;R.useRefract.value=G.envMap&&G.envMap.mapping instanceof
THREE.CubeRefractionMapping}if(G instanceof THREE.LineBasicMaterial){R.diffuse.value=G.color;R.opacity.value=G.opacity}else if(G instanceof THREE.ParticleBasicMaterial){R.psColor.value=G.color;R.opacity.value=G.opacity;R.size.value=G.size;R.scale.value=oa.height/2;R.map.texture=G.map}else if(G instanceof THREE.MeshPhongMaterial){R.ambient.value=G.ambient;R.specular.value=G.specular;R.shininess.value=G.shininess}else if(G instanceof THREE.MeshDepthMaterial){R.mNear.value=x.near;R.mFar.value=x.far;
R.opacity.value=G.opacity}else if(G instanceof THREE.MeshNormalMaterial)R.opacity.value=G.opacity;for(var H in R)if(X=T.uniforms[H]){Y=R[H];W=Y.type;F=Y.value;if(W=="i")o.uniform1i(X,F);else if(W=="f")o.uniform1f(X,F);else if(W=="fv1")o.uniform1fv(X,F);else if(W=="fv")o.uniform3fv(X,F);else if(W=="v2")o.uniform2f(X,F.x,F.y);else if(W=="v3")o.uniform3f(X,F.x,F.y,F.z);else if(W=="v4")o.uniform4f(X,F.x,F.y,F.z,F.w);else if(W=="c")o.uniform3f(X,F.r,F.g,F.b);else if(W=="t"){o.uniform1i(X,F);if(Y=Y.texture)if(Y.image instanceof
Array&&Y.image.length==6){if(Y.image.length==6){if(Y.needsUpdate){if(Y.__webglInit){o.bindTexture(o.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube);for(W=0;W<6;++W)o.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,o.RGBA,o.UNSIGNED_BYTE,Y.image[W])}else{Y.image.__webglTextureCube=o.createTexture();o.bindTexture(o.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube);for(W=0;W<6;++W)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Y.image[W]);Y.__webglInit=!0}D(o.TEXTURE_CUBE_MAP,
Y,Y.image[0]);o.bindTexture(o.TEXTURE_CUBE_MAP,null);Y.needsUpdate=!1}o.activeTexture(o.TEXTURE0+F);o.bindTexture(o.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube)}}else C(Y,F)}}o.uniformMatrix4fv(S.modelViewMatrix,!1,J._modelViewMatrixArray);o.uniformMatrix3fv(S.normalMatrix,!1,J._normalMatrixArray);(G instanceof THREE.MeshShaderMaterial||G instanceof THREE.MeshPhongMaterial||G.envMap)&&S.cameraPosition!==null&&o.uniform3f(S.cameraPosition,x.position.x,x.position.y,x.position.z);(G instanceof THREE.MeshShaderMaterial||
G.envMap||G.skinning)&&S.objectMatrix!==null&&o.uniformMatrix4fv(S.objectMatrix,!1,J._objectMatrixArray);(G instanceof THREE.MeshPhongMaterial||G instanceof THREE.MeshLambertMaterial||G instanceof THREE.MeshShaderMaterial||G.skinning)&&S.viewMatrix!==null&&o.uniformMatrix4fv(S.viewMatrix,!1,Ba);if(G instanceof THREE.ShadowVolumeDynamicMaterial){x=R.directionalLightDirection.value;x[0]=-M[1].position.x;x[1]=-M[1].position.y;x[2]=-M[1].position.z;o.uniform3fv(S.directionalLightDirection,x);o.uniformMatrix4fv(S.objectMatrix,
!1,J._objectMatrixArray);o.uniformMatrix4fv(S.viewMatrix,!1,Ba)}if(G.skinning){o.uniformMatrix4fv(S.cameraInverseMatrix,!1,Ba);o.uniformMatrix4fv(S.boneGlobalMatrices,!1,J.boneMatrices)}return T}function d(x,M,F,G,J,T){if(G.opacity!=0){var S;x=c(x,M,F,G,T).attributes;if(!G.morphTargets&&x.position>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglVertexBuffer);o.vertexAttribPointer(x.position,3,o.FLOAT,!1,0,0)}else{M=G.program.attributes;if(T.morphTargetBase!==-1){o.bindBuffer(o.ARRAY_BUFFER,J.__webglMorphTargetsBuffers[T.morphTargetBase]);
o.vertexAttribPointer(M.position,3,o.FLOAT,!1,0,0)}else if(M.position>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglVertexBuffer);o.vertexAttribPointer(M.position,3,o.FLOAT,!1,0,0)}if(T.morphTargetForcedOrder.length){F=0;for(var R=T.morphTargetForcedOrder,Y=T.morphTargetInfluences;F<G.numSupportedMorphTargets&&F<R.length;){o.bindBuffer(o.ARRAY_BUFFER,J.__webglMorphTargetsBuffers[R[F]]);o.vertexAttribPointer(M["morphTarget"+F],3,o.FLOAT,!1,0,0);T.__webglMorphTargetInfluences[F]=Y[R[F]];F++}}else{R=[];var O=
-1,W=0;Y=T.morphTargetInfluences;var X,na=Y.length;F=0;for(T.morphTargetBase!==-1&&(R[T.morphTargetBase]=!0);F<G.numSupportedMorphTargets;){for(X=0;X<na;X++)if(!R[X]&&Y[X]>O){W=X;O=Y[W]}o.bindBuffer(o.ARRAY_BUFFER,J.__webglMorphTargetsBuffers[W]);o.vertexAttribPointer(M["morphTarget"+F],3,o.FLOAT,!1,0,0);T.__webglMorphTargetInfluences[F]=O;R[W]=1;O=-1;F++}}G.program.uniforms.morphTargetInfluences!==null&&o.uniform1fv(G.program.uniforms.morphTargetInfluences,T.__webglMorphTargetInfluences)}if(G.attributes)for(S in G.attributes)if(x[S]>=
0){M=G.attributes[S];o.bindBuffer(o.ARRAY_BUFFER,M.buffer);o.vertexAttribPointer(x[S],M.size,o.FLOAT,!1,0,0)}if(x.color>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglColorBuffer);o.vertexAttribPointer(x.color,3,o.FLOAT,!1,0,0)}if(x.normal>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglNormalBuffer);o.vertexAttribPointer(x.normal,3,o.FLOAT,!1,0,0)}if(x.tangent>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglTangentBuffer);o.vertexAttribPointer(x.tangent,4,o.FLOAT,!1,0,0)}if(x.uv>=0)if(J.__webglUVBuffer){o.bindBuffer(o.ARRAY_BUFFER,
J.__webglUVBuffer);o.vertexAttribPointer(x.uv,2,o.FLOAT,!1,0,0);o.enableVertexAttribArray(x.uv)}else o.disableVertexAttribArray(x.uv);if(x.uv2>=0)if(J.__webglUV2Buffer){o.bindBuffer(o.ARRAY_BUFFER,J.__webglUV2Buffer);o.vertexAttribPointer(x.uv2,2,o.FLOAT,!1,0,0);o.enableVertexAttribArray(x.uv2)}else o.disableVertexAttribArray(x.uv2);if(G.skinning&&x.skinVertexA>=0&&x.skinVertexB>=0&&x.skinIndex>=0&&x.skinWeight>=0){o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinVertexABuffer);o.vertexAttribPointer(x.skinVertexA,
4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinVertexBBuffer);o.vertexAttribPointer(x.skinVertexB,4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinIndicesBuffer);o.vertexAttribPointer(x.skinIndex,4,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,J.__webglSkinWeightsBuffer);o.vertexAttribPointer(x.skinWeight,4,o.FLOAT,!1,0,0)}if(T instanceof THREE.Mesh){if(G.wireframe){o.lineWidth(G.wireframeLinewidth);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,J.__webglLineBuffer);o.drawElements(o.LINES,
J.__webglLineCount,o.UNSIGNED_SHORT,0)}else{o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,J.__webglFaceBuffer);o.drawElements(o.TRIANGLES,J.__webglFaceCount,o.UNSIGNED_SHORT,0)}ea.data.vertices+=J.__webglFaceCount;ea.data.faces+=J.__webglFaceCount/3;ea.data.drawCalls++}else if(T instanceof THREE.Line){T=T.type==THREE.LineStrip?o.LINE_STRIP:o.LINES;o.lineWidth(G.linewidth);o.drawArrays(T,0,J.__webglLineCount);ea.data.drawCalls++}else if(T instanceof THREE.ParticleSystem){o.drawArrays(o.POINTS,0,J.__webglParticleCount);
ea.data.drawCalls++}else if(T instanceof THREE.Ribbon){o.drawArrays(o.TRIANGLE_STRIP,0,J.__webglVertexCount);ea.data.drawCalls++}}}function f(x,M,F){if(!x.__webglVertexBuffer)x.__webglVertexBuffer=o.createBuffer();if(!x.__webglNormalBuffer)x.__webglNormalBuffer=o.createBuffer();if(x.hasPos){o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,x.positionArray,o.DYNAMIC_DRAW);o.enableVertexAttribArray(M.attributes.position);o.vertexAttribPointer(M.attributes.position,3,o.FLOAT,
!1,0,0)}if(x.hasNormal){o.bindBuffer(o.ARRAY_BUFFER,x.__webglNormalBuffer);if(F==THREE.FlatShading){var G,J,T,S,R,Y,O,W,X,na,ga=x.count*3;for(na=0;na<ga;na+=9){F=x.normalArray;G=F[na];J=F[na+1];T=F[na+2];S=F[na+3];Y=F[na+4];W=F[na+5];R=F[na+6];O=F[na+7];X=F[na+8];G=(G+S+R)/3;J=(J+Y+O)/3;T=(T+W+X)/3;F[na]=G;F[na+1]=J;F[na+2]=T;F[na+3]=G;F[na+4]=J;F[na+5]=T;F[na+6]=G;F[na+7]=J;F[na+8]=T}}o.bufferData(o.ARRAY_BUFFER,x.normalArray,o.DYNAMIC_DRAW);o.enableVertexAttribArray(M.attributes.normal);o.vertexAttribPointer(M.attributes.normal,
3,o.FLOAT,!1,0,0)}o.drawArrays(o.TRIANGLES,0,x.count);x.count=0}function g(x){if(ma!=x.doubleSided){x.doubleSided?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE);ma=x.doubleSided}if(qa!=x.flipSided){x.flipSided?o.frontFace(o.CW):o.frontFace(o.CCW);qa=x.flipSided}}function j(x){if(fa!=x){x?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST);fa=x}}function h(x){ia[0].set(x.n41-x.n11,x.n42-x.n12,x.n43-x.n13,x.n44-x.n14);ia[1].set(x.n41+x.n11,x.n42+x.n12,x.n43+x.n13,x.n44+x.n14);ia[2].set(x.n41+x.n21,x.n42+x.n22,
x.n43+x.n23,x.n44+x.n24);ia[3].set(x.n41-x.n21,x.n42-x.n22,x.n43-x.n23,x.n44-x.n24);ia[4].set(x.n41-x.n31,x.n42-x.n32,x.n43-x.n33,x.n44-x.n34);ia[5].set(x.n41+x.n31,x.n42+x.n32,x.n43+x.n33,x.n44+x.n34);var M;for(x=0;x<6;x++){M=ia[x];M.divideScalar(Math.sqrt(M.x*M.x+M.y*M.y+M.z*M.z))}}function m(x){for(var M=x.matrixWorld,F=-x.geometry.boundingSphere.radius*Math.max(x.scale.x,Math.max(x.scale.y,x.scale.z)),G=0;G<6;G++){x=ia[G].x*M.n14+ia[G].y*M.n24+ia[G].z*M.n34+ia[G].w;if(x<=F)return!1}return!0}function n(x,
M){x.list[x.count]=M;x.count+=1}function p(x){var M,F,G=x.object,J=x.opaque,T=x.transparent;T.count=0;x=J.count=0;for(M=G.materials.length;x<M;x++){F=G.materials[x];F.transparent?n(T,F):n(J,F)}}function t(x){var M,F,G,J,T=x.object,S=x.buffer,R=x.opaque,Y=x.transparent;Y.count=0;x=R.count=0;for(G=T.materials.length;x<G;x++){M=T.materials[x];if(M instanceof THREE.MeshFaceMaterial){M=0;for(F=S.materials.length;M<F;M++)(J=S.materials[M])&&(J.transparent?n(Y,J):n(R,J))}else(J=M)&&(J.transparent?n(Y,J):
n(R,J))}}function v(x,M){return M.z-x.z}function u(x){o.enable(o.POLYGON_OFFSET_FILL);o.polygonOffset(0.1,1);o.enable(o.STENCIL_TEST);o.enable(o.DEPTH_TEST);o.depthMask(!1);o.colorMask(!1,!1,!1,!1);o.stencilFunc(o.ALWAYS,1,255);o.stencilOpSeparate(o.BACK,o.KEEP,o.INCR,o.KEEP);o.stencilOpSeparate(o.FRONT,o.KEEP,o.DECR,o.KEEP);var M,F=x.lights.length,G,J=x.lights,T=[],S,R,Y,O,W,X=x.__webglShadowVolumes.length;for(M=0;M<F;M++){G=x.lights[M];if(G instanceof THREE.DirectionalLight&&G.castShadow){T[0]=
-G.position.x;T[1]=-G.position.y;T[2]=-G.position.z;for(W=0;W<X;W++){G=x.__webglShadowVolumes[W].object;S=x.__webglShadowVolumes[W].buffer;R=G.materials[0];R.program||ea.initMaterial(R,J,undefined,G);R=R.program;Y=R.uniforms;O=R.attributes;if(sa!==R){o.useProgram(R);sa=R;o.uniformMatrix4fv(Y.projectionMatrix,!1,Ka);o.uniformMatrix4fv(Y.viewMatrix,!1,Ba);o.uniform3fv(Y.directionalLightDirection,T)}G.matrixWorld.flattenToArray(G._objectMatrixArray);o.uniformMatrix4fv(Y.objectMatrix,!1,G._objectMatrixArray);
o.bindBuffer(o.ARRAY_BUFFER,S.__webglVertexBuffer);o.vertexAttribPointer(O.position,3,o.FLOAT,!1,0,0);o.bindBuffer(o.ARRAY_BUFFER,S.__webglNormalBuffer);o.vertexAttribPointer(O.normal,3,o.FLOAT,!1,0,0);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,S.__webglFaceBuffer);o.cullFace(o.FRONT);o.drawElements(o.TRIANGLES,S.__webglFaceCount,o.UNSIGNED_SHORT,0);o.cullFace(o.BACK);o.drawElements(o.TRIANGLES,S.__webglFaceCount,o.UNSIGNED_SHORT,0)}}}o.disable(o.POLYGON_OFFSET_FILL);o.colorMask(!0,!0,!0,!0);o.stencilFunc(o.NOTEQUAL,
0,255);o.stencilOp(o.KEEP,o.KEEP,o.KEEP);o.disable(o.DEPTH_TEST);va="";sa=aa.program;o.useProgram(aa.program);o.uniformMatrix4fv(aa.projectionLocation,!1,Ka);o.uniform1f(aa.darknessLocation,aa.darkness);o.bindBuffer(o.ARRAY_BUFFER,aa.vertexBuffer);o.vertexAttribPointer(aa.vertexLocation,3,o.FLOAT,!1,0,0);o.enableVertexAttribArray(aa.vertexLocation);o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA);o.blendEquation(o.FUNC_ADD);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,aa.elementBuffer);o.drawElements(o.TRIANGLES,
6,o.UNSIGNED_SHORT,0);o.disable(o.STENCIL_TEST);o.enable(o.DEPTH_TEST);o.depthMask(U)}function w(x,M){var F,G,J;F=_sprite.attributes;var T=_sprite.uniforms,S=$/ca,R,Y=[],O=ca*0.5,W=$*0.5,X=!0;o.useProgram(_sprite.program);sa=_sprite.program;va="";if(!eb){o.enableVertexAttribArray(_sprite.attributes.position);o.enableVertexAttribArray(_sprite.attributes.uv);eb=!0}o.disable(o.CULL_FACE);o.enable(o.BLEND);o.depthMask(!0);o.bindBuffer(o.ARRAY_BUFFER,_sprite.vertexBuffer);o.vertexAttribPointer(F.position,
2,o.FLOAT,!1,16,0);o.vertexAttribPointer(F.uv,2,o.FLOAT,!1,16,8);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);o.uniformMatrix4fv(T.projectionMatrix,!1,Ka);o.activeTexture(o.TEXTURE0);o.uniform1i(T.map,0);F=0;for(G=x.__webglSprites.length;F<G;F++){J=x.__webglSprites[F];if(J.useScreenCoordinates)J.z=-J.position.z;else{J._modelViewMatrix.multiplyToArray(M.matrixWorldInverse,J.matrixWorld,J._modelViewMatrixArray);J.z=-J._modelViewMatrix.n34}}x.__webglSprites.sort(v);F=0;for(G=x.__webglSprites.length;F<
G;F++){J=x.__webglSprites[F];if(J.material===undefined&&J.map&&J.map.image&&J.map.image.width){if(J.useScreenCoordinates){o.uniform1i(T.useScreenCoordinates,1);o.uniform3f(T.screenPosition,(J.position.x-O)/O,(W-J.position.y)/W,Math.max(0,Math.min(1,J.position.z)))}else{o.uniform1i(T.useScreenCoordinates,0);o.uniform1i(T.affectedByDistance,J.affectedByDistance?1:0);o.uniformMatrix4fv(T.modelViewMatrix,!1,J._modelViewMatrixArray)}R=J.map.image.width/(J.affectedByDistance?1:$);Y[0]=R*S*J.scale.x;Y[1]=
R*J.scale.y;o.uniform2f(T.uvScale,J.uvScale.x,J.uvScale.y);o.uniform2f(T.uvOffset,J.uvOffset.x,J.uvOffset.y);o.uniform2f(T.alignment,J.alignment.x,J.alignment.y);o.uniform1f(T.opacity,J.opacity);o.uniform1f(T.rotation,J.rotation);o.uniform2fv(T.scale,Y);if(J.mergeWith3D&&!X){o.enable(o.DEPTH_TEST);X=!0}else if(!J.mergeWith3D&&X){o.disable(o.DEPTH_TEST);X=!1}I(J.blending);C(J.map,0);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}}o.enable(o.CULL_FACE);o.enable(o.DEPTH_TEST);o.depthMask(U)}function z(x,
M){var F,G,J=x.__webglLensFlares.length,T,S,R,Y=new THREE.Vector3,O=$/ca,W=ca*0.5,X=$*0.5,na=16/$,ga=[na*O,na],Ha=[1,1,0],Oa=[1,1],Ja=Z.uniforms;F=Z.attributes;o.useProgram(Z.program);sa=Z.program;va="";if(!Pa){o.enableVertexAttribArray(Z.attributes.vertex);o.enableVertexAttribArray(Z.attributes.uv);Pa=!0}o.uniform1i(Ja.occlusionMap,0);o.uniform1i(Ja.map,1);o.bindBuffer(o.ARRAY_BUFFER,Z.vertexBuffer);o.vertexAttribPointer(F.vertex,2,o.FLOAT,!1,16,0);o.vertexAttribPointer(F.uv,2,o.FLOAT,!1,16,8);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,
Z.elementBuffer);o.disable(o.CULL_FACE);o.depthMask(!1);o.activeTexture(o.TEXTURE0);o.bindTexture(o.TEXTURE_2D,Z.occlusionTexture);o.activeTexture(o.TEXTURE1);for(G=0;G<J;G++){F=x.__webglLensFlares[G].object;Y.set(F.matrixWorld.n14,F.matrixWorld.n24,F.matrixWorld.n34);M.matrixWorldInverse.multiplyVector3(Y);M.projectionMatrix.multiplyVector3(Y);Ha[0]=Y.x;Ha[1]=Y.y;Ha[2]=Y.z;Oa[0]=Ha[0]*W+W;Oa[1]=Ha[1]*X+X;if(Z.hasVertexTexture||Oa[0]>0&&Oa[0]<ca&&Oa[1]>0&&Oa[1]<$){o.bindTexture(o.TEXTURE_2D,Z.tempTexture);
o.copyTexImage2D(o.TEXTURE_2D,0,o.RGB,Oa[0]-8,Oa[1]-8,16,16,0);o.uniform1i(Ja.renderType,0);o.uniform2fv(Ja.scale,ga);o.uniform3fv(Ja.screenPosition,Ha);o.disable(o.BLEND);o.enable(o.DEPTH_TEST);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0);o.bindTexture(o.TEXTURE_2D,Z.occlusionTexture);o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,Oa[0]-8,Oa[1]-8,16,16,0);o.uniform1i(Ja.renderType,1);o.disable(o.DEPTH_TEST);o.bindTexture(o.TEXTURE_2D,Z.tempTexture);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0);F.positionScreen.x=
Ha[0];F.positionScreen.y=Ha[1];F.positionScreen.z=Ha[2];F.customUpdateCallback?F.customUpdateCallback(F):F.updateLensFlares();o.uniform1i(Ja.renderType,2);o.enable(o.BLEND);T=0;for(S=F.lensFlares.length;T<S;T++){R=F.lensFlares[T];if(R.opacity>0.001&&R.scale>0.001){Ha[0]=R.x;Ha[1]=R.y;Ha[2]=R.z;na=R.size*R.scale/$;ga[0]=na*O;ga[1]=na;o.uniform3fv(Ja.screenPosition,Ha);o.uniform2fv(Ja.scale,ga);o.uniform1f(Ja.rotation,R.rotation);o.uniform1f(Ja.opacity,R.opacity);I(R.blending);C(R.texture,1);o.drawElements(o.TRIANGLES,
6,o.UNSIGNED_SHORT,0)}}}}o.enable(o.CULL_FACE);o.enable(o.DEPTH_TEST);o.depthMask(U)}function y(x,M){x._modelViewMatrix.multiplyToArray(M.matrixWorldInverse,x.matrixWorld,x._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(x._modelViewMatrix).transposeIntoArray(x._normalMatrixArray)}function A(x){var M,F,G,J,T;if(x instanceof THREE.Mesh){F=x.geometry;for(M in F.geometryGroups){G=F.geometryGroups[M];T=!1;for(J in G.__webglCustomAttributes)if(G.__webglCustomAttributes[J].needsUpdate){T=!0;break}if(F.__dirtyVertices||
F.__dirtyMorphTargets||F.__dirtyElements||F.__dirtyUvs||F.__dirtyNormals||F.__dirtyColors||F.__dirtyTangents||T){T=o.DYNAMIC_DRAW;var S=void 0,R=void 0,Y=void 0,O=void 0,W=void 0,X=void 0,na=void 0,ga=void 0,Ha=void 0,Oa=void 0,Ja=void 0,Fa=void 0,Sa=void 0,La=void 0,Ga=void 0,Ma=void 0,Xa=void 0,P=void 0,ua=void 0,H=void 0,cb=void 0,fb=void 0,Ra=0,Ta=0,jb=0,gb=0,ab=0,bb=0,Qa=0,db=0,Ia=0,da=0,Ua=0,Va=G.__vertexArray,lb=G.__uvArray,$a=G.__uv2Array,ja=G.__normalArray,xa=G.__tangentArray,ya=G.__colorArray,
pa=G.__skinVertexAArray,Da=G.__skinVertexBArray,Ca=G.__skinIndexArray,wa=G.__skinWeightArray,la=G.__morphTargetsArrays,Na=G.__webglCustomAttributes,Ya=G.__faceArray,Wa=G.__lineArray,kb=G.__needsSmoothNormals;Oa=G.__vertexColorType;Ha=G.__uvType;Ja=G.__normalType;var Za=x.geometry,hb=Za.__dirtyVertices,ib=Za.__dirtyElements,sb=Za.__dirtyUvs,tb=Za.__dirtyNormals,ub=Za.__dirtyTangents,vb=Za.__dirtyColors,wb=Za.__dirtyMorphTargets,ob=Za.vertices,xb=G.faces,Ab=Za.faces,yb=Za.faceVertexUvs[0],zb=Za.faceVertexUvs[1],
pb=Za.skinVerticesA,qb=Za.skinVerticesB,rb=Za.skinIndices,mb=Za.skinWeights,nb=x instanceof THREE.ShadowVolume?Za.edgeFaces:undefined;morphTargets=Za.morphTargets;if(Na)for(fb in Na){Na[fb].offset=0;Na[fb].offsetSrc=0}S=0;for(R=xb.length;S<R;S++){Y=xb[S];O=Ab[Y];yb&&(Fa=yb[Y]);zb&&(Sa=zb[Y]);Y=O.vertexNormals;W=O.normal;X=O.vertexColors;na=O.color;ga=O.vertexTangents;if(O instanceof THREE.Face3){if(hb){La=ob[O.a].position;Ga=ob[O.b].position;Ma=ob[O.c].position;Va[Ta]=La.x;Va[Ta+1]=La.y;Va[Ta+2]=
La.z;Va[Ta+3]=Ga.x;Va[Ta+4]=Ga.y;Va[Ta+5]=Ga.z;Va[Ta+6]=Ma.x;Va[Ta+7]=Ma.y;Va[Ta+8]=Ma.z;Ta+=9}if(Na)for(fb in Na){H=Na[fb];if(H.needsUpdate){P=H.offset;ua=H.offsetSrc;if(H.size===1){if(H.boundTo===undefined||H.boundTo==="vertices"){H.array[P+0]=H.value[O.a];H.array[P+1]=H.value[O.b];H.array[P+2]=H.value[O.c]}else if(H.boundTo==="faces"){H.array[P+0]=H.value[ua];H.array[P+1]=H.value[ua];H.array[P+2]=H.value[ua];H.offsetSrc++}else if(H.boundTo==="faceVertices"){H.array[P+0]=H.value[ua+0];H.array[P+
1]=H.value[ua+1];H.array[P+2]=H.value[ua+2];H.offsetSrc+=3}H.offset+=3}else{if(H.boundTo===undefined||H.boundTo==="vertices"){La=H.value[O.a];Ga=H.value[O.b];Ma=H.value[O.c]}else if(H.boundTo==="faces"){La=H.value[ua];Ga=H.value[ua];Ma=H.value[ua];H.offsetSrc++}else if(H.boundTo==="faceVertices"){La=H.value[ua+0];Ga=H.value[ua+1];Ma=H.value[ua+2];H.offsetSrc+=3}if(H.size===2){H.array[P+0]=La.x;H.array[P+1]=La.y;H.array[P+2]=Ga.x;H.array[P+3]=Ga.y;H.array[P+4]=Ma.x;H.array[P+5]=Ma.y;H.offset+=6}else if(H.size===
3){if(H.type==="c"){H.array[P+0]=La.r;H.array[P+1]=La.g;H.array[P+2]=La.b;H.array[P+3]=Ga.r;H.array[P+4]=Ga.g;H.array[P+5]=Ga.b;H.array[P+6]=Ma.r;H.array[P+7]=Ma.g;H.array[P+8]=Ma.b}else{H.array[P+0]=La.x;H.array[P+1]=La.y;H.array[P+2]=La.z;H.array[P+3]=Ga.x;H.array[P+4]=Ga.y;H.array[P+5]=Ga.z;H.array[P+6]=Ma.x;H.array[P+7]=Ma.y;H.array[P+8]=Ma.z}H.offset+=9}else{H.array[P+0]=La.x;H.array[P+1]=La.y;H.array[P+2]=La.z;H.array[P+3]=La.w;H.array[P+4]=Ga.x;H.array[P+5]=Ga.y;H.array[P+6]=Ga.z;H.array[P+
7]=Ga.w;H.array[P+8]=Ma.x;H.array[P+9]=Ma.y;H.array[P+10]=Ma.z;H.array[P+11]=Ma.w;H.offset+=12}}}}if(wb){P=0;for(ua=morphTargets.length;P<ua;P++){La=morphTargets[P].vertices[O.a].position;Ga=morphTargets[P].vertices[O.b].position;Ma=morphTargets[P].vertices[O.c].position;H=la[P];H[Ua+0]=La.x;H[Ua+1]=La.y;H[Ua+2]=La.z;H[Ua+3]=Ga.x;H[Ua+4]=Ga.y;H[Ua+5]=Ga.z;H[Ua+6]=Ma.x;H[Ua+7]=Ma.y;H[Ua+8]=Ma.z}Ua+=9}if(mb.length){P=mb[O.a];ua=mb[O.b];H=mb[O.c];wa[da]=P.x;wa[da+1]=P.y;wa[da+2]=P.z;wa[da+3]=P.w;wa[da+
4]=ua.x;wa[da+5]=ua.y;wa[da+6]=ua.z;wa[da+7]=ua.w;wa[da+8]=H.x;wa[da+9]=H.y;wa[da+10]=H.z;wa[da+11]=H.w;P=rb[O.a];ua=rb[O.b];H=rb[O.c];Ca[da]=P.x;Ca[da+1]=P.y;Ca[da+2]=P.z;Ca[da+3]=P.w;Ca[da+4]=ua.x;Ca[da+5]=ua.y;Ca[da+6]=ua.z;Ca[da+7]=ua.w;Ca[da+8]=H.x;Ca[da+9]=H.y;Ca[da+10]=H.z;Ca[da+11]=H.w;P=pb[O.a];ua=pb[O.b];H=pb[O.c];pa[da]=P.x;pa[da+1]=P.y;pa[da+2]=P.z;pa[da+3]=1;pa[da+4]=ua.x;pa[da+5]=ua.y;pa[da+6]=ua.z;pa[da+7]=1;pa[da+8]=H.x;pa[da+9]=H.y;pa[da+10]=H.z;pa[da+11]=1;P=qb[O.a];ua=qb[O.b];H=
qb[O.c];Da[da]=P.x;Da[da+1]=P.y;Da[da+2]=P.z;Da[da+3]=1;Da[da+4]=ua.x;Da[da+5]=ua.y;Da[da+6]=ua.z;Da[da+7]=1;Da[da+8]=H.x;Da[da+9]=H.y;Da[da+10]=H.z;Da[da+11]=1;da+=12}if(vb&&Oa){if(X.length==3&&Oa==THREE.VertexColors){O=X[0];P=X[1];ua=X[2]}else ua=P=O=na;ya[Ia]=O.r;ya[Ia+1]=O.g;ya[Ia+2]=O.b;ya[Ia+3]=P.r;ya[Ia+4]=P.g;ya[Ia+5]=P.b;ya[Ia+6]=ua.r;ya[Ia+7]=ua.g;ya[Ia+8]=ua.b;Ia+=9}if(ub&&Za.hasTangents){X=ga[0];na=ga[1];O=ga[2];xa[Qa]=X.x;xa[Qa+1]=X.y;xa[Qa+2]=X.z;xa[Qa+3]=X.w;xa[Qa+4]=na.x;xa[Qa+5]=
na.y;xa[Qa+6]=na.z;xa[Qa+7]=na.w;xa[Qa+8]=O.x;xa[Qa+9]=O.y;xa[Qa+10]=O.z;xa[Qa+11]=O.w;Qa+=12}if(tb&&Ja)if(Y.length==3&&kb)for(ga=0;ga<3;ga++){W=Y[ga];ja[bb]=W.x;ja[bb+1]=W.y;ja[bb+2]=W.z;bb+=3}else for(ga=0;ga<3;ga++){ja[bb]=W.x;ja[bb+1]=W.y;ja[bb+2]=W.z;bb+=3}if(sb&&Fa!==undefined&&Ha)for(ga=0;ga<3;ga++){Y=Fa[ga];lb[jb]=Y.u;lb[jb+1]=Y.v;jb+=2}if(sb&&Sa!==undefined&&Ha)for(ga=0;ga<3;ga++){Y=Sa[ga];$a[gb]=Y.u;$a[gb+1]=Y.v;gb+=2}if(ib){Ya[ab]=Ra;Ya[ab+1]=Ra+1;Ya[ab+2]=Ra+2;ab+=3;Wa[db]=Ra;Wa[db+1]=
Ra+1;Wa[db+2]=Ra;Wa[db+3]=Ra+2;Wa[db+4]=Ra+1;Wa[db+5]=Ra+2;db+=6;Ra+=3}}else if(O instanceof THREE.Face4){if(hb){La=ob[O.a].position;Ga=ob[O.b].position;Ma=ob[O.c].position;Xa=ob[O.d].position;Va[Ta]=La.x;Va[Ta+1]=La.y;Va[Ta+2]=La.z;Va[Ta+3]=Ga.x;Va[Ta+4]=Ga.y;Va[Ta+5]=Ga.z;Va[Ta+6]=Ma.x;Va[Ta+7]=Ma.y;Va[Ta+8]=Ma.z;Va[Ta+9]=Xa.x;Va[Ta+10]=Xa.y;Va[Ta+11]=Xa.z;Ta+=12}if(Na)for(fb in Na){H=Na[fb];if(H.needsUpdate){P=H.offset;ua=H.offsetSrc;if(H.size===1){if(H.boundTo===undefined||H.boundTo==="vertices"){H.array[P+
0]=H.value[O.a];H.array[P+1]=H.value[O.b];H.array[P+2]=H.value[O.c];H.array[P+3]=H.value[O.d]}else if(H.boundTo==="faces"){H.array[P+0]=H.value[ua];H.array[P+1]=H.value[ua];H.array[P+2]=H.value[ua];H.array[P+3]=H.value[ua];H.offsetSrc++}else if(H.boundTo==="faceVertices"){H.array[P+0]=H.value[ua+0];H.array[P+1]=H.value[ua+1];H.array[P+2]=H.value[ua+2];H.array[P+3]=H.value[ua+3];H.offsetSrc+=4}H.offset+=4}else{if(H.boundTo===undefined||H.boundTo==="vertices"){La=H.value[O.a];Ga=H.value[O.b];Ma=H.value[O.c];
Xa=H.value[O.d]}else if(H.boundTo==="faces"){La=H.value[ua];Ga=H.value[ua];Ma=H.value[ua];Xa=H.value[ua];H.offsetSrc++}else if(H.boundTo==="faceVertices"){La=H.value[ua+0];Ga=H.value[ua+1];Ma=H.value[ua+2];Xa=H.value[ua+3];H.offsetSrc+=4}if(H.size===2){H.array[P+0]=La.x;H.array[P+1]=La.y;H.array[P+2]=Ga.x;H.array[P+3]=Ga.y;H.array[P+4]=Ma.x;H.array[P+5]=Ma.y;H.array[P+6]=Xa.x;H.array[P+7]=Xa.y;H.offset+=8}else if(H.size===3){if(H.type==="c"){H.array[P+0]=La.r;H.array[P+1]=La.g;H.array[P+2]=La.b;H.array[P+
3]=Ga.r;H.array[P+4]=Ga.g;H.array[P+5]=Ga.b;H.array[P+6]=Ma.r;H.array[P+7]=Ma.g;H.array[P+8]=Ma.b;H.array[P+9]=Xa.r;H.array[P+10]=Xa.g;H.array[P+11]=Xa.b}else{H.array[P+0]=La.x;H.array[P+1]=La.y;H.array[P+2]=La.z;H.array[P+3]=Ga.x;H.array[P+4]=Ga.y;H.array[P+5]=Ga.z;H.array[P+6]=Ma.x;H.array[P+7]=Ma.y;H.array[P+8]=Ma.z;H.array[P+9]=Xa.x;H.array[P+10]=Xa.y;H.array[P+11]=Xa.z}H.offset+=12}else{H.array[P+0]=La.x;H.array[P+1]=La.y;H.array[P+2]=La.z;H.array[P+3]=La.w;H.array[P+4]=Ga.x;H.array[P+5]=Ga.y;
H.array[P+6]=Ga.z;H.array[P+7]=Ga.w;H.array[P+8]=Ma.x;H.array[P+9]=Ma.y;H.array[P+10]=Ma.z;H.array[P+11]=Ma.w;H.array[P+12]=Xa.x;H.array[P+13]=Xa.y;H.array[P+14]=Xa.z;H.array[P+15]=Xa.w;H.offset+=16}}}}if(wb){P=0;for(ua=morphTargets.length;P<ua;P++){La=morphTargets[P].vertices[O.a].position;Ga=morphTargets[P].vertices[O.b].position;Ma=morphTargets[P].vertices[O.c].position;Xa=morphTargets[P].vertices[O.d].position;H=la[P];H[Ua+0]=La.x;H[Ua+1]=La.y;H[Ua+2]=La.z;H[Ua+3]=Ga.x;H[Ua+4]=Ga.y;H[Ua+5]=Ga.z;
H[Ua+6]=Ma.x;H[Ua+7]=Ma.y;H[Ua+8]=Ma.z;H[Ua+9]=Xa.x;H[Ua+10]=Xa.y;H[Ua+11]=Xa.z}Ua+=12}if(mb.length){P=mb[O.a];ua=mb[O.b];H=mb[O.c];cb=mb[O.d];wa[da]=P.x;wa[da+1]=P.y;wa[da+2]=P.z;wa[da+3]=P.w;wa[da+4]=ua.x;wa[da+5]=ua.y;wa[da+6]=ua.z;wa[da+7]=ua.w;wa[da+8]=H.x;wa[da+9]=H.y;wa[da+10]=H.z;wa[da+11]=H.w;wa[da+12]=cb.x;wa[da+13]=cb.y;wa[da+14]=cb.z;wa[da+15]=cb.w;P=rb[O.a];ua=rb[O.b];H=rb[O.c];cb=rb[O.d];Ca[da]=P.x;Ca[da+1]=P.y;Ca[da+2]=P.z;Ca[da+3]=P.w;Ca[da+4]=ua.x;Ca[da+5]=ua.y;Ca[da+6]=ua.z;Ca[da+
7]=ua.w;Ca[da+8]=H.x;Ca[da+9]=H.y;Ca[da+10]=H.z;Ca[da+11]=H.w;Ca[da+12]=cb.x;Ca[da+13]=cb.y;Ca[da+14]=cb.z;Ca[da+15]=cb.w;P=pb[O.a];ua=pb[O.b];H=pb[O.c];cb=pb[O.d];pa[da]=P.x;pa[da+1]=P.y;pa[da+2]=P.z;pa[da+3]=1;pa[da+4]=ua.x;pa[da+5]=ua.y;pa[da+6]=ua.z;pa[da+7]=1;pa[da+8]=H.x;pa[da+9]=H.y;pa[da+10]=H.z;pa[da+11]=1;pa[da+12]=cb.x;pa[da+13]=cb.y;pa[da+14]=cb.z;pa[da+15]=1;P=qb[O.a];ua=qb[O.b];H=qb[O.c];O=qb[O.d];Da[da]=P.x;Da[da+1]=P.y;Da[da+2]=P.z;Da[da+3]=1;Da[da+4]=ua.x;Da[da+5]=ua.y;Da[da+6]=ua.z;
Da[da+7]=1;Da[da+8]=H.x;Da[da+9]=H.y;Da[da+10]=H.z;Da[da+11]=1;Da[da+12]=O.x;Da[da+13]=O.y;Da[da+14]=O.z;Da[da+15]=1;da+=16}if(vb&&Oa){if(X.length==4&&Oa==THREE.VertexColors){O=X[0];P=X[1];ua=X[2];X=X[3]}else X=ua=P=O=na;ya[Ia]=O.r;ya[Ia+1]=O.g;ya[Ia+2]=O.b;ya[Ia+3]=P.r;ya[Ia+4]=P.g;ya[Ia+5]=P.b;ya[Ia+6]=ua.r;ya[Ia+7]=ua.g;ya[Ia+8]=ua.b;ya[Ia+9]=X.r;ya[Ia+10]=X.g;ya[Ia+11]=X.b;Ia+=12}if(ub&&Za.hasTangents){X=ga[0];na=ga[1];O=ga[2];ga=ga[3];xa[Qa]=X.x;xa[Qa+1]=X.y;xa[Qa+2]=X.z;xa[Qa+3]=X.w;xa[Qa+4]=
na.x;xa[Qa+5]=na.y;xa[Qa+6]=na.z;xa[Qa+7]=na.w;xa[Qa+8]=O.x;xa[Qa+9]=O.y;xa[Qa+10]=O.z;xa[Qa+11]=O.w;xa[Qa+12]=ga.x;xa[Qa+13]=ga.y;xa[Qa+14]=ga.z;xa[Qa+15]=ga.w;Qa+=16}if(tb&&Ja)if(Y.length==4&&kb)for(ga=0;ga<4;ga++){W=Y[ga];ja[bb]=W.x;ja[bb+1]=W.y;ja[bb+2]=W.z;bb+=3}else for(ga=0;ga<4;ga++){ja[bb]=W.x;ja[bb+1]=W.y;ja[bb+2]=W.z;bb+=3}if(sb&&Fa!==undefined&&Ha)for(ga=0;ga<4;ga++){Y=Fa[ga];lb[jb]=Y.u;lb[jb+1]=Y.v;jb+=2}if(sb&&Sa!==undefined&&Ha)for(ga=0;ga<4;ga++){Y=Sa[ga];$a[gb]=Y.u;$a[gb+1]=Y.v;gb+=
2}if(ib){Ya[ab]=Ra;Ya[ab+1]=Ra+1;Ya[ab+2]=Ra+3;Ya[ab+3]=Ra+1;Ya[ab+4]=Ra+2;Ya[ab+5]=Ra+3;ab+=6;Wa[db]=Ra;Wa[db+1]=Ra+1;Wa[db+2]=Ra;Wa[db+3]=Ra+3;Wa[db+4]=Ra+1;Wa[db+5]=Ra+2;Wa[db+6]=Ra+2;Wa[db+7]=Ra+3;db+=8;Ra+=4}}}if(nb){S=0;for(R=nb.length;S<R;S++){Ya[ab]=nb[S].a;Ya[ab+1]=nb[S].b;Ya[ab+2]=nb[S].c;Ya[ab+3]=nb[S].a;Ya[ab+4]=nb[S].c;Ya[ab+5]=nb[S].d;ab+=6}}if(hb){o.bindBuffer(o.ARRAY_BUFFER,G.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,Va,T)}if(Na)for(fb in Na){H=Na[fb];if(H.needsUpdate){o.bindBuffer(o.ARRAY_BUFFER,
H.buffer);o.bufferData(o.ARRAY_BUFFER,H.array,T);H.needsUpdate=!1}}if(wb){P=0;for(ua=morphTargets.length;P<ua;P++){o.bindBuffer(o.ARRAY_BUFFER,G.__webglMorphTargetsBuffers[P]);o.bufferData(o.ARRAY_BUFFER,la[P],T)}}if(vb&&Ia>0){o.bindBuffer(o.ARRAY_BUFFER,G.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,ya,T)}if(tb){o.bindBuffer(o.ARRAY_BUFFER,G.__webglNormalBuffer);o.bufferData(o.ARRAY_BUFFER,ja,T)}if(ub&&Za.hasTangents){o.bindBuffer(o.ARRAY_BUFFER,G.__webglTangentBuffer);o.bufferData(o.ARRAY_BUFFER,
xa,T)}if(sb&&jb>0){o.bindBuffer(o.ARRAY_BUFFER,G.__webglUVBuffer);o.bufferData(o.ARRAY_BUFFER,lb,T)}if(sb&&gb>0){o.bindBuffer(o.ARRAY_BUFFER,G.__webglUV2Buffer);o.bufferData(o.ARRAY_BUFFER,$a,T)}if(ib){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,G.__webglFaceBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,Ya,T);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,G.__webglLineBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,Wa,T)}if(da>0){o.bindBuffer(o.ARRAY_BUFFER,G.__webglSkinVertexABuffer);o.bufferData(o.ARRAY_BUFFER,pa,T);o.bindBuffer(o.ARRAY_BUFFER,
G.__webglSkinVertexBBuffer);o.bufferData(o.ARRAY_BUFFER,Da,T);o.bindBuffer(o.ARRAY_BUFFER,G.__webglSkinIndicesBuffer);o.bufferData(o.ARRAY_BUFFER,Ca,T);o.bindBuffer(o.ARRAY_BUFFER,G.__webglSkinWeightsBuffer);o.bufferData(o.ARRAY_BUFFER,wa,T)}}}F.__dirtyVertices=!1;F.__dirtyMorphTargets=!1;F.__dirtyElements=!1;F.__dirtyUvs=!1;F.__dirtyNormals=!1;F.__dirtyTangents=!1;F.__dirtyColors=!1}else if(x instanceof THREE.Ribbon){F=x.geometry;if(F.__dirtyVertices||F.__dirtyColors){x=F;M=o.DYNAMIC_DRAW;Oa=x.vertices;
G=x.colors;Ja=Oa.length;T=G.length;Fa=x.__vertexArray;S=x.__colorArray;Sa=x.__dirtyColors;if(x.__dirtyVertices){for(R=0;R<Ja;R++){Ha=Oa[R].position;J=R*3;Fa[J]=Ha.x;Fa[J+1]=Ha.y;Fa[J+2]=Ha.z}o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,Fa,M)}if(Sa){for(R=0;R<T;R++){color=G[R];J=R*3;S[J]=color.r;S[J+1]=color.g;S[J+2]=color.b}o.bindBuffer(o.ARRAY_BUFFER,x.__webglColorBuffer);o.bufferData(o.ARRAY_BUFFER,S,M)}}F.__dirtyVertices=!1;F.__dirtyColors=!1}else if(x instanceof
THREE.Line){F=x.geometry;if(F.__dirtyVertices||F.__dirtyColors){x=F;M=o.DYNAMIC_DRAW;Oa=x.vertices;G=x.colors;Ja=Oa.length;T=G.length;Fa=x.__vertexArray;S=x.__colorArray;Sa=x.__dirtyColors;if(x.__dirtyVertices){for(R=0;R<Ja;R++){Ha=Oa[R].position;J=R*3;Fa[J]=Ha.x;Fa[J+1]=Ha.y;Fa[J+2]=Ha.z}o.bindBuffer(o.ARRAY_BUFFER,x.__webglVertexBuffer);o.bufferData(o.ARRAY_BUFFER,Fa,M)}if(Sa){for(R=0;R<T;R++){color=G[R];J=R*3;S[J]=color.r;S[J+1]=color.g;S[J+2]=color.b}o.bindBuffer(o.ARRAY_BUFFER,x.__webglColorBuffer);
o.bufferData(o.ARRAY_BUFFER,S,M)}}F.__dirtyVertices=!1;F.__dirtyColors=!1}else if(x instanceof THREE.ParticleSystem){F=x.geometry;(F.__dirtyVertices||F.__dirtyColors||x.sortParticles)&&e(F,o.DYNAMIC_DRAW,x);F.__dirtyVertices=!1;F.__dirtyColors=!1}}function E(x){function M(na){var ga=[];F=0;for(G=na.length;F<G;F++)na[F]==undefined?ga.push("undefined"):ga.push(na[F].id);return ga.join("_")}var F,G,J,T,S,R,Y,O,W={},X=x.morphTargets!==undefined?x.morphTargets.length:0;x.geometryGroups={};J=0;for(T=x.faces.length;J<
T;J++){S=x.faces[J];R=S.materials;Y=M(R);W[Y]==undefined&&(W[Y]={hash:Y,counter:0});O=W[Y].hash+"_"+W[Y].counter;x.geometryGroups[O]==undefined&&(x.geometryGroups[O]={faces:[],materials:R,vertices:0,numMorphTargets:X});S=S instanceof THREE.Face3?3:4;if(x.geometryGroups[O].vertices+S>65535){W[Y].counter+=1;O=W[Y].hash+"_"+W[Y].counter;x.geometryGroups[O]==undefined&&(x.geometryGroups[O]={faces:[],materials:R,vertices:0,numMorphTargets:X})}x.geometryGroups[O].faces.push(J);x.geometryGroups[O].vertices+=
S}}function B(x,M,F){x.push({buffer:M,object:F,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function I(x){if(x!=va){switch(x){case THREE.AdditiveBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.SRC_ALPHA,o.ONE);break;case THREE.SubtractiveBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.ZERO,o.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:o.blendEquation(o.FUNC_ADD);o.blendFunc(o.ZERO,o.SRC_COLOR);break;default:o.blendEquationSeparate(o.FUNC_ADD,o.FUNC_ADD);o.blendFuncSeparate(o.SRC_ALPHA,
o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)}va=x}}function D(x,M,F){if((F.width&F.width-1)==0&&(F.height&F.height-1)==0){o.texParameteri(x,o.TEXTURE_WRAP_S,Q(M.wrapS));o.texParameteri(x,o.TEXTURE_WRAP_T,Q(M.wrapT));o.texParameteri(x,o.TEXTURE_MAG_FILTER,Q(M.magFilter));o.texParameteri(x,o.TEXTURE_MIN_FILTER,Q(M.minFilter));o.generateMipmap(x)}else{o.texParameteri(x,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(x,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);o.texParameteri(x,o.TEXTURE_MAG_FILTER,L(M.magFilter));
o.texParameteri(x,o.TEXTURE_MIN_FILTER,L(M.minFilter))}}function C(x,M){if(x.needsUpdate){if(x.__webglInit){o.bindTexture(o.TEXTURE_2D,x.__webglTexture);o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,x.image)}else{x.__webglTexture=o.createTexture();o.bindTexture(o.TEXTURE_2D,x.__webglTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,x.image);x.__webglInit=!0}D(o.TEXTURE_2D,x,x.image);o.bindTexture(o.TEXTURE_2D,null);x.needsUpdate=!1}o.activeTexture(o.TEXTURE0+M);o.bindTexture(o.TEXTURE_2D,
x.__webglTexture)}function K(x){if(x&&!x.__webglFramebuffer){if(x.depthBuffer===undefined)x.depthBuffer=!0;if(x.stencilBuffer===undefined)x.stencilBuffer=!0;x.__webglFramebuffer=o.createFramebuffer();x.__webglRenderbuffer=o.createRenderbuffer();x.__webglTexture=o.createTexture();o.bindTexture(o.TEXTURE_2D,x.__webglTexture);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,Q(x.wrapS));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,Q(x.wrapT));o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,Q(x.magFilter));
o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,Q(x.minFilter));o.texImage2D(o.TEXTURE_2D,0,Q(x.format),x.width,x.height,0,Q(x.format),Q(x.type),null);o.bindRenderbuffer(o.RENDERBUFFER,x.__webglRenderbuffer);o.bindFramebuffer(o.FRAMEBUFFER,x.__webglFramebuffer);o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,x.__webglTexture,0);if(x.depthBuffer&&!x.stencilBuffer){o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,x.width,x.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,
o.DEPTH_ATTACHMENT,o.RENDERBUFFER,x.__webglRenderbuffer)}else if(x.depthBuffer&&x.stencilBuffer){o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,x.width,x.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,x.__webglRenderbuffer)}else o.renderbufferStorage(o.RENDERBUFFER,o.RGBA4,x.width,x.height);o.bindTexture(o.TEXTURE_2D,null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,null)}var M,F;if(x){M=x.__webglFramebuffer;F=x.width;x=
x.height}else{M=null;F=ca;x=$}if(M!=ka){o.bindFramebuffer(o.FRAMEBUFFER,M);o.viewport(ta,za,F,x);ka=M}}function N(x,M){var F;if(x=="fragment")F=o.createShader(o.FRAGMENT_SHADER);else x=="vertex"&&(F=o.createShader(o.VERTEX_SHADER));o.shaderSource(F,M);o.compileShader(F);if(!o.getShaderParameter(F,o.COMPILE_STATUS)){console.error(o.getShaderInfoLog(F));console.error(M);return null}return F}function L(x){switch(x){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return o.NEAREST;
default:return o.LINEAR}}function Q(x){switch(x){case THREE.RepeatWrapping:return o.REPEAT;case THREE.ClampToEdgeWrapping:return o.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return o.MIRRORED_REPEAT;case THREE.NearestFilter:return o.NEAREST;case THREE.NearestMipMapNearestFilter:return o.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return o.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return o.LINEAR;case THREE.LinearMipMapNearestFilter:return o.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return o.LINEAR_MIPMAP_LINEAR;
case THREE.ByteType:return o.BYTE;case THREE.UnsignedByteType:return o.UNSIGNED_BYTE;case THREE.ShortType:return o.SHORT;case THREE.UnsignedShortType:return o.UNSIGNED_SHORT;case THREE.IntType:return o.INT;case THREE.UnsignedShortType:return o.UNSIGNED_INT;case THREE.FloatType:return o.FLOAT;case THREE.AlphaFormat:return o.ALPHA;case THREE.RGBFormat:return o.RGB;case THREE.RGBAFormat:return o.RGBA;case THREE.LuminanceFormat:return o.LUMINANCE;case THREE.LuminanceAlphaFormat:return o.LUMINANCE_ALPHA}return 0}
var ea=this,o,oa=document.createElement("canvas"),ha=[],sa=null,ka=null,U=!0,ma=null,qa=null,va=null,fa=null,ta=0,za=0,ca=0,$=0,ia=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Aa=new THREE.Matrix4,Ka=new Float32Array(16),Ba=new Float32Array(16),Ea=new THREE.Vector4,V={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};stencil=b.stencil!==undefined?b.stencil:!0;
antialias=b.antialias!==undefined?b.antialias:!1;clearColor=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0);clearAlpha=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=oa;this.autoClear=!0;this.sortObjects=!0;(function(x,M,F,G){try{if(!(o=oa.getContext("experimental-webgl",{antialias:x,stencil:G})))throw"Error creating WebGL context.";}catch(J){console.error(J)}console.log(navigator.userAgent+" | "+
o.getParameter(o.VERSION)+" | "+o.getParameter(o.VENDOR)+" | "+o.getParameter(o.RENDERER)+" | "+o.getParameter(o.SHADING_LANGUAGE_VERSION));o.clearColor(0,0,0,1);o.clearDepth(1);o.enable(o.DEPTH_TEST);o.depthFunc(o.LEQUAL);o.frontFace(o.CCW);o.cullFace(o.BACK);o.enable(o.CULL_FACE);o.enable(o.BLEND);o.blendEquation(o.FUNC_ADD);o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA);o.clearColor(M.r,M.g,M.b,F)})(antialias,clearColor,clearAlpha,stencil);this.context=o;var ra=o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>
0;if(stencil){var aa={};aa.vertices=new Float32Array(12);aa.faces=new Uint16Array(6);aa.darkness=0.5;aa.vertices[0]=-20;aa.vertices[1]=-20;aa.vertices[2]=-1;aa.vertices[3]=20;aa.vertices[4]=-20;aa.vertices[5]=-1;aa.vertices[6]=20;aa.vertices[7]=20;aa.vertices[8]=-1;aa.vertices[9]=-20;aa.vertices[10]=20;aa.vertices[11]=-1;aa.faces[0]=0;aa.faces[1]=1;aa.faces[2]=2;aa.faces[3]=0;aa.faces[4]=2;aa.faces[5]=3;aa.vertexBuffer=o.createBuffer();aa.elementBuffer=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,
aa.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,aa.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,aa.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,aa.faces,o.STATIC_DRAW);aa.program=o.createProgram();o.attachShader(aa.program,N("fragment",THREE.ShaderLib.shadowPost.fragmentShader));o.attachShader(aa.program,N("vertex",THREE.ShaderLib.shadowPost.vertexShader));o.linkProgram(aa.program);aa.vertexLocation=o.getAttribLocation(aa.program,"position");aa.projectionLocation=o.getUniformLocation(aa.program,
"projectionMatrix");aa.darknessLocation=o.getUniformLocation(aa.program,"darkness")}var Z={};Z.vertices=new Float32Array(16);Z.faces=new Uint16Array(6);b=0;Z.vertices[b++]=-1;Z.vertices[b++]=-1;Z.vertices[b++]=0;Z.vertices[b++]=0;Z.vertices[b++]=1;Z.vertices[b++]=-1;Z.vertices[b++]=1;Z.vertices[b++]=0;Z.vertices[b++]=1;Z.vertices[b++]=1;Z.vertices[b++]=1;Z.vertices[b++]=1;Z.vertices[b++]=-1;Z.vertices[b++]=1;Z.vertices[b++]=0;Z.vertices[b++]=1;b=0;Z.faces[b++]=0;Z.faces[b++]=1;Z.faces[b++]=2;Z.faces[b++]=
0;Z.faces[b++]=2;Z.faces[b++]=3;Z.vertexBuffer=o.createBuffer();Z.elementBuffer=o.createBuffer();Z.tempTexture=o.createTexture();Z.occlusionTexture=o.createTexture();o.bindBuffer(o.ARRAY_BUFFER,Z.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,Z.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,Z.elementBuffer);o.bufferData(o.ELEMENT_ARRAY_BUFFER,Z.faces,o.STATIC_DRAW);o.bindTexture(o.TEXTURE_2D,Z.tempTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGB,16,16,0,o.RGB,o.UNSIGNED_BYTE,null);o.texParameteri(o.TEXTURE_2D,
o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);o.bindTexture(o.TEXTURE_2D,Z.occlusionTexture);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,16,16,0,o.RGBA,o.UNSIGNED_BYTE,null);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,
o.NEAREST);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);if(o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){Z.hasVertexTexture=!1;Z.program=o.createProgram();o.attachShader(Z.program,N("fragment",THREE.ShaderLib.lensFlare.fragmentShader));o.attachShader(Z.program,N("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{Z.hasVertexTexture=!0;Z.program=o.createProgram();o.attachShader(Z.program,N("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));o.attachShader(Z.program,
N("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}o.linkProgram(Z.program);Z.attributes={};Z.uniforms={};Z.attributes.vertex=o.getAttribLocation(Z.program,"position");Z.attributes.uv=o.getAttribLocation(Z.program,"UV");Z.uniforms.renderType=o.getUniformLocation(Z.program,"renderType");Z.uniforms.map=o.getUniformLocation(Z.program,"map");Z.uniforms.occlusionMap=o.getUniformLocation(Z.program,"occlusionMap");Z.uniforms.opacity=o.getUniformLocation(Z.program,"opacity");Z.uniforms.scale=
o.getUniformLocation(Z.program,"scale");Z.uniforms.rotation=o.getUniformLocation(Z.program,"rotation");Z.uniforms.screenPosition=o.getUniformLocation(Z.program,"screenPosition");var Pa=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=
1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=o.createBuffer();_sprite.elementBuffer=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,_sprite.vertexBuffer);o.bufferData(o.ARRAY_BUFFER,_sprite.vertices,o.STATIC_DRAW);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);
o.bufferData(o.ELEMENT_ARRAY_BUFFER,_sprite.faces,o.STATIC_DRAW);_sprite.program=o.createProgram();o.attachShader(_sprite.program,N("fragment",THREE.ShaderLib.sprite.fragmentShader));o.attachShader(_sprite.program,N("vertex",THREE.ShaderLib.sprite.vertexShader));o.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=o.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=o.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=
o.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=o.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=o.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=o.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=o.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=o.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=o.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=
o.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=o.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=o.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=o.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=o.getUniformLocation(_sprite.program,"projectionMatrix");var eb=!1;this.setSize=function(x,M){oa.width=x;oa.height=M;this.setViewport(0,
0,oa.width,oa.height)};this.setViewport=function(x,M,F,G){ta=x;za=M;ca=F;$=G;o.viewport(ta,za,ca,$)};this.setScissor=function(x,M,F,G){o.scissor(x,M,F,G)};this.enableScissorTest=function(x){x?o.enable(o.SCISSOR_TEST):o.disable(o.SCISSOR_TEST)};this.enableDepthBufferWrite=function(x){U=x;o.depthMask(x)};this.setClearColorHex=function(x,M){var F=new THREE.Color(x);o.clearColor(F.r,F.g,F.b,M)};this.setClearColor=function(x,M){o.clearColor(x.r,x.g,x.b,M)};this.clear=function(){o.clear(o.COLOR_BUFFER_BIT|
o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(x){aa.darkness=x};this.getContext=function(){return o};this.initMaterial=function(x,M,F,G){var J,T,S;if(x instanceof THREE.MeshDepthMaterial)S="depth";else if(x instanceof THREE.ShadowVolumeDynamicMaterial)S="shadowVolumeDynamic";else if(x instanceof THREE.MeshNormalMaterial)S="normal";else if(x instanceof THREE.MeshBasicMaterial)S="basic";else if(x instanceof THREE.MeshLambertMaterial)S="lambert";else if(x instanceof
THREE.MeshPhongMaterial)S="phong";else if(x instanceof THREE.LineBasicMaterial)S="basic";else x instanceof THREE.ParticleBasicMaterial&&(S="particle_basic");if(S){var R=THREE.ShaderLib[S];x.uniforms=THREE.UniformsUtils.clone(R.uniforms);x.vertexShader=R.vertexShader;x.fragmentShader=R.fragmentShader}var Y,O,W;Y=W=R=0;for(O=M.length;Y<O;Y++){T=M[Y];T instanceof THREE.DirectionalLight&&W++;T instanceof THREE.PointLight&&R++}if(R+W<=4)M=W;else{M=Math.ceil(4*W/(R+W));R=4-M}T={directional:M,point:R};W=
50;if(G!==undefined&&G instanceof THREE.SkinnedMesh)W=G.bones.length;var X;a:{Y=x.fragmentShader;O=x.vertexShader;R=x.uniforms;M=x.attributes;F={map:!!x.map,envMap:!!x.envMap,lightMap:!!x.lightMap,vertexColors:x.vertexColors,fog:F,sizeAttenuation:x.sizeAttenuation,skinning:x.skinning,morphTargets:x.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:T.directional,maxPointLights:T.point,maxBones:W};var na;T=[];if(S)T.push(S);else{T.push(Y);T.push(O)}for(na in F){T.push(na);T.push(F[na])}S=
T.join();na=0;for(T=ha.length;na<T;na++)if(ha[na].code==S){X=ha[na].program;break a}na=o.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+F.maxDirLights,"#define MAX_POINT_LIGHTS "+F.maxPointLights,F.fog?"#define USE_FOG":"",F.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",F.map?"#define USE_MAP":"",F.envMap?"#define USE_ENVMAP":"",F.lightMap?"#define USE_LIGHTMAP":"",F.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
prefix_vertex=[ra?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+F.maxDirLights,"#define MAX_POINT_LIGHTS "+F.maxPointLights,"#define MAX_BONES "+F.maxBones,F.map?"#define USE_MAP":"",F.envMap?"#define USE_ENVMAP":"",F.lightMap?"#define USE_LIGHTMAP":"",F.vertexColors?"#define USE_COLOR":"",F.skinning?"#define USE_SKINNING":"",F.morphTargets?"#define USE_MORPHTARGETS":"",F.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
o.attachShader(na,N("fragment",prefix_fragment+Y));o.attachShader(na,N("vertex",prefix_vertex+O));o.linkProgram(na);o.getProgramParameter(na,o.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+o.getProgramParameter(na,o.VALIDATE_STATUS)+", gl error ["+o.getError()+"]");na.uniforms={};na.attributes={};var ga;Y=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(ga in R)Y.push(ga);ga=Y;R=0;for(Y=ga.length;R<Y;R++){O=ga[R];na.uniforms[O]=o.getUniformLocation(na,O)}Y=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(ga=0;ga<F.maxMorphTargets;ga++)Y.push("morphTarget"+ga);for(X in M)Y.push(X);X=Y;ga=0;for(M=X.length;ga<M;ga++){F=X[ga];na.attributes[F]=o.getAttribLocation(na,F)}ha.push({program:na,code:S});X=na}x.program=X;X=x.program.attributes;o.enableVertexAttribArray(X.position);X.color>=0&&o.enableVertexAttribArray(X.color);
X.normal>=0&&o.enableVertexAttribArray(X.normal);X.tangent>=0&&o.enableVertexAttribArray(X.tangent);if(x.skinning&&X.skinVertexA>=0&&X.skinVertexB>=0&&X.skinIndex>=0&&X.skinWeight>=0){o.enableVertexAttribArray(X.skinVertexA);o.enableVertexAttribArray(X.skinVertexB);o.enableVertexAttribArray(X.skinIndex);o.enableVertexAttribArray(X.skinWeight)}for(J in x.attributes)X[J]>=0&&o.enableVertexAttribArray(X[J]);if(x.morphTargets){x.numSupportedMorphTargets=0;if(X.morphTarget0>=0){o.enableVertexAttribArray(X.morphTarget0);
x.numSupportedMorphTargets++}if(X.morphTarget1>=0){o.enableVertexAttribArray(X.morphTarget1);x.numSupportedMorphTargets++}if(X.morphTarget2>=0){o.enableVertexAttribArray(X.morphTarget2);x.numSupportedMorphTargets++}if(X.morphTarget3>=0){o.enableVertexAttribArray(X.morphTarget3);x.numSupportedMorphTargets++}if(X.morphTarget4>=0){o.enableVertexAttribArray(X.morphTarget4);x.numSupportedMorphTargets++}if(X.morphTarget5>=0){o.enableVertexAttribArray(X.morphTarget5);x.numSupportedMorphTargets++}if(X.morphTarget6>=
0){o.enableVertexAttribArray(X.morphTarget6);x.numSupportedMorphTargets++}if(X.morphTarget7>=0){o.enableVertexAttribArray(X.morphTarget7);x.numSupportedMorphTargets++}G.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);x=0;for(J=this.maxMorphTargets;x<J;x++)G.__webglMorphTargetInfluences[x]=0}};this.render=function(x,M,F,G){var J,T,S,R,Y,O,W,X,na=x.lights,ga=x.fog;ea.data.vertices=0;ea.data.faces=0;ea.data.drawCalls=0;M.matrixAutoUpdate&&M.update(undefined,!0);x.update(undefined,
!1,M);M.matrixWorldInverse.flattenToArray(Ba);M.projectionMatrix.flattenToArray(Ka);Aa.multiply(M.projectionMatrix,M.matrixWorldInverse);h(Aa);this.initWebGLObjects(x);K(F);(this.autoClear||G)&&this.clear();Y=x.__webglObjects.length;for(G=0;G<Y;G++){J=x.__webglObjects[G];W=J.object;if(W.visible)if(!(W instanceof THREE.Mesh)||m(W)){W.matrixWorld.flattenToArray(W._objectMatrixArray);y(W,M);t(J);J.render=!0;if(this.sortObjects){Ea.copy(W.position);Aa.multiplyVector3(Ea);J.z=Ea.z}}else J.render=!1;else J.render=
!1}this.sortObjects&&x.__webglObjects.sort(v);O=x.__webglObjectsImmediate.length;for(G=0;G<O;G++){J=x.__webglObjectsImmediate[G];W=J.object;if(W.visible){W.matrixAutoUpdate&&W.matrixWorld.flattenToArray(W._objectMatrixArray);y(W,M);p(J)}}I(THREE.NormalBlending);for(G=0;G<Y;G++){J=x.__webglObjects[G];if(J.render){W=J.object;X=J.buffer;S=J.opaque;g(W);for(J=0;J<S.count;J++){R=S.list[J];j(R.depthTest);d(M,na,ga,R,X,W)}}}for(G=0;G<O;G++){J=x.__webglObjectsImmediate[G];W=J.object;if(W.visible){S=J.opaque;
g(W);for(J=0;J<S.count;J++){R=S.list[J];j(R.depthTest);T=c(M,na,ga,R,W);W.render(function(Ha){f(Ha,T,R.shading)})}}}for(G=0;G<Y;G++){J=x.__webglObjects[G];if(J.render){W=J.object;X=J.buffer;S=J.transparent;g(W);for(J=0;J<S.count;J++){R=S.list[J];I(R.blending);j(R.depthTest);d(M,na,ga,R,X,W)}}}for(G=0;G<O;G++){J=x.__webglObjectsImmediate[G];W=J.object;if(W.visible){S=J.transparent;g(W);for(J=0;J<S.count;J++){R=S.list[J];I(R.blending);j(R.depthTest);T=c(M,na,ga,R,W);W.render(function(Ha){f(Ha,T,R.shading)})}}}x.__webglSprites.length&&
w(x,M);stencil&&x.__webglShadowVolumes.length&&x.lights.length&&u(x);x.__webglLensFlares.length&&z(x,M);if(F&&F.minFilter!==THREE.NearestFilter&&F.minFilter!==THREE.LinearFilter){o.bindTexture(o.TEXTURE_2D,F.__webglTexture);o.generateMipmap(o.TEXTURE_2D);o.bindTexture(o.TEXTURE_2D,null)}};this.initWebGLObjects=function(x){if(!x.__webglObjects){x.__webglObjects=[];x.__webglObjectsImmediate=[];x.__webglShadowVolumes=[];x.__webglLensFlares=[];x.__webglSprites=[]}for(;x.__objectsAdded.length;){var M=
x.__objectsAdded[0],F=x,G=void 0,J=void 0,T=void 0;if(M._modelViewMatrix==undefined){M._modelViewMatrix=new THREE.Matrix4;M._normalMatrixArray=new Float32Array(9);M._modelViewMatrixArray=new Float32Array(16);M._objectMatrixArray=new Float32Array(16);M.matrixWorld.flattenToArray(M._objectMatrixArray)}if(M instanceof THREE.Mesh){J=M.geometry;J.geometryGroups==undefined&&E(J);for(G in J.geometryGroups){T=J.geometryGroups[G];if(!T.__webglVertexBuffer){var S=T;S.__webglVertexBuffer=o.createBuffer();S.__webglNormalBuffer=
o.createBuffer();S.__webglTangentBuffer=o.createBuffer();S.__webglColorBuffer=o.createBuffer();S.__webglUVBuffer=o.createBuffer();S.__webglUV2Buffer=o.createBuffer();S.__webglSkinVertexABuffer=o.createBuffer();S.__webglSkinVertexBBuffer=o.createBuffer();S.__webglSkinIndicesBuffer=o.createBuffer();S.__webglSkinWeightsBuffer=o.createBuffer();S.__webglFaceBuffer=o.createBuffer();S.__webglLineBuffer=o.createBuffer();if(S.numMorphTargets){var R=void 0,Y=void 0;S.__webglMorphTargetsBuffers=[];R=0;for(Y=
S.numMorphTargets;R<Y;R++)S.__webglMorphTargetsBuffers.push(o.createBuffer())}S=T;R=M;var O=void 0,W=void 0,X=void 0,na=void 0,ga=void 0,Ha=void 0,Oa=Ha=Y=0,Ja=void 0;na=R.geometry;Ja=na.faces;ga=S.faces;O=0;for(W=ga.length;O<W;O++){X=ga[O];X=Ja[X];if(X instanceof THREE.Face3){Y+=3;Ha+=1;Oa+=3}else if(X instanceof THREE.Face4){Y+=4;Ha+=2;Oa+=4}}O=S;W=R;var Fa=void 0,Sa=void 0;X=[];Ja=0;for(ga=W.materials.length;Ja<ga;Ja++){Fa=W.materials[Ja];if(Fa instanceof THREE.MeshFaceMaterial){Fa=0;for(l=O.materials.length;Fa<
l;Fa++)(Sa=O.materials[Fa])&&X.push(Sa)}else(Sa=Fa)&&X.push(Sa)}O=X;a:{ga=O.length;for(W=0;W<ga;W++){Ja=O[W];if(Ja.map||Ja.lightMap||Ja instanceof THREE.MeshShaderMaterial){W=!0;break a}}W=!1}a:{Ja=O;Fa=Ja.length;for(ga=0;ga<Fa;ga++){X=Ja[ga];if(!(X instanceof THREE.MeshBasicMaterial&&!X.envMap||X instanceof THREE.MeshDepthMaterial)){Ja=X&&X.shading!=undefined&&X.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}Ja=!1}a:{Fa=O.length;for(ga=0;ga<Fa;ga++){X=O[ga];if(X.vertexColors){X=
X.vertexColors;break a}}X=!1}S.__vertexArray=new Float32Array(Y*3);if(Ja)S.__normalArray=new Float32Array(Y*3);if(na.hasTangents)S.__tangentArray=new Float32Array(Y*4);if(X)S.__colorArray=new Float32Array(Y*3);if(W){if(na.faceUvs.length>0||na.faceVertexUvs.length>0)S.__uvArray=new Float32Array(Y*2);if(na.faceUvs.length>1||na.faceVertexUvs.length>1)S.__uv2Array=new Float32Array(Y*2)}if(R.geometry.skinWeights.length&&R.geometry.skinIndices.length){S.__skinVertexAArray=new Float32Array(Y*4);S.__skinVertexBArray=
new Float32Array(Y*4);S.__skinIndexArray=new Float32Array(Y*4);S.__skinWeightArray=new Float32Array(Y*4)}S.__faceArray=new Uint16Array(Ha*3+(R.geometry.edgeFaces?R.geometry.edgeFaces.length*6:0));S.__lineArray=new Uint16Array(Oa*2);if(S.numMorphTargets){S.__morphTargetsArrays=[];na=0;for(ga=S.numMorphTargets;na<ga;na++)S.__morphTargetsArrays.push(new Float32Array(Y*3))}S.__needsSmoothNormals=Ja==THREE.SmoothShading;S.__uvType=W;S.__vertexColorType=X;S.__normalType=Ja;S.__webglFaceCount=Ha*3+(R.geometry.edgeFaces?
R.geometry.edgeFaces.length*6:0);S.__webglLineCount=Oa*2;na=0;for(ga=O.length;na<ga;na++)if(O[na].attributes){S.__webglCustomAttributes={};for(a in O[na].attributes){W=O[na].attributes[a];if(!W.__webglInitialized||W.createUniqueBuffers){W.__webglInitialized=!0;Ha=1;if(W.type==="v2")Ha=2;else if(W.type==="v3")Ha=3;else if(W.type==="v4")Ha=4;else W.type==="c"&&(Ha=3);W.size=Ha;W.needsUpdate=!0;W.array=new Float32Array(Y*Ha);W.buffer=o.createBuffer();W.buffer.belongsToAttribute=a}S.__webglCustomAttributes[a]=
W}}J.__dirtyVertices=!0;J.__dirtyMorphTargets=!0;J.__dirtyElements=!0;J.__dirtyUvs=!0;J.__dirtyNormals=!0;J.__dirtyTangents=!0;J.__dirtyColors=!0}M instanceof THREE.ShadowVolume?B(F.__webglShadowVolumes,T,M):B(F.__webglObjects,T,M)}}else if(M instanceof THREE.LensFlare)B(F.__webglLensFlares,undefined,M);else if(M instanceof THREE.Ribbon){J=M.geometry;if(!J.__webglVertexBuffer){G=J;G.__webglVertexBuffer=o.createBuffer();G.__webglColorBuffer=o.createBuffer();G=J;T=G.vertices.length;G.__vertexArray=
new Float32Array(T*3);G.__colorArray=new Float32Array(T*3);G.__webglVertexCount=T;J.__dirtyVertices=!0;J.__dirtyColors=!0}B(F.__webglObjects,J,M)}else if(M instanceof THREE.Line){J=M.geometry;if(!J.__webglVertexBuffer){G=J;G.__webglVertexBuffer=o.createBuffer();G.__webglColorBuffer=o.createBuffer();G=J;T=G.vertices.length;G.__vertexArray=new Float32Array(T*3);G.__colorArray=new Float32Array(T*3);G.__webglLineCount=T;J.__dirtyVertices=!0;J.__dirtyColors=!0}B(F.__webglObjects,J,M)}else if(M instanceof
THREE.ParticleSystem){J=M.geometry;if(!J.__webglVertexBuffer){G=J;G.__webglVertexBuffer=o.createBuffer();G.__webglColorBuffer=o.createBuffer();G=J;T=G.vertices.length;G.__vertexArray=new Float32Array(T*3);G.__colorArray=new Float32Array(T*3);G.__sortArray=[];G.__webglParticleCount=T;J.__dirtyVertices=!0;J.__dirtyColors=!0}B(F.__webglObjects,J,M)}else if(THREE.MarchingCubes!==undefined&&M instanceof THREE.MarchingCubes)F.__webglObjectsImmediate.push({object:M,opaque:{list:[],count:0},transparent:{list:[],
count:0}});else M instanceof THREE.Sprite&&F.__webglSprites.push(M);x.__objectsAdded.splice(0,1)}for(;x.__objectsRemoved.length;){M=x.__objectsRemoved[0];F=x;if(M instanceof THREE.Mesh)for(J=F.__webglObjects.length-1;J>=0;J--){G=F.__webglObjects[J].object;if(M==G){F.__webglObjects.splice(J,1);break}}else if(M instanceof THREE.Sprite)for(J=F.__webglSprites.length-1;J>=0;J--){G=F.__webglSprites[J];if(M==G){F.__webglSprites.splice(J,1);break}}x.__objectsRemoved.splice(0,1)}M=0;for(F=x.__webglObjects.length;M<
F;M++)A(x.__webglObjects[M].object,x);M=0;for(F=x.__webglShadowVolumes.length;M<F;M++)A(x.__webglShadowVolumes[M].object,x);M=0;for(F=x.__webglLensFlares.length;M<F;M++)A(x.__webglLensFlares[M].object,x)};this.setFaceCulling=function(x,M){if(x){!M||M=="ccw"?o.frontFace(o.CCW):o.frontFace(o.CW);if(x=="back")o.cullFace(o.BACK);else x=="front"?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK);o.enable(o.CULL_FACE)}else o.disable(o.CULL_FACE)};this.supportsVertexTextures=function(){return ra}};
THREE.WebGLRenderTarget=function(b,e,c){this.width=b;this.height=e;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==
undefined?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:!0};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,e,c){c&&b.update(undefined,!1,e);c=b.sounds;var d,f=c.length;for(d=0;d<f;d++){b=c[d];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(e.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};
THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.materials=null};
THREE.AnimationHandler=function(){var b=[],e={},c={};c.update=function(f){for(var g=0;g<b.length;g++)b[g].update(f)};c.addToUpdate=function(f){b.indexOf(f)===-1&&b.push(f)};c.removeFromUpdate=function(f){f=b.indexOf(f);f!==-1&&b.splice(f,1)};c.add=function(f){e[f.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.");e[f.name]=f;if(f.initialized!==!0){for(var g=0;g<f.hierarchy.length;g++){for(var j=0;j<f.hierarchy[g].keys.length;j++){if(f.hierarchy[g].keys[j].time<
0)f.hierarchy[g].keys[j].time=0;if(f.hierarchy[g].keys[j].rot!==undefined&&!(f.hierarchy[g].keys[j].rot instanceof THREE.Quaternion)){var h=f.hierarchy[g].keys[j].rot;f.hierarchy[g].keys[j].rot=new THREE.Quaternion(h[0],h[1],h[2],h[3])}}if(f.hierarchy[g].keys[0].morphTargets!==undefined){h={};for(j=0;j<f.hierarchy[g].keys.length;j++)for(var m=0;m<f.hierarchy[g].keys[j].morphTargets.length;m++){var n=f.hierarchy[g].keys[j].morphTargets[m];h[n]=-1}f.hierarchy[g].usedMorphTargets=h;for(j=0;j<f.hierarchy[g].keys.length;j++){var p=
{};for(n in h){for(m=0;m<f.hierarchy[g].keys[j].morphTargets.length;m++)if(f.hierarchy[g].keys[j].morphTargets[m]===n){p[n]=f.hierarchy[g].keys[j].morphTargetsInfluences[m];break}m===f.hierarchy[g].keys[j].morphTargets.length&&(p[n]=0)}f.hierarchy[g].keys[j].morphTargetsInfluences=p}}for(j=1;j<f.hierarchy[g].keys.length;j++)if(f.hierarchy[g].keys[j].time===f.hierarchy[g].keys[j-1].time){f.hierarchy[g].keys.splice(j,1);j--}for(j=1;j<f.hierarchy[g].keys.length;j++)f.hierarchy[g].keys[j].index=j}j=parseInt(f.length*
f.fps,10);f.JIT={};f.JIT.hierarchy=[];for(g=0;g<f.hierarchy.length;g++)f.JIT.hierarchy.push(Array(j));f.initialized=!0}};c.get=function(f){if(typeof f==="string")if(e[f])return e[f];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}};c.parse=function(f){var g=[];if(f instanceof THREE.SkinnedMesh)for(var j=0;j<f.bones.length;j++)g.push(f.bones[j]);else d(f,g);return g};var d=function(f,g){g.push(f);for(var j=0;j<f.children.length;j++)d(f.children[j],g)};c.LINEAR=
0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,e,c,d){this.root=b;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.JITCompile=d!==undefined?d:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,e){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==undefined?b:!0;this.currentTime=e!==undefined?e:0;var c,d=this.hierarchy.length,f;for(c=0;c<d;c++){f=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=!0;f.matrixAutoUpdate=!0;if(f.animationCache===undefined){f.animationCache={};f.animationCache.prevKey={pos:0,rot:0,scl:0};f.animationCache.nextKey={pos:0,rot:0,scl:0};f.animationCache.originalMatrix=
f instanceof THREE.Bone?f.skinMatrix:f.matrix}var g=f.animationCache.prevKey;f=f.animationCache.nextKey;g.pos=this.data.hierarchy[c].keys[0];g.rot=this.data.hierarchy[c].keys[0];g.scl=this.data.hierarchy[c].keys[0];f.pos=this.getNextKeyWith("pos",c,1);f.rot=this.getNextKeyWith("rot",c,1);f.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==undefined){if(this.hierarchy[b]instanceof THREE.Bone)this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix;else this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var e=["pos","rot","scl"],c,d,f,g,j,h,m,n,p=this.data.JIT.hierarchy,t,v;this.currentTime+=b*this.timeScale;v=this.currentTime;t=this.currentTime%=this.data.length;n=parseInt(Math.min(t*this.data.fps,this.data.length*this.data.fps),10);for(var u=0,w=this.hierarchy.length;u<w;u++){b=this.hierarchy[u];m=b.animationCache;if(this.JITCompile&&p[u][n]!==undefined)if(b instanceof THREE.Bone){b.skinMatrix=p[u][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=
!1}else{b.matrix=p[u][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(b instanceof THREE.Bone)b.skinMatrix=b.animationCache.originalMatrix;else b.matrix=b.animationCache.originalMatrix;for(var z=0;z<3;z++){c=e[z];j=m.prevKey[c];h=m.nextKey[c];if(h.time<=v){if(t<v)if(this.loop){j=this.data.hierarchy[u].keys[0];for(h=this.getNextKeyWith(c,u,1);h.time<t;){j=h;h=this.getNextKeyWith(c,u,h.index+1)}}else{this.stop();return}else{do{j=h;h=this.getNextKeyWith(c,u,h.index+1)}while(h.time<
t)}m.prevKey[c]=j;m.nextKey[c]=h}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;d=(t-j.time)/(h.time-j.time);f=j[c];g=h[c];if(d<0||d>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+u);d=d<0?0:1}if(c==="pos"){c=b.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=f[0]+(g[0]-f[0])*d;c.y=f[1]+(g[1]-f[1])*d;c.z=f[2]+(g[2]-f[2])*d}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",u,j.index-1).pos;this.points[1]=f;this.points[2]=g;this.points[3]=this.getNextKeyWith("pos",u,h.index+1).pos;d=d*0.33+0.33;f=this.interpolateCatmullRom(this.points,d);c.x=f[0];c.y=f[1];c.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){d=this.interpolateCatmullRom(this.points,d*1.01);this.target.set(d[0],d[1],d[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();d=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,d,0)}}}else if(c===
"rot")THREE.Quaternion.slerp(f,g,b.quaternion,d);else if(c==="scl"){c=b.scale;c.x=f[0]+(g[0]-f[0])*d;c.y=f[1]+(g[1]-f[1])*d;c.z=f[2]+(g[2]-f[2])*d}}}}if(this.JITCompile&&p[0][n]===undefined){this.hierarchy[0].update(undefined,!0);for(u=0;u<this.hierarchy.length;u++)p[u][n]=this.hierarchy[u]instanceof THREE.Bone?this.hierarchy[u].skinMatrix.clone():this.hierarchy[u].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,e){var c=[],d=[],f,g,j,h,m,n;f=(b.length-1)*e;g=Math.floor(f);f-=g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>b.length-2?g:g+1;c[3]=g>b.length-3?g:g+2;g=b[c[0]];h=b[c[1]];m=b[c[2]];n=b[c[3]];c=f*f;j=f*c;d[0]=this.interpolate(g[0],h[0],m[0],n[0],f,c,j);d[1]=this.interpolate(g[1],h[1],m[1],n[1],f,c,j);d[2]=this.interpolate(g[2],h[2],m[2],n[2],f,c,j);return d};
THREE.Animation.prototype.interpolate=function(b,e,c,d,f,g,j){b=(c-b)*0.5;d=(d-e)*0.5;return(2*(e-c)+b+d)*j+(-3*(e-c)-2*b-d)*g+b*f+e};THREE.Animation.prototype.getNextKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<d.length-1?c:d.length-1;else c%=d.length;for(;c<d.length;c++)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,e,c){var d=this.data.hierarchy[e].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[e].keys[d.length-1]};
THREE.ColorUtils={adjustHSV:function(b,e,c,d){var f=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,f);f.h=THREE.ColorUtils.clamp(f.h+e,0,1);f.s=THREE.ColorUtils.clamp(f.s+c,0,1);f.v=THREE.ColorUtils.clamp(f.v+d,0,1);b.setHSV(f.h,f.s,f.v)},rgbToHsv:function(b,e){var c=b.r,d=b.g,f=b.b,g=Math.max(Math.max(c,d),f),j=Math.min(Math.min(c,d),f);if(j==g)j=c=0;else{var h=g-j;j=h/g;c=c==g?(d-f)/h:d==g?2+(f-c)/h:4+(c-d)/h;c/=6;c<0&&(c+=1);c>1&&(c-=1)}e===undefined&&(e={h:0,s:0,v:0});e.h=c;e.s=j;e.v=g;return e},
clamp:function(b,e,c){return b<e?e:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,e){var c=e instanceof THREE.Mesh,d=b.vertices.length,f=c?e.geometry:e,g=b.vertices,j=f.vertices,h=b.faces,m=f.faces,n=b.faceVertexUvs[0];f=f.faceVertexUvs[0];c&&e.matrixAutoUpdate&&e.updateMatrix();for(var p=0,t=j.length;p<t;p++){var v=new THREE.Vertex(j[p].position.clone());c&&e.matrix.multiplyVector3(v.position);g.push(v)}p=0;for(t=m.length;p<t;p++){j=m[p];var u,w,z=j.vertexNormals;v=j.vertexColors;if(j instanceof THREE.Face3)u=new THREE.Face3(j.a+d,j.b+d,j.c+
d);else j instanceof THREE.Face4&&(u=new THREE.Face4(j.a+d,j.b+d,j.c+d,j.d+d));u.normal.copy(j.normal);c=0;for(g=z.length;c<g;c++){w=z[c];u.vertexNormals.push(w.clone())}u.color.copy(j.color);c=0;for(g=v.length;c<g;c++){w=v[c];u.vertexColors.push(w.clone())}u.materials=j.materials.slice();u.centroid.copy(j.centroid);h.push(u)}p=0;for(t=f.length;p<t;p++){d=f[p];h=[];c=0;for(g=d.length;c<g;c++)h.push(new THREE.UV(d[c].u,d[c].v));n.push(h)}}};
THREE.ImageUtils={loadTexture:function(b,e,c){var d=new Image,f=new THREE.Texture(d,e);d.onload=function(){f.needsUpdate=!0;c&&c(this)};d.src=b;return f},loadTextureCube:function(b,e,c){var d,f=[],g=new THREE.Texture(f,e);e=f.loadCount=0;for(d=b.length;e<d;++e){f[e]=new Image;f[e].onload=function(){f.loadCount+=1;if(f.loadCount==6)g.needsUpdate=!0;c&&c(this)};f[e].src=b[e]}return g}};
THREE.SceneUtils={addMesh:function(b,e,c,d,f,g,j,h,m,n){e=new THREE.Mesh(e,n);e.scale.x=e.scale.y=e.scale.z=c;e.position.x=d;e.position.y=f;e.position.z=g;e.rotation.x=j;e.rotation.y=h;e.rotation.z=m;b.addObject(e);return e},addPanoramaCubeWebGL:function(b,e,c){var d=THREE.ShaderUtils.lib.cube;d.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms});e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,1,null,!0),c);b.addObject(e);
return e},addPanoramaCube:function(b,e,c){var d=[];d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));e=new THREE.Mesh(new THREE.Cube(e,e,e,1,1,d,!0),
new THREE.MeshFaceMaterial);b.addObject(e);return e},addPanoramaCubePlanes:function(b,e,c){var d=e/2;e=new THREE.Plane(e,e);var f=Math.PI,g=Math.PI/2;THREE.SceneUtils.addMesh(b,e,1,0,0,-d,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,e,1,-d,0,0,0,g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,e,1,d,0,0,0,-g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,e,1,0,d,0,g,
0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,e,1,0,-d,0,-g,0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,e){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=e})},traverseHierarchy:function(b,e){var c,d,f=b.children.length;for(d=0;d<f;d++){c=b.children[d];e(c);THREE.SceneUtils.traverseHierarchy(c,e)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var e,c,d,f,g=2*Math.ceil(b*3)+1;g>25&&(g=25);f=(g-1)*0.5;c=Array(g);for(e=d=0;e<g;++e){c[e]=Math.exp(-((e-f)*(e-f))/(2*b*b));d+=c[e]}for(e=0;e<g;++e)c[e]/=d;return c}};
THREE.QuakeCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.noFly!==undefined)this.noFly=b.noFly;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.autoForward!==undefined)this.autoForward=b.autoForward;if(b.activeLook!==undefined)this.activeLook=b.activeLook;if(b.heightSpeed!==undefined)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==undefined)this.heightCoef=b.heightCoef;if(b.heightMin!==undefined)this.heightMin=b.heightMin;if(b.heightMax!==undefined)this.heightMax=
b.heightMax;if(b.constrainVertical!==undefined)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==undefined)this.verticalMin=b.verticalMin;if(b.verticalMax!==undefined)this.verticalMax=b.verticalMax;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.moveForward=!1;this.moveBackward=!1;this.moveLeft=!1;this.moveRight=!1;this.freeze=!1;this.mouseDragOn=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=
window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=
function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/
1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var d=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(d+this.autoSpeedFactor));this.moveBackward&&this.translateZ(d);this.moveLeft&&this.translateX(-d);this.moveRight&&this.translateX(d);d=this.tdiff*this.lookSpeed;
this.activeLook||(d=0);this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=
(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",e(this,
this.onMouseMove),!1);this.domElement.addEventListener("mousedown",e(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",e(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",e(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",e(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);if(this.noFly)e.y=0;this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};
THREE.PathCamera=function(b){function e(n,p,t,v){var u={name:t,fps:0.6,length:v,hierarchy:[]},w,z=p.getControlPointsArray(),y=p.getLength(),A=z.length,E=0;w=A-1;p={parent:-1,keys:[]};p.keys[0]={time:0,pos:z[0],rot:[0,0,0,1],scl:[1,1,1]};p.keys[w]={time:v,pos:z[w],rot:[0,0,0,1],scl:[1,1,1]};for(w=1;w<A-1;w++){E=v*y.chunks[w]/y.total;p.keys[w]={time:E,pos:z[w]}}u.hierarchy[0]=p;THREE.AnimationHandler.add(u);return new THREE.Animation(n,t,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(n,p){var t,
v,u=new THREE.Geometry;for(t=0;t<n.points.length*p;t++){v=t/(n.points.length*p);v=n.getPoint(v);u.vertices[t]=new THREE.Vertex(new THREE.Vector3(v.x,v.y,v.z))}return u}function d(n,p){var t=c(p,10),v=c(p,10),u=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(t,u);particleObj=new THREE.ParticleSystem(v,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);n.addChild(lineObj);particleObj.scale.set(1,1,1);n.addChild(particleObj);v=new THREE.Sphere(1,
16,8);u=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<p.points.length;i++){t=new THREE.Mesh(v,u);t.position.copy(p.points[i]);t.updateMatrix();n.addChild(t)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.005;this.lookVertical=
!0;this.lookHorizontal=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==undefined)this.duration=b.duration*1E3;if(b.waypoints!==undefined)this.waypoints=b.waypoints;if(b.useConstantSpeed!==undefined)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==undefined)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==undefined)this.createDebugPath=b.createDebugPath;
if(b.createDebugDummy!==undefined)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==undefined)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==undefined)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==undefined)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var f=Math.PI*2,g=Math.PI/180;this.update=function(n,p,t){var v,u;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*g;this.theta=this.lon*g;v=this.phi%f;this.phi=v>=0?v:v+f;v=this.verticalAngleMap.srcRange;u=this.verticalAngleMap.dstRange;
this.phi=(this.phi-v[0])*(u[1]-u[0])/(v[1]-v[0])+u[0];v=this.horizontalAngleMap.srcRange;u=this.horizontalAngleMap.dstRange;this.theta=(this.theta-v[0])*(u[1]-u[0])/(v[1]-v[0])+u[0];v=this.target.position;v.x=100*Math.sin(this.phi)*Math.cos(this.theta);v.y=100*Math.cos(this.phi);v.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,n,p,t)};this.onMouseMove=function(n){this.mouseX=n.clientX-this.windowHalfX;this.mouseY=n.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);
this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var j=new THREE.MeshLambertMaterial({color:65280}),h=new THREE.Cube(10,10,20),m=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(h,b);b=new THREE.Mesh(m,j);b.position.set(0,10,0);this.animation=e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=
e(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&d(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(n,p){return function(){p.apply(n,arguments)}}(this,this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function e(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.005;this.dragToLook=!1;this.autoForward=!1;this.domElement=document;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==undefined)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==undefined)this.dragToLook=b.dragToLook;if(b.autoForward!==undefined)this.autoForward=
b.autoForward;if(b.domElement!==undefined)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var d=this.getContainerDimensions(),f=d.size[0]/2,g=d.size[1]/2;this.moveState.yawLeft=-(c.clientX-d.offset[0]-f)/f;this.moveState.pitchDown=(c.clientY-
d.offset[1]-g)/g;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var d=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*d,this.rotationVector.y*d,this.rotationVector.z*d,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",e(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",e(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",e(this,this.mouseup),!1);window.addEventListener("keydown",e(this,this.keydown),!1);window.addEventListener("keyup",e(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,e,c,d){THREE.Camera.call(this,b,e,c,d);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.useTarget=!1;this.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var f=new THREE.Vector3,g=new THREE.Vector3,j=new THREE.Vector3,h=new THREE.Matrix4,m=!1,n=1,p=0,t=0,v=0,u=0,w=0,z=window.innerWidth/2,y=window.innerHeight/2;this.update=
function(){var A=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=A;this.delta=(A-this.lastUpdate)/1E3;this.lastUpdate=A;if(this.mouseLook){A=this.delta*this.lookSpeed;this.rotateHorizontally(A*u);this.rotateVertically(A*w)}A=this.delta*this.movementSpeed;this.translateZ(A*(p>0||this.autoForward&&!(p<0)?1:p));this.translateX(A*t);this.translateY(A*v);m&&(this.roll+=this.rollSpeed*this.delta*n);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}j.copy(this.forward);g.set(0,1,0);f.cross(g,j).normalize();g.cross(j,f).normalize();this.matrix.n11=f.x;this.matrix.n12=g.x;this.matrix.n13=j.x;this.matrix.n21=f.y;this.matrix.n22=g.y;this.matrix.n23=j.y;this.matrix.n31=f.z;this.matrix.n32=g.z;this.matrix.n33=j.z;h.identity();h.n11=Math.cos(this.roll);h.n12=-Math.sin(this.roll);h.n21=Math.sin(this.roll);h.n22=Math.cos(this.roll);this.matrix.multiplySelf(h);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(A){this.position.x+=this.matrix.n11*A;this.position.y+=this.matrix.n21*A;this.position.z+=this.matrix.n31*A};this.translateY=function(A){this.position.x+=this.matrix.n12*A;this.position.y+=this.matrix.n22*A;this.position.z+=this.matrix.n32*A};this.translateZ=function(A){this.position.x-=this.matrix.n13*A;this.position.y-=
this.matrix.n23*A;this.position.z-=this.matrix.n33*A};this.rotateHorizontally=function(A){f.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);f.multiplyScalar(A);this.forward.subSelf(f);this.forward.normalize()};this.rotateVertically=function(A){g.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);g.multiplyScalar(A);this.forward.addSelf(g);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(A){A.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(A){u=(A.clientX-z)/window.innerWidth;w=(A.clientY-y)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(A){A.preventDefault();A.stopPropagation();switch(A.button){case 0:p=1;break;case 2:p=-1}},!1);this.domElement.addEventListener("mouseup",function(A){A.preventDefault();A.stopPropagation();switch(A.button){case 0:p=0;break;case 2:p=0}},!1);this.domElement.addEventListener("keydown",function(A){switch(A.keyCode){case 38:case 87:p=1;break;case 37:case 65:t=-1;break;
case 40:case 83:p=-1;break;case 39:case 68:t=1;break;case 81:m=!0;n=1;break;case 69:m=!0;n=-1;break;case 82:v=1;break;case 70:v=-1}},!1);this.domElement.addEventListener("keyup",function(A){switch(A.keyCode){case 38:case 87:p=0;break;case 37:case 65:t=0;break;case 40:case 83:p=0;break;case 39:case 68:t=0;break;case 81:m=!1;break;case 69:m=!1;break;case 82:v=0;break;case 70:v=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.Cube=function(b,e,c,d,f,g,j,h,m){function n(y,A,E,B,I,D,C,K){var N,L,Q=d||1,ea=f||1,o=I/2,oa=D/2,ha=p.vertices.length;if(y=="x"&&A=="y"||y=="y"&&A=="x")N="z";else if(y=="x"&&A=="z"||y=="z"&&A=="x"){N="y";ea=g||1}else if(y=="z"&&A=="y"||y=="y"&&A=="z"){N="x";Q=g||1}var sa=Q+1,ka=ea+1;I/=Q;var U=D/ea;for(L=0;L<ka;L++)for(D=0;D<sa;D++){var ma=new THREE.Vector3;ma[y]=(D*I-o)*E;ma[A]=(L*U-oa)*B;ma[N]=C;p.vertices.push(new THREE.Vertex(ma))}for(L=0;L<ea;L++)for(D=0;D<Q;D++){p.faces.push(new THREE.Face4(D+
sa*L+ha,D+sa*(L+1)+ha,D+1+sa*(L+1)+ha,D+1+sa*L+ha,null,null,K));p.faceVertexUvs[0].push([new THREE.UV(D/Q,L/ea),new THREE.UV(D/Q,(L+1)/ea),new THREE.UV((D+1)/Q,(L+1)/ea),new THREE.UV((D+1)/Q,L/ea)])}}THREE.Geometry.call(this);var p=this,t=b/2,v=e/2,u=c/2;h=h?-1:1;if(j!==undefined)if(j instanceof Array)this.materials=j;else{this.materials=[];for(var w=0;w<6;w++)this.materials.push([j])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(m!=undefined)for(var z in m)this.sides[z]!=
undefined&&(this.sides[z]=m[z]);this.sides.px&&n("z","y",1*h,-1,c,e,-t,this.materials[0]);this.sides.nx&&n("z","y",-1*h,-1,c,e,t,this.materials[1]);this.sides.py&&n("x","z",1*h,1,b,c,v,this.materials[2]);this.sides.ny&&n("x","z",1*h,-1,b,c,-v,this.materials[3]);this.sides.pz&&n("x","y",1*h,-1,b,e,u,this.materials[4]);this.sides.nz&&n("x","y",-1*h,-1,b,e,-u,this.materials[5]);(function(){for(var y=[],A=[],E=0,B=p.vertices.length;E<B;E++){for(var I=p.vertices[E],D=!1,C=0,K=y.length;C<K;C++){var N=y[C];
if(I.position.x==N.position.x&&I.position.y==N.position.y&&I.position.z==N.position.z){A[E]=C;D=!0;break}}if(!D){A[E]=y.length;y.push(new THREE.Vertex(I.position.clone()))}}E=0;for(B=p.faces.length;E<B;E++){I=p.faces[E];I.a=A[I.a];I.b=A[I.b];I.c=A[I.c];I.d=A[I.d]}p.vertices=y})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,e,c,d,f,g){function j(v,u,w){h.vertices.push(new THREE.Vertex(new THREE.Vector3(v,u,w)))}THREE.Geometry.call(this);var h=this,m,n=Math.PI*2,p=d/2;for(m=0;m<b;m++)j(Math.sin(n*m/b)*e,Math.cos(n*m/b)*e,-p);for(m=0;m<b;m++)j(Math.sin(n*m/b)*c,Math.cos(n*m/b)*c,p);for(m=0;m<b;m++)h.faces.push(new THREE.Face4(m,m+b,b+(m+1)%b,(m+1)%b));if(c>0){j(0,0,-p-(g||0));for(m=b;m<b+b/2;m++)h.faces.push(new THREE.Face4(2*b,(2*m-2*b)%b,(2*m-2*b+1)%b,(2*m-2*b+2)%b))}if(e>0){j(0,0,p+(f||0));
for(m=b+b/2;m<2*b;m++)h.faces.push(new THREE.Face4(2*b+1,(2*m-2*b+2)%b+b,(2*m-2*b+1)%b+b,(2*m-2*b)%b+b))}m=0;for(b=this.faces.length;m<b;m++){e=[];c=this.faces[m];f=this.vertices[c.a];g=this.vertices[c.b];p=this.vertices[c.c];var t=this.vertices[c.d];e.push(new THREE.UV(0.5+Math.atan2(f.position.x,f.position.y)/n,0.5+f.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/n,0.5+g.position.z/d));e.push(new THREE.UV(0.5+Math.atan2(p.position.x,p.position.y)/n,0.5+p.position.z/
d));c instanceof THREE.Face4&&e.push(new THREE.UV(0.5+Math.atan2(t.position.x,t.position.y)/n,0.5+t.position.z/d));this.faceVertexUvs[0].push(e)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function e(t,v,u){var w=Math.sqrt(t*t+v*v+u*u);return f.vertices.push(new THREE.Vertex(new THREE.Vector3(t/w,v/w,u/w)))-1}function c(t,v,u,w){w.faces.push(new THREE.Face3(t,v,u))}function d(t,v){var u=f.vertices[t].position,w=f.vertices[v].position;return e((u.x+w.x)/2,(u.y+w.y)/2,(u.z+w.z)/2)}var f=this,g=new THREE.Geometry,j;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;e(-1,b,0);e(1,b,0);e(-1,-b,0);e(1,-b,0);e(0,-1,b);e(0,1,b);e(0,-1,-b);e(0,
1,-b);e(b,0,-1);e(b,0,1);e(-b,0,-1);e(-b,0,1);c(0,11,5,g);c(0,5,1,g);c(0,1,7,g);c(0,7,10,g);c(0,10,11,g);c(1,5,9,g);c(5,11,4,g);c(11,10,2,g);c(10,7,6,g);c(7,1,8,g);c(3,9,4,g);c(3,4,2,g);c(3,2,6,g);c(3,6,8,g);c(3,8,9,g);c(4,9,5,g);c(2,4,11,g);c(6,2,10,g);c(8,6,7,g);c(9,8,1,g);for(b=0;b<this.subdivisions;b++){j=new THREE.Geometry;for(var h in g.faces){var m=d(g.faces[h].a,g.faces[h].b),n=d(g.faces[h].b,g.faces[h].c),p=d(g.faces[h].c,g.faces[h].a);c(g.faces[h].a,m,p,j);c(g.faces[h].b,n,m,j);c(g.faces[h].c,
p,n,j);c(m,n,p,j)}g.faces=j.faces}f.faces=g.faces;delete g;delete j;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,e,c){THREE.Geometry.call(this);this.steps=e||12;this.angle=c||2*Math.PI;e=this.angle/this.steps;c=[];for(var d=[],f=[],g=[],j=(new THREE.Matrix4).setRotationZ(e),h=0;h<b.length;h++){this.vertices.push(new THREE.Vertex(b[h]));c[h]=b[h].clone();d[h]=this.vertices.length-1}for(var m=0;m<=this.angle+0.001;m+=e){for(h=0;h<c.length;h++)if(m<this.angle){c[h]=j.multiplyVector3(c[h].clone());this.vertices.push(new THREE.Vertex(c[h]));f[h]=this.vertices.length-1}else f=g;m==0&&(g=d);
for(h=0;h<d.length-1;h++){this.faces.push(new THREE.Face4(f[h],f[h+1],d[h+1],d[h]));this.faceVertexUvs[0].push([new THREE.UV(1-m/this.angle,h/b.length),new THREE.UV(1-m/this.angle,(h+1)/b.length),new THREE.UV(1-(m-e)/this.angle,(h+1)/b.length),new THREE.UV(1-(m-e)/this.angle,h/b.length)])}d=f;f=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,e,c,d){THREE.Geometry.call(this);var f,g=b/2,j=e/2;c=c||1;d=d||1;var h=c+1,m=d+1;b/=c;var n=e/d;for(f=0;f<m;f++)for(e=0;e<h;e++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(e*b-g,-(f*n-j),0)));for(f=0;f<d;f++)for(e=0;e<c;e++){this.faces.push(new THREE.Face4(e+h*f,e+h*(f+1),e+1+h*(f+1),e+1+h*f));this.faceVertexUvs[0].push([new THREE.UV(e/c,f/d),new THREE.UV(e/c,(f+1)/d),new THREE.UV((e+1)/c,(f+1)/d),new THREE.UV((e+1)/c,f/d)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,e,c){THREE.Geometry.call(this);var d,f=Math.PI,g=Math.max(3,e||8),j=Math.max(2,c||6);e=[];for(c=0;c<j+1;c++){d=c/j;var h=b*Math.cos(d*f),m=b*Math.sin(d*f),n=[],p=0;for(d=0;d<g;d++){var t=2*d/g,v=m*Math.sin(t*f);t=m*Math.cos(t*f);(c==0||c==j)&&d>0||(p=this.vertices.push(new THREE.Vertex(new THREE.Vector3(t,h,v)))-1);n.push(p)}e.push(n)}var u,w,z;f=e.length;for(c=0;c<f;c++){g=e[c].length;if(c>0)for(d=0;d<g;d++){n=d==g-1;j=e[c][n?0:d+1];h=e[c][n?g-1:d];m=e[c-1][n?g-1:d];n=e[c-
1][n?0:d+1];v=c/(f-1);u=(c-1)/(f-1);w=(d+1)/g;t=d/g;p=new THREE.UV(1-w,v);v=new THREE.UV(1-t,v);t=new THREE.UV(1-t,u);var y=new THREE.UV(1-w,u);if(c<e.length-1){u=this.vertices[j].position.clone();w=this.vertices[h].position.clone();z=this.vertices[m].position.clone();u.normalize();w.normalize();z.normalize();this.faces.push(new THREE.Face3(j,h,m,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(z.x,z.y,z.z)]));this.faceVertexUvs[0].push([p,v,t])}if(c>1){u=this.vertices[j].position.clone();
w=this.vertices[m].position.clone();z=this.vertices[n].position.clone();u.normalize();w.normalize();z.normalize();this.faces.push(new THREE.Face3(j,m,n,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(z.x,z.y,z.z)]));this.faceVertexUvs[0].push([p,t,y])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,e,c,d){THREE.Geometry.call(this);this.radius=b||100;this.tube=e||40;this.segmentsR=c||8;this.segmentsT=d||6;b=[];for(e=0;e<=this.segmentsR;++e)for(c=0;c<=this.segmentsT;++c){d=c/this.segmentsT*2*Math.PI;var f=e/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(f))*Math.cos(d),(this.radius+this.tube*Math.cos(f))*Math.sin(d),this.tube*Math.sin(f))));b.push([c/this.segmentsT,1-e/this.segmentsR])}for(e=1;e<=this.segmentsR;++e)for(c=
1;c<=this.segmentsT;++c){d=(this.segmentsT+1)*e+c;f=(this.segmentsT+1)*e+c-1;var g=(this.segmentsT+1)*(e-1)+c-1,j=(this.segmentsT+1)*(e-1)+c;this.faces.push(new THREE.Face4(d,f,g,j));this.faceVertexUvs[0].push([new THREE.UV(b[d][0],b[d][1]),new THREE.UV(b[f][0],b[f][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[j][0],b[j][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,e,c,d,f,g,j){function h(t,v,u,w,z,y){v=u/w*t;u=Math.cos(v);return new THREE.Vector3(z*(2+u)*0.5*Math.cos(t),z*(2+u)*Math.sin(t)*0.5,y*z*Math.sin(v)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=e||40;this.segmentsR=c||64;this.segmentsT=d||8;this.p=f||2;this.q=g||3;this.heightScale=j||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;d=new THREE.Vector3;g=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(e=0;e<this.segmentsT;++e){var m=
b/this.segmentsR*2*this.p*Math.PI;j=e/this.segmentsT*2*Math.PI;f=h(m,j,this.q,this.p,this.radius,this.heightScale);m=h(m+0.01,j,this.q,this.p,this.radius,this.heightScale);c.x=m.x-f.x;c.y=m.y-f.y;c.z=m.z-f.z;d.x=m.x+f.x;d.y=m.y+f.y;d.z=m.z+f.z;g.cross(c,d);d.cross(g,c);g.normalize();d.normalize();m=-this.tube*Math.cos(j);j=this.tube*Math.sin(j);f.x+=m*d.x+j*g.x;f.y+=m*d.y+j*g.y;f.z+=m*d.z+j*g.z;this.grid[b][e]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(f.x,f.y,f.z)))-1}}for(b=0;b<this.segmentsR;++b)for(e=
0;e<this.segmentsT;++e){d=(b+1)%this.segmentsR;g=(e+1)%this.segmentsT;f=this.grid[b][e];c=this.grid[d][e];d=this.grid[d][g];g=this.grid[b][g];j=new THREE.UV(b/this.segmentsR,e/this.segmentsT);m=new THREE.UV((b+1)/this.segmentsR,e/this.segmentsT);var n=new THREE.UV((b+1)/this.segmentsR,(e+1)/this.segmentsT),p=new THREE.UV(b/this.segmentsR,(e+1)/this.segmentsT);this.faces.push(new THREE.Face4(f,c,d,g));this.faceVertexUvs[0].push([j,m,n,p])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var e="Loaded ";e+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=e},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,e,c){b.materials=[];for(var d=0;d<e.length;++d)b.materials[d]=[THREE.Loader.prototype.createMaterial(e[d],c)]},createMaterial:function(b,e){function c(h){h=Math.log(h)/Math.LN2;return Math.floor(h)==h}function d(h,m){var n=new Image;n.onload=function(){if(!c(this.width)||!c(this.height)){var p=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),t=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));h.image.width=p;h.image.height=t;h.image.getContext("2d").drawImage(this,0,0,p,t)}else h.image=this;h.needsUpdate=!0};n.src=m}var f,g,j;f="MeshLambertMaterial";g={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};if(b.shading)if(b.shading=="Phong")f="MeshPhongMaterial";else b.shading=="Basic"&&(f="MeshBasicMaterial");if(b.blending)if(b.blending=="Additive")g.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")g.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")g.blending=THREE.MultiplyBlending;if(b.transparent!==undefined||b.opacity<1)g.transparent=b.transparent;if(b.depthTest!==undefined)g.depthTest=b.depthTest;if(b.vertexColors!==undefined)if(b.vertexColors=="face")g.vertexColors=THREE.FaceColors;else if(b.vertexColors)g.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&e){j=document.createElement("canvas");g.map=new THREE.Texture(j);g.map.sourceFile=b.mapDiffuse;d(g.map,e+"/"+b.mapDiffuse)}else if(b.colorDiffuse){j=(b.colorDiffuse[0]*255<<
16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255;g.color=j;g.opacity=b.transparency}else if(b.DbgColor)g.color=b.DbgColor;if(b.mapLightmap&&e){j=document.createElement("canvas");g.lightMap=new THREE.Texture(j);g.lightMap.sourceFile=b.mapLightmap;d(g.lightMap,e+"/"+b.mapLightmap)}return new THREE[f](g)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var e=this,c=b.model,d=b.callback,f=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(g){e.createModel(g.data,d,f);e.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,e,c){var d=new THREE.Geometry,f=b.scale!==undefined?b.scale:1;this.init_materials(d,b.materials,c);(function(g){if(b.version===undefined||b.version!=2)console.error("Deprecated file format.");else{var j,h,m,n,p,t,v,u,w,z,y,A,E,B,I=b.faces;t=b.vertices;var D=b.normals,C=b.colors,K=0;for(j=0;j<b.uvs.length;j++)b.uvs[j].length&&K++;for(j=0;j<K;j++){d.faceUvs[j]=[];d.faceVertexUvs[j]=[]}n=0;for(p=t.length;n<p;){v=new THREE.Vertex;v.position.x=t[n++]/g;
v.position.y=t[n++]/g;v.position.z=t[n++]/g;d.vertices.push(v)}n=0;for(p=I.length;n<p;){g=I[n++];t=g&1;m=g&2;j=g&4;h=g&8;u=g&16;v=g&32;z=g&64;g&=128;if(t){y=new THREE.Face4;y.a=I[n++];y.b=I[n++];y.c=I[n++];y.d=I[n++];t=4}else{y=new THREE.Face3;y.a=I[n++];y.b=I[n++];y.c=I[n++];t=3}if(m){m=I[n++];y.materials=d.materials[m]}m=d.faces.length;if(j)for(j=0;j<K;j++){A=b.uvs[j];w=I[n++];B=A[w*2];w=A[w*2+1];d.faceUvs[j][m]=new THREE.UV(B,w)}if(h)for(j=0;j<K;j++){A=b.uvs[j];E=[];for(h=0;h<t;h++){w=I[n++];B=
A[w*2];w=A[w*2+1];E[h]=new THREE.UV(B,w)}d.faceVertexUvs[j][m]=E}if(u){u=I[n++]*3;h=new THREE.Vector3;h.x=D[u++];h.y=D[u++];h.z=D[u];y.normal=h}if(v)for(j=0;j<t;j++){u=I[n++]*3;h=new THREE.Vector3;h.x=D[u++];h.y=D[u++];h.z=D[u];y.vertexNormals.push(h)}if(z){v=I[n++];v=new THREE.Color(C[v]);y.color=v}if(g)for(j=0;j<t;j++){v=I[n++];v=new THREE.Color(C[v]);y.vertexColors.push(v)}d.faces.push(y)}}})(f);(function(){var g,j,h,m;if(b.skinWeights){g=0;for(j=b.skinWeights.length;g<j;g+=2){h=b.skinWeights[g];
m=b.skinWeights[g+1];d.skinWeights.push(new THREE.Vector4(h,m,0,0))}}if(b.skinIndices){g=0;for(j=b.skinIndices.length;g<j;g+=2){h=b.skinIndices[g];m=b.skinIndices[g+1];d.skinIndices.push(new THREE.Vector4(h,m,0,0))}}d.bones=b.bones;d.animation=b.animation})();(function(g){if(b.morphTargets!==undefined){var j,h,m,n,p,t,v,u,w;j=0;for(h=b.morphTargets.length;j<h;j++){d.morphTargets[j]={};d.morphTargets[j].name=b.morphTargets[j].name;d.morphTargets[j].vertices=[];u=d.morphTargets[j].vertices;w=b.morphTargets[j].vertices;
m=0;for(n=w.length;m<n;m+=3){p=w[m]/g;t=w[m+1]/g;v=w[m+2]/g;u.push(new THREE.Vertex(new THREE.Vector3(p,t,v)))}}}if(b.morphColors!==undefined){j=0;for(h=b.morphColors.length;j<h;j++){d.morphColors[j]={};d.morphColors[j].name=b.morphColors[j].name;d.morphColors[j].colors=[];n=d.morphColors[j].colors;p=b.morphColors[j].colors;g=0;for(m=p.length;g<m;g+=3){t=new THREE.Color(16755200);t.setRGB(p[g],p[g+1],p[g+2]);n.push(t)}}}})(f);(function(){if(b.edges!==undefined){var g,j,h;for(g=0;g<b.edges.length;g+=
2){j=b.edges[g];h=b.edges[g+1];d.edges.push(new THREE.Edge(d.vertices[j],d.vertices[h],j,h))}}})();d.computeFaceNormals();e(d)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var e=b.model,c=b.callback,d=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(e),f=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(e);b=(new Date).getTime();e=new Worker(e);var g=this.showProgress?THREE.Loader.prototype.updateProgress:null;e.onmessage=function(j){THREE.BinaryLoader.prototype.loadAjaxBuffers(j.data.buffers,j.data.materials,c,f,d,g)};e.onerror=function(j){alert("worker.onerror: "+j.message+"\n"+j.data);j.preventDefault()};
e.postMessage(b)},loadAjaxBuffers:function(b,e,c,d,f,g){var j=new XMLHttpRequest,h=d+"/"+b,m=0;j.onreadystatechange=function(){if(j.readyState==4)j.status==200||j.status==0?THREE.BinaryLoader.prototype.createBinModel(j.responseText,c,f,e):alert("Couldn't load ["+h+"] ["+j.status+"]");else if(j.readyState==3){if(g){m==0&&(m=j.getResponseHeader("Content-Length"));g({total:m,loaded:j.responseText.length})}}else j.readyState==2&&(m=j.getResponseHeader("Content-Length"))};j.open("GET",h,!0);j.overrideMimeType("text/plain; charset=x-user-defined");
j.setRequestHeader("Content-Type","text/plain");j.send(null)},createBinModel:function(b,e,c,d){var f=function(g){function j(V,ra){var aa=p(V,ra),Z=p(V,ra+1),Pa=p(V,ra+2),eb=p(V,ra+3),x=(eb<<1&255|Pa>>7)-127;aa|=(Pa&127)<<16|Z<<8;if(aa==0&&x==-127)return 0;return(1-2*(eb>>7))*(1+aa*Math.pow(2,-23))*Math.pow(2,x)}function h(V,ra){var aa=p(V,ra),Z=p(V,ra+1),Pa=p(V,ra+2);return(p(V,ra+3)<<24)+(Pa<<16)+(Z<<8)+aa}function m(V,ra){var aa=p(V,ra);return(p(V,ra+1)<<8)+aa}function n(V,ra){var aa=p(V,ra);return aa>
127?aa-256:aa}function p(V,ra){return V.charCodeAt(ra)&255}function t(V){var ra,aa,Z;ra=h(b,V);aa=h(b,V+C);Z=h(b,V+K);V=m(b,V+N);THREE.BinaryLoader.prototype.f3(A,ra,aa,Z,V)}function v(V){var ra,aa,Z,Pa,eb,x;ra=h(b,V);aa=h(b,V+C);Z=h(b,V+K);Pa=m(b,V+N);eb=h(b,V+L);x=h(b,V+Q);V=h(b,V+ea);THREE.BinaryLoader.prototype.f3n(A,I,ra,aa,Z,Pa,eb,x,V)}function u(V){var ra,aa,Z,Pa;ra=h(b,V);aa=h(b,V+o);Z=h(b,V+oa);Pa=h(b,V+ha);V=m(b,V+sa);THREE.BinaryLoader.prototype.f4(A,ra,aa,Z,Pa,V)}function w(V){var ra,
aa,Z,Pa,eb,x,M,F;ra=h(b,V);aa=h(b,V+o);Z=h(b,V+oa);Pa=h(b,V+ha);eb=m(b,V+sa);x=h(b,V+ka);M=h(b,V+U);F=h(b,V+ma);V=h(b,V+qa);THREE.BinaryLoader.prototype.f4n(A,I,ra,aa,Z,Pa,eb,x,M,F,V)}function z(V){var ra,aa;ra=h(b,V);aa=h(b,V+va);V=h(b,V+fa);THREE.BinaryLoader.prototype.uv3(A.faceVertexUvs[0],D[ra*2],D[ra*2+1],D[aa*2],D[aa*2+1],D[V*2],D[V*2+1])}function y(V){var ra,aa,Z;ra=h(b,V);aa=h(b,V+ta);Z=h(b,V+za);V=h(b,V+ca);THREE.BinaryLoader.prototype.uv4(A.faceVertexUvs[0],D[ra*2],D[ra*2+1],D[aa*2],D[aa*
2+1],D[Z*2],D[Z*2+1],D[V*2],D[V*2+1])}var A=this,E=0,B,I=[],D=[],C,K,N,L,Q,ea,o,oa,ha,sa,ka,U,ma,qa,va,fa,ta,za,ca,$,ia,Aa,Ka,Ba,Ea;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(A,d,g);B={signature:b.substr(E,8),header_bytes:p(b,E+8),vertex_coordinate_bytes:p(b,E+9),normal_coordinate_bytes:p(b,E+10),uv_coordinate_bytes:p(b,E+11),vertex_index_bytes:p(b,E+12),normal_index_bytes:p(b,E+13),uv_index_bytes:p(b,E+14),material_index_bytes:p(b,E+15),nvertices:h(b,E+16),nnormals:h(b,E+16+
4),nuvs:h(b,E+16+8),ntri_flat:h(b,E+16+12),ntri_smooth:h(b,E+16+16),ntri_flat_uv:h(b,E+16+20),ntri_smooth_uv:h(b,E+16+24),nquad_flat:h(b,E+16+28),nquad_smooth:h(b,E+16+32),nquad_flat_uv:h(b,E+16+36),nquad_smooth_uv:h(b,E+16+40)};E+=B.header_bytes;C=B.vertex_index_bytes;K=B.vertex_index_bytes*2;N=B.vertex_index_bytes*3;L=B.vertex_index_bytes*3+B.material_index_bytes;Q=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes;ea=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*
2;o=B.vertex_index_bytes;oa=B.vertex_index_bytes*2;ha=B.vertex_index_bytes*3;sa=B.vertex_index_bytes*4;ka=B.vertex_index_bytes*4+B.material_index_bytes;U=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes;ma=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*2;qa=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*3;va=B.uv_index_bytes;fa=B.uv_index_bytes*2;ta=B.uv_index_bytes;za=B.uv_index_bytes*2;ca=B.uv_index_bytes*3;g=B.vertex_index_bytes*3+B.material_index_bytes;
Ea=B.vertex_index_bytes*4+B.material_index_bytes;$=B.ntri_flat*g;ia=B.ntri_smooth*(g+B.normal_index_bytes*3);Aa=B.ntri_flat_uv*(g+B.uv_index_bytes*3);Ka=B.ntri_smooth_uv*(g+B.normal_index_bytes*3+B.uv_index_bytes*3);Ba=B.nquad_flat*Ea;g=B.nquad_smooth*(Ea+B.normal_index_bytes*4);Ea=B.nquad_flat_uv*(Ea+B.uv_index_bytes*4);E+=function(V){for(var ra,aa,Z,Pa=B.vertex_coordinate_bytes*3,eb=V+B.nvertices*Pa;V<eb;V+=Pa){ra=j(b,V);aa=j(b,V+B.vertex_coordinate_bytes);Z=j(b,V+B.vertex_coordinate_bytes*2);THREE.BinaryLoader.prototype.v(A,
ra,aa,Z)}return B.nvertices*Pa}(E);E+=function(V){for(var ra,aa,Z,Pa=B.normal_coordinate_bytes*3,eb=V+B.nnormals*Pa;V<eb;V+=Pa){ra=n(b,V);aa=n(b,V+B.normal_coordinate_bytes);Z=n(b,V+B.normal_coordinate_bytes*2);I.push(ra/127,aa/127,Z/127)}return B.nnormals*Pa}(E);E+=function(V){for(var ra,aa,Z=B.uv_coordinate_bytes*2,Pa=V+B.nuvs*Z;V<Pa;V+=Z){ra=j(b,V);aa=j(b,V+B.uv_coordinate_bytes);D.push(ra,aa)}return B.nuvs*Z}(E);$=E+$;ia=$+ia;Aa=ia+Aa;Ka=Aa+Ka;Ba=Ka+Ba;g=Ba+g;Ea=g+Ea;(function(V){var ra,aa=B.vertex_index_bytes*
3+B.material_index_bytes,Z=aa+B.uv_index_bytes*3,Pa=V+B.ntri_flat_uv*Z;for(ra=V;ra<Pa;ra+=Z){t(ra);z(ra+aa)}return Pa-V})(ia);(function(V){var ra,aa=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*3,Z=aa+B.uv_index_bytes*3,Pa=V+B.ntri_smooth_uv*Z;for(ra=V;ra<Pa;ra+=Z){v(ra);z(ra+aa)}return Pa-V})(Aa);(function(V){var ra,aa=B.vertex_index_bytes*4+B.material_index_bytes,Z=aa+B.uv_index_bytes*4,Pa=V+B.nquad_flat_uv*Z;for(ra=V;ra<Pa;ra+=Z){u(ra);y(ra+aa)}return Pa-V})(g);(function(V){var ra,
aa=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*4,Z=aa+B.uv_index_bytes*4,Pa=V+B.nquad_smooth_uv*Z;for(ra=V;ra<Pa;ra+=Z){w(ra);y(ra+aa)}return Pa-V})(Ea);(function(V){var ra,aa=B.vertex_index_bytes*3+B.material_index_bytes,Z=V+B.ntri_flat*aa;for(ra=V;ra<Z;ra+=aa)t(ra);return Z-V})(E);(function(V){var ra,aa=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*3,Z=V+B.ntri_smooth*aa;for(ra=V;ra<Z;ra+=aa)v(ra);return Z-V})($);(function(V){var ra,aa=B.vertex_index_bytes*
4+B.material_index_bytes,Z=V+B.nquad_flat*aa;for(ra=V;ra<Z;ra+=aa)u(ra);return Z-V})(Ka);(function(V){var ra,aa=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*4,Z=V+B.nquad_smooth*aa;for(ra=V;ra<Z;ra+=aa)w(ra);return Z-V})(Ba);this.computeCentroids();this.computeFaceNormals()};f.prototype=new THREE.Geometry;f.prototype.constructor=f;e(new f(c))},v:function(b,e,c,d){b.vertices.push(new THREE.Vertex(new THREE.Vector3(e,c,d)))},f3:function(b,e,c,d,f){b.faces.push(new THREE.Face3(e,
c,d,null,null,b.materials[f]))},f4:function(b,e,c,d,f,g){b.faces.push(new THREE.Face4(e,c,d,f,null,null,b.materials[g]))},f3n:function(b,e,c,d,f,g,j,h,m){g=b.materials[g];var n=e[h*3],p=e[h*3+1];h=e[h*3+2];var t=e[m*3],v=e[m*3+1];m=e[m*3+2];b.faces.push(new THREE.Face3(c,d,f,[new THREE.Vector3(e[j*3],e[j*3+1],e[j*3+2]),new THREE.Vector3(n,p,h),new THREE.Vector3(t,v,m)],null,g))},f4n:function(b,e,c,d,f,g,j,h,m,n,p){j=b.materials[j];var t=e[m*3],v=e[m*3+1];m=e[m*3+2];var u=e[n*3],w=e[n*3+1];n=e[n*3+
2];var z=e[p*3],y=e[p*3+1];p=e[p*3+2];b.faces.push(new THREE.Face4(c,d,f,g,[new THREE.Vector3(e[h*3],e[h*3+1],e[h*3+2]),new THREE.Vector3(t,v,m),new THREE.Vector3(u,w,n),new THREE.Vector3(z,y,p)],null,j))},uv3:function(b,e,c,d,f,g,j){var h=[];h.push(new THREE.UV(e,c));h.push(new THREE.UV(d,f));h.push(new THREE.UV(g,j));b.push(h)},uv4:function(b,e,c,d,f,g,j,h,m){var n=[];n.push(new THREE.UV(e,c));n.push(new THREE.UV(d,f));n.push(new THREE.UV(g,j));n.push(new THREE.UV(h,m));b.push(n)}};
THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,e){var c=this,d=new Worker(b);d.postMessage(0);var f=THREE.Loader.prototype.extractUrlbase(b);d.onmessage=function(g){function j(va,fa){return fa=="relativeToHTML"?va:f+"/"+va}function h(){for(u in Q.objects)if(!ka.objects[u]){E=Q.objects[u];if(E.geometry!==undefined){if(C=ka.geometries[E.geometry]){L=[];for(qa=0;qa<E.materials.length;qa++)L[qa]=ka.materials[E.materials[qa]];B=E.position;r=E.rotation;q=E.quaternion;s=E.scale;q=0;L.length==0&&(L[0]=new THREE.MeshFaceMaterial);
L.length>1&&(L=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(C,L);object.name=u;object.position.set(B[0],B[1],B[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=E.visible;ka.scene.addObject(object);ka.objects[u]=object;if(E.meshCollider){var va=THREE.CollisionUtils.MeshColliderWBox(object);ka.scene.collisions.colliders.push(va)}if(E.castsShadow){va=new THREE.ShadowVolume(C);ka.scene.addChild(va);
va.position=object.position;va.rotation=object.rotation;va.scale=object.scale}if(E.trigger&&E.trigger.toLowerCase()!="none"){va={type:E.trigger,object:E};ka.triggers[object.name]=va}}}else{B=E.position;r=E.rotation;q=E.quaternion;s=E.scale;q=0;object=new THREE.Object3D;object.name=u;object.position.set(B[0],B[1],B[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=E.visible!==undefined?
E.visible:!1;ka.scene.addObject(object);ka.objects[u]=object;ka.empties[u]=object;if(E.trigger&&E.trigger.toLowerCase()!="none"){va={type:E.trigger,object:E};ka.triggers[object.name]=va}}}}function m(va){return function(fa){ka.geometries[va]=fa;h();o-=1;c.onLoadComplete();p()}}function n(va){return function(fa){ka.geometries[va]=fa}}function p(){c.callbackProgress({totalModels:ha,totalTextures:sa,loadedModels:ha-o,loadedTextures:sa-oa},ka);c.onLoadProgress();o==0&&oa==0&&e(ka)}var t,v,u,w,z,y,A,E,
B,I,D,C,K,N,L,Q,ea,o,oa,ha,sa,ka;Q=g.data;g=new THREE.BinaryLoader;ea=new THREE.JSONLoader;oa=o=0;ka={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var U=!1;for(u in Q.objects){E=Q.objects[u];if(E.meshCollider){U=!0;break}}if(U)ka.scene.collisions=new THREE.CollisionSystem;if(Q.transform){U=Q.transform.position;I=Q.transform.rotation;var ma=Q.transform.scale;U&&ka.scene.position.set(U[0],U[1],U[2]);I&&ka.scene.rotation.set(I[0],
I[1],I[2]);ma&&ka.scene.scale.set(ma[0],ma[1],ma[2]);(U||I||ma)&&ka.scene.updateMatrix()}U=function(){oa-=1;p();c.onLoadComplete()};for(z in Q.cameras){I=Q.cameras[z];if(I.type=="perspective")K=new THREE.Camera(I.fov,I.aspect,I.near,I.far);else if(I.type=="ortho"){K=new THREE.Camera;K.projectionMatrix=THREE.Matrix4.makeOrtho(I.left,I.right,I.top,I.bottom,I.near,I.far)}B=I.position;I=I.target;K.position.set(B[0],B[1],B[2]);K.target.position.set(I[0],I[1],I[2]);ka.cameras[z]=K}for(w in Q.lights){z=
Q.lights[w];K=z.color!==undefined?z.color:16777215;I=z.intensity!==undefined?z.intensity:1;if(z.type=="directional"){B=z.direction;light=new THREE.DirectionalLight(K,I);light.position.set(B[0],B[1],B[2]);light.position.normalize()}else if(z.type=="point"){B=z.position;light=new THREE.PointLight(K,I);light.position.set(B[0],B[1],B[2])}ka.scene.addLight(light);ka.lights[w]=light}for(y in Q.fogs){w=Q.fogs[y];if(w.type=="linear")N=new THREE.Fog(0,w.near,w.far);else w.type=="exp2"&&(N=new THREE.FogExp2(0,
w.density));I=w.color;N.color.setRGB(I[0],I[1],I[2]);ka.fogs[y]=N}if(ka.cameras&&Q.defaults.camera)ka.currentCamera=ka.cameras[Q.defaults.camera];if(ka.fogs&&Q.defaults.fog)ka.scene.fog=ka.fogs[Q.defaults.fog];I=Q.defaults.bgcolor;ka.bgColor=new THREE.Color;ka.bgColor.setRGB(I[0],I[1],I[2]);ka.bgColorAlpha=Q.defaults.bgalpha;for(t in Q.geometries){y=Q.geometries[t];if(y.type=="bin_mesh"||y.type=="ascii_mesh"){o+=1;c.onLoadStart()}}ha=o;for(t in Q.geometries){y=Q.geometries[t];if(y.type=="cube"){C=
new THREE.Cube(y.width,y.height,y.depth,y.segmentsWidth,y.segmentsHeight,y.segmentsDepth,null,y.flipped,y.sides);ka.geometries[t]=C}else if(y.type=="plane"){C=new THREE.Plane(y.width,y.height,y.segmentsWidth,y.segmentsHeight);ka.geometries[t]=C}else if(y.type=="sphere"){C=new THREE.Sphere(y.radius,y.segmentsWidth,y.segmentsHeight);ka.geometries[t]=C}else if(y.type=="cylinder"){C=new THREE.Cylinder(y.numSegs,y.topRad,y.botRad,y.height,y.topOffset,y.botOffset);ka.geometries[t]=C}else if(y.type=="torus"){C=
new THREE.Torus(y.radius,y.tube,y.segmentsR,y.segmentsT);ka.geometries[t]=C}else if(y.type=="icosahedron"){C=new THREE.Icosahedron(y.subdivisions);ka.geometries[t]=C}else if(y.type=="bin_mesh")g.load({model:j(y.url,Q.urlBaseType),callback:m(t)});else if(y.type=="ascii_mesh")ea.load({model:j(y.url,Q.urlBaseType),callback:m(t)});else y.type=="embedded_mesh"&&(y=Q.embeds[y.id])&&ea.createModel(y,n(t),"")}for(A in Q.textures){t=Q.textures[A];if(t.url instanceof Array){oa+=t.url.length;for(g=0;g<t.url.length;g++)c.onLoadStart()}else{oa+=
1;c.onLoadStart()}}sa=oa;for(A in Q.textures){t=Q.textures[A];if(t.mapping!=undefined&&THREE[t.mapping]!=undefined)t.mapping=new THREE[t.mapping];if(t.url instanceof Array){g=[];for(var qa=0;qa<t.url.length;qa++)g[qa]=j(t.url[qa],Q.urlBaseType);g=THREE.ImageUtils.loadTextureCube(g,t.mapping,U)}else{g=THREE.ImageUtils.loadTexture(j(t.url,Q.urlBaseType),t.mapping,U);if(THREE[t.minFilter]!=undefined)g.minFilter=THREE[t.minFilter];if(THREE[t.magFilter]!=undefined)g.magFilter=THREE[t.magFilter]}ka.textures[A]=
g}for(v in Q.materials){A=Q.materials[v];for(D in A.parameters)if(D=="envMap"||D=="map"||D=="lightMap")A.parameters[D]=ka.textures[A.parameters[D]];else if(D=="shading")A.parameters[D]=A.parameters[D]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(D=="blending")A.parameters[D]=THREE[A.parameters[D]]?THREE[A.parameters[D]]:THREE.NormalBlending;else if(D=="combine")A.parameters[D]=A.parameters[D]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(D=="vertexColors")if(A.parameters[D]==
"face")A.parameters[D]=THREE.FaceColors;else if(A.parameters[D])A.parameters[D]=THREE.VertexColors;if(A.parameters.opacity!==undefined&&A.parameters.opacity<1)A.parameters.transparent=!0;A=new THREE[A.type](A.parameters);ka.materials[v]=A}h();c.callbackSync(ka)}}};
THREE.MarchingCubes=function(b,e){THREE.Object3D.call(this);this.materials=e instanceof Array?e:[e];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasPos=!1;this.hasNormal=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,d,f){return c+(d-c)*f};this.VIntX=function(c,d,f,g,j,h,m,n,p,t){j=(j-p)/(t-p);p=this.normal_cache;d[g]=h+j*this.delta;d[g+1]=m;d[g+2]=n;f[g]=this.lerp(p[c],p[c+3],j);f[g+1]=this.lerp(p[c+1],p[c+4],j);f[g+2]=this.lerp(p[c+2],p[c+5],j)};this.VIntY=function(c,d,f,g,j,h,m,n,p,t){j=(j-p)/(t-p);p=this.normal_cache;d[g]=h;d[g+1]=m+j*this.delta;d[g+
2]=n;d=c+this.yd*3;f[g]=this.lerp(p[c],p[d],j);f[g+1]=this.lerp(p[c+1],p[d+1],j);f[g+2]=this.lerp(p[c+2],p[d+2],j)};this.VIntZ=function(c,d,f,g,j,h,m,n,p,t){j=(j-p)/(t-p);p=this.normal_cache;d[g]=h;d[g+1]=m;d[g+2]=n+j*this.delta;d=c+this.zd*3;f[g]=this.lerp(p[c],p[d],j);f[g+1]=this.lerp(p[c+1],p[d+1],j);f[g+2]=this.lerp(p[c+2],p[d+2],j)};this.compNorm=function(c){var d=c*3;if(this.normal_cache[d]==0){this.normal_cache[d]=this.field[c-1]-this.field[c+1];this.normal_cache[d+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[d+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,d,f,g,j,h){var m=g+1,n=g+this.yd,p=g+this.zd,t=m+this.yd,v=m+this.zd,u=g+this.yd+this.zd,w=m+this.yd+this.zd,z=0,y=this.field[g],A=this.field[m],E=this.field[n],B=this.field[t],I=this.field[p],D=this.field[v],C=this.field[u],K=this.field[w];y<j&&(z|=1);A<j&&(z|=2);E<j&&(z|=8);B<j&&(z|=4);I<j&&(z|=16);D<j&&(z|=32);C<j&&(z|=128);K<j&&(z|=64);var N=THREE.edgeTable[z];if(N==0)return 0;
var L=this.delta,Q=c+L,ea=d+L;L=f+L;if(N&1){this.compNorm(g);this.compNorm(m);this.VIntX(g*3,this.vlist,this.nlist,0,j,c,d,f,y,A)}if(N&2){this.compNorm(m);this.compNorm(t);this.VIntY(m*3,this.vlist,this.nlist,3,j,Q,d,f,A,B)}if(N&4){this.compNorm(n);this.compNorm(t);this.VIntX(n*3,this.vlist,this.nlist,6,j,c,ea,f,E,B)}if(N&8){this.compNorm(g);this.compNorm(n);this.VIntY(g*3,this.vlist,this.nlist,9,j,c,d,f,y,E)}if(N&16){this.compNorm(p);this.compNorm(v);this.VIntX(p*3,this.vlist,this.nlist,12,j,c,d,
L,I,D)}if(N&32){this.compNorm(v);this.compNorm(w);this.VIntY(v*3,this.vlist,this.nlist,15,j,Q,d,L,D,K)}if(N&64){this.compNorm(u);this.compNorm(w);this.VIntX(u*3,this.vlist,this.nlist,18,j,c,ea,L,C,K)}if(N&128){this.compNorm(p);this.compNorm(u);this.VIntY(p*3,this.vlist,this.nlist,21,j,c,d,L,I,C)}if(N&256){this.compNorm(g);this.compNorm(p);this.VIntZ(g*3,this.vlist,this.nlist,24,j,c,d,f,y,I)}if(N&512){this.compNorm(m);this.compNorm(v);this.VIntZ(m*3,this.vlist,this.nlist,27,j,Q,d,f,A,D)}if(N&1024){this.compNorm(t);
this.compNorm(w);this.VIntZ(t*3,this.vlist,this.nlist,30,j,Q,ea,f,B,K)}if(N&2048){this.compNorm(n);this.compNorm(u);this.VIntZ(n*3,this.vlist,this.nlist,33,j,c,ea,f,E,C)}z<<=4;for(j=g=0;THREE.triTable[z+j]!=-1;){c=z+j;d=c+1;f=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[d],3*THREE.triTable[f],h);j+=3;g++}return g};this.posnormtriv=function(c,d,f,g,j,h){var m=this.count*3;this.positionArray[m]=c[f];this.positionArray[m+1]=c[f+1];this.positionArray[m+2]=c[f+2];this.positionArray[m+
3]=c[g];this.positionArray[m+4]=c[g+1];this.positionArray[m+5]=c[g+2];this.positionArray[m+6]=c[j];this.positionArray[m+7]=c[j+1];this.positionArray[m+8]=c[j+2];this.normalArray[m]=d[f];this.normalArray[m+1]=d[f+1];this.normalArray[m+2]=d[f+2];this.normalArray[m+3]=d[g];this.normalArray[m+4]=d[g+1];this.normalArray[m+5]=d[g+2];this.normalArray[m+6]=d[j];this.normalArray[m+7]=d[j+1];this.normalArray[m+8]=d[j+2];this.hasPos=!0;this.hasNormal=!0;this.count+=3;this.count>=this.maxCount-3&&h(this)};this.begin=
function(){this.count=0;this.hasPos=!1;this.hasNormal=!1};this.end=function(c){if(this.count!=0){for(var d=this.count*3;d<this.positionArray.length;d++)this.positionArray[d]=0;c(this)}};this.addBall=function(c,d,f,g,j){var h=this.size*Math.sqrt(g/j),m=f*this.size,n=d*this.size,p=c*this.size,t=Math.floor(m-h);t<1&&(t=1);m=Math.floor(m+h);m>this.size-1&&(m=this.size-1);var v=Math.floor(n-h);v<1&&(v=1);n=Math.floor(n+h);n>this.size-1&&(n=this.size-1);var u=Math.floor(p-h);u<1&&(u=1);h=Math.floor(p+h);
h>this.size-1&&(h=this.size-1);for(var w,z,y,A,E,B;t<m;t++){p=this.size2*t;z=t/this.size-f;E=z*z;for(z=v;z<n;z++){y=p+this.size*z;w=z/this.size-d;B=w*w;for(w=u;w<h;w++){A=w/this.size-c;A=g/(1.0E-6+A*A+B+E)-j;A>0&&(this.field[y+w]+=A)}}}};this.addPlaneX=function(c,d){var f,g,j,h,m,n=this.size,p=this.yd,t=this.zd,v=this.field,u=n*Math.sqrt(c/d);u>n&&(u=n);for(f=0;f<u;f++){g=f/n;g*=g;h=c/(1.0E-4+g)-d;if(h>0)for(g=0;g<n;g++){m=f+g*p;for(j=0;j<n;j++)v[t*j+m]+=h}}};this.addPlaneY=function(c,d){var f,g,
j,h,m,n,p=this.size,t=this.yd,v=this.zd,u=this.field,w=p*Math.sqrt(c/d);w>p&&(w=p);for(g=0;g<w;g++){f=g/p;f*=f;h=c/(1.0E-4+f)-d;if(h>0){m=g*t;for(f=0;f<p;f++){n=m+f;for(j=0;j<p;j++)u[v*j+n]+=h}}}};this.addPlaneZ=function(c,d){var f,g,j,h,m,n;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/d);dist>size&&(dist=size);for(j=0;j<dist;j++){f=j/size;f*=f;h=c/(1.0E-4+f)-d;if(h>0){m=zd*j;for(g=0;g<size;g++){n=m+g*yd;for(f=0;f<size;f++)field[n+f]+=h}}}};this.reset=function(){var c;
for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var d,f,g,j,h,m,n,p,t,v=this.size-2;for(j=1;j<v;j++){t=this.size2*j;n=(j-this.halfsize)/this.halfsize;for(g=1;g<v;g++){p=t+this.size*g;m=(g-this.halfsize)/this.halfsize;for(f=1;f<v;f++){h=(f-this.halfsize)/this.halfsize;d=p+f;this.polygonize(h,m,n,d,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,d=new THREE.Geometry,f=[];this.render(function(g){var j,h,m,n,p,t,v,u;for(j=
0;j<g.count;j++){v=j*3;p=v+1;u=v+2;h=g.positionArray[v];m=g.positionArray[p];n=g.positionArray[u];t=new THREE.Vector3(h,m,n);h=g.normalArray[v];m=g.normalArray[p];n=g.normalArray[u];v=new THREE.Vector3(h,m,n);v.normalize();p=new THREE.Vertex(t);d.vertices.push(p);f.push(v)}nfaces=g.count/3;for(j=0;j<nfaces;j++){v=(c+j)*3;p=v+1;u=v+2;t=f[v];h=f[p];m=f[u];v=new THREE.Face3(v,p,u,[t,h,m]);d.faces.push(v)}c+=nfaces;g.count=0});return d};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;
THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function e(g){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:g}))}function c(g,j){var h=new THREE.Geometry;h.vertices=[new THREE.Vertex,new THREE.Vertex(g)];return new THREE.Line(h,new THREE.LineBasicMaterial({color:j}))}THREE.Object3D.call(this);var d=Math.PI/2,f;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(f in THREE.Trident.defaultParams)b.hasOwnProperty(f)||(b[f]=THREE.Trident.defaultParams[f]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){f=e(b.xAxisColor);f.rotation.y=-d;f.position.x=b.length;this.addChild(f);f=e(b.yAxisColor);f.rotation.x=d;f.position.y=b.length;this.addChild(f);f=e(b.zAxisColor);f.rotation.y=Math.PI;f.position.z=b.length;this.addChild(f)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,e){this.point=b;this.normal=e};THREE.SphereCollider=function(b,e){this.center=b;this.radius=e;this.radiusSq=e*e};THREE.BoxCollider=function(b,e){this.min=b;this.max=e;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,e,c,d){this.vertices=b;this.faces=e;this.normals=c;this.box=d;this.numFaces=this.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var e,c,d,f,g=0;e=0;for(c=this.colliders.length;e<c;e++){f=this.colliders[e];d=this.rayCast(b,f);if(d<Number.MAX_VALUE){f.distance=d;d>g?this.hits.push(f):this.hits.unshift(f);g=d}}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var e=this.rayCastAll(b);if(e.length==0)return null;for(var c=0;e[c]instanceof THREE.MeshCollider;){var d=this.rayMesh(b,e[c]);if(d<Number.MAX_VALUE){e[c].distance=d;break}c++}if(c>e.length)return null;return e[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,e){if(e instanceof THREE.PlaneCollider)return this.rayPlane(b,e);else if(e instanceof THREE.SphereCollider)return this.raySphere(b,e);else if(e instanceof THREE.BoxCollider)return this.rayBox(b,e);else if(e instanceof THREE.MeshCollider&&e.box)return this.rayBox(b,e.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,e){for(var c=this.makeRayLocal(b,e.mesh),d=Number.MAX_VALUE,f=0;f<e.numFaces/3;f++){var g=f*3;g=this.rayTriangle(c,e.vertices[e.faces[g+0]],e.vertices[e.faces[g+1]],e.vertices[e.faces[g+2]],d,this.collisionNormal);if(g<d){d=g;e.normal.copy(this.collisionNormal);e.normal.normalize()}}return d};
THREE.CollisionSystem.prototype.rayTriangle=function(b,e,c,d,f,g){var j=THREE.CollisionSystem.__v1,h=THREE.CollisionSystem.__v2;g.set(0,0,0);j.sub(c,e);h.sub(d,c);g.cross(j,h);h=g.dot(b.direction);if(!(h<0))return Number.MAX_VALUE;j=g.dot(e)-g.dot(b.origin);if(!(j<=0))return Number.MAX_VALUE;if(!(j>=h*f))return Number.MAX_VALUE;j/=h;h=THREE.CollisionSystem.__v3;h.copy(b.direction);h.multiplyScalar(j);h.addSelf(b.origin);if(Math.abs(g.x)>Math.abs(g.y))if(Math.abs(g.x)>Math.abs(g.z)){b=h.y-e.y;g=c.y-
e.y;f=d.y-e.y;h=h.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=h.x-e.x;g=c.x-e.x;f=d.x-e.x;h=h.y-e.y;c=c.y-e.y;d=d.y-e.y}else if(Math.abs(g.y)>Math.abs(g.z)){b=h.x-e.x;g=c.x-e.x;f=d.x-e.x;h=h.z-e.z;c=c.z-e.z;d=d.z-e.z}else{b=h.x-e.x;g=c.x-e.x;f=d.x-e.x;h=h.y-e.y;c=c.y-e.y;d=d.y-e.y}e=g*d-c*f;if(e==0)return Number.MAX_VALUE;e=1/e;d=(b*d-h*f)*e;if(!(d>=0))return Number.MAX_VALUE;e*=g*h-c*b;if(!(e>=0))return Number.MAX_VALUE;if(!(1-d-e>=0))return Number.MAX_VALUE;return j};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,e){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(e.matrixWorld,c);var d=THREE.CollisionSystem.__r;d.origin.copy(b.origin);d.direction.copy(b.direction);c.multiplyVector3(d.origin);c.rotateAxis(d.direction);d.direction.normalize();return d};
THREE.CollisionSystem.prototype.rayBox=function(b,e){var c;if(e.dynamic&&e.mesh&&e.mesh.matrixWorld)c=this.makeRayLocal(b,e.mesh);else{c=THREE.CollisionSystem.__r;c.origin.copy(b.origin);c.direction.copy(b.direction)}var d=0,f=0,g=0,j=0,h=0,m=0,n=!0;if(c.origin.x<e.min.x){d=e.min.x-c.origin.x;d/=c.direction.x;n=!1;j=-1}else if(c.origin.x>e.max.x){d=e.max.x-c.origin.x;d/=c.direction.x;n=!1;j=1}if(c.origin.y<e.min.y){f=e.min.y-c.origin.y;f/=c.direction.y;n=!1;h=-1}else if(c.origin.y>e.max.y){f=e.max.y-
c.origin.y;f/=c.direction.y;n=!1;h=1}if(c.origin.z<e.min.z){g=e.min.z-c.origin.z;g/=c.direction.z;n=!1;m=-1}else if(c.origin.z>e.max.z){g=e.max.z-c.origin.z;g/=c.direction.z;n=!1;m=1}if(n)return-1;n=0;if(f>d){n=1;d=f}if(g>d){n=2;d=g}switch(n){case 0:h=c.origin.y+c.direction.y*d;if(h<e.min.y||h>e.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(j,0,0);break;case 1:j=c.origin.x+c.direction.x*d;if(j<e.min.x||j>e.max.x)return Number.MAX_VALUE;
c=c.origin.z+c.direction.z*d;if(c<e.min.z||c>e.max.z)return Number.MAX_VALUE;e.normal.set(0,h,0);break;case 2:j=c.origin.x+c.direction.x*d;if(j<e.min.x||j>e.max.x)return Number.MAX_VALUE;h=c.origin.y+c.direction.y*d;if(h<e.min.y||h>e.max.y)return Number.MAX_VALUE;e.normal.set(0,0,m)}return d};THREE.CollisionSystem.prototype.rayPlane=function(b,e){var c=b.direction.dot(e.normal),d=e.point.dot(e.normal);if(c<0)c=(d-b.origin.dot(e.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,e){var c=e.center.clone().subSelf(b.origin);if(c.lengthSq<e.radiusSq)return-1;var d=c.dot(b.direction.clone());if(d<=0)return Number.MAX_VALUE;c=e.radiusSq-(c.lengthSq()-d*d);if(c>=0)return Math.abs(d)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var e=b.geometry.boundingBox,c=new THREE.Vector3(e.x[0],e.y[0],e.z[0]);e=new THREE.Vector3(e.x[1],e.y[1],e.z[1]);c=new THREE.BoxCollider(c,e);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var e=THREE.CollisionUtils.MeshOBB(b);e.min.addSelf(b.position);e.max.addSelf(b.position);e.dynamic=!1;return e};
THREE.CollisionUtils.MeshColliderWBox=function(b){for(var e=b.geometry.vertices,c=e.length,d=b.geometry.faces,f=d.length,g=[],j=[],h=[],m=0;m<c;m++)g.push(new THREE.Vector3(e[m].position.x,e[m].position.y,e[m].position.z));for(m=0;m<f;m++){j.push(d[m].a,d[m].b,d[m].c);h.push(new THREE.Vector3(d[m].normal.x,d[m].normal.y,d[m].normal.z))}e=new THREE.MeshCollider(g,j,h,THREE.CollisionUtils.MeshOBB(b));e.mesh=b;return e};
var LoadingBar=function(b){function e(){var m=j/g;if(m>h){h=m;f.style.width=m*300+"px"}}var c,d,f,g=0,j=0,h=0;c=document.createElement("div");d=document.createElement("div");d.style.position="absolute";d.style.display="block";d.style.width="300px";d.style.height="8px";d.style.borderStyle="solid";d.style.borderColor="rgba(255,255,255,0.5)";d.style.borderWidth="1px";d.style.borderRadius="5px";c.appendChild(d);f=document.createElement("div");f.style.position="absolute";f.style.height="10px";f.style.width=
"0px";f.style.background="#fff";f.style.borderRadius="5px";c.appendChild(f);c.style.margin="30px 0 0 0";this.addItem=function(){g++;e()};this.completeItem=function(){j++;e();g!=0&&g==j&&b()};this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,e=[],c=[],d=[],f=0,g=0,j=0,h=!1;this.add=function(m,n,p,t){m.__active=!1;m.__start=n;m.__duration=p-n;m.__end=p;m.__layer=t;m.init();e.push(m);e.sort(function(v,u){return v.__start-u.__start});d.push(m);d.sort(function(v,u){return v.__end-u.__end})};this.update=function(m){if(m<j){this.clear();j=m}for(;e[f];){b=e[f];if(b.__start>m)break;if(!b.__active&&b.__end>m){b.show((m-b.__start)/b.__duration);b.__active=!0;c.push(b);h=!0}f++}for(;d[g];){b=d[g];if(b.__end>m)break;
if(b.__active){b.hide();b.__active=!1;var n=c.indexOf(b);n!==-1&&c.splice(n,1)}g++}if(h){c.sort(function(t,v){return t.__layer-v.__layer});h=!1}n=0;for(var p=c.length;n<p;n++){b=c[n];b.update((m-b.__start)/b.__duration,m-j,m)}j=m};this.clear=function(){for(g=f=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var e,c,d;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(f){e=f;d=1/e*6E4};this.getBPM=function(){return e};this.setMS=function(f){d=f;e=1/d*6E4};this.getMS=function(){return d};this.setRows=function(f){c=f};this.getRows=function(){return c};this.getBeatMS=function(f){return d*f};this.getPatternMS=function(f){return d*c*f}},UgcHandler=function(){this.getLatestUGOs=function(b){var e=new XMLHttpRequest;e.open("GET","/ugc/objects/latest",!0);e.onreadystatechange=
function(){e.readyState==4&&(e.status==200?b(JSON.parse(e.responseText)):console.log("Unable to load latest User Generated Content"))};e.send(null)};this.submitUGO=function(b,e,c,d,f,g){b="title="+b+"&email="+e+"&type="+c+"&data="+d+"&image="+f;console.log(d);var j=new XMLHttpRequest;j.open("POST","/ugc/objects",!0);j.setRequestHeader("Content-type","application/x-www-form-urlencoded");j.onreadystatechange=function(){j.readyState==4&&(j.status==200?g(j.responseText):console.log("Submission of model failed"))};
j.send(b)}};function preInitModel(b,e,c){e.initWebGLObjects(c);for(e=0;e<b.materials.length;e++);}function preInitScene(b,e){e.initWebGLObjects(b.scene);var c,d;for(c in b.materials){d=b.materials[c];d instanceof THREE.MeshFaceMaterial||d.program||setTimeout(function(){e.initMaterial(d,b.scene.lights,b.scene.fog)},250)}}function preinitAnimal(b,e,c){e.initWebGLObjects(c)}
function initLensFlares(b,e,c,d){var f=THREE.ImageUtils.loadTexture("files/textures/lensflare0.png"),g=THREE.ImageUtils.loadTexture("files/textures/lensflare2.png"),j=THREE.ImageUtils.loadTexture("files/textures/lensflare3.png");b.lensFlare=new THREE.LensFlare(f,700,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(j,60,0.6,THREE.AdditiveBlending);b.lensFlare.add(j,
70,0.7,THREE.AdditiveBlending);b.lensFlare.add(j,120,0.9,THREE.AdditiveBlending);b.lensFlare.add(j,70,1,THREE.AdditiveBlending);b.lensFlare.customUpdateCallback=lensFlareUpdateCallback;b.lensFlare.position.copy(e);b.lensFlareRotate=new THREE.Object3D;b.lensFlareRotate.addChild(b.lensFlare);b.lensFlareRotate.rotation.x=c*Math.PI/180;b.lensFlareRotate.rotation.y=d*Math.PI/180;b.scene.addChild(b.lensFlareRotate)}
function lensFlareUpdateCallback(b){var e,c,d=b.lensFlares.length,f=-b.positionScreen.x*2,g=-b.positionScreen.y*2;for(c=0;c<d;c++){e=b.lensFlares[c];e.x=b.positionScreen.x+f*e.distance;e.y=b.positionScreen.y+g*e.distance;e.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var e,c,d;e=0;for(c=b.objects.length;e<c;e++){d=b.objects[e];d.matrixAutoUpdate=!1;d.updateMatrix()}}
function hideColliders(b){var e,c,d;e=0;for(c=b.collisions.colliders.length;e<c;e++){d=b.collisions.colliders[e].mesh;d.visible=!1}}function applyMaterial(b,e,c){var d,f,g,j=e.length;for(d=0;d<j;d++){f=e[d][0];g=e[d][1];b.objects[f]&&(b.objects[f].geometry.materials[g][0]=c)}}
window.GEE=function(b){b||(b={});if(document.createElement("canvas").getContext){var e=this,c={},d={ctx:undefined,domElement:undefined,width:undefined,height:undefined,desiredFrameTime:1E3/60,frameCount:0,key:undefined,keyCode:undefined,mouseX:0,mouseY:0,pmouseX:undefined,pmouseY:undefined,mousePressed:!1},f=undefined,g,j=function(){for(var p=g,t=0,v=0;p;){v+=p.offsetTop;t+=p.offsetLeft;p=p.offsetParent}offset={x:t,y:v}};b.context||(b.context="2d");b.width||(b.width=500);b.height||(b.height=500);
g=d.domElement=document.createElement("canvas");d.ctx=g.getContext(b.context);if(d.ctx==null)b.fallback&&b.fallback();else{if(b.fullscreen){var h=function(){j();d.width=g.width=window.innerWidth;d.height=g.height=window.innerHeight-4};window.addEventListener("resize",h,!1);h();b.container||(b.container=document.body);document.body.style.margin="0px";document.body.style.padding="0px"}else{j();e.__defineSetter__("width",function(p){d.width=g.width=p});e.__defineSetter__("height",function(p){d.height=
g.height=p});e.width=b.width;e.height=b.height}if(b.container){b.container.appendChild(g);j()}b=function(p){e.__defineGetter__(p,function(){return d[p]})};b("ctx");b("width");b("height");b("frameCount");b("key");b("keyCode");b("mouseX");b("mouseY");b("pmouseX");b("pmouseY");b("mousePressed");b=function(){};e.loop=!0;e.keyup=b;e.keydown=b;e.draw=b;e.mousedown=b;e.mouseup=b;e.mousemove=b;e.mousedrag=b;e.__defineGetter__("frameRate",function(){return 1E3/f});e.__defineGetter__("frameTime",function(){return f});
e.__defineGetter__("keyPressed",function(){for(var p in c)if(c[p])return!0;return!1});e.__defineSetter__("frameTime",function(p){d.desiredFrameTime=p});e.__defineSetter__("frameRate",function(p){d.desiredFrameTime=k/p});g.addEventListener("mouseenter",function(){j()},!1);var m=function(){e.mousemove()};window.addEventListener("mousemove",function(p){var t=p.pageX-offset.x;p=p.pageY-offset.y;if(d.pmouseX==undefined){d.pmouseX=t;d.pmouseY=p}else{d.pmouseX=d.mouseX;d.pmouseY=d.mouseY}d.mouseX=t;d.mouseY=
p},!1);window.addEventListener("mousemove",m,!1);g.addEventListener("mousedown",function(){d.mousePressed=!0;e.mousedown();g.addEventListener("mousemove",e.mousedrag,!1);g.removeEventListener("mousemove",m,!1)},!1);g.addEventListener("mouseup",function(){d.mousePressed=!1;e.mouseup();g.removeEventListener("mousemove",e.mousedrag,!1);g.addEventListener("mousemove",m,!1)},!1);window.addEventListener("keydown",function(p){p=p.keyCode;d.key=String.fromCharCode(p);d.keyCode=p;c[p]=!0;e.keydown()},!1);
window.addEventListener("keyup",function(p){p=p.keyCode;d.key=String.fromCharCode(p);d.keyCode=p;c[p]=!1;e.keyup()},!1);var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(p){window.setTimeout(p,f)}}();_idraw=function(){e.loop&&n(_idraw);d.frameCount++;var p=(new Date).getTime();e.draw();p=(new Date).getTime()-p;f=p>d.desiredFrameTime?p:d.desiredFrameTime};
_idraw()}}else b.fallback&&b.fallback()};function loadSVG(b,e,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200)if(d.responseXML==null)c!=undefined&&c.call(this,b);else{var f=d.responseXML.getElementsByTagName("svg").item(0);f=new SVG(f);f.filename=b;e.call(this,f,b)}else c!=undefined&&c.call(this,b)};d.open("GET",b,!0);d.send(null)}
var SVG=function(b){this.filename="";this.children=[];var e=b.getAttribute("width"),c=b.getAttribute("height");this.width=e==null?0:parseFloat(e.replace("px",""));this.height=c==null?0:parseFloat(c.replace("px",""));for(var d in b.childNodes)b.childNodes.item(d).getAttribute&&this.children.push(b.childNodes.item(d).nodeName=="g"?new SVG(b.childNodes.item(d)):new Path(b.childNodes.item(d)));this.draw=function(f){for(var g in this.children)this.children[g].draw(f)};this.__defineGetter__("path",function(){})},
Path=function(b){this.element=b;this.commands=commands(b);this.lineWidth=parseLineWidth(b);this.strokeStyle=parseStrokeStyle(b);this.fillStyle=parseFillStyle(b);this.totalLength=0;this.lengths=[];this.tlengths=[];var e=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0};this.reset()};this.draw=function(c){this.style(c);c.beginPath();this.shape(c);this.end(c)};this.getAnchorPoints=function(){var c=[],d;for(d in this.commands)c.push(this.commands[d].getAnchorPoints(e));
return c};this.shape=function(c){for(var d in this.commands)this.commands[d].shape(e,c)};this.lerp=function(c,d,f,g,j){var h=1-j;return c*h*h*h+3*d*j*h*h+3*f*j*j*h+g*j*j*j};this.at=function(c,d){var f,g;this.lengths.length==0&&this.calcLengths(d);g=this.tlengths[0];for(f=0;c>g;){f++;g+=this.tlengths[f]}pt=g-this.tlengths[f];g=this.map(c,pt,g,0,1);for(var j=0;j<=f;j++)this.commands[j].shape(e,d);var h=e.x;j=e.y;this.commands[f+1].shape(e,d);f=this.lerp(h,e.x1,e.x2,e.x,g);g=this.lerp(j,e.y1,e.y2,e.y,
g);return{x:f,y:g}};this.map=function(c,d,f,g,j){return g+(j-g)*((c-d)/(f-d))};this.calcLengths=function(c){var d,f,g,j,h=0;this.commands[0].shape(e,c);for(var m=g=e.x,n=j=e.y,p=1;p<this.commands.length;p++){h=0;m=e.x;n=e.y;this.commands[p].shape(e,c);for(var t=0;t<=1;t+=0.001){d=this.lerp(m,e.x1,e.x2,e.x,t);f=this.lerp(n,e.y1,e.y2,e.y,t);h+=this.dist(d,f,g,j);g=d;j=f}this.lengths.push(h);this.totalLength+=h}for(c=0;c<this.lengths.length;c++)this.tlengths.push(this.lengths[c]/this.totalLength)};this.dist=
function(c,d,f,g){return Math.sqrt((c-f)*(c-f)+(d-g)*(d-g))};this.style=function(c){if(this.lineWidth!=null)c.lineWidth=this.lineWidth;if(this.strokeStyle!=null){c.strokeStyle=this.strokeStyle;if(this.lineWidth==undefined)c.lineWidth=1}if(this.fillStyle!=null)c.fillStyle=this.fillStyle};this.end=function(c){this.fillStyle!=null&&c.fill();this.strokeStyle!=null&&c.stroke()}},parseLineWidth=function(b){b=b.attributes.getNamedItem("stroke-width");return b==null?null:parseFloat(b.nodeValue)},parseStrokeStyle=
function(b){b=b.attributes.getNamedItem("stroke");return b==null?null:b.nodeValue},parseFillStyle=function(b){var e=b.attributes.getNamedItem("fill");if(e==null)return b.attributes.getNamedItem("stroke")!=null?null:"#000000";else{if(e.nodeValue=="none")return null;return e.nodeValue}},Command=function(b,e){this.type=b;this.data=e;this.debug=!1;this.shape=function(c,d){if(this.type=="M"){c.x=this.data[0];c.y=this.data[1];d&&d.moveTo(c.x,c.y)}else if(this.type=="C"){c.x=this.data[4];c.y=this.data[5];
if(d)d.bezierCurveTo(c.x1=this.data[0],c.y1=this.data[1],c.x2=this.data[2],c.y2=this.data[3],c.x,c.y)}else if(this.type=="c"){if(d)d.bezierCurveTo(c.x1=c.x+this.data[0],c.y1=c.y+this.data[1],c.x2=c.x+this.data[2],c.y2=c.y+this.data[3],c.x+=this.data[4],c.y+=this.data[5])}else if(this.type=="S"){c.x=this.data[2];c.y=this.data[3];var f=c.x-c.x2,g=c.y-c.y2;if(d)d.bezierCurveTo(c.x1=c.x+f,c.y1=c.y+g,c.x2=this.data[0],c.y2=this.data[1],c.x,c.y)}else if(this.type=="s"){f=c.x-c.x2;g=c.y-c.y2;if(d)d.bezierCurveTo(c.x1=
c.x+f,c.y1=c.y+g,c.x2=c.x+this.data[0],c.y2=c.y+this.data[1],c.x+=this.data[2],c.y+=this.data[3])}else if(this.type=="L"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="l"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=this.data[0],c.y+=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="H"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="h"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=this.data[0],c.y);c.x2=c.x;c.y2=
c.y}else if(this.type=="V"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x,c.y=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="v"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x,c.y+=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="z")d.closePath();else console&&console.log("unrecognized command "+this.type);if(d){d.strokeStyle="#000000";d.lineWidth=1;if(this.debug){d.strokeRect(c.x-1.5,c.y-1.5,3,3);d.beginPath();d.moveTo(c.px,c.py);d.lineTo(c.x1,c.y1);d.closePath();d.stroke()}}}},commands=function(b){if(b.nodeName.toLowerCase()==
"path")return commandsFromD(b.getAttribute("d"));if(b.nodeName.toLowerCase()=="polygon")return commandsFromPoints(b.getAttribute("points"));if(b.nodeName.toLowerCase()=="line")return commandsFromLine(b);if(b.nodeName.toLowerCase()=="rect")return commandsFromRect(b);return[]},commandsFromD=function(b){var e=[];b=b.match(/[a-zA-Z][0-9\.\-\,]+/g);for(var c=0;c<b.length;c++){var d=b[c].charAt(0),f=b[c].substr(1);f=f.replace(/\-/g,",-");f.charAt(0)==","&&(f=f.substr(1));f=f.split(",");for(var g=0;g<f.length;g++)f[g]=
parseFloat(f[g]);e.push(new Command(d,f))}return e},commandsFromLine=function(b){var e=[],c=parseFloat(b.getAttribute("x1")),d=parseFloat(b.getAttribute("x2")),f=parseFloat(b.getAttribute("y1"));b=parseFloat(b.getAttribute("y2"));e.push(new Command("M",[c,f]));e.push(new Command("L",[d,b]));return e},commandsFromPoints=function(b){var e=!0;if(b.indexOf(",")==-1)for(var c=0;c<b.length;c++)if(b.charAt(c)==" "){e&&(b=b.setCharAt(c,","));e=!e}b=("M"+b).replace(/ /g,"L")+"z";return commandsFromD(b)};
String.prototype.setCharAt=function(b,e){if(b>this.length-1)return str;return this.substr(0,b)+e+this.substr(b+1)};var commandsFromRect=function(b){var e=[],c=parseFloat(b.getAttribute("x")),d=parseFloat(b.getAttribute("y")),f=parseFloat(b.getAttribute("width"));b=parseFloat(b.getAttribute("height"));e.push(new Command("M",[c,d]));e.push(new Command("h",[f]));e.push(new Command("v",[b]));e.push(new Command("h",[-f]));e.push(new Command("v",[-b]));return e},WonderWall=WonderWall||{};
WonderWall.Point=function(b,e,c){var d=e,f=c,g=0;this.x=e;this.y=c;this.r=0.15;this.threshold=0.1;this.easing=0.125;this.updating=!1;this.angle=0;this.update=function(){if(this.updating){var j=b.mouseY-f;e=d+(b.mouseX-d)*this.r;c=f+j*this.r;this.easing=0.0625}else{e=d;c=f;g=0;this.easing=0.125}this.x=this.ease(this.x,e,this.easing);this.y=this.ease(this.y,c,this.easing);this.angle=this.ease(this.angle,g,this.easing)};this.setPosition=function(j,h){d=j;f=h};this.getOriginPosition=function(){return{x:d,
y:f}};this.getPoint=function(){return{x:this.x,y:this.y}}};WonderWall.Point.prototype.ease=function(b,e,c){var d=e-b;if(Math.abs(d)<c/100)b=e;else b+=d*c;return b};
WonderWall.Pentagon=function(b,e,c,d){var f=b.ctx;this.separate=!1;this.showFill=!0;this.showStroke=!0;this.insides=!1;this.x=e;this.y=c;if(this.x==undefined||this.x==null||this.x==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y==NaN)this.y=b.height/2;e=this.generatePoints(this.x,this.y,d,5);var g=[];for(c=0;c<e.length;c++){var j=e[c];g.push(new WonderWall.Point(b,j.x,j.y))}this.update=function(){this.x=b.width/2;this.y=b.height/2;var h=this.generatePoints(this.x,this.y,d,5);if(!this.separate)this.separate=
!0;for(var m=0;m<g.length;m++){var n=g[m],p=h[m];n.update();var t=n.getOriginPosition();(p.x!=t.x||p.y!=t.y)&&n.setPosition(p.x,p.y)}return this};this.render=function(){if(this.insides&&this.showStroke)for(var h=0;h<g.length;h++){var m=g[h];this.separate||m.update();f.beginPath();f.moveTo(this.x,this.y);f.lineTo(m.x,m.y);f.stroke()}f.beginPath();for(h=0;h<g.length;h++){m=g[h];this.separate||m.update();h<1?f.moveTo(m.x,m.y):f.lineTo(m.x,m.y)}f.closePath();this.showFill&&f.fill();this.showStroke&&f.stroke()};
this.setUpdate=function(h){for(var m=0;m<g.length;m++)g[m].updating=h};this.setUpdatePoint=function(h,m){g[m].updating=h};this.setRadius=function(h){for(var m=0;m<g.length;m++)g[m].r=h};this.getPoints=function(){return g}};WonderWall.Pentagon.prototype.generatePoints=function(b,e,c,d){for(var f=[],g=0;g<d;g++)f.push({x:c*Math.sin(g/d*2*Math.PI)+b,y:-c*Math.cos(g/d*2*Math.PI)+e});return f};
function Heart(b,e,c,d){var f=this,g=b.ctx;this.x=c;this.y=d;if(this.x==undefined||this.x==null||this.x||this==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y||this==NaN)this.y=b.height/2;var j,h=!1;this.update=function(){return this};this.render=function(){if(h){g.save();g.translate(this.x,this.y);g.save();g.translate(-this.width/2,-this.height/2);j.draw(g);g.restore();g.restore()}};loadSVG(e,function(m,n){j=m;f.source=n;f.width=j.width;f.height=j.height;h=!0},function(){})}
var ClearEffect=function(b){SequencerItem.call(this);var e,c=b.renderer,d=b.renderTarget;this.init=function(){e=new THREE.Camera(60,1,1,1E4);e.position.z=2;new THREE.Scene};this.update=function(){c.clear();var f=c.getContext();f.bindFramebuffer(f.FRAMEBUFFER,d.__webglFramebuffer);f.viewport(0,0,d.width,d.height);f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,j=e.renderer,h=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(g)};this.update=function(m){f.opacity=1-m;j.render(d,c,h)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,j=e.renderer,h=e.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);d.addObject(g)};this.update=function(m){f.opacity=m;j.render(d,c,h)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.position.z=200;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var j=new THREE.MeshBasicMaterial({map:g,depthTest:!1});d=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),j);d.scale.y=-1;d.doubleSided=!0;c.addObject(d)};this.update=function(){f.render(c,e)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,e,c,d){SequencerItem.call(this);var f,g,j,h,m,n=b.renderer,p=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;g=new THREE.Scene;h=THREE.ShaderUtils.lib.film;m=THREE.UniformsUtils.clone(h.uniforms);m.tDiffuse.texture=p;j=new THREE.MeshShaderMaterial({uniforms:m,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader});m.grayscale.value=
0;if(e!==undefined)m.nIntensity.value=e;if(c!==undefined)m.sIntensity.value=c;if(d!==undefined)m.sCount.value=d;var t=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),j);t.position.z=-500;g.addObject(t)};this.update=function(t,v,u){m.time.value=u*0.01%1E4;n.render(g,f,p,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,e){SequencerItem.call(this);var c,d,f,g,j,h,m,n,p,t,v,u=b.renderer,w=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;d=new THREE.Scene;var z={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};m=new THREE.WebGLRenderTarget(256,512,z);n=new THREE.WebGLRenderTarget(512,256,z);z=THREE.ShaderUtils.lib.screen;
g=THREE.UniformsUtils.clone(z.uniforms);g.tDiffuse.texture=w;g.opacity.value=e!==undefined?e:1;f=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:z.vertexShader,fragmentShader:z.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});z=THREE.ShaderUtils.lib.convolution;j=THREE.UniformsUtils.clone(z.uniforms);t=new THREE.Vector2(0.001953125,0);v=new THREE.Vector2(0,0.001953125);j.tDiffuse.texture=w;j.uImageIncrement.value=t;j.cKernel.value=THREE.ShaderUtils.buildKernel(4);h=new THREE.MeshShaderMaterial({uniforms:j,
vertexShader:"#define KERNEL_SIZE 25.0\n"+z.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+z.fragmentShader});p=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),h);p.position.z=-500;d.addObject(p)};this.update=function(){p.materials[0]=h;j.tDiffuse.texture=w;j.uImageIncrement.value=t;u.render(d,c,m,!0);j.tDiffuse.texture=m;j.uImageIncrement.value=v;u.render(d,c,n,!0);p.materials[0]=f;f.blending=THREE.AdditiveBlending;g.tDiffuse.texture=n;u.render(d,c,w,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var e,c,d,f,g=b.renderer,j=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={time:{type:"f",value:0},map:{type:"t",value:0,texture:j},sampleDistance:{type:"f",value:1/b.baseWidth}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);h.position.z=-500;c.addObject(h)};this.update=function(h,m,n){f.time.value=n*0.01;g.render(c,e,j,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.54},waveFactor:{type:"f",value:0.00127},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);j.position.z=-500;c.addObject(j)};this.update=function(){f.render(c,e)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.49},waveFactor:{type:"f",value:0.00161},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.55 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);j.position.z=-500;c.addObject(j)};this.update=function(){f.render(c,e)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var e,c,d,f=b.renderer,g=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.64},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.00756},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (1.86 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);j.position.z=-500;c.addObject(j)};this.update=function(){f.render(c,e)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintDarkEffect=function(b){SequencerItem.call(this);var e,c,d,f,g=b.renderer,j=b.renderTarget;this.init=function(){e=new THREE.Camera;e.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);e.position.z=100;c=new THREE.Scene;f={map:{type:"t",value:0,texture:j}};d=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);h.position.z=-500;c.addObject(h)};this.update=function(){g.render(c,e,j,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,e){SequencerItem.call(this);var c,d,f,g=b.renderer,j=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:e,transparent:!0});f=new THREE.Mesh(new THREE.Plane(3,3),this.material);d.addObject(f)};this.update=function(){this.material.opacity=0.25;g.render(d,c,j)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,e){SequencerItem.call(this);this.show=function(){document.body.style.cursor=e?'url("files/pointer.png"), auto':"none"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var CityWorld=function(b){function e(z){var y=z.scene;hideColliders(y);makeSceneStatic(y);preInitScene(z,b.renderer);y.scale.set(0.1,0.1,0.1);y.updateMatrix();c.scene.addChild(y);y.collisions&&c.scene.collisions.merge(y.collisions);TriggerUtils.setupCityTriggers(z);z.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;z.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;applyCityShader(z,["Backdrop_City"],f,g,d,CityShader);c.scene.update(undefined,!0)}var c=this,d=[],
f=new THREE.Vector3,g=new THREE.Vector3;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;var j=new THREE.Vector3(1094.09,-99.358,246.713);this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var h=new THREE.DirectionalLight(16777215);h.castShadow=!1;this.scene.addLight(h);var m=new THREE.DirectionalLight(16777215);m.castShadow=!1;this.scene.addLight(m);var n={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,
s:0.494,v:0},directionalLight1:{h:0.565,s:0.329,v:0.841,x:0.5176767580772196,y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,
flarey:358,flyCamera:{position:{x:16.574202591686277,y:462.26953453589,z:-10184.707948888321},target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(n.fogColor.h,n.fogColor.s,n.fogColor.v);this.scene.fog.density=n.fogDensity;h.color.setHSV(n.directionalLight1.h,n.directionalLight1.s,n.directionalLight1.v);m.color.setHSV(n.directionalLight2.h,n.directionalLight2.s,n.directionalLight2.v);h.position.set(n.directionalLight1.x,n.directionalLight1.y,
n.directionalLight1.z);m.position.set(n.directionalLight2.x,n.directionalLight2.y,n.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;h=new THREE.Vector3(0,0,-5E3);initLensFlares(c,h,20,358);h=new THREE.SceneLoader;h.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};h.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};b.debug||h.load("files/models/city/City.js",e);var p=0,t=0,v,u,w;this.update=function(z,y,A){v=y.matrixWorld.getPosition();p+=((new Date).getTime()-
t)/5E4;t=(new Date).getTime();p>1&&(p=0);TriggerUtils.effectorRadius=300;TriggerUtils.update();u=y.target.position;updateCityShader(f,g,d,v,u,p);if(A){w=j.distanceTo(v);w<100&&b.signals.startexploration.dispatch("dunes")}}},PrairieWorld=function(b){var e=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;var c=new THREE.Vector3(1094.09,-99.358,246.713);this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);
this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.19587102348124588,0.9325398992514422,-0.30332141115410777);this.directionalLight1.color.setHSV(0,0,0.8764705882352941);this.scene.addLight(this.directionalLight1);this.directionalLight2=new THREE.DirectionalLight(16772829);this.directionalLight2.position.set(0.19122302057716462,-0.30810803127799236,-0.9319351895187481);this.directionalLight2.color.setHSV(0.34705882352941175,
0.5058823529411764,0.13529411764705881);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.058823529411765E-5,fogColor:{h:0.5235294117647059,s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,y:0.8775825618903728,z:-0.1553545034191468,phi:-1.588470588235294,
theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.scene.fog.color.setHSV(this.settings.fogColor.h,this.settings.fogColor.s,this.settings.fogColor.v);this.scene.fog.density=
this.settings.fogDensity;this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,this.settings.directionalLight1.s,this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,
this.settings.directionalLight2.y,this.settings.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;var d=new THREE.Vector3(0,0,-3E3);initLensFlares(e,d,142,284);var f=THREE.ImageUtils.loadTexture("files/textures/trailMarkTexture.jpg");d=new THREE.SceneLoader;d.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};d.load("files/models/prairie/Prairie.js",function(g){var j=g.scene;hideColliders(j);makeSceneStatic(j);
ROME.TrailShaderUtils.setMaterials([g.objects.Ground],2048,f,b.renderer);TriggerUtils.setupPrairieTriggers(g);e.scene.addChild(j);g.objects.Backdrop.materials[0].map.wrapS=THREE.RepeatWrapping;g.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;preInitScene(g,b.renderer);j.collisions&&e.scene.collisions.merge(j.collisions);g=new THREE.JSONLoader;g.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};g.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};e.scene.update(undefined,
!0)});this.update=function(g,j,h){ROME.TrailShaderUtils.updateLava(g*1.0E-4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=50;TriggerUtils.update();if(h){g=j.matrixWorld.getPosition();c.distanceTo(g)<100&&b.signals.startexploration.dispatch("dunes")}}},DunesWorld=function(b){function e(ca,$,ia){ca.scale.x=ca.scale.y=ca.scale.z=z;ca.position=$;ca.updateMatrix();makeSceneStatic(ca);g(ca);preInitScene(ia,b.renderer);n.scene.addChild(ca);
ca.collisions&&n.scene.collisions.merge(ca.collisions)}function c(ca,$){var ia,Aa,Ka,Ba,Ea,V=new THREE.MeshFaceMaterial;for(ia=0;ia<$;ia++){Ea=new THREE.Mesh(ca,V);Aa=45E3*(0.5-Math.random());Ka=6E3+3E3*(0.5-Math.random());Ba=45E3*(0.5-Math.random());Ea.position.set(Aa,Ka,Ba);Aa=z*(1+0.5*Math.random());Ea.scale.set(Aa,Aa,Aa);Ea.rotation.y=0.5*Math.random();Ea.matrixAutoUpdate=!1;Ea.updateMatrix();n.scene.addChild(Ea);applyCloudsShader(Ea,CloudsShader,v,u,t)}}function d(ca){var $=N%3,ia=Math.floor(N/
3);ca.scene.rotation.z=j();$==1&&(ia==1||ia==2)&&f(ca.scene,!1);e(ca.scene,new THREE.Vector3(($-1)*y,0,(ia-1)*y),ca);p&&applyDunesShader(ca,[],v,u,t,DunesShader);L[ia][$]=ca.scene;++N}function f(ca,$){THREE.SceneUtils.traverseHierarchy(ca,function(ia){if(!ia.__isCollider)ia.visible=$})}function g(ca){THREE.SceneUtils.traverseHierarchy(ca,function($){for(var ia=ca.collisions.colliders,Aa=0;Aa<ia.length;Aa++)if(ia[Aa].mesh==$)$.__isCollider=!0})}function j(){return Math.round(Math.random()*4)*(Math.PI/
2)}function h(ca,$){if(ca.x==o.x&&ca.z==o.z){f(sa,$);sa.updateMatrix();return!0}if(ca.x==oa.x&&ca.z==oa.z){f(ka,$);ka.updateMatrix();return!0}if(ca.x==ha.x&&ca.z==ha.z){f(U,$);U.updateMatrix();return!0}}function m(ca,$,ia){var Aa,Ka,Ba,Ea=ca.matrixWorld.getPosition();for(Aa=0;Aa<b.influenceSpheres.length;Aa++){Ba=b.influenceSpheres[Aa];Ka=Ba.center.distanceTo(Ea);if(Ka<Ba.radius){if(Ba.mesh)Ba.mesh.materials[0].color=qa;if(Ba.type==0){if(Ba.state==0){Ba.state=1;E=B;D=C;this.liftSpeed=0}}else if(Ba.type==
1){console.log("entered portal ["+Ba.name+"]");ia&&b.signals.startexploration.dispatch(Ba.destination)}}else{if(Ba.mesh)Ba.mesh.materials[0].color=va;if(Ba.type==0&&Ba.state==1){Ba.state=0;E=B;D=K}}}if(E>0){E-=$*I;ca.movementSpeed+=D*$}}var n=this,p=!0,t=[],v=new THREE.Vector3,u=new THREE.Vector3;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;this.scene.fog=new THREE.FogExp2(16777215,2.75E-6);this.scene.fog.color.setHSV(0.576,0.382,0.9);var w=new THREE.AmbientLight(2232576);
w.color.setHSV(0,0,0.1);this.scene.addLight(w);w=new THREE.DirectionalLight(16772829);w.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);w.color.setHSV(0.08823529411764706,0,1);this.scene.addLight(w);w=new THREE.DirectionalLight(16772829);w.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);w.color.setHSV(0,0,0.8647058823529412);this.scene.addLight(w);this.lensFlareRotate=this.lensFlare=null;w=new THREE.Vector3(0,0,-15E3);initLensFlares(n,w,70,292);var z=
0.15,y=3E4*z,A=new THREE.Vector3,E=0,B=Math.PI,I=Math.PI,D=0,C=-90,K=90;this.liftSpeed=250;this.startLift=0.29;this.endLift=0.375;var N=0,L=[[],[],[]],Q,ea,o,oa,ha,sa,ka,U;w=new THREE.Cube(100,100,100);var ma=new THREE.MeshBasicMaterial({color:16711680});n.refCube=new THREE.Mesh(w,ma);n.refCube.visible=!1;n.scene.addObject(n.refCube);w=new THREE.Cube(5E4,5E4,5E4);ma=new THREE.MeshBasicMaterial({color:65280});n.skydome=new THREE.Mesh(w,ma);n.skydome.flipSided=!0;n.scene.addObject(n.skydome);applyDunesShader({objects:{skydome:n.skydome}},
[],v,u,t,DunesShader);var qa=new THREE.Color(16755200),va=new THREE.Color(6710886);b.influenceSpheres=[{name:"prairie",center:new THREE.Vector3(544.3,7167.78,11173.2),radius:1750,state:0,type:0},{name:"city",center:new THREE.Vector3(-67.22,6124.65,5156.3),radius:1750,state:0,type:0},{name:"prairiePortal",center:new THREE.Vector3(-314.95,6122.06,5658),radius:50,state:0,type:1,destination:"prairie",pattern:32},{name:"cityPortal",center:new THREE.Vector3(171.92702640000002,3573.60187991009,10419.361519434933),
radius:100,state:0,type:1,destination:"city",pattern:16}];(new UgcHandler).getLatestUGOs(function(ca){for(var $=new THREE.Cube(50,50,50),ia=new THREE.MeshLambertMaterial({color:16777215}),Aa=0,Ka=ca.length;Aa<Ka;Aa++){var Ba=eval(ca[Aa]);if(Ba instanceof Array){var Ea=new THREE.Object3D;Ea.position.x=Math.random()*1E4-5E3;Ea.position.z=Math.random()*1E4-5E3;for(var V=0,ra=Ba.length;V<ra;V+=4){var aa=new THREE.Mesh($,ia);aa.position.x=Ba[V];aa.position.y=Ba[V+1];aa.position.z=Ba[V+2];aa.matrixAutoUpdate=
!1;aa.updateMatrix();aa.update();Ea.addChild(aa)}n.scene.addObject(Ea)}}});w=new THREE.SceneLoader;w.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};w.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};new THREE.MeshLambertMaterial({color:65280});w.load("files/models/dunes/D_tile_walk.js",function(ca){sa=ca.scene;o=new THREE.Vector3(0,0,0*y);sa.rotation.z=Math.PI;e(sa,o,ca);p&&applyDunesShader(ca,[],v,u,t,DunesShader)});w.load("files/models/dunes/D_tile_prairie.js",function(ca){ka=
ca.scene;oa=new THREE.Vector3(0,0,1*y);e(ka,oa,ca);p&&applyDunesShader(ca,[],v,u,t,DunesShader)});w.load("files/models/dunes/D_tile_city.js",function(ca){U=ca.scene;ha=new THREE.Vector3(0,0,2*y);f(U,!1);e(U,ha,ca);p&&applyDunesShader(ca,[],v,u,t,DunesShader);var $=ca.objects.City_Center;ca=ca.objects.City_Portal;ca.visible=!1;$.visible=!1;ca.__isCollider=!0;$.__isCollider=!0;n.scene.update(undefined,!0);$=$.matrixWorld.getPosition();ca=ca.matrixWorld.getPosition();b.influenceSpheres[1].center.copy($);
b.influenceSpheres[3].center.copy(ca);console.log("cityCenter",$);console.log("cityPortal",ca)});w.load("files/models/dunes/D_tile_1.js",d);w.load("files/models/dunes/D_tile_2.js",d);w.load("files/models/dunes/D_tile_3.js",d);w.load("files/models/dunes/D_tile_4.js",d);w.load("files/models/dunes/D_tile_1.js",d);w.load("files/models/dunes/D_tile_2.js",d);w.load("files/models/dunes/D_tile_3.js",d);w.load("files/models/dunes/D_tile_4.js",d);w.load("files/models/dunes/D_tile_1.js",d);w=new THREE.JSONLoader;
w.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};w.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};w.load({model:"files/models/Cloud1_.js",callback:function(ca){c(ca,100)}});w.load({model:"files/models/Cloud2_.js",callback:function(ca){c(ca,100)}});var fa,ta=0,za=0;this.update=function(ca,$,ia){ta+=((new Date).getTime()-za)/5E4;za=(new Date).getTime();ta>1&&(ta=0);m($,ca/1E3,ia);fa=$.matrixWorld.getPosition();A=$.matrixWorld.getColumnZ().negate();ca=Math.round((fa.z+
2E3*A.z)/y);$=Math.round((fa.x+2E3*A.x)/y);if(ca!=ea||$!=Q){var Aa=ea-ca;ia=Q-$;if(!isNaN(Aa)&&!isNaN(ia)){var Ka,Ba,Ea;if(Aa<0){Aa=L.shift();Ka=Aa[0];Ba=Aa[1];Ea=Aa[2];h(Ka.position,!1);h(Ba.position,!1);h(Ea.position,!1);Ka.position.z=(ca+1)*y;Ba.position.z=(ca+1)*y;Ea.position.z=(ca+1)*y;L.push(Aa)}else if(Aa>0){Aa=L.pop();Ka=Aa[0];Ba=Aa[1];Ea=Aa[2];h(Ka.position,!1);h(Ba.position,!1);h(Ea.position,!1);Ka.position.z=(ca-1)*y;Ba.position.z=(ca-1)*y;Ea.position.z=(ca-1)*y;L.unshift(Aa)}if(ia<0){Ka=
L[0].shift();Ba=L[1].shift();Ea=L[2].shift();h(Ka.position,!1);h(Ba.position,!1);h(Ea.position,!1);Ka.position.x=($+1)*y;Ba.position.x=($+1)*y;Ea.position.x=($+1)*y;L[0].push(Ka);L[1].push(Ba);L[2].push(Ea)}else if(ia>0){Ka=L[0].pop();Ba=L[1].pop();Ea=L[2].pop();h(Ka.position,!1);h(Ba.position,!1);h(Ea.position,!1);Ka.position.x=($-1)*y;Ba.position.x=($-1)*y;Ea.position.x=($-1)*y;L[0].unshift(Ka);L[1].unshift(Ba);L[2].unshift(Ea)}Ka.rotation.z=j();Ba.rotation.z=j();Ea.rotation.z=j();f(Ka,!0);f(Ba,
!0);f(Ea,!0);ia=h(Ka.position,!0);Aa=h(Ba.position,!0);var V=h(Ea.position,!0);ia&&f(Ka,!1);Aa&&f(Ba,!1);V&&f(Ea,!1);Ka.updateMatrix();Ba.updateMatrix();Ea.updateMatrix()}}ea=ca;Q=$;A.multiplyScalar(350);A.addSelf(fa);updateDunesShader(v,u,t,fa,A,ta);n.skydome.position.copy(fa);n.skydome.updateMatrix()}},CityShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},
surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",value:0},targetStart:{type:"v3",value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",
value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform vec3 colorC;\nvoid main() {\nfloat distance;\nvec3 normal;\nvec4 surface;\nvec4 grass;\nfloat fog_density = 0.0001;\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec3 pointStart = vWorldPosition - targetStart;\nvec3 endStart = targetEnd - targetStart;\nfloat endStartLength2 = dot(endStart, endStart);\nfloat pointOnLine = clamp( dot( endStart, pointStart ) / endStartLength2, 0.0, 1.0 );\ndistance = length( vWorldPosition - ( targetStart + pointOnLine * ( targetEnd - targetStart ))) * -0.01;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4(vec3(0.15, 0.18, 0.2)/*colorA*/ * vec3(2.0), 1.0);\nif(distance > 0.0)\nsurface = grass;\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0001;\ngl_FragColor = surface * vec4( vColor, 1.0 ) * vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(colorC.rgb, 0.1));\ngl_FragColor = mix(vec4(gl_FragColor.rgb, 1.0), vec4(/*colorB*/0.64, 0.88, 1, 1.0), vec4(depth));\n}"};
function applyCityShader(b,e,c,d,f,g){var j,h,m,n,p={};for(j=0;j<e.length;j++)p[e[j]]=!0;var t={uniforms:g.uniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};t.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;t.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;t.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;t.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;for(h in b.objects){m=
b.objects[h];if(!p[h]&&m.geometry&&m.geometry.morphTargets.length===0){e=m.geometry;for(j=0;j<e.materials.length;j++){n=new THREE.MeshShaderMaterial(t);n.uniforms=THREE.UniformsUtils.clone(t.uniforms);n.uniforms.targetStart.value=c;n.uniforms.targetEnd.value=d;n.uniforms.grassImage.texture=t.uniforms.grassImage.texture;n.uniforms.surfaceImage.texture=t.uniforms.surfaceImage.texture;n.uniforms.colorA.value=g.colors.colorA;n.uniforms.colorB.value=g.colors.colorB;n.uniforms.colorC.value=g.colors.colorC;
m.materials[0]=n;f.push(n)}}}}function updateCityShader(b,e,c,d,f,g){b.copy(d);e.copy(f);e=c.length;for(b=0;b<e;b++)c[b].uniforms.time.value=g}
var DunesShaderColors={vectorA:new THREE.Vector3(1,1,1),vectorB:new THREE.Vector3(-0.37,-0.05,0.15),vectorC:new THREE.Vector3(0.83,0.69,0.51)},DunesShader={uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",
value:0},targetStart:{type:"v3",value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},cameraPosition:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},vectorA:{type:"v3",
value:DunesShaderColors.vectorA},vectorB:{type:"v3",value:DunesShaderColors.vectorB},vectorC:{type:"v3",value:DunesShaderColors.vectorC}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 worldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nworldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 worldVector;\nvoid main() {\nfloat distance, f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nf = normalize(worldVector).y + cameraPosition.y * 0.0002 - 0.255;\nf = max(f, 0.0);\nsky_color = mix(vectorA, vectorB, f);\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec3 pointStart = vWorldPosition - targetStart;\nvec3 endStart = targetEnd - targetStart;\nfloat endStartLength2 = dot(endStart, endStart);\nfloat pointOnLine = clamp( dot( endStart, pointStart ) / endStartLength2, 0.0, 1.0 );\ndistance = length( vWorldPosition - ( targetStart + pointOnLine * ( targetEnd - targetStart ))) * -0.005;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4( vec3( 0.5 ), 1.0 );\nif(distance > 0.0)\nsurface = grass;\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0002;\ngl_FragColor = surface * vec4( vColor, 1.0 ) * vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(vectorC.rgb, 0.1));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\ndepth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 50.0;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor/*min(length(worldVector) * 0.02, 1.0) */);\n}"};
function applyDunesShader(b,e,c,d,f,g){function j(){p=new THREE.MeshShaderMaterial(v);p.uniforms=THREE.UniformsUtils.clone(v.uniforms);p.uniforms.targetStart.value=c;p.uniforms.targetEnd.value=d;p.uniforms.grassImage.texture=v.uniforms.grassImage.texture;p.uniforms.surfaceImage.texture=v.uniforms.surfaceImage.texture;p.uniforms.vectorA.value=DunesShaderColors.vectorA;p.uniforms.vectorB.value=DunesShaderColors.vectorB;p.uniforms.vectorC.value=DunesShaderColors.vectorC;n.materials[0]=p;f.push(p)}var h,
m,n,p,t={};for(h=0;h<e.length;h++)t[e[h]]=!0;var v={uniforms:g.uniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};v.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;v.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;v.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;v.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;for(m in b.objects){n=b.objects[m];if(!t[m]&&n.geometry&&n.geometry.morphTargets.length===
0){e=n.geometry;for(h=0;h<e.materials.length;h++)j();e.materials.length==0&&j()}}}function updateDunesShader(b,e,c,d,f,g){b.copy(d);e.copy(f);b.y=0;e.y=0;e=c.length;for(b=0;b<e;b++)c[b].uniforms.time.value=g}
var CloudsShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",value:0},targetStart:{type:"v3",
value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},
colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 worldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nworldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 worldVector;\nvoid main() {\nfloat distance, f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nf = normalize(worldVector).y;\nf = max(f, 0.0);\nsky_color = mix(vectorA, vectorB, f);\nvec3 worldPosition = vWorldPosition * 0.0005;\nsurface = vec4( vec3( 0.5 ), 1.0 );\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0001;\ngl_FragColor = vec4( vColor, 1.0 ) + vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(vectorC.rgb, 0.1));\ngl_FragColor = gl_FragColor + vec4( vLightWeighting, 1.0 );\ndepth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 50.0;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor/*min(length(worldVector) * 0.02, 1.0) */);\ngl_FragColor = vec4(vec3(vLightWeighting) * vec3(0.9, 0.5, 0.3) + vec3(0.7, 0.6, 0.6), vLightWeighting * 0.9 + 0.1);\n}"};
function applyCloudsShader(b,e,c,d,f){var g={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},j=new THREE.MeshShaderMaterial(g);j.uniforms=THREE.UniformsUtils.clone(g.uniforms);j.uniforms.targetStart.value=c;j.uniforms.targetEnd.value=d;j.uniforms.grassImage.texture=g.uniforms.grassImage.texture;j.uniforms.surfaceImage.texture=g.uniforms.surfaceImage.texture;j.uniforms.colorA.value=e.colors.colorA;
j.uniforms.colorB.value=e.colors.colorB;j.uniforms.colorC.value=e.colors.colorC;b.materials[0]=j;f.push(j);g.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;g.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;g.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;g.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping}
Trigger=function(b,e){var c={},d=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,d);var f=1,g=0;e=e!==undefined?e:0;var j=c.mesh.morphTargetForcedOrder,h=(b.morphTargets.length-1)*1E3;j[0]=0;j[1]=1;c.play=function(m){f=m||1;g=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);
c.update(0)};c.update=function(m){g+=m*f;if(g>=h){j[0]=0;j[1]=c.mesh.geometry.morphTargets.length-1;d.uniforms.morph.value=1;d.uniforms.darkness.value=e;THREE.AnimationHandler.removeFromUpdate(c)}else{m=g/h;var n,p=0.1,t=0.7;if(m==0)m=0;else if(m==1)m=1;else{t||(t=0.3);if(!p||p<1){p=1;n=t/4}else n=t/(2*Math.PI)*Math.asin(1/p);m=p*Math.pow(2,-10*m)*Math.sin((m-n)*2*Math.PI/t)+1}m*=h;if(m<h){j[0]=Math.floor(m/1E3);j[1]=Math.ceil(m/1E3)}else{j[0]=c.mesh.geometry.morphTargets.length-2;j[1]=c.mesh.geometry.morphTargets.length-
1}d.uniforms.morph.value=m/h;d.uniforms.darkness.value=e*g/h}};return c};
var TriggerBig=function(b){var e={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});e.mesh=new THREE.Mesh(b,c);e.mesh.doubleSided=!0;var d=0.1,f=0,g=(b.morphTargets.length-1)*1E3,j=e.mesh.morphTargetForcedOrder;j[0]=0;j[1]=1;e.play=function(h){d=h||1;f=0;THREE.AnimationHandler.addToUpdate(e);e.update(0)};e.update=
function(h){f+=h*d;if(f>=g){j[0]=0;j[1]=e.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(e)}else{h=f/g*g;if(h<g){j[0]=Math.floor(h/1E3);j[1]=Math.ceil(h/1E3)}else{j[0]=e.mesh.geometry.morphTargets.length-2;j[1]=e.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=h/g}};return e},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var e=[],c=[],d=[];b.setupCityTriggers=function(f){if(f.triggers){var g,j,h,m,n=f.triggers,
p=[];for(h in n)if(h.indexOf("TriggerMesh")!==-1){m=n[h];m.name=h.slice(h.indexOf("_")+1);m.geometry=f.geometries[m.object.geometry];p.push(m);f.objects[h].parent.removeChild(f.objects[h]);f.objects[h].visible=!1;delete n[h]}e=[];c=[];for(h in n){g=0;for(j=p.length;g<j;g++)if(h.indexOf(p[g].name)!==-1&&p[g].geometry.morphTargets.length){if(n[h].type==="Small"){m=new Trigger(p[g].geometry);f.objects[h].addChild(m.mesh);m.mesh.visible=!1;e.push(m)}else{m=new TriggerBig(p[g].geometry);f.objects[h].addChild(m.mesh);
c.push(m)}m.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(f){var g,j,h=f.geometries,m,n,p,t,v,u,w;for(g in h){j=h[g];if(j.morphTargets.length){m=0;for(n=j.morphTargets.length;m<n;m++){v=j.morphTargets[m].vertices;p=0;for(t=v.length;p<t;p++){u=v[p].position;w=u.y;u.y=-u.z;u.z=w}}}}j=f.objects;d=[];for(g in j)if(j[g].geometry&&j[g].geometry.morphTargets.length){f=new Trigger(j[g].geometry,Math.random()*0.25+0.5);j[g].addChild(f.mesh);j[g].visible=!1;d.push(f)}};b.update=function(){var f,
g,j,h,m,n=b.effectors,p,t,v,u=b.effectorRadius*1.5;f=0;for(g=e.length;f<g;f++){j=e[f].mesh.matrixWorld.getPosition();h=0;for(m=n.length;h<m;h+=3){p=Math.abs(n[h+0]-j.x);t=Math.abs(n[h+1]-j.y);v=Math.abs(n[h+2]-j.z);if(p+t+v<u){e[f].play(0.1+Math.random()*0.05);e.splice(f,1);f--;g--;break}}}f=0;for(g=c.length;f<g;f++){j=c[f].mesh.matrixWorld.getPosition();h=0;for(m=n.length;h<m;h+=3){p=Math.abs(n[h+0]-j.x);t=Math.abs(n[h+1]-j.y);v=Math.abs(n[h+2]-j.z);if(p+t+v<u){c[f].play(0.2+Math.random()*0.1);c.splice(f,
1);f--;g--;break}}}f=0;for(g=d.length;f<g;f++){j=d[f].mesh.matrixWorld.getPosition();h=0;for(m=n.length;h<m;h+=3){p=Math.abs(n[h+0]-j.x);t=Math.abs(n[h+1]-j.y);v=Math.abs(n[h+2]-j.z);if(p+t+v<u){d[f].play(0.1+Math.random()*0.05);d.splice(f,1);f--;g--;break}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,e,c){var d=this;d.camera=b;renderer=c.renderer;var f=0;c.camPos=new THREE.Vector3(0,0,-300);var g=new THREE.JSONLoader;g.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};g.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};c.trigger=new THREE.Vector3(0,0,0);var j=0,h=new CollisionScene(d.camera,e,0.1,c,500,!0);h.settings.maxSpeedDivider=2;h.settings.capBottom=3;h.settings.capTop=1E3;h.settings.shootRayDown=!1;h.settings.allowFlying=!1;h.settings.emitterDivider=
5;h.settings.normalOffsetAmount=8;h.settings.minDistance=100;h.settings.keepEmitterFollowDown=!0;h.emitter.position.z=-100;h.emitterFollow.position.z=-100;h.cameraTarget.position.z=-100;g.load({model:"files/models/city/collision/City.Collision_Big.js",callback:function(C){var K=new THREE.Vector3(-1.570796,0,3.141591),N=new THREE.Vector3;h.addLoaded(C,0.1,K,N,e)}});g.load({model:"files/models/city/collision/City.Collision_Big.001.js",callback:function(C){var K=new THREE.Vector3(-1.570796,0,0),N=new THREE.Vector3;
h.addLoaded(C,0.1,K,N,e)}});g.load({model:"files/models/city/collision/City.Collision_Big.002.js",callback:function(C){var K=new THREE.Vector3(-1.570796,0,0),N=new THREE.Vector3;h.addLoaded(C,0.1,K,N,e)}});g.load({model:"files/models/city/collision/City.Collision_Big.003.js",callback:function(C){var K=new THREE.Vector3(-1.570796,0,1.570797),N=new THREE.Vector3;h.addLoaded(C,0.1,K,N,e)}});b.target=h.cameraTarget;var m=new THREE.Vector3(0,0,100),n=new Vectors(50,2,2,m),p=THREE.ImageUtils.loadTexture("files/textures/particle_0.png"),
t=THREE.ImageUtils.loadTexture("files/textures/particle_1.png"),v=THREE.ImageUtils.loadTexture("files/textures/particle_2.png"),u=THREE.ImageUtils.loadTexture("files/textures/particle_3.png"),w=THREE.ImageUtils.loadTexture("files/textures/particle_4.png"),z=new Particles(22,e,5,[p,t,v,u,w],15,50,THREE.AdditiveBlending);z.settings.gravitateTowardsCamera=!0;var y=new Stragglers(4,e,n.array);y.settings.capy=0;var A=new AnimalSwarm3(30,e,n.array);A.settings.addaptiveSpeed=!0;A.settings.capy=0;A.settings.startPosition=
m;A.settings.constantSpeed=0.75;A.array[0]="moose";A.array[10]="elk";A.array[20]="elk";A.array[1]="elk";A.array[4]="moose";A.array[14]="moose";A.array[8]="fish";A.array[16]="fish";A.array[24]="fish";g.load({model:"files/models/soup/animals_A_life.js",callback:function(C){var K=[0,0,4,3,2,1,0,5,2,7,8,9,10,0,0,3,3,9,2,3],N=[6.5,13.12,9.76,7.47,4.74,4.94,0.777,6.252,3.412,5.52,5.576];A.addAnimal(C,null,1.5,K,N);K=[5,6,9,2];C=y.addAnimal(C,null,1.8,K,N);preinitAnimal(C,renderer,e)}});g.load({model:"files/models/soup/elk_life.js",
callback:function(C){C=A.addAnimal(C,"elk",2.2,null,[6]);preinitAnimal(C,renderer,e)}});g.load({model:"files/models/soup/moose_life.js",callback:function(C){C=A.addAnimal(C,"moose",1.1,null,[13.964]);preinitAnimal(C,renderer,e)}});g.load({model:"files/models/soup/fish_life.js",callback:function(C){C=A.addAnimal(C,"fish",1.6,[0,1,2,3],[2]);preinitAnimal(C,renderer,e)}});var E=new AnimalSwarm3(10,e,n.array);E.settings.flying=!0;E.settings.flyingDistance=45;for(m=0;m<10;++m)m%2==0&&(E.array[m]="b");
g.load({model:"files/models/soup/birds_A_life.js",callback:function(C){C=E.addAnimal(C,null,1.3,[0,1,2,3,0,1,2,3,0,1],[4.848,7,7.5,3.5]);preinitAnimal(C,renderer,e)}});g.load({model:"files/models/soup/birds_B_life.js",callback:function(C){C=E.addAnimal(C,"b",1.3,[1,1,0,0,1,0,0,1,0,0],[8.5,8.623]);preinitAnimal(C,renderer,e)}});var B=new AnimalInFrontOfCamera(15,e);g.load({model:"files/models/soup/butterfly_hiD.js",callback:B.addAnimal});var I=new AnimalInFrontOfCamera(15,e);g.load({model:"files/models/soup/butterfly_hiC.js",
callback:I.addAnimal});var D=new Trail(80,e);D.settings.freeRotation=!1;for(m=0;m<80;++m){p=m%4;D.array[m]="0"+(p+1)}for(m=0;m<80;m+=8){p=m/8%4;D.array[m]="tree"+(p+1)}D.array[4]="light";g.load({model:"files/models/soup/grass01.js",callback:function(C){D.addInstance(C,"01",!1)}});g.load({model:"files/models/soup/grass02.js",callback:function(C){var K=D.addInstance(C,"02",!1);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/grass03.js",callback:function(C){var K=D.addInstance(C,"03",
!1);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/grass04.js",callback:function(C){var K=D.addInstance(C,"04",!1);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/grass05.js",callback:function(C){var K=D.addInstance(C,"05",!1);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/evergreen_low.js",callback:function(C){var K=D.addInstance(C,"tree1",!0);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/evergreen_high.js",callback:function(C){var K=
D.addInstance(C,"tree2",!0);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/treeGeneric.js",callback:function(C){var K=D.addInstance(C,"tree3",!0);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/treeGenericLower.js",callback:function(C){var K=D.addInstance(C,"tree4",!0);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/treeOrange.js",callback:function(C){var K=D.addInstance(C,"tree5",!0);preInitModel(C,renderer,e,K)}});g.load({model:"files/models/soup/lighthouse.js",
callback:function(C){var K=D.addInstance(C,"light",!1,!0);preInitModel(C,renderer,e,K);D.array[4].maxHeight=12}});this.update=function(C){if(!isNaN(C)&&!(C>1E3||C==0)){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;if(c.camPos.z<=-3290||c.camPos.x>1640||c.camPos.x<-1640){camPos=new THREE.Vector3(0,20,50);h.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);A.reset(c.camPos.x,c.camPos.y,c.camPos.z);E.reset(c.camPos.x,c.camPos.y,
c.camPos.z);z.reset(c.camPos.x,c.camPos.y,c.camPos.z);y.reset(c.camPos.x,c.camPos.y,c.camPos.z)}j%50==49&&y.create(h.emitterFollow.position,h.currentNormal,h.emitter.position);var K=Math.atan2(b.position.z-h.cameraTarget.position.z,b.position.x-h.cameraTarget.position.x);b.up.x=(K-Math.PI/2)/4*-1;++j;var N=0;if(j%4==0){N=(Math.random()-0.5)*0.6;b.up.x+=(Math.random()-0.5)*0.01}if(j%2==0)b.position.y=18+(Math.random()-0.5)*0.6;f+=Math.random();b.position.x=0+Math.sin(f/15)*30+N+(K-Math.PI/2)*-30;b.fov=
60-h.cameraTarget.position.y/25;b.updateProjectionMatrix();if(j%3==2){A.create(n.array[1].position,h.currentNormal);E.create(n.array[1].position,h.currentNormal)}h.update(c.camPos,C);n.update(h.emitterFollow.position,h.currentNormal);z.update(C,n.array[0].position,c.camPos);A.update(C,c.camPos);y.update(C,c.camPos);E.update(C,c.camPos);I.update(c.camPos,K,C);B.update(c.camPos,K,C,!0);D.update(h.emitter.position,h.emitterNormal,c.camPos,C);TWEEN.update();c.trigger.copy(n.array[10].position)}};this.changeCamera=
function(C){d.camera=C;h.settings.camera=C};this.destruct=function(){}},PrairieSoup=function(b,e,c){c.camPos=new THREE.Vector3(302.182,-9.045,-105.662);var d=new THREE.JSONLoader;d.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=0,g=0,j,h,m,n,p,t=new CollisionScene(b,e,1,c,1100);t.settings.maxSpeedDivider=1;t.settings.allowFlying=!1;t.settings.emitterDivider=2;t.settings.shootRayDown=!1;t.settings.keepEmitterFollowDown=
!0;t.settings.normalOffsetAmount=7;t.settings.minDistance=0;t.emitter.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);t.emitterFollow.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);var v=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30);j=new Vectors(30,1,1,v);j.absoluteTrail=!0;var u=THREE.ImageUtils.loadTexture("files/textures/dark_0.png"),w=THREE.ImageUtils.loadTexture("files/textures/dark_1.png"),z=THREE.ImageUtils.loadTexture("files/textures/dark_2.png"),y=THREE.ImageUtils.loadTexture("files/textures/dark_3.png"),
A=THREE.ImageUtils.loadTexture("files/textures/dark_4.png");p=new Particles(20,e,1.5,[u,w,z,y,A],25,40);p.settings.zeroAlphaStart=!1;p.settings.aliveDivider=2;m=new AnimalSwarm5(40,e,j.array);m.settings.xPositionMultiplier=22;m.settings.zPositionMultiplier=18;m.settings.shootRayDown=!0;m.settings.adaptiveSpeed=!0;m.settings.divider=1;m.settings.startPosition=v;m.array[0]="gator";m.array[10]="gator";m.array[5]="goat";m.array[18]="goat";m.array[25]="goat";m.array[2]="octo";m.array[7]="octo";m.array[32]=
"octo";m.array[38]="octo";m.array[3]="animal";m.array[4]="animal";m.array[6]="animal";m.array[8]="animal";m.array[10]="animal";m.array[12]="animal";m.array[15]="animal";m.array[16]="animal";m.array[19]="animal";m.array[20]="animal";m.array[21]="animal";m.array[23]="animal";m.array[24]="animal";m.array[25]="animal";m.array[28]="animal";m.array[29]="animal";m.array[31]="animal";m.array[33]="animal";m.array[22]="shadow";m.array[1]="shadow";m.array[17]="arm";m.array[30]="arm";d.load({model:"files/models/soup/taruffalo_black.js",
callback:function(E){E=m.addAnimal(E,null,0.3,[0,1,0,1],[9.2,14.2]);preinitAnimal(E,c.renderer,e)}});d.load({model:"files/models/soup/animals_A_black.js",callback:function(E){E=m.addAnimal(E,"animal",0.35,[0,0,1,2,1,2,0,2,3],[13.12,9.73,6.7,3.06]);preinitAnimal(E,c.renderer,e)}});d.load({model:"files/models/soup/gator_black.js",callback:function(E){E=m.addAnimal(E,"gator",0.35,null,[4.5]);preinitAnimal(E,c.renderer,e)}});d.load({model:"files/models/soup/goat_black.js",callback:function(E){E=m.addAnimal(E,
"goat",0.45,null,[5.2]);preinitAnimal(E,c.renderer,e)}});d.load({model:"files/models/soup/shdw2.js",callback:function(E){E=m.addAnimal(E,"shadow",0.7,null,[3.5]);preinitAnimal(E,c.renderer,e)}});d.load({model:"files/models/soup/arm_black.js",callback:function(E){E=m.addAnimal(E,"arm",1.5,null,[2.5]);preinitAnimal(E,c.renderer,e)}});d.load({model:"files/models/soup/octo_black.js",callback:function(E){E=m.addAnimal(E,"octo",0.55,[0,0,0,2],[1.629,3,1.7]);preinitAnimal(E,c.renderer,e)}});n=new AnimalSwarm5(10,
e,j.array);n.settings.flying=!0;n.settings.xPositionMultiplier=24;n.settings.zPositionMultiplier=12;n.settings.constantSpeed=2;n.settings.divider=4;n.settings.flyingDistance=0;d.load({model:"files/models/soup/birds_A_black.js",callback:function(E){E=n.addAnimal(E,null,0.4,[1,1,0,0,1,0,0,1,0,0],[12,14]);preinitAnimal(E,c.renderer,e)}});h=new Trail(80,e);for(i=0;i<80;++i)h.array[i]="0"+(i%2+1);h.settings.spread=10;h.settings.aliveDivider=40;h.settings.tweenTime=400;h.settings.scale=5;h.settings.offsetAmount=
10;d.load({model:"files/models/soup/darkBlob1.js",callback:function(E){var B=h.addInstance(E,"01",!1,!1);preInitModel(E,renderer,e,B)}});d.load({model:"files/models/soup/darkBlob2.js",callback:function(E){var B=h.addInstance(E,"02",!1,!1);preInitModel(E,renderer,e,B)}});d.load({model:"files/models/soup/darkBlob3.js",callback:function(E){var B=h.addInstance(E,"03",!1,!1);preInitModel(E,renderer,e,B)}});this.update=function(E){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;
if(c.camPos.x>1090){c.camPos.set(302.182,-9.045,-105.662);t.reset(c.camPos.x,c.camPos.y,c.camPos.z);j.reset(c.camPos.x,c.camPos.y,c.camPos.z);m.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);p.reset(c.camPos.x,c.camPos.y,c.camPos.z)}f+=E;g+=E;t.update(c.camPos,E);j.update(t.emitterFollow.position,t.currentNormal);p.update(E,j.array[0].position);m.update(E,c.camPos);n.update(E,c.camPos);h.update(t.emitter.position,t.emitterNormal,c.camPos,E);if(f>=100){E=Math.random()*
20-10;var B=Math.random()*20-10,I=new THREE.Vector3,D=new THREE.Vector3;I.copy(t.emitterFollow.position);D.copy(t.emitter.position);I.x+=E;D.x+=E;I.z+=B;D.z+=B;m.create(I,t.currentNormal,D);f=0}if(g>=500){n.create(t.emitterFollow.position,t.currentNormal,t.emitter.position);g=0}TWEEN.update();TriggerUtils.effectors[0]=j.array[5].position.x;TriggerUtils.effectors[1]=j.array[5].position.y;TriggerUtils.effectors[2]=j.array[5].position.z;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(0,0,0);c.lavatrailx=
j.array[5].position.x;c.lavatrailz=j.array[5].position.z};this.destruct=function(){}},DunesSoup=function(b,e,c){c.camPos=new THREE.Vector3(0,150,0);var d=new THREE.JSONLoader;d.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};d.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=new CollisionScene(b,e,0.15,c,3E3);f.settings.emitterDivider=5;f.settings.maxSpeedDivider=2;f.settings.allowFlying=!0;f.settings.normalOffsetAmount=50;var g=new Vectors;g.settings.divider=4;var j=
[new THREE.MeshBasicMaterial({color:14283771,opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,opacity:0.25})],h=new Ribbons(6,g.array,e,j);h.settings.ribbonPulseMultiplier_1=20;h.settings.ribbonPulseMultiplier_2=0.01;h.settings.ribbonMin=0.3;h.settings.ribbonMax=
0.4;var m=new AnimalSwarm(20,e,g.array);m.settings.flying=!0;m.settings.flyingDistance=10;m.settings.divider=10;m.settings.constantSpeed=0.8;for(j=0;j<20;++j)j%2==0&&(m.array[j]="b");d.load({model:"files/models/soup/birds_A_life.js",callback:function(n){n=m.addAnimal(n,null,1.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,e)}});d.load({model:"files/models/soup/birds_B_life.js",callback:function(n){n=m.addAnimal(n,"b",1.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,e)}});this.update=
function(n){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;f.update(c.camPos,n);g.update(f.emitterFollow.position,f.currentNormal);h.update(f.emitterFollow.position);m.update()};this.destruct=function(){}},Ribbon=function(b,e,c){b=b||100;e=e||10;c=c||10;THREE.Geometry.call(this);e/=2;b/=c;for(var d=[],f=0;f<c+2;++f){var g=f*b,j=-e;d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,e,0)))-1);d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,
j,0)))-1)}for(f=0;f<c*2;f+=2){this.faces.push(new THREE.Face3(d[f],d[f+2],d[f+1]));this.faces.push(new THREE.Face3(d[f+2],d[f+3],d[f+1]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,e){var c=ROME.AnimalAnimationData.init(b,e),d={};d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.availableAnimals=c.availableAnimals;d.mesh=new THREE.Mesh(b,c.material);var f=!1,g=d.mesh.morphTargetForcedOrder,j=c.material;d.play=function(m,n,p,t,v){if(!f){f=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}n=
n!==undefined?n:m;h(m,d.animalA);h(n,d.animalB);d.animalA.currentTime=t?t:0;d.animalB.currentTime=v?v:0;d.update(0)};d.update=function(m){if(d.mesh._modelViewMatrix){var n,p=["animalA","animalB"],t,v,u,w,z,y;t=0;v=p.length;for(y=0;t<v;t++){n=d[p[t]];z=n.currentTime;n.currentTime=(n.currentTime+m*n.timeScale)%n.lengthInMS;if(z>n.currentTime)n.currentFrame=0;z=0;u=n.currentFrame;for(w=n.lengthInFrames-1;u<w;u++)if(n.currentTime>=n.frames[u].time&&n.currentTime<n.frames[u+1].time){z=u;break}n.currentFrame=
z;u=z+1<w?z+1:0;g[y++]=n.frames[z].index;g[y++]=n.frames[u].index;z=n.frames[z].time;u=n.frames[u].time>z?n.frames[u].time:n.frames[u].time+n.lengthInMS;n=(n.currentTime-z)/(u-z);j.uniforms[p[t]+"Interpolation"].value=n}j.uniforms.animalMorphValue.value=d.morph;if(j.attributes[d.animalA.name]!==undefined)j.attributes.colorAnimalA.buffer=j.attributes[d.animalA.name].buffer;if(j.attributes[d.animalB.name]!==undefined)j.attributes.colorAnimalB.buffer=j.attributes[d.animalB.name].buffer}};d.setNewTargetAnimal=
function(m,n){if(d.morph===1){for(var p in d.animalA)d.animalA[p]=d.animalB[p];d.animalB.currentTime=n?n:0;h(m,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var h=function(m,n){if(ROME.AnimalAnimationData[m]!==undefined){n.frames=ROME.AnimalAnimationData[m];n.lengthInFrames=n.frames.length;n.lengthInMS=n.frames[n.lengthInFrames-1].time;n.name=m.toLowerCase();n.normalsOffset=Math.floor(n.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
m)};return d};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 0.7 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 ) * vec4( 0.9, 0.85, 0.8, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["tarbuffalo","horse","bearbrown","mountainlion","deer","goldenRetreiver","fox","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","shdw2","blackWidow","crab","scorp","goat","gator","tarbuffalo_runB","tarbuffalo","bearblack","panther","wolf","toad","eagle","owl","parrot","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD",
"raven","vulture","bison","sickle","armHand"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.25,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,
hOffset:0,sOffset:0,vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.4},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:0.1},cow:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0.05,vOffset:0},cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,
sRange:0,vRange:0.15,hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,
sOffset:0.05,vOffset:0},frog:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.01,sOffset:0,vOffset:0},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.21},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,sRange:0.1,vRange:0.25,hOffset:-0.005,sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},
moose:{hRange:0.07,sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.005,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},parrot:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.025,sOffset:0.1,vOffset:-0.1},raccoon:{hRange:0,sRange:0,vRange:0.25,hOffset:0,sOffset:-0.2,vOffset:-0.15},raven:{hRange:0.02,sRange:0.1,
vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:0},shdw2:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},sickle:{hRange:0.04,sRange:0,vRange:0.05,hOffset:0,sOffset:-0.2,vOffset:-0.1},stork:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.15},
toad:{hRange:0.07,sRange:0,vRange:0.2,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.12,hOffset:0,sOffset:-0.1,vOffset:-0.135},wolf:{hRange:0,sRange:0.2,vRange:0.125,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",bearbrown:"bearBrown",bearblack:"bearBlack",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",
chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",mountainlion:"mountainlion",mountainlionblack:"panther",owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",
toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,e){if(b.initialized){p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,morphTargets:!0});for(j in b.customAttributes){var c=b.customAttributes[j];p.attributes[j]=j==="colorAnimalA"||j==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,
needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var d,f,g;p=b.morphTargets;var j,h,m,n;if(e){h=0;for(m=p.length;h<m;h++){j=0;for(g=this.animalNames.length;j<g;j++){f=this.animalNames[j];if(p[h].name.indexOf(f)!==-1)break}if(j===g){f=p[h].name;for(j=0;j<f.length;j++){g=f.charCodeAt(j);if(!(g>=65&&g<=90||g>=97&&g<=122))break}this.animalNames.push(f.slice(0,j))}}}j=0;for(g=this.animalNames.length;j<g;j++){f=this.animalNames[j];d=this[f];n=0;if(d===undefined||d.length===0){d=this[f]=
[];h=0;for(m=p.length;h<m;h++)if(p[h].name.indexOf(f)!==-1){d.push({index:h,time:n});n+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{h=0;for(m=p.length;h<m;h++)c.indexOf(f)===-1&&p[h].name.indexOf(f)!==-1&&c.push(f)}}var p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:ROME.AnimalShader.attributes(),vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors}),t;d=b.morphColors;
n=p.attributes;if(b.morphColors&&b.morphColors.length){h=0;for(m=d.length;h<m;h++){t=d[h];f=t.name;for(j=0;j<f.length;j++){g=f.charCodeAt(j);if(!(g>=65&&g<=90||g>=97&&g<=122))break}f=f.slice(0,j).toLowerCase();n[f]={type:"c",boundTo:"faces",value:t.colors};j=this.colorVariations.zero;this.animalVariationMap[f]!==undefined&&(j=this.colorVariations[this.animalVariationMap[f]]);p.uniforms.lightScale.value=j.lScale?j.lScale:0.5;j.lOffset?p.uniforms.lightOffset.value.set(j.lOffset[0],j.lOffset[1],j.lOffset[2]):
p.uniforms.lightOffset.value.set(0.6,0.6,0.6);randomizeColors(n[f].value,j)}n.colorAnimalA.value=d[0].colors;n.colorAnimalB.value=d[0].colors;j=0;for(g=c.length;j<g;j++){f=c[j].toLowerCase();h=0;for(m=d.length;h<m;h++){t=d[h].name.toLowerCase();if(t.indexOf(f)!==-1)break}if(h===m){console.error("Animal.constructor: Morph Color missing for animal "+f+". Deploying backup plan.");n[f]={type:"c",boundTo:"faces",value:[]};h=0;for(m=b.faces.length;h<m;h++)n[f].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");
h=0;for(m=b.faces.length;h<m;h++)n.colorAnimalA.value.push(new THREE.Color(16711935));n.colorAnimalB.value=n.colorAnimalA.value;j=0;for(g=c;j<g;j++)n[c[j]]={type:"c",boundTo:"faces",value:n.colorAnimalA.value}}b.availableAnimals=c;b.customAttributes=p.attributes}return{availableAnimals:b.availableAnimals,material:p}}};
function randomizeColors(b,e){var c,d,f,g,j,h;c=0;for(d=b.length;c<d;c++){f=b[c];g=e.hRange*Math.random()+e.hOffset;j=e.sRange*Math.random()+e.sOffset;h=e.vRange*Math.random()+e.vOffset;THREE.ColorUtils.adjustHSV(f,g,j,h)}}
var Ribbons=function(b,e,c,d){var f=this,g=[],j=[];f.initSettings={numOfRibbons:b||6};f.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var h=0,m;for(m=0;m<f.initSettings.numOfRibbons;++m){var n=new Ribbon(15,6,e.length-35),p=new THREE.Mesh(n,d[m%d.length]);p.doubleSided=!0;c.addObject(p);g.push({r:n,rm:p,offset:3+Math.floor(Math.random()*10)});j.push(p)}this.update=function(t){h+=0.1;for(m=0;m<e.length;++m)for(var v=e[m].position.x,u=e[m].position.y,
w=e[m].position.z,z=0;z<b;++z){var y=g[z].r,A=g[z].offset;if(!(m<A)){var E=Math.cos((m-h*10)/10)*f.settings.ribbonPulseMultiplier_1,B=Math.cos((m-h*10)/8)*f.settings.ribbonPulseMultiplier_2,I=z*(Math.PI*2/g.length),D=Math.cos(I+(m-h*10)/8)*E;E*=Math.sin(I+(m-h*10)/8);for(I=0;I<2;++I){var C=(m-A)*2+I;if(y.vertices[C]!=undefined){var K=m-h*2,N=Math.max(f.settings.ribbonMin,m/(10+B));N=Math.min(N,f.settings.ribbonMax);var L=Math.cos(K/3)*N;K=Math.sin(K/3)*N;y.vertices[C].position.x=v-t.x+L+D;if(I==0){y.vertices[C].position.y=
u+K+E-t.y;y.vertices[C].position.z=w+L+D-t.z}else{y.vertices[C].position.y=u-K+E-t.y;y.vertices[C].position.z=w-L+D-t.z}}}}}for(m=0;m<g.length;++m){v=g[m].rm;v.position=t;y=g[m].r;y.__dirtyVertices=!0;v.visible=f.settings.visible}}},Vectors=function(b,e,c,d){var f=this;f.array=[];var g;f.initSettings={length:b||50};f.settings={divider:e||4,normaldivider:c||10,absoluteTrail:!1,startPosition:d||new THREE.Vector3(0,0,0)};for(g=0;g<f.initSettings.length;++g){b=new THREE.Vector3(0,0,0);b.copy(f.settings.startPosition);
b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};f.array.push(b)}this.update=function(j,h){for(g=0;g<f.initSettings.length;++g){var m=f.array[g];if(g==0)var n=j.x,p=j.y,t=j.z,v=h.x,u=h.y,w=h.z;else{n=f.array[g-1].lastposition.x;p=f.array[g-1].lastposition.y;t=f.array[g-1].lastposition.z;v=f.array[g-1].normal.x;u=f.array[g-1].normal.y;w=f.array[g-1].normal.z}f.array[g].lastposition.x=m.position.x;f.array[g].lastposition.y=m.position.y;f.array[g].lastposition.z=
m.position.z;if(f.settings.absoluteTrail){m.position.x=n;m.position.y=p;m.position.z=t;m.normal.x=v;m.normal.y=u;m.normal.z=w}else{p=(p-m.position.y)/f.settings.divider;t=(t-m.position.z)/f.settings.divider;m.position.x+=(n-m.position.x)/f.settings.divider;m.position.y+=p;m.position.z+=t;n=(u-m.normal.y)/f.settings.normaldivider;w=(w-m.normal.z)/f.settings.normaldivider;m.normal.x+=(v-m.normal.x)/f.settings.normaldivider;m.normal.y+=n;m.normal.z+=w}}};this.reset=function(j,h,m){for(var n=0;n<f.array.length;++n){var p=
f.array[n];p.position.x=j;p.position.y=h;p.position.z=m}}},Particles=function(b,e,c,d,f,g,j){var h=this,m=[];j=j||THREE.NormalBlending;h.initSettings={numOfParticleSystems:b||25,numInSystem:f||60,spread:g||50,particleSize:c||8};h.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var n;c=new THREE.Geometry;for(n=0;n<h.initSettings.numInSystem;n++){f=new THREE.Vector3(Math.random()*h.initSettings.spread-h.initSettings.spread/2,Math.random()*h.initSettings.spread-h.initSettings.spread/
2,Math.random()*h.initSettings.spread-h.initSettings.spread/2);c.vertices.push(new THREE.Vertex(f))}for(n=0;n<h.initSettings.numOfParticleSystems;n++){f=new THREE.ParticleBasicMaterial({size:h.initSettings.particleSize,map:d[n%d.length],transparent:!0,depthTest:!0,blending:j});f=new THREE.ParticleSystem(c,f);f.rotation.x=Math.random()*Math.PI;f.rotation.y=Math.random()*Math.PI;f.rotation.z=Math.random()*Math.PI;m.push({c:f,alivetime:n});e.addObject(f)}this.update=function(p,t,v){if(isNaN(p)||p>1E3)p=
1E3/60;p/=60;for(n=0;n<b;++n){var u=m[n].c;m[n].alivetime+=p/h.settings.aliveDivider;if(m[n].alivetime>=b){m[n].alivetime=0;u.scale.x=u.scale.y=u.scale.z=0.1;u.position.x=t.x;u.position.y=t.y;u.position.z=t.z;if(h.settings.gravitateTowardsCamera){var w=-100;t.x>v.x&&(w=100);m[n].c.tox=t.x-w;m[n].c.toy=0;m[n].c.toz=t.z-100;w=u.position.x-m[n].c.tox;var z=u.position.y-m[n].c.toy,y=u.position.z-m[n].c.toz;w=1E3+Math.abs(w*w+z*z+y*y)/25;u.position.y=t.y+50;u.rotation.x=Math.random()*Math.PI+Math.PI/2;
u.rotation.y=Math.random()*Math.PI;u.rotation.z=Math.random()*Math.PI+Math.PI/2;u.scale.x=u.scale.y=u.scale.z=1.25;(new TWEEN.Tween(u.position)).to({x:m[n].c.tox,y:m[n].c.toy,z:m[n].c.toz},w).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(u.rotation)).to({x:0,z:0},w).easing(TWEEN.Easing.Quadratic.EaseIn).start();(new TWEEN.Tween(u.scale)).to({x:5,y:0.05,z:5},w).easing(TWEEN.Easing.Linear.EaseNone).start()}u.materials[0].opacity=h.settings.zeroAlphaStart?0:1}else{w=m[n].alivetime;if(!h.settings.gravitateTowardsCamera){u.position.y+=
0.1;u.rotation.y+=0.015;u.rotation.z+=0.01;u.scale.x=u.scale.y=u.scale.z=0.5+Math.max(w/15,1)}w=h.settings.zeroAlphaStart?w/4:1-w/(m.length*2);w=Math.min(w,1);u.materials[0].opacity=w}}};this.reset=function(p,t,v){for(var u=0;u<m.length;++u){var w=m[u].c;w.position.x=p;w.position.y=t;w.position.z=v}}},AnimalSwarm=function(b,e,c){var d=this;d.array=[];var f=0,g=0,j=0;d.initSettings={numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,
constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var h=0,m;this.addAnimal=function(n,p,t,v,u,w,z){p=p||null;var y=t||1.2;v=v||null;u=u||4;z=z||!1;for(m=0;m<d.initSettings.numOfAnimals;++m)if(!(p==null&&d.array[m]!=undefined||p!=d.array[m])){t=new THREE.Color(Math.random()*16777215);w!=undefined&&w!=null&&(t=w[m%w.length]);var A=ROME.Animal(n,!1,t),E=A.mesh;E.position.copy(d.settings.startPosition);E.doubleSided=z;var B=
Math.floor(m/u);t=0.02+Math.random()/8;if(m<2){t=0.15;B=m}B>f&&(f=B);t=Math.max(t,0.1);E.matrixAutoUpdate=!1;e.addChild(E);var I=0,D=0;if(v!=null){I=v[m%v.length]%A.availableAnimals.length;D=Math.floor(Math.random()*A.availableAnimals.length)}A.play(A.availableAnimals[I],A.availableAnimals[D],0,Math.random(),Math.random());I=Math.random();m<2&&(I=0);D=m%2==0;ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);d.array[m]={c:E,a:A,f:B,count:I,clockwise:D,scale:t*y,ray:ray}}return A};this.update=
function(n){h+=0.1;if(isNaN(n)||n>1E3||n==0)n=1E3/60;g=Math.round(h/4);for(m=0;m<d.initSettings.numOfAnimals;++m){var p=d.array[m],t=p.c,v=p.f,u=p.scale,w=p.clockwise;if(g!=j&&d.settings.switchPosition){if(w)++d.array[m].f;else--d.array[m].f;if(d.array[m].f>f){d.array[m].clockwise=!1;d.array[m].f=f}if(d.array[m].f<=0){d.array[m].clockwise=!0;d.array[m].f=0}v=d.array[m].f}var z=m*(Math.PI*2/6),y=Math.cos(z+(m-h*2)/8)*d.settings.xPositionMultiplier,A=Math.sin(z+(m-h*2)/8)*d.settings.zPositionMultiplier,
E=A;v>=c.length-1&&(v=c.length-1);var B=c[v].normal,I=1-Math.abs(B.x),D=1-Math.abs(B.z),C=1-Math.abs(B.y),K=c[v].position.x+y*I,N=c[v].position.y+E*C;p=c[v].position.z+A*D;if(!w){K=c[v].position.x-y*I;N=c[v].position.y-E*C;p=c[v].position.z-A*D}B.y>0.5&&(N=c[v].position.y-10.5);if(d.settings.capy!=null&&N<d.settings.capy)N=d.settings.capy;if(d.settings.flying){w=d.settings.flyingDistance+Math.abs(Math.sin((z+Math.cos((m-h*10)/15)*10)/10)*30);B.x<-0.8&&(K-=w);B.x>0.8&&(K+=w);if(B.y<-0.8||B.y>0.8)N+=
w;B.z<-0.8&&(p-=w);B.z>0.8&&(p+=w)}d.array[m].count+=0.01;B=Math.max(Math.cos(d.array[m].count),0);B=Math.min(B,1);d.array[m].a.morph=B;if(d.settings.constantSpeed!=null){d.array[m].a.animalA.timeScale=d.settings.constantSpeed;d.array[m].a.animalB.timeScale=d.settings.constantSpeed}K=(K-t.position.x)/10;N=(N-t.position.y)/10;p=(p-t.position.z)/10;B=n/3;N>B&&(N=B);N<-B&&(N=-B);K>B&&(K=B);K<-B&&(K=-B);p>B&&(p=B);p<-B&&(p=-B);B=new THREE.Vector3(t.position.x+K,t.position.y+N,t.position.z+p);B.subSelf(t.position).normalize();
w=new THREE.Vector3;v=new THREE.Vector3(c[v].normal.x*-1,c[v].normal.y*-1,c[v].normal.z*-1);d.settings.flying&&!d.settings.butterfly&&(v=new THREE.Vector3(0,-1,0));w.cross(B,v);v.cross(B,w);t.matrixWorld.n11=w.x*u;t.matrixWorld.n12=v.x*u;t.matrixWorld.n13=B.x*u;t.matrixWorld.n14=t.position.x;t.matrixWorld.n21=w.y*u;t.matrixWorld.n22=v.y*u;t.matrixWorld.n23=B.y*u;t.matrixWorld.n24=t.position.y;t.matrixWorld.n31=w.z*u;t.matrixWorld.n32=v.z*u;t.matrixWorld.n33=B.z*u;t.matrixWorld.n34=t.position.z;if(d.settings.addaptiveSpeed){u=
t.position.x-(t.position.x+K);v=t.position.y-(t.position.y+N);B=t.position.z-(t.position.z+p);u=Math.max(Math.abs(u*u+v*v+B*B)/n,0.8);u=Math.min(u,2);d.array[m].a.animalA.timeScale=u;d.array[m].a.animalB.timeScale=u}t.position.x+=K;t.position.y+=N;t.position.z+=p;t.visible=d.settings.visible}j=g};this.reset=function(n,p,t){for(var v=0;v<d.array.length;++v){var u=d.array[v].c;u.position.x=n;u.position.y=p;u.position.z=t}}},AnimalSwarm3=function(b,e,c){var d=this;d.array=[];new THREE.Vector3;d.initSettings=
{numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var f;this.addAnimal=function(g,j,h,m,n){j=j||null;var p=h||1.2;m=m||null;for(f=0;f<d.initSettings.numOfAnimals;++f)if(!(j==null&&d.array[f]!=undefined||j!=d.array[f])){n==null&&(n=[1]);var t=ROME.Animal(g,!1),v=t.mesh;v.position.copy(d.settings.startPosition);
h=0.02+Math.random()/8;f<2&&(h=0.15);h=Math.max(h,0.1);v.matrixAutoUpdate=!1;v.visible=!1;e.addChild(v);var u=0,w=0;if(m!=null){u=m[f%m.length]%t.availableAnimals.length;w=u+1;if(Math.round(Math.random())==1&&u>0||w>t.availableAnimals.length-1)w=u-1}var z=n[u],y=n[w];t.play(t.availableAnimals[u],t.availableAnimals[w],0,Math.random(),Math.random());var A=Math.random();f<2&&(A=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);h={c:v,a:t,f:0,time:0,lifetime:0,dead:!1,startMorph:u,endMorph:w,
speeda:z,speedb:y,active:!1,normal:new THREE.Vector3(0,1,0),count:A,scale:h*p,origscale:h*p,ray:ray};d.array[f]=h}};this.removeAnimal=function(g,j){for(f=0;f<d.initSettings.numOfAnimals;++f){var h=d.array[f].a;if(h!=undefined){var m=d.array[f].startMorph,n=d.array[f].endMorph;if(h.mesh.geometry==g&&(j==m||j==n)){e.removeChild(d.array[f].c);delete d.array[f].a;d.array[f].active=!1;break}}}};this.switchAnimal=function(g,j,h,m,n){var p=j||1.2;for(f=0;f<d.initSettings.numOfAnimals;++f){n!=undefined&&
(f=n);j=d.array[f].a;var t=d.array[f].startMorph,v=d.array[f].endMorph;if(!(j!=undefined&&j.mesh.geometry==g&&n==undefined&&(t==m||v==m))){console.log("adding on "+f);n=d.array[f].c.position;g=ROME.Animal(g,!1);t=g.mesh;j=0.02+Math.random()/8;f<2&&(j=0.15);j=Math.max(j,0.1);t.position=n;t.visible=!1;t.scale.set(1.0E-5,1.0E-5,1.0E-5);t.updateMatrix();t.matrixAutoUpdate=!1;e.removeChild(d.array[f].c);e.addChild(t);g.play(g.availableAnimals[m],g.availableAnimals[m],0,Math.random(),Math.random());d.array[f].c=
t;d.array[f].a=g;d.array[f].scale=j*p;d.array[f].origscale=j*p;d.array[f].speeda=h;d.array[f].speedb=h;d.array[f].active=!1;d.array[f].startMorph=m;d.array[f].endMorph=m;break}}};this.create=function(g,j){for(f=0;f<d.initSettings.numOfAnimals;++f)if(!(d.array[f].active||d.array[f].a==undefined)){d.array[f].active=!0;d.array[f].c.position.copy(g);d.array[f].normal.copy(j);d.array[f].c.visible=!0;d.array[f].f=0;d.array[f].time=0;d.array[f].lifetime=0;d.array[f].dead=!1;d.array[f].scale*=0.25;(new TWEEN.Tween(d.array[f])).to({scale:d.array[f].origscale},
2E3).easing(TWEEN.Easing.Elastic.EaseOut).delay(200).start();var h=d.array[f].scale;d.array[f].c.position.x-=j.x*h*180;d.array[f].c.position.y-=j.y*h*180;d.array[f].c.position.z-=j.z*h*180;break}};this.update=function(g){if(isNaN(g)||g>1E3||g==0)g=1E3/60;for(f=0;f<d.initSettings.numOfAnimals;++f){var j=d.array[f];if(j.active){var h=j.c,m=j.scale,n=j.f,p=d.array[f].dead;d.array[f].time+=g;d.array[f].lifetime+=g;if(d.array[f].lifetime>2500)d.array[f].dead=!0;d.array[f].count+=0.04;var t=Math.max(Math.cos(d.array[f].count),
0);t=Math.min(t,1);d.array[f].a.morph=t;var v=j.speeda;if(Math.round(t)==1)v=j.speedb;if(d.array[f].time>Math.max(v*25,80)){++d.array[f].f;if(d.array[f].f>=40){d.array[f].f=40;d.array[f].dead=!0}n=d.array[f].f;d.array[f].time=0}t=f*(Math.PI*2/6);var u=Math.sin(t+(f-0)/8)*d.settings.zPositionMultiplier;j=c[n].normal;t=c[n].position.x+Math.cos(t+(f-0)/8)*d.settings.xPositionMultiplier*(1-Math.abs(j.x));var w=c[n].position.y+u*(1-Math.abs(j.y));u=c[n].position.z+u*(1-Math.abs(j.z));j.y>0.5&&(w=c[n].position.y-
10);if(d.settings.capy!=null&&w<d.settings.capy)w=d.settings.capy;if(d.settings.flying){var z=d.settings.flyingDistance;j.x<-0.8&&(t-=z);j.x>0.8&&(t+=z);if(j.y<-0.8||j.y>0.8)w+=z;j.z<-0.8&&(u-=z);j.z>0.8&&(u+=z)}if(d.settings.constantSpeed!=null){d.array[f].a.animalA.timeScale=d.settings.constantSpeed;d.array[f].a.animalB.timeScale=d.settings.constantSpeed}t=(t-h.position.x)/7;w=(w-h.position.y)/7;u=(u-h.position.z)/7;d.array[f].dead&&!p&&(new TWEEN.Tween(d.array[f])).to({scale:d.array[f].scale*0.1},
400).easing(TWEEN.Easing.Quartic.EaseIn).start();if(d.array[f].dead&&m<=0.1){d.array[f].active=!1;d.array[f].c.visible=!1}else{n=v/(2+n/10);w>n&&(w=n);w<-n&&(w=-n);t>n&&(t=n);t<-n&&(t=-n);u>n&&(u=n);u<-n&&(u=-n);n=new THREE.Vector3(h.position.x+t,h.position.y+w,h.position.z+u);n.subSelf(h.position).normalize();p=new THREE.Vector3;j=new THREE.Vector3(j.x*-1,j.y*-1,j.z*-1);d.settings.flying&&!d.settings.butterfly&&(j=new THREE.Vector3(0,-1,0));p.cross(n,j);j.cross(n,p);h.matrixWorld.n11=p.x*m;h.matrixWorld.n12=
j.x*m;h.matrixWorld.n13=n.x*m;h.matrixWorld.n14=h.position.x;h.matrixWorld.n21=p.y*m;h.matrixWorld.n22=j.y*m;h.matrixWorld.n23=n.y*m;h.matrixWorld.n24=h.position.y;h.matrixWorld.n31=p.z*m;h.matrixWorld.n32=j.z*m;h.matrixWorld.n33=n.z*m;h.matrixWorld.n34=h.position.z;h.position.x+=t;h.position.y+=w;h.position.z+=u}}}};this.reset=function(g,j,h){for(var m=0;m<d.initSettings.numOfAnimals;++m){var n=d.array[m].c;n.position.x=g;n.position.y=j;n.position.z=h;d.array[m].active=!1}}},AnimalSwarm5=function(b,
e,c){var d=this;d.array=[];new THREE.Vector3;d.initSettings={numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var f;this.addAnimal=function(g,j,h,m,n){j=j||null;var p=h||1.2;m=m||null;for(f=0;f<d.initSettings.numOfAnimals;++f)if(!(j==null&&d.array[f]!=undefined||j!=d.array[f])){n==null&&(n=[1]);var t=
ROME.Animal(g,!1),v=t.mesh;v.position.copy(d.settings.startPosition);h=0.02+Math.random()/8;f<2&&(h=0.15);h=Math.max(h,0.1);v.matrixAutoUpdate=!1;v.visible=!1;e.addChild(v);var u=0,w=0;if(m!=null){u=m[f%m.length]%t.availableAnimals.length;w=u+1;if(Math.round(Math.random())==1&&u>0||w>t.availableAnimals.length-1)w=u-1}var z=n[u],y=n[w];t.play(t.availableAnimals[u],t.availableAnimals[w],0,Math.random(),Math.random());u=Math.random();f<2&&(u=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,
0);h={c:v,a:t,f:0,time:0,lifetime:0,dead:!1,speeda:z,speedb:y,active:!1,toPosition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),count:u,scale:h*p,origscale:h*p,ray:ray};d.array[f]=h}return t};this.switchAnimal=function(g,j,h){console.log("switch");var m=j||1.2;h=h||0;g=ROME.Animal(g,!1);var n=g.mesh;j=0.02+Math.random()/8;f<2&&(j=0.15);j=Math.max(j,0.1);n.matrixAutoUpdate=!1;e.removeChild(d.array[h].c);e.addChild(n);g.play(g.availableAnimals[0],g.availableAnimals[0],0,Math.random(),Math.random());
d.array[h].c=n;d.array[h].a=g;d.array[h].scale=j*m};this.create=function(g,j,h){for(f=0;f<d.initSettings.numOfAnimals;++f)if(!d.array[f].active){var m=new THREE.Vector3,n=new THREE.Vector3;m.copy(g);n.copy(h);d.array[f].active=!0;d.array[f].c.position=m;d.array[f].normal.copy(j);d.array[f].c.visible=!0;d.array[f].f=0;d.array[f].time=0;d.array[f].lifetime=0;d.array[f].dead=!1;d.array[f].scale=d.array[f].origscale;d.array[f].toPosition=n.subSelf(m).normalize();d.array[f].toPosition.x<0&&(d.array[f].toPosition.x*=
-1);d.array[f].toPosition.x<0.5&&(d.array[f].toPosition.x+=0.5);d.array[f].toPosition.z<0&&(d.array[f].toPosition.z+=0.5);g=d.array[f].scale;d.array[f].c.position.x-=j.x*g*400;d.array[f].c.position.y-=j.y*g*400;d.array[f].c.position.z-=j.z*g*400;break}};this.update=function(g,j){if(isNaN(g)||g>1E3||g==0)g=1E3/60;for(f=0;f<d.initSettings.numOfAnimals;++f){var h=d.array[f];if(h.active){var m=h.c,n=h.scale,p=h.normal,t=h.f,v=d.array[f].dead;d.array[f].time+=g;d.array[f].lifetime+=g;if(d.array[f].lifetime>
2500)d.array[f].dead=!0;d.array[f].count+=0.04;var u=Math.max(Math.cos(d.array[f].count),0);u=Math.min(u,1);d.array[f].a.morph=u;var w=h.speeda;if(Math.round(u)==1)w=h.speedb;var z=m.position.x+d.array[f].toPosition.x*100,y=m.position.y+d.array[f].toPosition.y*100;u=m.position.z+d.array[f].toPosition.z*100;p.y>0.5&&(y=c[t].position.y-10);if(d.settings.capy!=null&&y<d.settings.capy)y=d.settings.capy;d.settings.flying&&(y=d.array[f].toPosition.y+d.settings.flyingDistance);if(d.settings.constantSpeed!=
null){d.array[f].a.animalA.timeScale=d.settings.constantSpeed;d.array[f].a.animalB.timeScale=d.settings.constantSpeed}if(d.settings.shootRayDown){h=h.ray;h.origin.copy(m.position);h.origin.y+=500;if(t=e.collisions.rayCastNearest(h)){y=h.origin.y-(t.distance*1+3);p=t.mesh.matrixRotationWorld.multiplyVector3(t.normal).normalize()}}h=2;d.settings.flying&&(h=8);d.array[f].dead&&!v&&(new TWEEN.Tween(d.array[f])).to({scale:d.array[f].scale*0.1},400).easing(TWEEN.Easing.Quartic.EaseIn).start();v=(z-m.position.x)/
4;y=(y-m.position.y)/h;u=(u-m.position.z)/4;if(d.array[f].dead&&n<=0.01){d.array[f].active=!1;d.array[f].c.visible=!1}else{w/=15;v>w&&(v=w);v<-w&&(v=-w);u>w&&(u=w);u<-w&&(u=-w);w=new THREE.Vector3(m.position.x+v,m.position.y+y,m.position.z+u);w.subSelf(m.position).normalize();z=new THREE.Vector3;p=new THREE.Vector3(p.x*-1,p.y*-1,p.z*-1);d.settings.flying&&(p=new THREE.Vector3(0,-1,0));z.cross(w,p);p.cross(w,z);m.matrixWorld.n11=z.x*n;m.matrixWorld.n12=p.x*n;m.matrixWorld.n13=w.x*n;m.matrixWorld.n14=
m.position.x+v;m.matrixWorld.n21=z.y*n;m.matrixWorld.n22=p.y*n;m.matrixWorld.n23=w.y*n;m.matrixWorld.n24=m.position.y+y;m.matrixWorld.n31=z.z*n;m.matrixWorld.n32=p.z*n;m.matrixWorld.n33=w.z*n;m.matrixWorld.n34=m.position.z+u;m.position.x+=v;m.position.y+=y;m.position.z+=u;if(m.position.x<j.x-100){d.array[f].active=!1;d.array[f].c.visible=!1}}}}};this.reset=function(g,j,h){for(var m=0;m<d.initSettings.numOfAnimals;++m){var n=d.array[m].c;n.position.x=g;n.position.y=j;n.position.z=h;d.array[m].active=
!1}}},AnimalInFrontOfCamera=function(b,e){var c=this,d=[];c.initSettings={numOfAnimals:b||30};c.settings={};var f=0,g,j=new THREE.Cube(10,10,10),h=new THREE.Mesh(j);e.addChild(h);this.addAnimal=function(m){for(var n=0;n<c.initSettings.numOfAnimals;++n){var p=ROME.Animal(m,!1),t=p.mesh,v=0.02+Math.random()/8,u=Math.random()*120-60,w=n*10-10,z=Math.random()*120-60;t.position.x=u;t.position.y=w;t.position.z=z;h.addChild(t);p.animalA.timeScale=0.8;p.animalB.timeScale=0.8;p.play(p.availableAnimals[0],
p.availableAnimals[0],0,Math.random());d.push({c:t,x:u,y:w,z:z,a:p,scale:v*1.5})}};this.update=function(m,n,p,t){f+=0.1;h.position=m;if(!t){h.position.x-=Math.cos(n)*110;h.position.z-=Math.sin(n)*110}if(isNaN(p)||p>1E3)p=1E3/60;for(g=0;g<c.initSettings.numOfAnimals;++g){var v=d[g];m=v.c;n=v.x;t=v.y;v=v.z;var u=Math.sin(g-f);n+=Math.cos(g-f);t+=0.5*(p/20);v+=u;t>140&&(t=-10);m.lookAt(new THREE.Vector3(n,t,v));m.position.x=n;m.position.y=t;m.position.z=v;d[g].x=n;d[g].y=t;d[g].z=v}}},Trail=function(b,
e){var c=this;c.array=[];c.initSettings={numOfInstances:b||100};c.settings={spread:70,visible:!0,aliveDivider:c.initSettings.numOfInstances,tweenTime:2500,scale:1,offsetAmount:6,freeRotation:!0};var d;this.addInstance=function(f,g,j,h,m){g=g||null;j=j||!1;h=h||!1;for(d=0;d<c.initSettings.numOfInstances;++d)if(!(g==null&&c.array[d]!=undefined||g!=c.array[d])){var n=m==undefined?new THREE.Mesh(f,new THREE.MeshFaceMaterial):new THREE.Mesh(f,m[d%m.length]);n.scale.x=n.scale.y=n.scale.z=1.0E-8;var p={c:n,
alivetime:d,normal:new THREE.Vector3,tree:j,lightHouse:h};e.addObject(n);c.array[d]=p}return n};this.update=function(f,g,j,h){if(isNaN(h)||h>1E3)h=1E3/60;h/=c.settings.aliveDivider;for(d=0;d<c.array.length;++d){var m=c.array[d],n=m.c,p=m.alivetime,t=m.tree;m=m.lightHouse;p+=h;if(p>c.initSettings.numOfInstances){n.position.x=f.x;n.position.y=f.y;n.position.z=f.z;n.rotation.x=0;n.rotation.z=0;n.rotation.y=0;p=c.settings.offsetAmount;t&&(p=c.settings.offsetAmount+2);var v=0,u=0,w=0;if(c.settings.freeRotation){n.position.x=
f.x-g.x*p;n.position.y=f.y-g.y*p;n.position.z=f.z-g.z*p;n.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(g.x));n.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(g.z));n.rotation.x=0;n.rotation.z=0;n.rotation.y=Math.random()*Math.PI;n.up.copy(g);n.lookAt(n.position)}else{if(g.x<-0.5){n.position.x=f.x+p/2;n.rotation.z=1.57;n.rotation.x=Math.random()*Math.PI;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=0;v=n.rotation.x;u=n.rotation.y}n.position.y+=
Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.x>0.5){n.position.x=f.x-p/2;n.rotation.z=-1.57;if(t){w=n.rotation.z+(Math.random()-0.5);n.rotation.z=0;v=n.rotation.x;u=n.rotation.y}n.rotation.x=Math.random()*Math.PI;n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.y<-0.9){n.position.y=f.y+p;n.rotation.y=Math.random()*Math.PI;if(t){w=n.rotation.z+
(Math.random()-0.5);n.rotation.z=1.57;v=n.rotation.x;u=n.rotation.y}n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.y>0.9){n.position.y=f.y-p;n.rotation.y=Math.random()*Math.PI;if(t){w+=n.rotation.z+(Math.random()-0.5);n.rotation.z=1.57;v=n.rotation.x;u=n.rotation.y}n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.z<-0.5){n.position.z=
f.z+p/2;n.rotation.x=-1.57;n.rotation.y=Math.random()*Math.PI;if(t){v=n.rotation.x+(Math.random()-0.5);n.rotation.x=0;w=n.rotation.z;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}if(g.z>0.5){n.position.z=f.z-p/2;n.rotation.x=1.57;n.rotation.y=Math.random()*Math.PI;if(t){v=n.rotation.x+(Math.random()-0.5);n.rotation.x=0;w=n.rotation.z;u=n.rotation.y}n.position.y+=Math.random()*c.settings.spread-c.settings.spread/
2;n.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}}t&&(new TWEEN.Tween(n.rotation)).to({x:v,y:u,z:w},c.settings.tweenTime).easing(TWEEN.Easing.Elastic.EaseOut).start();if(t&&n.position.x<j.x+60&&n.position.x>j.x-60){n.position.x=j.x+60;if(n.position.x<j.x)n.position.x=j.x-60}n.scale.x=n.scale.y=n.scale.z=0.001*c.settings.scale;p=zscale=yscale=0.1*c.settings.scale;if(m){p=zscale=yscale=0.4*c.settings.scale;if(Math.abs(g.y)<0.9)continue}if(!t&&!m){yscale=0.3*c.settings.scale;p=zscale=
0.4*c.settings.scale}v=TWEEN.Easing.Quintic.EaseOut;if(t||m)v=TWEEN.Easing.Elastic.EaseOut;(new TWEEN.Tween(n.scale)).to({x:p,y:yscale,z:zscale},c.settings.tweenTime).easing(v).start();p=0}c.array[d].alivetime=p;n.visible=c.settings.visible}}},CollisionScene=function(b,e,c,d,f,g){function j(D,C,K,N,L,Q,ea,o,oa){D=new THREE.Mesh(D,oa);D.scale.set(C,C,C);D.position.set(K,N,L);D.rotation.set(Q,ea,o);D.updateMatrix();h.settings.useOldRay?w.addObject(D):e.addObject(D);return D}var h=this;h.currentNormal=
new THREE.Vector3(0,1,0);h.emitterNormal=new THREE.Vector3(0,1,0);h.distance=0;h.initSettings={};h.settings={useOldRay:g||!1,maxSpeedDivider:2,emitterDivider:5,cameraTargetDivider:10,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:f||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,minDistance:10,camera:b};var m=new THREE.Vector3(0,0,1),n=new THREE.Ray,p=new THREE.Matrix4,t=new THREE.Matrix4,v=new THREE.Vector3,u=new THREE.Projector,w=new THREE.Scene;c=new THREE.Cube(5,
5,5);h.emitter=j(c,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));h.emitterFollow=j(c,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,opacity:0.4}));if(h.settings.useOldRay)h.cameraTarget=j(c,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407667,opacity:0.4}));h.emitter.visible=!1;h.emitterFollow.visible=!1;c=new THREE.Cube(5E3,5E3,10,1,1,1);f=new THREE.MeshLambertMaterial({color:255,
opacity:0.2});var z=new THREE.Mesh(c,f),y=new THREE.Mesh(c,f);c=new THREE.Cube(10,5E3,5E3,1,1,1);var A=new THREE.Mesh(c,f),E=new THREE.Mesh(c,f);c=new THREE.Cube(5E3,10,5E3,1,1,1);var B=new THREE.Mesh(c,f),I=new THREE.Mesh(c,f);if(h.settings.useOldRay){w.addObject(z);w.addObject(y);w.addObject(A);w.addObject(E);w.addObject(B);w.addObject(I)}else{e.addObject(z);e.addObject(y);e.addObject(A);e.addObject(E);e.addObject(B);e.addObject(I);e.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(z));e.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(y));
e.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(A));e.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(E));e.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(B));e.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(I));z.visible=!1;y.visible=!1;A.visible=!1;E.visible=!1;B.visible=!1;I.visible=!1}this.addLoaded=function(D,C,K,N){var L=new THREE.MeshLambertMaterial({color:16711680,opacity:0.5});D=new THREE.Mesh(D,L);D.scale.x=D.scale.y=D.scale.z=C;D.rotation=K||new THREE.Vector3;
D.position=N||new THREE.Vector3;w.addObject(D)};this.update=function(D,C){E.position.x=D.x+h.settings.collisionDistance;A.position.x=D.x-h.settings.collisionDistance;E.position.z=D.z;E.position.y=D.y;A.position.z=D.z;A.position.y=D.y;z.position.z=D.z-h.settings.collisionDistance;y.position.z=D.z+h.settings.collisionDistance;z.position.x=D.x;z.position.y=D.y;y.position.x=D.x;y.position.y=D.y;I.position.y=D.y-h.settings.collisionDistance;B.position.y=D.y+h.settings.collisionDistance;I.position.x=D.x;
I.position.z=D.z;B.position.x=D.x;B.position.z=D.z;if(h.settings.capBottom!=null&&I.position.y<h.settings.capBottom)I.position.y=h.settings.capBottom;if(h.settings.capTop!=null&&B.position.y<h.settings.capTop)B.position.y=h.settings.capTop;if(h.settings.useOldRay){var K=new THREE.Vector3(d.mouse.x/d.screenWidth*2-1,-(d.mouse.y/d.screenHeight)*2+1,0.5);u.unprojectVector(K,b);var N=new THREE.Ray(D,K.subSelf(D).normalize()),L=N.intersectScene(w);if(L.length>0)for(var Q=0;Q<L.length;++Q)if((K.z<0?L[Q].point.z<
D.z:L[Q].point.z>D.z)&&L[Q].object!=h.emitter&&L[Q].object!=h.emitterFollow){h.emitter.position=L[Q].point;N=Math.atan2(D.z-h.emitter.position.z,D.x-h.emitter.position.x);h.emitter.position.x-=Math.cos(N)*h.settings.minDistance/10;h.emitter.position.z-=Math.sin(N)*h.settings.minDistance;if(h.emitter.position.z>D.z-20)h.emitter.position.z=D.z-20;N=L[Q].object.matrixRotationWorld.multiplyVector3(L[Q].face.normal.clone());h.emitterNormal=N;if(L[Q].object==E||L[Q].object==z||L[Q].object==y||L[Q].object==
A||L[Q].object==B){h.emitterNormal.x=0;h.emitterNormal.y=1;h.emitterNormal.z=0;if(!h.settings.allowFlying)h.emitter.position.y=I.position.y+5}break}}else{m.x=d.mouse.x/d.screenWidth*2-1;m.y=-(d.mouse.y/d.screenHeight)*2+1;m.z=1;n.origin.copy(m);p.copy(h.settings.camera.matrixWorld);p.multiplySelf(THREE.Matrix4.makeInvert(h.settings.camera.projectionMatrix,t));p.multiplyVector3(n.origin);n.direction.copy(n.origin);n.direction.subSelf(D);if((L=e.collisions.rayCastNearest(n))&&L.distance>h.settings.minDistance){Q=
L.distance*h.settings.scale;if(Q>h.settings.collisionDistance)Q=h.settings.collisionDistance;h.distance=Q;v.copy(n.origin);v.addSelf(n.direction.multiplyScalar(Q));h.emitter.position=v;if(L.normal!=undefined){N=L.mesh.matrixRotationWorld.multiplyVector3(L.normal).normalize();h.currentNormal=N;h.emitterNormal=N}if(L.mesh==E||L.mesh==z||L.mesh==y||L.mesh==A||L.mesh==B||L.mesh==I){h.currentNormal.set(0,1,0);if(!h.settings.allowFlying&&!h.settings.shootRayDown)h.emitter.position.y=I.position.y;if(h.settings.shootRayDown){n.origin.copy(h.emitter.position);
n.direction.set(0,-1,0);L=e.collisions.rayCastNearest(n);h.emitter.position.y-=L.distance*h.settings.scale;N=L.mesh.matrixRotationWorld.multiplyVector3(L.normal).normalize();h.currentNormal=N}}h.emitter.position.x+=h.currentNormal.x*h.settings.normalOffsetAmount;h.emitter.position.y+=h.currentNormal.y*h.settings.normalOffsetAmount;h.emitter.position.z+=h.currentNormal.z*h.settings.normalOffsetAmount}}if(isNaN(C)||C>1E3||C==0)C=1E3/60;L=C/h.settings.maxSpeedDivider;Q=h.emitter.position.x;Q=(Q-h.emitterFollow.position.x)/
h.settings.emitterDivider;N=h.emitter.position.y;N=(N-h.emitterFollow.position.y)/h.settings.emitterDivider;K=h.emitter.position.z;K=(K-h.emitterFollow.position.z)/h.settings.emitterDivider;N>L&&(N=L);N<-L&&(N=-L);Q>L&&(Q=L);Q<-L&&(Q=-L);K>L&&(K=L);K<-L&&(K=-L);h.emitterFollow.position.x+=Q;h.emitterFollow.position.y+=N;h.emitterFollow.position.z+=K;if(h.settings.keepEmitterFollowDown&&!h.settings.useOldRay){h.emitterFollow.position.y=h.emitter.position.y+h.settings.collisionDistance;n.origin.copy(h.emitterFollow.position);
n.direction.set(0,-1,0);if(L=e.collisions.rayCastNearest(n)){h.emitterFollow.position.y-=L.distance*h.settings.scale-h.settings.normalOffsetAmount;N=L.mesh.matrixRotationWorld.multiplyVector3(L.normal).normalize();h.currentNormal=N}}if(h.settings.useOldRay){K=new THREE.Vector3;N=new THREE.Ray(h.emitterFollow.position,K);var ea=1E4,o=h.emitterFollow.position,oa,ha;K.set(-1,0,0);N.direction=K;L=N.intersectScene(w);if(L.length>0)for(Q=0;Q<L.length;++Q)if(L[Q].object!=h.emitter&&L[Q].object!=A&&L[Q].object!=
E){if(L[Q].distance<ea){ea=L[Q].distance;o=L[Q].point;ha=L[Q].face;oa=L[Q].object}break}K.set(1,0,0);N.direction=K;L=N.intersectScene(w);if(L.length>0)for(Q=0;Q<L.length;++Q)if(L[Q].object!=h.emitter&&L[Q].object!=A&&L[Q].object!=E){if(L[Q].distance<ea){ea=L[Q].distance;o=L[Q].point;ha=L[Q].face;oa=L[Q].object}break}K.set(0,-1,0);N.direction=K;L=N.intersectScene(w);if(L.length>0)for(Q=0;Q<L.length;++Q)if(L[Q].object!=h.emitter&&L[Q].object!=B){if(L[Q].distance<ea){o=L[Q].point;ha=L[Q].face;oa=L[Q].object}break}h.emitterFollow.position=
o;if(oa!=undefined){N=oa.matrixRotationWorld.multiplyVector3(ha.normal.clone());h.currentNormal=N}N=h.emitterFollow.position.y;N=(N-h.cameraTarget.position.y)/h.settings.cameraTargetDivider;Q=h.emitterFollow.position.x;Q=(Q-h.cameraTarget.position.x)/h.settings.cameraTargetDivider;K=h.emitterFollow.position.z;K=(K-h.cameraTarget.position.z)/h.settings.cameraTargetDivider;L=8;N>4&&(N=4);N<-4&&(N=-4);Q>L&&(Q=L);Q<-L&&(Q=-L);K>L&&(K=L);K<-L&&(K=-L);h.cameraTarget.position.x+=Q;h.cameraTarget.position.y+=
N;h.cameraTarget.position.z+=K;if(h.cameraTarget.position.z>D.z-80)h.cameraTarget.position.z=D.z-80;d.renderer.render(w,b);d.renderer.clear()}};this.reset=function(D,C,K){h.emitter.position.set(D,C,K);h.emitterFollow.position.set(D,C,K);h.settings.useOldRay&&h.cameraTarget.position.set(D,C,K)}};
ROME.TrailShaderUtils=function(){var b={},e,c,d,f,g,j=-9999999,h=-9999999,m=9999999,n=9999999,p,t;b.setMaterials=function(v,u,w,z){d=u;c=w;g=z;f=g.getContext();e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);f.texImage2D(f.TEXTURE_2D,0,f.RGB,d,d,0,f.RGB,f.UNSIGNED_BYTE,null);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,
f.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=e;var y,A,E,B,I,D;u=0;for(w=v.length;u<w;u++){y=v[u];z=y.position.x;A=y.position.y;D=y.geometry.vertices;B=0;for(I=D.length;B<I;B++){E=D[B].position;y=E.x+z;E=E.y+A;j=Math.max(j,y);h=Math.max(h,E);m=Math.min(m,y);n=Math.min(n,E)}}p=j-m;t=h-n;var C,K;for(u=0;u<w;u++){y=v[u];z=y.position.x;A=y.position.y;D=y.geometry.vertices;C=ROME.TrailShader.attributes();
K=C.trailUV.value;B=0;for(I=D.length;B<I;B++){E=D[B].position;K.push(new THREE.Vector2((E.x+z-m)/p,(E.y+A-n)/t))}z=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:C,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});z.fog=!0;z.lights=!0;z.vertexColors=2;z.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;z.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;z.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
z.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;z.uniforms.lavaMap.texture.wrapS=z.uniforms.lavaMap.texture.wrapT=THREE.Repeat;z.uniforms.lavaNoiseMap.texture.wrapS=z.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;y.materials[0]=z}};b.updateLava=function(v,u,w){v=v!==undefined?v:1;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(u!==undefined?u:0,0,w!=undefined?w:0);ROME.TrailShader.uniforms.lavaTime.value+=v;if(ROME.TrailShader.uniforms.lavaTime.value>1)ROME.TrailShader.uniforms.lavaTime.value=
0;if(ROME.TrailShader.uniforms.lavaTime.value<0)ROME.TrailShader.uniforms.lavaTime.value=0};b.setMarkAtWorldPosition=function(v,u){if(d){var w=(v-m)/p*d,z=(u-n)/t*d;if(w>=0&&w<d-c.image.width&&z>=0&&z<d-c.image.height){f.bindTexture(f.TEXTURE_2D,e);f.texSubImage2D(f.TEXTURE_2D,0,w,z,f.RGB,f.UNSIGNED_BYTE,c.image)}}};return b}();
ROME.TrailShader={textures:{trailMap:undefined,faceMap:THREE.ImageUtils.loadTexture("files/textures/Closeup_PaintDubs.jpg"),lavaMap:THREE.ImageUtils.loadTexture("files/textures/lava.jpg"),lavaNoiseMap:THREE.ImageUtils.loadTexture("files/textures/Color_noise.jpg")},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,
0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",
value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue, f;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0)).rg;\nf = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nmixValue = f + max(1.0 - length(vec2(0.015) * vec2(vPos.xy - lavaHeadPosition.xz) + lookup * vec2(0.4)), 0.0);\nif(mixValue > 0.5)\n{\ngl_FragColor = gl_FragColor.gggg * vec4(0.27, 0.25, 0.3, 1.0) - vec4(0.1, 0.1, 0.1, 1.0);\nmixValue = abs((texture2D(lavaNoiseMap, vTrailUV.yx * vec2(40.0, -40.0)).r - 0.5));\nmixValue = max(max(1.0 - mixValue * 32.0, 0.0) * (lookup.r - 0.5) * 8.0, 0.0);\ngl_FragColor += vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0) - vec2( lavaTime * 2.5)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) - vec2( lavaTime * 2.5)).rrrr * vec4(2.0);\n}\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,e){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var d;this.addAnimal=function(f,g,j,h,m){g=g||null;var n=j||1.2;h=h||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(g==null&&c.array[d]!=undefined||g!=c.array[d])){m==null&&(m=[1]);var p=ROME.Animal(f,!1),t=p.mesh;j=0.02+Math.random()/8;j=Math.max(j,0.1);t.matrixAutoUpdate=!1;t.visible=!1;e.addChild(t);var v=0,u=0;if(h!=null){v=h[d%h.length]%
p.availableAnimals.length;u=v+1;if(Math.round(Math.random())==1&&v>0||u>p.availableAnimals.length-1)u=v-1}var w=m[v],z=m[u];p.play(p.availableAnimals[v],p.availableAnimals[u],0,Math.random(),Math.random());u=Math.random();d<2&&(u=0);j={c:t,a:p,active:!1,startMorph:v,speeda:w,speedb:z,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:u,scale:j*n,origscale:j*n};c.array[d]=j}};this.create=function(f,g,j){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=
!0;c.array[d].position.copy(f);c.array[d].normal.copy(g);c.array[d].c.position.copy(f);c.array[d].c.visible=!0;c.array[d].toVector=j.subSelf(f).normalize();c.array[d].toVector.x*=1-Math.abs(g.x);c.array[d].toVector.y*=1-Math.abs(g.y);c.array[d].toVector.z*=1-Math.abs(g.z);c.array[d].scale=0.01;(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();f=c.array[d].scale;c.array[d].c.position.x-=g.x*f*150;c.array[d].c.position.y-=g.y*f*150;c.array[d].c.position.z-=
g.z*f*150;break}};this.update=function(f,g){isNaN(f);for(d=0;d<c.initSettings.numOfAnimals;++d){var j=c.array[d];if(j.active){var h=j.c,m=j.scale,n=j.normal,p=j.position,t=j.toVector,v=p.x+t.x*10,u=p.y+t.y*10,w=p.z+t.z*10;n.y>0.5&&(u-=10);if(c.settings.capy!=null&&u<c.settings.capy){u=c.settings.capy;n.set(0,1,0)}c.array[d].count+=0.05;p=Math.max(Math.cos(c.array[d].count),0);p=Math.min(p,1);c.array[d].a.morph=p;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;
c.array[d].a.animalB.timeScale=c.settings.constantSpeed}var z=j.speeda;if(Math.round(p)==1)z=j.speedb;j=(v-h.position.x)/5;p=(u-h.position.y)/5;t=(w-h.position.z)/5;p>z&&(p=z);p<-z&&(p=-z);j>z&&(j=z);j<-z&&(j=-z);t>z&&(t=z);t<-z&&(t=-z);v=new THREE.Vector3(v,u,w);v.subSelf(h.position).normalize();u=new THREE.Vector3;n=new THREE.Vector3(n.x*-1,n.y*-1,n.z*-1);u.cross(v,n);n.cross(v,u);h.matrixWorld.n11=u.x*m;h.matrixWorld.n12=n.x*m;h.matrixWorld.n13=v.x*m;h.matrixWorld.n14=h.position.x;h.matrixWorld.n21=
u.y*m;h.matrixWorld.n22=n.y*m;h.matrixWorld.n23=v.y*m;h.matrixWorld.n24=h.position.y;h.matrixWorld.n31=u.z*m;h.matrixWorld.n32=n.z*m;h.matrixWorld.n33=v.z*m;h.matrixWorld.n34=h.position.z;h.position.x+=j;h.position.y+=p;h.position.z+=t;c.array[d].position.copy(h.position);if(h.position.z>g.z+100){c.array[d].active=!1;c.array[d].c.visible=!1}}}};this.reset=function(f,g,j){for(var h=0;h<c.array.length;++h){var m=c.array[h].c;m.position.x=f;m.position.y=g;m.position.z=j;c.array[h].active=!1;c.array[h].c.visible=
!1}}},VideoPlane=function(b,e,c){var d,f,g,j,h,m=!1,n=!1;VideoLoadRegister[e.path]=1;d=document.createElement("video");d.src=e.path;d.preload=!0;d.load();b.signals.loadItemAdded.dispatch();d.addEventListener("canplaythrough",function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},!1);setTimeout(function(){if(VideoLoadRegister[e.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[e.path]=2}},5E3);f=new THREE.Texture(d);f.minFilter=
THREE.LinearFilter;f.magFilter=THREE.LinearFilter;switch(e.shaderId){case VIDEO_OPAQUE:j=VideoShaderSource.opaque;break;case VIDEO_OPAQUE_DISTORT:j=VideoShaderSource.distortOpaque;m=!0;break;case VIDEO_KEYED_DISTORT:j=VideoShaderSource.distortKeyed;m=!0;n=!0;break;case VIDEO_HALFALPHA:j=VideoShaderSource.halfAlpha;break;default:j=VideoShaderSource.keyed;n=!0}var p=THREE.UniformsUtils.clone(j.uniforms);p.map.texture=f;if(m){p.mouseXY.value=new THREE.Vector2(0,0);p.aspect.value=c.aspect}if(n){p.colorScale.value=
e.colorScale;p.threshold.value=e.threshold;p.alphaFadeout.value=e.alphaFadeout}h=new THREE.MeshShaderMaterial({uniforms:p,vertexShader:j.vertexShader,fragmentShader:j.fragmentShader,depthTest:!1});if(!e.width)e.width=m?1.104:1;if(!e.height)e.height=m?1.24:1;this.mesh=m?new THREE.Mesh(c.grid,h):new THREE.Mesh(new THREE.Plane(1,1,1,1),h);this.mesh.scale.x=e.width;this.mesh.scale.y=e.height;this.mesh.position.z=e.z;this.mesh.scale.x*=Math.abs(e.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(e.z)*c.adj;
this.start=function(t){d.currentTime=d.duration*t;d.play();g=setInterval(function(){if(d.readyState===d.HAVE_ENOUGH_DATA)f.needsUpdate=!0},1E3/24)};this.stop=function(){d.pause();clearInterval(g)};this.updateUniform=function(t,v){if(m){h.uniforms.mouseXY.value.x=-t*c.aspect;h.uniforms.mouseXY.value.y=-v}}},VideoLoadRegister={},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VideoPlayer=function(b,e,c){var d=this;SequencerItem.call(this);var f={},g=[],j=
!1,h,m,n=b.renderer,p=b.renderTarget,t=0,v=0,u;this.duration=e[0].duration;this.init=function(){f.prx=c.paralaxHorizontal||0;f.pry=c.paralaxVertical||0;f.tgd=c.targetDistance||1500;onGrid=function(w){f.grid=w;d.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){j=!0;b.signals.mousemoved.add(function(){t=b.mouse.x/b.screenWidth*-2+1;v=b.mouse.y/b.screenHeight*2-1});u=new THREE.Vector2(0,0);f.fov=54;f.aspect=
2.35;f.adj=Math.tan(f.fov*Math.PI/360)*2;m=new THREE.Camera(f.fov,f.aspect,1,1E5);m.target.position=new THREE.Vector3(0,0,f.tgd*-1);m.updateMatrix();h=new THREE.Scene;h.addLight(new THREE.AmbientLight(0));for(var w=0;w<e.length;w++){var z=new VideoPlane(b,e[w],f);g.push(z);h.addObject(z.mesh);z.wireMesh&&h.addObject(z.wireMesh)}};this.show=function(w){for(var z=0;z<g.length;z++)g[z].start(w)};this.hide=function(){for(var w=0;w<g.length;w++)g[w].stop()};this.update=function(){if(j){u.x=t*f.prx;u.y=
v*f.pry;m.target.position.x+=(u.x-m.target.position.x)/2;m.target.position.y+=(u.y-m.target.position.y)/2;for(var w=0;w<g.length;w++)g[w].updateUniform(t,v);n.render(h,m,p)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vUv );\ngl_FragColor = c;\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},keyed:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},distortOpaque:{uniforms:{aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},mouseXY:{type:"v2",
value:new THREE.Vector2}},vertexShader:"uniform vec2 mouseXY;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform float aspect;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvUv = uv;\nvUvPoly = uv+vec2(normal.x,normal.y);\nviewPos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nviewPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nprojPos = vec2(aspect,1.)*vec2(viewPos.x/viewPos.z,viewPos.y/viewPos.z);\nprojPosPoly = vec2(aspect,1.)*vec2(viewPosPoly.x/viewPosPoly.z,viewPosPoly.y/viewPosPoly.z);\ndistance = max(0.,1.0-length(projPos-vec2(mouseXY.x, mouseXY.y)));\nfloat distFade = normal.z*0.8+0.8;\ndistancePoly = max(0.,distFade-length(projPosPoly-vec2(mouseXY.x, mouseXY.y)));\nviewPos.xy = viewPos.xy + normalize(projPos-vec2(mouseXY.x, mouseXY.y))*0.6*pow(distance,1.)*(viewPos.z/10.);\ngl_Position = viewPos;\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec2 mouseXY;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.1) discard;\nelse gl_FragColor = c;\n}"},
distortKeyed:{uniforms:{aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},mouseXY:{type:"v2",value:new THREE.Vector2},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"uniform vec2 mouseXY;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform float aspect;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvUv = uv;\nvUvPoly = uv+vec2(normal.x,normal.y);\nviewPos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nviewPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nprojPos = vec2(aspect,1.)*vec2(viewPos.x/viewPos.z,viewPos.y/viewPos.z);\nprojPosPoly = vec2(aspect,1.)*vec2(viewPosPoly.x/viewPosPoly.z,viewPosPoly.y/viewPosPoly.z);\ndistance = max(0.,1.0-length(projPos-vec2(mouseXY.x, mouseXY.y)));\nfloat distFade = normal.z*0.8+0.8;\ndistancePoly = max(0.,distFade-length(projPosPoly-vec2(mouseXY.x, mouseXY.y)));\nviewPos.xy = viewPos.xy + normalize(projPos-vec2(mouseXY.x, mouseXY.y))*0.6*pow(distance,1.)*(viewPos.z/10.);\ngl_Position = viewPos;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nuniform vec2 mouseXY;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"},
distortWire:{uniforms:{aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},mouseXY:{type:"v2",value:new THREE.Vector2}},vertexShader:"uniform vec2 mouseXY;\nuniform float aspect;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvUv = uv;\nvUv = uv;\nvUvPoly = uv+vec2(normal.x,normal.y);\nviewPos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nviewPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nprojPos = vec2(aspect,1.)*vec2(viewPos.x/viewPos.z,viewPos.y/viewPos.z);\nprojPosPoly = vec2(aspect,1.)*vec2(viewPosPoly.x/viewPosPoly.z,viewPosPoly.y/viewPosPoly.z);\ndistance = max(0.,1.0-length(projPos-vec2(mouseXY.x, mouseXY.y)));\nfloat distFade = normal.z*0.8+0.8;\ndistancePoly = max(0.,distFade-length(projPosPoly-vec2(mouseXY.x, mouseXY.y)));\nviewPos.xy = viewPos.xy + normalize(projPos-vec2(mouseXY.x, mouseXY.y))*0.6*pow(distance,1.)*(viewPos.z/10.);\ngl_Position = viewPos;\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec2 tileOffsetX;\nuniform vec2 mouseXY;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.8 && cPoly.a>0.) cPoly = vec4(1.,1.,1.,distancePoly/16.); \nelse cPoly = vec4(1.,1.,1.,0.); \ngl_FragColor = cPoly;\n}"}},
VideoShots={confParalax:{paralaxHorizontal:40,paralaxVertical:10},confStill:{paralaxHorizontal:0,paralaxVertical:0},introLayers:[{path:"files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:22E3}],s01_01:[{path:"files/videos/city/s01_layer01.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:3120}],s01_03:[{path:"files/videos/city/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-900,duration:8120},{path:"files/videos/city/s03_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-800,colorScale:0.9,threshold:0.28,
alphaFadeout:0.35,width:2,height:2},{path:"files/videos/city/s03_layer01.webm",shaderId:VIDEO_KEYED,z:-700,colorScale:0.9,threshold:0.28,alphaFadeout:0.35}],s01_06:[{path:"files/videos/city/s06_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:2030},{path:"files/videos/city/s06_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,z:-900,colorScale:0.99,threshold:0.45,alphaFadeout:0.35}],s01_09:[{path:"files/videos/city/s09_layer03.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,duration:8230,colorScale:0.99,threshold:0.45,
alphaFadeout:0.35},{path:"files/videos/city/s09_layer02.webm",shaderId:VIDEO_KEYED,z:-900,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,width:1.4,height:1},{path:"files/videos/city/s09_layer01.webm",shaderId:VIDEO_KEYED,z:-700,colorScale:0.99,threshold:0.45,alphaFadeout:0.35}],dunesLayers:[{path:"files/videos/transition_dunes.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:2E4}],s02_01:[{path:"files/videos/prairie/s01_layer04.webm",shaderId:VIDEO_OPAQUE_DISTORT,z:-1400,duration:9230},{path:"files/videos/prairie/s01_layer03.webm",
shaderId:VIDEO_KEYED,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35},{path:"files/videos/prairie/s01_layer02.webm",shaderId:VIDEO_KEYED,z:-50,colorScale:0.91,threshold:0.28,alphaFadeout:0.7,width:1.05,height:1.05},{path:"files/videos/prairie/s01_layer01.webm",shaderId:VIDEO_KEYED,z:-30,colorScale:0.8,threshold:0.28,alphaFadeout:0.7,width:1.05,height:1.05}],s02_02:[{path:"files/videos/prairie/s02_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:2020},{path:"files/videos/prairie/s02_layer02.webm",
shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35},{path:"files/videos/prairie/s02_layer01.webm",shaderId:VIDEO_HALFALPHA,z:-990}],s02_03:[{path:"files/videos/prairie/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:2030},{path:"files/videos/prairie/s03_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35},{path:"files/videos/prairie/s03_layer01.webm",shaderId:VIDEO_HALFALPHA,z:-990}],s02_04:[{path:"files/videos/prairie/s04_layer03.webm",
shaderId:VIDEO_OPAQUE,z:-1010,duration:5E3},{path:"files/videos/prairie/s04_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:1,threshold:0.3,alphaFadeout:0.3},{path:"files/videos/prairie/s04_layer01.webm",shaderId:VIDEO_HALFALPHA,z:-990}],s02_06:[{path:"files/videos/prairie/s06_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:6060},{path:"files/videos/prairie/s06_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:1,threshold:0.3,alphaFadeout:0.3}]},City=function(b){var e=
this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("city initScene");e.update(0.001,34.99,45199)});var c,d,f,g=b.renderer,j=b.renderTarget;b.debug=!1;if(function(h){return(h=RegExp("[?&]"+h+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(h[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){c=new THREE.Camera(60,b.viewportWidth/b.viewportHeight,1,1E5);c.position.set(0,20,-300);d=new CityWorld(b);f=new CitySoup(c,d.scene,b);b.worlds.city=
d;b.sequences.city=this;console.log("city init")};this.resetCamera=function(){c.position.set(0,20,-300);g.setClearColor(d.scene.fog.color);g.setStencilShadowDarkness(0.7)};this.show=function(){this.resetCamera();b.started.city=!0;console.log("show city")};this.hide=function(){};this.update=function(h,m){THREE.AnimationHandler.update(m);f.update(m);c.position.z-=0.9*m/8;if(c.position.z<-3300)c.position.z=-300;g.render(d.scene,c,j);d.update(m,c,!1);b.logger.log("vertices: "+g.data.vertices);b.logger.log("faces: "+
g.data.faces);b.logger.log("draw calls: "+g.data.drawCalls)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){var e=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("prairie initScene");e.update(9.0E-4,49.99,90375)});var c,d,f,g=b.renderer,j=b.renderTarget,h,m=[];this.init=function(){m=[[302.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,
-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var n,p;for(n=0;n<m.length;n++){p=m[n][1];m[n][1]=m[n][2]+6;m[n][2]=-p}h=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E6,waypoints:m,duration:25,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,
lookSpeed:0.004,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0.3,Math.PI-0.3]}});h.position.set(0,0,0);h.lon=360;c=h;d=new PrairieWorld(b,c);f=new PrairieSoup(c,d.scene,b);b.worlds.prairie=d;b.sequences.prairie=this;d.scene.addObject(h.animationParent);console.log("prairie init")};this.show=function(){this.resetCamera();b.started.prairie=!0;console.log("show prairie")};this.hide=function(){};this.resetCamera=
function(){c.position.set(0,0,0);c.lon=360;c.animation.play(!0,0);g.setClearColor(d.scene.fog.color)};this.update=function(n,p){if(isNaN(p)||p>1E3||p==0)p=1E3/60;THREE.AnimationHandler.update(p);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/300;c.animationParent.position.y+=(Math.random()-0.5)*0.3;d.update(p,c,!1);f.update(p);g.render(d.scene,c,j);b.logger.log("vertices: "+g.data.vertices);b.logger.log("faces: "+g.data.faces);b.logger.log("draw calls: "+g.data.drawCalls)}};
Prairie.prototype=new SequencerItem;Prairie.prototype.constructor=Prairie;
var Dunes=function(b){var e=this;SequencerItem.call(this);b.signals.initscenes.add(function(){console.log("dunes initScene");e.update(9.0E-4,49.99,90375)});this.CAMERA_LOWEST_Y=220;this.CAMERA_HIGHEST_Y=7E3;this.CAMERA_FORWARD_SPEED=10;this.CAMERA_FORWARD_SPEED_MAX=15;this.CAMERA_FORWARD_SPEED_MAX_Y=1E3;this.CAMERA_VERTICAL_FACTOR=15;this.CAMERA_VERTICAL_LIMIT=75;this.CAMERA_HORIZONTAL_FACTOR=15;this.CAMERA_INERTIA=0.02;this.CAMERA_ROLL_FACTOR=0.5;this.CAMERA_COLLISION_SLOWDOWN_DISTANCE=50;this.CAMERA_COLLISION_DISTANCE=
220;this.CAMERA_COLLISION_DISTANCE_UP=this.CAMERA_COLLISION_DISTANCE_DOWN=this.CAMERA_COLLISION_DISTANCE_SIDES=50;this.CAMERA_TARGET_ADJUSTMENT_FACTOR=12;var c,d,f=new THREE.Vector3,g={forward:1,left:1,right:1,up:1,down:1},j=0,h,m,n,p=b.renderer,t=b.renderTarget,v=new THREE.Ray;new THREE.Vector3;var u=document.createElement("div");u.style.position="absolute";u.style.right="0px";u.style.top="0px";u.style.background="#000";u.style.color="#fff";u.style.fontWeight="bold";u.style.padding="20px";u.style.zIndex=
500;u.style.width="100%";u.style.textAlign="right";u.style.display="none";document.body.appendChild(u);this.init=function(){h=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);h.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);m=new DunesWorld(b);n=new DunesSoup(h,m.scene,b);m.scene.addChild(h);m.scene.addChild(h.target);m.scene.addChild(c);m.scene.addChild(d);b.worlds.dunes=m;b.sequences.dunes=this;console.log("dunes init")};this.show=function(){this.resetCamera();
b.started.dunes=!0;console.log("show dunes")};this.hide=function(){};this.resetCamera=function(){c.position.set(0,150,-1600);d.position.copy(b.influenceSpheres[0].center);d.position.subSelf(c.position).normalize().multiplyScalar(this.CAMERA_COLLISION_DISTANCE).addSelf(c.position);h.position.set(0,150,-1600);h.target.position.copy(b.influenceSpheres[0].center);var w=new THREE.Vector3;w.sub(c.position,d.position);d.rotation.y=Math.atan2(w.x,w.z);p.setClearColor(m.scene.fog.color)};this.update=function(w,
z){var y,A,E;switch(j){case 0:E="forward";v.direction.copy(h.matrixWorld.getColumnZ().negate());y=this.CAMERA_COLLISION_DISTANCE;A=this.CAMERA_COLLISION_SLOWDOWN_DISTANCE;break;case 1:E="left";v.direction.copy(h.matrixWorld.getColumnX().negate());y=this.CAMERA_COLLISION_DISTANCE_SIDES;A=this.CAMERA_COLLISION_SLOWDOWN_DISTANCE;break;case 2:E="right";v.direction.copy(h.matrixWorld.getColumnX());y=this.CAMERA_COLLISION_DISTANCE_SIDES;A=this.CAMERA_COLLISION_SLOWDOWN_DISTANCE;break;case 3:E="down";v.direction.copy(h.matrixWorld.getColumnY().negate());
y=this.CAMERA_COLLISION_DISTANCE_DOWN;A=this.CAMERA_COLLISION_SLOWDOWN_DISTANCE;break;case 4:E="up";v.direction.copy(h.matrixWorld.getColumnY());y=this.CAMERA_COLLISION_DISTANCE_UP;A=this.CAMERA_COLLISION_SLOWDOWN_DISTANCE}j++;j>4&&(j=0);g[E]=1;v.origin.copy(c.position);var B=m.scene.collisions.rayCastNearest(v),I=-1;if(B&&B.distance!==-1){I=B.distance*0.1;I<y+A&&(g[E]=I<y?0:1-(I-y)/A)}y=b.mouse.x/b.screenWidth-0.5;A=b.mouse.y/b.screenHeight-0.5;if(E!=="forward"&&g[E]<1){y=new THREE.Vector3;y.copy(v.direction).negate().multiplyScalar((1-
g[E])*this.CAMERA_TARGET_ADJUSTMENT_FACTOR);if(E==="left"||E==="right")y.y=0;else{y.x=0;y.z=0}d.position.addSelf(y);g[E]=Math.max(g[E],0.2);A=y=0}v.origin.addSelf(v.direction.multiplyScalar(I)).y<this.CAMERA_LOWEST_Y&&(g[E]=1);E=g.forward*g.up*g.down*g.right*g.left;d.position.y-=A*this.CAMERA_VERTICAL_FACTOR;d.position.y=Math.max(d.position.y,this.CAMERA_LOWEST_Y);d.position.y=Math.min(d.position.y,this.CAMERA_HIGHEST_Y);if(Math.abs(d.position.y-c.position.y)>this.CAMERA_VERTICAL_LIMIT)d.position.y=
d.position.y>c.position.y?c.position.y+this.CAMERA_VERTICAL_LIMIT:c.position.y-this.CAMERA_VERTICAL_LIMIT;f.sub(d.position,c.position).normalize();d.position.x=c.position.x+f.x*this.CAMERA_COLLISION_DISTANCE-f.z*this.CAMERA_HORIZONTAL_FACTOR*y;d.position.z=c.position.z+f.z*this.CAMERA_COLLISION_DISTANCE+f.x*this.CAMERA_HORIZONTAL_FACTOR*y;I=(Math.min(Math.max(c.position.y,this.CAMERA_LOWEST_Y),this.CAMERA_FORWARD_SPEED_MAX_Y)-this.CAMERA_LOWEST_Y)/(this.CAMERA_FORWARD_SPEED_MAX_Y-this.CAMERA_LOWEST_Y);
I=this.CAMERA_FORWARD_SPEED+(this.CAMERA_FORWARD_SPEED_MAX-this.CAMERA_FORWARD_SPEED)*I;c.position.addSelf(f.multiplyScalar(I*E));c.position.y=Math.max(c.position.y,this.CAMERA_LOWEST_Y);c.position.y=Math.min(c.position.y,this.CAMERA_HIGHEST_Y);if(w>m.startLift&&w<m.endLift){c.position.y+=m.liftSpeed*(z/1E3);d.position.y+=m.liftSpeed*(z/2E3)}h.position.x+=(c.position.x-h.position.x)*this.CAMERA_INERTIA;h.position.y+=(c.position.y-h.position.y)*this.CAMERA_INERTIA;h.position.z+=(c.position.z-h.position.z)*
this.CAMERA_INERTIA;h.target.position.x+=(d.position.x-h.target.position.x)*this.CAMERA_INERTIA;h.target.position.y+=(d.position.y-h.target.position.y)*this.CAMERA_INERTIA;h.target.position.z+=(d.position.z-h.target.position.z)*this.CAMERA_INERTIA;E=h.matrixWorld.getColumnZ();f.normalize();f.y=E.y;f.subSelf(E).normalize();f.multiplyScalar(this.CAMERA_ROLL_FACTOR);c.up.set(0,1,0);c.up.subSelf(f).normalize();h.up.x+=(c.up.x-h.up.x)*this.CAMERA_INERTIA;h.up.y+=(c.up.y-h.up.y)*this.CAMERA_INERTIA;h.up.z+=
(c.up.z-h.up.z)*this.CAMERA_INERTIA;THREE.AnimationHandler.update(z);m.update(z,h,!1);n.update(z);p.render(m.scene,h,t)}};Dunes.prototype=new SequencerItem;Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var e,c,d,f,g,j,h,m,n,p;e=document.createElement("div");e.style.width=window.innerWidth+"px";e.style.height=window.innerHeight+"px";e.style.backgroundColor="#4584b4";e.style.textAlign="center";var t=!1;this.load=function(){function v(u,w,z){var y=document.createElement("div");y.style.position="absolute";y.style.cursor="pointer";y.style.margin=u;var A=document.createElement("img");A.src=w;y.appendChild(A);y.addEventListener("mouseout",function(){A.src=
w},!1);y.addEventListener("mouseover",function(){A.src=z},!1);return y}c=document.createElement("canvas");c.width=32;c.height=window.innerHeight;d=c.getContext("2d");f=d.createLinearGradient(0,0,0,c.height);f.addColorStop(0,"#0e223a");f.addColorStop(0.5,"#4584b4");d.fillStyle=f;d.fillRect(0,0,c.width,c.height);e.style.backgroundImage="url("+c.toDataURL("image/png")+")";e.style.backgroundRepeat="repeat-x";g=new Clouds(b);g.getDomElement().style.position="absolute";g.getDomElement().style.left="0px";
g.getDomElement().style.top="0px";g.getDomElement().style.width=window.innerWidth+"px";g.getDomElement().style.height=window.innerHeight+"px";e.appendChild(g.getDomElement());j=document.createElement("div");j.style.position="absolute";j.innerHTML='<img src="files/logo_heart.png">';e.appendChild(j);h=v("10px 0 0 85px","files/enter_idle.png","files/enter_rollover.png");h.addEventListener("click",function(){n.getDomElement().style.display="block";h.style.display="none";t=!0;b.signals.load.dispatch()},
!1);e.appendChild(h);m=v("10px 0 0 85px","files/start_idle.png","files/start_rollover.png");m.style.display="none";m.addEventListener("click",function(){b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1)},1E3)},!1);e.appendChild(m);n=new LoadingBar(function(){n.getDomElement().style.display="none";m.style.display="block";t=!1;b.signals.initscenes.dispatch()});n.getDomElement().style.position="absolute";n.getDomElement().style.display="none";e.appendChild(n.getDomElement());
b.signals.loadItemAdded.add(n.addItem);b.signals.loadItemCompleted.add(n.completeItem);p=document.createElement("div");p.style.position="absolute";p.style.left="0";p.style.bottom="0";p.style.width="100%";new Footer(p);e.appendChild(p)};this.show=function(){g.show();e.style.display="block"};this.resize=function(v,u){g.resize(v,u);j.style.top="60px";j.style.left=(window.innerWidth-358)/2+"px";h.style.top=m.style.top="210px";h.style.left=m.style.left=(window.innerWidth-358)/2+"px";n.getDomElement().style.top=
"215px";n.getDomElement().style.left=(window.innerWidth-300)/2+"px";e.style.width=v+"px";e.style.height=u+"px"};this.hide=function(){g.hide();e.style.display="none"};this.update=function(){t||g.update()};this.getDomElement=function(){return e}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function e(){j=!1;f.pause()}function c(C){switch(C.keyCode){case 32:f.paused?f.play():f.pause();break;case 37:f.currentTime--;h.clear();break;case 39:f.currentTime++;h.clear();break;case 38:f.playbackRate+=0.1;break;case 40:f.playbackRate-=0.1;break;case 77:f.volume=f.volume?0:1}}Section.call(this);var d,f,g,j=!1,h,m,n;d=document.createElement("div");d.style.display="none";f=document.createElement("audio");f.preload=!0;d.appendChild(f);source=document.createElement("source");
source.src="files/Black.ogg";f.appendChild(source);g=new Tune(f);g.setBPM(85);g.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);m=new THREE.WebGLRenderer;m.domElement.style.position="absolute";m.setSize(b.viewportWidth,b.baseHeight);m.sortObjects=!1;m.autoClear=!1;n=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);n.minFilter=THREE.LinearFilter;n.magFilter=THREE.LinearFilter;
b.renderer=m;b.renderTarget=n;b.signals.startfilm.add(function(C,K){d.appendChild(m.domElement);j=!0;f.currentTime=g.getPatternMS(C)/1E3;f.play();f.volume=K});b.signals.stopfilm.add(e);THREE.ImageUtils.loadTexture("files/textures/fingerprints.png");var p=new VideoPlayer(b,VideoShots.introLayers,VideoShots.confStill),t=new VideoPlayer(b,VideoShots.s01_01,VideoShots.confStill),v=new VideoPlayer(b,VideoShots.s01_03,VideoShots.confParalax),u=new VideoPlayer(b,VideoShots.s01_06,VideoShots.confStill),w=
new VideoPlayer(b,VideoShots.s01_09,VideoShots.confParalax),z=new VideoPlayer(b,VideoShots.s02_01,VideoShots.confParalax),y=new VideoPlayer(b,VideoShots.s02_02,VideoShots.confStill),A=new VideoPlayer(b,VideoShots.s02_03,VideoShots.confStill),E=new VideoPlayer(b,VideoShots.s02_04,VideoShots.confStill),B=new VideoPlayer(b,VideoShots.s02_06,VideoShots.confStill),I=new VideoPlayer(b,VideoShots.dunesLayers,VideoShots.confStill);h=new Sequencer;h.add(new ClearEffect(b),g.getPatternMS(0),g.getPatternMS(73.25),
0);h.add(p,g.getPatternMS(0),g.getPatternMS(8),1);p=g.getPatternMS(8);var D=g.getPatternMS(16);h.add(t,p,p+t.duration,1);p+=t.duration;h.add(v,p,p+v.duration,1);p+=v.duration;h.add(u,p,p+u.duration,1);p+=u.duration;h.add(w,p,D,5);t=g.getPatternMS(16)-3E3;h.add(new City(b),t,g.getPatternMS(24),1);h.add(new PaintEffect(b),t,g.getPatternMS(24),4);t=g.getPatternMS(24);v=g.getPatternMS(32);h.add(z,t,t+z.duration,1);t+=z.duration;h.add(y,t,t+y.duration,1);t+=y.duration;h.add(A,t,t+A.duration,1);t+=A.duration;
h.add(E,t,t+E.duration,1);t+=E.duration;h.add(B,t,v,1);h.add(new Prairie(b),g.getPatternMS(32),g.getPatternMS(40),1);h.add(new PaintEffectPrairie(b),g.getPatternMS(32),g.getPatternMS(40),5);h.add(I,g.getPatternMS(40),g.getPatternMS(48),1);h.add(new Dunes(b),g.getPatternMS(48),g.getPatternMS(73.25),1);h.add(new PaintEffectDunes(b),g.getPatternMS(48),g.getPatternMS(73.25),4);h.add(new FadeOutEffect(0,b),g.getPatternMS(23.5),g.getPatternMS(24),3);h.add(new FadeOutEffect(0,b),g.getPatternMS(39.5),g.getPatternMS(40),
3);h.add(new FadeOutEffect(0,b),g.getPatternMS(72),g.getPatternMS(73.25),5);h.add(new PointerEffect(b,!1),g.getPatternMS(0),g.getPatternMS(8),1);h.add(new PointerEffect(b,!0),g.getPatternMS(8),g.getPatternMS(73.25),1);h.add(new RenderEffect(b),g.getPatternMS(0),g.getPatternMS(16),6);h.add(new RenderEffect(b),g.getPatternMS(24),g.getPatternMS(32),6);h.add(new RenderEffect(b),g.getPatternMS(40),g.getPatternMS(48),6);this.getDomElement=function(){return d};this.show=function(){d.style.display="block";
b.signals.keydown.add(c)};this.hide=function(){d.style.display="none";b.signals.keydown.remove(c);e()};this.resize=function(C,K){b.viewportWidth=b.baseWidth*(C/b.baseWidth);b.viewportHeight=b.baseHeight*(C/b.baseWidth);m.setSize(b.viewportWidth,b.viewportHeight);n.width=b.viewportWidth;n.height=b.viewportHeight;delete n.__webglFramebuffer;m.domElement.style.left="0px";m.domElement.style.top=(K-b.viewportHeight)/2+"px"};this.update=function(){if(j)if(f.currentTime==f.duration){b.signals.showrelauncher.dispatch();
e()}else h.update(f.currentTime*1E3)}};FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function e(){for(var y=v.getPoints(),A=0;A<y.length;A++){var E=y[A].getOriginPosition(),B=f.list[A],I=E.x;E=E.y;if(A==0){I-=82;E-=159}else if(A==1){I+=133;E-=45}else if(A==2){I+=104;E+=76}else if(A==3){I-=311;E+=74}else{I-=333;E-=46}B.style.left=I+"px";B.style.top=E+"px"}}function c(y,A,E,B,I){A=document.createElement(A);A.setAttribute("id",E);A.setAttribute("class",B);A.innerHTML=I;y.appendChild(A);return A}Section.call(this);var d=document.createElement("div");
d.setAttribute("id","relauncher-section");d.style.position="relative";d.style.display="none";var f={},g=document.createTextNode("#relauncher-section div.after-experience { position: absolute; padding: 25px 50px; border: 1px solid #c9c8c1; text-transform: uppercase; font: 500 12px / 17px 'Futura', Arial, sans-serif; letter-spacing: 1px; color: #434343; cursor: pointer; } #relauncher-section div.after-experience:hover { color: #f15d22; background: #30302e; }"),j=document.getElementsByTagName("head")[0],
h=document.createElement("style");h.type="text/css";if(h.styleSheet)h.styleSheet.cssText=g.nodeValue;else h.appendChild(g);j.appendChild(h);var m=new Clouds(b,!0);b=m.getDomElement();b.style.background="#fff";b.style.zIndex=-1;d.appendChild(b);b=document.createElement("div");b.setAttribute("id","container");b.setAttribute("style","position: absolute;");d.appendChild(b);var n=new GEE({fullscreen:!0,container:b}),p=n.ctx,t=new WonderWall.Pentagon(n,n.width*0.5,n.height*0.5,75),v=new WonderWall.Pentagon(n,
n.width*0.5,n.height*0.5,95),u=new WonderWall.Pentagon(n,n.width*0.5,n.height*0.5,130,0.25);u.showFill=!1;u.insides=!0;v.showFill=!1;u.setRadius(0.19);t.setRadius(0.12);var w={svg:new Heart(n,"files/eminating-heart.svg",0,0),point:new WonderWall.Point(n,n.width*0.5,n.height*0.5)};w.point.r=0.0625;var z=z||{};z.color={red:"#f15d22",black:"#30302e",white:"#f4f4ea"};f=function(y){var A={},E=c(y,"div","start-over","after-experience","start over"),B=c(y,"div","technology","after-experience","technology"),
I=c(y,"div","add-to-the-dream","after-experience","add to the dream"),D=c(y,"div","explore-other-dreams","after-experience","explore other dreams");y=c(y,"div","continue-to-explore","after-experience","continue to explore");E.addEventListener("click",function(C){C.preventDefault();alert("start over")},!1);B.addEventListener("click",function(C){C.preventDefault();alert("technology")},!1);I.addEventListener("click",function(C){C.preventDefault();alert("Add to the Dream")},!1);D.addEventListener("click",
function(C){C.preventDefault();alert("Explore Other Dreams")},!1);y.addEventListener("click",function(C){C.preventDefault();alert("Continue to Explore")},!1);A.start=E;A.technology=B;A.add=I;A.otherDreams=D;A.explore=y;A.list=[E,D,y,I,B];init=!0;return A}(d);for(b=0;b<f.list.length;b++){g=f.list[b];g.addEventListener("mouseover",function(){var y=f.list.indexOf(this);t.setUpdatePoint(!0,y);v.setUpdatePoint(!0,y);u.setUpdatePoint(!0,y);w.point.updating=!0},!1);g.addEventListener("mouseout",function(){var y=
f.list.indexOf(this);t.setUpdatePoint(!1,y);v.setUpdatePoint(!1,y);u.setUpdatePoint(!1,y);w.point.updating=!1},!1)}e();n.draw=function(){v.update();v.getPoints();p.clearRect(0,0,n.width,n.height);p.strokeStyle=z.color.black;p.lineWidth=0.5;u.update().render();p.globalCompositeOperation="destination-out";t.update().render();p.globalCompositeOperation="source-out";p.lineWidth=32;v.showStroke=!0;v.showFill=!1;v.render();p.globalCompositeOperation="source-over";p.save();p.translate(n.width/2,n.height/
2);w.svg.render();p.restore()};this.show=function(){m.show();e();d.style.display="block"};this.resize=function(y,A){m.resize(y,A);e()};this.hide=function(){m.hide();d.style.display="none"};this.getDomElement=function(){return d};this.update=function(){m.update()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){Section.call(this);var e=document.createElement("div");e.style.display="none";var c=b.renderer;renderTarget=b.renderTarget;var d,f={};f.dunes=new THREE.RollCamera(50,b.viewportWidth/b.viewportHeight,1,1E5);f.dunes.movementSpeed=200;f.dunes.lookSpeed=3;f.dunes.constrainVertical=[-0.4,0.4];f.dunes.autoForward=!1;f.dunes.position.set(0,0,0);f.prairie=new THREE.RollCamera(50,b.viewportWidth/b.viewportHeight,1,1E5);f.prairie.movementSpeed=50;f.prairie.lookSpeed=3;f.prairie.constrainVertical=
[-0.4,0.4];f.prairie.autoForward=!1;f.prairie.position.set(0,0,0);f.city=new THREE.RollCamera(50,b.viewportWidth/b.viewportHeight,1,1E5);f.city.movementSpeed=100;f.city.lookSpeed=3;f.city.constrainVertical=[-0.4,0.4];f.city.autoForward=!1;f.city.position.set(0,20,-300);var g={city:new THREE.Vector3(0,20,-300),prairie:new THREE.Vector3(0,0,0),dunes:new THREE.Vector3(0,0,0)},j,h,m,n,p,t,v;n=new ClearEffect(b);n.init();(new HeatEffect(b)).init();p=new PaintEffect(b);p.init();(new PaintEffectPrairie(b)).init();
t=new PaintEffectDunes(b);t.init();(new NoiseEffect(b,0.15,0,4096)).init();(new OverlayEffect(b,THREE.ImageUtils.loadTexture("files/textures/fingerprints.png"))).init();v=new RenderEffect(b);v.init();var u=0,w=0;b.signals.startexploration.add(function(z){e.appendChild(c.domElement);j=b.worlds[z];h=j.scene;d=f[z];m=z=="city"?p:z=="prairie"?p:z=="dunes"?t:v;h.addChild(d);d.position.copy(g[z]);b.started[z]||THREE.SceneUtils.traverseHierarchy(j.scene,function(y){if(!(y instanceof THREE.Mesh||y instanceof
THREE.Scene)||y.geometry&&y.geometry.morphTargets.length>0){var A=y.name.toLowerCase();if(!(A&&A.indexOf("portal")>=0))y.visible=!1}});u=w=(new Date).getTime()});this.getDomElement=function(){return e};this.show=function(){e.style.display="block"};this.hide=function(){e.style.display="none"};this.resize=function(){};this.update=function(){if(j){time=(new Date).getTime()-u;delta=time-w;w=time;j.update(delta,d,!0);n.update(0,delta,time);c.setClearColor(j.scene.fog.color);c.render(j.scene,d,renderTarget);
b.logger.log("vertices: "+c.data.vertices);b.logger.log("faces: "+c.data.faces);m.update(0,delta,time)}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){var e,c,d=document.createElement("div");d.style.display="none";this.getDomElement=function(){return d};this.load=function(){var f=signals.Signal;b.ugcSignals={};b.ugcSignals.submit=new f;e=new UgcObjectCreator(b);d.appendChild(e.getDomElement());c=new UgcUI(b);c.getDomElement().style.position="absolute";c.getDomElement().style.left="100px";c.getDomElement().style.top="100px";d.appendChild(c.getDomElement())};this.show=function(){d.style.display="block";e.show()};this.hide=
function(){d.style.display="none";e.hide()};this.resize=function(f,g){e.resize(f,g)};this.update=function(){e.update()}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b,e){function c(){if(!e){n.x=b.mouse.x/b.screenWidth*100-50;n.y=b.mouse.y/b.screenHeight*100-50;p=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}}function d(ha){for(var sa=0;sa<2;sa++){f=h[sa]=new Boid;f.position.x=320;f.position.y=20+Math.random()*10;f.position.z=200+Math.random();f.velocity.x=Math.random()*2-1;f.velocity.y=Math.random()*2-1;f.velocity.z=Math.random()*2-1;f.setAvoidWalls(!0);f.setWorldSize(1E3,200,400);m[sa]=new ROME.Animal(ha,!0);
m[sa].timeOffset=Math.random()*100;g=j[sa]=m[sa].mesh;g.phase=Math.floor(Math.random()*62.8);g.rotation.set(0,-0.5,0);g.updateMatrix();g.update();window.morphObject=m[sa];m[sa].play(m[sa].availableAnimals[0],m[sa].availableAnimals[0]);g.position=h[sa].position;g.doubleSided=!1;g.scale.x=g.scale.y=g.scale.z=0.03+0.05*Math.random();I.addChild(g)}D.position.z=-4E3;y.addObject(D);C.position.z=0;y.addObject(C);E.addObject(I)}var f,g,j=[],h=[],m=[],n={x:0,y:0},p={x:0,y:0,z:0},t,v,u=start_time=(new Date).getTime(),
w,z,y,A,E,B,I,D,C,K,N,L,Q,ea,o;N=new THREE.Fog(4555956,-100,3E3);w=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);w.position.z=6E3;y=new THREE.Scene;E=new THREE.Scene;I=new THREE.Object3D;K=new THREE.Geometry;var oa=THREE.ImageUtils.loadTexture("files/cloud256.png",null,function(){L=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:oa},fogColor:{type:"c",value:N.color},fogNear:{type:"f",value:N.near},fogFar:{type:"f",value:N.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var ha=new THREE.Mesh(new THREE.Plane(64,64)),sa=0;sa<4E3;sa++){ha.position.x=
Math.random()*1E3-500;ha.position.y=e?-Math.random()*Math.random()*200+25:-Math.random()*Math.random()*200-15;ha.position.z=sa;ha.rotation.z=Math.random()*Math.PI;ha.scale.x=ha.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(K,ha)}D=new THREE.Mesh(K,L);C=new THREE.Mesh(K,L);(new THREE.JSONLoader).load({model:"./files/models/soup/birds_B_life.js",callback:d})});oa.magFilter=THREE.LinearMipMapLinearFilter;oa.minFilter=THREE.LinearMipMapLinearFilter;B=new THREE.WebGLRenderer({antialias:!1,
clearColor:0,clearAlpha:0});B.domElement.style.position="absolute";B.domElement.style.left="0px";B.domElement.style.top="0px";B.sortObjects=!1;B.autoClear=!1;ea=new THREE.WebGLRenderTarget(window.innerWidth/2,window.innerHeight/2,{minFilter:THREE.NearestFilter,magFilter:THREE.LinearFilter});o=new THREE.WebGLRenderTarget(window.innerWidth*2,window.innerHeight*2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});window.renderTargetClouds=ea;z=new THREE.Camera;z.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);A=new THREE.Scene;Q=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:ea},tFlamingos:{type:"t",value:1,texture:o},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:N.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos *= 1./4.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.15*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
A.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),Q));this.getDomElement=function(){return B.domElement};this.show=function(){b.signals.mousemoved.add(c)};this.hide=function(){b.signals.mousemoved.remove(c)};this.resize=function(ha,sa){w.aspect=ha/sa;w.updateProjectionMatrix();B.setSize(ha,sa);B.domElement.style.width=ha+"px";B.domElement.style.height=sa+"px"};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;v=(new Date).getTime();t=v-u;u=v;
w.position.x+=(n.x-w.target.position.x)*0.01;w.position.y+=(-n.y-w.target.position.y)*0.01;w.position.z=-position+4E3;I.position.z=w.position.z-500;I.position.y=-50;w.target.position.x=w.position.x;w.target.position.y=w.position.y;w.target.position.z=w.position.z-1E3;B.clear();B.render(y,w,ea,!0);B.render(E,w,o,!0);B.render(A,z);for(var ha=0,sa=j.length;ha<sa;ha++){f=h[ha];p.z=f.position.z;f.run(h);g=j[ha];g.rotation.y=Math.atan2(-f.velocity.z,f.velocity.x)+Math.PI/2;g.rotation.z=Math.asin(f.velocity.y/
f.velocity.length());g.phase=(g.phase+(Math.max(0,g.rotation.z)+0.1))%62.83;m[ha].update(t*g.phase/100)}}},Boid=function(){var b=new THREE.Vector3,e,c=500,d=500,f=200,g,j=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;e=new THREE.Vector3;this.setGoal=function(h){g=h};this.setAvoidWalls=function(h){j=h};this.setWorldSize=function(h,m,n){c=h;d=m;f=n};this.run=function(h){if(j){b.set(-c*15,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(c,this.position.y,
this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,0,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,d,this.position.z);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,-f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b);b.set(this.position.x,this.position.y,f);b=this.avoid(b);b.multiplyScalar(5);e.addSelf(b)}Math.random()>0.5&&this.flock(h);this.move()};this.flock=function(h){g&&e.addSelf(this.reach(g,
0.005));e.addSelf(this.alignment(h));e.addSelf(this.cohesion(h));e.addSelf(this.separation(h))};this.move=function(){this.velocity.addSelf(e);var h=this.velocity.length();h>1&&this.velocity.divideScalar(h/1);this.position.addSelf(this.velocity);e.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>d)this.position.y=-d;if(this.position.y<-d)this.position.y=d;if(this.position.z>f)this.position.z=-f;if(this.position.z<
-f)this.position.z=f};this.avoid=function(h){var m=new THREE.Vector3;m.copy(this.position);m.subSelf(h);m.multiplyScalar(1/this.position.distanceToSquared(h));return m};this.repulse=function(h){var m=this.position.distanceTo(h);if(m<150){var n=new THREE.Vector3;n.sub(this.position,h);n.multiplyScalar(0.5/m);e.addSelf(n)}};this.reach=function(h,m){var n=new THREE.Vector3;n.sub(h,this.position);n.multiplyScalar(m);return n};this.alignment=function(h){for(var m,n=new THREE.Vector3,p=0,t=0,v=h.length;t<
v;t++)if(!(Math.random()>0.6)){m=h[t];distance=m.position.distanceTo(this.position);if(distance>0&&distance<=3E3){n.addSelf(m.velocity);p++}}if(p>0){n.divideScalar(p);h=n.length();h>0.03&&n.divideScalar(h/0.03)}return n};this.cohesion=function(h){for(var m,n,p=new THREE.Vector3,t=new THREE.Vector3,v=0,u=0,w=h.length;u<w;u++)if(!(Math.random()>0.6)){m=h[u];n=m.position.distanceTo(this.position);if(n>0&&n<=3E3){p.addSelf(m.position);v++}}v>0&&p.divideScalar(v);t.sub(p,this.position);h=t.length();h>
0.03&&t.divideScalar(h/0.03);return t};this.separation=function(h){for(var m,n,p=new THREE.Vector3,t=new THREE.Vector3,v=0,u=h.length;v<u;v++)if(!(Math.random()>0.6)){m=h[v];n=m.position.distanceTo(this.position);if(n>0&&n<=3E3){t.sub(this.position,m.position);t.normalize();t.divideScalar(n);p.addSelf(t)}}return p}},UgcUI=function(b){var e=function(g){var j=Math.PI*2;g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("style","fill: white; fill-opacity: 0.5");for(var h=
"M "+Math.round(Math.cos(0)*32+32)+","+Math.round(Math.sin(0)*32+32)+" ",m=0,n=0;m<6;m++,n=m/6*j)h+=Math.round(Math.cos(n)*32+32)+","+Math.round(Math.sin(n)*32+32)+" ";h+="z";g.setAttribute("d",h);g.setAttribute("cursor","pointer");g.addEventListener("mouseover",function(){this.setAttribute("style","fill: red; fill-opacity: 0.5")},!1);g.addEventListener("mouseout",function(){this.setAttribute("style","fill: white; fill-opacity: 0.5")},!1);return g},c=document.createElement("div"),d=document.createElement("button");
d.addEventListener("click",function(){b.ugcSignals.submit.dispatch()},!1);d.innerHTML="SAVE";c.appendChild(d);var f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("viewBox","0 0 400 200");f.setAttribute("width",400);f.setAttribute("height",200);c.appendChild(f);d=new e;d.addEventListener("click",function(){alert("brush")},!1);f.appendChild(d);d=new e;d.setAttribute("transform","translate(0,58)");d.addEventListener("click",function(){alert("mirror")},!1);f.appendChild(d);
d=new e;d.setAttribute("transform","translate(0,116)");d.addEventListener("click",function(){alert("color")},!1);f.appendChild(d);d=new e;d.setAttribute("transform","translate(50,29)");d.addEventListener("click",function(){alert("zoom")},!1);f.appendChild(d);d=new e;d.setAttribute("transform","translate(50,87)");d.addEventListener("click",function(){alert("view")},!1);f.appendChild(d);d=new e;d.setAttribute("transform","translate(50,145)");d.addEventListener("click",function(){alert("smooth")},!1);
f.appendChild(d);d=new e;d.setAttribute("transform","translate(100,58)");d.addEventListener("click",function(){alert("erase")},!1);f.appendChild(d);d=new e;d.setAttribute("transform","translate(100,116)");d.addEventListener("click",function(){alert("size")},!1);f.appendChild(d);this.getDomElement=function(){return c}},UgcObjectCreator=function(b){function e(){I.setMode(!u?VoxelPainter.MODE_DRAW:VoxelPainter.MODE_ERASE)}function c(){I.setMode(VoxelPainter.MODE_IDLE)}function d(){n?I.moveMouse(b.mouse.x/
b.viewportWidth,(b.mouse.y-E)/b.viewportHeight):I.moveMouse(b.mouse.x/b.screenWidth,b.mouse.y/b.screenHeight)}function f(C){z-=C.wheelDeltaY}function g(C){switch(C.keyCode){case 16:w=!0;break;case 17:u=!0}}function j(C){switch(C.keyCode){case 16:w=!1;break;case 17:u=!1}}var h=this,m=document.createElement("div"),n=!0,p=Math.PI/180,t,v,u=!1,w=!1,z=1500,y=45,A=15;t=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,1E4);t.target.position.y=200;h.scene=new THREE.Scene;h.scene.fog=new THREE.FogExp2(16777215,
1.35E-4);h.scene.fog.color.setHSV(0.576,0.382,0.9);v=new THREE.DirectionalLight(16772829,1.5);v.position.set(0.5,0.75,1);v.color.setHSV(0,0,1);h.scene.addLight(v);v=new THREE.DirectionalLight(16772829,1.5);v.position.set(-0.5,-0.75,-1);v.color.setHSV(0,0,0.306);h.scene.addLight(v);h.lensFlare=null;h.lensFlareRotate=null;v=new THREE.Vector3(0,0,-7500);initLensFlares(h,v,60,292);(new THREE.JSONLoader).load({model:"files/models/ugc/D_tile_1.D_tile_1.js",callback:function(C){mesh=new THREE.Mesh(C,new THREE.MeshFaceMaterial);
mesh.position.x=1500;mesh.position.y=-50;mesh.rotation.x=-90*Math.PI/180;mesh.scale.x=mesh.scale.y=mesh.scale.z=0.5;h.scene.addChild(mesh)}});if(!b.renderer){v=new THREE.WebGLRenderer;v.domElement.style.position="absolute";v.setSize(window.innerWidth,window.innerHeight);v.setClearColor(h.scene.fog.color);v.sortObjects=!1;v.autoClear=!1;b.renderer=v}if(n){var E=0;b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/
b.baseWidth);b.renderer.setSize(b.viewportWidth,b.baseHeight);if(!b.renderTarget){v=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);v.minFilter=THREE.LinearFilter;v.magFilter=THREE.LinearFilter;b.renderTarget=v}var B=new PaintEffectDunes(b);B.init()}var I=new VoxelPainter(t),D=new UgcHandler;b.ugcSignals.submit.add(function(){var C="",K=I.getGrid(),N;for(N in K)C+=K[N].position.x+","+K[N].position.y+","+K[N].position.z+",16777215,";C="["+C.slice(0,-1)+"]";D.submitUGO("this is a test","test@tes.com",
1,C,null,function(L){console.log(L)})});this.getDomElement=function(){return m};this.show=function(){b.signals.mousedown.add(e);b.signals.mouseup.add(c);b.signals.mousemoved.add(d);b.signals.mousewheel.add(f);b.signals.keydown.add(g);b.signals.keyup.add(j);m.appendChild(b.renderer.domElement);b.renderer.setClearColor(h.scene.fog.color)};this.hide=function(){b.signals.mousedown.remove(e);b.signals.mouseup.remove(c);b.signals.mousemoved.remove(d);b.signals.mousewheel.remove(f);b.signals.keydown.remove(g);
b.signals.keyup.remove(j)};this.resize=function(C,K){if(n){t.aspect=b.viewportWidth/b.viewportHeight;t.updateProjectionMatrix();b.viewportWidth=b.baseWidth*(C/b.baseWidth);b.viewportHeight=b.baseHeight*(C/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.viewportHeight);b.renderTarget.width=b.viewportWidth;b.renderTarget.height=b.viewportHeight;delete b.renderTarget.__webglFramebuffer;E=(K-b.viewportHeight)/2;b.renderer.domElement.style.left="0px";b.renderer.domElement.style.top=E+"px"}else{t.aspect=
C/K;t.updateProjectionMatrix();b.renderer.setSize(C,K)}};this.update=function(){if(w){y+=b.mouse.x/b.screenWidth*2-1;A-=b.mouse.y/b.screenHeight*2-1;A=A>90?90:A<-90?-90:A}t.position.x=z*Math.sin(y*p)*Math.cos(A*p);t.position.y=z*Math.sin(A*p);t.position.z=z*Math.cos(y*p)*Math.cos(A*p);I.update();b.renderer.clear();if(n){b.renderer.render(h.scene,t,b.renderTarget,!0);b.renderer.render(I.getScene(),t,b.renderTarget);B.update(0,0,0)}else{b.renderer.render(h.scene,t);b.renderer.render(I.getScene(),t)}}},
UgcSoupCreator=function(){var b;domElement=document.createElement("div");b=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);b.position.z=6E3;this.getDomElement=function(){return(void 0).domElement};this.show=function(){};this.hide=function(){};this.resize=function(e,c){b.aspect=e/c;b.updateProjectionMatrix();(void 0).setSize(e,c)};this.update=function(){(void 0).clear();(void 0).render(void 0,b)}},VoxelPainter=function(b){function e(D){return Math.round(D/E)}function c(D){var C=e(D.x),
K=e(D.y);D=e(D.z);if(B[C+"."+K+"."+D]==null){var N=new THREE.Mesh(n,p);N.position.x=C*E;N.position.y=K*E;N.position.z=D*E;N.matrixAutoUpdate=!1;N.updateMatrix();N.update();z.addObject(N);B[C+"."+K+"."+D]=N}}var d,f,g=new THREE.Scene,j=new THREE.DirectionalLight(16772829,1.5);j.position.set(0.5,0.75,1);j.color.setHSV(0,0,1);g.addLight(j);j=new THREE.DirectionalLight(16772829,1.5);j.position.set(-0.5,-0.75,-1);j.color.setHSV(0,0,0.306);g.addLight(j);var h=new THREE.Scene;g.addObject(h);var m=new THREE.Object3D;
m.visible=!1;var n=new THREE.Plane(2E3,2E3,16,16),p=new THREE.MeshBasicMaterial({color:0,opacity:0.2,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(n,p);_plane.doubleSided=!0;_plane.visible=m.visible;m.addChild(_plane);_plane=new THREE.Mesh(n,p);_plane.rotation.y=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=m.visible;m.addChild(_plane);m.matrixAutoUpdate=!1;h.addObject(m);var t,v,u,w;t=new THREE.Projector;v=new THREE.Vector3(0,0,0.5);w=new THREE.Ray(b.position,null);var z=new THREE.Scene;
g.addObject(z);var y=new THREE.Mesh(new THREE.Plane(2E3,2E3,40,40),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparency:!0,wireframe:!0}));y.position.x=-25;y.position.y=-25;y.position.z=-25;y.rotation.x=-90*Math.PI/180;z.addObject(y);var A=VoxelPainter.MODE_IDLE,E=50,B={};n=new THREE.Cube(E,E,E);p=new THREE.MeshLambertMaterial({color:16777215});var I=new THREE.Mesh(n,new THREE.MeshLambertMaterial({color:65280,opacity:0,transparent:!0}));I.matrixAutoUpdate=!1;g.addObject(I);c(new THREE.Vector3);
this.setMode=function(D){A=D};this.moveMouse=function(D,C){v.x=D*2-1;v.y=-C*2+1;u=t.unprojectVector(v.clone(),b);w.direction=u.subSelf(b.position).normalize()};this.update=function(){var D;switch(A){case VoxelPainter.MODE_IDLE:D=w.intersectScene(z);if(D.length>0){f=D[0].object;d=D[0].face;I.materials[0].opacity=0.5;m.position.copy(f.matrixRotationWorld.multiplyVector3(d.centroid.clone()).addSelf(f.position));m.position.addSelf(f.matrixRotationWorld.multiplyVector3(d.normal.clone()));m.updateMatrix();
m.update();I.position.copy(m.position);I.position.x=e(I.position.x)*E;I.position.y=e(I.position.y)*E;I.position.z=e(I.position.z)*E;I.updateMatrix();I.update()}else{I.materials[0].opacity=0;d=f=null}break;case VoxelPainter.MODE_DRAW:I.materials[0].opacity=0;D=w.intersectScene(h);if(d&&D.length>0){var C=D[0].point;D=f.matrixRotationWorld.multiplyVector3(d.centroid.clone()).addSelf(f.position);C=D.distanceTo(C);D=D.addSelf(f.matrixRotationWorld.multiplyVector3(d.normal.clone()).multiplyScalar(C));c(D)}break;
case VoxelPainter.MODE_ERASE:D=w.intersectScene(z);if(D.length>0&&D[0].object!=y){D=D[0].object;C=e(D.position.x);var K=e(D.position.y),N=e(D.position.z);B[C+"."+K+"."+N]=null;z.removeObject(D);g.removeObject(D)}}};this.getScene=function(){return g};this.getGrid=function(){return B}};VoxelPainter.MODE_IDLE="VoxelPainter.MODE_IDLE";VoxelPainter.MODE_DRAW="VoxelPainter.MODE_DRAW";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var emiBuyButtonUrl="http://widgets.platform.emi.com/widget/1.0/",emiBuyButtonUuids=["c9e456919b824bdeb2e3a326b122db43"],gaJsHost="https:"==document.location.protocol?"https://ssl.":"http://www.";document.write(unescape("%3Cscript src='"+gaJsHost+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));document.writeln(unescape("%3Cscript src='"+emiBuyButtonUrl+"js/emi_buy_button.js' type='text/javascript'%3E%3C/script%3E"));
function Footer(b,e){var c=e||"files/footer",d=!0;this.getDomElement=function(){return b};this.setupEmiBuyButton=function(){(new EMIBuyButton({buttonID:"c9e456919b824bdeb2e3a326b122db43",buttonImageUrl:c+"/buy_button-trans.png",useVendorImages:!0})).replaceDiv("rome_footer_buy_album");d=!1;return this};this.isSetup=function(){return d};var f="";f+='<div id = "rome-footer">';f+='<div id = "shout-out">';f+="  <ul>";f+='    <li><a href = "http://chromeexperiments.com/"><img src = "'+c+'/chrome-trans.png" alt = "This is a Chrome Experiment" border = "0" /></a></li>';
f+='    <li class = "divider">&nbsp;</li>';f+='    <li><a href = "http://google.com/"><img src = "'+c+'/google-trans.png" alt = "Made With Friends From Google" border = "0" /></a></li>';f+='    <li class = "clear">&nbsp;</li>';f+="  </ul>";f+="</div>";f+="";f+='<div id = "navigation">';f+='  <ul class = "primary">';f+='    <li class = "first"><a href = "http://ro.me/tech">Technology</a></li>';f+='    <li><a href = "http://ro.me/credits">Credits</a></li>';f+='    <li><a href = "http://ro.me/album">Rome Album</a></li>';
f+='    <li id = "rome_footer_buy_album">';f+="    </li>";f+='    <li class = "last">Share</li>';f+='    <li class = "last icons"><a href="http://www.facebook.com/sharer.php?u=http://ro.me" target="_blank"><img src = "'+c+'/fb-trans.png" alt = "facebook" border = "0"  /></a></li>';f+='    <li class = "last icons"><a href="http://twitter.com/share?text=\u201cROME\u201d&amp;url=http://ro.me" target="_blank"><img src = "'+c+'/twitter-trans.png" alt = "twitter" border = "0" /></a></li>';f+='    <li class = "clear last">&nbsp;</li>';
f+="  </ul>";f+='  <ul class = "secondary">';f+='    <li class = "first"><a href = "http://ro.me/terms">Terms</a></li>';f+='    <li class = "last"><a href = "http://ro.me/privacy">Privacy</a></li>';f+='    <li class = "clear last">&nbsp;</li>';f+="  </ul>";f+="</div>";f+='<div class = "clear">&nbsp;</div>';f+="</div>";f+="</div>";var g="";g+="#rome-footer * {";g+="  margin: 0;";g+="  padding: 0;";g+="}";g+="#rome-footer {";g+='  font: 500 10px/18px "Futura", Arial, sans-serif;';g+="  color: #434343;";
g+="  text-transform: uppercase;";g+="  letter-spacing: 1px;";g+="}";g+="#rome-footer #shout-out {";g+="  float: left;";g+="  margin: 0 0 0 18px;";g+="}";g+="#rome-footer #navigation {";g+="  float: right;";g+="  margin: 20px 26px 0 0;";g+="  vertical-align: middle;";g+="}";g+="#rome-footer ul li {";g+="  height: 16px;";g+="  border-right: 1px solid #a0a0a0;";g+="  padding: 0 10px 0 10px;";g+="  width: auto;";g+="  float: left;";g+="  list-style: none;";g+="}";g+="#rome-footer ul li.last,";g+="#rome-footer ul li.last li {";
g+="  border: none;";g+="  padding: 0 0 0 10px;";g+="}";g+="#rome-footer #shout-out ul li {";g+="  margin: 0;";g+="  border: 0;";g+="}";g+="#rome-footer #shout-out li.divider {";g+="  margin: 15px 0 15px 15px;";g+="  height: 24px;";g+="  border-left: 1px solid #a0a0a0;";g+="}";g+="#rome-footer a img {";g+="  border: 0;";g+="}";g+="#rome-footer .secondary a:link, #rome-footer .secondary a:visited {";g+="  color: #777;";g+="}";g+="#rome-footer a:link, #rome-footer a:visited,";g+="#rome-footer .secondary a:hover, #rome-footer .secondary a:active {";
g+="  color: #434343;";g+="  text-decoration: none;";g+="}";g+="#rome-footer a:hover, #rome-footer a:active {";g+="  color: #000;";g+="}";g+="#emi_buy_button_link_c9e456919b824bdeb2e3a326b122db43_1 {";g+="  margin-top: 2px;";g+="  height: 8px;";g+="  line-height: 8px;";g+="  overflow: hidden;";g+="}";g+="#rome-footer #rome_footer_buy_album img {";g+="  display: block;";g+="  margin-top: 0;";g+="}";g+="#rome-footer #rome_footer_buy_album a:hover img {";g+="  margin-top: -8px;";g+="}";g+="#emi_vendor_menu_c9e456919b824bdeb2e3a326b122db43_1 a:hover img {";
g+="  margin-top: 0;";g+="}";g+="#emi_vendor_menu_c9e456919b824bdeb2e3a326b122db43_1 {";g+="  margin-top: -145px;";g+="  margin-left: -11px;";g+="  padding: 10px;";g+="}";g+="#emi_vendor_menu_c9e456919b824bdeb2e3a326b122db43_1 * {";g+="  text-transform: none;";g+="}";g+="#emi_vendor_menu_c9e456919b824bdeb2e3a326b122db43_1 .emi_vendor_link {";g+="  margin-top: 5px;";g+="}";g+="#rome-footer .secondary {";g+="  margin: 10px 0 0 0;";g+="  float: right;";g+="}";g+=".clear {";g+="  clear: both;";g+="  display: block;";
g+="  overflow: hidden;";g+="  visibility: hidden;";g+="  width: 0;";g+="  height: 0;";g+="}";b.innerHTML=f;f=document.createTextNode(g);g=document.getElementsByTagName("head")[0];var j=document.createElement("style");if(j.stylesheet)j.styleSheet.cssText=f.nodeValue;else j.appendChild(f);g.appendChild(j)}
var Shortcuts=function(b){function e(){var j=document.createElement("span");j.innerHTML=" ";g.appendChild(j)}function c(j,h){var m=document.createElement("span");m.style.cursor="pointer";m.style.padding="0.5em";m.style.marginRight="4px";m.style.background="rgba(255,255,255,0.15)";m.innerHTML=j;m.addEventListener("click",h,!1);g.appendChild(m)}function d(j,h){c(j,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(h,1)})}function f(j,h){c(j,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(h)})}var g=document.createElement("div");g.style.position="absolute";g.style.left="0px";g.style.top="0px";g.style.padding="0.5em";g.style.fontSize="10px";(function(j){c(j,function(){b.signals.showlauncher.dispatch()})})("Launcher");e();d("Intro",0);e();d("Transition to City",8);d("City",16);e();d("Transition to Prairie",24);d("Prairie",32);e();d("Transition to Dunes",40);d("Dunes",48);e();(function(j){c(j,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
e();f("Explore City","city");f("Explore Prairie","prairie");f("Explore Dunes","dunes");e();(function(j){c(j,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return g}};
(function(){function b(v){j&&j.hide();if(!v.__loaded){v.load();v.__loaded=!0}v.resize(window.innerWidth,window.innerHeight);v.show();j=v}function e(){requestAnimationFrame(e);c.clear();j.update();d.update()}var c,d,f,g=signals.Signal,j,h,m,n,p,t;c=new Logger;c.domElement.style.position="fixed";c.domElement.style.right="100px";c.domElement.style.top="0px";document.body.appendChild(c.domElement);d=new Stats;d.domElement.style.position="fixed";d.domElement.style.right="0px";d.domElement.style.top="0px";
document.body.appendChild(d.domElement);f={logger:c,mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,signals:{mousedown:new g,mouseup:new g,mousemoved:new g,mousewheel:new g,keydown:new g,keyup:new g,windowresized:new g,load:new g,showlauncher:new g,showfilm:new g,showrelauncher:new g,showexploration:new g,showugc:new g,loadBegin:new g,loadItemAdded:new g,loadItemCompleted:new g,startfilm:new g,stopfilm:new g,startexploration:new g,initscenes:new g},worlds:{},sequences:{},
started:{city:!1,prairie:!1,dunes:!1}};h=new LauncherSection(f);document.body.appendChild(h.getDomElement());n=new RelauncherSection(f);document.body.appendChild(n.getDomElement());t=new UgcSection(f);document.body.appendChild(t.getDomElement());g=new Shortcuts(f);document.body.appendChild(g.getDomElement());f.signals.load.add(function(){f.signals.loadBegin.dispatch();m=new FilmSection(f);document.body.appendChild(m.getDomElement());p=new ExplorationSection(f);document.body.appendChild(p.getDomElement());
f.signals.showfilm.add(function(){b(m)});f.signals.showexploration.add(function(){b(p)})});f.signals.showlauncher.add(function(){b(h)});f.signals.showrelauncher.add(function(){b(n)});f.signals.showugc.add(function(){b(t)});document.addEventListener("mousedown",function(v){f.signals.mousedown.dispatch(v);v.preventDefault();v.stopPropagation()},!1);document.addEventListener("mouseup",function(v){f.signals.mouseup.dispatch(v);v.preventDefault();v.stopPropagation()},!1);document.addEventListener("mousemove",
function(v){f.mouse.x=v.clientX;f.mouse.y=v.clientY;f.signals.mousemoved.dispatch(v)},!1);document.addEventListener("mousewheel",function(v){f.signals.mousewheel.dispatch(v)},!1);document.addEventListener("keydown",function(v){f.signals.keydown.dispatch(v)},!1);document.addEventListener("keyup",function(v){f.signals.keyup.dispatch(v)},!1);window.addEventListener("resize",function(){j.resize(window.innerWidth,window.innerHeight);f.screenWidth=window.innerWidth;f.screenHeight=window.innerHeight;f.signals.windowresized.dispatch()},
!1);b(h);e()})();
