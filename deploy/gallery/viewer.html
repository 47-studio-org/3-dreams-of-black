<html>
	<head>
		<style>
			body {

				background-color: #000000;
				margin: 0px;
				overflow: hidden;

			}
		</style>
	</head>
	<body>

		<script src="/js/lib/Three.js"></script>
		<script src="/js/lib/RequestAnimationFrame.js"></script>

		<script src="/js/lib/UgcObject.js"></script>
		<script src="/js/lib/UgcHandler.js"></script>

		<script>

			( function() {

				var WIDTH = window.innerWidth, HEIGHT = window.innerHeight,
				DEG2RAD = Math.PI / 180, radius = 1500,
				mouse = { x: 0, y: 0 }, theta = 45, phi = 15;

				var camera = new THREE.Camera( 50, WIDTH / HEIGHT, 1, 20000 );
				camera.target.position.y = 200;

				var scene = new THREE.Scene();
				scene.fog = new THREE.FogExp2( 0xffffff, 0.000175 );
				scene.fog.color.setHSV( 0.576,  0.382,  0.9  );

				// Lights

				var ambient = new THREE.AmbientLight( 0x221100 );
				var directionalLight1 = new THREE.DirectionalLight( 0xffeedd );
				var directionalLight2 = new THREE.DirectionalLight( 0xffeedd );

				ambient.color.setHSV( 0, 0, 0.1 );

				directionalLight1.color.setHSV( 0.088, 0, 1 );
				directionalLight1.position.set( 0.8, 0.3, - 0.5 );
				directionalLight1.position.normalize();

				directionalLight2.color.setHSV( 0, 0, 0.564 );
				directionalLight2.position.set( 0.1, 0.5, 0.2 );
				directionalLight2.position.normalize();

				scene.addLight( ambient );
				scene.addLight( directionalLight1 );
				scene.addLight( directionalLight2 );

				// Renderer

				var renderer = new THREE.WebGLRenderer();
				renderer.domElement.style.position = 'absolute';
				renderer.setSize( WIDTH, HEIGHT );
				renderer.setClearColor( scene.fog.color );
				renderer.sortObjects = false;
				document.body.appendChild( renderer.domElement );

				// Environment

				var loader = new THREE.SceneLoader();
				loader.load( "/files/models/dunes/D_tile_1.js", function ( result ) {

					for ( var i = 0, l = result.scene.objects.length; i < l; i ++ ) {

						var object = result.scene.objects[ i ];

						if ( object.visible ) {

							object.rotation.x = - 90 * Math.PI / 180;
							object.position.y = - 50;
							object.position.x = 1000;
							object.scale.x = object.scale.y = object.scale.z = 0.75;
							scene.addObject( object );

						}

					}

					// Clouds

					var geometry = new THREE.Plane( 1000, 1000 ); 

					for ( var i = 0; i < 100; i ++ ) {

						var mesh = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: 0xffffff, opacity: 0.5, blending: THREE.AdditiveBlending } ) );
						mesh.position.x = Math.random() - 0.5;
						mesh.position.y = Math.random();
						mesh.position.z = Math.random() - 0.5;
						mesh.position.normalize();

						mesh.position.x = mesh.position.x * ( Math.random() * 5000 + 2500 );
						mesh.position.y = mesh.position.y * ( Math.random() * 2500 + 5000 ) + 2500;
						mesh.position.z = mesh.position.z * ( Math.random() * 5000 + 2500 );

						mesh.rotation.x = - 90 * Math.PI / 180;
						mesh.scale.x = Math.random() * 2 + 1;
						mesh.scale.y = Math.random() * 2 + 1;
						mesh.doubleSided = true;

						scene.addObject( mesh );

					}

				} );

				// Object

				var id = parseInt( window.location.hash.substr( 1 ) );

				var ugcHandler = new UgcHandler();
				ugcHandler.getUGO( id, function ( object ) {

					console.log( object );

					var ugo = new UgcObject( JSON.parse( object.data ) );

					if ( ! ugo.isEmpty() ) {

						scene.addObject( ugo.getMesh() );

					}

				} );

				document.addEventListener( 'mousemove', function onDocumentMouseMove( event ) {

					mouse.x = event.clientX;
					mouse.y = event.clientY;

				}, false );

				animate();

				//

				function animate() {

					requestAnimationFrame( animate );

					theta += ( mouse.x / WIDTH ) - 0.5;

					phi -= ( mouse.y / HEIGHT ) - 0.5;
					phi = phi > 90 ? 90 : phi < 0 ? 0 : phi;

					camera.position.x = radius * Math.sin( theta * DEG2RAD ) * Math.cos( phi * DEG2RAD );
					camera.position.y = radius * Math.sin( phi * DEG2RAD );
					camera.position.z = radius * Math.cos( theta * DEG2RAD ) * Math.cos( phi * DEG2RAD );

					renderer.render( scene, camera );

				}

			} )();

		</script>

	</body>
</html>
